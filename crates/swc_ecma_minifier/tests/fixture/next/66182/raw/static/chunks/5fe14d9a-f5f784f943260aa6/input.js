"use strict";
(self["webpackChunk_N_E"] = self["webpackChunk_N_E"] || []).push([[573],{

/***/ 8112:
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

/* provided dependency */ var process = __webpack_require__(357);

/**
 * The code below uses open source software. Please visit the URL below for an overview of the licenses:
 * http://js.api.here.com/v3/3.1.54.1/HERE_NOTICE
 */

(function(){/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
var m,aa=[];function ba(a){return function(){return aa[a].apply(this,arguments)}}function ca(a,b){return aa[a]=b}function da(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function ea(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:da(a)}}function fa(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c}
function ia(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof __webpack_require__.g&&__webpack_require__.g];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var ja=ia(this),ka="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
function la(a,b){if(b)a:{var c=ja;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ka(c,a,{configurable:!0,writable:!0,value:b})}}
la("Symbol",function(a){function b(f){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(d+(f||"")+"_"+e++,f)}function c(f,g){this.Fx=f;ka(this,"description",{configurable:!0,writable:!0,value:g})}if(a)return a;c.prototype.toString=function(){return this.Fx};var d="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",e=0;return b});
la("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=ja[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&ka(d.prototype,a,{configurable:!0,writable:!0,value:function(){return ma(da(this))}})}return a});function ma(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}
function na(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}la("Array.prototype.keys",function(a){return a?a:function(){return na(this,function(b){return b})}});
la("Array.prototype.find",function(a){return a?a:function(b,c){a:{var d=this;d instanceof String&&(d=String(d));for(var e=d.length,f=0;f<e;f++){var g=d[f];if(b.call(c,g,f,d)){b=g;break a}}b=void 0}return b}});var oa;if("function"==typeof Object.setPrototypeOf)oa=Object.setPrototypeOf;else{var pa;a:{var qa={a:!0},ra={};try{ra.__proto__=qa;pa=ra.a;break a}catch(a){}pa=!1}oa=pa?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var sa=oa;
la("Object.setPrototypeOf",function(a){return a||sa});la("Array.prototype.entries",function(a){return a?a:function(){return na(this,function(b,c){return[b,c]})}});
la("Promise",function(a){function b(g){this.o=0;this.lf=void 0;this.Rh=[];this.Qu=!1;var h=this.Wo();try{g(h.resolve,h.reject)}catch(k){h.reject(k)}}function c(){this.De=null}function d(g){return g instanceof b?g:new b(function(h){h(g)})}if(a)return a;c.prototype.bt=function(g){if(null==this.De){this.De=[];var h=this;this.ct(function(){h.Ry()})}this.De.push(g)};var e=ja.setTimeout;c.prototype.ct=function(g){e(g,0)};c.prototype.Ry=function(){for(;this.De&&this.De.length;){var g=this.De;this.De=[];
for(var h=0;h<g.length;++h){var k=g[h];g[h]=null;try{k()}catch(l){this.dy(l)}}}this.De=null};c.prototype.dy=function(g){this.ct(function(){throw g;})};b.prototype.Wo=function(){function g(l){return function(n){k||(k=!0,l.call(h,n))}}var h=this,k=!1;return{resolve:g(this.EC),reject:g(this.ur)}};b.prototype.EC=function(g){if(g===this)this.ur(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof b)this.VC(g);else{a:switch(typeof g){case "object":var h=null!=g;break a;case "function":h=
!0;break a;default:h=!1}h?this.DC(g):this.Xt(g)}};b.prototype.DC=function(g){var h=void 0;try{h=g.then}catch(k){this.ur(k);return}"function"==typeof h?this.WC(h,g):this.Xt(g)};b.prototype.ur=function(g){this.Tw(2,g)};b.prototype.Xt=function(g){this.Tw(1,g)};b.prototype.Tw=function(g,h){if(0!=this.o)throw Error("Cannot settle("+g+", "+h+"): Promise already settled in state"+this.o);this.o=g;this.lf=h;2===this.o&&this.IC();this.Ty()};b.prototype.IC=function(){var g=this;e(function(){if(g.CB()){var h=
ja.console;"undefined"!==typeof h&&h.error(g.lf)}},1)};b.prototype.CB=function(){if(this.Qu)return!1;var g=ja.CustomEvent,h=ja.Event,k=ja.dispatchEvent;if("undefined"===typeof k)return!0;"function"===typeof g?g=new g("unhandledrejection",{cancelable:!0}):"function"===typeof h?g=new h("unhandledrejection",{cancelable:!0}):(g=ja.document.createEvent("CustomEvent"),g.initCustomEvent("unhandledrejection",!1,!0,g));g.promise=this;g.reason=this.lf;return k(g)};b.prototype.Ty=function(){if(null!=this.Rh){for(var g=
0;g<this.Rh.length;++g)f.bt(this.Rh[g]);this.Rh=null}};var f=new c;b.prototype.VC=function(g){var h=this.Wo();g.zl(h.resolve,h.reject)};b.prototype.WC=function(g,h){var k=this.Wo();try{g.call(h,k.resolve,k.reject)}catch(l){k.reject(l)}};b.prototype.then=function(g,h){function k(q,r){return"function"==typeof q?function(v){try{l(q(v))}catch(w){n(w)}}:r}var l,n,p=new b(function(q,r){l=q;n=r});this.zl(k(g,l),k(h,n));return p};b.prototype.catch=function(g){return this.then(void 0,g)};b.prototype.zl=function(g,
h){function k(){switch(l.o){case 1:g(l.lf);break;case 2:h(l.lf);break;default:throw Error("Unexpected state: "+l.o);}}var l=this;null==this.Rh?f.bt(k):this.Rh.push(k);this.Qu=!0};b.resolve=d;b.reject=function(g){return new b(function(h,k){k(g)})};b.race=function(g){return new b(function(h,k){for(var l=ea(g),n=l.next();!n.done;n=l.next())d(n.value).zl(h,k)})};b.all=function(g){var h=ea(g),k=h.next();return k.done?d([]):new b(function(l,n){function p(v){return function(w){q[v]=w;r--;0==r&&l(q)}}var q=
[],r=0;do q.push(void 0),r++,d(k.value).zl(p(q.length-1),n),k=h.next();while(!k.done)})};return b});la("Object.entries",function(a){return a?a:function(b){var c=[],d;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&c.push([d,b[d]]);return c}});la("Object.values",function(a){return a?a:function(b){var c=[],d;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&c.push(b[d]);return c}});la("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}});
la("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}});
la("String.prototype.includes",function(a){return a?a:function(b,c){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==(this+"").indexOf(b,c||0)}});
la("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}});function ua(a){return a?a:Array.prototype.fill}la("Int8Array.prototype.fill",ua);la("Uint8Array.prototype.fill",ua);la("Uint8ClampedArray.prototype.fill",ua);la("Int16Array.prototype.fill",ua);la("Uint16Array.prototype.fill",ua);la("Int32Array.prototype.fill",ua);
la("Uint32Array.prototype.fill",ua);la("Float32Array.prototype.fill",ua);la("Float64Array.prototype.fill",ua);var va="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e])}return a};la("Object.assign",function(a){return a||va});la("Math.log2",function(a){return a?a:function(b){return Math.log(b)/Math.LN2}});la("globalThis",function(a){return a||ja});
var wa=this||self;function xa(a,b,c,d){a=a.split(".");d=d||wa;a[0]in d||"undefined"==typeof d.execScript||d.execScript("var "+a[0]);for(var e;a.length&&(e=a.shift());)if(a.length||void 0===b)d=d[e]&&d[e]!==Object.prototype[e]?d[e]:d[e]={};else if(!c&&ya(b)&&ya(d[e]))for(var f in b)b.hasOwnProperty(f)&&(d[e][f]=b[f]);else d[e]=b}function za(){}function Aa(a){var b=typeof a;return"object"!=b?b:a?Array.isArray(a)?"array":b:"null"}
function Ba(a){var b=Aa(a);return"array"==b||"object"==b&&"number"==typeof a.length}function ya(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}function Ca(a){return Object.prototype.hasOwnProperty.call(a,Da)&&a[Da]||(a[Da]=++Ea)}var Da="closure_uid_"+(1E9*Math.random()>>>0),Ea=0;function Fa(a,b,c){return a.call.apply(a.bind,arguments)}
function Ha(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function Ia(a,b,c){Ia=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Fa:Ha;return Ia.apply(null,arguments)}
function Ja(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function t(a,b){xa(a,b,!0,void 0)}function u(a,b){function c(){}c.prototype=b.prototype;a.g=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.KD=function(d,e,f){for(var g=Array(arguments.length-2),h=2;h<arguments.length;h++)g[h-2]=arguments[h];return b.prototype[e].apply(d,g)}};var Ka,La,Ma;function Na(){}t("H.util.ICharStream",Na);Na.prototype.next=function(){};Na.prototype.ui=function(){};Na.prototype.ih=function(){};Na.prototype.fb=function(){};function Oa(a){this.Eu=String(a);this.bw=0;this.Ac=[];this.Rf=!1}t("H.util.CharStream",Oa);Oa.prototype.next=function(){var a=this.Eu.charCodeAt(this.bw++);a=isNaN(a)?-1:a;this.Rf&&this.Ac.push(a);return a};Oa.prototype.ui=function(){this.Rf=!0;this.Ac=[]};Oa.prototype.ih=function(){var a=this.Ac.slice();this.Rf=!1;this.Ac=[];return a};Oa.prototype.fb=function(){var a=this.Eu.charCodeAt(this.bw+0);return isNaN(a)?-1:a};function Pa(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1}function Qa(a){for(var b in a)return!1;return!0}function Ra(a){var b={},c;for(c in a)b[c]=a[c];return b}var Sa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ta(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Sa.length;f++)c=Sa[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var x=this;function Ua(a,b){if(Error.captureStackTrace)Error.captureStackTrace(this,Ua);else{var c=Error().stack;c&&(this.stack=c)}a&&(this.message=String(a));b&&(this.MD=b)}u(Ua,Error);Ua.prototype.name="CustomError";var Va=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"===typeof a)return"string"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};function Wa(){return Object.create(z,void 0)}var A=Ia,Xa=String,Ya=x.Object.freeze||function(a){return a};function Za(a){for(var b=Object.keys(a),c=b.length,d;c--;)d=a[b[c]],ya(d)&&Za(d);return Ya(a)}function $a(a){var b=Aa(a);if("object"==b||"array"==b){if(ab(a.clone))return a.clone();b="array"==b?[]:{};for(var c in a)a.hasOwnProperty(c)&&(b[c]=$a(a[c]));return b}return a}var B=[].pop(),z=/x/.exec(""),cb="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function C(a,b,c,d,e){if(!(b=a instanceof b)&&c)throw new D(c,d,db(e)?e:a);return b}function eb(a,b){if(!0===(C(a,b)&&a.constructor===b))throw new TypeError("Illegal constructor "+fb(b));}function ab(a){return"function"==Aa(a)}function gb(a,b,c,d,e){if(!(b=hb(a)===b)&&c)throw new D(c,d,db(e)?e:a);return b}function ib(a,b,c,d){return gb(a,"Array",b,c,d)}t("H.lang.isArray",ib);function db(a){return a!==B}function jb(a){return"string"===typeof a}t("H.lang.isString",jb);
var kb=parseInt,lb=parseFloat,E=isNaN;function ob(a){return a===+a}t("H.lang.isNumber",ob);t("H.lang.isInteger",Number.isInteger?Number.isInteger:function(a){return"number"===typeof a&&0===a%1});function pb(a){return!E(+a)}function hb(a){var b=Object[cb[0]][cb[6]].call(a).match(/^\[object (\w+)\]$/);return b?b[1]:typeof a}var qb=[];function rb(a){0>qb.indexOf(a)&&qb.push(a)}rb(qb);
function fb(a,b,c,d){var e="",f=2>arguments.length,g;f&&(b={H:x.H},c="",d=qb.slice());sb(b,!0,function(h,k){try{if(g=h[k],k=tb(h,g),!(ya(g)&&g.window===g&&g.self===g||ya(g)&&0<g.nodeType&&ab(g.cloneNode))&&ya(g)){if(g===a)return e=c+"."+k,!0;if(0>d.indexOf(g)&&(d.push(g),e=fb(a,g,c+"."+k,d)))return!0}}catch(l){}});f&&(e=e?e.substr(1).replace("."+cb[0]+".","#"):"~"+(ab(a)?ub(a)+"()":hb(a)));return e}
function tb(a,b){var c=[];sb(a,!1,function(d,e){d[e]===b&&c.push(e)});return c.sort(vb)[0]}function vb(a,b){return b.length-a.length}var wb=Object[cb[0]][cb[2]];function sb(a,b,c){var d;if(a){for(e in a)if((!b||wb.call(a,e))&&c(a,e,!0))return;for(d=cb.length;d--;){var e=cb[d];if((!b||wb.call(a,e))&&c(a,e,!1))break}}}function ub(a){return(a=/^\s*function ([^\( ]+)/.exec(a))?a[1]:"anonymous"}function xb(a,b,c){c[b]="#"+b}var yb=!!x.__karma__;function zb(){throw Error("unimplemented method");}
function D(a,b,c){var d=arguments.length,e;b=b!==B?+b:b;b!==B&&((e=/^.*?\(([^\)]+)/.exec((""+a).replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")))?(e=e[1].replace(/\s+/g,""),e=Xa(e).split(","!==B?",":" ")):e=[],e.forEach(xb),e=e[b]||"#"+b);var f=a?fb(a):"";d=2<d?Xa(c):"";if(e||d)f+=" (Argument "+(e||"")+(d?" "+d:"")+")";d=Error(f);Object.setPrototypeOf(d,D.prototype);return d}u(D,Error);t("H.lang.InvalidArgumentError",D);D.prototype.name="InvalidArgumentError";
function Ab(a,b){var c=[];a&&c.push(fb(a));1<arguments.length&&c.push(""+b);c=Error(c.join(" "));Object.setPrototypeOf(c,Ab.prototype);return c}u(Ab,Error);t("H.lang.IllegalOperationError",Ab);Ab.prototype.name="IllegalOperationError";var Bb=Math,Cb=Bb.min,Db=Bb.max,Eb=Bb.round,Fb=Bb.floor,Gb=Bb.ceil,Hb=Bb.abs,Ib=Bb.log,Jb=Bb.sqrt,Kb=Bb.pow,Lb=Bb.exp,Mb=Bb.sin,Nb=Bb.asin,Ob=Bb.cos,Pb=Bb.tan,Qb=Bb.atan,Rb=Bb.atan2,Sb=Bb.LN2,Tb=Bb.PI,Ub=Tb/2,Vb=Tb/4,Wb=2*Tb,Xb=3*Tb,Yb=Tb/180,Zb=180/Tb,$b=1/0,ac=Kb(-2,53),bc=bc||function(a){return Ib(a)/Sb};function cc(a,b){var c;return 0>(c=a%b)===0>b?c:c+b}function dc(a,b,c){b-=c=c||0;a-=c;return a-Fb(a/b)*b+c}t("H.math.normalize",dc);function ec(a,b,c){return(a-=0)>c?c:a<b?b:a}
t("H.math.clamp",ec);function fc(a,b,c,d){(d-=0)||(d=0);return b<c?a>=b-d&&a<=c+d:a>=c-d&&a<=b+d}var gc={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};t("H.math.CoverType",gc);
function hc(a,b,c,d,e,f){var g=c.length,h=g,k=c[0],l=0,n=0,p=0;d=d/2||0;var q=f||2;f=q*(e?0:1)+1;for(var r=q-2;1!=l&&h>f;){h-=r;var v=c[--h];q=c[--h];var w=c[h?h-r-1:(g+(h-r-1))%g];var y=c[h?h-r-2:(g+(h-r-2))%g];if(q>=a-d&&q<=a+d&&v>=b-d&&v<=b+d||y>=a-d&&y<=a+d&&w>=b-d&&w<=b+d)l=1;else if(!l&&q===a)y===a&&(v<b&&w>b||v>b&&w<b)||(k<=a&&y>a||k>=a&&y<a)&&(v>=b?++n:++p),l=fc(b,v,w,d)&&Jb(Kb((a-y)*(v-w)-(b-w)*(q-y),2)/(Kb(q-y,2)+Kb(v-w,2)))<=d?2:0;else if(!l&&fc(a,q,y,d)){if(q<a&&y>a||q>a&&y<a)k=v+(a-q)/
(y-q)*(w-v),n+=k>b,p+=k<b;l=fc(b,v,w,d)&&Jb(Kb((a-y)*(v-w)-(b-w)*(q-y),2)/(Kb(q-y,2)+Kb(v-w,2)))<=d?2:0}k=q}!l&&e&&0!==p&&0!==n%2&&(l=3);return l}function ic(a,b){return hc(a.x,a.y,b,0,!0)!==gc.NONE}t("H.math.isPointInsidePolygon",ic);function jc(a){for(var b=a.length,c=new Float64Array(2*b),d=b&&db(a[0].x);b--;){var e=a[b],f=b<<1;c[f]=d?e.x:e[0];c[f+1]=d?e.y:e[1]}return c}t("H.math.flatten",jc);function kc(a,b,c){var d=ec(+a,-90,90);if(b&&E(d))throw new D(b,c,a);return d}function lc(a,b,c){var d=+a;if(-180>d||180<d)d=cc(d+180,360)-180;if(b&&E(d))throw new D(b,c,a);return d}function mc(a,b,c){var d;if(a!==B&&E(d=+a)&&b)throw new D(b,c,a);return d}function nc(a,b){return 0>a!==0>b&&180<Hb(b-a)}t("H.geo.isDBC",nc);function oc(){eb(this,oc)}t("H.geo.AbstractGeometry",oc);oc.prototype.getBoundingBox=oc.prototype.C;oc.prototype.equals=oc.prototype.ea;oc.prototype.ac="";oc.prototype.Ec="";oc.prototype.toString=function(){return this.sf([this.ac.toUpperCase()," "]).join("")};oc.prototype.toString=oc.prototype.toString;oc.prototype.ue=function(){return{type:this.Ec,coordinates:this.rf()}};oc.prototype.toGeoJSON=oc.prototype.ue;oc.prototype.R=function(){return{type:this.ac,coordinates:this.Od(),boundingBox:this.C().R()}};
oc.prototype.forWorkerMessage=oc.prototype.R;function pc(a,b,c){this.lat=kc(a,pc,0);this.lng=lc(b,pc,1);c!==B&&(this.alt=mc(c,pc,2))}u(pc,oc);t("H.geo.Point",pc);pc.prototype.ea=function(a){return this===a||!!a&&this.lat===a.lat&&this.lng===a.lng&&(this.alt||0)===(a.alt||0)};pc.prototype.equals=pc.prototype.ea;pc.prototype.lb=function(a){if(this===a||this.lat===a.lat&&this.lng===a.lng)a=0;else{var b=this.lat*Yb;var c=a.lat*Yb;a=1.274200158E7*Nb(Cb(1,Jb(Kb(Mb((b-c)/2),2)+Ob(b)*Ob(c)*Kb(Mb((this.lng*Yb-a.lng*Yb)/2),2))))}return a};
pc.prototype.distance=pc.prototype.lb;
pc.prototype.ho=function(a,b,c){var d;if(c){if(d=b/6371000.79){b=a*Yb;a=Yb*this.lat;var e=Mb(a);c=Mb(d);var f=Ob(d);d=Yb*this.lng;var g=Ob(a);a=Nb(g*Ob(b)*c+e*f);b=Rb(Mb(b)*g*c,f-e*Mb(a));b=(d+b+Tb)%(2*Tb)-Tb;b*=Zb;e=new pc(a*Zb,(b+540)%360-180)}return e||this}a=(a%360+360)%360;if(0===(a+90)%180)return a=this.lng+b/(6371000.79*Wb*Ob(this.lat*Yb))*(270===a?-360:360),new pc(this.lat,(a+540)%360-180);if(b/=6371000.79)a*=Yb,e=this.lat*Yb,c=this.lng*Yb,d=e+b*Ob(a),f=d-e,g=Ib(Pb(d/2+Vb)/Pb(e/2+Vb)),g=E(f/
g)?Ob(e):f/g,a=b*Mb(a)/g,Hb(d)>Ub&&(d=0<d?Tb-d:-(Tb+d)),d=new pc(d*Zb,((c+a+Xb+(Hb(e+f)>Ub?Tb:0))%Wb-Tb)*Zb);return d||this};pc.prototype.walk=pc.prototype.ho;pc.prototype.C=function(){return new F(this.lat,this.lng,this.lat,this.lng)};pc.prototype.getBoundingBox=pc.prototype.C;function qc(a,b,c){var d=ya(a)&&!(E(a.lat=kc(a.lat))||E(a.lng=lc(a.lng))||a.alt!==B&&E(a.alt=mc(a.alt)));if(!d&&b)throw new D(b,c,a);return d}pc.validate=qc;
function sc(a){if(!a)throw new D(sc,0,a);return new pc(a.lat,a.lng,a.alt)}pc.fromIPoint=sc;m=pc.prototype;m.ac="Point";m.sf=function(a){a.push("(",this.lng," ",this.lat,")");return a};m.Ec="Point";m.rf=function(){return[this.lng,this.lat,this.alt||0]};m.Od=function(){return[this.lat,this.lng,this.alt||0]};function tc(a,b,c,d,e,f){eb(this,tc);this.Lh=a||10;this.sj=null;this.Ui=d||0;this.Vi=e||0;this.qk=b||1;this.rk=c||1;this.zx=!!f;this.flush()}function uc(a){var b=a.sj;if(a.zx&&!b){var c=a.head;if(c.entries||c[0]||c[1]||c[2]||c[3])b=[c],b=vc([b,b,b,b],[c[6],c[7],c[4],c[5]]),a.sj=b}return b}
function vc(a,b){var c,d,e,f,g=0;for(c=3;0<=c;c--){var h=c+4;var k=0<c%3;var l=[];var n=b[c];var p=a[c];for(d=p.length;d--;){var q=p[d];if(e=q.entries)for(f=e.length;f--;){var r=e[f].Hf(c);if(k?r>n:r<n)n=r}for(f=4;f--;)(e=q[f])&&(k?e[h]>n:e[h]<n)&&l.push(e)}g+=l.length;b[c]=n;a[c]=l}g&&(b=vc(a,b));return b}function wc(a,b,c){var d,e;if(a.zx&&(d=a.sj))for(e=3;0<=e;e--){var f=b.Hf(e);if(e%3?f>=d[e]:f<=d[e])if(c)d[e]=f;else{a.sj=null;break}}}m=tc.prototype;
m.remove=function(a){var b,c,d,e=!1;a&&(b=a.node)&&b.cl===this&&(c=b.entries)&&0<=(d=c.indexOf(a))&&(c.splice(d,1),this.Bl(b),wc(this,a,!1),e=!0);return e};m.flush=function(){var a=new xc(B,NaN,this.Ui-this.qk,this.Vi-this.rk,this.Ui+this.qk,this.Vi+this.rk);a.cl=this;this.head=this.root=a;this.sj=null};m.gd=function(a){var b=this.head,c;if(a){var d=a;if(d!==b)for(b=d;d=d.parent;)if(d.entries||1<d.ib)b=d}else for(;!b.entries&&2>(c=b.ib);)if(c)b=d;else break;this.head=b};
m.pb=function(a,b,c,d,e,f){var g=[],h=this.head,k=this.root;a<=h[5]&&b<=h[6]&&(e?c>=h[7]:c>h[7])&&(f?d>=h[4]:d>h[4])&&yc(this,h,g,a,b,c,d,f||d>=k[6],e||c>=k[5]);return g};
function yc(a,b,c,d,e,f,g,h,k){var l=b.entries,n=b[7],p=b[4],q=b[5],r=b[6],v=b[8],w=b[9],y;if(l){var I=l.length;if(e>p||d>n||g<r||f<q)for(;I--;){n=l[I];p=n.Hf(3);q=n.Hf(0);r=n.Hf(1);var G=n.Hf(2);G>=e&&r>=d&&(q<g||h&&q==g)&&(p<f||k&&p==f)&&c.push(n)}else for(;I--;)c.push(l[I])}if(f>v||k&&f==v)e<w&&(y=b[1])&&yc(a,y,c,d,e,f,g,h,k),(g>w||h&&g==w)&&(y=b[3])&&yc(a,y,c,d,e,f,g,h,k);d<v&&(e<w&&(y=b[0])&&yc(a,y,c,d,e,f,g,h,k),(g>w||h&&g==w)&&(y=b[2])&&yc(a,y,c,d,e,f,g,h,k))}m.ve=ba(1);var zc=0;
function xc(a,b,c,d,e,f){this.xo=b;a&&(this.parent=a,this.cl=a.cl,b&1?(c=a[8],e=a[5]):(c=a[7],e=a[8]),b&2?(d=a[9],f=a[6]):(d=a[4],f=a[9]));this[7]=c;this[5]=e;this[8]=(c+e)/2;this[4]=d;this[6]=f;this[9]=(d+f)/2}m=xc.prototype;m.ib=0;m.oh=function(a){return this[a]||(++this.ib,this[a]=new xc(this,a))};m.removeChild=function(a){var b=a.xo;this[b]===a&&(delete this[b],delete a.parent,--this.ib)};m.ve=ba(0);m.Lg=function(a){(this.entries||(this.entries=[])).push(a);a.node=this};
function Ac(a,b,c,d,e){var f=a[5],g=a[6];return a[7]<=b&&a[4]<=c&&(f>d||f===d&&f===a.cl.root[5])&&(g>e||g===e&&g===a.cl.root[6])};function Bc(a,b,c,d,e,f){Bc.g.constructor.apply(this,arguments)}u(Bc,tc);Bc.prototype.Bl=function(a){for(var b,c,d=this.head;a;){if(!(b=a.entries)||!b.length)if(b&&delete a.entries,!a.ib&&(c=a.parent)){c.removeChild(a);d===a&&(d=c);a=c;continue}break}this.head!==d&&(this.head=d,this.gd())};function Cc(a,b,c,d,e){if(Ac(a.root,b,c,d,e))return a.Ub(a.root,b,c,d,e,a.Lh);throw Error("Coordinates out of bounds");}
Bc.prototype.Hu=function(a,b,c,d){if(a>c){var e=a;a=c;c=e}b>d&&(e=b,b=d,d=e);return Cc(this,a,b,c,d)};Bc.prototype.Wd=function(a,b){return Cc(this,a,b,a,b)};Bc.prototype.Ub=function(a,b,c,d,e,f){var g=a[8],h=a[9],k=0,l=0;f&&(d<g||(k=+(b>=g)))&&(e<h||(l=+(c>=h)))?b=this.Ub(a.oh(k|l<<1),b,c,d,e,f-1):(a.Lg(b=new Dc(b,c,d,e)),wc(this,b,!0),this.gd(a));return b};function Dc(a,b,c,d){this.id=zc++;this[0]=b;this[1]=c;this[2]=d;this[3]=a}Dc.prototype.Hf=function(a){return this[a]};function F(a,b,c,d){Ec(this,kc(a,F,0),lc(b,F,1),kc(c,F,2),lc(d,F,3))}u(F,oc);t("H.geo.Rect",F);F.prototype.ac="Polygon";F.prototype.sf=function(a){var b=this.ga,c=this.X,d=this.ha,e=this.da;a.push("(","(",c," ",b,",",e," ",b,",",e," ",d,",",c," ",d,",",c," ",b,")",")");return a};F.prototype.ea=function(a){var b=this===a;!b&&C(a,F)&&(b=this.ga===a.ga&&this.X===a.X&&this.ha===a.ha&&this.da===a.da);return b};F.prototype.equals=F.prototype.ea;
F.prototype.clone=function(){return new F(this.ga,this.X,this.ha,this.da)};F.prototype.clone=F.prototype.clone;function Ec(a,b,c,d,e){a.X=c;a.da=e;b<d&&(c=b,b=d,d=c);a.ga=b;a.ha=d;a.al=a.Ni=a.xf=null;return a}F.prototype.Kc=function(){this.al||(this.al=new pc(this.ga,this.X));return this.al};F.prototype.getTopLeft=F.prototype.Kc;F.prototype.Gc=function(){this.Ni||(this.Ni=new pc(this.ha,this.da));return this.Ni};F.prototype.getBottomRight=F.prototype.Gc;F.prototype.xA=function(){return this.ga};
F.prototype.getTop=F.prototype.xA;F.prototype.jz=function(){return this.ha};F.prototype.getBottom=F.prototype.jz;F.prototype.Sz=function(){return this.X};F.prototype.getLeft=F.prototype.Sz;F.prototype.nA=function(){return this.da};F.prototype.getRight=F.prototype.nA;F.prototype.wb=function(){this.xf||(this.xf=new pc(this.ha+(this.ga-this.ha)/2,Fc(this.X,this.nc())));return this.xf};F.prototype.getCenter=F.prototype.wb;F.prototype.nc=function(){return Gc(this.X,this.da)};F.prototype.getWidth=F.prototype.nc;
F.prototype.th=function(){return this.ga-this.ha};F.prototype.getHeight=F.prototype.th;F.prototype.oc=function(){return this.X>this.da};F.prototype.isCDB=F.prototype.oc;F.prototype.Bm=function(){return!this.nc()&&!this.th()};F.prototype.isEmpty=F.prototype.Bm;F.prototype.C=function(){return new F(this.ga,this.X,this.ha,this.da)};F.prototype.getBoundingBox=F.prototype.C;
F.prototype.Hl=function(a,b,c){var d=this.wb();c||(a=kc(a,this.Hl,0),b=lc(b,this.Hl,1));b=this.Ze(a,b,c);a=b.wb();return a.lat===d.lat&&a.lng===d.lng&&this.th()===b.th()&&this.nc()===b.nc()};F.prototype.containsLatLng=F.prototype.Hl;F.prototype.zf=function(a,b){b||qc(a,this.zf,0);return this.Hl(a.lat,a.lng,b)};F.prototype.containsPoint=F.prototype.zf;
F.prototype.Qo=function(a,b){var c=this.wb();if(!b&&!C(a,F))throw new D(this.Qo,0,a);b=this.wd(a,b);a=b.wb();return a.lat===c.lat&&a.lng===c.lng&&this.th()===b.th()&&this.nc()===b.nc()};F.prototype.containsRect=F.prototype.Qo;F.prototype.Ze=function(a,b,c,d){if(!c){if(E(a=kc(a)))throw new D(this.Ze,0,a);if(E(b=lc(b)))throw new D(this.Ze,1,b);}return Hc(this.ga,this.X,this.ha,this.da,a,b,a,b,d)};F.prototype.mergeLatLng=F.prototype.Ze;
F.prototype.rv=function(a,b,c){b||qc(a,this.rv,0);return this.Ze(a.lat,a.lng,b,c)};F.prototype.mergePoint=F.prototype.rv;F.prototype.wd=function(a,b,c){if(!b&&!C(a,F))throw new D(this.wd,0,a);return Hc(this.ga,this.X,this.ha,this.da,a.ga,a.X,a.ha,a.da,c)};F.prototype.mergeRect=F.prototype.wd;F.prototype.$d=function(a,b,c,d,e,f){e||(a=kc(a,this.$d,0),b=lc(b,this.$d,1),c=kc(c,this.$d,2),d=lc(d,this.$d,3));return Hc(this.ga,this.X,this.ha,this.da,a,b,c,d,f)};F.prototype.mergeTopLeftBottomRight=F.prototype.$d;
F.prototype.Pf=function(a,b){var c=this.X<=this.da,d=a.X<=a.da,e=this.X<a.da,f=a.X<this.da;if(!b&&!C(a,F))throw new D(this.Pf,0,a);return this.ha<=a.ga&&a.ha<=this.ga&&(!c&&(!d||e||f)||!d&&(e||f)||e&&f)};F.prototype.intersects=F.prototype.Pf;function Gc(a,b){a=b-a;return a+(0>a?360:0)}function Fc(a,b){a+=b/2;return a-(180<a?360:0)}
function Hc(a,b,c,d,e,f,g,h,k){c=Cb(c,g);a=Db(a,e);e=Gc(b,d);var l=Fc(b,e);g=Gc(f,h);var n=Fc(f,g)-l;n+=0>n-1E-6?360:0;if(180>n-1E-6){l=b;var p=h}else n=360-n,l=f,p=d;n=n+e/2+g/2;360<=n+5E-7?(l=-180,p=180):n-5E-7<e?(l=b,p=d):n-5E-7<g&&(l=f,p=h);return k?Ec(k,a,l,c,p):new F(a,l,c,p)}F.merge=Hc;function Ic(a,b,c){c||(qc(a,Ic,0),qc(b,Ic,1));return new F(a.lat,a.lng,b.lat,b.lng)}F.fromPoints=Ic;
function Jc(a,b){var c=1,d=a.length,e=null;if(!Ba(a))throw new D(Jc,0,a);if(0<d){var f=a[0];for(e=Ic(f,f,b);c<d;c++)f=a[c],e.Ze(f.lat,f.lng,b,e)}return e}F.coverPoints=Jc;function Kc(a,b){var c=3,d=a.length,e;if(!(b||a&&null!=a.length))throw new D(Kc,0,a);if(0<d)for(e=new F(a[0],a[1],a[0],a[1]);c<d;c+=3)e.Ze(a[c],a[c+1],b,e);return e}F.coverLatLngAlts=Kc;
function Lc(a,b){var c=1,d=a.length,e;if(b&&(!a||null==a.length))throw new D(Lc,0,a);if(0<d)for(e=new F(a[0].ga,a[0].X,a[0].ha,a[0].da);c<d;c++)e.wd(a[c],b,e);return e}F.coverRects=Lc;
F.prototype.Aw=function(a,b){var c=this.X,d=this.ga,e=this.da,f=this.ha,g=this.wb().lng;qc(a,this.Aw,0);var h=a.lat-f-(d-f)/2;var k=a.lng-g;k=180<k||-180>k?-(g+a.lng):k;a=c+(0>k?2*k:0);a=-180>a?360+a:a;e+=0<k?2*k:0;e=180<e?e-360:e;d=0<h?d+2*h:d;90<=d&&(d=90);f=0>h?f+2*h:f;-90>=f&&(f=-90);return b?Ec(b,d,a,f,e):new F(d,a,f,e)};F.prototype.resizeToCenter=F.prototype.Aw;F.prototype.Ec="Polygon";
F.prototype.rf=function(){return[[this.X,this.ga,0],[this.da,this.ga,0],[this.da,this.ha,0],[this.X,this.ha,0],[this.X,this.ga,0]]};F.prototype.R=function(){return this.Od()};F.prototype.Od=function(){return[this.ga,this.X,this.ha,this.da]};function Mc(a){this.we=new Bc(+a||10,180,90,0,0,!0);this.Al=[];this.fq=!1;this.wf=this.Hg=this.I=null}t("H.geo.QuadTree",Mc);m=Mc.prototype;m.jc=0;m.oc=function(){return this.fq};
m.C=function(){var a,b;if(!this.I){var c=[];!this.Hg&&(a=uc(this.we))&&(this.Hg=new F(-a[0],a[3],-a[2],a[1]));(b=this.Hg)&&c.push(b);var d,e,f;if(!this.wf&&(f=(e=this.Al).length)){a=90;var g=360;var h=-90;for(d=0;f--;){var k=e[f];a=Cb(a,k[0]);g=Cb(g,k[3]);h=Db(h,k[2]);d=Db(d,k[1])}this.wf=new F(-a,g,-h,d-360)}(b=this.wf)&&c.push(b);if(b=c[0])c[1]&&(b=b.wd(c[1],!0)),this.I=b}return this.I};
m.Ub=function(a,b,c,d,e){e?(e=new Dc(d,-a,b+360,-c),this.Al.push(e),this.fq=!0,this.wf&&this.wf.$d(a,b,c,d,!0,this.wf)):(e=Cc(this.we,b,-a,d,-c),this.Hg&&this.Hg.$d(a,b,c,d,!0,this.Hg));++this.jc;this.I=null;return e};m.Wd=function(a){var b=a.lng;a=a.lat;return this.Ub(a,b,a,b,!1)};m.Fu=function(a){var b=a.Kc(),c=a.Gc();return(a=a.oc())?this.Ub(b.lat,c.lng,c.lat,b.lng,a):this.Ub(b.lat,b.lng,c.lat,c.lng,a)};Mc.prototype.insertBoundingBox=Mc.prototype.Fu;
Mc.prototype.Hu=function(a,b,c,d){if(b<d)var e=b;else e=d,d=b;a<c?b=c:(b=a,a=c);return this.Ub(b,e,a,d,180<d-e)};Mc.prototype.remove=function(a){var b;if(a.node){var c=this.we.remove(a);this.Hg=null}else if(a=(b=this.Al).indexOf(a),c=0<=a)b.splice(a,1),this.fq=0<b.length,this.wf=null;c&&(--this.jc,this.I=null);return c};Mc.prototype.remove=Mc.prototype.remove;
function Nc(a,b,c,d,e,f,g){a=a.Al;var h=a.length,k=[],l;if(h){var n=c+360;for(l=e+360;h--;){var p=a[h];Oc(p,b,c,d,e,f,g)?k.push(p):Oc(p,b,n,d,l,f,g)&&k.push(p)}}return k}function Oc(a,b,c,d,e,f,g){var h=a[3],k=a[0],l=a[1];a=a[2];return(f?k<=d:k<d)&&(g?h<=e:h<e)&&a>=b&&l>=c}function Pc(a,b){var c,d,e;if(c=b.length){var f=a.length;for(d={};f--;)d[a[f].id]=1;for(;c--;)(e=b[c]).id in d||a.push(e)}}
Mc.prototype.ym=function(a,b,c){var d=this.we,e=a.Kc(),f=a.Gc(),g=-e.lat;e=e.lng;var h=-f.lat;f=f.lng;!b&&g===h||!c&&e===f?a=[]:a.oc()?(a=d.pb(-180,g,f,h,c,b),Pc(a,d.pb(e,g,180,h,!1,b)),Pc(a,Nc(this,g,f,h,e+360,b,c))):(a=d.pb(e,g,f,h,c,b),Pc(a,Nc(this,g,e,h,f,b,c)));return a};Mc.prototype.intersectBoundingBox=Mc.prototype.ym;var Qc=[62,-1,-1,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,63,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],Rc="undefined"!==typeof BigInt?BigInt:Number;
function Sc(a){var b=Rc(0),c=Rc(0),d=[];a.split("").forEach(function(e){e=Rc(Qc[e.charCodeAt(0)-45]);b|=(e&Rc(31))<<c;(e&Rc(32))===Rc(0)?(d.push(b),b=Rc(0),c=Rc(0)):c+=Rc(5)});if(0<c)throw Error("Invalid encoding");return d}function Tc(a){a&Rc(1)&&(a=~a);a>>=Rc(1);return+a.toString()}
function Uc(a){var b=void 0===a.precision?5:a.precision,c=void 0===a.Xk?0:a.Xk,d=void 0===a.Yk?0:a.Yk;a=a.fr;var e=Math.pow(10,b),f=Math.pow(10,d);if(0>b||15<b)throw Error("precision out of range. Should be between 0 and 15");if(0>d||15<d)throw Error("thirdDimPrecision out of range. Should be between 0 and 15");if(0>c||7<c||4===c||5===c)throw Error("thirdDim should be between 0, 1, 2, 3, 6 or 7");b=Vc(1)+Vc(d<<7|c<<4|b);var g=[],h=Rc(0),k=Rc(0),l=Rc(0);a.forEach(function(n){var p=Rc(Math.round(n[0]*
e));g.push(Wc(p-h));h=p;p=Rc(Math.round(n[1]*e));g.push(Wc(p-k));k=p;c&&(n=Rc(Math.round(n[2]*f)),g.push(Wc(n-l)),l=n)});return[].concat(b instanceof Array?b:fa(ea(b)),g instanceof Array?g:fa(ea(g))).join("")}function Vc(a){var b="";for(a=Rc(a);31<a;)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[a&Rc(31)|Rc(32)],a>>=Rc(5);return b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[a]}function Wc(a){a=Rc(a);var b=0>a;a<<=Rc(1);b&&(a=~a);return Vc(a)}
function Xc(a){return Uc({fr:a.polyline,precision:a.precision,Xk:a.thirdDim,Yk:a.thirdDimPrecision})}t("H.util.flexiblePolyline.encode",Xc);
function Yc(a){a=Sc(a);if(1!==+a[0].toString())throw Error("Invalid format version");var b=+a[1].toString();b={precision:b&15,Xk:b>>4&7,Yk:b>>7&15};for(var c=Math.pow(10,b.precision),d=Math.pow(10,b.Yk),e=b.Xk,f=0,g=0,h=0,k=[],l=2;l<a.length;){var n=Tc(a[l+1])/c;f+=Tc(a[l])/c;g+=n;e?(h+=Tc(a[l+2])/d,k.push([f,g,h]),l+=3):(k.push([f,g]),l+=2)}if(l!==a.length)throw Error("Invalid encoding. Premature ending reached");a=Object.assign({},b,{fr:k});return{polyline:a.fr,precision:a.precision,thirdDim:a.Xk,
thirdDimPrecision:a.Yk}}t("H.util.flexiblePolyline.decode",Yc);function Zc(a,b){this.eB=100;this.yy=a;this.ug=b;this.Um=0;this.sm=null}Zc.prototype.get=function(){if(0<this.Um){this.Um--;var a=this.sm;this.sm=a.next;a.next=null}else a=this.yy();return a};Zc.prototype.put=function(a){this.ug(a);this.Um<this.eB&&(this.Um++,a.next=this.sm,this.sm=a)};function $c(a){wa.setTimeout(function(){throw a;},0)};function ad(a,b){return-1!=a.indexOf(b)};var bd;a:{var cd=wa.navigator;if(cd){var dd=cd.userAgent;if(dd){bd=dd;break a}}bd=""};function ed(a){ed[" "](a);return a}ed[" "]=za;var fd=ad(bd,"Gecko")&&!(ad(bd.toLowerCase(),"webkit")&&!ad(bd,"Edge"))&&!(ad(bd,"Trident")||ad(bd,"MSIE"))&&!ad(bd,"Edge"),gd=ad(bd.toLowerCase(),"webkit")&&!ad(bd,"Edge");function hd(){var a=document;var b="IFRAME";"application/xhtml+xml"===a.contentType&&(b=b.toLowerCase());return a.createElement(b)};var id;
function jd(){var a=wa.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!ad(bd,"Presto")&&(a=function(){var e=hd();e.style.display="none";document.documentElement.appendChild(e);var f=e.contentWindow;e=f.document;e.open();e.close();var g="callImmediate"+Math.random(),h="file:"==f.location.protocol?"*":f.location.protocol+"//"+f.location.host;e=Ia(function(k){if(("*"==h||k.origin==h)&&k.data==g)this.port1.onmessage()},this);f.addEventListener("message",e,
!1);this.port1={};this.port2={postMessage:function(){f.postMessage(g,h)}}});if("undefined"!==typeof a&&!ad(bd,"Trident")&&!ad(bd,"MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var e=c.ht;c.ht=null;e()}};return function(e){d.next={ht:e};d=d.next;b.port2.postMessage(0)}}return function(e){wa.setTimeout(e,0)}};function kd(){this.io=this.Ci=null}kd.prototype.add=function(a,b){var c=ld.get();c.set(a,b);this.io?this.io.next=c:this.Ci=c;this.io=c};kd.prototype.remove=function(){var a=null;this.Ci&&(a=this.Ci,this.Ci=this.Ci.next,this.Ci||(this.io=null),a.next=null);return a};var ld=new Zc(function(){return new md},function(a){return a.reset()});function md(){this.next=this.scope=this.op=null}md.prototype.set=function(a,b){this.op=a;this.scope=b;this.next=null};
md.prototype.reset=function(){this.next=this.scope=this.op=null};function nd(a,b){od||qd();rd||(od(),rd=!0);sd.add(a,b)}var od;function qd(){if(wa.Promise&&wa.Promise.resolve){var a=wa.Promise.resolve(void 0);od=function(){a.then(td)}}else od=function(){var b=td;"function"!==typeof wa.setImmediate||wa.Window&&wa.Window.prototype&&!ad(bd,"Edge")&&wa.Window.prototype.setImmediate==wa.setImmediate?(id||(id=jd()),id(b)):wa.setImmediate(b)}}var rd=!1,sd=new kd;function td(){for(var a;a=sd.remove();){try{a.op.call(a.scope)}catch(b){$c(b)}ld.put(a)}rd=!1};function ud(a){this.o=vd;this.lf=void 0;this.Ug=this.Ge=this.ig=null;this.mm=this.jp=!1;if(a!=za)try{var b=this;a.call(void 0,function(c){wd(b,xd,c)},function(c){wd(b,yd,c)})}catch(c){wd(this,yd,c)}}var vd=0,xd=2,yd=3;function Ad(){this.next=this.context=this.Qh=this.ck=this.yf=null;this.sl=!1}Ad.prototype.reset=function(){this.context=this.Qh=this.ck=this.yf=null;this.sl=!1};var Bd=new Zc(function(){return new Ad},function(a){a.reset()});
function Cd(a,b,c){var d=Bd.get();d.ck=a;d.Qh=b;d.context=c;return d}function Dd(a){if(a instanceof ud)return a;var b=new ud(za);wd(b,xd,a);return b}function Ed(a){return new ud(function(b,c){c(a)})}function Fd(){var a,b,c=new ud(function(d,e){a=d;b=e});return new Gd(c,a,b)}ud.prototype.then=function(a,b,c){return Hd(this,"function"===typeof a?a:null,"function"===typeof b?b:null,c)};ud.prototype.$goog_Thenable=!0;
ud.prototype.cancel=function(a){if(this.o==vd){var b=new Id(a);nd(function(){Jd(this,b)},this)}};function Jd(a,b){if(a.o==vd)if(a.ig){var c=a.ig;if(c.Ge){for(var d=0,e=null,f=null,g=c.Ge;g&&(g.sl||(d++,g.yf==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.o==vd&&1==d?Jd(c,b):(f?(d=f,d.next==c.Ug&&(c.Ug=d),d.next=d.next.next):Kd(c),Ld(c,e,yd,b)))}a.ig=null}else wd(a,yd,b)}function Md(a,b){a.Ge||a.o!=xd&&a.o!=yd||Nd(a);a.Ug?a.Ug.next=b:a.Ge=b;a.Ug=b}
function Hd(a,b,c,d){var e=Cd(null,null,null);e.yf=new ud(function(f,g){e.ck=b?function(h){try{var k=b.call(d,h);f(k)}catch(l){g(l)}}:f;e.Qh=c?function(h){try{var k=c.call(d,h);void 0===k&&h instanceof Id?g(h):f(k)}catch(l){g(l)}}:g});e.yf.ig=a;Md(a,e);return e.yf}ud.prototype.uD=function(a){this.o=vd;wd(this,xd,a)};ud.prototype.vD=function(a){this.o=vd;wd(this,yd,a)};
function wd(a,b,c){if(a.o==vd){a===c&&(b=yd,c=new TypeError("Promise cannot resolve to itself"));a.o=1;a:{var d=c,e=a.uD,f=a.vD;if(d instanceof ud){Md(d,Cd(e||za,f||null,a));var g=!0}else{if(d)try{var h=!!d.$goog_Thenable}catch(l){h=!1}else h=!1;if(h)d.then(e,f,a),g=!0;else{if(ya(d))try{var k=d.then;if("function"===typeof k){Od(d,k,e,f,a);g=!0;break a}}catch(l){f.call(a,l);g=!0;break a}g=!1}}}g||(a.lf=c,a.o=b,a.ig=null,Nd(a),b!=yd||c instanceof Id||Pd(a,c))}}
function Od(a,b,c,d,e){function f(k){h||(h=!0,d.call(e,k))}function g(k){h||(h=!0,c.call(e,k))}var h=!1;try{b.call(a,g,f)}catch(k){f(k)}}function Nd(a){a.jp||(a.jp=!0,nd(a.Sy,a))}function Kd(a){var b=null;a.Ge&&(b=a.Ge,a.Ge=b.next,b.next=null);a.Ge||(a.Ug=null);return b}ud.prototype.Sy=function(){for(var a;a=Kd(this);)Ld(this,a,this.o,this.lf);this.jp=!1};
function Ld(a,b,c,d){if(c==yd&&b.Qh&&!b.sl)for(;a&&a.mm;a=a.ig)a.mm=!1;if(b.yf)b.yf.ig=null,Qd(b,c,d);else try{b.sl?b.ck.call(b.context):Qd(b,c,d)}catch(e){Rd.call(null,e)}Bd.put(b)}function Qd(a,b,c){b==xd?a.ck.call(a.context,c):a.Qh&&a.Qh.call(a.context,c)}function Pd(a,b){a.mm=!0;nd(function(){a.mm&&Rd.call(null,b)})}var Rd=$c;function Id(a){Ua.call(this,a)}u(Id,Ua);Id.prototype.name="cancel";function Gd(a,b,c){this.promise=a;this.resolve=b;this.reject=c};function Sd(){}t("H.util.ICancelable",Sd);Sd.prototype.cancel=function(){};Sd.prototype.cancel=Sd.prototype.cancel;function Td(a,b,c){this.type=a;this.data=b;this.zr=Fd();this.resolve=A(this.resolve,this);this.reject=A(this.reject,this);this.priority=Ud;c!==B&&(this.priority=c);this.Bp().add(this)}var Ud=1,Vd={ED:0,HD:Ud,CD:2};m=Td.prototype;m.then=function(a,b,c){return this.zr.promise.then(a,b,c)};m.resolve=function(a){this.state=3;this.zr.resolve(a)};m.reject=function(a){this.state=5;this.zr.reject(a)};m.state=0;m.cancel=function(){3>this.state&&(this.Si(),this.Bp().remove(this),this.state=4)};
Td.prototype.cancel=Td.prototype.cancel;function Wd(a){var b;this.og={};for(b in Vd)this.og[Vd[b]]=[];this.yk=a;this.yk.addEventListener("allocatable",A(this.Ot,this))}t("H.util.JobManager",Wd);var Xd=Object.keys(Vd).map(function(a){return Vd[a]}).sort().reverse();Wd.prototype.add=function(a){C(a,Td,this.add,0);this.og[a.priority].push(a);this.Ot()};Wd.prototype.contains=function(a){return-1<this.og[a.priority].indexOf(a)};
Wd.prototype.remove=function(a){var b=a.priority,c=this.og[b].indexOf(a);if(-1<c)return this.og[b].splice(c,1),!0;a.zs&&this.yk.Sl(a.zs);return!1};Wd.prototype.Ot=function(){Xd.forEach(function(a){this.og[a]=this.og[a].filter(function(b){var c;if((c=this.yk.zo(b))!==z){var d=A(this.yk.Sl,this.yk,c,b);b.zs=c;b.then(d,d);b.state=b.Nt(c)?1:5}else return!0},this)},this)};function Yd(a){a&&"function"==typeof a.u&&a.u()};function Zd(){0!=$d&&(ae[Ca(this)]=this);this.fh=this.fh;this.be=this.be}var $d=0,ae={};Zd.prototype.fh=!1;Zd.prototype.u=function(){if(!this.fh&&(this.fh=!0,this.i(),0!=$d)){var a=Ca(this);if(0!=$d&&this.be&&0<this.be.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete ae[a]}};
Zd.prototype.bc=function(a,b){this.fh?void 0!==b?a.call(b):a():(this.be||(this.be=[]),this.be.push(void 0!==b?Ia(a,b):a))};Zd.prototype.i=function(){if(this.be)for(;this.be.length;)this.be.shift()()};var be=0;function ce(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.om=e;this.key=++be;this.fi=this.yl=!1}function de(a){a.fi=!0;a.listener=null;a.proxy=null;a.src=null;a.om=null};function ee(a){this.src=a;this.qb={};this.dl=0}m=ee.prototype;m.add=function(a,b,c,d,e){var f=a.toString();a=this.qb[f];a||(a=this.qb[f]=[],this.dl++);var g=fe(a,b,d,e);-1<g?(b=a[g],c||(b.yl=!1)):(b=new ce(b,this.src,f,!!d,e),b.yl=c,a.push(b));return b};m.remove=function(a,b,c,d){a=a.toString();if(!(a in this.qb))return!1;var e=this.qb[a];b=fe(e,b,c,d);return-1<b?(de(e[b]),Array.prototype.splice.call(e,b,1),0==e.length&&(delete this.qb[a],this.dl--),!0):!1};
function ge(a,b){var c=b.type;if(!(c in a.qb))return!1;var d=a.qb[c],e=Va(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(de(b),0==a.qb[c].length&&(delete a.qb[c],a.dl--));return f}m.ja=function(a){a=a&&a.toString();var b=0,c;for(c in this.qb)if(!a||c==a){for(var d=this.qb[c],e=0;e<d.length;e++)++b,de(d[e]);delete this.qb[c];this.dl--}return b};m.Fp=function(a,b,c,d){a=this.qb[a.toString()];var e=-1;a&&(e=fe(a,b,c,d));return-1<e?a[e]:null};
m.Xp=function(a,b){var c=void 0!==a,d=c?a.toString():"",e=void 0!==b;return Pa(this.qb,function(f){for(var g=0;g<f.length;++g)if(!(c&&f[g].type!=d||e&&f[g].capture!=b))return!0;return!1})};function fe(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.fi&&f.listener==b&&f.capture==!!c&&f.om==d)return e}return-1};var he=function(){if(!wa.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{wa.addEventListener("test",za,b),wa.removeEventListener("test",za,b)}catch(c){}return a}();function ie(a,b){this.type=a;this.currentTarget=this.target=b;this.defaultPrevented=this.mk=!1}ie.prototype.stopPropagation=function(){this.mk=!0};ie.prototype.preventDefault=function(){this.defaultPrevented=!0};function je(a,b){ie.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.key="";this.charCode=this.keyCode=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.state=null;this.pointerId=0;this.pointerType="";this.pj=null;a&&this.xm(a,b)}u(je,ie);var ke={2:"touch",3:"pen",4:"mouse"};
je.prototype.xm=function(a,b){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(fd){a:{try{ed(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=
d.screenY||0):(this.offsetX=gd||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=gd||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.keyCode=a.keyCode||0;this.key=a.key||"";this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.pointerId=
a.pointerId||0;this.pointerType="string"===typeof a.pointerType?a.pointerType:ke[a.pointerType]||"";this.state=a.state;this.pj=a;a.defaultPrevented&&je.g.preventDefault.call(this)};je.prototype.stopPropagation=function(){je.g.stopPropagation.call(this);this.pj.stopPropagation?this.pj.stopPropagation():this.pj.cancelBubble=!0};je.prototype.preventDefault=function(){je.g.preventDefault.call(this);var a=this.pj;a.preventDefault?a.preventDefault():a.returnValue=!1};var le="closure_listenable_"+(1E6*Math.random()|0);function me(a){return!(!a||!a[le])};var ne="closure_lm_"+(1E6*Math.random()|0),oe={},pe=0;function qe(a,b,c,d,e){if(d&&d.once)return re(a,b,c,d,e);if(Array.isArray(b)){for(var f=0;f<b.length;f++)qe(a,b[f],c,d,e);return null}c=se(c);return me(a)?a.nd.add(String(b),c,!1,ya(d)?!!d.capture:!!d,e):te(a,b,c,!1,d,e)}
function te(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=ya(e)?!!e.capture:!!e,h=ue(a);h||(a[ne]=h=new ee(a));c=h.add(b,c,d,g,f);if(c.proxy)return c;d=ve();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)he||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(we(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");pe++;return c}
function ve(){function a(c){return b.call(a.src,a.listener,c)}var b=xe;return a}function re(a,b,c,d,e){if(Array.isArray(b)){for(var f=0;f<b.length;f++)re(a,b[f],c,d,e);return null}c=se(c);return me(a)?a.nd.add(String(b),c,!0,ya(d)?!!d.capture:!!d,e):te(a,b,c,!0,d,e)}
function ye(a,b,c,d,e){if(Array.isArray(b)){for(var f=0;f<b.length;f++)ye(a,b[f],c,d,e);return null}d=ya(d)?!!d.capture:!!d;c=se(c);if(me(a))return a.nd.remove(String(b),c,d,e);if(!a)return!1;if(a=ue(a))if(b=a.Fp(b,c,d,e))return ze(b);return!1}
function ze(a){if("number"===typeof a||!a||a.fi)return!1;var b=a.src;if(me(b))return ge(b.nd,a);var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(we(c),d):b.addListener&&b.removeListener&&b.removeListener(d);pe--;(c=ue(b))?(ge(c,a),0==c.dl&&(c.src=null,b[ne]=null)):de(a);return!0}function we(a){return a in oe?oe[a]:oe[a]="on"+a}function Ae(a,b){var c=a.listener,d=a.om||a.src;a.yl&&ze(a);return c.call(d,b)}
function xe(a,b){return a.fi?!0:Ae(a,new je(b,this))}function ue(a){a=a[ne];return a instanceof ee?a:null}var Be="__closure_events_fn_"+(1E9*Math.random()>>>0);function se(a){if("function"===typeof a)return a;a[Be]||(a[Be]=function(b){return a.handleEvent(b)});return a[Be]};function J(){Zd.call(this);this.nd=new ee(this);this.Wx=this;this.$q=null}u(J,Zd);J.prototype[le]=!0;m=J.prototype;m.Jc=function(){return this.$q};m.fa=function(a){this.$q=a};m.addEventListener=function(a,b,c,d){qe(this,a,b,c,d)};m.removeEventListener=function(a,b,c,d){ye(this,a,b,c,d)};
m.dispatchEvent=function(a){var b,c=this.Jc();if(c)for(b=[];c;c=c.Jc())b.push(c);c=this.Wx;var d=a.type||a;if("string"===typeof a)a=new ie(a,c);else if(a instanceof ie)a.target=a.target||c;else{var e=a;a=new ie(d,c);Ta(a,e)}e=!0;if(b)for(var f=b.length-1;!a.mk&&0<=f;f--){var g=a.currentTarget=b[f];e=g.Ef(d,!0,a)&&e}a.mk||(g=a.currentTarget=c,e=g.Ef(d,!0,a)&&e,a.mk||(e=g.Ef(d,!1,a)&&e));if(b)for(f=0;!a.mk&&f<b.length;f++)g=a.currentTarget=b[f],e=g.Ef(d,!1,a)&&e;return e};
m.i=function(){J.g.i.call(this);this.nd&&this.nd.ja(void 0);this.$q=null};m.Ef=function(a,b,c){a=this.nd.qb[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.fi&&f.capture==b){var g=f.listener,h=f.om||f.src;f.yl&&ge(this.nd,f);d=!1!==g.call(h,c)&&d}}return d&&!c.defaultPrevented};m.Fp=function(a,b,c,d){return this.nd.Fp(String(a),b,c,d)};m.Xp=function(a,b){return this.nd.Xp(void 0!==a?String(a):void 0,b)};t("H.util.EventTarget",J);J.prototype.fa=J.prototype.fa;J.prototype.setParentEventTarget=J.prototype.fa;J.prototype.Jc=J.prototype.Jc;J.prototype.getParentEventTarget=J.prototype.Jc;J.prototype.addEventListener=J.prototype.addEventListener;J.prototype.addEventListener=J.prototype.addEventListener;J.prototype.removeEventListener=J.prototype.removeEventListener;J.prototype.removeEventListener=J.prototype.removeEventListener;J.prototype.dispatchEvent=J.prototype.dispatchEvent;
J.prototype.dispatchEvent=J.prototype.dispatchEvent;J.prototype.u=J.prototype.u;J.prototype.dispose=J.prototype.u;J.prototype.bc=J.prototype.bc;J.prototype.addOnDisposeCallback=J.prototype.bc;J.prototype.Wy=J.prototype.Ef;
J.prototype.Ef=function(a,b,c){var d,e,f=!0;var g=c[c.currentTarget===c.target?"AT_TARGET":b?"CAPTURING_PHASE":(d=!0,"BUBBLING_PHASE")];if(!d||"pointerenter"!==(e=c.type)&&"pointerleave"!==e)c.eventPhase=g,f=J.prototype.Wy.apply(this,arguments),d&&this.Jc&&null===this.Jc()&&delete c.eventPhase;return f};J.prototype.Pw=function(a){for(var b,c=this;c&&(b=c.Jc())&&b!==a;)c=b;b||c.fa(a)};J.prototype.setRootParentEventTarget=J.prototype.Pw;t("H.util.Event",ie);ie.prototype.stopPropagation=ie.prototype.stopPropagation;ie.prototype.stopPropagation=ie.prototype.stopPropagation;ie.prototype.CAPTURING_PHASE=1;ie.prototype.CAPTURING_PHASE=ie.prototype.CAPTURING_PHASE;ie.prototype.AT_TARGET=2;ie.prototype.AT_TARGET=ie.prototype.AT_TARGET;ie.prototype.BUBBLING_PHASE=3;ie.prototype.BUBBLING_PHASE=ie.prototype.BUBBLING_PHASE;ie.prototype.eventPhase=0;ie.prototype.eventPhase=ie.prototype.eventPhase;function Ce(a){a=a||{};var b=a.callback;this.Vb=a.label;ab(b)&&(this.callback=b);this.Db=!!a.disabled;Ce.g.constructor.call(this)}u(Ce,J);t("H.util.ContextItem",Ce);Ce.prototype.Cp=function(){return this.Vb};Ce.prototype.getLabel=Ce.prototype.Cp;Ce.prototype.se=function(a){this.Vb!==a&&(this.Vb=a,this.dispatchEvent("update"));return this};Ce.prototype.setLabel=Ce.prototype.se;Ce.prototype.hq=function(){return this.Db};Ce.prototype.isDisabled=Ce.prototype.hq;
Ce.prototype.wa=function(a){a!==this.Db&&(this.Db=a,this.dispatchEvent("update"));return this};Ce.prototype.setDisabled=Ce.prototype.wa;var De=new Ce;Ce.SEPARATOR=De;function Ee(a,b,c){Ee.g.constructor.call(this,a,c);this.message=b}u(Ee,ie);t("H.util.ErrorEvent",Ee);function Fe(a,b,c){Fe.g.constructor.call(this,a,c);this.data=b}u(Fe,ie);t("H.util.DataEvent",Fe);function Ge(a,b,c){var d=[],e=arguments.length;a&&d.push(fb(a));1<e&&(e=2<e&&ib(c)?" out of ["+c[0]+"..."+c[1]+"]":"",d.push("("+b+e+")"));d=Error(d.join(" "));Object.setPrototypeOf(d,Ge.prototype);return d}u(Ge,Error);t("H.lang.OutOfRangeError",Ge);Ge.prototype.name="OutOfRangeError";function He(a){if(x.document){var b=document.createElement("canvas");b.width=b.height=1;return b.getContext("2d",{PD:a})}return null}function Ie(){return window.devicePixelRatio||1}t("H.util.getPixelRatio",Ie);var Je=/^rgba\(([^,]+),([^,]+),([^,]+),([^)]+)\)$/;
function Le(a){var b=Me[a],c=x.RegExp;b||(x.Uint8ClampedArray||(x.Uint8ClampedArray=function(d){return d instanceof Number?Array(d):d.map(function(e){return ec(Eb(e),0,255)})}),"none"===a?b=new Uint8ClampedArray([0,0,0,0]):(Ne.fillStyle="black",Ne.fillStyle=a,Je.test(Ne.fillStyle)?b=new Uint8ClampedArray([c.$1,c.$2,c.$3,255*c.$4]):(Ne.clearRect(0,0,1,1),Ne.fillRect(0,0,1,1),b=Ne.getImageData(0,0,1,1).data)),Me[a]=b);return b}function Oe(a){return"none"!==a&&0<Le(a)[3]}var Me=Wa(),Pe=!!x.VBArray;
t("H.util.eval",function(a){return eval(a)});function Qe(a,b){return a!==B?a:b}function Re(a){return/^<svg/.test(a)?"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a):a}t("H.util.provide",function(a){var b=wa.$jscomp;if(b&&("function"!=typeof b.pz?0:b.pz()))throw Error("goog.provide cannot be used within a module.");xa(a,void 0,void 0)});function Se(a){this.xd=0<+a?Bb.round(a):0}
Se.prototype.next=function(a){if(9007199254740992===this.xd)throw new Ge(a,this.xd,[0,9007199254740991]);return this.xd++};var Te=new Se,Ue=A(Te.next,Te);function Ve(){return!0}function We(){return!1}function Xe(){}var Ye=Ya([]),Ze=Ya({});function $e(a){return"CANVAS"===a.tagName?[a]:a.getElementsByTagName("CANVAS")}function af(a,b,c){var d;b=a.ownerDocument===b?a.cloneNode(!0):b.importNode(a,!0);if(c)for(a=$e(a),c=$e(b),d=c.length;d--;)c[d].getContext("2d").drawImage(a[d],0,0);return b}
var Ne=He(!0),bf=He(!1);function cf(a){var b=a.complete,c=0<a.naturalWidth;if(b&&!c&&Pe)try{bf.drawImage(a,0,0),c=!0}catch(d){}return b&&c}var df=x.BlobBuilder||x.WebKitBlobBuilder||x.MozBlobBuilder;function ef(a,b){b=b||"";if(df){var c=new df;c.append(a);a=c.getBlob(b)}else a=new Blob([a],{type:b});return a}var ff=x.navigator;La=/Edge\/\d+/.test(ff.appVersion);Ma=/(A|a)ndroid/.test(ff.appVersion);function K(a){K.g.constructor.call(this);a&&gf(a,K,0);this.T=a||[];this.ed=hf(this,0,this.T.length)}u(K,oc);t("H.geo.LineString",K);function hf(a,b,c){a=a.T;var d=0;b=Db(b,0);c=Cb(c,a.length);c-=2;for(b+=1;b<c;)d+=nc(a[b],a[b+=3]);return d}K.prototype.nr=function(a,b,c){jf(this,a,b,c,this.nr)};K.prototype.pushLatLngAlt=K.prototype.nr;function jf(a,b,c,d,e){var f=a.T.length;b=kc(b,e);c=lc(c,e);a.T.push(kc(b,e),lc(c,e),d===B?0:mc(d,e));f&&(a.ed+=nc(a.T[f-2],c));delete a.I;delete a.pr}
K.prototype.Ok=function(a,b,c){c&&gf(c,this.Ok,2);void 0===b&&(b=this.T.length);b&&(this.ed-=hf(this,a-3,a+b+3));var d=c?this.T.splice.apply(this.T,[a,b].concat(c)):this.T.splice(a,b);c&&(this.ed+=hf(this,a-3,a+c.length+3));b&&!c&&(this.ed+=hf(this,a-3,a-3));delete this.I;delete this.pr;return d};K.prototype.spliceLatLngAlts=K.prototype.Ok;K.prototype.Gu=function(a,b,c,d){this.Ok(a,0,[b,c,d])};K.prototype.insertLatLngAlt=K.prototype.Gu;K.prototype.rw=function(a){this.Ok(a,3)};
K.prototype.removeLatLngAlt=K.prototype.rw;K.prototype.ng=function(a){jf(this,a.lat,a.lng,a.alt,this.ng)};K.prototype.pushPoint=K.prototype.ng;K.prototype.Wd=function(a,b){this.Gu(3*a,b.lat,b.lng,b.alt)};K.prototype.insertPoint=K.prototype.Wd;K.prototype.tk=function(a){this.rw(3*a)};K.prototype.removePoint=K.prototype.tk;K.prototype.rj=function(a,b){var c=this.T,d=3*a;a=c[d];var e=c[d+1];c=c[d+2];b&&(b.lat=a,b.lng=e,b.alt=c);return b||new pc(a,e,c)};K.prototype.extractPoint=K.prototype.rj;
K.prototype.Oy=function(a,b,c){var d=this.T;b=b||0;c=Qe(c,d.length/3);for(var e=3*b;b<c;)a(d[e++],d[e++],d[e++],b++)};K.prototype.eachLatLngAlt=K.prototype.Oy;K.isDBC=nc;K.prototype.yp=function(a){var b=this.ed;a&&(a=this.T,b+=nc(a[a.length-2],a[1]));return b};K.prototype.getDBCs=K.prototype.yp;K.prototype.Ej=function(){return this.T.length/3};K.prototype.getPointCount=K.prototype.Ej;K.prototype.Pz=function(){return this.T};K.prototype.getLatLngAltArray=K.prototype.Pz;K.prototype.I=z;
K.prototype.C=function(){var a;if(!(a=this.I)){a=this.T;var b=a.length,c=3,d,e,f=z;if(3<=b){var g=d=a[0];var h=e=a[1];for(f=new F(g,h,d,e);c<b;c+=3){g=a[c-3];h=a[c-2];d=a[c];e=a[c+1];if(h>e&&180<e-h||h<e&&-180>h-e||e<h&&180>Hb(e-h)){var k=h;h=e;e=k}g<d&&(k=g,g=d,d=k);Hc(f.ga,f.X,f.ha,f.da,g,h,d,e,f)}}a=this.I=f}return a};K.prototype.getBoundingBox=K.prototype.C;K.prototype.IA=function(){return this.I!==z};K.prototype.hasBoundingBox=K.prototype.IA;
function gf(a,b,c){for(var d=a.length,e=!(d%3),f;e&&d;)e=!(E(a[--d]=mc((f=a[d])===B?0:f))||E(a[--d]=lc(a[d]))||E(a[--d]=kc(a[d])));if(!e&&b)throw new D(b,c,a);}function kf(a){var b=new K,c=0,d=a.length;if(d%2)throw new D(kf,0,a);for(;c<d;)jf(b,a[c++],a[c++],0,kf);return b}K.fromLatLngArray=kf;K.prototype.ea=function(a){var b=this===a,c;if(!b&&(b=C(a,K))){var d=this.T;a=a.T;for(b=(c=d.length)===a.length;b&&c--;)b=d[c]==a[c]}return b};K.prototype.equals=K.prototype.ea;
function lf(a,b){return a.oo-b.oo}
function mf(a,b){var c=a.T,d=-2,e=[],f;var g=a.pr;if(!g){g=a.pr=new Mc;var h=0;var k=a.T;var l=k.length;for(f=0;f<l;f+=3){var n=k[f];var p=k[f+1];if(f){var q=g.Hu(q,r,n,p);q.oo=h++}q=n;var r=p}}g=g.ym(b).sort(lf);k=g.length;for(b=0;b<k;b++){h=g[b];h=h.oo;l=3*h;if(h>d+1){var v=[c[l],c[l+1]];e.push(v)}d=h;v.push(c[l+3],c[l+4])}if(a.ed){c=[];d=e.length;for(b=0;b<d;b++)if(v=e[b],g=v.length){k=[];for(a=0;a<g;a+=2)h=v[a],l=v[a+1],k.push(h,l),f=v[a-1],a&&nc(l,f)&&(c.push(k),k=[],f+=0>f?360:-360,k.push(v[a-
2],f,h,l));c.push(k)}e=c}return e}m=K.prototype;m.ac="LineString";m.sf=function(a,b){var c=this.T,d=c.length,e;if(d){a.push("(");for(e=0;e<d;e+=3)e&&a.push(","),a.push(c[e+1]," ",c[e]);b&&(c[0]!==c[d-3]||c[1]!==c[d-2])&&a.push(",",c[1]," ",c[0]);a.push(")")}else a.push("EMPTY");return a};m.Ec="LineString";m.rf=function(){var a=[],b=this.T,c=b.length,d;for(d=0;d<c;d+=3)a.push([b[d+1],b[d],b[d+2]]);return a};
m.Od=function(){var a=this.T,b;if(this.C().oc()){a=a.slice();var c=1;for(b=a.length;c<b;c+=3)0>a[c]&&(a[c]+=360)}return a};m.nD=function(a){a=void 0===a?5:a;for(var b=this.T,c=b.length,d=[],e=0;e<c;e+=3)d.push([b[e],b[e+1],b[e+2]]);return Xc({polyline:d,precision:a,thirdDim:2,thirdDimPrecision:a})};K.prototype.toFlexiblePolyline=K.prototype.nD;
function nf(a){var b=Yc(a);a=b.polyline;var c=b.thirdDim;b=2===c||3===c;c=0===c;if(!a)throw new D(nf,0,"data");if(b||c){c=a.length;var d=Array(3*c);for(var e=0,f=0;e<c;e++){var g=a[e];d[f++]=g[0];d[f++]=g[1];d[f++]=b?g[2]:0}}if(!d)throw new D(nf,0,"only ABSENT, ALTITUDE or ELEVATION are supported as type of the 3rd dimension");return new K(d)}K.fromFlexiblePolyline=nf;function L(a,b){this.x=+a;this.y=+b}t("H.math.Point",L);L.prototype.set=L;L.prototype.set=L.prototype.set;L.prototype.clone=function(a){a?(a.x=this.x,a.y=this.y):a=new L(this.x,this.y);return a};L.prototype.clone=L.prototype.clone;L.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};L.prototype.add=L.prototype.add;L.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};L.prototype.sub=L.prototype.sub;L.prototype.scale=function(a,b){this.x*=a;this.y*=void 0===b?a:b;return this};
L.prototype.scale=L.prototype.scale;L.prototype.round=function(){this.x=Eb(this.x);this.y=Eb(this.y);return this};L.prototype.round=L.prototype.round;L.prototype.floor=function(){this.x=Fb(this.x);this.y=Fb(this.y);return this};L.prototype.floor=L.prototype.floor;L.prototype.ceil=function(){this.x=Gb(this.x);this.y=Gb(this.y);return this};L.prototype.ceil=L.prototype.ceil;L.prototype.ea=function(a){return!(!a||this.x!==a.x||this.y!==a.y)};L.prototype.equals=L.prototype.ea;
L.prototype.ju=function(a,b){var c=b.x-a.x,d=b.y-a.y;var e=a;if(c||d)e=((this.x-a.x)*c+(this.y-a.y)*d)/(c*c+d*d),e=0>=e?a:1<=e?b:new L(a.x+e*c,a.y+e*d);return e};L.prototype.getNearest=L.prototype.ju;L.prototype.lb=function(a){return Jb(Kb(this.x-a.x,2)+Kb(this.y-a.y,2))};L.prototype.distance=L.prototype.lb;function of(a){if(!a)throw Error("invalid argument");return a instanceof L?a:new L(a.x,a.y)}L.fromIPoint=of;function pf(a,b,c,d,e,f){var g,h,k=a.length,l,n;if(k)for(g=[];k--;){var p=a[k];var q=p.length;var r=0;for(l=1;l<q;l++)if(n=qf(p[l-1],p[l],c,b,d,e)){var v=n[0];var w=n[1];r&&r.ea(v)?h.push(w):g.push(h=n);r=w;f&&(l=q,k=0)}}else g=a;return g}t("H.math.clipping.clipStrips",pf);
function qf(a,b,c,d,e,f){var g=a.x;a=-a.y;var h=b.x;b=-b.y;c=-c;f=-f;if(g>h){if(h>e||g<d)return;var k=g;var l=a;g=h;a=b;h=k;b=l;k=1}else if(g>e||h<d)return;if(a>b){if(b>c||a<f)return;var n=1;a=-a;b=-b;l=f;f=-c;c=-l}else if(a>c||b<f)return;if(g<d){if((a+=(d-g)*(b-a)/(h-g))>c)return;g=d}if(a<f){if((g+=(f-a)*(h-g)/(b-a))>e)return;a=f}h>e&&(b=a+(e-g)*(b-a)/(h-g),h=e);b>c&&(h=g+(c-a)*(h-g)/(b-a),b=c);n&&(a=-a,b=-b);return k?[new L(h,-b),new L(g,-a)]:[new L(g,-a),new L(h,-b)]}
function rf(a,b,c){a=sf(a,!0);b=sf(b,!1);var d,e;var f={};var g=d=1;switch(~~(1*(c||0))){case 1:g=d=0;break;case 2:d=0;g=1;break;case 3:d=1,g=0}c=d;var h=g;if(b&&a){b.fj=new tf(b.x,b.y,null,uf(b));a.fj=new tf(a.x,a.y,null,uf(a));for(g=b;g.next;g=g.next)if(!g.pb)for(d=a;d.next;d=d.next)if(!d.pb){var k=vf(g.next);var l=vf(d.next);if(e=wf(g,k,d,l,f)){e=f.ay;var n=f.by;var p=f.yD;var q=f.zD;e=new tf(p,q,null,null,null,null,!0,0,0,e);xf(e,g,k);k=new tf(p,q,null,null,null,null,!0,0,0,n);xf(k,d,l);e.Hq=
k;k.Hq=e}}f=ic(b,yf(a));c&&(f=!f);for(g=b;g;g=g.next)g.pb&&(g.iq=f,f=!f);f=ic(a,yf(b));h&&(f=!f);for(d=a;d.next;d=d.next)d.pb&&(d.iq=f,f=!f);zf(b);for(zf(a);(a=Af(b))!=b;){for(c=null;!a.eo;a=a.Hq){for(f=a.iq;;){c=new tf(a.x,a.y,c);c.artificial=a.pb||a.Nu;a.eo=1;a=f?a.next:a.Ad;if(!a)break;if(a.pb){a.eo=1;break}}if(!a)break}c.Iq=r||null;var r=c}return r}}t("H.math.clipping.clipPolygon",rf);
function tf(a,b,c,d,e,f,g,h,k,l){this.x=a;this.y=b;this.next=c||null;this.Ad=d||null;this.Iq=e||null;this.Hq=f||null;this.pb=!!g;this.iq=!!h;this.eo=k||0;this.alpha=l||0;d&&(d.next=this);c&&(c.Ad=this);this.Nu=!1;this.fj=null}function vf(a){for(;a&&a.pb;)a=a.next;return a}function uf(a){if(a)for(;a.next;)a=a.next;return a}function Af(a){var b=a;if(b){do b=b.next;while(b!=a&&(!b.pb||b.pb&&b.eo))}return b}function zf(a){var b=uf(a);b.Ad.next=a;a.Ad=b.Ad}
function wf(a,b,c,d,e,f){var g,h=b.x-a.x,k=b.y-a.y;var l=d.x-c.x;var n=d.y-c.y;var p=h*n-k*l;if(!p)return 0;l=((c.x-a.x)*n-(c.y-a.y)*l)/p;p=(k*(c.x-a.x)-h*(c.y-a.y))/p;if(0>l||1<l||0>p||1<p)return 0;0===l?g=a:1===l?g=b:0===p?g=c:1===p&&(g=d);if(g&&!f)return g.x+=2.480549651603763E-5,g.y+=7.321997314118067E-5,g.fj&&(g.fj.x=g.x,g.fj.y=g.y),wf(a,b,c,d,e);e.yD=a.x+l*h;e.zD=a.y+l*k;e.ay=l;e.by=p;return 1}function yf(a){for(var b=[];a;)b.push(a.x,a.y),a=a.next;return b}
function xf(a,b,c){for(b=b.next;b!==c&&b.alpha<=a.alpha;)b=b.next;a.next=b;a.Ad=b.Ad;a.next.Ad=a;a.Ad.next=a}function sf(a,b){for(var c,d=null,e=0,f=a.length;e<f;e++){c=new tf(a[e].x,a[e].y,d);c.Nu=b;if(c.next=d)d.Ad=c;d=c}return d};function M(a,b){var c;M.g.constructor.call(this);C(a,K,M,0);if(b!==B&&ib(b,M,1)){for(c=0;c<b.length;c++)C(b[c],K,M,1,"index "+c);this.eb=b}else this.eb=[];this.Fb=a;this.Lj=[]}u(M,oc);t("H.geo.Polygon",M);function Bf(a){var b=M,c=K,d=a.ga,e=a.X,f=a.ha,g=a.da;e=[d,e,B,d,g,B,f,g,B,f,e,B];180<=a.nc()&&(e.splice(9,0,f,a=a.wb().lng,B),e.splice(3,0,d,a,B));return new b(new c(e))}M.fromRect=Bf;var Cf={NORTH:90,SOUTH:-90};M.Direction=Cf;M.prototype.ef=Cf.NORTH;
M.prototype.Ow=function(a){this.ef!==a&&(this.I=z,this.Lj.length=0,this.ef=a);return this};M.prototype.setPoleCovering=M.prototype.Ow;M.prototype.fA=function(){return this.ef};M.prototype.getPoleCovering=M.prototype.fA;M.prototype.Az=function(){return this.Fb};M.prototype.getExterior=M.prototype.Az;M.prototype.Lw=function(a){if(!C(a,K))throw new D(this.Lw,0,a);this.Fb=a;this.I=z};M.prototype.setExterior=M.prototype.Lw;M.prototype.Mz=function(){return this.eb};M.prototype.getInteriors=M.prototype.Mz;
M.prototype.ao=function(a,b,c){var d=arguments.length,e;for(e=2;e<d;e++)C(arguments[e],K,this.ao,e);var f=this.eb.splice.apply(this.eb,arguments);for(e=2;e<d;e++)arguments[e]=B;this.Lj.splice.apply(this.Lj,arguments);return f};M.prototype.spliceInteriors=M.prototype.ao;M.prototype.rC=function(a){return this.ao(a,1)[0]};M.prototype.removeInteriorAt=M.prototype.rC;M.prototype.qC=function(a){a=this.eb.indexOf(a);return 0>a?B:this.ao(a,1)[0]};M.prototype.removeInterior=M.prototype.qC;
M.prototype.nw=function(a){if(!C(a,K))throw new D(this.nw,0,a);this.eb.push(a)};M.prototype.pushInterior=M.prototype.nw;M.prototype.C=function(){var a=this.I;a||(this.I=a=Df(this.Fb,this.ef));return a};M.prototype.getBoundingBox=M.prototype.C;m=M.prototype;m.$t=function(a){var b=this.eb.length;if(0>a||a>=b)throw new Ge(this.$t,a,[0,b-1]);(b=this.Lj[a])||(this.Lj[a]=b=Df(this.eb[a],this.ef));return b};
function Df(a,b){var c,d,e;if(e=a.C())(c=a.yp(!0))&&(d=a.Ej())&&(e=e.wd(Jc([a.rj(0),a.rj(d-1)],!0),!0)),360===e.nc()&&1===c%2&&(e=e.Ze(b,0));return e}m.ac="Polygon";m.sf=function(a){var b=this.eb,c=b.length,d;if(this.Fb.Ej()){a.push("(");this.Fb.sf(a,!0);for(d=0;d<c;d++)b[d].Ej()&&(a.push(","),b[d].sf(a,!0));a.push(")")}else a.push("EMPTY");return a};m.Ec="Polygon";
m.rf=function(){var a,b=[],c=this.eb,d=this.Fb.rf();d[0].toString()!==d[d.length-1].toString()&&d.push(d[0]);b.push(d);for(a=0;a<c.length;a++)d=c[a].rf(),d[0].toString()!==d[d.length-1].toString()&&d.push(d[0]),b.push(d);return b};m.R=function(){var a=M.g.R.call(this);this.C().oc()&&(a.type="Multi"+a.type);return a};m.Od=function(){var a=[],b=this.eb,c=b.length;for(a.push(this.Fb.Od());c--;)a[c+1]=b[c].Od();return this.C().oc()?[a]:a};
m.ea=function(a){var b=!1;if(C(a,M)){var c=a.eb,d=this.eb.length;b=c.length;var e=0;for(b=this.Fb.ea(a.Fb)&&d===b;b&&e<d;)b=b&&this.eb[e].ea(c[e]),e++}return b};M.prototype.equals=M.prototype.ea;function Ef(a,b,c,d){var e=a.eb,f=Ff.bind(null,b,c);return hc(b,c,a.Fb.T,0,!0,3)!==gc.NONE?void 0===d||d?!e.some(f):!0:!1}function Ff(a,b,c){return hc(a,b,c.T,0,!0,3)===gc.SURFACE}
function Gf(a,b){b=b.T;a=a.Fb.T;var c,d,e=b.length-3,f=a.length-3,g={};for(c=0;c<e;c+=3){var h=b[c];var k=b[c+1];var l=b[c+3];var n=b[c+4];for(d=0;d<f;d+=3){var p=a[d];var q=a[d+1];var r=a[d+3];var v=a[d+4];if(wf(new tf(k,h),new tf(n,l),new tf(q,p),new tf(v,r),g,!0))return!0}}return!1}
function Hf(a,b){var c=b.Fb,d=b.eb,e=d.length,f=c.T,g=f.length,h=a.Fb.T,k=h.length;if(Gf(a,c))return!0;for(c=0;c<g;c+=3)if(Ef(a,f[c],f[c+1]))return!0;for(c=0;c<k;c+=3)if(Ef(b,h[c],h[c+1]))return!0;for(c=0;c<e;c++)if(Gf(a,d[c]))return!0;return!1};function If(a){eb(this,If);If.g.constructor.call(this);this.ia=Jf(this,a,this.constructor,0)}u(If,oc);t("H.geo.MultiGeometry",If);If.prototype.splice=function(a,b,c){a=[a];b!==B&&a.push(b);c&&(b=Jf(this,c,this.splice,2),a=a.concat(b));this.I=z;return this.ia.splice.apply(this.ia,a)};If.prototype.splice=If.prototype.splice;If.prototype.Bd=function(a){var b=this.ia.length;if(!(0<=a&&a<b))throw new Ge(this.Bd,a,[0,b-1]);this.I=z;return this.ia.splice(a,1)[0]};If.prototype.removeAt=If.prototype.Bd;
If.prototype.remove=function(a){a=this.ia.indexOf(a);if(0<=a){var b=this.ia.splice(a,1)[0];this.I=z}return b||z};If.prototype.remove=If.prototype.remove;If.prototype.Hz=function(){return this.ia};If.prototype.getGeometries=If.prototype.Hz;If.prototype.push=function(a){var b=Jf(this,[a],this.push,0)[0];this.I&&(this.I=this.I.wd(a.C()));this.ia.push(b)};If.prototype.push=If.prototype.push;
If.prototype.C=function(){var a;if(!(a=this.I)){a=z;var b,c;if(this.ia.length)for(a=this.ia[0].C(),c=1;c<this.ia.length;c++)if(b=this.ia[c].C())a=a?a.wd(b):b}return this.I=a};If.prototype.getBoundingBox=If.prototype.C;If.prototype.I=z;function Jf(a,b,c,d){var e,f=[];if(!ib(b))throw new D(c,d);for(e=0;e<b.length;e++)if(a.oq(b[e]))f.push(a.gw(b[e]));else throw new D(c,d);return f}If.prototype.gw=function(a){return a};
If.prototype.ea=function(a){var b=this===a,c;if(!b&&(b=C(a,this.constructor))){var d=this.ia;a=a.ia;for(b=(c=d.length)===a.length;b&&c--;)b=d[c].ea(a[c])}return b};If.prototype.equals=If.prototype.ea;If.prototype.sf=function(a){var b=this.ia,c=b.length,d,e,f=!1;if(c){a.push("(");for(d=0;d<c;d++)(e=0<d&&f)&&a.push(","),b[d].sf(a),"EMPTY"===a[a.length-1]?a.splice(-1-+e,1+ +e):f=!0;f?a.push(")"):a.splice(-1,1,"EMPTY")}else a.push("EMPTY");return a};
If.prototype.Od=function(){for(var a=[],b=this.ia,c=b.length;c--;)a[c]=b[c].Od();return a};If.prototype.R=function(){var a=If.g.R.call(this);a.type=this.ac;return a};If.prototype.rf=function(){for(var a=[],b=this.ia,c=b.length;c--;)a[c]=b[c].rf();return a};function Kf(a){Kf.g.constructor.call(this,a)}u(Kf,If);t("H.geo.MultiPolygon",Kf);Kf.prototype.oq=function(a){return C(a,M)};Kf.prototype.ac="Multi"+M.prototype.ac;Kf.prototype.Ec="Multi"+M.prototype.Ec;function Lf(a){Lf.g.constructor.call(this,a)}u(Lf,If);t("H.geo.MultiPoint",Lf);Lf.prototype.oq=function(a){return qc(a)};Lf.prototype.gw=function(a){return C(a,pc)?a:sc(a)};Lf.prototype.ac="Multi"+pc.prototype.ac;Lf.prototype.Ec="Multi"+pc.prototype.Ec;function Mf(a){Mf.g.constructor.call(this,a)}u(Mf,If);t("H.geo.MultiLineString",Mf);Mf.prototype.oq=function(a){return C(a,K)};Mf.prototype.ac="Multi"+K.prototype.ac;Mf.prototype.Ec="Multi"+K.prototype.Ec;function Nf(a,b,c){var d,e=6;if(b){for(d=' expected close to: "'+b;e--;)b=a.jt.next(),-1!==b&&(d+=String.fromCharCode(b));d+='"'}throw new D(Of,0,"- Malformed WKT: "+(d?c+d:"unexpected end of stream"));}function Pf(a,b){var c=a.next();b=b?")":"(";c!==b&&Nf(a,c,'"'+b+'"')}function Qf(a){return","===a.fb()?(a.next(),!0):!1}function Rf(a,b,c,d,e){var f,g,h=2+b+c;for(g=1;g<=h;g++)(c=a.next())?(f=+c)!==f?Nf(a,c,"number"):1===g?d[e+1]=f:2===g?d[e+0]=f:3===g&&(d[e+2]=f):Nf(a,c);b||(d[e+2]=0)}var Sf=[];
function Tf(a,b,c,d){d||Pf(a,0);Rf(a,b,c,Sf,0);d||Pf(a,1);return new pc(Sf[0],Sf[1],b?Sf[2]:B)}function Uf(a,b,c){var d=[];Pf(a,0);do Rf(a,b,c,d,d.length);while(Qf(a));Pf(a,1);return new K(d)}function Vf(a,b,c){Pf(a,0);var d=Uf(a,b,c);if(Qf(a)){var e=[];do e.push(Uf(a,b,c));while(Qf(a))}Pf(a,1);return new M(d,e)}
var Wf=[],Xf=[Vf],Yf=[Tf],Zf={POINT:Yf,LINESTRING:[Uf],POLYGON:Xf,MULTIPOINT:[Tf,Lf],MULTILINESTRING:[Uf,Mf],MULTIPOLYGON:[Vf,Kf],GEOMETRY:Wf,GEOMETRYCOLLECTION:Wf,CIRCULARSTRING:Wf,COMPOUNDCURVE:Wf,CURVEPOLYGON:Wf,MULTICURVE:Wf,MULTISURFACE:Wf,CURVE:Wf,SURFACE:Wf,POLYHEDRALSURFACE:Wf,TIN:Wf,TRIANGLE:Wf},$f={Z:1,M:2,ZM:3};
function Of(a){a=new ag(a);var b;var c=a.next();(b=Zf[c.toUpperCase()])||Nf(a,c,"type name");if(b!==Wf){c=a.fb();c=$f[c.toUpperCase()];var d=c&1;var e=c>>1;d|e&&a.next();c=a.fb();if("EMPTY"===c)if(a.next(),d=b[1])var f=new d([]);else b!==Yf&&(f=new K([]),b===Xf&&(f=new M(f)));else if("("===c){f=b[0];b=b[1];if(b){var g=[];Pf(a,0);if(f===Tf){var h="("!==a.fb();do g.push(f(a,d,e,h));while(Qf(a))}else{do g.push(f(a,d,e));while(Qf(a))}Pf(a,1);d=new b(g)}else d=f(a,d,e);f=d}else Nf(a,c,'"Z", "M", "ZM", "(" or "EMPTY"');
a.next()&&Nf(a,c,"end of stream")}return f||z}function ag(a){this.jt=a}ag.prototype.fb=function(){var a=this.Wv;if(a===B){for(a=this.jt;a.fb()===bg;)a.next();if(cg[a.fb()])a=a.next(),a=a===dg?"":String.fromCharCode(a);else{a.ui();do a.next();while(!cg[a.fb()]);a=String.fromCharCode.apply(null,a.ih())}this.Wv=a}return a};ag.prototype.next=function(){var a=this.fb();""!==a&&delete this.Wv;return a};
var bg=32,dg=-1,eg={JD:bg,DD:40,ID:41,AD:44,BD:dg},cg=Object.keys(eg).reduce(function(a,b){a[eg[b]]=!0;return a},Wa());t("H.util.wkt.toGeometry",function(a){return Of(new Oa(a))});function fg(a,b,c,d){this.left=+a;this.top=+b;this.right=+c;this.bottom=+d}t("H.math.Rect",fg);fg.prototype.set=fg;fg.prototype.set=fg.prototype.set;fg.prototype.Kc=function(){return this.al||(this.al=new L(this.left,this.top))};fg.prototype.getTopLeft=fg.prototype.Kc;fg.prototype.Gc=function(){return this.Ni||(this.Ni=new L(this.right,this.bottom))};fg.prototype.getBottomRight=fg.prototype.Gc;fg.prototype.Il=function(a,b){return this.left<=a&&this.right>=a&&this.top<=b&&this.bottom>=b};
fg.prototype.containsXY=fg.prototype.Il;function gg(a,b){return new fg(a.x,a.y,b.x,b.y)}fg.fromPoints=gg;fg.prototype.clone=function(){return new fg(this.left,this.top,this.right,this.bottom)};fg.prototype.clone=fg.prototype.clone;t("H.util.constants.DEFAULT_MIN_ZOOM_LEVEL",0);t("H.util.constants.DEFAULT_MAX_ZOOM_LEVEL",22);var hg;function ig(a,b){if(x.URL)return(new x.URL(a,b)).toString();if(!a||!jg(a))return a;if(!b||jg(b))throw new TypeError("Failed to construct 'URL': Invalid base URL");hg||(hg=document.createElement("a"),rb(hg));var c=hg;c.href=b;"/"!==a[0]?a=c.href.replace(/\/[^\/]*$/,"/")+a:((b=c.origin)||(b=c.protocol+"//"+c.host),a=b+a);return a}function jg(a){var b=!1;"string"===typeof a&&(b=!(-1<a.search(/^(http|https|data|blob):/)||"//"===a.substr(0,2)));return b};function kg(a,b){kg.g.constructor.call(this);if(b&&jg(b))throw new D(kg,1,"Base URL must be absolute");this.o=lg.INIT;this.Ia=null;this.hd=b}u(kg,J);t("H.map.render.Style",kg);kg.prototype.load=kg.prototype.load;kg.prototype.getState=function(){return this.o};kg.prototype.getState=kg.prototype.getState;kg.prototype.G=function(a){this.o=a};kg.prototype.setState=kg.prototype.G;kg.prototype.Fc=function(){return this.hd};kg.prototype.getBaseUrl=kg.prototype.Fc;kg.prototype.Pd=function(){return $a(this.Ia)};
kg.prototype.getConfig=kg.prototype.Pd;kg.prototype.nz=function(){return this.Ia};kg.prototype.getConfigReference=kg.prototype.nz;kg.prototype.yg=function(a){this.Ia=a};kg.prototype.setConfig=kg.prototype.yg;kg.prototype.Dc=function(a){this.Ia=null;this.G(lg.ERROR);this.Xp(mg)?this.dispatchEvent(new Ee(mg,a,this)):console.error(a)};kg.prototype.dispatchError=kg.prototype.Dc;kg.prototype.i=function(){kg.g.i.call(this);this.Ia=null};
var mg="error",ng={uf:"change",Fs:mg},lg={ERROR:-1,INIT:0,LOADING:1,READY:2};kg.State=lg;var og={FEATURE:1,SOURCE:2,PROVIDER:3};t("H.map.provider.PickingMode",og);function pg(a,b){var c,d=arguments.length,e,f;for(c=1;c<d;c++)if((e=arguments[c])&&e!==a&&e!==g){var g=e;for(f in e){var h=e[f];a[f]!==h&&(qg(h)?qg(a[f])?a[f]=pg(a[f],h):a[f]=$a(h):void 0!==h&&(a[f]=$a(h)))}}return a}t("H.util.webgl.mergeObjects",pg);var rg=Wa();function sg(a,b,c){var d=c[a];return b&&d in b&&0>cb.indexOf(d)?(b=b[d],++a<c.length?sg(a,b,c):b):rg}
var tg=sg.bind(null,0),ug={polygons:1,lines:1,"pattern-lines":1,points:1,text:1,raster:1,custom_icons:1,overlays:1},vg={data:1,draw:1,enabled:1,filter:1,properties:1},wg=Object.keys(vg);function xg(a,b,c,d,e,f){var g=d[a],h=c[g];if(++a<d.length){var k=b[g]||{};for(c=wg.length;c--;){var l=wg[c];if("draw"!==l||!f){var n=h[l];n!==B&&(k[l]=$a(n))}}xg(a,k,h,d,e,f)}else e?k=$a(h):(k=h,delete c[g]);b[g]=b[g]?pg(b[g],k):k}var yg=xg.bind(null,0);function zg(a,b){a in ug&&(b[a]=1)}
function Ag(a,b,c){var d,e,f;for(d in a)if(vg[d]){if("draw"===d){var g=a[d];for(e in g){var h=g[e];(f=h.style)?(h.style=b+f,zg(f,c)):(delete g[e],g[b+e]=h,zg(e,c))}}}else Ag(a[d],b,c)}
function Bg(a,b){var c={},d,e,f,g;b+="_";a=pg({},a);if(d=a.styles)for(e in d){var h=d[e];delete d[e];d[b+e]=h;if(f=h.mix)for(jb(f)&&(f=[f]),g=f.length;g--;)zg(f[g],c),f[g]=b+f[g];if(g=h.base)f||(f=h.mix=[]),f.unshift(b+g),delete h.base,zg(g,c);zg(e,c)}else d=a.styles={};if(h=a.layers)for(e in h)f=h[e],delete h[e],(g=f.data)&&!g.layer&&(g.layer=e),h[b+e]=f,Ag(f,b,c);for(e in c)d[b+e]={base:e};return a}
function Cg(a,b){var c=a.sources,d=Object.keys(c)[0],e=pg(c[d],{uid:b});c=a.layers;var f;a.sources={};a.sources[b]=e;for(f in c)a=c[f],a.data?a.data.source===d&&(a.data.source=b):a.data={source:b}}function Dg(a,b){var c;var d=a.textures;a=a.fonts;for(c in d){var e=d[c];e.url&&(e.url=ig(e.url,b))}for(c in a)if(e=a[c],ib(e))for(d=0;d<e.length;d++){var f=e[d];f.url=f.url&&ig(f.url,b)}else f=e,f.url=f.url&&ig(f.url,b)}function Eg(a,b){return"function(){return "+("feature."+a+(b||""))+";}"}
function Fg(a){return Eg("style."+a,void 0)}function Gg(a,b,c,d){a={base:a,blend:b,blend_order:c};d&&(a.clean_depth=!!d);return a}function Hg(a){var b={};b["translucent-"+(a?"extruded-":"")+"polygons"]={color:Fg("fillColor"),order:1,interactive:!0,extrude:a};return b}function Ig(a,b,c,d){a={data:{source:a,layer:b}};c&&(a.draw=c);d&&(a.filter=d);return a}function qg(a){return ya(a)&&!ib(a)};function Jg(){var a=Jg.hv;a||(a=this,Jg.hv=a,rb(Jg.hv),J.call(a),this.ug());return a}u(Jg,J);m=Jg.prototype;m.i=function(){Jg.g.i.call(this);this.ug()};m.ug=function(){this.mB=10;this.nB=6;this.gi=Wa();this.xr=Wa();this.Cr=0};m.zo=function(a){a=a.type;var b=this.gi[a]||0;if(this.Cr<this.mB&&b<this.nB){var c=++this.bB;this.Cr++;this.gi[a]=b+1;this.xr[c+""]=a;return c}return z};
m.Sl=function(a){var b=this.xr[a];if(!db(b)||!this.gi[b])throw new Ab(this.Sl,"Unknown requestId");this.Cr--;this.gi[b]--;this.gi[b]||delete this.gi[b];delete this.xr[a];this.dispatchEvent("allocatable")};m.bB=-1;function Kg(a,b){b=b||{};"status"in b&&(this.status=+b.status);"statusText"in b&&(this.statusText=b.statusText);this.ok=200<=this.status&&300>this.status;this.Mu=!1;a?"string"===typeof a?this.Fo=a:(b=x.ArrayBuffer)&&b.prototype.isPrototypeOf(a)?this.vf=a:b&&a.buffer?this.vf=a.buffer:x.Blob.prototype.isPrototypeOf(a)&&(this.vl=a):this.Fo=""}t("H.net.Response",Kg);Kg.prototype.type="default";Kg.prototype.type=Kg.prototype.type;Kg.prototype.status=200;Kg.prototype.status=Kg.prototype.status;
Kg.prototype.statusText="OK";Kg.prototype.statusText=Kg.prototype.statusText;function Lg(a){if(a.Mu)return Ed(new TypeError("Already read"));a.Mu=!0}Kg.error=function(){Kg.hp||(Kg.hp=new Kg(null,{status:0,statusText:""}),Kg.hp.type="error");return Kg.hp};Kg.error=Kg.error;
Kg.prototype.text=function(){var a=Lg(this);if(!a)if(this.Fo)a=Dd(this.Fo);else if(this.vf){a=new Uint8Array(this.vf);var b=a.length,c=Array(b),d;for(d=0;d<b;d++)c[d]=String.fromCharCode(a[d]);a=Dd(c.join(""))}else a=this.vl?Mg(this.vl):Ed("Unsupported response body");return a};Kg.prototype.json=function(){return this.text().then(x.JSON.parse)};Kg.prototype.blob=function(){var a,b=Lg(this);b||(this.vl?a=this.vl:this.vf&&(a=new Blob([this.vf],{type:"application/octet-stream"})));return b||Dd(a)};
Kg.prototype.arrayBuffer=function(){return this.vf?Lg(this)||Dd(this.vf.slice(0)):this.blob().then(Kg.hy)};Kg.hy=function(a){var b=new FileReader;b.readAsArrayBuffer(a);return new ud(function(c,d){b.onload=function(){c(b.result)};b.onerror=function(){d(b.error)}})};function Mg(a){var b=new FileReader;b.readAsText(a);return new ud(function(c,d){b.onload=function(){c(b.result)};b.onerror=function(){d(b.error)}})}!yb&&x.Response&&x.Response.error&&(Kg=x.Response,rb(Kg.prototype));function Ng(a,b,c){function d(){var n=A(l.Th,l),p=+k.timeout||0;Og?(Pg(l,"timeout",n),e.timeout=p):p&&(l.Ax=setTimeout(function(){e.abort();l.Th({type:"timeout"})},p));Pg(l,"error",n);Pg(l,"load",n);e.send(k.data)}var e,f,g,h=c&&c.headers||{},k={},l=this;if(!ab(b))throw new D(Ng,1,"function required");a+="";Ta(h,Qg.headers,h);Ta(k,Qg,c||{});k.headers=h;this.gt=b;this.K=e=new XMLHttpRequest;b=k.method;try{e.open(b,a,!0);for(f in h)h.hasOwnProperty(f)&&(g=h[f])&&e.setRequestHeader(f,g);e.withCredentials=
!!k.withCredentials;d()}catch(n){this.Th({type:"cors"})}}t("H.net.Xhr",Ng);var Qg={method:"GET",headers:{},data:null},Rg="withCredentials"in new XMLHttpRequest,Og="timeout"in new XMLHttpRequest;function Pg(a,b,c){Rg?a.K.addEventListener(b,c):a.K["on"+b]=c}function Sg(a,b,c){Rg?a.K.removeEventListener(b,c):a.K["on"+b]=null}Ng.prototype.abort=function(){this.K&&(this.K.abort(),this.K&&this.Th({type:"abort"}))};Ng.prototype.abort=Ng.prototype.abort;
Ng.prototype.Th=function(a){var b=a.type;a=this.K;var c;this.Ax&&clearTimeout(this.Ax);"load"===b?a instanceof XMLHttpRequest&&200!==a.status&&(c="network"):c=4===a.readyState&&0===a.status&&"error"==b?"cors":"error"!=b?b:"network";b=this.Th;Sg(this,"timeout",b);Sg(this,"error",b);Sg(this,"load",b);a=0===a.status||c&&"network"!==c?Kg.error():new Kg(a.responseText||null,a);c=this.gt;delete this.Th;delete this.gt;delete this.K;c(a)};function Tg(a,b,c,d){if(!Ug[a])throw new D(Tg,0,"Mime type is not supported");this.tB=a;a=d?Ra(d):{};"crossOrigin"in a||(a.crossOrigin="anonymous");this.Fa=a;Vg.href=b.toString();Td.call(this,Vg.protocol+"//"+Vg.hostname,b,c)}u(Tg,Td);Tg.prototype.Nt=function(){this.Xq=Ug[this.tB].call(this);return!0};Tg.prototype.Si=function(){this.Xq&&(this.Xq.abort(),delete this.Xq)};
var Ug={"application/json":function(){var a=this,b=Wg(this.Fa),c=b.headers;b.headers=c=c?Ra(c):{};c.Accept="application/json";return new Ng(this.data,function(d){200<=d.status&&300>d.status?a.resolve(d.json()):a.reject(d)},b)},"text/plain":function(){var a=this;return new Ng(this.data,function(b){200<=b.status&&300>b.status?a.resolve(b.text()):a.reject(b)},Wg(this.Fa))},image:function(){var a=x.document.createElement("img"),b=this,c=this.data;a.onload=A(this.resolve,this,a);a.onerror=function(){b.reject(Kg.error())};
a.crossOrigin=this.Fa.crossOrigin;a.src=c;return{abort:function(){a.onerror=a.onload=null;Pe&&cf(a)||a.removeAttribute("src")}}}};
(function(){try{var a=new XMLHttpRequest;a.open("get","/",!0)}catch(b){a={}}"response"in a&&(Ug.arraybuffer=function(){var b=new XMLHttpRequest,c=this,d=this.Fa,e=d.headers,f;b.open("GET",this.data);Xg(b,d);b.responseType="arraybuffer";if(e)for(f in e)b.setRequestHeader(f,e[f]);b.onerror=b.ontimeout=function(){c.reject(Kg.error())};b.onload=function(){c.resolve(new Kg(b.response))};b.send();return b})})();var Yg=new Wd(new Jg);Tg.prototype.Bp=function(){return Yg};var Vg=x.document.createElement("a");
function Wg(a){var b=Ra(a);delete b.crossOrigin;Xg(b,a);return b}function Xg(a,b){a.withCredentials="use-credentials"===b.crossOrigin};function Zg(a,b){Zg.g.constructor.call(this,a,b);if(jb(a))$g.test(a)&&-1===a.indexOf("import:")?(this.uc=a,b||(this.OA=jg(this.uc)?B:this.uc)):this.ko=a;else if(ya(a))this.yg($a(a));else throw new D(Zg,0,"invalid style configuration");}u(Zg,kg);t("H.map.render.webgl.Style",Zg);
Zg.prototype.load=function(){var a=this,b=this.Fc();this.uc?(this.G(lg.LOADING),(new Tg("text/plain",this.uc)).then(function(c){var d={};return ah(c,b,!1,(d[b]=!0,d))}).then(function(c){return a.yg(c)},function(c){return a.Dc(c.message)}),delete this.uc):this.ko&&(this.G(lg.LOADING),ah(this.ko,b).then(function(c){return a.yg(c)},function(c){return a.Dc(c.message)}),delete this.ko)};Zg.prototype.load=Zg.prototype.load;
Zg.prototype.Nw=function(a,b,c){var d;bh(this);a=ch(this,a,this.Nw,c);for(c=0;c<a.length;c++){var e=a[c].yb.draw;for(d in e){var f=e[d];qg(f)&&(f.interactive=!!b)}}dh(this)};Zg.prototype.setInteractive=Zg.prototype.Nw;
Zg.prototype.setProperty=function(a,b,c){var d,e=a.split("."),f=0,g=e.length;bh(this);if(!db(b))throw new D(this.setProperty,1,"value");if(d=eh(this.Ia,e)){if(!(d.parent instanceof Object)||d.parent instanceof Array)if(c)e.pop(),e=eh(this.Ia,e),d.parent=e.parent[e.An]={};else throw new D(this.setProperty,0,a+" property is not primitive type");d.parent[d.An]=b}else{for(d=this.Ia;f!==g-1;)d[e[f]]={},d=d[e[f++]];d[e[f]]=b}fh(this)&&dh(this)};Zg.prototype.setProperty=Zg.prototype.setProperty;
Zg.prototype.Kp=function(a){bh(this);return(a=eh(this.Ia,a.split(".")))?$a(a.node):void 0};Zg.prototype.getProperty=Zg.prototype.Kp;Zg.prototype.removeProperty=function(a){bh(this);(a=eh(this.Ia,a.split(".")))&&a.parent&&a.parent.hasOwnProperty(a.An)&&(delete a.parent[a.An],fh(this)&&dh(this))};Zg.prototype.removeProperty=Zg.prototype.removeProperty;
Zg.prototype.qj=function(a,b,c){var d;bh(this);var e=this.Ia;var f=e.layers;var g=ch(this,a,this.qj,!1);a=g.length;for(d={};a--;)yg(d,f,g[a].id,!!b,!!c);c={};g=Object.keys(e);for(a=g.length;a--;){var h=g[a];var k=e[h];c[h]=k===f?d:$a(k)}b||dh(this);return c};Zg.prototype.extractConfig=Zg.prototype.qj;Zg.prototype.Wj=function(a){bh(this);if(!ya(a))throw new D(this.Wj,0,"config");this.yg(pg(this.Ia,a))};Zg.prototype.mergeConfig=Zg.prototype.Wj;Zg.prototype.Yb=ba(2);
Zg.prototype.toString=function(){return this.getState()===lg.READY?x.H.gl.yaml.dump(this.Ia,{lineWidth:120}):""};Zg.prototype.i=function(){Zg.g.i.call(this);delete this.ko;delete this.uc};function fh(a){var b=a.Ia,c;if(ya(b)){var d;if(d=a.ps){b=b&&b.sources;d=!1;for(var e in b)if(b[e].type===a.ps){d=!0;break}d=!(b?d:1)}d&&(c="invalid source, the only valid type is "+a.ps)}else c="invalid style configuration";c&&a.Dc(c);return!c}function dh(a){a.dispatchEvent(new ie("change",a))}
function bh(a){if(a.getState()!==lg.READY)throw new Ab(a.Wj,"style is not ready yet");}function ch(a,b,c,d){var e=[],f=ib(b)?b:[b],g,h;void 0===d&&(d=!0);for(f=f.sort().reverse();g=f.pop();){b=String(g).split(".");a:{var k=a.Ia;for(var l=b.length;l--&&!vg[b[l]];);if(k&&0>l&&(k=tg(k.layers,b),qg(k)))break a;k=rg}if(k===rg)throw new D(c,0,'Unresolvable layer ID "'+g+'"');e.push({id:b,yb:k});if(d)for(h in k)!vg[h]&&qg(k[h])&&f.push(g+"."+h)}return e}
function eh(a,b){var c=0,d;for(d=b.length;c!==d;){var e=b[c++];var f=a;a=f[e];if(!a)break}return c===d?{node:a,parent:f,An:e}:void 0}var $g=/^(http[s]?)?.*\.ya?ml/i;
function ah(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?{}:d;try{var e=x.H.gl.yaml.load(a,{json:!0})}catch(f){return Promise.reject(f)}return e&&(a=e["import"],jb(a)&&(a=[a]),c&&b&&gh(e,b),delete e["import"],ib(a)&&a.length)?(c=a.reduce(function(f,g){var h=b?ig(g,b):g;d[h]||(d[h]=!0,f.push((new Tg("text/plain",h)).then(function(k){return ah(k,h,!0,d)})));return f},[]),Promise.all(c).then(function(f){var g={};f.forEach(function(h){return h&&pg(g,h)});pg(g,e);return g})):Promise.resolve(e)}
function gh(a,b){function c(g){g.url&&(g.url=ig(g.url,b))}var d=a&&a.fonts;if(d)for(var e in d)ib(d[e])?d[e].forEach(c):c(d[e]);if(a=a&&a.textures)for(var f in a)c(a[f])}Zg.normalize=gh;Zg.prototype.yg=function(a){Zg.g.yg.call(this,a);fh(this)&&(this.G(lg.READY),dh(this))};Zg.prototype.Pd=function(){return Zg.g.Pd.call(this)};Zg.prototype.getConfig=Zg.prototype.Pd;Zg.prototype.Fc=function(){return this.OA||Zg.g.Fc.call(this)};Zg.prototype.getBaseUrl=Zg.prototype.Fc;var hh={PROVIDES_BY_VIEWPORT:1,PROVIDES_RASTERS:2,PROVIDES_SPATIALS:4,PROVIDES_OVERLAYS:8,PROVIDES_MARKERS:16,PROVIDES_DOM_MARKERS:32,PROVIDES_GEOJSON:64,PROVIDES_OMV:128,CROP_LINES_BY_TILE:256,CROP_POLYGONS_BY_TILE:512,HAS_VOLATILE_DATA:1024};t("H.map.provider.Capabilities",hh);hh.PROVIDES_WEBGL_RENDERABLE_OBJECTS=hh.PROVIDES_SPATIALS|hh.PROVIDES_OVERLAYS|hh.PROVIDES_MARKERS;function ih(a){this.Ba=a}
ih.prototype.Fe=function(){var a={};this.Ba&hh.PROVIDES_RASTERS&&(a={"translucent-raster":Gg("raster","inlay",1)});if(this.Ba&hh.PROVIDES_WEBGL_RENDERABLE_OBJECTS){var b=!!(this.Ba&hh.CROP_LINES_BY_TILE),c={"translucent-polygons":Gg("polygons","inlay",2),"translucent-extruded-polygons":Gg("polygons","translucent",3),"translucent-pattern-lines":Gg("pattern-lines","translucent",4),"translucent-overlays":Gg("overlays","inlay",5),markers:Gg("custom_icons","overlay",6,!1)};c["translucent-polygons"].crop_by_tile=!!(this.Ba&
hh.CROP_POLYGONS_BY_TILE);c["translucent-pattern-lines"].crop_by_tile=b;c.markers.suppress_fade=!0;c.markers.stick=!0;Ta(a,c)}return a};function jh(a,b,c){this.Ba=a;this.uid=b;this.opacity=c;this.Tm=this.Ba&hh.PROVIDES_BY_VIEWPORT?"function(){return sources[$source].isInMinMaxRange(feature, $zoom) && feature.ref.effectiveVisibility;}":B;this.Vf={}}
jh.prototype.Fe=function(){this.Ba&hh.PROVIDES_RASTERS&&(this.Vf["tile_layer_"+this.uid]=Ig(this.uid,"_default",{"translucent-raster":{color:[1,1,1,this.opacity],order:0}}));if(this.Ba&hh.PROVIDES_SPATIALS){var a={"translucent-pattern-lines":{color:Fg("strokeColor"),width:Fg("lineWidth * $meters_per_pixel"),join:Fg("lineJoin"),cap:Fg("lineCap"),tail_cap:Fg("lineTailCap"),head_cap:Fg("lineHeadCap"),miter_limit:Fg("miterLimit"),order:"function() { return 2 + feature.effectiveZIdx / 2; }",interactive:!0,
dash:Fg("lineDash"),extrude:!0,dash_phase:Fg("lineDashOffset")}};var b=this.Vf,c="polygon_layer_"+this.uid;var d=Ig(this.uid,"polygons",void 0,this.Tm);d.flat={filter:"function(){return !feature.height && !feature.min_height;}",draw:Hg(!1)};d.extruded={filter:"function(){return feature.height || feature.min_height;}",draw:Hg(!0)};b[c]=d;this.Vf["outline_layer_"+this.uid]=Ig(this.uid,"outlines",a,this.Tm);this.Vf["polyline_layer_"+this.uid]=Ig(this.uid,"polylines",a,this.Tm)}this.Ba&hh.PROVIDES_OVERLAYS&&
(this.Vf["overlay_layer_"+this.uid]=Ig(this.uid,"overlays",{"translucent-overlays":{color:[1,1,1,this.opacity],order:8190,interactive:!0}}));this.Ba&hh.PROVIDES_MARKERS&&(this.Vf["marker_layer_"+this.uid]=Ig(this.uid,"markers",{markers:{sprite:Eg("icon.id"),offset:Eg("icon.offset"),collide:!1,priority:8191,elevate_by_altitude:!0,interactive:!0,stick:{color:Eg("icon.stick_color"),height:Eg("icon.stick_height")}}},this.Tm));return this.Vf};function kh(a,b,c,d,e){this.Ba=a;this.uid=b;this.vv=c;this.Fq=d;this.tileSize=e}kh.prototype.Fe=function(){var a={};a[this.uid]=this.Ba&hh.PROVIDES_BY_VIEWPORT?lh(this,"ObjectSource",!1,{progressiveUpdate:!0,has_volatile_data:!!(this.Ba&hh.HAS_VOLATILE_DATA)}):this.Ba&hh.PROVIDES_RASTERS?lh(this,"RemoteRasterTileSource",!0,{url:""}):lh(this,"ObjectTileSource",!0,{tile_size:this.tileSize});return a};function lh(a,b,c,d){a={type:b,uid:a.uid,tiled:c,max_zoom:a.Fq};d&&Ta(a,d);return a};function mh(a,b,c,d,e,f){this.Ba=a;this.uid=b;this.vv=c;this.Fq=d;this.opacity=e;this.tileSize=f}mh.prototype.Fe=function(){if(this.Ba&hh.PROVIDES_DOM_MARKERS&&!(this.Ba&hh.PROVIDES_MARKERS))return{};var a=new kh(this.Ba,this.uid,this.vv,this.Fq,this.tileSize);var b=new ih(this.Ba);var c=new jh(this.Ba,this.uid,this.opacity);a=a.Fe();b=b.Fe();c=c.Fe();return{sources:a,styles:b,layers:c}};function nh(a,b,c){nh.g.constructor.call(this,a);this.oldValue=c;this.newValue=b}u(nh,ie);t("H.util.ChangeEvent",nh);function N(a){var b=""+Ue(),c;N.g.constructor.call(this);a=a||{};this.min=a.min||0;this.max=a.max||22;if(c=a.uri){if(/_/.test(c))throw new D(N,0,"uri "+c);}else c=b;this.uri=c||b;this.uid=b;a.getCopyrights&&gb(a.getCopyrights,"Function",N)&&(this.getCopyrights=a.getCopyrights);this.Eb=this.Eb.bind(this);this.gq=!0;this.vb=a.engineType||oh;if(this.vb===ph.HARP&&!H.map.render.harp)throw new D(N,0,"HARP engine is not supported, module not found");}u(N,J);t("H.map.provider.Provider",N);m=N.prototype;
m.l={Hi:"configchange",Aa:"update"};m.kb=function(a,b){this.dispatchEvent(new Fe(this.l.Aa,b,a))};m.Eb=function(a){a=new nh(this.l.Hi,a&&a.newValue,a&&a.oldValue);this.dispatchEvent(a)};m.i=function(){J.prototype.i.call(this);this.Za&&(this.Za.removeEventListener("change",this.Eb),this.Za.u(),delete this.Za)};m.V=function(){return null};N.prototype.getCopyrights=N.prototype.V;
N.prototype.getCapabilities=function(){var a=0;this.kr()&&(a|=hh.PROVIDES_BY_VIEWPORT);this.providesRasters()&&(a|=hh.PROVIDES_RASTERS);this.providesSpatials()&&(a|=hh.PROVIDES_SPATIALS);this.providesOverlays()&&(a|=hh.PROVIDES_OVERLAYS);this.providesMarkers()&&(a|=hh.PROVIDES_MARKERS);this.providesDomMarkers()&&(a|=hh.PROVIDES_DOM_MARKERS);this.providesGeoJSON()&&(a|=hh.PROVIDES_GEOJSON);this.providesOMV()&&(a|=hh.PROVIDES_OMV);return a};N.prototype.getCapabilities=N.prototype.getCapabilities;
N.prototype.kr=We;N.prototype.nk=We;N.prototype.providesRasters=N.prototype.nk;N.prototype.ie=We;N.prototype.providesSpatials=N.prototype.ie;N.prototype.mr=We;N.prototype.providesOverlays=N.prototype.mr;N.prototype.Sc=We;N.prototype.providesMarkers=N.prototype.Sc;N.prototype.Rc=We;N.prototype.providesDomMarkers=N.prototype.Rc;N.prototype.lr=We;N.prototype.providesGeoJSON=N.prototype.lr;N.prototype.Tc=We;N.prototype.providesOMV=N.prototype.Tc;N.prototype.yz=function(){return this.vb};
N.prototype.getEngineType=N.prototype.yz;N.prototype.NC=function(a){this.vb=a};N.prototype.setEngineType=N.prototype.NC;N.prototype.lk=Xe;N.prototype.preprocessData=N.prototype.lk;N.prototype.Oc=1;N.prototype.zg=function(a){a=ec(a,0,1);E(a)&&(a=1);this.Oc!==a&&(this.Oc=a,this.gq&&qh(this),this.Eb(),this.kb())};N.prototype.$z=function(){return this.Oc};N.prototype.getOpacityInternal=N.prototype.$z;
N.prototype.Ya=function(a,b){var c=this;if(this.vb===ph.WEBGL&&!C(a,Zg)||this.vb===ph.HARP&&!C(a,H.map.render.harp.Style))throw a=Object.entries(ph).find(function(d){return d[1]===c.vb}),new D(this.Ya,0,"Invalid style for engineType "+a);this.Za&&(this.Za.removeEventListener("change",this.Eb),this.Za.removeEventListener(mg,this.Eb),this.Za.u());this.Za=a;this.Za.addEventListener("change",this.Eb);this.Za.addEventListener(mg,this.Eb);b||this.Eb();this.gq=!1};N.prototype.setStyleInternal=N.prototype.Ya;
N.prototype.nb=function(){this.Za||qh(this);return this.Za};N.prototype.getStyleInternal=N.prototype.nb;function qh(a){if(a.vb===ph.WEBGL){var b=new mh(a.getCapabilities(),a.uid,a.min,a.max,a.Oc,a.tileSize);a.Za=new Zg(b.Fe())}else a.vb===ph.HARP&&H.map.render.harp&&(a.Za=new H.map.render.harp.Style({}));a.gq=!0}
N.prototype.mu=function(){var a=this.getCapabilities(),b=og.FEATURE;a&hh.PROVIDES_BY_VIEWPORT?b=og.SOURCE:a&hh.PROVIDES_RASTERS?b=null:a&hh.PROVIDES_WEBGL_RENDERABLE_OBJECTS&&(b=og.PROVIDER);return b};N.prototype.getPickingMode=N.prototype.mu;N.prototype.Dz=function(){return!1};N.prototype.getFeatureProxy=N.prototype.Dz;function rh(){}function sh(a){return Cb(1,Db(0,.5-Ib(Pb(Vb+Ub*a/180))/Tb/2))}rh.prototype.Km=function(a,b,c){c?(c.x=b/360+.5,c.y=sh(a)):c=new L(b/360+.5,sh(a));return c};rh.prototype.latLngToPoint=rh.prototype.Km;rh.prototype.Ne=function(a,b){return this.Km(a.lat,a.lng,b)};rh.prototype.geoToPoint=rh.prototype.Ne;function th(a){return 0>=a?90:1<=a?-90:Zb*(2*Qb(Lb(Tb*(1-2*a)))-Ub)}
rh.prototype.$a=function(a,b,c){c?(c.lat=th(b),c.lng=360*(1===a?1:cc(a,1))-180):c=new pc(th(b),360*(1===a?1:cc(a,1))-180);return c};rh.prototype.xyToGeo=rh.prototype.$a;rh.prototype.sn=function(a,b){return this.$a(a.x,a.y,b)};rh.prototype.pointToGeo=rh.prototype.sn;var uh=new rh;t("H.geo.mercator",uh);function vh(a,b){this.projection=a||uh;this.Ei=0;this.Zk=this.exp=Ib(b||256)/Sb;wh(this);this.y=this.x=0}t("H.geo.PixelProjection",vh);var xh=Hb(24)+Hb(-8);vh.prototype.zn=uh;vh.prototype.projection=vh.prototype.zn;vh.prototype.x=0;vh.prototype.x=vh.prototype.x;vh.prototype.y=0;vh.prototype.y=vh.prototype.y;vh.prototype.w=Kb(2,xh);vh.prototype.w=vh.prototype.w;vh.prototype.GA=Kb(2,xh);vh.prototype.h=vh.prototype.GA;
vh.prototype.Wa=function(a){if(E(a))throw new D(this.Wa,0,a);var b=this.x/this.w;var c=this.y/this.h;this.Ei=a;this.Zk=this.exp+a;wh(this);this.x=b*this.w;this.y=c*this.h};vh.prototype.rescale=vh.prototype.Wa;function wh(a){a.Zk>xh&&(a.Zk=xh);a.w=Kb(2,a.Zk);a.h=Kb(2,a.Zk)}vh.prototype.su=function(){return this.Ei||0};vh.prototype.getZoomScale=vh.prototype.su;vh.prototype.Gb=function(a,b){a=this.projection.Km(a.lat,a.lng,b);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};
vh.prototype.geoToPixel=vh.prototype.Gb;vh.prototype.gk=function(a,b){return this.projection.$a((a.x+this.x)/this.w,(a.y+this.y)/this.h,b)};vh.prototype.pixelToGeo=vh.prototype.gk;vh.prototype.$a=function(a,b,c){return this.projection.$a((a+this.x)/this.w,(b+this.y)/this.h,c)};vh.prototype.xyToGeo=vh.prototype.$a;vh.prototype.rq=function(a,b,c){a=this.projection.Km(a,b,c);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};vh.prototype.latLngToPixel=vh.prototype.rq;
vh.prototype.Zh=function(a){return new L(a.x*this.w-this.x,a.y*this.h-this.y)};vh.prototype.pointToPixel=vh.prototype.Zh;function yh(a){a=a||{};yh.g.constructor.call(this);this.min=0;this.max=22;this.By=this.dark=!!a.dark;a.min&&this.Or(a.min);a.max&&this.Mr(a.max);this.pixelProjection=new vh(a.projection,a.minWorldSize);a.provider&&(this.D=a.provider,this.kb=A(this.kb,this),this.D.addEventListener(N.prototype.l.Aa,this.kb,!1,this),this.Eb=A(this.Eb,this),this.D.addEventListener(N.prototype.l.Hi,this.Eb,!1,this))}u(yh,J);t("H.map.layer.Layer",yh);yh.prototype.min=0;yh.prototype.min=yh.prototype.min;
yh.prototype.max=22;yh.prototype.max=yh.prototype.max;yh.prototype.l={Aa:"update",Hi:"configchange",Ms:"minchange",Ls:"maxchange"};yh.prototype.Lp=function(){return this.D};yh.prototype.getProvider=yh.prototype.Lp;yh.prototype.VA=function(a){return this.min<=a&&a<=this.max};yh.prototype.isValid=yh.prototype.VA;
function zh(a,b,c){var d=a[b],e="min"===b,f=e?a.Or:a.Mr;if(c!==d)if(e?c<=a.max:c>=a.min)a[b]=c,a.kb(),a.Eb(),a.dispatchEvent(new nh(e?a.l.Ms:a.l.Ls,c,d));else throw new D(f,0,"Invalid condition min <= max");return a}yh.prototype.Or=function(a){return zh(this,"min",+a)};yh.prototype.setMin=yh.prototype.Or;yh.prototype.Mr=function(a){return zh(this,"max",+a)};yh.prototype.setMax=yh.prototype.Mr;yh.prototype.kb=function(){this.dispatchEvent(this.l.Aa)};
yh.prototype.Eb=function(a){a=new nh(this.l.Hi,a&&a.newValue,a&&a.oldValue);this.dispatchEvent(a)};yh.prototype.i=function(){yh.g.i.call(this)};yh.prototype.V=function(){return null};yh.prototype.getCopyrights=yh.prototype.V;function Ah(a,b){b=b||{};if(!a)throw new D(Ah,0,a);this.tileSize=a.tileSize;this.kx={};yh.call(this,{min:void 0!==b.min?b.min:a.min,max:void 0!==b.max?b.max:a.max,minWorldSize:this.tileSize,projection:b.zn,dark:b.dark,provider:a})}u(Ah,yh);t("H.map.layer.BaseTileLayer",Ah);Ah.prototype.wj=function(a,b){var c=this.pixelProjection;if(!C(a,F))throw new D(this.wj,0,a);if(!E(b)){var d=c.su();c.Wa(b)}a=gg(c.Gb(a.Kc()),c.Gb(a.Gc()));!E(d)&&c.Wa(d);return a};Ah.prototype.geoRectToRect=Ah.prototype.wj;
Ah.prototype.Bh=function(a,b){var c=Kb(2,Fb(b)),d=this.tileSize;if(!C(a,fg))throw new D(this.Bh,0,a);if(E(b=+b))throw new D(this.Bh,1,b);b=Fb(a.left/d);b===c&&--b;var e=Fb(a.right/d);e===c&&--e;return new fg(b,ec(Fb(a.top/d),0,c-1),e,ec(Fb(a.bottom/d),0,c-1))};Ah.prototype.getTileBounds=Ah.prototype.Bh;Ah.prototype.Oa=function(a,b,c,d){return this.D.requestTile(a,b,c,d)};Ah.prototype.requestTile=Ah.prototype.Oa;Ah.prototype.Kd=function(a,b,c){this.D.cancelTile(a,b,c)};Ah.prototype.cancelTile=Ah.prototype.Kd;
Ah.prototype.V=function(a,b){return this.D.getCopyrights?this.D.getCopyrights(a,b):null};Ah.prototype.getCopyrights=Ah.prototype.V;function Bh(a,b,c,d,e){d=Fb(d);var f=Kb(2,d),g=b.left,h=b.top,k=b.right;c=k+(c?f+(k===b.left?0:1):1);var l=b.bottom,n=[];if(e){var p=g+(1+k-g)/2+e.x/a.tileSize-.5;var q=h+(1+l-h)/2+e.y/a.tileSize-.5}for(;g<c;){for(h=b.top;h<=l;)a=gNaN,n.push([a,h,d,e?Hb(p-g)+Hb(q-h):0]),h++;g++}return n}
Ah.prototype.Gj=function(a,b,c,d,e,f){var g,h=[],k,l=this.D;f=null!=f?f:"__default__";var n=l.requestTile;if(!C(a,fg))throw new D(this.Gj,0,a);if(E(c=+c))throw new D(this.Gj,1,c);d||(g={});b=Bh(this,a,b,c,e);if(a=b.length)for(d||b.sort(Ch),c=a;c--;)e=b[c],d||(g[l.Sd.apply(l,e)]=!0),e[3]=+d,(k=n.apply(l,e))&&h.push(k);if(!d){d=g;var p;g=this.kx[f]||{};for(p in g)g.hasOwnProperty(p)&&g[p]&&!d[p]&&this.D.cancelTileByKey(p);this.kx[f]=d}return{total:a,tiles:h}};Ah.prototype.getProviderTiles=Ah.prototype.Gj;
function Ch(a,b){return b[3]-a[3]};function Dh(a,b){Dh.g.constructor.call(this,a,b)}u(Dh,Ah);t("H.map.layer.MarkerTileLayer",Dh);var Eh={markers:[],total:0,requested:0};function Fh(a,b,c,d,e){var f=Fb(c);a.pixelProjection.Wa(f);b=a.Bh(a.wj(b),f);c=a.Gj(b,b.left>b.right,~~c,d,e);a=c.tiles;c=c.total;d=a.length;e=[];var g;for(g=0;g<d;g++)for(b=a[g],f=b.data.length;f--;)e.push(b.data[f]);return{markers:e,total:a.length,requested:c}}Dh.prototype.le=function(a,b,c,d){return this.D.providesDomMarkers()?Eh:Fh(this,a,b,c,d)};
Dh.prototype.requestMarkers=Dh.prototype.le;Dh.prototype.ke=function(a,b,c,d){return this.D.providesDomMarkers()?Fh(this,a,b,c,d):Eh};Dh.prototype.requestDomMarkers=Dh.prototype.ke;t("H.util.events.listenOnce",re);t("H.util.events.dispatchEvent",function(a,b){return a.dispatchEvent(b)});t("H.util.events.fireListeners",function(a,b,c,d){if(me(a))c=a.Ef(b,c,d);else{var e=!0;if(a=ue(a))if(b=a.qb[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.fi&&(f=Ae(f,d),e=e&&!1!==f)}c=e}return c});t("H.util.events.listen",qe);t("H.util.events.unlisten",ye);var Gh=Ae;
Ae=function(a,b){var c,d,e=!0;var f=b[b.currentTarget===b.target?"AT_TARGET":a.capture?"CAPTURING_PHASE":(c=!0,"BUBBLING_PHASE")];if(!c||"pointerenter"!==(d=b.type)&&"pointerleave"!==d)b.eventPhase=f,e=Gh(a,b),c&&a.src&&a.src.Jc&&null===a.src.Jc()&&delete b.eventPhase;return e};function Hh(){}t("H.map.provider.Invalidations",Hh);Hh.MARK_INITIAL=ac;Hh.prototype.update=function(a,b){b!==Ih.NONE&&(this.Jd=a,b&Ih.SPATIAL&&(this.Xw=a),b&Ih.VISUAL&&(this.xx=a),b&Ih.ADD&&(this.Ws=a),b&Ih.REMOVE&&(this.sw=a),b&Ih.Z_ORDER&&(this.Bx=a),b&Ih.VOLATILITY&&(this.yx=a))};Hh.prototype.update=Hh.prototype.update;Hh.prototype.Wz=function(){return this.Jd};Hh.prototype.getMark=Hh.prototype.Wz;Hh.prototype.Jd=ac;Hh.prototype.RA=function(a){return this.Jd>a};Hh.prototype.isAny=Hh.prototype.RA;
Hh.prototype.xx=ac;Hh.prototype.Gh=function(a){return this.xx>a};Hh.prototype.isVisual=Hh.prototype.Gh;Hh.prototype.Xw=ac;Hh.prototype.nq=function(a){return this.Xw>a};Hh.prototype.isSpatial=Hh.prototype.nq;Hh.prototype.Ws=ac;Hh.prototype.Ku=function(a){return this.Ws>a};Hh.prototype.isAdd=Hh.prototype.Ku;Hh.prototype.sw=ac;Hh.prototype.Dm=function(a){return this.sw>a};Hh.prototype.isRemove=Hh.prototype.Dm;Hh.prototype.Bx=ac;Hh.prototype.pq=function(a){return this.Bx>a};Hh.prototype.isZOrder=Hh.prototype.pq;
Hh.prototype.yx=ac;Hh.prototype.WA=function(a){return this.yx>a};Hh.prototype.isVolatility=Hh.prototype.WA;var Ih={NONE:0,VISUAL:1,SPATIAL:2,ADD:4,REMOVE:8,Z_ORDER:16,VOLATILITY:32};Hh.Flag=Ih;function Jh(a,b){this.w=+a;this.h=+b}t("H.math.Size",Jh);function Kh(a,b,c,d,e){b&&(this.bf=b);db(c)&&(this.Co=!!c);this.Co&&d&&(this.Do=new Jh(d.w,d.h));db(e)&&(this.wk={crossOrigin:e});switch(Lh[hb(a)]){case 2:this.hb=a;Mh(this,1);break;case 1:if(cf(a)){this.hb=a;Nh(this);Mh(this,1);break}a=a.src;case 0:if(a){a=Re(a);this.vm=new Tg("image",a,B,this.wk);this.vm.then(A(this.NB,this),A(this.MB,this));break}default:throw Mh(this,-1),new D(Kh,0,"No image data");}}Kh.prototype.o=0;Kh.prototype.getState=function(){return this.o};
function Mh(a,b){a.o=b;delete a.vm;a.bf&&a.bf(b,a)}Kh.prototype.Co=!0;function Nh(a){if(a.Co){var b=a.hb,c=Oh(a),d=c&&c.w||+b.width,e=c&&c.h||+b.height,f=Ie();if(C(b,x.HTMLCanvasElement))c=b;else{c=b.ownerDocument.createElement("canvas");c.width=Gb(d*f);c.height=Gb(e*f);var g=c.getContext("2d");g.scale(f,f);g.drawImage(b,0,0,d,e);La&&(g.clearRect(0,0,d,e),g.drawImage(b,0,0,d,e))}a.hb=c}}Kh.prototype.getData=function(){return this.hb||z};var Lh={String:0,HTMLImageElement:1,HTMLCanvasElement:2};m=Kh.prototype;
m.Do=z;m.lc=function(){return 1===this.o?Oh(this):z};function Oh(a){var b=a.Do,c;if(!b){var d=a.hb;b=d.naturalWidth||d.width;if(0===b&&Pe&&1===Lh[hb(d)]){var e=!0;if(c=d.parentNode)var f=d.nextSibling;document.body.appendChild(d)}a.Do=b=new Jh(d.naturalWidth||d.width,d.naturalHeight||d.height);e&&(c?c.insertBefore(d,f):document.body.removeChild(d))}return b}m.NB=function(a){this.hb=a;Nh(this);Mh(this,1)};m.MB=function(){Mh(this,-1)};m.cancel=function(){this.vm&&this.vm.cancel()};function Ph(a,b){var c;var d=a;var e=b||[];if(a!==Qh.NONE){b=c=e.length;if(-1===Rh.indexOf(d))throw new D(Ph,0,a);if(!e)throw new D(Ph,1,e);for(;c--;)if(E(e[c]))throw new D(Ph,1,e);d===Qh.RECT&&3<b&&(e=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]],d=Qh.POLYGON);if(d===Qh.CIRCLE&&2<b&&(a=e[2],0<a)){d=e[0];var f=e[1];c=Cb(2*Gb(a),40);var g=360/c;for(e=[];c--;){var h=g*c*Yb;e.push(d+Mb(h)*a,f+Ob(h)*a)}d=Qh.POLYGON}if(d!==Qh.POLYGON||!b||e.length%2)throw new D(Ph,1,e);this.aw=e}}t("H.map.HitArea",Ph);
var Qh={NONE:0,RECT:1,CIRCLE:2,POLYGON:3};Ph.ShapeType=Qh;var Rh=[Qh.RECT,Qh.CIRCLE,Qh.POLYGON];Ph.prototype.um=function(a,b,c){return this.aw?hc(a,b,this.aw,c,!0):gc.NONE};Ph.prototype.hitTest=Ph.prototype.um;function Sh(a,b){var c,d="anonymous";this.uid=Th.next();Sh.g.constructor.call(this);if(b){var e="size";if(e in b){var f=b[e];if(!f||isNaN(f.w)||isNaN(f.h))throw new D(Sh,1,e);this.Zn=new Jh(f.w,f.h)}e="anchor";if(e in b){f=b[e];if(!f||isNaN(f.x)||isNaN(f.y))throw new D(Sh,1,e);this.Cb=new L(f.x,f.y)}e="hitArea";e in b&&(f=b[e],C(f,Ph,Sh,1),this.tm=b[e]);e="asCanvas";e in b&&(c=b[e]);e="crossOrigin";e in b&&(d=b[e]);f=b.stickHeight;f===+f&&0<f&&(this.aD=f);e="stickColor";f=b[e];e in b&&jb(f)&&(this.$C=
f)}a=new Kh(a,A(this.Sg,this),c,this.Zn,d);b=this.o=a.getState();0!==b?this.Sg(b,a):this.ul=a}u(Sh,J);t("H.map.Icon",Sh);var Th=new Se;Sh.State={ERROR:-1,LOADING:0,READY:1};Sh.prototype.getState=function(){return this.o};Sh.prototype.getState=Sh.prototype.getState;Sh.prototype.Sg=function(a,b){this.hb=b.getData();if(1===a){var c=this.Zn;c||(c=this.Zn=b.lc());this.Cb||(this.Cb=new L(c.w/2|0,c.h))}this.ul&&(this.o=a,delete this.ul,this.dispatchEvent("statechange"))};Sh.prototype.hb=z;
Sh.prototype.Oe=function(){return this.hb};Sh.prototype.getBitmap=Sh.prototype.Oe;Sh.prototype.lc=function(){return this.Zn||z};Sh.prototype.getSize=Sh.prototype.lc;Sh.prototype.Cb=z;Sh.prototype.tp=function(){return this.Cb};Sh.prototype.getAnchor=Sh.prototype.tp;Sh.prototype.tm=z;Sh.prototype.Iz=function(){return this.tm};Sh.prototype.getHitArea=Sh.prototype.Iz;Sh.prototype.i=function(){Sh.g.i.call(this);this.hb?(this.hb.removeAttribute("src"),delete this.hb):(this.ul.cancel(),delete this.ul)};function Uh(a){Uh.g.constructor.call(this);void 0!==a&&(this.data=a)}u(Uh,J);t("H.map.Feature",Uh);Uh.prototype.getData=function(){return this.data};Uh.prototype.getData=Uh.prototype.getData;Uh.prototype.i=function(){Uh.g.i.call(this);delete this.data};function O(a){eb(this,O);O.g.constructor.call(this,a?a.data:B);this.Jj=Vh.next();if(a){var b="min";ob(a[b])&&(this.zb=a[b]);b="max";ob(a[b])&&(this.Nc=a[b]);b="visibility";b in a&&(this.Id=!!a[b]);b="volatility";b in a&&(this.fo=!!a[b]);b="zIndex";b in a&&(this.Di=+a[b]||0);b="provider";b in a&&!C(a[b],P)&&(this.D=a[b],this.sa(Ih.ADD))}}u(O,Uh);t("H.map.Object",O);var Vh=new Se(1),Wh={ANY:31,OVERLAY:1,SPATIAL:2,MARKER:4,DOM_MARKER:8,GROUP:16};O.Type=Wh;O.prototype.xb=function(){return this.Jj};
O.prototype.getId=O.prototype.xb;O.prototype.Ur=function(a){if(!ob(a)&&!jb(a))throw new D(this.Ur,0,"id must be a number or a string");this.di=a;return this};O.prototype.setRemoteId=O.prototype.Ur;O.prototype.mA=function(){return this.di};O.prototype.getRemoteId=O.prototype.mA;O.prototype.zb=-1/0;O.prototype.Nc=1/0;O.prototype.gu=function(a){var b=this.Nc;if(a)for(a=this;a=a.Ma;)b=Cb(b,a.Nc);return b};O.prototype.getMax=O.prototype.gu;
O.prototype.iu=function(a){var b=this.zb;if(a)for(a=this;a=a.Ma;)b=Db(b,a.zb);return b};O.prototype.getMin=O.prototype.iu;O.prototype.Id=!0;O.prototype.Zb=function(a){var b=this.Id;(a=!!a)!==b&&(this.Id=a,this.invalidate(Ih.VISUAL));return this};O.prototype.setVisibility=O.prototype.Zb;O.prototype.Td=function(a){for(var b=this,c;(c=b.Id)&&a&&(b=b.Ma););return c};O.prototype.getVisibility=O.prototype.Td;O.prototype.fo=!1;O.prototype.lm=function(a){for(var b=this,c;!(c=b.fo)&&a&&(b=b.Ma););return c};
O.prototype.getVolatility=O.prototype.lm;O.prototype.Rw=function(a){var b=this.fo;b!==!!a&&(this.fo=!b,this.invalidate(Ih.VOLATILITY));return this};O.prototype.setVolatility=O.prototype.Rw;O.prototype.Di=B;O.prototype.ru=function(){return this.Di};O.prototype.getZIndex=O.prototype.ru;O.prototype.pi=function(a){a!==this.Di&&(this.xk(),this.Di=a,this.invalidate(Ih.Z_ORDER));return this};O.prototype.setZIndex=O.prototype.pi;O.prototype.lo=B;
O.prototype.Re=function(){var a=this.lo,b,c;if(!a){var d=+((b=this.Di)!==B);(a=this.Ma)?(a=a.Re().slice(),a[0]|=d):a=[d];a.push(b||0,0>(c=this.Yr)?this.Jj:c);this.lo=a}return a};O.prototype.getZInfo=O.prototype.Re;O.prototype.xk=function(){this.lo=B};function Xh(a,b,c){var d,e;if(!c||a[0]|b[0]){var f=a.length;var g=b.length;var h=Cb(f,g);var k=1;for(e=1+ +c;k<h;k+=e)if(d=a[k]-b[k])return d}return c?0:f-g}O.compareZInfo=Xh;function Yh(a,b){return a.mt(b)}O.compareZOrder=Yh;
O.prototype.mt=function(a){return this.mo-a.mo||Xh(this.Re(),a.Re(),!1)};O.prototype.compareZOrder=O.prototype.mt;m=O.prototype;m.previousSibling=z;m.nextSibling=z;m.Yr=-1;m.Ma=z;m.aA=function(){return this.Ma};O.prototype.getParentGroup=O.prototype.aA;O.prototype.pd=function(){for(var a=this,b;b=a.Ma;)a=b;return a};O.prototype.getRootGroup=O.prototype.pd;O.prototype.contains=function(a){return this===a};O.prototype.contains=O.prototype.contains;
O.prototype.fa=function(a){if(this.Ma)throw new Ab(this.fa,"Not allowed for a child of a group");O.g.fa.call(this,a)};O.prototype.setParentEventTarget=O.prototype.fa;O.prototype.draggable=O.prototype.draggable=!1;O.prototype.D=z;O.prototype.Lp=function(){return this.D};O.prototype.getProvider=O.prototype.Lp;
O.prototype.oi=function(a,b){var c=this.D,d;if(d=c!==a){if(b&&(c&&!C(c,P)||a&&!C(a,P)))throw new Ab(b,"Only LocalObjectProvider allows an object transfers");b=this.type!==Wh.GROUP;c&&(this.invalidate(Ih.REMOVE),b&&c.Na(this));if(this.D=a)b&&a.$(this),this.Qf=z,this.invalidate(Ih.ADD)}return d};O.prototype.Qf=z;O.prototype.Hc=function(){return this.Qf||(this.Qf=new Hh)};O.prototype.getInvalidations=O.prototype.Hc;O.prototype.sa=function(a){var b=this.D,c;(c=!!b)&&b.invalidateObject(this,a);return c};
O.prototype.invalidate=O.prototype.sa;O.prototype.i=function(){this.Ma&&this.Ma.Na(this);O.g.i.call(this)};O.prototype.setData=function(a){this.data=a;return this};O.prototype.setData=O.prototype.setData;O.prototype.ue=function(a){if(a&&!ab(a))throw new D(O.prototype.ue,0,"opt_callback must be a function");a=Zh(this,a?a(this.data):this.data,!!a);a=ab(this.W)?{type:"Feature",properties:a,geometry:this.W().ue()}:{type:"FeatureCollection",features:Ye};this.di&&(a.id=this.di);return a};
O.prototype.toGeoJSON=O.prototype.ue;function Zh(a,b,c){if(null===b||b===B)return null;if(0<=Object.keys(b).length&&"[object Object]"!==Object.prototype.toString.call(b))throw Error($h(a,c));try{return JSON.stringify(b),b}catch(d){throw Error($h(a,c));}}
function $h(a,b){return"Object Remote-Id: "+a.di+" - "+(b?"The value returned by the callback is not a valid JSON object and cannot be set as Feature properties.":"The given object data is not a valid JSON object and cannot be set as Feature properties.")}O.prototype.R=function(){return{id:this.Jj,properties:{min:this.iu(),max:this.gu(),zIdx:this.Di,sIdx:this.Yr,parent:this.Ma?this.Ma.xb():0,visible:this.Td(),"volatile":this.lm()},type:"Feature"}};O.prototype.forWorkerMessage=O.prototype.R;function ai(a,b){var c;eb(this,ai);ai.g.constructor.call(this,b);this.Y(a);b&&"icon"in b&&(c=b.icon);this.re(c||this.zp())}u(ai,O);t("H.map.AbstractMarker",ai);ai.prototype.W=function(){return this.$l};ai.prototype.getGeometry=ai.prototype.W;ai.prototype.Y=function(a){var b=this.$l;C(a,pc)||C(a,Lf)?this.$l=a:(qc(a,this.Y,0),this.$l=sc(a));b&&this.sa(Ih.SPATIAL);return this};ai.prototype.setGeometry=ai.prototype.Y;ai.prototype.C=function(){return this.$l.C()};ai.prototype.kc=function(){return this.icon};
ai.prototype.getIcon=ai.prototype.kc;ai.prototype.re=function(a){var b=this.icon,c=!b;if(b!==a){if(!this.Ru(a)){if(c)throw new D(this.constructor,1,a);throw new D(this.re,0,a);}this.icon=a;c||this.sa(Ih.VISUAL)}return this};ai.prototype.setIcon=ai.prototype.re;ai.prototype.zp=function(){var a=this.Dy;a||(a=this.constructor.prototype.Dy=this.pt(bi));return a};
var bi={svg:'<svg xmlns="http://www.w3.org/2000/svg" width="38" height="47" viewBox="0 0 38 47"><g fill="none"><path fill="#0F1621" fill-opacity=".4" d="M15 46c0 .317 1.79.574 4 .574s4-.257 4-.574c0-.317-1.79-.574-4-.574s-4 .257-4 .574z"></path><path fill="#01b6b2" d="M33.25 31.652A19.015 19.015 0 0 0 38 19.06C38 8.549 29.478 0 19 0S0 8.55 0 19.059c0 4.823 1.795 9.233 4.75 12.593L18.975 46 33.25 31.652z"></path><path fill="#6A6D74" fill-opacity=".5" d="M26.862 37.5l4.714-4.77c3.822-3.576 5.924-8.411 5.924-13.62C37.5 8.847 29.2.5 19 .5S.5 8.848.5 19.11c0 5.209 2.102 10.044 5.919 13.614l4.719 4.776h15.724zM19 0c10.493 0 19 8.525 19 19.041 0 5.507-2.348 10.454-6.079 13.932L19 46 6.079 32.973C2.348 29.495 0 24.548 0 19.04 0 8.525 8.507 0 19 0z"></path></g></svg>',size:new Jh(38,
47),anchor:new L(19,45),hitArea:new Ph(Qh.POLYGON,[19,46,2,27,0,18,5,6,19,0,32,5,38,15,36,27,19,47])};ai.prototype.R=function(){var a=ai.g.R.call(this),b=this.kc(),c=b.lc(),d=b.Cb;a.geometry=this.W().R();c&&(b=a.properties.icon={id:b.uid},b.size={w:c.w,h:c.h},b.offset=[c.w/2-(d?d.x:0),c.h/2-(d?d.y:0)]);return a};ai.prototype.forWorkerMessage=ai.prototype.R;function ci(a,b){ci.g.constructor.call(this,a,b)}u(ci,ai);t("H.map.Marker",ci);ci.prototype.type=Wh.MARKER;ci.prototype.mo=1;ci.prototype.sa=function(a){if(a!==Ih.VISUAL||1===this.ew||1===this.icon.getState())var b=ci.g.sa.call(this,a);return b||!1};ci.prototype.invalidate=ci.prototype.sa;m=ci.prototype;m.ew=0;m.Ru=function(a){return C(a,Sh)};m.lq=!1;m.Fv=function(){this.sa(Ih.VISUAL)};
m.re=function(a){var b=this.icon;this.lq&&(b.removeEventListener("statechange",this.Fv,!1,this),delete this.lq);b&&(this.ew=b.getState());ci.g.re.call(this,a);0===a.getState()&&(this.lq=!0,re(a,"statechange",this.Fv,!1,this));return this};ci.prototype.setIcon=ci.prototype.re;ci.prototype.pt=function(a){return new Sh(a.svg,a)};ci.prototype.R=function(){var a=this.getIcon(),b=a.aD||0,c=ci.g.forWorkerMessage.call(this),d=c.properties.icon;d&&0<b&&Ta(d,{stick_color:a.$C,stick_height:b});return c};
ci.prototype.forWorkerMessage=ci.prototype.R;function di(a){var b;if(a){var c=ei;for(b=C(a,di);c--;){var d=fi[c];if(a.hasOwnProperty(d)){var e=a[d];if(b)this[d]=e;else{if((e=gi[c](e))===hi)throw new D(di,0,d+": "+a[d]);e!==this[d]&&e!==B&&(this[d]=e)}}}c=b?a.Pj:this.lineWidth&&Oe(this.strokeColor);c||(this.Pj=c);c=b?a.Mc:Oe(this.fillColor);c||(this.Mc=c);c=b?a.Nj:"none"!==this.strokeColor&&this.lineWidth;c||(this.Nj=c)}Ya(this)}t("H.map.SpatialStyle",di);di.prototype.Mc=!0;di.prototype.Pj=!0;di.prototype.Nj=!0;var fi="strokeColor fillColor lineWidth lineCap lineJoin miterLimit lineDash lineDashOffset lineDashImage lineHeadCap lineTailCap".split(" ");
di.prototype.strokeColor="rgba(0,85,170,.6)";di.prototype.strokeColor=di.prototype.strokeColor;di.prototype.fillColor="rgba(0,85,170,.4)";di.prototype.fillColor=di.prototype.fillColor;di.prototype.lineWidth=2;di.prototype.lineWidth=di.prototype.lineWidth;di.prototype.lineCap="round";di.prototype.lineCap=di.prototype.lineCap;di.prototype.lineJoin="miter";di.prototype.lineJoin=di.prototype.lineJoin;di.prototype.miterLimit=1;di.prototype.miterLimit=di.prototype.miterLimit;di.prototype.fB=Ye;
di.prototype.lineDash=di.prototype.fB;di.prototype.lineDashOffset=0;di.prototype.lineDashOffset=di.prototype.lineDashOffset;di.prototype.gB=B;di.prototype.lineDashImage=di.prototype.gB;di.prototype.hB=B;di.prototype.lineHeadCap=di.prototype.hB;di.prototype.iB=B;di.prototype.lineTailCap=di.prototype.iB;var ei=fi.length;di.prototype.ea=function(a){var b=this===a;if(!b&&a){for(b=0;b<ei;b++){var c=fi[b];if(this[c]!==a[c])break}b=b===ei}return b};di.prototype.equals=di.prototype.ea;
di.prototype.bu=function(a){if(a){var b={};Ta(b,this,a)}else b=this;return new di(b)};di.prototype.getCopy=di.prototype.bu;
var hi=Ya({}),gi=[function(a){return a?Xa(a):hi},function(a){return a?Xa(a):hi},function(a){return 0<=a&&100>=a?+a:hi},function(a){a=Xa(a);return"butt"===a||"square"===a||"round"===a||"arrow-head"===a||"arrow-tail"===a?a:hi},function(a){return"round"===a||"bevel"===a||"miter"===a?a:hi},function(a){return 0<a&&100>=a?+a:hi},function(a){return a&&a.every&&a.every(pb)?a:hi},function(a){return E(+a)?hi:+a},function(a){return a===B||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||Object.values(ii).includes(a)?
a:hi},function(a){return db(a)?gi[3](a):B},function(a){return db(a)?gi[3](a):B}],ji=new Image;ji.src="data:image/svg+xml;base64,"+btoa('<svg width="128" height="128" viewBox="0 0 128 128" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><g id="arrow"><path style="fill:#ff0000" d="M 0,0 32,64 2,128 128,64 Z"/></g></svg> ');var ki=new Image;ki.src="data:image/svg+xml;base64,"+btoa('<svg width="128" height="128" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><circle style="fill:#ffffff" cx="64" cy="64" r="64" /></svg>');
var ii={ARROW:ji,CIRCLE:ki};di.DashImage=ii;di.MAX_LINE_WIDTH=100;var li=new di;di.DEFAULT_STYLE=li;var mi="fillColor strokeColor lineWidth lineCap lineJoin miterLimit lineDashOffset lineDash lineTailCap lineHeadCap".split(" ");di.prototype.R=function(){for(var a={},b=mi.length,c;b--;)c=mi[b],a[c]=this[c];return a};di.prototype.forWorkerMessage=di.prototype.R;function ni(a,b,c){this.paths=this.Pc=a;b!==B&&(this.interiorsIndex=this.Mj=b);c!==B&&(this.outlinesIndex=this.on=c)}ni.prototype.Mj=$b;ni.prototype.interiorsIndex=ni.prototype.Mj;ni.prototype.on=$b;ni.prototype.outlinesIndex=ni.prototype.on;var oi=Za(new ni([])),pi=Ya([]);function qi(a){var b;if(a){var c=C(a,qi);for(b in a)if(b in this){var d=a[b];d!==this[b]&&("fillColor"===b||0<(d=+d))&&(this[b]=d)}a=c?a.Mc:!!(Oe(this.fillColor)&&this.width&&this.width);a||(this.Mc=a)}Ya(this)}t("H.map.ArrowStyle",qi);qi.prototype.Mc=!0;qi.prototype.fillColor="rgba(255,255,255,.75)";qi.prototype.width=1.2;qi.prototype.length=1.6;qi.prototype.frequency=5;qi.prototype.au=function(){return new qi(this)};
qi.prototype.ea=function(a){var b=this===a;!b&&a&&(b=a.width===this.width&&a.fillColor===this.fillColor&&a.length===this.length&&a.frequency===this.frequency);return b};qi.prototype.equals=qi.prototype.ea;function ri(a,b){var c;ri.g.constructor.call(this,b);b&&this.Bb(b.style);a&&(this.Se=!0);b&&(c=b.arrows)&&this.Iw(c)}u(ri,O);t("H.map.Spatial",ri);ri.prototype.type=Wh.SPATIAL;ri.prototype.mo=0;ri.prototype.style=li;ri.prototype.L=function(){return this.style};ri.prototype.getStyle=ri.prototype.L;ri.prototype.Bb=function(a){var b=!0;a?this.style=C(a,di)?a:new di(a):this.style?delete this.style:b=!1;b&&this.invalidate(Ih.VISUAL);return this};ri.prototype.setStyle=ri.prototype.Bb;
ri.prototype.gz=function(){return this.Og};ri.prototype.getArrows=ri.prototype.gz;ri.prototype.Iw=function(a){var b=this.Og,c=!1;!a&&b?(delete this.Og,c=!0):!a||b&&b.ea(a)||(this.Og=new qi(a),c=!0);c&&"none"!==this.style.strokeColor&&this.sa(1);return this};ri.prototype.setArrows=ri.prototype.Iw;function si(a,b){var c=!1,d=!1,e;if(b.length){for(c=0;c<b.length;c++)if(b[c]!==oi){d=!0;break}b=a.style;c=d?b.Pj||b.Mc&&a.Se||(e=a.Og||!1)&&b.Nj&&e.Mc:b.Mc}return c&&a.Td(!0)}ri.prototype.Se=!1;
ri.prototype.SA=function(){return this.Se};ri.prototype.isClosed=ri.prototype.SA;ri.prototype.getGeometriesForTile=ri.prototype.sh;ri.prototype.Dp=function(){return B};ri.prototype.getLabels=ri.prototype.Dp;function ti(a,b){ti.g.constructor.call(this,a,b)}u(ti,ri);t("H.map.GeoShape",ti);ti.prototype.getBoundingBox=ti.prototype.C;function ui(a,b,c,d){var e=[],f=b.length,g;for(g=0;g<f;g++){var h=b[g];if(h.length){var k=e,l=k.push,n=void 0,p=a,q=c,r=d,v=[],w=h.length,y=0;p.Bt=0;for(n=n||0;y<w;)v.push(vi(p,h[y++],h[y++],n,r));q&&v.push(vi(p,h[0],h[1],n,r));l.call(k,v)}}return e}function vi(a,b,c,d,e){var f=a.Bt;f&&180<Hb(f-c)&&(c+=0>f?-360:360);a.Bt=c;return e.rq(b,c+d)}
function wi(a,b,c){for(var d=b,e,f=a.length+b,g,h;d--;){b=a[d];g=b.length;for(e=Array(g);g--;)h=b[g],e[g]=new L(h.x+c,h.y);a[--f]=e}};function xi(a,b){xi.g.constructor.call(this,!1,b);this.Y(a)}u(xi,ti);t("H.map.Polyline",xi);xi.prototype.C=function(){return this.Hb.C()};xi.prototype.getBoundingBox=xi.prototype.C;xi.prototype.Y=function(a){var b=this.Y,c,d;if(C(a,Mf)){var e=a.ia;if(c=e.length)for(d=0;d<c;d++)yi(e[d],b);else throw new D(b,0);}else yi(a,b);this.Of=!!e;this.Hb=a;this.sa(Ih.SPATIAL);return this};xi.prototype.setGeometry=xi.prototype.Y;xi.prototype.W=function(){return this.Hb};xi.prototype.getGeometry=xi.prototype.W;
xi.prototype.clip=function(a){var b=this.Hb;return mf(this.Of?b.ia[0]:b,a)};xi.prototype.clip=xi.prototype.clip;xi.prototype.sh=function(a){var b=this.Hb;var c,d=[];if(this.Of)for(b=b.ia,c=b.length;c--;)zi(this,b[c],a,d);else zi(this,b,a,d);return d.length?d:B};xi.prototype.getGeometriesForTile=xi.prototype.sh;function yi(a,b){if(!C(a,K)||2>a.Ej())throw new D(b,0);}
function zi(a,b,c,d){var e=mf(b,c.gm());if(e.length&&(b=c.im(),a=ui(a,e,!1,b),e=a.length)){var f=c.Hj();b=b.w;c.x||wi(a,e,-b);c.x===(1<<c.z)-1&&wi(a,e,b);c=pf(a,f.left,f.top,f.right,f.bottom,!1);c.length&&d.push(new ni(c))}}xi.prototype.R=function(){var a=xi.g.R.call(this),b=a.properties;a.geometry=this.W().R();b.style=this.L().R();b.height=0;return a};xi.prototype.forWorkerMessage=xi.prototype.R;function Ai(a,b,c){var d="anonymous",e=1;this.Sg=A(this.Sg,this);O.call(this,c);this.Y(a);c&&(a="crossOrigin",a in c&&(d=c[a]),a="opacity",a in c&&(e=c[a]));this.Kw(b,d);this.Cd(e)}u(Ai,O);t("H.map.Overlay",Ai);Ai.prototype.type=Wh.OVERLAY;Ai.prototype.C=function(){return this.I};Ai.prototype.getBoundingBox=Ai.prototype.C;Ai.prototype.ni=function(a){C(a,F,this.ni,0,a);return this.Y(a)};Ai.prototype.setBoundingBox=Ai.prototype.ni;Ai.prototype.W=function(){return this.I};
Ai.prototype.getGeometry=Ai.prototype.W;Ai.prototype.Y=function(a){var b=this.I,c=!b;C(a,F,this.Y,0,a);if(c||!b.ea(a))this.I=a,c||this.sa(Ih.SPATIAL);return this};Ai.prototype.setGeometry=Ai.prototype.Y;Ai.prototype.Oe=function(){return this.hb.getData()};Ai.prototype.getBitmap=Ai.prototype.Oe;Ai.prototype.Kw=function(a,b){var c=this.hb;c&&1!==c.getState()&&c.cancel();this.hb=new Kh(a,this.Sg,!0,B,b);return this};Ai.prototype.setBitmap=Ai.prototype.Kw;
Ai.prototype.Sg=function(a,b){this.hb=b;1===a&&this.sa(Ih.VISUAL)};Ai.prototype.Qe=function(){return this.Oc};Ai.prototype.getOpacity=Ai.prototype.Qe;Ai.prototype.Cd=function(a){var b=this.Oc,c=2>b;a-=0;if(0<=a&&1>=a)a!==b&&(this.Oc=a,c&&this.sa(Ih.VISUAL));else throw new D(this.Cd,0);return this};Ai.prototype.setOpacity=Ai.prototype.Cd;Ai.prototype.R=function(){var a=Ai.g.R.call(this);a.geometry=Bf(this.I).R();a.properties.overlay=!0;return a};Ai.prototype.forWorkerMessage=Ai.prototype.R;function Bi(a,b){var c=b&&(+b.extrusion||+b.extrude)||0,d=b&&+b.elevation||0,e=0;Bi.g.constructor.call(this,!0,b);0<d&&(e+=d,this.Cf=d);0<c&&(e+=c,this.jh=c);if(2047<e)throw new Ge(Bi,e,[0,2047]);C(a,K)?this.Y(new M(a)):this.Y(a)}u(Bi,ti);t("H.map.Polygon",Bi);var Ci=new M(new K([0,0,0,0,0,0,0,0,0]));Bi.prototype.jh=0;Bi.prototype.Cf=0;Bi.prototype.Hb=Ci;Bi.MAX_EXTRUDE_HEIGHT=2047;
Bi.prototype.Kr=function(a){var b=+a;if(b!==a)throw new D(this.Kr,0,a);if(0>b||2047<this.Cf+b)throw new Ge(this.Kr,this.Cf+b,[0,2047]);this.jh=b;this.sa(Ih.SPATIAL)};Bi.prototype.setExtrusion=Bi.prototype.Kr;Bi.prototype.Bz=function(){return this.jh};Bi.prototype.getExtrusion=Bi.prototype.Bz;Bi.prototype.Jr=function(a){var b=+a;if(b!==a)throw new D(this.Jr,0,a);if(0>b||2047<this.jh+b)throw new Ge(this.Jr,this.jh+b,[0,2047]);this.Cf=b;this.sa(Ih.SPATIAL)};Bi.prototype.setElevation=Bi.prototype.Jr;
Bi.prototype.wz=function(){return this.Cf};Bi.prototype.getElevation=Bi.prototype.wz;Bi.prototype.W=function(){return this.Hb};Bi.prototype.getGeometry=Bi.prototype.W;Bi.prototype.Y=function(a){if(C(a,M))var b=!1;else C(a,Kf,this.Y,0),b=!0;this.Of=b;b=this.Hb;this.Hb=a;b!==Ci&&this.sa(Ih.SPATIAL);return this};Bi.prototype.setGeometry=Bi.prototype.Y;Bi.prototype.C=function(){return this.W().C()};Bi.prototype.getBoundingBox=Bi.prototype.C;
Bi.prototype.sh=function(a){var b,c=this.W(),d,e;if(this.Of){c=c.ia;var f=0;for(e=c.length;f<e;f++)if(d=Di(this,c[f],a,c[f].ef))b||(b=[]),b.push(d)}else d=this.ef,d===B&&(d=this.Of?Cf.NORTH:this.W().ef),(d=Di(this,c,a,d))&&(b=[d]);return b};Bi.prototype.getGeometriesForTile=Bi.prototype.sh;
function Di(a,b,c,d){var e,f,g=0,h=!0;if(e=Ei(a,b.Fb,c,d,b.C())){var k=new ni(e);var l=b.eb;if(f=l.length)for(k.Mj=k.Pc.length;g<f;g++)if(e=Ei(a,l[g],c,d,b.$t(g)))k.Pc=k.Pc.concat(e);f=k.Pc.length;for(g=0;g<f;g++)if(k.Pc[g]!==pi){h=!1;break}h&&(k=g%2?oi:B)}return k}
function Ei(a,b,c,d,e){var f=c.Hj(),g=e,h=g.nc();var k=[[]];var l=b.T;var n=[],p=l.length,q,r=!1;for(q=0;q<p;q+=3){var v=l[q];var w=l[q+1];r||180!=Hb(w)||(n.push(v),n.push(w),n.push(v),n.push(-w),r=!0);n.push(v);n.push(w)}l=n;360>h&&-180==g.X&&(g=new F(g.ga,180,g.ha,g.da));360>h&&180==g.da&&(g=new F(g.ga,g.X,g.ha,-180));if(g.oc()){h=l;v=h.length;l=-1;for(n=0;n<v-2;n+=2)if(nc(h[n+1],h[n+3])){l=n+2;break}-1===l&&nc(h[v-1],h[1])&&(l=v);-1!==l&&(p=h[l-2],n=h[l-1],q=h[l%v],r=h[(l+1)%v],180!==Hb(p)&&180!==
Hb(q)&&(w=Hb(q-p),v=Hb(r-n),v+=180<v?-360:0,r=Hb(180-r),r+=180<r?-360:0,v&&r&&(w/=Hb(v)/Hb(r),p=q+(q>p?-w:w),n=0<n?180:-180,h.splice(l,0,p,n,p,-n))));l=h}k[0]=Fi([].concat(l),g.X);360>g.nc()&&g.zf(new pc(g.ga,180))&&(l=Fi([].concat(l),g.da),k.push(l));g=c.im();a=ui(a,k,!0,g);if(360===e.nc()&&1===b.yp(!0)%2){b=a;a=c.Hj();b[0][1].x>b[0][b[0].length-1].x&&(b[0]=b[0].reverse());l=[];h=b[0].length-1;for(k=0;k<h;k++)n=b[0][k],l[k]=new L(n.x-2*g.w,n.y),l[k+h]=new L(n.x-g.w,n.y),l[k+2*h]=new L(n.x,n.y),l[k+
3*h]=new L(n.x+g.w,n.y),l[k+4*h]=new L(n.x+2*g.w,n.y);b[0]=l;k=g.rq(d,0);k.y=2*a[d===Cf.NORTH?"top":"bottom"];d=k.clone();k.x=b[0][b[0].length-1].x+1;d.x=b[0][0].x-1;b[0].push(k,d);a=b}d=f.left;b=f.top;k=f.right;f=f.bottom;if(pf(a,d,b,k,f,!0).length){if(!c.gm().Qo(e)){c=a;e=[new L(d,b),new L(k,b),new L(k,f),new L(d,f)];f=[];for(a=c.length;a--;)if(d=rf(e,c[a]))for(b=Gi(d),f.push(b);d.Iq;)d=d.Iq,b=Gi(d),f.push(b);a=f}}else c=Hi(d,b,a[0]),a[1]&&(c=c!==Hi(d,b,a[1])),a=c?[pi]:B;return a}
function Hi(a,b,c){var d,e,f;var g=d=c[0].x;var h=e=c[0].y;var k=1;for(f=c.length;k<f;k++){var l=c[k].x;var n=c[k].y;l>d?d=l:l<g&&(g=l);n>e?e=n:n<h&&(h=n)}return g<=a&&a<=d&&h<=b&&b<=e&&ic({x:a,y:b},jc(c.concat(c[0])))}function Gi(a){var b=[],c=a;do{var d=Eb(100*(c.aC?c.aC:c.x))/100;var e=Eb(100*(c.bC?c.bC:c.y))/100;if(!f||.01<Jb(Kb(f.x-d,2)+Kb(f.y-e,2))){var f=new L(d,e);b.push(f)}c=c.next}while(c&&c!==a);return b}Bi.prototype.Oi=z;
function Fi(a,b){var c,d=Number.POSITIVE_INFINITY,e=-1,f=a.length;for(c=0;c<f;c+=2){var g=Hb(a[c+1]-b);g+=180<g?360-g:g;g<d&&(d=g,e=c)}return 0<c?(b=a.splice(e,a.length-e),b.concat(a)):a}
Bi.prototype.R=function(){var a=Bi.g.R.call(this),b=this.W(),c=this.Of?b.ia:[b],d,e=a.properties;var f=a.geometry=b.R();e.style=this.L().R();e.height=this.jh+this.Cf;e.min_height=this.Cf;if(this.C().oc()&&(f.type="MultiPolygon",this.Of)){var g=[];c.forEach(function(h,k){d=f.coordinates[k];h.C().oc()?g=g.concat(d):g.push(d)});f.coordinates=g}return a};Bi.prototype.forWorkerMessage=Bi.prototype.R;function Ii(a,b,c){Ii.g.constructor.call(this,Ci,c);this.Vn(a);this.Tr(b);c&&this.cw in c&&this.Sr(c[this.cw])}u(Ii,Bi);t("H.map.Circle",Ii);Ii.prototype.Vn=function(a){(a=sc(a)).ea(this.xf)||(this.xf=a,Ji(this))};Ii.prototype.setCenter=Ii.prototype.Vn;Ii.prototype.wb=function(){return this.xf};Ii.prototype.getCenter=Ii.prototype.wb;Ii.prototype.Tr=function(a){if(E(a=ec(a,0,6371000.79*Tb/2)))throw new D(this.Tr,0,a);this.rr!==a&&(this.rr=a,Ji(this))};Ii.prototype.setRadius=Ii.prototype.Tr;
Ii.prototype.lA=function(){return this.rr};Ii.prototype.getRadius=Ii.prototype.lA;Ii.prototype.vn=60;Ii.prototype.Sr=function(a){if(!ob(a))throw new D(this.Sr,0,a);this.vn!==(a=ec(Eb(a),4,360))&&(this.vn=a,Ji(this))};Ii.prototype.setPrecision=Ii.prototype.Sr;Ii.prototype.cw="precision";Ii.prototype.iA=function(){return this.vn};Ii.prototype.getPrecision=Ii.prototype.iA;Ii.prototype.Y=function(){return this};Ii.prototype.setGeometry=Ii.prototype.Y;
Ii.prototype.W=function(){this.Hb===Ci&&Ii.g.Y.call(this,Ki(this));return this.Hb};Ii.prototype.getGeometry=Ii.prototype.W;function Ji(a){a.Hb!==z&&Ii.g.Y.call(a,Ki(a))}function Ki(a){var b=a.xf,c=b.lat,d=a.rr,e=0,f=new K;if(90===Hb(c))for(c=b.ho(0,d,!0).lat;360>e;e+=120)f.nr(c,e-180,B);else for(a=a.vn,a=360/a;360>e;e+=a)f.ng(b.ho(e,d,!0));b=new M(f);0>c&&b.Ow(Cf.SOUTH);return b};function Li(a,b){Li.g.constructor.call(this,Ci,b);this.ni(a)}u(Li,Bi);t("H.map.Rect",Li);Li.prototype.ni=function(a){if(!C(a,F))throw new D(this.ni,0,a);a.ea(this.Oi)||(this.Oi=this.I=a,this.Hb!==z&&Li.g.Y.call(this,Bf(a)))};Li.prototype.setBoundingBox=Li.prototype.ni;Li.prototype.C=function(){return this.I};Li.prototype.getBoundingBox=Li.prototype.C;Li.prototype.Y=function(){return this};Li.prototype.setGeometry=Li.prototype.Y;
Li.prototype.W=function(){this.Hb===Ci&&Li.g.Y.call(this,Bf(this.Oi));return this.Hb};Li.prototype.getGeometry=Li.prototype.W;t("H.util.Disposable",Zd);Zd.prototype.bc=Zd.prototype.bc;Zd.prototype.addOnDisposeCallback=Zd.prototype.bc;t("H.util.dispose",Yd);Zd.prototype.u=Zd.prototype.u;Zd.prototype.dispose=Zd.prototype.u;Zd.prototype.i=Zd.prototype.i;Zd.prototype.disposeInternal=Zd.prototype.i;function Mi(a,b,c,d){Mi.g.constructor.call(this);this.jd=a;this.ka=d;this.element=a.appendChild(this.createElement(a.ownerDocument));this.Kk(b,c)}u(Mi,Zd);Mi.prototype.F=function(){return this.element};Mi.prototype.Kk=function(a,b){this.size?(this.size.w=a,this.size.h=b):this.size=new Jh(a,b);this.Qw(this.element,this.element.style,a,b,this.ka)};Mi.prototype.setSize=Mi.prototype.Kk;m=Mi.prototype;m.lc=function(){return this.size};m.mb=function(){return this.ka};m.Su=!0;
m.Zb=function(a){a!==this.Su&&(this.element.style.display=a?"block":"none",this.Su=a)};m.opacity=1;m.Cd=function(a){this.opacity!==a&&(this.zg(a),this.opacity=a)};m.Qe=function(){return this.opacity};m.pi=function(a){this.element.style.zIndex=a};Mi.prototype.setZIndex=Mi.prototype.pi;Mi.prototype.ru=function(){return+this.element.style.zIndex};Mi.prototype.Me=function(){};Mi.prototype.clear=function(){};
Mi.prototype.i=function(){this.clear();this.jd.removeChild(this.element);this.Kk(0,0);delete this.element;delete this.jd;Mi.g.i.call(this)};Mi.prototype.disposeInternal=Mi.prototype.i;Mi.prototype.pw=0;Mi.prototype.On=function(){++this.pw};Mi.prototype.release=function(){--this.pw||this.u()};var Ni={PENDING:0,ACTIVE:1,DONE:2};t("H.map.render.RenderState",Ni);function Oi(a,b){var c=b||{},d=c.contextType;c=c.contextAttributes;Oi.g.constructor.call(this,b);gb(a,"Function",Oi,0,"invalid render callback");if(d){if(-1===Pi.indexOf(d))throw new D(Oi,1,"invalid context type");this.dj=d}c&&(this.cj=c);this.vr=a}u(Oi,yh);t("H.map.layer.CanvasLayer",Oi);var Pi=["2d","webgl","webgl2","experimental-webgl"];m=Oi.prototype;m.dj="2d";m.ph=function(){return this.dj};m.getContextAttributes=function(){return this.cj};
m.N=function(a,b){this.Kl&&this.Kl.canvas===a||(this.Kl=a.getContext(this.dj,this.cj));return this.vr(this.Kl,b)};m.i=function(){Oi.g.i.call(this);delete this.Kl};function Qi(a,b){Qi.g.constructor.call(this,b);gb(a,"Function",Qi,0,"invalid render callback");this.vr=a}u(Qi,yh);t("H.map.layer.DomLayer",Qi);Qi.prototype.N=function(a,b){return this.vr(a,b)};t("H.map.Style",Zg);Zg.State=lg;function Ri(a,b){if(!C(a,Element)){Si.innerHTML=a;a=Si.firstElementChild;if(!a)throw new D(Ri,0,"No element data");Si.removeChild(a);var c=!0;Si.innerHTML=""}this.Po=0!==$e(a).length;this.Jt=c?a:af(a,x.document,this.Po);b&&(c="onAttach",c in b&&gb(a=b[c],"Function",Ri,1,c)&&(this.Jq=a),c="onDetach",c in b&&gb(a=b[c],"Function",Ri,1,c)&&(this.Nq=a))}t("H.map.DomIcon",Ri);var Si=document.createElement("DIV");Ri.prototype.Jq=null;Ri.prototype.Nq=null;
Ri.prototype.au=function(a){return af(this.Jt,a,this.Po)};Ri.prototype.Po=!1;function Ti(a,b){Ti.g.constructor.call(this,a,b)}u(Ti,ai);t("H.map.DomMarker",Ti);Ti.prototype.type=Wh.DOM_MARKER;Ti.prototype.mo=2;Ti.prototype.pt=function(a){var b=new Ri(a.svg,a);a=a.anchor;b.Jt.style.margin=-a.y+"px 0 0 -"+a.x+"px";return b};Ti.prototype.Ru=function(a){return C(a,Ri)};function Ui(){Ui.g.constructor.call(this);this.dd=Vi(this);this.yn=Wa();this.jn=A(this.jn,this);this.dd.addEventListener("message",this.jn);this.Vk={}}u(Ui,J);Ui.prototype.i=function(){this.dd.terminate()};Ui.prototype.iw=function(a){var b=a.type,c=!!this.yn[b],d=a.data,e=Wi++,f=d&&d.rD?d.rD:B,g=!0;c?(this.Vk[e]=a,Xi(this,b,e,d&&d.message,f)):(a.reject(new D(this.iw,0,"processor_not_found")),g=!1);return g};
Ui.prototype.jn=function(a){a=a.data;var b=this.Vk[a.taskId],c=a.taskId,d=a.data,e=this;if(2===a.type)(new Tg("arraybuffer",d)).then(function(f){return f.arrayBuffer()}).then(function(f){e.dd.postMessage(["3",c,[f]],[f])},function(){e.dd.postMessage(["3",c,[null,"ERROR"]])});else{if(b){switch(a.type){case 1:b.resolve(d);break;case 0:b.reject(d)}delete this.Vk[c]}this.dispatchEvent(new ie(this.l.IDLE))}};var Wi=0;function Yi(a,b,c){var d=Wi++,e;a.Vk[d]=e=Fd();Xi(a,b,d,c);return e.promise}
function Xi(a,b,c,d,e){d===B||Ba(d)||(d=[d]);try{a.dd.postMessage([b,c,d],e)}catch(f){a=a.Vk[c],a.reject(f.message)}}Ui.prototype.l={IDLE:"idle",Fs:"error"};Ui.prototype.Yx=function(a,b){var c=this.Qy||(this.Qy=new ie(this.l.Fs));c.data=b;delete this.yn[a];this.dispatchEvent(c)};Ui.prototype.importScripts=function(a){Yi(this,"0",a)};
function Vi(a){var b=x.H.__bootstrap__;b=ab(b)?(""+b).replace(/^[^{]+{((.|[\r\n])+?)}\s*$/,"$1"):""+b;if(x.Worker&&x.URL)try{var c=new x.Worker(x.URL.createObjectURL(ef(b,"application/javascript")))}catch(d){}c||(a=new Zi(a),function(){eval("var self = arguments[0];"+b)}(a),c=new $i(a));return c}function $i(a){J.call(this);this.dd=a}u($i,J);$i.prototype.postMessage=function(a){x.setTimeout(A(this.iC,this,a),0)};$i.prototype.iC=function(a){var b=new ie("message");b.data=a;this.dd.dispatchEvent(b)};
$i.prototype.terminate=function(){this.dd.u();this.u()};function Zi(a){J.call(this);this.dd=a;this.addEventListener=A(this.addEventListener,this);this.removeEventListener=A(this.removeEventListener,this);this.postMessage=A(this.postMessage,this);this.eval=A(eval,this)}u(Zi,J);Zi.prototype.postMessage=function(a){var b=new ie("message");b.data=a;x.setTimeout(A(this.dd.jn,this.dd,b),0)};function aj(){var a=bj;a||(a=bj=this,J.call(a),this.ug());return a}var bj;u(aj,J);m=aj.prototype;m.i=function(){aj.g.i.call(this);this.ug()};m.ug=function(){var a=this.jo,b;if(a)for(b=a.length;b--;)a[b].u();this.jo=[];rb(this.jo);this.wm={};this.kw=Wa()};
m.zo=function(a){var b;a=a.type;if(b=this.kw[a]){var c=this.jo;var d=c[0];d||(d=c[0]=new Ui,this.bc(Ja(Yd,d)),Qa(this.wm)||d.importScripts(x.Object.keys(this.wm)));c=d;c.yn[a]||(c.yn[a]=b,Yi(c,"1",[a,ab(b)?b+"":b]).then(Xe,A(c.Yx,c,a)))}else throw new Ab(this.zo,'Unknown type "'+a+'"');return d};m.Sl=function(){};m.registerProcessor=function(a,b){var c=this.kw,d=c[a];if(d){if(b!==d)throw new Ab(this.registerProcessor,'Type "'+a+'" is already registered');}else c[a]=b};
m.importScripts=function(a){[].concat(a).forEach(function(b){this.wm[b]||(this.wm[b]=!0,this.jo.forEach(function(c){c.importScripts(b)}))},this)};function cj(a,b,c){Td.call(this,a,b,c)}var dj;u(cj,Td);cj.prototype.Bp=function(){dj||(dj=new Wd(new aj));return dj};cj.prototype.Si=function(){};cj.prototype.Nt=function(a){return a.iw(this)};function ej(a,b){Ah.call(this,a,b)}u(ej,Ah);t("H.map.layer.TileLayer",ej);ej.prototype.sg=function(a,b,c,d,e){if(!C(a,F))throw new D(this.sg,0,a);if(E(b=+b))throw new D(this.sg,1,b);b=Fb(b);this.pixelProjection.Wa(b);a=this.wj(a);var f=this.Bh(a,b);return this.Gj(f,a.left>a.right,b,c,d,e)};ej.prototype.requestTiles=ej.prototype.sg;function fj(a){eb(this,fj);fj.g.constructor.call(this,a);if(a&&"tileSize"in a){var b=Ib(+a.tileSize)/Sb;if(isNaN(b)||b%1||0>b||30<b)throw new D(fj,0,"tileSize: "+a.tileSize);this.tileSize=+a.tileSize}}u(fj,N);t("H.map.provider.TileProvider",fj);function gj(a,b){return bc(a)-8-Eb(bc(b))}fj.getZoomLevelOffset=gj;fj.prototype.requestTile=fj.prototype.Oa;fj.prototype.cancelTile=fj.prototype.Kd;fj.prototype.cancelTileByKey=fj.prototype.Ti;fj.prototype.createTileInternal=fj.prototype.ld;
fj.prototype.Sd=function(a,b,c){return this.uri.concat("_",a,"_",b,"_",c)};fj.prototype.getTileKey=fj.prototype.Sd;fj.prototype.tileSize=256;fj.prototype.tileSize=fj.prototype.tileSize;function hj(){}t("H.util.ICache",hj);hj.prototype.add=function(){};hj.prototype.add=hj.prototype.add;hj.prototype.get=function(){};hj.prototype.get=hj.prototype.get;hj.prototype.Vl=function(){};hj.prototype.drop=hj.prototype.Vl;hj.prototype.forEach=function(){};hj.prototype.forEach=hj.prototype.forEach;hj.prototype.ja=function(){};hj.prototype.removeAll=hj.prototype.ja;hj.prototype.ci=function(){};hj.prototype.registerOnDrop=hj.prototype.ci;hj.prototype.ap=function(){};
hj.prototype.deRegisterOnDrop=hj.prototype.ap;function ij(a,b,c){this.bk=[];b&&this.ci(b);if(c&&!ab(c))throw new D(ij,2,c);this.Je=0;this.filter=c;this.ba={};this.Sj=this.lh=null;this.Nr(a)}t("H.util.Cache",ij);ij.prototype.add=function(a,b,c){var d,e;c=+c;if(!ob(c)||0>c)throw new D(this.add,2,c);a=String(a);if(e=this.filter?this.filter(a,b,c):!0)(d=this.ba[a])?(d.data!==b&&jj(this,d),this.Je+=c-d.size,d.size=c,d.data=b,kj(this,d)):this.ba[a]=lj(this,{id:a,data:b,size:c,xd:null,gf:null},this.lh),mj(this);return e};ij.prototype.add=ij.prototype.add;
ij.prototype.ci=function(a){if(!ab(a))throw new D(this.ci,0,a);this.bk.push(a)};ij.prototype.registerOnDrop=ij.prototype.ci;ij.prototype.ap=function(a){this.bk=this.bk.filter(function(b){return b!==a})};ij.prototype.deRegisterOnDrop=ij.prototype.ap;ij.prototype.get=function(a,b){return(a=b?this.ba[a]:kj(this,this.ba[a]))&&a.data};ij.prototype.get=ij.prototype.get;ij.prototype.Vl=function(a){var b;(b=this.ba[a])&&this.jf(b,!0)};ij.prototype.drop=ij.prototype.Vl;
ij.prototype.forEach=function(a,b,c){var d;for(d in this.ba){var e=this.ba[d];(c?c(d,e.data,e.size):1)&&a.call(b,d,e.data,e.size)}};ij.prototype.forEach=ij.prototype.forEach;ij.prototype.ja=function(a){var b;for(b in this.ba){var c=this.ba[b];(a?a(b,c.data,c.size):1)&&this.jf(this.ba[b],!0)}};ij.prototype.removeAll=ij.prototype.ja;ij.prototype.Nr=function(a){if(!(0<+a))throw new D(ij.prototype.Nr,0,a);this.pv=+a;mj(this);return this};ij.prototype.setMaxSize=ij.prototype.Nr;ij.prototype.Xz=function(){return this.pv};
ij.prototype.getMaxSize=ij.prototype.Xz;ij.prototype.rz=function(){return this.Je};ij.prototype.getCurrentSize=ij.prototype.rz;function kj(a,b){b&&(a.lh=lj(a,b,a.lh));return b}function mj(a){for(;a.Je>a.pv&&a.Sj;)a.jf(a.Sj,!0)}function lj(a,b,c){if(c!==b){(b.xd||b.gf)&&a.jf(b,!1);if(b.xd=c)b.gf=c.gf,c.gf=b;b.gf||(a.lh=b);b.xd||(a.Sj=b);a.Je+=b.size}return b}
ij.prototype.jf=function(a,b){var c=a.gf,d=a.xd;if(c||d||a==this.lh&&a==this.Sj)c?c.xd=d:this.lh=d,d?d.gf=c:this.Sj=c,this.Je-=a.size,b&&(delete this.ba[a.id],jj(this,a));a.xd=a.gf=null;return a};function jj(a,b){for(var c=a.bk.length;c--;)a.bk[c].call(a,b.id,b.data,b.size)};function nj(a,b,c,d){a-=c;b-=d;return a*a+b*b}function oj(a,b,c){return pj(a,b*b,c||0,0,a.length-1)}t("H.math.simplifyDP",oj);
function pj(a,b,c,d,e){var f=0,g=d,h=a[d].x,k=a[d].y,l=a[e].x,n=a[e].y,p=d+1,q=nj(h,k,l,n);if(q)for(;p<e;){var r=a[p++];var v=r.x;r=r.y;var w=((v-h)*(l-h)+(r-k)*(n-k))/q;v=0>w?nj(v,r,h,k):1<w?nj(v,r,l,n):nj(v,r,h+w*(l-h),k+w*(n-k));v>f&&(f=v,g=p-1)}else for(;p<e;)r=a[p++],v=r.x,r=r.y,v=nj(v,r,h,k),v>f&&(f=v,g=p-1);f>=b||0<c&&g-d?(--c,1<g-d?(d=pj(a,b,c,d,g),d.splice(d.length-1,1)):d=[a[d]],d=1<e-g?d.concat(pj(a,b,c,g,e)):d.concat(a.slice(g,e+1))):d=[a[d],a[e]];return d};function qj(a,b,c,d){this.key="";this.x=a;this.y=b;this.z=c;this.data=d;this.valid=!0}t("H.map.provider.Tile",qj);function rj(a,b,c,d,e,f,g,h){rj.g.constructor.call(this,b,c,d,null);this.key=a;this.yd=h;this.cd=e;this.oa=f;this.ai={};this.zL=g;this.Om=Gb(di.MAX_LINE_WIDTH/2*this.oa+1)}u(rj,qj);t("H.map.provider.SpatialTile",rj);rj.prototype.tg=ac;rj.prototype.sr=ac;rj.prototype.kf=ac;function sj(a){return a.yd.getInvalidations(Wh.SPATIAL)}
function tj(a){var b=sj(a),c=b.Jd,d=a.tg,e=d===c,f;if(!(e||b.Ku(d)||b.nq(d))){e=a.Dg;var g=a.ai;if(b.Dm(d))for(f=e.length;f--;){var h=e[f];if(h.Hc().Dm(d)){e.splice(f,1);var k=k||uj(a,h.xb())}}if(b.pq(d)){for(f=e.length;f--;)if(h=e[f],h.Hc().pq(d)){var l=1;if((h=g[h.xb()])&&h.pm){k=1;break}}l&&e.sort(vj)}if(!k&&b.Gh(d))for(f=e.length;f--;)if(e[f].Hc().Gh(d)){var n=1;break}a.sr!==d||n||(a.sr=c,a.kf!==d||k||(a.kf=c));a.tg=c;e=!0}return e}
rj.prototype.Eh=function(){var a=sj(this),b=a.Jd,c=this.kf,d=c===b;d||(this.yd.mw&&!a.Gh(c)?d=!0:tj(this)&&(d=this.kf===b));return d};rj.prototype.isCanvasValid=rj.prototype.Eh;Object.defineProperty(rj.prototype,"valid",{get:function(){return this.Eh()},set:Xe,configurable:!0});function wj(a,b){this.Zl=a;this.pm=b}function uj(a,b){a=a.ai;var c=a[b];if(c)return delete a[b],c.pm}rj.prototype.Dg=Ye;
function xj(a){var b=sj(a),c=a.tg,d=a.Dg,e;if(!tj(a)){for(e=d.length;e--;){var f=d[e];var g=f.Hc();(g.Dm(c)||g.nq(c))&&uj(a,f.xb())}a.Dg=a.yd.requestSpatialsByTile(a,!1,!1).sort(vj);a.tg=b.Jd}}function vj(a,b){return Xh(a.Re(),b.Re(),!1)}rj.prototype.cb=function(){return this.Dg};rj.prototype.getObjects=rj.prototype.cb;rj.prototype.vA=function(){return this.cd};rj.prototype.getTileSize=rj.prototype.vA;var yj={};
rj.prototype.Hj=function(){var a=this.cd+"_"+this.oa,b=yj[a];if(!b){b=-this.Om;var c=this.cd-b;b=yj[a]=new fg(b,b,c,c)}return b};rj.prototype.getPxClipRect=rj.prototype.Hj;rj.prototype.gm=function(){var a=this.bz;if(!a){var b=this.im();a=0;var c=this.cd;this.z&&(c-=a+=this.Hj().top);a=this.bz=Ic(b.gk(new L(a,a)),b.gk(new L(c,c)))}return a};rj.prototype.getGeoClipRect=rj.prototype.gm;
rj.prototype.im=function(){var a=this.mC;if(!a){var b=this.cd;a=this.mC=new vh(B,b);a.Wa(this.z);a.x=this.x*b;a.y=this.y*b}return a};rj.prototype.getPxProj=rj.prototype.im;rj.prototype.mb=function(){return this.oa};rj.prototype.getPixelRatio=rj.prototype.mb;rj.prototype.Dn=function(){var a=this.data;a&&(this.data=null,this.kf=ac);return a};rj.prototype.releaseCanvas=rj.prototype.Dn;rj.prototype.En=function(){this.ai={};delete this.Dg;this.tg=ac};rj.prototype.releaseData=rj.prototype.En;
rj.prototype.N=function(a){var b=a.getContext("2d"),c,d,e,f,g=0;xj(this);if(this.kf<this.tg){var h=this.Dg;if(c=h.length){a.width=a.height=this.cd;b.clearRect(0,0,this.cd,this.cd);var k=this.ai;for(d=0;d<c;d++){var l=h[d];var n=l.xb();if(f=(e=k[n])?e.Zl:l.getGeometriesForTile(this)){if(e)l.Hc().Gh(this.kf)&&(e.pm=si(l,f)),e=e.pm;else{e=si(l,f);var p;var q=f;for(var r=l.Se?2:0,v=q.length;v--;){var w=q[v];if(w!==oi){var y=w.Pc;for(p=y.length;p--;)w=y[p],4<w.length&&(y[p]=oj(w,.6,r))}}this.ai[n]=new wj(f,
e)}if(e){b.save();q=l.Se?this.sC:this.tC;for(n=0;n<f.length;n++)q.call(this,l,f[n],l.L(),b);if(f=l.getLabels(this))for(l=b,n=f.length;n--;)for(r=f[n],q=r.size,l.font=q+"px "+r.font,l.fillStyle=r.color,l.textAlign="center",l.translate(r.x,r.y),l.rotate(r.angle),q=r.lineHeight||1.375*q,v=r.lines,r=v.length;r--;)l.fillText(v[r],0,r*q);b.restore()}g|=+e}}}this.data=g?a:null;this.sr=this.kf=this.tg}else this.data&&(g=1);return 0<g};rj.prototype.render=rj.prototype.N;rj.prototype.data=null;
rj.prototype.tC=function(a,b,c,d){var e;c.Pj&&(zj(d,c,this.oa),Aj(b,d,!1,!0,!1,this.cd,this.Om));c.Nj&&(e=a.Og)&&e.Mc&&(Bj(d,e),Cj(this,d,b,e,c.lineWidth))};
rj.prototype.sC=function(a,b,c,d){var e=c.Mc,f=c.Pj,g,h=this.cd,k=this.Om;if(b===oi)e&&(Bj(d,c),d.fillRect(0,0,h,h));else{f&&zj(d,c,this.oa);if(c.Nj&&(g=a.Og)){var l=c.lineWidth;g.Mc||(g=null)}a=b.on;if(a===$b){if(f||e)Bj(d,c),Aj(b,d,!0,f,e,h,this.Om);g&&(Bj(d,g),Cj(this,d,b,g,l,0))}else e&&(Bj(d,c),Aj(b,d,!0,!1,e,h,k,0,a)),f&&Aj(b,d,!1,f,!1,h,k,a),g&&(Bj(d,g),Cj(this,d,b,g,l,a))}};
function Aj(a,b,c,d,e,f,g,h,k){var l=a.Pc,n=-g;g=f+g;h=h||0;k===B&&(k=l.length);if(e&&a===oi)b.fillRect(0,0,f,f);else if(k>h){b.beginPath();for(f=h;f<k;f++){var p=l[f];var q=p.length;if(p===pi)b.moveTo(n,n),b.lineTo(n,g),b.lineTo(g,g),b.lineTo(g,n);else{var r=p[0];b.moveTo(r.x,r.y);for(h=1;h<q;h++)r=p[h],b.lineTo(r.x,r.y)}c&&b.closePath()}c&&e&&b.fill(a.Mj!==$b?"evenodd":"nonzero");d&&b.stroke()}}
function zj(a,b,c){var d;a.strokeStyle=b.strokeColor;a.lineWidth=b.lineWidth*c;a.lineCap=b.lineCap;a.lineJoin=b.lineJoin;a.miterLimit=b.miterLimit;a.setLineDash&&(d=b.lineDash)!==Ye&&(a.setLineDash(d),a.lineDashOffset=b.lineDashOffset)}function Bj(a,b){a.fillStyle=b.fillColor}
function Cj(a,b,c,d,e,f){var g=e*d.width/2;e=e*d.length/2;var h=e/2;d=2*e*d.frequency;var k=Jb(Kb(e,2)+Kb(g,2));a=a.cd-k;a=new fg(k,k,a,a);c=c.Pc;var l,n,p,q,r,v,w,y=Tb/2;f=f||0;for(k=c.length;k-- >f;){var I=0;var G=c[k];if(n=l=G.length){var S=G;n=S.length;for(p=0;--n;)p+=S[n].lb(S[n-1]);n=(S=p)>=d}if(n)for(n=Cb(Fb(S/d),1E3),n=S/(n+1),p=n/2;--l;){for(q=(r=G[l]).lb(v=G[l-1]);p<=I+q;){var X=r.x+(v.x-r.x)*(w=(p-I)/q);w=r.y+(v.y-r.y)*w;a.Il(X,w)&&(b.save(),b.translate(X,w),b.rotate(-Qb((v.y-r.y)/(r.x-
v.x))+(r.x<v.x?y:-y)),b.beginPath(),b.moveTo(-g,-e),b.lineTo(0,e),b.lineTo(g,-e),b.lineTo(0,-h),b.closePath(),b.fill(),b.restore());p+=n}I+=q}}}var Dj=[];
rj.prototype.La=function(a,b,c){for(var d=this.Dg,e=d.length,f,g,h,k,l,n,p=Ye,q,r=this.oa;e--;)if(g=d[e],g.Td(!0)&&(h=this.ai[g.xb()])&&(k=h.Zl)){f=g.L();n="none"!==f.fillColor&&g.Se;q="none"===f.strokeColor?0:f.lineWidth*r;for(f=k.length;f--;){l=k[f];var v;if(!(v=n&&l===oi)&&(v=n||q)){var w;v=a;var y=b,I=n,G=q,S=l.Mj,X=l.on,Ga=X!==$b,ha=l.Pc,mb=ha.length,ta=0,nb=0,zd=!1;for(l=0;l<mb;l++){var rc=ha[l];var bb=l>=X;var Ke=!bb&&l>=S;if(rc===pi&&I)Ke?ta++:nb++;else{var pd=rc.length;Dj.length=2*pd;for(w=
0;w<pd;w++){var np=rc[w];Dj[2*w]=np.x;Dj[2*w+1]=np.y}w=I&&!bb;bb=Ga&&!bb?0:G;if(w||bb)if(bb=hc(v,y,Dj,bb,w),bb===gc.EDGE||bb===gc.VERTEX){zd=!0;break}else if(bb===gc.SURFACE)if(Ke)ta++;else if(nb++,S===$b)break}}v=zd||0<nb&&!(ta%2)}if(v){p===Ye&&(p=[]);p.push(g);break}}if(c&&p.length)break}return p};var Ej,Fj=function(){function a(){}for(var b,c,d,e=Xa("o ms moz webkit ").split(void 0!==B?void 0:" "),f=5;f--&&!b;)b=e[f],b=(c=x[b+(b?"R":"r")+"equestAnimationFrame"])&&!E(c.call(window,a))&&(d=x[b+(b?"C":"c")+"ancelAnimationFrame"]);Ej=b?function(g){return c.call(x,g)}:function(g){return x.setTimeout(g,25)};return b?function(g){return d.call(x,g)}:function(g){return x.clearTimeout(g)}}(),Gj=x.performance&&x.performance.now?function(){return x.performance.now()}:function(){return x.Date.now()};function Hj(a,b){var c=this;if(!ab(b))throw new D(Hj,1,b);if(!ab(a.next||ab(a.cycle)))throw new D(Hj,2,'Argument "mode" must implement H.util.AsyncQueue.Mode');this.pk=[];this.jw=[];this.xB=a;this.process=b;this.kC=function(){Ij(c)};this.ir=null;this.Dw=function(){c.ir||(c.ir=x.setTimeout(c.kC,1))}}t("H.util.AsyncQueue",Hj);Hj.prototype.push=function(a,b){if(!ab(b))throw new D(this.push,1,b);a=Jj(new Kj,a,this.Dw,b);this.pk.push(a);this.Dw();return a};Hj.prototype.push=Hj.prototype.push;
Hj.prototype.wn=function(){Ij(this)};function Ij(a){var b=a.jw,c=0,d=a.xB;d.tt();for(a.ir=null;c<b.length;){var e=b[c];e.Ou?b.splice(c,1):c++}for(;e=d.next(a.pk,a.jw);)e.cancelled?e.done(null,"cancelled"):(b.push(e),a.process(e,e.data))}function Kj(){Jj(this,null,null,null)}Hj.Task=Kj;function Jj(a,b,c,d){a.data=b;a.cancelled=!1;a.Ou=!1;a.HB=c;a.IB=d;a.Lo=null;return a}Kj.prototype.done=function(a,b){this.Ou=!0;this.HB();this.IB(this,a,b)};Kj.prototype.done=Kj.prototype.done;
Kj.prototype.cancel=function(){this.Lo&&this.Lo();this.cancelled=!0};Kj.prototype.cancel=Kj.prototype.cancel;Kj.prototype.MC=function(a){this.Lo=a;return this};Kj.prototype.setCancelFn=Kj.prototype.MC;function Lj(){}Hj.Mode=Lj;Lj.prototype.next=function(){};Lj.prototype.tt=function(){};function Mj(a,b){Mj.g.constructor.call(this,new Nj(a),b)}u(Mj,Hj);t("H.util.SequentialQueue",Mj);function Nj(a){if(isNaN(a)||0>a)throw new D(Mj,1,'Argument "maxTime" must be a positive number');this.qB=a;this.Qk=Gj()}Nj.prototype.next=function(a){return a.length&&Gj()-this.Qk<this.qB?a=a.shift():null};Nj.prototype.tt=function(){this.Qk=Gj()};function Oj(a,b){var c;Oj.g.constructor.call(this,b);this.lw=a;this.oa=a=b.pixelRatio;this.tileSize=c=1<<Eb(bc((b.tileSize||256)*a));this.rs=gj(c,a);this.fe=A(this.fe,this);this.Lq=A(this.Lq,this);this.mg=A(this.mg,this);this.fg=A(this.fg,this);this.de=A(this.de,this);this.lw.addEventListener(N.prototype.l.Aa,this.de,!1,this);this.Vg=[];this.qf=new ij(b.tileCacheSize||256,this.fe);this.Yo=new ij(b.dataCacheSize||512,this.Lq);this.In=new Mj(20,this.mg);this.jg={};this.Zu=Gj()}u(Oj,fj);
Oj.prototype.de=function(a){a=a.target;a.type===Wh.SPATIAL&&this.kb(a)};Oj.prototype.Oa=function(a,b,c,d){var e=this.getTileKey(a,b,c),f;if(f=this.qf.get(e,d)){if(d||f.Eh())return f;d||this.qf.Vl(e)}if((f=this.Yo.get(e,d))&&(d||tj(f)))return a=this.Vg.pop()||document.createElement("canvas"),f.N(a)||this.Vg.push(a),this.qf.add(e,f,1),f;d||((f=this.jg[e])?f.count++:(f=this.In.push([e,a,b,c],this.fg),f.count=1,this.jg[e]=f))};Oj.prototype.requestTile=Oj.prototype.Oa;Oj.prototype.ld=function(){};
Oj.prototype.createTileInternal=Oj.prototype.ld;Oj.prototype.wn=function(){var a=Gj();33<a-this.Zu&&(this.In.wn(),this.Zu=a)};Oj.prototype.Kd=function(a,b,c){this.Ti(this.getTileKey(a,b,c))};Oj.prototype.cancelTile=Oj.prototype.Kd;Oj.prototype.Ti=function(a){var b;if(b=this.jg[a])b.count--,b.count||(b.cancel(),delete this.jg[a])};Oj.prototype.cancelTileByKey=Oj.prototype.Ti;m=Oj.prototype;
m.mg=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3];c=this.qf.get(c)||new rj(c,d,e,f,this.tileSize,this.oa,f+this.rs,this.lw);d=c.data||this.Vg.pop()||document.createElement("canvas");c.N(d)||this.Vg.push(d);b.push(c);a.done(c)};m.fg=function(a,b){a=a.data[0];b&&this.qf.add(a,b,1);delete this.jg[a];this.kb()};m.fe=function(a,b){b.data&&this.Vg.push(b.Dn());this.Yo.add(a,b,1)};m.Lq=function(a,b){b.En()};
m.i=function(){for(var a in this.jg)this.jg[a].cancel();this.qf.ja();this.Yo.ja();this.Vg.length=0;Oj.g.i.call(this)};function Pj(a,b){b=b?Ra(b):{};b.tileSize=b.tileSize||256;b.pixelRatio=b.pixelRatio||Ie();b.max=24;this.Cg=new Oj(a,b);this.si=new ej(this.Cg);b.minWorldSize=this.Cg.tileSize;b.provider=a;Pj.g.constructor.call(this,b);this.tileSize=this.si.tileSize;this.fn=A(this.fn,this);this.Cg.addEventListener(this.Cg.l.Aa,this.fn);a.addEventListener(a.l.Aa,this.fn)}u(Pj,yh);t("H.map.layer.ObjectLayer",Pj);Pj.prototype.fn=function(a){a.currentTarget!==this.Cg&&a.target.type===Wh.SPATIAL||this.kb()};
var Qj={markers:Ye,total:0};Pj.prototype.le=function(a,b,c){var d=this.D,e;return d.providesMarkers()&&(e=d.requestMarkers(a,b,!0,c)).length?{markers:e,total:e.length}:Qj};Pj.prototype.requestMarkers=Pj.prototype.le;Pj.prototype.ke=function(a,b,c){var d=this.D,e;return d.providesDomMarkers()&&(e=d.requestDomMarkers(a,b,!0,c)).length?{markers:e,total:e.length}:Qj};Pj.prototype.requestDomMarkers=Pj.prototype.ke;var Rj={tiles:Ye,total:0};
Pj.prototype.sg=function(a,b,c,d){if(this.D.providesSpatials()){var e=this.si.sg(a,b,c,d);c||(this.Cg.wn(),e=this.si.sg(a,b,!0,d))}else e=Rj;return e};Pj.prototype.requestTiles=Pj.prototype.sg;Pj.prototype.Oa=function(a,b,c,d){return this.si.Oa(a,b,c,d)};Pj.prototype.requestTile=Pj.prototype.Oa;Pj.prototype.Kd=function(a,b,c){this.si.Kd(a,b,c)};Pj.prototype.cancelTile=Pj.prototype.Kd;var Sj={overlays:Ye,total:0};
Pj.prototype.rg=function(a,b,c){var d=this.D,e=Sj;d.providesOverlays&&d.providesOverlays()&&(a=d.requestOverlays(a,b,!0,c),b=a.length)&&(e={overlays:a,total:b});return e};Pj.prototype.requestOverlays=Pj.prototype.rg;Pj.prototype.i=function(){this.Cg.u();this.si.u();this.D.dispose();Pj.g.i.call(this)};function Tj(a,b){ab(a)&&(this.Mv=a);ob(b)&&(this.bl=b)}t("H.util.Request",Tj);Tj.State={PENDING:0,PROCESSING:1,COMPLETE:2,CANCELLED:3,ERROR:4};var Uj=[0,1,2,3,4];Tj.prototype.o=0;Tj.prototype.getState=function(){return this.o};Tj.prototype.getState=Tj.prototype.getState;Tj.prototype.G=function(a){if(0>Uj.indexOf(a))throw new D(this.G,0,a);if(this.o!==a||1===a&&1<this.bl)this.o=a,this.Mv&&this.Mv(this)};Tj.prototype.bl=1;Tj.prototype.yA=function(){return this.bl};Tj.prototype.getTotal=Tj.prototype.yA;
Tj.prototype.xn=0;Tj.prototype.jA=function(){return this.xn};Tj.prototype.getProcessed=Tj.prototype.jA;Tj.prototype.Rt=0;Tj.prototype.Cz=function(){return this.Rt};Tj.prototype.getFailed=Tj.prototype.Cz;function Vj(a,b){a.xn<a.bl&&(db(b)||(b=2),0===b||1===b||0!==a.o&&1!==a.o||(a.xn++,2!==b&&a.Rt++,a.G(a.xn<a.bl?1:2)))}Tj.prototype.Si=function(){};Tj.prototype.cancel=function(){3!==this.o&&(this.Si(),this.G(3))};Tj.prototype.cancel=Tj.prototype.cancel;function Wj(a,b,c,d,e,f){var g;for(g=[];d<=e;d++){var h=g.concat,k=a;var l=c;var n=Fb(d);k.pixelProjection.Wa(n);var p=k.wj(l);l=k.Bh(p,n);n=Bh(k,l,p.left>p.right,n);g=h.call(g,n)}a=g.length;Tj.call(this,f,a);this.cx=c=[];this.Uq=A(this.Uq,this);this.Tq=A(this.Tq,this);for(this.G(1);a--;)f=g[a],c.push(Xj(b,f[0],f[1],f[2],this.Uq,this.Tq))}u(Wj,Tj);Wj.prototype.Uq=function(){Vj(this,2)};Wj.prototype.Tq=function(){Vj(this,4)};
Wj.prototype.Si=function(){for(var a=this.cx,b=a.length;b--;)a[b].cancel();delete this.cx};function Yj(a,b,c,d){Yj.g.constructor.call(this,a,b,c);this.modifiers=d}u(Yj,nh);t("H.map.ChangeEvent",Yj);var Zj={SIZE:1,POSITION:2,HEADING:4,TILT:8,INCLINE:16,ZOOM:32,BOUNDS:64};Yj.Type=Zj;Yj.prototype.Sx=Zj.SIZE;Yj.prototype.SIZE=Yj.prototype.Sx;Yj.prototype.Os=Zj.POSITION;Yj.prototype.POSITION=Yj.prototype.Os;Yj.prototype.Gs=Zj.HEADING;Yj.prototype.HEADING=Yj.prototype.Gs;Yj.prototype.Rs=Zj.TILT;Yj.prototype.TILT=Yj.prototype.Rs;Yj.prototype.Hs=Zj.INCLINE;Yj.prototype.INCLINE=Yj.prototype.Hs;
Yj.prototype.Ss=Zj.ZOOM;Yj.prototype.ZOOM=Yj.prototype.Ss;Yj.prototype.As=Zj.BOUNDS;Yj.prototype.BOUNDS=Yj.prototype.As;function ak(){this.ba=[];ak.g.constructor.call(this)}u(ak,J);t("H.util.OList",ak);function bk(a,b,c){a=a.ba.length;if(c)var d=a;else if(E(d=0>(d=+b)?Db(0,a+d):Cb(a,d)))throw new Ge(ak,b,[0,a-1]);return d}ak.prototype.wo=function(a,b){this.ba.splice(b,0,a);this.dispatchEvent(new ck(this,this.l.Gi,b,a,null,null))};ak.prototype.add=function(a,b){this.wo(a,bk(this,b,E(b)))};ak.prototype.add=ak.prototype.add;
ak.prototype.jf=function(a){var b=this.ba.splice(a,1)[0];this.dispatchEvent(new ck(this,this.l.Ii,a,null,b,null));return b};ak.prototype.Bd=function(a){this.get(a);return this.jf(a)};ak.prototype.removeAt=ak.prototype.Bd;ak.prototype.remove=function(a){a=this.indexOf(a);return 0<=a?(this.jf(a),!0):!1};ak.prototype.remove=ak.prototype.remove;
ak.prototype.set=function(a,b){if(0!==this.ba.length||0!==a){this.get(a);a=bk(this,a,!1);var c=this.ba[a]}this.ba[a]=b;this.dispatchEvent(new ck(this,this.l.Ji,a,b,c,null));return c};ak.prototype.set=ak.prototype.set;ak.prototype.indexOf=function(a){return this.ba.indexOf(a)};ak.prototype.indexOf=ak.prototype.indexOf;ak.prototype.get=function(a){var b=bk(this,a,!1),c=this.ba;if(b>=c.length)throw new Ge(this.get,a,[0,c.length-1]);return c[b]};ak.prototype.get=ak.prototype.get;ak.prototype.Tz=function(){return this.ba.length};
ak.prototype.getLength=ak.prototype.Tz;ak.prototype.Ta=function(){return[].concat(this.ba)};ak.prototype.asArray=ak.prototype.Ta;ak.prototype.flush=function(){for(var a=this.ba.length;a--;)this.jf(a)};ak.prototype.flush=ak.prototype.flush;ak.prototype.i=function(){this.flush();ak.g.i.call(this)};ak.prototype.l={Gi:"add",Ii:"remove",Ji:"set",GD:"move"};function ck(a,b,c,d,e,f){ck.g.constructor.call(this,b,a);this.idx=c;this.added=d;this.removed=e;this.moved=f}u(ck,ie);ak.Event=ck;function dk(a){var b;dk.g.constructor.call(this);this.dispatchEvent=A(this.dispatchEvent,this);if(a){var c=a.length;for(b=0;b<c;b++)this.add(a[b])}}u(dk,ak);t("H.map.DataModel",dk);function ek(a,b){var c=b.getProvider&&b.getProvider();c&&(fk[c.uid]=c);b.fa(a)}function gk(a){var b=a.getProvider&&a.getProvider();b&&delete fk[b.uid];a.fa(null)}dk.prototype.add=function(a,b){C(a,yh,this.add,0);ek(this,a);dk.g.add.call(this,a,b)};dk.prototype.add=dk.prototype.add;
dk.prototype.set=function(a,b){C(b,yh,this.set,0);ek(this,b);(a=dk.g.set.call(this,a,b))&&gk(a);return a};dk.prototype.set=dk.prototype.set;dk.prototype.Bd=function(a){var b;(b=dk.g.Bd.call(this,a))&&gk(b);return b};dk.prototype.removeAt=dk.prototype.Bd;dk.prototype.remove=function(a){var b;(b=dk.g.remove.call(this,a))&&gk(a);return b};dk.prototype.remove=dk.prototype.remove;dk.prototype.flush=function(){for(var a=this.ba.length;a--;)this.Bd(a);dk.g.flush.call(this)};dk.prototype.flush=dk.prototype.flush;
var fk={};rb(fk);function hk(a,b,c){if(a=fk[a])return C(a[b],Function,hk,1,"invalid method"),a[b].apply(a,c)}dk.invoke=hk;function ik(){ik.g.constructor.call(this);this.Ln={};this.vk={position:new pc(0,0),zoom:0,heading:180,incline:0,tilt:0,bounds:new M(kf([90,-180,90,0,90,180,-90,180,-90,-180]))}}u(ik,J);t("H.map.ViewModel",ik);ik.prototype.l={Aa:"update",Ki:"sync"};
ik.prototype.Xc=function(a,b){if(!a)throw new D(this.Xc,0,a);var c=a[jk];if(db(c)&&!qc(c))throw new D(this.Xc,0,jk);c=a[kk];if(db(c)&&E(+c))throw new D(this.Xc,0,kk);c=a[lk];if(db(c)&&!C(c,oc))throw new D(this.Xc,0,lk);a=x.Object.assign({},a);c=mk(a,this.Ln,this.vk);nk(this,this.Ln,a);this.dispatchEvent(new ok(this.Ln,c,b));return this};ik.prototype.setLookAtData=ik.prototype.Xc;ik.prototype.Ib=function(){var a={};a[jk]=sc(this.vk[jk]);nk(this,a,this.vk,!0);return a};ik.prototype.getLookAtData=ik.prototype.Ib;
var jk="position",kk="zoom",lk="bounds",pk={Os:jk,Ss:kk,Gs:"heading",Rs:"tilt",Hs:"incline",As:lk},qk=Object.keys(pk).map(function(a){return pk[a]});
function nk(a,b,c,d){a.zv={};a.yv={};a.gv=[];for(var e=a.SB,f=a.RB,g=qk.length,h,k,l;g--;)if(h=qk[g],l=c[h],k=b[h],null==k||!d)if(null!=l){if(db(e)&&e.call(a,h,k,l),b[h]="position"!==h||l&&!E(l.lat)&&!E(l.lng)?l:sc(l),db(f)){switch(h){case "position":k=l&&k&&(l.lat!==k.lat||l.lng!==k.lng);break;case "bounds":k=l&&k&&!l.ea(k);break;default:k=l!==k}k&&f.call(a,h)}}else delete b[h]}ik.prototype.SB=function(a,b,c){this.zv[a]=b;this.yv[a]=c};ik.prototype.RB=function(a){this.gv.push(rk[a])};
var rk=qk.reduce(function(a,b){a[b]=Zj[b.toUpperCase()];return a},{});function mk(a,b,c){var d=0;["tilt","incline","heading",kk].forEach(function(e){E(a[e])?a[e]=E(b[e])?c[e]:b[e]:d|=rk[e]});[jk,lk].forEach(function(e){a[e]?d|=rk[e]:a[e]=b[e]||c[e]});return d}ik.prototype.sb=function(a){var b={},c={};nk(this,this.vk,a);this.Ln={};b.lookAt=this.yv;c.lookAt=this.zv;a=this.gv;a=a.length?a.reduce(sk):0;this.dispatchEvent(new Yj(this.l.Ki,b,c,a))};ik.prototype.synchronize=ik.prototype.sb;
function sk(a,b){return a|b}ik.prototype.Lk=function(a,b){if(E(a=+a))throw new D(this.Lk,0,kk);this.Xc({zoom:a},b)};ik.prototype.Tb=function(){return this.vk.zoom};ik.prototype.Fd=zb;ik.prototype.startControl=ik.prototype.Fd;ik.prototype.control=zb;ik.prototype.control=ik.prototype.control;ik.prototype.hc=zb;ik.prototype.endControl=ik.prototype.hc;function ok(a,b,c){ok.g.constructor.call(this,ik.prototype.l.Aa,a,null,b);this.animate=this.animate=ob(c)&&0<c&&Infinity>c?c:!!c}u(ok,Yj);function tk(a,b){b=b||{};var c;if(!C(a,Element))throw new D(tk,0,a);var d=a.ownerDocument.createElement("div");this.J=a;tk.g.constructor.call(this);this.padding=new fg(0,0,0,0);this.center=new L(0,0);this.margin=0;this.element=d;d.style.zIndex=0;d.style.height=d.style.width="100%";d.style.direction="ltr";d.style.position="relative"===a.style.position?"absolute":"relative";this.resize();a.appendChild(d);(c=b.padding)!==B&&this.Qr(c.top,c.right,c.bottom,c.left);this.Lr((c=b.margin)!==B?c:0)}u(tk,J);
t("H.map.ViewPort",tk);tk.prototype.l={Aa:"update",Ki:"sync"};tk.prototype.Lr=function(a){if(this.margin!==+a){if(E(this.margin=+a))throw new D(this.Lr,0,a);this.ye();this.dispatchEvent(this.l.Aa)}};tk.prototype.setMargin=tk.prototype.Lr;tk.prototype.Qr=function(a,b,c,d){var e=this.padding;if(e.top!==a||e.right!==b||e.bottom!==c||e.left!==d){if(E(a+b+c+d))throw new D(this.Qr);e.top=a;e.right=b;e.bottom=c;e.left=d;this.ye();this.dispatchEvent(this.l.Aa)}};tk.prototype.setPadding=tk.prototype.Qr;
tk.prototype.ye=function(){var a=this.padding;this.center.set((this.width+a.left-a.right)/2<<0,(this.height+a.top-a.bottom)/2<<0)};tk.prototype.resize=function(){var a=this.J.offsetWidth,b=this.J.offsetHeight;if(this.width!==a||this.height!==b)this.EB=new Jh(this.width,this.height),this.width=a,this.height=b,this.ye(),this.dispatchEvent(this.l.Aa)};tk.prototype.resize=tk.prototype.resize;tk.prototype.sb=function(a){this.dispatchEvent(new Yj(this.l.Ki,this.EB,a,Zj.SIZE))};
tk.prototype.synchronize=tk.prototype.sb;tk.prototype.i=function(){this.J.removeChild(this.element);delete this.J;delete this.element;tk.g.i.call(this)};tk.prototype.Gd=zb;tk.prototype.startInteraction=tk.prototype.Gd;tk.prototype.td=zb;tk.prototype.interaction=tk.prototype.td;tk.prototype.ic=zb;tk.prototype.endInteraction=tk.prototype.ic;function uk(a,b,c,d){var e=new fg(0,0,0,0);uk.g.constructor.call(this);if(!a)throw new D(uk,0,a);if(!b)throw new D(uk,1,b);if(!c)throw new D(uk,2,c);if("object"!==typeof d)throw new D(uk,3,d+" is not an object");if("number"!==typeof d.pixelRatio)throw new D(uk,3,d.pixelRatio+" is not a number");this.ka=d.pixelRatio;this.zoom=0;this.Ab=Ib(this.ka)/Sb;this.pixelProjection=new vh;this.hl={1:e.clone(),2:e.clone(),4:e.clone()};this.vd=new L(.5,.5);this.za=a;vk(this,this.ka);this.Gd=A(this.Gd,this);this.td=
A(this.td,this);this.ic=A(this.ic,this);a.startInteraction=this.Gd;a.interaction=this.td;a.endInteraction=this.ic;a.addEventListener(a.l.Aa,this.gg,!1,this);this.getCapabilities=this.getCapabilities;this.capture=this.capture;this.zoomAt=this.Ig;this.relaunch=this.ca;this.dispose=this.u;this.screenToGeo=this.Xa;this.geoToScreen=this.Ka;this.screenToLookAtData=this.Qn;this.ze=b;this.Fd=A(this.Fd,this);this.control=A(this.control,this);this.hc=A(this.hc,this);b.startControl=this.Fd;b.control=this.control;
b.endControl=this.hc;b.addEventListener(b.l.Aa,this.Wq,!1,this);this.jb=c;this.an=A(this.an,this);this.dg=A(this.dg,this);this.eg=A(this.eg,this);this.$m=A(this.$m,this);c.addEventListener(yh.prototype.l.Aa,this.an,!1,this);c.addEventListener(c.l.Gi,this.dg,!1,this);c.addEventListener(c.l.Ii,this.eg,!1,this);c.addEventListener(c.l.Ji,this.$m,!1,this)}u(uk,J);t("H.map.render.RenderEngine",uk);uk.prototype.Ig=function(){};
function vk(a,b){var c=a.za,d=c.width,e=c.height,f=c.padding,g=f.top,h=f.left,k=f.bottom;f=f.right;c=c.margin;var l=-(d+h-f)/2<<0,n=-(e+g-k)/2<<0;d+=l;e+=n;a=a.hl;a[1].set((l-c)*b,(n-c)*b,(d+c)*b,(e+c)*b);a[2].set(l*b,n*b,d*b,e*b);a[4].set((l+h)*b,(n+g)*b,(d-f)*b,(e-k)*b)}uk.prototype.gg=function(){vk(this,this.ka)};
uk.prototype.i=function(){var a=this.za,b=this.ze,c=this.jb;a.removeEventListener(a.l.Aa,this.gg,!1,this);a.startInteraction===this.Gd&&(a.startInteraction=tk.prototype.Gd);a.interaction===this.td&&(a.interaction=tk.prototype.td);a.endInteraction===this.ic&&(a.endInteraction=tk.prototype.ic);b.removeEventListener(b.l.Aa,this.Wq,!1,this);b.startControl===this.Fd&&(b.startControl=ik.prototype.Fd);b.control===this.control&&(b.control=ik.prototype.control);b.endControl===this.hc&&(b.endControl=ik.prototype.hc);
c.removeEventListener(yh.prototype.l.Aa,this.an,!1,this);c.removeEventListener(c.l.Gi,this.dg,!1,this);c.removeEventListener(c.l.Ii,this.eg,!1,this);c.removeEventListener(c.l.Ji,this.$m,!1,this)};uk.prototype.Hr=function(a){this.Ao=a};uk.prototype.setAnimationCallback=uk.prototype.Hr;uk.prototype.yr=function(){this.Ao=void 0};uk.prototype.resetAnimationCallback=uk.prototype.yr;uk.prototype.control=function(){};uk.prototype.capture=function(){return Ed(Error("not implemented"))};
function wk(a,b){a.style.transition="opacity 1.5s";re(a,"transitionend",b,!1);a.style.opacity=0}var xk={ZOOM:1,HEADING:2,TILT:4,INCLINE:8,COORD:16};uk.InteractionModifiers=xk;m=uk.prototype;m.l={Qs:"render"};m.an=function(a){this.Gv(a);this.ca()};m.dg=function(a){this.dk(a.idx,a.added)};m.eg=function(a){this.Pq(a.idx,a.removed,a.type===this.jb.l.Ji)};m.$m=function(a){a.removed&&this.eg(a);this.dg(a)};m.Gv=Xe;m.dk=function(a,b){this.bq(a,b);0===a&&this.wc();C(b,yh)&&yk(this,b,!0);this.hi();this.ca()};
m.wc=function(){var a=this.jb.Ta();if(0<a.length){var b=a[0].max;this.uq=a[0].min;this.tq=b}else a=this.getCapabilities().lookAt.zoom,b=a.max,this.uq=a.min,this.tq=b;a=zk(this,this.zoom);a!==this.zoom&&(this.zoom=a,this.pixelProjection.Wa(a),this.sb())};m.sb=function(a){this.pf=this.Ib();a&&(this.pf.position=a);this.pf.zoom=this.zoom-this.Ab;this.pf.position.alt=0};m.lx=0;m.heading=180;
m.Ib=function(){return Ak(this,{position:this.pixelProjection.projection.sn(this.vd),zoom:this.zoom,tilt:this.lx,heading:this.heading})};function Ak(a,b){b.tilt=Bk(a,b.tilt);b.heading=Ck(a,b.heading);b.incline=a.getCapabilities().lookAt.incline.min;return b}function zk(a,b){var c=a.getCapabilities().lookAt.zoom;return ec(b,Db(c.min,a.uq),Cb(c.max,a.tq))}function Bk(a,b){a=a.getCapabilities().lookAt.tilt;return ec(b,a.min,a.max)}
function Ck(a,b){a=a.getCapabilities().lookAt.heading;return ec((b%360+360)%360,a.min,a.max)}function yk(a,b,c){c=c?b.addEventListener:b.removeEventListener;c.call(b,b.l.Ms,a.Qq,!1,a);c.call(b,b.l.Ls,a.Qq,!1,a)}m.bq=Xe;m.Pq=Xe;m.OC=function(a,b){this.af={before:a,after:b}};uk.prototype.setOnRenderCallbacks=uk.prototype.OC;var Dk={P2D:0,WEBGL:1,HARP:2};uk.EngineType=Dk;function Ek(){}t("H.util.ICapturable",Ek);Ek.prototype.capture=function(){};Ek.prototype.capture=Ek.prototype.capture;function Fk(a,b){var c=a.F(),d=c.ownerDocument;Fk.g.constructor.call(this);this.v=a;this.J=c=c.appendChild(Gk(d,"DIV","position:absolute;bottom:0;right:0;left:0px;z-index:1;direction:ltr;pointer-events:none;height:40px-webkit-touch-callout: none;-webkit-user-select:none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select:none;",null,"H_imprint"));this.wl=Gk(d,"DIV","margin: 0 0 16px 16px;display:inline-block;",'<svg height="40" viewBox="0 0 47 40" width="47" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m45.2054149 8.82876345.6003191.40637037-.2240425.6914074-.4490426 1.38570368c-.1024468.3148889-.6998936 1.9596297-2.43 3.5918519l-.017234.0163704c-.188617.1887407-.3801064.3659259-.5467021.5084444l-.4605319.4285185-.486383.4516296-.1407447-.0702963c-.7257447.4583704-1.4926596.7886667-2.2796809.9831852l.5840426.5864445-.6769149.6817778-2.052766 2.0636296-.169468.1704444-.019149.0192593-2.3821276 2.3958518c-.4902128.8493334-1.1202128 1.6331852-1.8497873 2.3111112-.6031915.6047407-1.2504255 1.1054814-1.935 1.4954814l-.4777659.4805186-4.3247873 4.3506666-.0296808.0298519-.0315958.0269629-2.1532978 1.8171111-.2661702.2253334h-.3485107-3.8948936l-3.968617 3.9914815-1.3547873 1.3616296-.6769148.6808148-.6769149-.6808148-1.3538298-1.3616296-4.80925535-4.837926-3.2687234-3.2875555-1.63436171-1.6437778h2.3112766 4.62255319 2.67223407l-4.71063832-4.7368148-.6769149-.6808148.6769149-.6808148 4.93851062-4.9650371.6769149-.6798518.6769149.6808148 2.7296809 2.7454074c.9363829-.8820741 2.1485106-1.4685185 3.4037234-1.6562963.278617-1.4694815 1.0187234-2.834963 2.168617-3.9885926.5696808-.572 1.1843617-1.0438519 1.8335106-1.4107407l.2901064-.2917778 4.3094681-4.31985187c.5830851-1.0582963 1.4256383-1.78918519 2.0364893-2.12718519l.4471277-.24748148c.3829787-.7617037.9047872-1.47622222 1.5539362-2.12622222 1.510851-1.51666667 3.3165957-2.31881482 5.22-2.31881482.0871276 0 .1752127.00192593.2594681.00577778 1.9484042.06933334 3.8441489.97933334 5.4775532 2.62792593.1512765.15022222.3303191.34859259.5361702.5797037l.0526595.05874074c.1120213.12518519.2345745.26192593.370532.40733334l1.2657446 1.36066666.6328724.67985185-.6548936.65866667-.2508511.25325926zm-27.9288192 22.17414815h-9.57446804l4.78723404 4.8148148zm23.1864894-21.70422223c-.9220213 1.38666663-2.5180851 3.63037033-4.1984042 1.94133333l4.2510638-4.27651851c-.3810638-.41022222-.6711702-.754-.8923404-.97740741-2.2921277-2.31207407-4.8743617-2.34192593-6.8984043-.312-1.3528723 1.35681481-1.7071277 2.91007407-1.313617 4.38533332l-1.332766-1.52629628c-.385851.21474074-2.0182979 1.65918518-.7937234 3.84703708l-1.5252127-1.274963-2.0240426 2.0299259 2.7344681 2.7502222c-2.1121277-1.6861481-4.3889362-1.5205185-6.2157447.312-1.9560638 1.9615556-1.8181915 4.3381482-.3532979 6.293926l-.295851-.2946667c-1.9321277-1.9432593-4.0318085-1.2576296-5.0706383-.2128148-.8023405.8079259-1.2944681 1.9191852-1.0924468 2.6905185l-4.195532-4.2187407-2.22893613 2.2408148 8.25893613 8.3065185h4.4339362l-2.9767021-2.9938519c-.5893908-.6029568-.9604155-1.0987731-1.1531529-1.5232627-.3182349-.7008886-.1504161-1.2073234.3230465-1.680515.7334043-.7318519 1.583617-.2763704 3.0829787 1.2277777l2.9412766 2.9562963 2.2164894-2.2292592-2.7909575-2.8060741c2.0125532 1.5291852 4.4224468 1.612 6.5728724-.545037 1.3567021-1.2653334 1.7425532-2.4565185 1.7425532-2.4565185l-1.6755319-1.1314815c-.9229788 1.3866666-2.5152128 3.6361481-4.195532 1.9461481l4.2606383-4.2851852 2.655 2.6712593 2.3160639-2.3294074-3.3223405-3.3424445c-1.5520212-1.5609629-.6328723-3.0275555.0124469-3.5793333.3025531.6442222.7448936 1.2624445 1.3078723 1.8296296 2.1485106 2.1676297 4.9260638 2.6038519 7.3685106.1550371 1.3567022-1.2643704 1.7425532-2.4565185 1.7425532-2.4565185zm-3.6564894-1.35537321-2.0211702 2.03377777c-.9890425-1.18251851-.9392553-1.81422222-.3245744-2.43051851.7439361-.7462963 1.4993617-.43044445 2.3457446.39674074zm-12.4879787 12.56088884c-.9890425-1.1825185-.9411702-1.819037-.3284042-2.4353333.7448936-.7462963 1.5003191-.4304444 2.3467021.3967408z" fill="#0f1621" fill-opacity=".7"/><path d="m17.2765957 31.0029116-4.787234 4.8148148-4.78723404-4.8148148zm23.1864894-21.70422223 1.6755319 1.13148153s-.385851 1.1921481-1.7425532 2.4565185c-2.4424468 2.4488148-5.22 2.0125926-7.3685106-.1550371-.5629787-.5671851-1.0053192-1.1854074-1.3078723-1.8296296-.6453192.5517778-1.5644681 2.0183704-.0124469 3.5793333l3.3223405 3.3424445-2.3160639 2.3294074-2.655-2.6712593-4.2606383 4.2851852c1.6803192 1.69 3.2725532-.5594815 4.195532-1.9461481l1.6755319 1.1314815s-.3858511 1.1911851-1.7425532 2.4565185c-2.1504256 2.157037-4.5603192 2.0742222-6.5728724.545037l2.7909575 2.8060741-2.2164894 2.2292592-2.9412766-2.9562963c-1.4993617-1.5041481-2.3495744-1.9596296-3.0829787-1.2277777-.4734626.4731916-.6412814.9796264-.3230465 1.680515.1927374.4244896.5637621.9203059 1.1531529 1.5232627l2.9767021 2.9938519h-4.4339362l-8.25893613-8.3065185 2.22893613-2.2408148 4.195532 4.2187407c-.2020213-.7713333.2901063-1.8825926 1.0924468-2.6905185 1.0388298-1.0448148 3.1385106-1.7304445 5.0706383.2128148l.295851.2946667c-1.4648936-1.9557778-1.6027659-4.3323704.3532979-6.293926 1.8268085-1.8325185 4.103617-1.9981481 6.2157447-.312l-2.7344681-2.7502222 2.0240426-2.0299259 1.5252127 1.274963c-1.2245745-2.1878519.4078724-3.63229634.7937234-3.84703708l1.332766 1.52629628c-.3935107-1.47525925-.0392553-3.02851851 1.313617-4.38533332 2.0240426-2.02992593 4.6062766-2.00007407 6.8984043.312.2211702.22340741.5112766.56718519.8923404.97740741l-4.2510638 4.27651851c1.6803191 1.689037 3.2763829-.5546667 4.1984042-1.94133333zm-16.1444681 11.20551563 2.0182979-2.0385925c-.846383-.8271852-1.6018085-1.1430371-2.3467021-.3967408-.612766.6162963-.6606383 1.2528148.3284042 2.4353333zm12.4879787-12.56088884c-.8463829-.82718519-1.6018085-1.14303704-2.3457446-.39674074-.6146809.61629629-.6644681 1.248.3245744 2.43051851z" fill="#fff" fill-opacity=".3"/></g></svg>',
"H_logo");c.appendChild(this.wl);c=c.appendChild(Gk(d,"DIV","right:0;bottom:0;position:absolute;background-color:rgba(255,255,255,.8);color:#0F1621;padding:2px 16px",null,"H_copyright"));this.fs=c.appendChild(Gk(d,"A","color:inherit; margin:0px 8px; text-decoration:none; pointer-events:all;","Terms of use"));this.fs.target="_blank";this.Ml=c.appendChild(Gk(d,"SPAN","margin:0px 8px"));this.Xf=c.appendChild(Gk(d,"SPAN"));this.Wu=Ra(Hk);this.Pr(b);this.zi=A(this.zi,this);this.ce=A(this.ce,
this);this.v.addEventListener(this.v.l.Ks,this.zi);this.v.P.addEventListener("add",this.ce);this.v.P.addEventListener("remove",this.ce);this.v.P.addEventListener("set",this.ce);this.ce()}var Ik;u(Fk,Zd);t("H.map.Imprint",Fk);var Hk={font:'11px "Lucida Grande", Arial, Helvetica, sans-serif',href:"https://legal.here.com/{LN}/terms/serviceterms/{CN}",invert:!1,reportHref:"https://wego.here.com/",locale:"en-US",mark:""};
Fk.prototype.Pr=function(a){var b,c=this.wl.firstElementChild.firstElementChild.children;a||(this.Wu=Ra(Hk));var d=this.Wu;for(b in d)a&&b in a&&(d[b]=a[b]);a=(this.jq=a=d.invert)?Jk:Kk;c[0].style.fill=a.Uw;c[0].style.fillOpacity=""+a.Vw;c[1].style.fill=a.gx;c[1].style.fillOpacity=""+a.hx;a=d.locale;Lk[a]||(a="en-US",d.locale=a);this.fs.innerHTML=Lk[a];a=a.split("-");this.fs.href=d.href.replace("{LN}",a[0]).replace("{CN}",a[1].toLowerCase());d.mark?(this.Xf.innerHTML=d.mark,this.Xf.style.margin="0px 8px"):
(this.Xf.innerHTML="",this.Xf.style.margin="0px");this.J.style.font=d.font};Fk.prototype.setOptions=Fk.prototype.Pr;function Gk(a,b,c,d,e){a=a.createElement(b);c&&(a.style.cssText=c);d&&(a.innerHTML=d);e&&(a.className=e);return a}Fk.prototype.F=function(){return this.J};Fk.prototype.zi=function(){this.Ml.innerHTML=this.Cs+" "+this.V()};Fk.prototype.ce=function(){this.zi();setTimeout(this.zi,5E3)};
var Kk={gx:"#0F1621",hx:.3,Uw:"#fff",Vw:.6},Jk={gx:"#fff",hx:1,Uw:"#0F1621",Vw:.7},Mk="1987&ndash;"+Db(2015,(new Date).getFullYear())+" HERE";Fk.prototype.V=function(){var a=this.v,b=a.Tb(),c=a.xa.Ib().bounds;a=a.P;var d=a.ba.length,e={},f=0,g,h,k,l=[Mk];if(c)for(;f<d;f++)if(h=a.get(f).getCopyrights(c.C(),b))for(g=0;g<h.length;g++)e[k=h[g].label]||(l.push(k),e[k]=1);return l.join(", ")};Fk.prototype.getCopyrights=Fk.prototype.V;Fk.prototype.L=function(){return this.J.style};Fk.prototype.Cs=String.fromCharCode(169);
Fk.prototype.i=function(){this.v.removeEventListener(this.v.l.Ks,this.zi);this.v.P.removeEventListener("add",this.ce);this.v.P.removeEventListener("remove",this.ce);this.v.P.removeEventListener("set",this.ce);if(this.J.parentNode){var a=this.J;a.parentNode.removeChild(a)}};Fk.prototype.disposeInternal=Fk.prototype.i;
Fk.prototype.capture=function(a,b,c,d){var e=a.getContext("2d"),f=window.getComputedStyle(this.Ml.parentElement),g=2*kb(f.paddingLeft,10),h=(this.Ml.offsetWidth+2*g)*b,k=this.Ml.offsetHeight*b,l=0!==this.Xf.innerHTML.length?this.Xf.offsetWidth*b:0,n=lb(f.getPropertyValue("font-size")),p=this.J.ownerDocument,q=+a.width,r=+a.height,v=16*b,w=this.wl.childNodes[0].getBoundingClientRect(),y=w.width*b,I=w.height*b,G=Xe;ab(d)&&(G=function(){d("capture_error")});e.fillStyle=f.backgroundColor;e.fillRect(q-
h-l,r-k,h+l,k);h=this.Xf.innerHTML;h=this.Cs+" "+function(S){S=Gk(p,"div",null,S);return S.textContent||S.innerText||""}(this.V())+(h?" "+h:"");e.font=n*b+"px "+f.getPropertyValue("font-family");e.fillStyle=f.getPropertyValue("color");e.textBaseline="bottom";e.textAlign="right";e.fillText(h,q-g*b,r);Nk(this,e.font,function(S){(new Tg("image",S)).then(function(X){e.drawImage(X,v,r-(I+v),y,I);c(a)},G)},G)};Fk.prototype.capture=Fk.prototype.capture;
function Nk(a,b,c,d){Ok(A(function(e){e?this.jq?c("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAADNklEQVRYR82XW6hVVRSGv7+rmJfSMKSnSkMEfY7EogcJC7tilGRopBAiSaI+SBARQSCIIqgFISih2YW0oAgLCsKXojA0RB+81VugZEFZv/yHuWTt7d7Hfc4+6+h4OWefNfcc3xlj/v+YS1zjoab5bE8DZgGngB8keSg5GwO0PQ54F3i2BnQIWCLpx14hGwG0fT3wOfBwB5DzwOOSDvQC2RTgM8Ae4D/gaeA3YDdwN5AWvyxp+6gD2r4OmAq8AbwInAMmA/OAT4CbgBWStvYClzUjWkHbrwHLgF8LVHJ8DDxah7P9JHCil7M40oA/A7OBC8ANtSqlrQOVs30/8CWQat8r6cxg1RwRQNvPA88Bk4D7gJzBV4A5teSp5MlS4VuA/ZIeu1Kr+wa0/QTwIRDlRhT5eTswBvi2CKOd42AULilndNAYCcA7gK+BmbVMiyXtsh3Qt4FFBTgW8w6wXtLfV4LrSyS2FwAvAWOBX+JtwF0laUDmS/oun23fDNwJnJb0Ty9g1ZphVdB2qrK2LdFfBbb685/AIxXkUKDqa4cMaDs2kjalRe8Fola57J3qRQSJviGHA3gMuAdYI2lDUfDOArQLWAd8VTuTOW9vjUoFy6TIGYpS9wKfAjuK5wVuSfn91iKcvZJeHy5ci0hsZwzNk5Qh3xIFbLyks7aPAtPLgv+L4VZwDwLvA6uKz6XdfcVAi22PBz4q4+lVSRurXW2vKYKIZfwEHCmmXC35HngAyITYD0ys2t8XWflyBfhmvKm24QCk7aVFCPVc7WMszzKucknI+NoHPCUppt13VICZm2nNwjoksByY0SXL72Vi3FieZ97mgrpyqF432H9xScW2O0H+W6oSE/4D2FYuA9kzlUzVTwO3Ad9IOtx3ydo2aLGZLpABm5KW2Z4AfAbMLfsEcpGkKLqRuMwHu0CukrSpCCrvGlF6hBEVL5MUw24kOhp1B8gc+FTqgxpkFLuzSbjk6jpJOkC2tDPeKCkVbDRkO67fDTTC2VK7vgfyBUlfNEpV2zyAK4HNXRLmZfshScdHC6g9T+WDGU2XpkdZdNXhWs6g7dXAhmsJ7jKR2M77bG4kV7Wt9TZfBLgYEC7PSpcIAAAAAElFTkSuQmCC"):c("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIMSURBVFiFzdZPiE1RGADwXzPTTPIMQoodVpbKgpoUG5qExUi8DSVJQv4slJJsbNjYWFhNETWLUUosRDRLUVLCYhIiojFojHkW997uvefNGIuZc99Xp/fOO6/Or++c75xDi0d7hDlWYQNqeB9hvv+OGq6jUWjPsKZKVBbtuKOMy9p3bKqOlsROCWYc27AWr9PfJnCgKlgbluNqivmGDmzBrxR3sCocnMEw7sqXdEAzboeK9uLTFPVbed8VcesxglFJtqNEHbcxlIL68ChADuCSpEgauBULt11SDI3C5yJJdrLCCNsQumMBl+J5AKinY4slBfNTfsRcxJwYsK0YxD3J0r1RPut6Cv/twgp0xoDBBc3LNhr0RwJktNifAn7gsnLmsuxVinyVTn4i7dcLoH4sU96Tp2Pi2uSVehN75Gdev+QO7pIXztmZnLwTvf+AzU+/v5Rn50+A24gP2IW5M4mbJ7+ejgVjJ/EpHXuCa8p77nGK68FX5eWfsTgfTJoh92qu1vAaa+CtPJuDZuEh3CHZUyHyxSSYrL3DWKE/gStm8aybDDkmKYperJM/BrJMnsJuHMLq2YJNh/wsX7JuPAyQfTFg0yGPFMZreCCv4n2xgTQjxyXP+CxquK8iXBYhMlzOtliQBVg4RVuCG/iSto/YHAuWxWFTHyXDWBkbNFkc1cK4LI5rYVwW57QY7i/pZeJv8QQJRQAAAABJRU5ErkJggg=="):
(e=this.wl.cloneNode(!0),e.firstChild.setAttribute("style","font:"+b),c(Re(e.innerHTML)))},a),d)}Fk.prototype.jq=!1;
function Ok(a,b){var c="data:image/svg+xml;charset=utf-8,"+encodeURIComponent('<svg height="40" viewBox="0 0 47 40" width="47" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m45.2054149 8.82876345.6003191.40637037-.2240425.6914074-.4490426 1.38570368c-.1024468.3148889-.6998936 1.9596297-2.43 3.5918519l-.017234.0163704c-.188617.1887407-.3801064.3659259-.5467021.5084444l-.4605319.4285185-.486383.4516296-.1407447-.0702963c-.7257447.4583704-1.4926596.7886667-2.2796809.9831852l.5840426.5864445-.6769149.6817778-2.052766 2.0636296-.169468.1704444-.019149.0192593-2.3821276 2.3958518c-.4902128.8493334-1.1202128 1.6331852-1.8497873 2.3111112-.6031915.6047407-1.2504255 1.1054814-1.935 1.4954814l-.4777659.4805186-4.3247873 4.3506666-.0296808.0298519-.0315958.0269629-2.1532978 1.8171111-.2661702.2253334h-.3485107-3.8948936l-3.968617 3.9914815-1.3547873 1.3616296-.6769148.6808148-.6769149-.6808148-1.3538298-1.3616296-4.80925535-4.837926-3.2687234-3.2875555-1.63436171-1.6437778h2.3112766 4.62255319 2.67223407l-4.71063832-4.7368148-.6769149-.6808148.6769149-.6808148 4.93851062-4.9650371.6769149-.6798518.6769149.6808148 2.7296809 2.7454074c.9363829-.8820741 2.1485106-1.4685185 3.4037234-1.6562963.278617-1.4694815 1.0187234-2.834963 2.168617-3.9885926.5696808-.572 1.1843617-1.0438519 1.8335106-1.4107407l.2901064-.2917778 4.3094681-4.31985187c.5830851-1.0582963 1.4256383-1.78918519 2.0364893-2.12718519l.4471277-.24748148c.3829787-.7617037.9047872-1.47622222 1.5539362-2.12622222 1.510851-1.51666667 3.3165957-2.31881482 5.22-2.31881482.0871276 0 .1752127.00192593.2594681.00577778 1.9484042.06933334 3.8441489.97933334 5.4775532 2.62792593.1512765.15022222.3303191.34859259.5361702.5797037l.0526595.05874074c.1120213.12518519.2345745.26192593.370532.40733334l1.2657446 1.36066666.6328724.67985185-.6548936.65866667-.2508511.25325926zm-27.9288192 22.17414815h-9.57446804l4.78723404 4.8148148zm23.1864894-21.70422223c-.9220213 1.38666663-2.5180851 3.63037033-4.1984042 1.94133333l4.2510638-4.27651851c-.3810638-.41022222-.6711702-.754-.8923404-.97740741-2.2921277-2.31207407-4.8743617-2.34192593-6.8984043-.312-1.3528723 1.35681481-1.7071277 2.91007407-1.313617 4.38533332l-1.332766-1.52629628c-.385851.21474074-2.0182979 1.65918518-.7937234 3.84703708l-1.5252127-1.274963-2.0240426 2.0299259 2.7344681 2.7502222c-2.1121277-1.6861481-4.3889362-1.5205185-6.2157447.312-1.9560638 1.9615556-1.8181915 4.3381482-.3532979 6.293926l-.295851-.2946667c-1.9321277-1.9432593-4.0318085-1.2576296-5.0706383-.2128148-.8023405.8079259-1.2944681 1.9191852-1.0924468 2.6905185l-4.195532-4.2187407-2.22893613 2.2408148 8.25893613 8.3065185h4.4339362l-2.9767021-2.9938519c-.5893908-.6029568-.9604155-1.0987731-1.1531529-1.5232627-.3182349-.7008886-.1504161-1.2073234.3230465-1.680515.7334043-.7318519 1.583617-.2763704 3.0829787 1.2277777l2.9412766 2.9562963 2.2164894-2.2292592-2.7909575-2.8060741c2.0125532 1.5291852 4.4224468 1.612 6.5728724-.545037 1.3567021-1.2653334 1.7425532-2.4565185 1.7425532-2.4565185l-1.6755319-1.1314815c-.9229788 1.3866666-2.5152128 3.6361481-4.195532 1.9461481l4.2606383-4.2851852 2.655 2.6712593 2.3160639-2.3294074-3.3223405-3.3424445c-1.5520212-1.5609629-.6328723-3.0275555.0124469-3.5793333.3025531.6442222.7448936 1.2624445 1.3078723 1.8296296 2.1485106 2.1676297 4.9260638 2.6038519 7.3685106.1550371 1.3567022-1.2643704 1.7425532-2.4565185 1.7425532-2.4565185zm-3.6564894-1.35537321-2.0211702 2.03377777c-.9890425-1.18251851-.9392553-1.81422222-.3245744-2.43051851.7439361-.7462963 1.4993617-.43044445 2.3457446.39674074zm-12.4879787 12.56088884c-.9890425-1.1825185-.9411702-1.819037-.3284042-2.4353333.7448936-.7462963 1.5003191-.4304444 2.3467021.3967408z" fill="#0f1621" fill-opacity=".7"/><path d="m17.2765957 31.0029116-4.787234 4.8148148-4.78723404-4.8148148zm23.1864894-21.70422223 1.6755319 1.13148153s-.385851 1.1921481-1.7425532 2.4565185c-2.4424468 2.4488148-5.22 2.0125926-7.3685106-.1550371-.5629787-.5671851-1.0053192-1.1854074-1.3078723-1.8296296-.6453192.5517778-1.5644681 2.0183704-.0124469 3.5793333l3.3223405 3.3424445-2.3160639 2.3294074-2.655-2.6712593-4.2606383 4.2851852c1.6803192 1.69 3.2725532-.5594815 4.195532-1.9461481l1.6755319 1.1314815s-.3858511 1.1911851-1.7425532 2.4565185c-2.1504256 2.157037-4.5603192 2.0742222-6.5728724.545037l2.7909575 2.8060741-2.2164894 2.2292592-2.9412766-2.9562963c-1.4993617-1.5041481-2.3495744-1.9596296-3.0829787-1.2277777-.4734626.4731916-.6412814.9796264-.3230465 1.680515.1927374.4244896.5637621.9203059 1.1531529 1.5232627l2.9767021 2.9938519h-4.4339362l-8.25893613-8.3065185 2.22893613-2.2408148 4.195532 4.2187407c-.2020213-.7713333.2901063-1.8825926 1.0924468-2.6905185 1.0388298-1.0448148 3.1385106-1.7304445 5.0706383.2128148l.295851.2946667c-1.4648936-1.9557778-1.6027659-4.3323704.3532979-6.293926 1.8268085-1.8325185 4.103617-1.9981481 6.2157447-.312l-2.7344681-2.7502222 2.0240426-2.0299259 1.5252127 1.274963c-1.2245745-2.1878519.4078724-3.63229634.7937234-3.84703708l1.332766 1.52629628c-.3935107-1.47525925-.0392553-3.02851851 1.313617-4.38533332 2.0240426-2.02992593 4.6062766-2.00007407 6.8984043.312.2211702.22340741.5112766.56718519.8923404.97740741l-4.2510638 4.27651851c1.6803191 1.689037 3.2763829-.5546667 4.1984042-1.94133333zm-16.1444681 11.20551563 2.0182979-2.0385925c-.846383-.8271852-1.6018085-1.1430371-2.3467021-.3967408-.612766.6162963-.6606383 1.2528148.3284042 2.4353333zm12.4879787-12.56088884c-.8463829-.82718519-1.6018085-1.14303704-2.3457446-.39674074-.6146809.61629629-.6644681 1.248.3245744 2.43051851z" fill="#fff" fill-opacity=".3"/></g></svg>'),d=
Ik;db(d)?a(d):(new Tg("image",c)).then(function(e){Ne.drawImage(e,0,0);try{Ne.getImageData(0,0,1,1),d=!1}catch(f){d=18===f.code}finally{Ik=d,a(d)}},b)}Fk.prototype.Xx=function(a,b){Lk[a]=b};Fk.prototype.addL11NString=Fk.prototype.Xx;
var Lk={"de-DE":"Nutzungsbedingungen","en-US":"Terms of use","en-GB":"Terms of use","es-ES":"Condiciones de uso","fi-FI":"Palveluehdot","fr-FR":"Conditions d'utilisation","it-IT":"Condizioni di utilizzo","nl-NL":"Dienstvoorwaarden","pl-PL":"Warunki \u015bwiadczenia us\u0142ugi","pt-BR":"Termos de servi\u00e7o","pt-PT":"Termos do servi\u00e7o","ru-RU":"\u0423\u0441\u043b\u043e\u0432\u0438\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f","tr-TR":"Servis Ko\u015fullar\u0131",
"zh-CN":"\u4f7f\u7528\u6761\u6b3e"};function Q(a){var b={};this.zu=b.previousSibling=b.nextSibling=b;this.XC=new Se;Q.g.constructor.call(this,a);a&&"objects"in a&&this.fd(a.objects)}u(Q,O);t("H.map.Group",Q);Q.prototype.type=Wh.GROUP;Q.prototype.oi=function(a,b){this.gr=!0;a=Q.g.oi.call(this,a,b);this.gr=!1;a&&this.forEach(Pk,!0);return a};Q.prototype.setProvider=Q.prototype.oi;function Pk(a,b,c){a.oi(c.D)}Q.prototype.contains=function(a){var b=this===a;if(!b&&this.Xg&&C(a,O))for(;!b&&a;)a===this?b=!0:a=a.Ma;return b};
Q.prototype.contains=Q.prototype.contains;Q.prototype.xk=function(){this.lo=B;this.forEach(Qk,!0)};Q.prototype.resetZInfo=Q.prototype.xk;function Qk(a){a.xk()}Q.prototype.gr=!1;Q.prototype.sa=function(a){var b=Q.g.sa.call(this,a);b&&!this.gr&&(this.Vt=a,this.forEach(Rk,!0),delete this.Vt);return b};Q.prototype.invalidate=Q.prototype.sa;function Rk(a,b,c){a.sa(c.Vt)}
Q.prototype.forEach=function(a,b,c){var d;if(this.Xg){var e=this.zu;var f=e.nextSibling;for(d=0;f!==e;){var g=f.nextSibling;a.call(c,f,d++,this);b&&C(f,Q)&&f.forEach(a,b,c);f=g}}};Q.prototype.forEach=Q.prototype.forEach;Q.prototype.cb=function(a){var b=[];this.forEach(Sk,a,b);return b};Q.prototype.getObjects=Q.prototype.cb;Q.prototype.C=function(){var a=null;this.Xg&&this.forEach(function(b){b.C&&(b=b.C())&&(a=a?a.wd(b):b)});return a};Q.prototype.getBoundingBox=Q.prototype.C;
function Sk(a){this.push(a)}Q.prototype.Xg=0;Q.prototype.lz=function(){return this.Xg};Q.prototype.getChildCount=Q.prototype.lz;
Q.prototype.$=function(a){var b=this.zu,c=b.previousSibling;C(a,O,this.$,0);if(a.contains(this))throw new Ab(this.$,"The new object contains the parent group");var d=a.lm(!0);var e=a.Ma;if(e!==this){if(e){e=a.previousSibling;var f=a.nextSibling;e.nextSibling=f;f.previousSibling=e}a.Ma=this;O.g.fa.call(a,this);c.nextSibling=a;a.previousSibling=c;a.nextSibling=b;b.previousSibling=a;this.Xg++}a.Yr=this.XC.next();a.xk();b=a.oi(this.D,this.$);a.lm(!0)!==d&&a.sa(Ih.VOLATILITY);b||a.sa(Ih.Z_ORDER);return a};
Q.prototype.addObject=Q.prototype.$;Q.prototype.fd=function(a){var b;ib(a,this.fd,0);var c=a.length;for(b=0;b<c;b++)this.$(a[b])};Q.prototype.addObjects=Q.prototype.fd;Q.prototype.Na=function(a){if(!a||a.Ma!==this)throw new Ab(this.Na,"object not found");var b=a.previousSibling,c=a.nextSibling;b.nextSibling=c;c.previousSibling=b;a.Ma=null;O.g.fa.call(a,null);delete a.previousSibling;delete a.nextSibling;C(a.D,P)&&a.oi(null,this.Na);this.Xg--;return a};Q.prototype.removeObject=Q.prototype.Na;
Q.prototype.pg=function(a){var b;ib(a,this.pg,0);var c=a.length;for(b=0;b<c;b++)this.Na(a[b])};Q.prototype.removeObjects=Q.prototype.pg;Q.prototype.ja=function(){var a=this.cb();this.pg(a)};Q.prototype.removeAll=Q.prototype.ja;
Q.prototype.ue=function(a){for(var b=this.cb(),c=0,d=b.length,e=[],f,g,h;c<d;c++)h=b[c],h instanceof Q?(f=a?a(h.getData()):h.getData(),g=Zh(this,f,!!a),f={type:"Feature"},f.properties=g,h.di&&(f.id=h.di),f.geometry={},f.geometry.type="GeometryCollection",f.geometry.geometries=Tk(this,h.cb()),e.push(f)):e.push(h.ue(a));return{type:"FeatureCollection",features:e}};Q.prototype.toGeoJSON=Q.prototype.ue;
function Tk(a,b){for(var c=0,d=b.length,e,f=[];c<d;c++)e=b[c],e=e instanceof Q?{type:"GeometryCollection",geometries:Tk(a,e.cb())}:e instanceof ai||e instanceof Ai||e instanceof xi||e instanceof Bi?e.W().ue():{type:"FeatureCollection",features:Ye},f.push(e);return f}Q.prototype.R=function(){var a=Q.g.R.call(this);a.type="Group";return a};Q.prototype.forWorkerMessage=Q.prototype.R;function Uk(a,b,c,d,e,f){Uk.g.constructor.call(this,isNaN(a)?15:a,b,c,d,e,f)}u(Uk,tc);Uk.prototype.Bl=function(a){for(var b,c,d=this.head,e=a;e;){if(a=e.entries)if(b=a.length){if(2>b&&(c=e.parent)&&1===c.ib){c.removeChild(e);d===e&&(d=c);c.entries=a;e=a[0].node=c;continue}}else if(delete e.entries,c=e.parent)if(c.removeChild(e),d===e&&(d=c),1===c.ib){e=c.ib?c[0]||c[1]||c[2]||c[3]:null;continue}break}this.head!==d&&(this.head=d,this.gd())};
Uk.prototype.Wd=function(a,b){if(Ac(this.root,a,b,a,b))return this.Ub(this.root,a,b,this.Lh);throw Error("Coordinates out of bounds");};Uk.prototype.Ub=function(a,b,c,d){var e=a.entries;if(d)if(a.ib)e=this.Kj(a,b,c,d);else if(e){e=e[0];var f=a.oh(+(e[1]>=a[8])|+(e[0]>=a[9])<<1);f.entries=a.entries;delete a.entries;e.node=f;this.gd(f);e=this.Kj(a,b,c,d)}else a.Lg(e=new Vk(b,c)),this.gd(a),wc(this,e,!0);else e||this.gd(a),a.Lg(e=new Vk(b,c)),wc(this,e,!0);return e};
Uk.prototype.Kj=function(a,b,c,d){return this.Ub(a.oh(+(b>=a[8])|+(c>=a[9])<<1),b,c,d-1)};function Vk(a,b){this.id=zc++;this[0]=b;this[1]=a}Vk.prototype.Hf=function(a){return this[a%2]};function Wk(){this.we=new Uk(10,180,90,0,0,!0)}m=Wk.prototype;m.jc=0;m.I=null;m.C=function(){var a=this.I,b;!a&&(b=uc(this.we))&&(this.I=a=new F(-b[0],b[3],-b[2],b[1]));return a};m.Wd=function(a){++this.jc;this.I=null;return this.we.Wd(a.lng,-a.lat)};m.remove=function(a){if(a=this.we.remove(a))--this.jc,this.I=null;return a};m.ym=function(a,b,c){var d=this.we,e=a.Kc(),f=a.Gc(),g=-e.lat;e=e.lng;var h=-f.lat;f=f.lng;return a.oc()?d.pb(-180,g,f,h,c,b).concat(d.pb(e,g,180,h,c,b)):d.pb(e,g,f,h,c,b)};function Xk(a){var b;eb(this,Xk);Xk.g.constructor.call(this,a);this.Qf=a=[];for(b in Wh)a[Wh[b]]=new Hh}u(Xk,N);t("H.map.provider.ObjectProvider",Xk);Xk.prototype.kr=Ve;Xk.prototype.providesByViewport=Xk.prototype.kr;Xk.prototype.Hc=function(a){return this.Qf[a||Wh.ANY]};Xk.prototype.getInvalidations=Xk.prototype.Hc;Xk.prototype.Dh=function(a,b){if(b!==Ih.NONE){var c=this.Qf[Wh.ANY];var d=c.Jd+1;c.update(d,b);c=this.Qf[a.type];c.update(d,b);a.Hc().update(d,b);this.kb(a)}};
Xk.prototype.invalidateObject=Xk.prototype.Dh;Xk.prototype.requestOverlays=Xk.prototype.rg;Xk.prototype.requestSpatials=Xk.prototype.Jn;Xk.prototype.requestSpatialsByTile=Xk.prototype.Kn;Xk.prototype.mw=!1;Xk.prototype.requestMarkers=Xk.prototype.le;Xk.prototype.requestDomMarkers=Xk.prototype.ke;function P(a){a=a||{};P.g.constructor.call(this,a);this.vg=a=new Q({min:a.min,max:a.max});a.D=this;a.fa(this);a.sa(Ih.ADD);this.fk=new Mc;this.ti=new Mc;this.Vj=new Wk;this.$j=new Mc;this.Ul=new Wk;this.Sm=new Mc}u(P,Xk);t("H.map.provider.LocalObjectProvider",P);P.prototype.getCapabilities=function(){return hh.PROVIDES_BY_VIEWPORT|hh.PROVIDES_WEBGL_RENDERABLE_OBJECTS|hh.PROVIDES_DOM_MARKERS|hh.CROP_LINES_BY_TILE};
P.prototype.nb=function(){if(!this.Qi&&(this.Qi=P.g.nb.call(this),this.Qi instanceof Zg)){var a=new mh(this.getCapabilities()|hh.HAS_VOLATILE_DATA,this.uid+"_vol",this.min,this.max,this.Oc,this.tileSize);this.Qi.Wj(a.Fe())}return this.Qi};P.prototype.getStyleInternal=P.prototype.nb;P.prototype.Ya=function(a,b){P.g.Ya.call(this,a,b);this.Qi=null};P.prototype.setStyleInternal=P.prototype.Ya;P.prototype.pd=function(){return this.vg};P.prototype.getRootGroup=P.prototype.pd;
P.prototype.Dh=function(a,b){b&Ih.SPATIAL&&this.$(a);P.g.Dh.call(this,a,b)};P.prototype.invalidateObject=P.prototype.Dh;P.prototype.$=function(a){var b;C(a,O,this.$,0);if(a.D!==this)throw new Ab(this.$,"foreign object");this.Na(a);var c=a.type;if(c===Wh.MARKER)if((b=a.W())instanceof pc){var d=!0;c=this.Vj}else c=this.$j;else c===Wh.DOM_MARKER?(b=a.W())instanceof pc?(d=!0,c=this.Ul):c=this.Sm:c=c===Wh.OVERLAY?this.fk:this.ti;d=d?c.Wd(b):c.Fu(a.C());d.ys=a;a.ws=d};
P.prototype.Na=function(a){var b;if(a)if(a.D!==this){if(C(a,O))throw new Ab(this.Na,"foreign object");}else if(b=a.ws){var c=a.type;c===Wh.MARKER?this.Vj.remove(b)||this.$j.remove(b):c===Wh.DOM_MARKER?this.Ul.remove(b)||this.Sm.remove(b):c===Wh.OVERLAY?this.fk.remove(b):this.ti.remove(b);delete b.ys;delete a.ws}};P.prototype.removeObject=P.prototype.Na;
function Yk(a,b,c,d,e,f,g){g=g||[];if(b.jc)for(a=b!==a.Vj&&b!==a.$j,e=!e,b=b.ym(c,f,f),c=b.length,f=0;f<c;f++){var h=b[f].ys;var k;if(k=void 0!==d){for(var l=Fb(d),n=h;(k=n.zb<=l&&n.Nc>=l)&&(n=n.Ma););k=!k}k||!e&&!h.Td(!0)||(a||1===h.kc().getState())&&g.push(h)}return g}P.prototype.mr=function(){return 0<this.fk.jc};P.prototype.providesOverlays=P.prototype.mr;P.prototype.rg=function(a,b,c){return Yk(this,this.fk,a,b,c,!1).filter(function(d){return d.Oe()})};P.prototype.requestOverlays=P.prototype.rg;
P.prototype.ie=function(){return 0<this.ti.jc};P.prototype.providesSpatials=P.prototype.ie;P.prototype.Jn=function(a,b,c){return Yk(this,this.ti,a,b,c,!1)};P.prototype.requestSpatials=P.prototype.Jn;P.prototype.Kn=function(a,b){return Yk(this,this.ti,a.gm(),a.zL,b,!1)};P.prototype.requestSpatialsByTile=P.prototype.Kn;P.prototype.Sc=function(){return 0<this.Vj.jc+this.$j.jc};P.prototype.providesMarkers=P.prototype.Sc;P.prototype.le=function(a,b,c){return Zk(this,a,b,c,!1)};
P.prototype.requestMarkers=P.prototype.le;function Zk(a,b,c,d,e){var f=Yk(a,a.Vj,b,c,d,e);Yk(a,a.$j,b,c,d,e,f);return f}P.prototype.Rc=function(){return 0<this.Ul.jc+this.Sm.jc};P.prototype.providesDomMarkers=P.prototype.Rc;P.prototype.ke=function(a,b,c){return $k(this,a,b,c,!1)};P.prototype.requestDomMarkers=P.prototype.ke;function $k(a,b,c,d,e){var f=Yk(a,a.Ul,b,c,d,e);Yk(a,a.Sm,b,c,d,e,f);return f}
function al(a,b,c){var d=c.W(),e,f=bl.bind(null,a);a=cl.bind(null,a);C(c,xi)?e=C(d,K)?f(d):d.ia.some(f):C(c,Bi)?e=C(d,M)?a(d):d.ia.some(a):C(c,Ai)&&(e=a(Bf(d)));e&&b.push(c)}function bl(a,b){a:{var c=b.T;var d=Gf(a,b);if(!d){b=b.T.length;for(var e=0;e<b;e+=3)if(Ef(a,c[e],c[e+1])){a=!0;break a}}a=d}return a}function cl(a,b){return Hf(a,b)}
function dl(a,b,c){for(var d=a.length;d--;){var e=a[d],f=e.W();if(C(f,Lf)){f=f.ia;for(var g=f.length,h;g--;)if(h=f[g],Ef(b,h.lat,h.lng)){c.push(e);break}}else Ef(b,f.lat,f.lng)&&c.push(e)}}
P.prototype.cb=function(a,b,c,d,e){var f=this,g=a.C(),h=[],k=Dd(),l=1;if(g)for(;l&Wh.ANY;){if(l&d)switch(l){case Wh.MARKER:k=k.then(function(){return Zk(f,g,c,b,!0)}).then(function(n){return dl(n,a,h)});break;case Wh.DOM_MARKER:k=k.then(function(){return $k(f,g,c,b,!0)}).then(function(n){return dl(n,a,h)});break;case Wh.SPATIAL:k=k.then(function(){return Yk(f,f.ti,g,c,b,!0)}).then(function(n){n.forEach(al.bind(null,a,h))});break;case Wh.OVERLAY:k=k.then(function(){return Yk(f,f.fk,g,c,b,!0)}).then(function(n){n.forEach(al.bind(null,
a,h))})}l<<=1}k.then(function(){return e(h)})};P.prototype.If=function(a,b,c){c=c||Ze;var d=c.zoom,e=c.visiblesOnly;c=c.types;var f=Wh.ANY;C(a,M,this.If,0,"area");gb(b,"Function",this.If,1,"callback");gb(d,"Number",this.If,2,"options");this.cb(a,db(e)?!!e:!0,d,db(c)?c&f:f,b)};P.prototype.getObjectsWithin=P.prototype.If;P.prototype.i=function(){P.g.i.call(this);this.vg.ja()};function el(){this.constructor=this.constructor;if(!jb("STATIC_DB"))throw new D(this.constructor,0);this.Du=fl();if(!this.Du)throw new Ab(this.constructor,"This browser does not support IndexedDB");this.zB="STATIC_DB";this.cf=[];this.Uh=[];this.Vq=A(this.Vq,this)}var gl,hl;m=el.prototype;m.put=function(a,b,c,d){if(!jb(a)&&!ob(a))throw new D(this.put,0);if(!il(b))throw new D(this.put,1);jl(this,function(e){kl(e.put(b,a),c,d)},d)};
m.get=function(a,b,c){var d;if(!jb(a)&&!ob(a))throw new D(this.get,0);if(!ab(b))throw new D(this.get,1);jl(this,function(e){d=e.get(a);kl(d,b,c)},c);return{cancel:function(){d&&(d.onsuccess=Xe)}}};m.remove=function(a,b,c){if(!jb(a)&&!ob(a))throw new D(this.remove,0);jl(this,function(d){kl(d["delete"](a),b,c)},c)};m.clear=function(a,b){jl(this,function(c){kl(c.clear(),a,b)},b)};m.ol="data";m.Hx=500;m.Vq=function(){var a=this.hg.result;a.objectStoreNames.contains(this.ol)||a.createObjectStore(this.ol)};
function ll(a,b,c){if(a.hg)a.cf?(a.cf.push(b),c&&a.Uh.push(c)):a.ln?c&&c(a.ln):b(a.hg.result);else{a.hg=a.Du.open("H_"+a.zB,1);a.hg.onupgradeneeded=a.Vq;var d=a.hg.onerror=function(){clearTimeout(a.Nv);a.ln=this.error;a.Uh.forEach(function(e){e(a.ln)});delete a.cf;delete a.Uh};a.Nv=setTimeout(function(){d.call({error:Error("DbOpenTimeoutError")})},a.Hx);a.hg.onsuccess=function(){clearTimeout(a.Nv);a.cf?(a.cf.forEach(function(e){e(this.result)},this),delete a.cf,delete a.Uh):(delete a.hg,delete a.ln,
a.cf=[],a.Uh=[])};a.cf.push(b);c&&a.Uh.push(c)}}function jl(a,b,c){ll(a,function(d){d=d.transaction([a.ol],"readwrite");b(d.objectStore(a.ol))},c)}function kl(a,b,c){b&&(a.onsuccess=function(){b(this.result)});c&&(a.onerror=function(){c(this.error)})}function il(a){var b=Object.prototype.toString.call(a);return"[object Blob]"===b||"[object ArrayBuffer]"===b||jb(a)||ya(a)}function ml(){gl||(gl=new el);return gl}t("H.util.IndexedDBStorage.getInstance",ml);
function fl(){return x.indexedDB||x.webkitIndexedDB||x.mozIndexedDB||x.msIndexedDB}function nl(){var a="";if(!db(hl))if("file:"===window.location.protocol&&-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&128<=window.location.href.length)hl=!1;else{try{var b=fl();a="H_TEST_DB";var c=b&&b.open(a,1)}catch(d){}hl=!!c&&null===c.onupgradeneeded;c&&b.deleteDatabase&&b.deleteDatabase(a)}return hl}t("H.util.IndexedDBStorage.isSupported",nl);function R(a){eb(this,R);R.g.constructor.call(this,a);this.dD=new ol;this.cc=A(this.cc,this);this.ft=pl;this.createTileInternal=this.ld.bind(this)}u(R,fj);t("H.map.provider.RemoteTileProvider",R);R.prototype.zz=function(){return 1};R.prototype.getEntryWeight=R.prototype.zz;var pl,ql=screen.width,rl=screen.height,sl=Ie();sl=Db(sl,1);var tl=Gb(ql*sl*rl*sl/1E6);pl=new ij(Kb(2,Db(8,Cb(12,7+tl))));var ul={},vl={};R.prototype.Rb=function(){return this.ft};R.prototype.getCache=R.prototype.Rb;
R.prototype.Un=ba(3);R.prototype.cc=function(a){var b=this.uri;return!a.indexOf(b)&&"_"===a.charAt(b.length)};R.prototype.cacheFilter=R.prototype.cc;R.prototype.QA=function(a,b){b.valid=!1};R.prototype.reload=function(a){var b=this.getCache();a?b.ja(this.cc):b.forEach(this.QA,this,this.cc);wl(this);this.kb(this,{isReload:!0})};R.prototype.reload=R.prototype.reload;R.prototype.Ri=function(){return!1};R.prototype.MAX_STORE_TIME=Infinity;R.prototype.qd=function(){return this.dD};
R.prototype.hw=function(a,b){b(a)};function Xj(a,b,c,d,e,f){d=~~d;return a.requestInternal(b,c,d,function(g,h){a.qd().put(a.Sd(b,c,d),{raw:h&&h.raw||g,timestamp:x.Date.now()},e,f)},f,0)}R.prototype.requestInternal=R.prototype.s;
R.prototype.Oa=function(a,b,c,d){var e=this;var f=this.getCache();if(E(a=+a))throw new D(this.Oa,0,a);if(E(b=+b))throw new D(this.Oa,0,b);if(E(c=+c))throw new D(this.Oa,0,c);c=~~c;var g=this.getTileKey(a,b,c);f=f.get(g);f&&f.valid||d||ul[g]||(f=B,this.requestTileAsPromise(a,b,c,d).then(function(h){e.kb(h)},Xe));return f};R.prototype.requestTile=R.prototype.Oa;
R.prototype.zw=function(a,b,c,d){var e=this,f=this.getCache(),g=this.getTileKey(a,b,c),h,k,l=this.qd();if(vl[g])return vl[g];vl[g]=h=new ud(function(n,p){function q(r){var v=0,w;var y=function(I,G){w=e.createTileInternal(a,b,c,I,G);w.key=g;f.add(g,w,1);n(w);xl(g)};r&&(v=x.Date.now()-r.timestamp);r&&v<e.MAX_STORE_TIME?e.hw(r.raw,y):(0<v&&l.remove(g),(w=f.get(g))&&w.valid||d?n(w||null):ul[g]=e.requestInternal(a,b,c,y,p))}k=l.get(g,q,q)});ul[g]||(ul[g]=k);h.then(function(){xl(g)},function(){xl(g)});
return h};R.prototype.requestTileAsPromise=R.prototype.zw;R.prototype.yw=function(a,b){var c=this,d=a.id,e=a.tile.coords;return new ud(function(f,g){c.zw(e.x,e.y,e.z,b).then(function(h){var k=z;h=h.cb?h.cb():h.data;for(var l=h.length,n;l--;)if(n=h[l],n.xb()===d){k=n;break}f(k)},g)})};R.prototype.requestObjectAsPromise=R.prototype.yw;function xl(a){delete ul[a];delete vl[a]}function wl(a){for(var b in ul)a.cc(b)&&a.cancelTileByKey(b)}var yl={cancel:Xe};
R.prototype.ld=function(a,b,c,d){return new qj(a,b,c,d)};R.prototype.createTileInternal=R.prototype.ld;R.prototype.Ti=function(a){var b=ul[a];b&&(b.cancel(),xl(a))};R.prototype.cancelTileByKey=R.prototype.Ti;R.prototype.Kd=function(a,b,c){this.cancelTileByKey(this.getTileKey(a,b,c))};R.prototype.cancelTile=R.prototype.Kd;R.prototype.i=function(){R.g.i.call(this);this.getCache().ja(this.cc);wl(this)};function ol(){}R.NullStorage=ol;ol.prototype.get=function(a,b){b();return yl};ol.prototype.get=ol.prototype.get;
ol.prototype.put=function(a,b,c){c&&c()};ol.prototype.put=ol.prototype.put;ol.prototype.clear=function(a){a&&a()};ol.prototype.clear=ol.prototype.clear;ol.prototype.remove=function(a,b){b&&b()};ol.prototype.remove=ol.prototype.remove;function zl(a){this.yb=a}u(zl,Zd);zl.prototype.Sb=function(){return this.yb};zl.prototype.getLayer=zl.prototype.Sb;zl.prototype.tA=function(){return this.Ob};zl.prototype.getSurface=zl.prototype.tA;zl.prototype.nf=function(a){var b=this.Ob;a!==b&&(this.Ob=a,a.On(),b&&b.release())};zl.prototype.setSurface=zl.prototype.nf;zl.prototype.i=function(){this.Ob.release()};zl.prototype.disposeInternal=zl.prototype.i;zl.prototype.Ah=function(){};zl.prototype.render=zl.prototype.N;function Al(a,b){Al.g.constructor.call(this,a);this.Nd=!(!b||!b.Nd);this.Cq={}}u(Al,zl);Al.prototype.nf=function(a){Al.g.nf.call(this,a);this.dC=a.jd.ownerDocument};Al.prototype.setSurface=Al.prototype.nf;var Bl=function(a,b){b=b.W();return C(b,If)?b.ia:(a[0]=b,a)}.bind(null,[]);
Al.prototype.N=function(a,b,c,d,e,f,g){var h=this.yb,k,l,n,p;this.jC=b=this.Cq;this.Cq=c={};if(d>=h.min&&d<=h.max){var q=this.Tt(a,d,e,f);var r=q.markers;if(a=r.length){d=[];e=this.Ob;for(f=0;f<a;f++){h=r[f];var v=Bl(h);for(k=v.length;k--;)if(l=g(v[k]))(p=b[n=h.xb()+"_"+k])?delete b[n]:p={nv:h},c[n]=p,d.push([p,h,h.kc(),e,l.x,l.y])}d.sort(Cl);a=d.length;for(f=0;f<a;f++)this.ww.apply(this,d[f])}}return!q||q.requested&&q.requested===q.total||!q.requested&&r.length===q.total?Ni.DONE:Ni.PENDING};
Al.prototype.render=Al.prototype.N;function Cl(a,b){var c=a[1].Re(),d=b[1].Re();return Xh(c,d,!0)||a[5]-b[5]||Xh(c,d,!1)}Al.prototype.La=function(){};Al.prototype.getObjectsAt=Al.prototype.La;function Dl(a,b){Dl.g.constructor.apply(this,arguments);this.Bq=0;this.Ph=[];this.np=A(this.np,this)}u(Dl,Al);t("H.map.render.dom.MarkerRenderer",Dl);Dl.prototype.Tt=function(){return this.yb.ke.apply(this.yb,arguments)};Dl.prototype.N=function(a,b,c,d,e,f,g){this.np();this.AB=0;var h=Dl.g.N.apply(this,arguments);var k=this.Ob,l=this.jC,n;for(n in l)El(this,k,l[n]);return 0===this.Ph.length&&h?Ni.DONE:Ni.PENDING};Dl.prototype.render=Dl.prototype.N;
Dl.prototype.nf=function(a){Dl.g.nf.call(this,a);this.oa=a.mb()};Dl.prototype.setSurface=Dl.prototype.nf;Dl.prototype.np=function(){for(var a=this.Ph.length,b,c,d;a--;)d=this.Ph[a],b=d.po,c=b.kc(),c.Jq(d,c,b);this.Ph.length=0};
Dl.prototype.ww=function(a,b,c,d,e,f){var g;var h=d.mb();var k=b.Hc();e*=h;f*=h;this.Nd||(e=Eb(e),f=Eb(f));a.detail&&(k.Gh(a.PA)?El(this,d,a):g=a.detail);g||(a.detail=g=c.au(this.dC),this.Bq++,ab(c.Jq)&&this.Ph.push(g));a.PA=k.Jd;g.style.zIndex=this.AB++;g.po=b;d.Me(g,e,f,0,0)};var Fl,Gl="pointer-events",Hl;if(Pe){var Il;Pe&&Ka!==z&&(Ka=(Il=/(MSIE\s+|rv:)([^\);]+)(\)|;)/.exec(navigator.userAgent))?+Il[2]:z);Hl=Ka;9===Hl?Gl="display":10===Hl&&(Gl="visibility")}Fl=Gl;
Dl.prototype.La=function(a,b,c){var d=this.oa,e=Ye,f,g,h,k,l;if(this.Bq){a/=d;b/=d;d=this.Ob.jd.getRootNode();var n=d.documentElement;var p=this.Ob.F();var q=p.getBoundingClientRect();a+=q.left;for(b+=q.top;(g=h=d.elementFromPoint(a,b))&&g!==p&&g!==n&&g!==d.host&&h!==r;){for(;(k=g.parentNode)&&(!ab(k.contains)||!k.contains(p));)g=k;if(k===p&&(g!==h||"svg"!==g.nodeName)&&0>e.indexOf(l=g.po)&&(e===Ye&&(e=[]),e.push(l),c))break;f||(f=[]);var r=g.style;f.push({st:r.getPropertyValue(Fl),KA:r.getPropertyPriority(Fl),
style:r});r.setProperty(Fl,"visibility"===Fl?"hidden":"none","important");r=h}if(f)for(b=f.length;b--;)a=f[b],a.style.removeProperty(Fl),jb(a.st)&&a.style.setProperty(Fl,a.st,a.KA)}return e};Dl.prototype.getObjectsAt=Dl.prototype.La;Dl.prototype.Ah=function(){return"dom"};function El(a,b,c){b.clear(b=c.detail);delete b.po;a.Bq--;c=(a=c.nv).kc();c.Nq&&c.Nq(b,c,a)}Dl.prototype.i=function(){this.Ph.length=0;var a=this.Ob,b=this.Cq,c;for(c in b)El(this,a,b[c]);this.Ob.u();Dl.g.i.call(this)};
Dl.prototype.disposeInternal=Dl.prototype.i;var Jl={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:85},incline:{min:0,max:0},heading:{min:0,max:360}},interaction:{ZOOM:xk.ZOOM,COORD:xk.COORD},capture:!0};t("H.map.render.webgl.capabilities",Jl);function Kl(a){Kl.g.constructor.call(this,a);a&&(this.wk={crossOrigin:a.crossOrigin||"anonymous",headers:a.headers||{}},this.Qp=a.getURL);if(Ll(this)){var b=a&&a.style&&a.style instanceof H.map.render.harp.Style?a.style:new H.map.render.harp.Style({styles:[{technique:"raster",attr:{gamma:1,brightness:1}}]});this.Ya(b)}if(!ab(this.Qp))throw new D(Kl,0,"getURL");this.zg(a.opacity);this.pl=x.URL||x.webkitURL;a=this.wk.crossOrigin;if(!(a="anonymous"===a||"use-credentials"===a)){a=this.Qp(0,0,0);b=window.location;
var c=document.createElement("a");c.href=a;a=c.hostname===b.hostname&&c.port===b.port&&c.protocol===b.protocol}(this.Ww=a&&!!Ug.arraybuffer&&!!this.pl)&&this.Rb().ci(A(this.fe,this))}u(Kl,R);t("H.map.provider.ImageTileProvider",Kl);function Ll(a){return!!H.map.render.harp&&a.vb===ph.HARP}Kl.prototype.Cd=function(a){this.zg(a)};Kl.prototype.setOpacity=Kl.prototype.Cd;Kl.prototype.Qe=function(){return this.Oc};Kl.prototype.getOpacity=Kl.prototype.Qe;Kl.prototype.nk=Ve;
Kl.prototype.providesRasters=Kl.prototype.nk;Kl.prototype.s=function(a,b,c,d,e,f){var g=this,h=this.Qp(a,b,c),k;a=yl;if(h){var l=x.setTimeout(function(){g.Ww?(k=new Tg("arraybuffer",h,f,g.wk),k.then(function(n){return n.blob()}).then(function(n){var p=new Image;p.onload=A(d,null,p,{raw:n});p.onerror=A(e,null,"bad url");try{p.src=g.pl.createObjectURL(n)}catch(q){}},e)):(k=new Tg("image",h,f,g.wk),k.then(d,e))},150);a={cancel:function(){k?k.cancel():x.clearTimeout(l)}}}else d(null);return a};
Kl.prototype.requestInternal=Kl.prototype.s;Kl.prototype.hw=function(a,b){var c=new Image;c.onload=function(){b(this)};c.src=this.pl.createObjectURL(a)};Kl.prototype.fe=function(a,b){(a=b.data)&&a instanceof HTMLImageElement&&this.pl.revokeObjectURL(a.src)};Kl.prototype.L=function(){return this.nb()};Kl.prototype.getStyle=Kl.prototype.L;Kl.prototype.Bb=function(a){Ll(this)&&a instanceof H.map.render.harp.Style&&this.Ya(a)};Kl.prototype.setStyle=Kl.prototype.Bb;function Ml(a){var b,c=this,d=x.H.gl;Ml.g.constructor.call(this);this.m=b=d.Scene.create(x.URL.createObjectURL(ef(JSON.stringify(Nl))),{viewport:a.viewport,container:a.jd,disableRenderLoop:!0,devicePixelRatio:a.devicePixelRatio,logLevel:"error"});a.QB&&b.subscribe({load:a.QB});b.subscribe({view_complete:function(){c.Er=!0;a.Iv()}});var e=b.requestRedraw;b.requestRedraw=function(){e.apply(b);a.Iv()};this.Fr=A(this.Fr,this);this.Gn=A(this.Gn,this);this.ns=0;this.Oh={};this.Ed={}}u(Ml,Zd);m=Ml.prototype;
m.Er=!1;function Ol(a){a=a.m.sources;var b;for(b in a){var c=a[b];if(c.hasPendingCommands&&c.hasPendingCommands())return!0}return x.H.gl.Task.hasPendingTasks()}m.N=function(){var a=x.H.gl.Task;this.m.immediateRedraw();a.setState({user_moving_view:this.m.view.user_input_active});a.processAll();return this.Er&&!this.m.dirty&&!this.m.building&&!Ol(this)&&!Object.keys(this.Ed).length};function Pl(a){a.Er=!1;a.m.resetViewComplete()}function Ql(a){return a.m.view}
function Rl(a,b){function c(){var e=b.Ta(),f={},g={},h,k,l,n=++a.ns,p,q;pg(g,Nl);for(k=0;k<e.length;k++){var r=e[k];if(h=r.D){var v=h.nb();if(v.getState()===lg.READY){var w=v.Pd();if(!Qa(w)){delete w.cameras;delete w.camera;f[k]=w=Bg(w,k);!C(r,Pj)&&w.sources&&Cg(w,h.uid);for(l in w.sources){var y=w.sources[l];y.max_zoom=Cb(h.max,Jl.lookAt.zoom.max);y.max_display_zoom=r.max;y.min_display_zoom=r.min;if(q=h.tileSize)2<=d&&256<q&&h instanceof Kl&&(q/=2),y.tile_size=q}(p=v.Fc())&&Dg(w,p);pg(g,w)}}}}pg(g.layers.skybox.draw.skybox.color,
g.scene.sky);a.m.config=g;return a.m.updateConfig().then(function(){var I={},G,S;if(n!==a.ns)return!1;a.ns=0;for(S in f){r=e[+S];var X=f[S].sources;for(G in X)if(X=a.m.sources[G])I[G]=X,X.initialize&&r.getProvider()&&X.initialize(r.getProvider(),a.Fr,a.m.getWorkers().length,X.tiled?B:a.m.tile_manager.getWorkerForTile(z,X))}for(G in a.Oh)!I[G]&&a.Oh[G].dispose&&a.Oh[G].dispose();a.Oh=I;return!0})}var d=a.m.pixelRatio();a.m.initialized?c():a.m.load(z,{blocking:!1}).then(c)}
m.Fr=function(a,b,c){var d=this,e=this.m.sources[a],f=c&&c.isReload;b?!0!==this.Ed[a]&&(this.Ed[a]||(this.Ed[a]={jx:{},et:[]}),C(b,qj)?this.Ed[a].jx[b.x+"/"+b.y+"/"+b.z]=!0:(b=b.boundingBox,this.Ed[a].et.push(new F(b[0],b[1],b[2],b[3])))):this.Ed[a]=!0;e&&e.has_volatile_data?Sl(this,f):(x.clearTimeout(this.tw),this.tw=x.setTimeout(function(){return Sl(d,f)},100))};
m.Gn=function(a){var b=!1,c=this.Ed[a.source.name],d=x.H.gl;if(c)if(!0===c)b=!0;else{var e=d.Tile.coord(d.Geo.wrapTile(a.coords));b=!!c.jx[e.key];if(!b){var f=d.Geo.getTileBoundingBox(e,a.source.tile_size,di.MAX_LINE_WIDTH/2);f=Ic(f.getTopLeft(),f.getBottomRight());b=c.et.some(function(g){return g.Pf(f,!0)||f.zf(g.wb(),!0)})}}return b};function Sl(a,b){var c=a.m.tile_manager;c.removeTiles(a.Gn);c.updateTilesForView();b&&c.removeCachedTiles(a.Gn);Pl(a);a.Ed={}}m.Pd=function(){return this.m.config};
function Tl(a,b,c,d){a.m.getFeatureAt(b,c,d);a.m.update()}function Ul(a){return a.m.screenshot(void 0).then(function(b){return new ud(function(c,d){new Kh(URL.createObjectURL(b.blob),function(e,f){1===e?c(f.getData()):d()},!1)})})}m.mb=function(){return this.m.pixelRatio()};m.i=function(){var a=this.Oh;Ml.g.i.call(this);this.m.destroy();this.Ed={};a&&Object.keys(a).forEach(function(b){a[b].dispose()});x.clearTimeout(this.tw);delete this.Oh;delete this.m};Ml.prototype.disposeInternal=Ml.prototype.i;
var Nl={scene:{background:{color:"#FFFFFF"},sky:{zenith:"#347BC0",horizon:"#EDF2F9",fog:"#FFFFFF"}},lights:{default_light:{type:"directional",name:"default_light",visible:!0}},camera:{type:"perspective"},styles:{},fonts:{},sources:{skybox:{type:"SkyBox"}},layers:{skybox:{data:{source:"skybox"},draw:{skybox:{color:{}}}}},global:{}};function Vl(a,b){if(E(this.so=+a))throw new D(Vl,0,a);this.$n=this.mj=0;b&&this.Mw(b)}t("H.util.kinetics.KineticMove",Vl);Vl.prototype.Mw=function(a){this.$n=a;this.mj=this.cu();return this};Vl.prototype.setInitialSpeed=Vl.prototype.Mw;Vl.prototype.cu=function(){return Math.abs(this.$n/this.so)};Vl.prototype.getDuration=Vl.prototype.cu;Vl.prototype.Aj=function(a){return this.$n+this.so*a};Vl.prototype.getCurrentSpeed=Vl.prototype.Aj;Vl.prototype.qz=function(a){return this.$n*a+this.so*a*a/2};
Vl.prototype.getCurrentPath=Vl.prototype.qz;function Wl(a){return a}t("H.util.animation.ease.LINEAR",Wl);t("H.util.animation.ease.EASE_IN_QUAD",function(a){return a*a});function Xl(a){return-a*(a-2)}t("H.util.animation.ease.EASE_OUT_QUAD",Xl);t("H.util.animation.ease.EASE_IN_OUT_QUINT",function(a){a*=2;return 1>a?Kb(a,5)/2:(a-=2,Kb(a,5)/2+1)});function Yl(a){return 1-Math.sqrt(1-a*a)}function Zl(a){return Jb(2*a-a*a)}t("H.util.animation.ease.EASE_OUT_CIRC",Zl);function $l(a){return 1-Math.cos(a*Math.PI/2)}
function am(a){return Math.sin(a*Math.PI/2)};function bm(a,b){this.Wf={tilt:cm(a.tilt,b.tilt),heading:cm(a.heading,b.heading),zoom:b.zoom-a.zoom};var c=this.Xo=sc(a.position),d=b.position;a=d.lat*Yb;var e=c.lat*Yb;c=d.lng*Yb-c.lng*Yb;a=Math.atan2(Mb(c)*Ob(a),Ob(e)*Mb(a)-Mb(e)*Ob(a)*Ob(c));this.gy=(0<=a?a:Wb+a)*Zb;this.gh=this.Xo.lb(b.position);b=this.Wf.zoom;this.xv=0===b?dm:Object.assign({},dm,{zoom:0>b?Zl:Yl,position:0>b?$l:am});this.$u=Object.assign({},{tilt:0,heading:0,zoom:0})}
function cm(a,b){a=b-a;return-180<a&&180>=a?a:180<a?a-360:a+360}var dm={tilt:Wl,heading:Wl,zoom:Wl,position:Wl};function em(a,b){if(E(this.x=+a))throw new D(em,0,a);if(E(this.y=+b))throw new D(em,1,b);}m=em.prototype;m.add=function(a){return new em(this.x+a.x,this.y+a.y)};m.Ht=function(a){if(!C(a,em))throw new D(this.Ht,0,a);a=this.multiply(a);return a.x+a.y};m.multiply=function(a){if(!C(a,em))throw new D(this.multiply,0,a);return new em(this.x*a.x,this.y*a.y)};m.Wa=function(a){return new em(this.x*a,this.y*a)};function fm(a){return Jb(a.Ht(a))}
m.normalize=function(){var a=fm(this);return 0!==a?new em(this.x/a,this.y/a):this};function gm(a){a=a||Ze;this.vB=db(a.uB)?a.uB:3;this.qv=db(a.pB)?a.pB:300;this.wx=db(a.wD)?a.wD:3;this.lD=db(a.kD)?a.kD:50;this.bi=[];this.clear()}t("H.map.render.InteractionUtils",gm);gm.prototype.TA=function(){return this.Fh};gm.prototype.isGestureDetected=gm.prototype.TA;gm.prototype.start=function(a,b){var c=xk.HEADING,d=xk.TILT;this.S&&this.clear();this.Zj=a;this.Cm=!!b;this.S=!0;this.Fh=!(a&(c|d))||a===c||a===d};gm.prototype.start=gm.prototype.start;
gm.prototype.store=function(a,b,c,d,e){var f=!1;if(this.S){a=new hm(a,b,c,d,e);f=a.Lu;this.Rn=this.We;this.We=a;if(this.tj){if(this.rm=!0,f){b=this.Zj;var g=this.Fh;if(!g&&this.rm){e=xk.HEADING;var h=xk.TILT;c=xk.COORD;d=xk.ZOOM;var k=b&(c|h)?this.vh(!0):im;var l=b&d?this.bm(!0):1;var n=b&e?Hb(this.wp(!0)):0;var p=Hb(k.x);var q=Hb(k.y);k=10<p||10<q;p=10<q&&q>3*p;l=.8>l||1.2<l;n=7<n;b&h&&(n||l||k&&!p?jm(this,h):p&&(jm(this,~h>>>0),g=!0));!g&&b&e&&b&(c|d)&&(l||k?(jm(this,e),g=!0):n&&(jm(this,h),g=!0));
this.Fh=g}}}else this.tj=a,f||(this.Fh=!0);this.Cm&&this.bi.push(a)}return f};gm.prototype.store=gm.prototype.store;gm.prototype.clear=function(){this.bi.length=0;this.S=this.Cm=this.rm=this.Fh=!1;this.tj=this.Rn=this.We=void 0};gm.prototype.clear=gm.prototype.clear;gm.prototype.Yd=function(a){return 0<(this.Zj&a)};gm.prototype.isModifierEnabled=gm.prototype.Yd;function jm(a,b){a.Zj^=a.Zj&b}gm.prototype.Em=function(){return this.S};gm.prototype.isRunning=gm.prototype.Em;var im=Ya(new em(0,0));
gm.prototype.Gf=function(){var a;if(this.Cm){var b=this.bi;var c=b.length;var d=0;for(a=new em(0,0);--c&&d<this.wx;)a=a.add(km(b[c-1],b[c])),d++}else a=this.vh();return a.normalize()};gm.prototype.getDirection=gm.prototype.Gf;gm.prototype.mc=function(a){a=a||Gj();var b,c;if(this.Cm){var d=this.bi;var e=this.bi.length;var f=this.bi[e-1];for(c=b=0;--e&&b<this.wx;)c+=fm(km(d[e],d[e-1])),b++;d=c/b}else f=this.We,d=fm(this.vh());return d=d>=this.vB&&a-f.timestamp<=this.lD?d>this.qv?this.qv:d:0};
gm.prototype.getSpeed=gm.prototype.mc;gm.prototype.am=function(){return this.We?lm(this.We):B};gm.prototype.getBifocalCenter=gm.prototype.am;gm.prototype.vh=function(a){return(a=a?this.tj:this.Rn)?km(a,this.We):new em(0,0)};gm.prototype.getMoveVector=gm.prototype.vh;gm.prototype.bm=function(a){var b=1;if(this.rm){var c=this.We;a=a?this.tj:this.Rn;if(a=mm(a))if(c=mm(c))b=c/a}return b};gm.prototype.getBifocalScaling=gm.prototype.bm;
gm.prototype.wp=function(a){if(this.rm){var b=a?this.tj:this.Rn,c=this.We;a=b.kg;var d=c.kg,e=0;a&&d&&(b=b.ge,c=c.ge,e-=Rb(d.y-c.y,d.x-c.x)*Zb-Rb(a.y-b.y,a.x-b.x)*Zb);a=e}else a=0;return a};gm.prototype.getBifocalRotation=gm.prototype.wp;function hm(a,b,c,d,e){this.ge=new L(a,b);c!==B&&(this.kg=new L(c,d),this.Lu=!0);this.timestamp=e!==B?e:Gj()}hm.prototype.Lu=!1;function lm(a){var b=a.ge;return(a=a.kg)?new L(b.x-(b.x-a.x)/2,b.y-(b.y-a.y)/2):B}
function nm(a,b){var c=a.ge;return(a=a.kg)&&a.lb(b)<c.lb(b)?a:c}function km(a,b){var c=a.kg,d=b.kg;d&&c?(b=lm(b),a=lm(a)):c?(b=b.ge,a=nm(a,b)):d?(a=a.ge,b=nm(b,a)):(b=b.ge,a=a.ge);return new em(b.x-a.x,b.y-a.y)}function mm(a){var b=a.kg;return b?a.ge.lb(b):0};function om(){J.call(this);this.reset()}u(om,J);om.prototype.start=function(a,b){this.S&&this.reset();E(a-b)||(this.Pg=+a,this.Qg=+b);this.S=!0};om.prototype.reset=function(){this.S=!1;this.Pg=this.Qg=B;this.Mo=new pm(0,0,0,0,0,0)};om.prototype.Em=function(){return this.S};om.prototype.l={ro:"animationupdate"};function qm(a){qm.g.constructor.call(this,om.prototype.l.ro);this.it=a}u(qm,ie);
om.prototype.set=function(a,b,c,d,e,f){var g=this.Mo;this.S&&(a=new pm(a/1E3,b/1E3,c/1E3,d/1E3,e/1E3,f/1E3),g.ea(a)||(this.Mo=a,this.dispatchEvent(new qm(rm(this)))))};function rm(a){return x.Object.create(a.Mo)}om.prototype.mc=function(){return rm(this).mc()};om.prototype.Gf=function(){var a=rm(this),b=this.mc()||1;return new pm(a.Jb/b,a.Kb/b,a.Lb/b,a.ii,a.ji,a.zk)};om.prototype.i=function(){this.reset();om.g.i.call(this)};
function pm(a,b,c,d,e,f){this.Jb=a;this.Kb=b;this.Lb=c;this.ii=d;this.ji=e;this.zk=f}pm.prototype.mc=function(){return Jb(this.Jb*this.Jb+this.Kb*this.Kb+this.Lb*this.Lb)};pm.prototype.Gf=function(){var a=this.mc()||1;return new pm(this.Jb/a,this.Kb/a,this.Lb/a,this.ii,this.ji,this.zk)};pm.prototype.ea=function(a){var b=a===this;!b&&(b=C(a,pm))&&(b=this.Jb===a.Jb&&this.Kb===a.Kb&&this.Lb===a.Lb&&this.ii===a.ii&&this.ji===a.ji&&this.zk===a.zk);return b};function sm(a,b,c,d,e,f){var g=e||"2d";sm.g.constructor.apply(this,arguments);this.Rl=this.element.getContext(g,f);this.wu="2d"===g;this.dj=g;this.cj=f}u(sm,Mi);m=sm.prototype;m.createElement=function(a){a=a.createElement("canvas");var b=a.style;b.position="absolute";b.top=b.left="0";return a};m.Qw=function(a,b,c,d,e){a.width=Db(c,1);a.height=Db(d,1);b.width=Eb(c/e)+"px";b.height=Eb(d/e)+"px"};m.zg=function(a){this.Rl.globalAlpha=a};m.Me=function(a,b,c,d,e){this.wu&&this.Rl.drawImage(a,b,c,d,e)};
m.getContextAttributes=function(){return this.cj};m.ph=function(){return this.dj};m.clear=function(a){var b,c;this.wu&&(a?this.Rl.clearRect(b=a.left,c=a.top,a.right-b,a.bottom-c):this.element.width=this.size.w)};m.i=function(){var a=this.element;a.width=a.height=0;delete this.Rl;sm.g.i.call(this)};sm.prototype.disposeInternal=sm.prototype.i;function tm(a){var b="dom";tm.g.constructor.call(this,a);C(this.yb,Oi)&&(b="2d"===a.ph()?"2d":"webgl");this.gD=b}u(tm,zl);tm.prototype.N=function(a,b,c,d,e,f,g,h){g=this.yb;var k=this.Ob,l=!(C(k,sm)&&"2d"===k.ph());if(d>=g.min&&d<=g.max)return l&&k.Zb(!0),g.N(k.F(),{boundingBox:a,zoom:d,screenCenter:b,priorityCenter:f,projection:c,cacheOnly:e,size:k.lc(),pixelRatio:k.mb(),cameraMatrix:h});l&&k.Zb(!1);return Ni.DONE};tm.prototype.Ah=function(){return this.gD};function um(a){var b=vm[a];if(!b)if(a in wm)b=vm[a]=a;else{b=xm.length;var c="",d=a.substr(0,1).toUpperCase()+a.substr(1),e="",f=!1;ym&&(e=ym+d,f=e in wm);for(;b--&&!f;)c=xm[b],e=c+d,f=e in wm;f&&(ym=c);if(b=f?e:null)vm[a]=b;else throw Error("Could not find any variant of CSS property ["+a+"]");}return b}t("H.dom.cssPrefixer.prefix",um);var xm=["O","Ms","ms","Moz","Webkit"],vm={},ym="",wm=document.createElement("span").style;function zm(a,b,c,d){zm.g.constructor.apply(this,arguments)}u(zm,Mi);t("H.map.render.dom.Surface",zm);m=zm.prototype;m.ph=function(){return"dom"};m.createElement=function(a){a=a.createElement("DIV");a.style.position="absolute";a.style.pointerEvents="none";return a};m.Qw=function(a,b,c,d){b.width=c+"px";b.height=d+"px"};m.zg=function(a){this.element.style.opacity=a};
m.Me=function(a,b,c){var d=this.ka,e=a.style;e[um("transform")]="matrix(1,0,0,1,"+b/d+","+c/d+")";a.parentNode!==this.element&&(e.position="absolute",this.element.appendChild(a),this.element.style.pointerEvents="auto","auto"===getComputedStyle(a).pointerEvents&&(a.style.pointerEvents="all"),this.element.style.pointerEvents="none")};m.clear=function(a){a?this.element.removeChild(a):this.element.innerHTML=""};function Am(a,b){this.sy=a;this.oa=b}
function Bm(a,b,c){var d=[],e={jd:a.sy,width:b.w,height:b.h,ka:a.oa};for(a=0;a<c.length;a++){b=c[a];var f=b.Ah();var g={};Ta(g,e);var h=b.Ob;switch(f){case "2d":C(b.Sb(),Oi)&&(g.Ro=b.Sb().getContextAttributes());if(f=n&&"2d"===n.ph()){f=g.Ro;var k=n.cj;f=k===f?!0:k&&!f?!k.alpha&&!k.willReadFrequently:f&&!k?!f.alpha&&!f.willReadFrequently:!f.alpha===!f.alpha&&!k.willReadFrequently===!f.willReadFrequently}if(f)var l=!1;else if(h&&!l){var n=h;l=!1}else n=new sm(g.jd,g.width,g.height,g.ka,"2d",g.Ro),
l=!0;break;case "dom":n=h||new zm(g.jd,g.width,g.height,g.ka);l=!h;break;default:n=h||new sm(g.jd,g.width,g.height,g.ka,b.Sb().ph(),g.Ro),l=!h}d[d.length-1]!==n&&(n.pi(d.length),d.push(n));b.nf(n)}return d};function Cm(a,b,c,d,e){if(!ab(a.Hr)||!ab(a.yr))throw new D(Cm,0,a);this.Ys=a;if(!ab(this.sD=b))throw new D(Cm,1,b);if(E(this.mj=+c))throw new D(Cm,2,c);if(!ab(this.Av=d)&&null!=d)throw new D(Cm,3,d);if(!ab(this.It=e)&&null!=e)throw new D(Cm,4,e);this.id=(new Se).next();this.S=!1}t("H.util.animation.Animation",Cm);
Cm.prototype.start=function(){var a=this;this.Qk=Gj();this.S=!0;var b=this.Qk;this.Ys.Hr(function(){if(a.S){var c=Gj(),d=c-a.Qk,e=d/a.mj,f=!1;1<=e&&(e=1,f=!0);a.sD(a.It?a.It(e):e,d,c-b,c);b=c;f&&a.stop()}else a.stop()})};Cm.prototype.start=Cm.prototype.start;Cm.prototype.stop=function(a){this.S=!1;this.Ys.yr();a||this.Av&&this.Av(this)};Cm.prototype.stop=Cm.prototype.stop;Cm.prototype.Em=function(){return this.S};Cm.prototype.isRunning=Cm.prototype.Em;function T(a,b,c,d){var e;T.g.constructor.call(this,a,b,c,d);this.lp=new ij(this.Px);this.Xb=new L(0,0);if(e=d.renderBaseBackground)this.vw=e.lower,this.uw=e.higher;this.oj=!!d.enableSubpixelRendering;this.Fg=Dm;this.na=new gm;this.U=d=new om;this.ag=A(this.ag,this);d.addEventListener(d.l.ro,this.ag);d=a.element;this.pc=a=d.ownerDocument.createElement("div");a.style.position="absolute";a.style.width=a.style.height="100%";a.style.zIndex=0;d.insertBefore(a,d.firstChild);this.Tk=new Am(this.pc,this.ka);
this.Nm=b.Ib().position;b=x.H.gl;if(!b)throw new Ab(T,'"H-webgl" module is missing');this.m=new Ml({viewport:this.za,jd:this.pc,devicePixelRatio:this.ka,Iv:A(this.ca,this)});b.WorkerBroker.addTarget("model",dk);this.aq();this.Oq=A(this.Oq,this);this.qg=A(this.qg,this);this.Ka=A(this.Ka,this);c.addEventListener(yh.prototype.l.Hi,this.Oq);this.o=Em;this.zoom=zk(this,this.ze.Tb());this.wc();this.gg()}u(T,uk);t("H.map.render.webgl.RenderEngine",T);T.prototype.Px=100;
T.prototype.Ib=function(){var a=this.Nm;return Ak(this,{position:{cB:a.cB,jB:a.jB},zoom:this.zoom,tilt:this.lx,heading:this.heading})};T.prototype.Oq=function(a){a=(a=a.target.D)&&a.nb();(a&&a.getState())===lg.INIT?a.load():(Pl(this.m),Rl(this.m,this.jb),this.ca())};T.prototype.type=Dk.WEBGL;var Em=2;T.prototype.getState=function(){return this.o};T.prototype.getState=T.prototype.getState;T.prototype.xj=function(a,b){a=b-a;var c=Kb(2,8+this.zoom);return a<c/2?a:a-c*b/Hb(b)};
function Fm(a,b,c){function d(h){return e[h]+cm(e[h],b[h])/2}if(!(c&Zj.POSITION||c&Zj.BOUNDS))return null;var e=Ql(a.m).getLookAtData();c=e.position;var f=b.position,g=b.bounds;if(Ef(e.bounds,f.lat,f.lng,!1)||g&&Ef(g,c.lat,c.lng,!1))return null;c=Gm(a,{tilt:d("tilt"),heading:d("heading"),incline:0,bounds:Jc([c,f])});c.zoom=zk(a,c.zoom-.5);delete c.bounds;return c}T.prototype.hr=!1;function Hm(a,b,c,d){a=a.getCapabilities().lookAt[d];return Hb("zoom"===d?c[d]-b[d]:cm(b[d],c[d]))/(a.max-a.min)||0}
function Im(a,b,c){a=Db(8*Hm(a,b,c,"zoom"),Hm(a,b,c,"heading"),Hm(a,b,c,"tilt")/2);return ec(3E3*a,300,4E3)}
T.prototype.Wq=function(a){var b=this,c=a.newValue,d=a.modifiers,e=Ql(this.m);this.Eg();this.Xb.set(0,0);var f=this.yo(c);qk.forEach(function(n){d&a[n.toUpperCase()]||delete f[n]});if(a.animate){e=Ql(this.m).getLookAtData();var g=Gm(this,f);c=Fm(this,g,d);var h=1;ob(a.animate)&&(h=1/a.animate);var k=function(){return b.hr=!1};delete g.bounds;this.hr=!0;if(c){e=Im(this,e,c);var l=Im(this,c,g);Jm(this,c,e*h,function(){return Jm(b,g,l*h,k)})}else c=Im(this,e,g),Jm(this,g,c*h,k)}else Km(f),e.setLookAtData(f);
Lm(this);Pl(this.m);this.ca()};function Gm(a,b){Km(b);return Ql(a.m).getBestLookAtData(b)}function Km(a){var b=a.bounds;!b||b instanceof M||(a.bounds=Bf(b.C()))}function Mm(a,b,c){Ql(a.m).setLookAtData(b);Pl(a.m);Lm(a);a.ca();c&&setTimeout(c,0)}
function Jm(a,b,c,d){var e=Ql(a.m).getLookAtData(),f=new bm(e,b);0!==f.Wf.tilt+f.Wf.heading+f.Wf.zoom+f.gh?a.Zc(function(g){for(var h in f.Wf)if(0!==f.Wf[h]){var k=f.xv[h](g);e[h]+=f.Wf[h]*(k-f.$u[h]);f.$u[h]=k}0!==f.gh&&(e.position=f.Xo.ho(f.gy,f.gh*f.xv.position(g),!0));return Mm(a,e)},c,function(){return Mm(a,b,d)}):Mm(a,b,d)}T.prototype.Sn=function(){};T.prototype.setAnimationDuration=T.prototype.Sn;T.prototype.up=function(){};T.prototype.getAnimationDuration=T.prototype.up;T.prototype.Tn=function(){};
T.prototype.setAnimationEase=T.prototype.Tn;T.prototype.vp=function(){};T.prototype.getAnimationEase=T.prototype.vp;T.prototype.Mn=function(){};T.prototype.resetAnimationDefaults=T.prototype.Mn;function Nm(a,b){a.lp.ja(function(c,d){return d.Jc()===b})}m=T.prototype;m.Gv=function(a){Nm(this,a.target.D);Pl(this.m);this.ca()};m.dk=function(a,b){T.g.dk.call(this,a,b);Om(b)&&(Pl(this.m),(a=(a=b.D)&&a.nb())&&a.getState()===lg.INIT&&a.load())};
m.Pq=function(a,b,c){var d;this.Rj=Gj();Nm(this,b.D);if(b.requestDomMarkers||C(b,Oi)||C(b,Qi)){var e=this.me.la;for(d=e.length;d--;){var f=e[d];if(f.Sb()===b){e.splice(d,1);f.u();break}}}Om(b)&&Rl(this.m,this.jb);this.Xe=this.jb.Ta();0===a&&(yk(this,b,!1),this.wc());Bm(this.Tk,this.Mf(),this.Jf());this.hi();c||this.ca()};function Om(a){return!(C(a,Qi)||C(a,Oi))}m.aq=function(){var a=this.jb.Ta(),b=0,c=a.length;this.me={Le:[],la:[]};for(this.Xe=a;b<c;b++){var d=a[b];this.dk(b,d);yk(this,d,!0)}this.wc()};
m.Qq=function(){this.wc()};m.wc=function(){T.g.wc.call(this);var a=this.getCapabilities().lookAt.zoom;Ql(this.m).setZoomConstraints(Db(a.min,this.uq),Cb(a.max,this.tq))};m.bq=function(a,b){var c;if(b){a={Nd:this.oj,Ab:this.Ab};b.N?C(b,Oi)?c=new tm(b):C(b,Qi)&&(c=new tm(b)):b.requestDomMarkers&&(c=new Dl(b,a));if(c){this.me.la.push(c);var d=this.jb.Ta();this.me.la.sort(function(e,f){return d.indexOf(e.yb)-d.indexOf(f.yb)});Bm(this.Tk,this.Mf(),this.Jf())}Om(b)&&Rl(this.m,this.jb)}this.Xe=this.jb.Ta()};
m.Jf=function(){return this.me.la.filter(db)};m.Ko=function(){return this.o===Em};m.yo=function(a){var b=a.position;return Ak(this,{zoom:zk(this,a.zoom),position:new pc(b.lat,b.lng),tilt:a.tilt,heading:a.heading,bounds:a.bounds})};function Lm(a){var b=Ql(a.m).getLookAtData();a.zoom=b.zoom;a.Nm=b.position}m.Bs=4.007501668557849E7;function Pm(a,b){b=Ql(a.m).geoToMeters(b);return new L(b.x/a.Bs+.5,1-(b.y/a.Bs+.5))}function Qm(a,b){return b.sub(Pm(a,a.Nm)).scale(Kb(2,8+a.zoom))}m.Ka=function(a){return Ql(this.m).geoToPixel(a)};
T.prototype.geoToScreen=T.prototype.Ka;T.prototype.Xa=function(a,b){return Ql(this.m).xyToGeo(a,b)};T.prototype.screenToGeo=T.prototype.Xa;T.prototype.Qn=function(a,b){a=this.Xa(a,b);b=this.ze.Ib();b.position=a;return b};
function Rm(a,b,c,d,e,f,g,h){var k,l,n=0,p;var q=function(){0===--n&&f(e)};if(h&&h.features)for(n=l=h.features.length,p=0;p<l;p++){var r=h.features[p];var v=r.id;if(k=a.m.m.sources[r.source_name]){var w=k.provider;var y=w.mu();if(y===og.SOURCE){var I=r.source_layer;if("overlays"===I)Sm(a,b,c,d,e,k,r.properties.overlays_config);else if(k=k.getMapObjectById(v))if("markers"!==I)e.push(k);else if(Tm(a,b,c,k))e.push(k);else if(d&&!g){var G=!0;Tl(a.m,{x:b,y:c},{radius:3.5,top_most_only:!1},function(S){Rm(a,
b,c,d,e,f,!0,S)})}n--}else y===og.FEATURE?(I=r.tile.coords,G=w.getFeatureProxy(r.properties,I,function(S){S&&(S.Pw(w),e.push(S));q()}),G||(k=a.lp.get(v),k||(k=new Uh(r),k.fa(w),a.lp.add(v,k,1)),e.push(k),n--)):y===og.PROVIDER&&(G=!0,w.yw(r,!1).then(function(S){S&&(S instanceof ai?Tm(this,b,c,S):1)&&e.push(S);q()},function(){q()},a))}}y&&(G||0!==n)||f(e)}
function Sm(a,b,c,d,e,f,g){var h;a=a.Xa(b,c);for(b=g.length;b--&&(!(h=f.getMapObjectById(g[b].id))||0<=e.indexOf(h)||!h.W().zf(a)||(e.push(h),!d)););}function Tm(a,b,c,d){var e=d.kc(),f=e.tm,g,h=!f;if(f)if(e=e.Cb,b+=e.x,c+=e.y,e=d.W(),C(e,Lf))for(d=e.ia,g=d.length;g--&&!h;)e=a.Ka(d[g]),h=f.um(b-e.x,c-e.y,0)!==gc.NONE;else e=a.Ka(e),h=f.um(b-e.x,c-e.y,0)!==gc.NONE;return h}
T.prototype.La=function(a,b,c,d){var e=this,f=[];f=this.Ip(f,this.me.la,a*this.ka,b*this.ka,c);c&&f.length?d(f):this.m.m.initialized?Tl(this.m,{x:a,y:b},{radius:3.5,top_most_only:c},function(g){Rm(e,a,b,c,f,d,!1,g)}):d(f)};T.prototype.getObjectsAt=T.prototype.La;m=T.prototype;m.Ip=function(a,b,c,d,e){for(var f=b.length,g;f--&&!((g=b[f])&&g.La&&(a=a.concat(g.La(c,d,e)),a.length&&e)););return a};m.te=z;m.Mf=function(){var a=this.hl[2];return{w:a.right-a.left,h:a.bottom-a.top}};
m.gg=function(){var a=this.me.la.length;vk(this,this.ka);this.Xb.set(0,0);var b=this.Mf();var c=b.w;var d=b.h;for(this.m.m.handleViewportUpdate();a--;){b=this.me.la[a].Ob;var e=b.lc();e.w===c&&e.h===d||b.Kk(c,d)}this.te=new Jh(c,d);Pl(this.m);this.ca()};m.getCapabilities=function(){return Jl};T.prototype.getCapabilities=T.prototype.getCapabilities;m=T.prototype;
m.Bk=function(){this.ta&&this.ta.S||(Ol(this.m)||Gj()-this.Rj<this.Fg)&&!this.je?this.mh||(this.mh=Ej(this.qg)):(this.je&&(this.hi(),this.kj()),this.o=Em)};m.mh=0;m.hi=function(){this.me.Le.length=0};
m.qg=function(){this.mh=0;this.af&&this.af.before();var a=Ql(this.m);var b=a.getLookAtData(!1);var c=a.getLookAtData(!0);a=this.za.center.clone();c=c.bounds.C();var d=this.zoom;var e=this.Xb;var f=this.Xe;var g=f.length;for(this.Fg=Dm;g--;){var h=f[g];C(h,yh)&&h.D&&h.D.lk(c,d)}this.je=this.m.N();this.ze.sb(b);this.je=this.Hn(c,a,d,!1,e,this.me)&&this.je;this.te&&(this.za.sb(this.te),this.te=z);this.ta&&this.ta.S&&this.Ao();this.af&&this.af.after();this.Bk()};
m.Hn=function(a,b,c,d,e,f){var g=f.la.length,h=!0,k;for(k=0;k<g;k++){var l=f.la[k];var n=f.Le;if(l){var p=l.N(a,b,void 0,c,d,e,this.Ka,this.m.m.getCameraMatrix());p===Ni.ACTIVE&&(this.Fg=Infinity);p!==Ni.DONE||n[k]||(this.kj(l.Sb()),n[k]=!0);n[k]||(h=!1)}}return h};m.kj=function(a){this.hr||setTimeout(A(this.dispatchEvent,this,{type:this.l.Qs,target:a||this}),1)};
m.i=function(){var a=this.jb.Ta()[0],b=this.za;Fj(this.mh);this.$c(!0);a&&yk(this,a,!1);this.Jf().forEach(function(c){c.u()});b.element&&b.element.removeChild(this.pc);delete this.pc;this.o=3;this.m.u();T.g.i.call(this)};m.ca=function(){this.Rj=Gj();this.Ko()&&(this.je=!1,this.o=1,this.Bk())};m.xc=function(a,b){this.Ng(a,b);this.Xb.set(0,0);Pl(this.m);this.ca()};m.Ng=function(a,b){Ql(this.m).applyPxOffset([a,b]);Lm(this)};m.Ig=function(a,b,c){a=zk(this,zk(this,a));this.tb(a,b,c)};
T.prototype.zoomAt=T.prototype.Ig;T.prototype.tb=function(a,b,c){Ql(this.m).setLookAtData({zoom:a},ob(b)&&ob(b)?[b,c]:B);Lm(this);Pl(this.m);this.ca()};T.prototype.Eg=function(){this.$c(!0);this.U.S&&this.hc(!0);this.na.S&&this.ic(!0)};T.prototype.Hk=function(a){if(a){var b={};b.kk=a.power;b.nj=a.ease;b.duration=a.duration;this.ua=b}};T.prototype.Gd=function(a,b){var c=!!(b||a&(xk.HEADING|xk.TILT));this.Eg();this.Hk(b);this.na.start(a,c);Ql(this.m).setPanning(!0)};T.prototype.startInteraction=T.prototype.Gd;
T.prototype.td=function(a,b,c,d,e){var f=this.na;var g=!1;if(f.S){var h=Ql(this.m);var k=h.getLookAtData();var l=this.za.center;l=[l.x,l.y];b=f.store(a,b,c,d,e);c=f.am();a=f.vh();d=this.na.bm();e=this.na.wp();f.Fh&&(f.Yd(xk.TILT)&&(h.setLookAtData({tilt:Bk(this,k.tilt+a.y/this.za.height*-180)},l),g=!0),b&&1!==d&&f.Yd(xk.ZOOM)&&(g=f.am(),this.tb(zk(this,Ib(Kb(2,this.zoom)*d)/Sb),g.x,g.y),g=!0),f.Yd(xk.COORD)&&0<fm(a)&&(this.xc(-a.x,-a.y),g=!0),f.Yd(xk.HEADING)&&(b?h.setLookAtData({heading:k.heading+
Ck(this,e)},[c.x,c.y]):a.x&&h.setLookAtData({heading:Ck(this,k.heading+a.x/this.za.width*360)},l),g=!0),g&&(Pl(this.m),this.ca()))}};T.prototype.interaction=T.prototype.td;
T.prototype.ic=function(a){var b=this;if(this.na.S&&!a){if(this.ua){a=this.na.mc();var c=this.na.Gf();var d=this.ua.duration;var e=(this.ua.kk||1)*a;var f=new Vl(-e/(0<d?d:1),e);!E(c.x)&&!E(c.y)&&0<e&&b.na.Yd(xk.COORD)&&this.Zc(function(g){e=f.Aj(g*d);E(e)||b.xc(Eb(-c.x*e),Eb(-c.y*e))},d,void 0,this.ua.nj)}delete this.ua;this.na.clear()}Ql(this.m).setPanning(!1);this.ca()};T.prototype.endInteraction=T.prototype.ic;T.prototype.Fd=function(a,b,c){this.Eg();this.U.start(b,c);this.Hk(a);Ql(this.m).setPanning(!0)};
T.prototype.startControl=T.prototype.Fd;T.prototype.control=function(a,b,c,d,e,f){for(var g=0,h;g<arguments.length;g++)if(h=+arguments[g],h!==h)throw new D(this.control,g,h);this.U.S&&this.U.set(a,b,c,d,e,f)};T.prototype.control=T.prototype.control;
T.prototype.hc=function(a,b){var c=this,d;if(this.U.S){this.$c(!0);var e=Gj();var f=e-this.ej;if(1<=f){var g=rm(this.U);this.Mi(g,f)}if(!this.ua||a||b)"function"===typeof b&&(a=Ql(this.m),a=a.getLookAtData(),b(a),this.Bo(a));else{b=this.U.mc();var h=this.U.Gf();var k=this.ua.duration;var l=(this.ua.kk||1)*b;var n=new Vl(-l/(0<k?k:1),l);!E(h.Jb)&&!E(h.Kb)&&0<l&&this.Zc(function(p,q,r,v){e&&(r=v-e,e=0);l=n.Aj(p*k)*r;E(l)||((d=h.Lb*l)&&c.tb(zk(c,c.zoom+d),c.U.Pg,c.U.Qg),c.xc(Eb(h.Jb*l),Eb(h.Kb*l)))},
k,void 0,this.ua.nj)}this.U.reset();Ql(this.m).setPanning(!1);this.ca()}};T.prototype.endControl=T.prototype.hc;m=T.prototype;
m.Bo=function(a){var b=this,c=Qm(this,Pm(this,a.position)),d=c.y;c=c.x;var e=a.zoom,f=Qm(this,Pm(this,this.Nm));a=f.y;var g=f.x;f=this.zoom;var h=this.U.mc(),k=this.U.Pg,l=this.U.Qg,n=0;c=this.xj(g,c);c-=g;d-=a;f=e-f;a=Jb(c*c+d*d+f*f);if(0!==h&&0!==a){var p=c/a;var q=d/a;var r=f/a;var v=h*h/(2*a);this.Zc(function(w,y){var I;if(1!==w){w=h*y-v*y*y/2;y=w-n;if(I=r*y)I=zk(b,b.zoom+I),b.tb(I,k,l);b.xc(Eb(p*y),Eb(q*y));n=w}else b.tb(zk(b,e),k,l),b.ca()},2*a/h)}};
m.ag=function(a){var b=this,c=a.it;this.Xb.set(0,0);c.Jb||c.Kb||c.Lb||c.ii||c.ji||c.zk?(this.ej=Gj(),this.Zc(function(d,e,f,g){b.ej=g;b.Mi(c,f)},$b),this.ca()):this.$c(!0)};m.Mi=function(a,b){b=b||0;var c=this.U,d=Ql(this.m),e=d.getLookAtData();a.Lb&&this.tb(zk(this,e.zoom+a.Lb*b),c.Pg,c.Qg);d.setLookAtData({heading:Ck(this,e.heading+a.ji*b),tilt:Bk(this,e.tilt+a.ii*b)});Lm(this);this.xc(a.Jb*b,a.Kb*b)};m.Zc=function(a,b,c,d){this.ta&&this.ta.S&&this.ta.stop(!0);this.ta=new Cm(this,a,b,c,d);this.ta.start()};
m.$c=function(a){this.ta&&this.ta.S&&this.ta.stop(a)};m.fp=function(){};T.prototype.enter=T.prototype.fp;T.prototype.kp=function(a){wk(this.pc,a)};T.prototype.exit=T.prototype.kp;T.prototype.capture=function(a,b,c,d){var e=this;return Ul(e.m).then(function(f){var g=e.pc.ownerDocument.createElement("canvas"),h=e.ka,k=g.getContext("2d"),l=e.m.mb()/h,n=(c-a)*h;h*=d-b;g.width=n;g.height=h;k.drawImage(f,a*l,b*l,n*l,h*l,0,0,n,h);return g})};T.prototype.cz=function(a){return Ql(this.m).geoToMeters(a)};
T.prototype.geoToMeters=T.prototype.cz;T.prototype.sB=function(a){return Ql(this.m).metersToGeo(a)};T.prototype.metersToGeo=T.prototype.sB;var Dm=5E3;function U(a,b,c){var d={};if(!(a instanceof HTMLElement))throw new D(U,0);U.g.constructor.call(this);this.Fa=Um(c,U);this.xa=c=new ik;this.Aq=!1;c.addEventListener(c.l.Ki,this.Jv,!1,this);if(!C(a,Element))throw new D(U,0,a);c=this.J=a.ownerDocument.createElement("div");var e=c.style;e.position="relative";e.height=c.style.width="100%";e.overflow="hidden";e.webkitTapHighlightColor="transparent";"transparent"!==e.webkitTapHighlightColor&&(e.webkitTapHighlightColor="rgba(0,0,0,0)");a.appendChild(c);
this.pa=new tk(this.J,this.Fa);this.pa.addEventListener(this.pa.l.Ki,this.Jv,!1,this);a=this.P=new dk(this.Fa.layers);a.addEventListener(a.l.Ji,this.Mq,!1,this);a.addEventListener(a.l.Gi,this.Mq,!1,this);a.addEventListener(a.l.Ii,this.Mq,!1,this);!this.rb&&Vm(this);this.qa=null;this.P.add(b,0);this.Ca=this.To(null!=this.Fa.engineType?this.Fa.engineType:oh,this.Fa);this.ep=A(this.ep,this);b=this.Fa.imprint;if(b!==B&&"object"!==typeof b)throw new D(U,1,"imprint");Wm&&(b||(b={}),b.mark=b.mark||"GS (2022) 5659");
this.Vd=null===b?b:new Fk(this,b);b=this.Fa.autoColor;this.dt=b===B||!!b;Xm(this);(b=this.Fa.zoom)&&(d.zoom=b);(b=this.Fa.bounds)&&(d.bounds=b);(b=this.Fa.center)&&(d.position=b);this.xa.Xc(d)}u(U,J);t("H.Map",U);U.prototype.draggable=U.prototype.draggable=!1;function Um(a,b){if(a){var c=a.pixelRatio;if(c===B)a.pixelRatio=Ie();else if(!(0<c))throw new D(b,0,"pixelRatio: "+c);}else a={},a.pixelRatio=Ie();a.renderBaseBackground||(a.renderBaseBackground={lower:3,higher:2});return a}
U.prototype.Rx=333;U.prototype.i=function(){this.dt=!1;this.Vd&&this.Vd.u();this.Ca.dispose();this.xa.u();this.pa.u();this.rb.u();this.qc.u();this.P.u();var a=this.J;a.parentNode.removeChild(a);delete this.J;J.prototype.i.call(this)};U.prototype.F=function(){return this.J};U.prototype.getElement=U.prototype.F;U.prototype.mb=function(){return this.Fa.pixelRatio};U.prototype.getPixelRatio=U.prototype.mb;function Xm(a){a.Vd&&a.dt&&a.Vd.Pr({invert:a.qa&&a.qa.By})}
U.prototype.Mq=function(a){var b=a.added,c=a.removed;b&&b.D&&b.D.fa(this);c&&c.D&&c.D.fa(null);c===this.rb&&(delete this.rb,delete this.qc);c===this.qa&&(this.qa=null);0===a.idx&&(this.dispatchEvent(new nh(this.l.nl,this.qa=a.type!==this.P.l.Ii?b:0<this.P.ba.length?this.P.get(0):z,a.type!==this.P.l.Gi?c:1<this.P.ba.length?this.P.get(1):z)),Xm(this))};
U.prototype.Jv=function(a){a.modifiers&&(this.Aq||(Ym(this,"start"),this.Aq=!0),Ym(this,"",a),this.lv&&x.clearTimeout(this.lv),this.lv=x.setTimeout(this.ep,this.Rx))};function Ym(a,b,c){a.dispatchEvent(c?new Yj(a.l.Js,c.newValue,c.oldValue,c.modifiers):a.l.Js+b)}U.prototype.ep=function(){Ym(this,"end");this.Aq=!1};U.prototype.Vn=function(a,b){this.Ca.getCapabilities().lookAt&&this.xa.Xc({position:a},!!b);return this};U.prototype.setCenter=U.prototype.Vn;
U.prototype.wb=function(){var a=this.xa.Ib();return a?a.position:z};U.prototype.getCenter=U.prototype.wb;U.prototype.Lk=function(a,b){this.xa.Lk(a,!!b);return this};U.prototype.setZoom=U.prototype.Lk;U.prototype.Tb=function(){return this.xa.Tb()};U.prototype.getZoom=U.prototype.Tb;U.prototype.Ig=function(a,b,c){this.Ca.zoomAt(a,b,c)};U.prototype.zoomAt=U.prototype.Ig;U.prototype.DA=function(){return this.pa};U.prototype.getViewPort=U.prototype.DA;U.prototype.CA=function(){return this.xa};
U.prototype.getViewModel=U.prototype.CA;U.prototype.Rz=function(){return this.P};U.prototype.getLayers=U.prototype.Rz;U.prototype.Lz=function(){return this.Vd};U.prototype.getImprint=U.prototype.Lz;
U.prototype.capture=function(a,b,c,d,e,f){function g(G,S){q?G.cancel():(w.save(),S.capture(v,n,function(X){w.restore();G.done(X)},function(X){G.done(null,X);h(null)}))}function h(G){q||(q=!0,a(G))}var k=this.Ca,l=k.getCapabilities(),n=this.Fa.pixelRatio,p=this.pa,q=!1,r=this,v,w;if(!ab(a))throw new D(this.capture,0,a);c=c||0;d=d||0;e=e||p.width;f=f||p.height;var y=Db(0,Cb(c,e));var I=Db(0,Cb(d,f));c=Cb(p.width,Db(c,e));d=Cb(p.height,Db(d,f));l.capture?k.capture(y,I,c,d).then(function(G){var S=r.Vd,
X=b||[];v=G;w=v.getContext("2d");v.style.width=v.width/n+"px";v.style.height=v.height/n+"px";var Ga=new Mj(10,g);X=X.concat(S).filter(function(ha){return ab(ha&&ha.capture)});X.length?(G=X.pop(),X.forEach(function(ha){Ga.push(ha,Xe)}),Ga.push(G,A(h,r,v)),Ga.wn()):h(v)},function(){h(z)}):a(null)};U.prototype.capture=U.prototype.capture;U.prototype.xz=function(){return this.Ca};U.prototype.getEngine=U.prototype.xz;
U.prototype.To=function(a,b){b=b?Um(b,this.To):this.Fa;Xm(this);if(a===ph.P2D)return new x.H.map.render.p2d.RenderEngine(this.pa,this.xa,this.P,b);if(a===ph.WEBGL)return new T(this.pa,this.xa,this.P,b);if(a===ph.HARP)return new x.H.map.render.harp.RenderEngine(this.pa,this.xa,this.P,b);throw new D(this.To,0,a);};
U.prototype.Rk=function(a,b,c,d,e){b=db(b)?C(b,F,this.Rk,1,b)&&b:this.xa.Ib().bounds.C();e=e||this.qa;if(!C(e,Ah))throw new D(this.Rk,4);var f=e.D,g=this.mb(),h=e.tileSize;2<=g&&256<h&&f instanceof Kl&&(h/=2);g=this.Tb();h=Math.log2(h)-8;c=db(c)?+c:g;d=db(d)?+d:g;if(!(c<=d))throw new D(this.Rk,B,"!(min <= max)");g=f.min;var k=f.max,l=this.Ca.type===ph.WEBGL?Fb:Eb;c=ec(l(c)-h,g,k);d=ec(l(d)-h,g,k);if(!(f&&C(f,R)&&nl()&&f.Ri()))throw new Ab(this.Rk,"Storing is not supported");return new Wj(e,f,b,c,
d,a)};U.prototype.storeContent=U.prototype.Rk;function Zm(a){Tj.call(this,a)}u(Zm,Tj);Zm.prototype.$B=function(){Vj(this,2)};Zm.prototype.ZB=function(){Vj(this,4)};U.prototype.py=function(a){a=new Zm(a);ml().clear(A(a.$B,a),A(a.ZB,a));return a};U.prototype.clearContent=U.prototype.py;U.prototype.rl=function(a,b){var c=this.P,d=c.indexOf(a),e=b!==+b;b=e?c.ba.length-1:b;0>d?c.add(a,b):d-b&&(c.Bd(d),c.add(a,e?b-1:b));return this};U.prototype.addLayer=U.prototype.rl;
U.prototype.ei=function(a){var b=this.P.indexOf(a);a!==this.qa&&a!==this.rb&&-1!==b&&this.P.Bd(b);return this};U.prototype.removeLayer=U.prototype.ei;U.prototype.xg=function(a){this.qa!==a&&(this.P.ba.length&&this.P.get(0)!==this.rb?this.P.set(0,a):this.P.add(a,0),this.qa=a);return this};U.prototype.setBaseLayer=U.prototype.xg;U.prototype.iz=function(){return this.qa};U.prototype.getBaseLayer=U.prototype.iz;
U.prototype.Ka=function(a){if(!qc(a))throw new D(this.Ka,0,a);return(a=this.Ca.geoToScreen(a))?of(a):z};U.prototype.geoToScreen=U.prototype.Ka;U.prototype.Xa=function(a,b){var c;if(c=+E(a)||2*+E(b))throw new D(this.Xa,c-1,arguments[c-1]);return(c=this.Ca.screenToGeo(a,b))?sc(c):z};U.prototype.screenToGeo=U.prototype.Xa;U.prototype.Qn=function(a,b){return this.Ca.screenToLookAtData(a,b)};U.prototype.screenToLookAtData=U.prototype.Qn;
U.prototype.$=function(a){if(!C(a,O))throw new D(this.$,0,a);!this.rb&&Vm(this);this.qc.pd().$(a);return a};U.prototype.addObject=U.prototype.$;U.prototype.Na=function(a){if(!C(a,O))throw new D(this.Na,0,a);!this.rb&&Vm(this);this.qc.pd().Na(a);return a};U.prototype.removeObject=U.prototype.Na;U.prototype.cb=function(a){!this.rb&&Vm(this);return this.qc.pd().cb(a)};U.prototype.getObjects=U.prototype.cb;
U.prototype.fd=function(a){var b;ib(a,this.fd,0,a);!this.rb&&Vm(this);var c=a.length;for(b=0;b<c;b++)this.$(a[b]);return this};U.prototype.addObjects=U.prototype.fd;U.prototype.pg=function(a){var b;ib(a,this.pg,0,a);!this.rb&&Vm(this);var c=a.length;for(b=0;b<c;b++)this.Na(a[b]);return this};U.prototype.removeObjects=U.prototype.pg;U.prototype.xh=function(a,b,c){var d;if(d=+E(a)||2*+E(b))throw new D(this.xh,d-1,arguments[d-1]);this.Ca.getObjectsAt(a,b,!0,function(e){c(e[0])})};
U.prototype.getObjectAt=U.prototype.xh;U.prototype.La=function(a,b,c,d){var e;if(e=+E(a)||2*+E(b))throw new D(this.xh,e-1,arguments[e-1]);this.Ca.getObjectsAt(a,b,!1,c,!!d)};U.prototype.getObjectsAt=U.prototype.La;U.prototype.If=function(a,b,c){c=c||{};var d=c.zoom;c.zoom=db(d)?d:this.xa.Tb();this.qc.If(a,b,c)};U.prototype.getObjectsWithin=U.prototype.If;function Vm(a){a.qc=new P({max:24,engineType:a.Fa.engineType});a.rb=new Pj(a.qc,a.Fa);a.P.add(a.rb)}
var $m=Dk.HARP,ph={P2D:Dk.P2D,WEBGL:Dk.WEBGL,HARP:$m};U.EngineType=ph;U.prototype.l={FD:"mapviewchangestart",Js:"mapviewchange",Ks:"mapviewchangeend",nl:"baselayerchange"};function an(a,b,c,d){if(!a||!b||!c)throw new D(an,B,"Must specify name, version and revision parameter");this.name=a;this.version=b;this.revision=c;d&&Ta(this,d)}t("H.util.BuildInfo",an);an.prototype.toString=function(){var a,b=[];for(a in this)jb(this[a])&&b.push(this[a]);return b.join(";")};var bn={};function cn(a,b,c,d){if(!a)throw new D(cn,1,"Must specify a name parameter");return bn[a]||(bn[a]=new an(a,b,c,d))}an.get=cn;function dn(){return cn("H-core","1.54.1","17144d2",{region:"row"})}t("H.buildInfo",dn);var Wm="cn"===dn().region,oh=ph[Wm?"HARP":"WEBGL"],en,fn="maps".concat("js-"),gn,hn,jn,kn,ln;gn=x.document.querySelector('script[src*="'+fn+'"]');if(!gn)for(hn=x.document.getElementsByTagName("script"),kn=new RegExp("^.*"+fn),ln=0,jn=hn.length;ln<jn;ln++)if(kn.test(hn[ln].src)){gn=hn[ln];break}en=gn?gn.src.replace(/\/[^\/]*$/,"/"):"";t("H.getScriptPath",function(){return en});
function mn(){var a=decodeURIComponent(en);if(a){a="/"===a[a.length-1]?a.substring(0,a.length-1):a;var b=x.document,c="";b?(b=b.createElement("a"),b.href=a,c=b.href):/[\w]+:\/\//.test(a)&&(c=a);a=new URL(c);a.pathname+="/"===a.pathname[a.pathname.length-1]?"styles":"/styles";a=a.toString()}else a="https://js.api.here.com/v3/3.1.54.1/styles";return a}t("H.getStylePath",mn);

function nn(a,b,c,d,e,f){if(isNaN(a))throw Error("x needs to be a number");if(isNaN(b))throw Error("y needs to be a number");if(isNaN(c))throw Error("pointer must have an id");this.viewportX=a;this.viewportY=b;this.target=null;this.id=c;this.type=d;this.dragTarget=null;this.button=db(e)?e:-1;this.buttons=db(f)?f:0;this.Hm=this.button}t("H.mapevents.Pointer",nn);
function on(a,b,c){if(isNaN(b))throw Error("x needs to be a number");if(isNaN(c))throw Error("y needs to be a number");a.viewportX=b;a.viewportY=c}nn.prototype.Oz=function(){return this.Hm};nn.prototype.getLastChangedButton=nn.prototype.Oz;function pn(a,b){a.Hm=b;a.buttons|=qn[+b]||0}function rn(a,b){a.Hm=b;a.buttons&=~(qn[+b]||0)}var qn=[1,4,2],sn={NONE:-1,LEFT:0,MIDDLE:1,RIGHT:2};nn.Button=sn;function tn(a){this.Ea=a instanceof Array?a.slice(0):[]}m=tn.prototype;m.clear=function(){this.Ea.splice(0,this.Ea.length)};m.length=function(){return this.Ea.length};m.item=function(a){return this.Ea[a]||null};m.indexOf=function(a){for(var b=this.Ea.length;b--;)if(this.Ea[b].id===a)return b;return-1};function un(a,b){b=a.indexOf(b);return-1!==b?a.Ea[b]:null}m.remove=function(a){a=this.indexOf(a);return-1!==a?this.Ea.splice(a,1)[0]:null};
function vn(a,b){for(var c=a.Ea.length,d=[];c--;)a.Ea[c].type!==b&&d.push(a.Ea[c]);a.Ea=d}function wn(a,b){for(var c=a.Ea.length;c--;)if(a.Ea[c].dragTarget===b)return!0;return!1}m.push=function(a){if(a instanceof nn)return this.Ea.push(a);throw Error("list needs a pointer");};m.Ta=function(){return this.Ea};m.clone=function(){return new tn(this.Ea)};function xn(a,b,c,d,e,f,g){xn.g.constructor.call(this,a);this.pointers=b;this.changedPointers=c;this.targetPointers=d;this.currentPointer=e;this.originalEvent=g;this.target=f}u(xn,ie);t("H.mapevents.Event",xn);function yn(a,b,c){c=c||{};if(!(a instanceof U))throw Error("events: map instance required");if(!(b instanceof Array))throw Error("events: map array required");Zd.call(this);this.$o=c.$o||300;this.ut=c.ut||50;this.ex=c.ex||50;this.fx=c.fx||500;this.yq=c.yq||900;this.xq=c.xq||8;this.map=a;this.za=this.map.pa;this.element=this.za.element;this.ip=b;this.pointers=new tn;this.changedPointers=new tn;this.Tf={};this.Ja=null;this.Xl=!0;this.Dk={};this.mf={};this.Tj=null;this.hj=A(this.hj,this);this.Mt={pointerdown:this.Jy,
pointermove:this.Ky,pointerup:this.Ly,pointercancel:this.Iy};zn(this)}u(yn,Zd);function zn(a,b){var c,d=a.ip.length;for(c=0;c<d;c++){var e=a.ip[c];var f=e.listener;"function"===typeof f&&(b?(e.target||a.element).removeEventListener(e.ab,f):(e.target||a.element).addEventListener(e.ab,f))}}
function An(a,b,c){var d;if("function"===typeof a.Mt[b]){"pointermove"!==b&&(a.Xl=!0);var e=0;for(d=a.changedPointers.length();e<d;e++){var f=a.changedPointers.item(e);a.element.contains(c.composedPath()[0])?Bn(a,f,a.Et.bind(a,c,b,f)):a.Et(c,b,f,null)}}a.changedPointers.clear()}m=yn.prototype;m.Et=function(a,b,c,d){Cn(c.id,this.Dk);this.Mt[b].call(this,c,d,a)};
function Bn(a,b,c){if(a.Ja===b)c(b.target);else{var d=a.za;var e=b.viewportX;b=b.viewportY;if(0>e||0>b||e>=d.width||b>=d.height)c(z);else{var f=a.map;f.xh(e,b,function(g){c(g||f)})}}}
m.Ly=function(a,b,c){var d=a.id;a.target=b;Dn(this,a,c);En(this,b,"pointerup",c,a);"mouse"!==a.type&&En(this,b,"pointerleave",c,a);b=this.Tf[a.id];var e={x:a.viewportX,y:a.viewportY},f=c.timeStamp,g=a.target,h=this.Tj;b&&b.target===g&&b.jk.lb(e)<this.ex&&f-b.ls<this.fx?(En(this,g,"tap",c,a),h&&h.target===g&&f-h.ls<this.$o?h.jk.lb({x:a.viewportX,y:a.viewportY})<this.ut&&(En(this,g,"dbltap",c,a),this.Tj=null):this.Tj={target:g,jk:new L(a.viewportX,a.viewportY),ls:c.timeStamp}):this.Tj=null;this.Tf=
{};Cn(d,this.mf)};function Dn(a,b,c){b===a.Ja&&(En(a,b.dragTarget,"dragend",c,b),a.Ja=null,Cn(b.id,a.Dk));b.dragTarget=null}m.hj=function(a,b){var c=this;En(this,a.dragTarget,"drag",b,a);Cn(a.id,this.Dk);this.Dk[a.id]=setTimeout(function(){c.hj(a,b)},150)};function Cn(a,b){b[a]&&(b[a].timeout?clearTimeout(b[a].timeout):clearTimeout(b[a]),delete b[a])}
function Fn(a,b,c){var d=b.target,e=new L(b.viewportX,b.viewportY),f=b.id;Cn(f,a.mf);var g=setTimeout(function(){d&&d===b.target&&e.lb({x:b.viewportX,y:b.viewportY})<a.xq&&(En(a,d,"longpress",c,b),delete a.Tf[b.id])},a.yq);a.mf[f]={timeout:g,jk:e}}
m.Ky=function(a,b,c){var d=a.dragTarget,e=a.id;var f=a.target;a.target=b;f!==b&&(En(this,f,"pointerleave",c,a),En(this,b,"pointerenter",c,a));d?this.Ja?(this.hj(a,c),this.mf[e]&&this.mf[e].jk.lb({x:a.viewportX,y:a.viewportY})>this.xq&&Cn(e,this.mf)):this.Xl?this.Xl=!1:(this.Ja=a,En(this,d,"dragstart",c,a),this.hj(a,c),delete this.Tf[e],this.Xl=!0):(!this.Ja||this.Ja&&this.Ja.dragTarget!==b&&this.Ja.dragTarget!==this.map)&&En(this,b,"pointermove",c,a)};
m.Jy=function(a,b,c){var d=!(/^(?:mouse|pen)$/.test(a.type)&&0!==c.button);if(b){a.target=b;this.Tf[a.id]={jk:new L(a.viewportX,a.viewportY),target:a.target,ls:c.timeStamp};"mouse"!==a.type&&En(this,b,"pointerenter",c,a);var e=En(this,b,"pointerdown",c,a);!this.Ja&&d&&(b.draggable&&!wn(this.pointers,b)?a.dragTarget=b:!this.map.draggable||e.defaultPrevented||wn(this.pointers,this.map)||(a.dragTarget=this.map));Fn(this,a,c)}};
m.Iy=function(a,b,c){var d=a.id;a.target=null;b?(En(this,b,"pointerleave",c,a),En(this,b,"pointercancel",c,a)):En(this,this.map,"pointercancel",c,a);Dn(this,a,c);this.Tf={};Cn(d,this.mf)};
function En(a,b,c,d,e){if(b&&"function"===typeof b.dispatchEvent){var f=xn;var g=a.pointers.Ta(),h=a.changedPointers.Ta();a=a.pointers;var k,l=a.Ea.length,n=[];for(k=0;k<l;k++)a.Ea[k].target===b&&n.push(a.Ea[k]);f=new f(c,g,h,n,e,b,d);e.button=/^(?:longpress|(?:dbl)?tap|pointer(?:down|up))$/.test(c)?e.Hm:sn.NONE;b.dispatchEvent(f)}return f}
m.i=function(){zn(this,!0);this.pointers.clear();this.changedPointers.clear();var a=this.Dk,b;for(b in a)Cn(b,a);a=this.mf;for(var c in a)Cn(c,a);delete this.element;delete this.ip;delete this.pointers;delete this.changedPointers;delete this.map;this.Tj=null;delete this.Tf;this.Ja=null;Zd.prototype.i.call(this)};function Gn(a){var b=a.ownerDocument;b=b.documentElement||b.body.parentNode||b.body;try{var c=a.getBoundingClientRect()}catch(d){c={top:0,right:0,bottom:0,left:0,height:0,width:0}}return{x:c.left+("number"===typeof window.pageXOffset?window.pageXOffset:b.scrollLeft),y:c.top+("number"===typeof window.pageYOffset?window.pageYOffset:b.scrollTop)}}var Hn=function(){return this}.apply(null);function In(a,b,c,d,e){In.g.constructor.call(this,"wheel");this.delta=a;this.viewportX=b;this.viewportY=c;this.target=d;this.originalEvent=e}u(In,ie);t("H.mapevents.WheelEvent",In);function Jn(a){var b="onwheel"in document;this.Qx=b;this.Ox=(b?"d":"wheelD")+"elta";this.Wp=A(this.Wp,this);Jn.g.constructor.call(this,a,[{ab:(b?"":"mouse")+"wheel",listener:this.Wp}]);this.pa=this.map.pa}u(Jn,yn);
Jn.prototype.normalize=function(a,b,c){var d=this.Ox,e=a[d+(d+"Y"in a?"Y":"")],f;La&&"rtl"===x.getComputedStyle(this.pa.element).direction&&(b-=(x.devicePixelRatio-1)*this.pa.width);if(e){var g=Math.abs;var h=g(e);e=(!(f=a[d+"X"])||3<=h/g(f))&&(!(f=a[d+"Z"])||3<=h/g(f))?(+(0<e)-+(0>e))*(this.Qx?1:-1):0}return new In(e,b,c,null,a)};
Jn.prototype.Wp=function(a){if(!a.Ex){var b=Gn(this.element);b=this.normalize(a,a.pageX-b.x,a.pageY-b.y);b.delta&&(a.stopImmediatePropagation(),a.preventDefault(),this.map.xh(b.viewportX,b.viewportY,this.Hp.bind(this,b)))}};Jn.prototype.Hp=function(a,b){var c=a.target=b||this.map,d,e;setTimeout(function(){c.dispatchEvent(a);a.defaultPrevented||(d=a.originalEvent,e=new x.WheelEvent("wheel",d),e.Ex=!0,d.target.dispatchEvent(e))},0)};function Kn(a){var b=Ln(this);(window.PointerEvent||window.MSPointerEvent)&&b.push({ab:"MSHoldVisual",listener:"prevent"});yn.call(this,a,b)}u(Kn,yn);function Ln(a){var b=!!window.PointerEvent,c,d,e=[];a.Vp=A(a.Vp,a);"MSPointerDown MSPointerMove MSPointerUp MSPointerCancel MSPointerOut MSPointerOver".split(" ").forEach(function(f){c=f.toLowerCase().replace(/ms/g,"");d=b?c:f;e.push({ab:d,listener:a.Vp,target:/^pointer(up|move)$/.test(c)?window:null})});return e}var Mn={2:"touch",3:"pen",4:"mouse"};
Kn.prototype.Vo=function(a,b){var c=a.pointerType;"number"===typeof c&&(c=Mn[c]);a=new nn(b.x,b.y,a.pointerId,c,a.button,a.buttons);this.pointers.push(a);return a};
Kn.prototype.Vp=function(a){var b=window.PointerEvent?a.type:a.type.toLowerCase().replace(/ms/g,""),c=Gn(this.element),d=un(this.pointers,a.pointerId),e=a.pageX-c.x;c=a.pageY-c.y;var f=Mn[a.pointerType]||a.pointerType;La&&"rtl"===x.getComputedStyle(this.za.element).direction&&(e-=(x.devicePixelRatio-1)*this.za.width);d||/^pointer(up|out|cancel)$/.test(b)||"touch"===f&&"pointerdown"!==b||(d=this.Vo(a,{x:e,y:c}));if(d)if(/^pointer(up|cancel)$/.test(b)?("touch"===f&&this.pointers.remove(d.id),rn(d,a.button)):
"pointerdown"===b&&("touch"===a.pointerType&&(vn(this.pointers,"mouse"),vn(this.pointers,"pen")),pn(d,a.button)),this.changedPointers.push(d),"pointermove"!==b)on(d,e,c),An(this,/^pointer(over|out)$/.test(b)?"pointermove":b,a);else if(d.viewportX!==e||d.viewportY!==c)on(d,e,c),An(this,b,a);this.changedPointers.clear()};function Nn(a,b,c,d){Nn.g.constructor.call(this,"contextmenu");this.items=[];this.viewportX=a;this.viewportY=b;this.target=c;this.originalEvent=d}u(Nn,ie);t("H.mapevents.ContextMenuEvent",Nn);function On(a){this.Sp=A(this.Sp,this);this.Up=A(this.Up,this);this.Tp=A(this.Tp,this);this.mn=!1;this.eh=-1;this.av=0;On.g.constructor.call(this,a,[{ab:"contextmenu",listener:this.Sp},{target:a,ab:"longpress",listener:this.Up},{target:a,ab:"dbltap",listener:this.Tp}])}u(On,yn);m=On.prototype;m.Up=function(a){var b=a.currentPointer;"touch"===b.type&&1===a.pointers.length&&Pn(this,b.viewportX,b.viewportY,a.originalEvent,a.target)};m.Tp=function(a){"touch"===a.currentPointer.type&&(this.av=Date.now())};
m.Sp=function(a){var b=this;-1===this.eh?this.eh=setTimeout(function(){var c=Gn(b.element),d=a.pageX-c.x;c=a.pageY-c.y;b.eh=-1;Pn(b,d,c,a)},this.$o):(clearInterval(this.eh),this.eh=-1);a.preventDefault()};function Pn(a,b,c,d,e){var f=a.map,g=Date.now()-a.av;e?!a.mn&&g>a.yq&&(a.mn=!0,e.dispatchEvent(new Nn(b,c,e,d)),re(f.F(),Qn,a.Dt,!1,a)):f.xh(b,c,a.Hp.bind(a,b,c,d))}m.Hp=function(a,b,c,d){Pn(this,a,b,c,d&&ab(d.dispatchEvent)?d:this.map)};
m.Dt=function(){this.mn&&(this.mn=!1,this.map.dispatchEvent(new ie("contextmenuclose",this.map)))};m.i=function(){var a=this.map.F();clearInterval(this.eh);a&&ye(a,Qn,this.Dt,!1,this);yn.prototype.i.call(this)};var Qn=["mousedown","touchstart","pointerdown","wheel"];function Rn(a){this.Ch=A(this.Ch,this);yn.call(this,a,[{ab:"touchstart",listener:this.Ch},{ab:"touchmove",listener:this.Ch},{ab:"touchend",listener:this.Ch},{ab:"touchcancel",listener:this.Ch}]);this.rx={touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",touchcancel:"pointercancel"};this.Cu=(a=(a=a.Vd)?a.F():null)?Array.prototype.slice.call(a.querySelectorAll("a"),0):[]}u(Rn,yn);
Rn.prototype.Ch=function(a){var b=a.touches,c=this.pointers.length(),d;if("touchstart"===a.type&&c>=b.length){c=this.pointers.clone();for(d=b.length;d--;)c.remove(b[d].identifier);for(d=c.length();d--;)this.pointers.remove(c.item(d).id);this.changedPointers=c;An(this,"pointercancel",a);this.changedPointers.clear()}if(this.rx[a.type]){b=Gn(this.za.element);c=a.type;d=a.changedTouches;var e=d.length,f;this.changedPointers.clear();for(f=0;f<e;f++){var g=d[f];var h=un(this.pointers,g.identifier);var k=
g.pageX-b.x;var l=g.pageY-b.y;if(h)if("touchmove"===c){g=Math.abs(h.viewportX-k);var n=Math.abs(h.viewportY-l);if(1<g||1<n||1===g&&1===n)on(h,k,l),this.changedPointers.push(h)}else"touchend"===c&&(this.pointers.remove(h.id),this.changedPointers.push(h),rn(h,sn.LEFT));else h=new nn(k,l,g.identifier,"touch",sn.LEFT,1),this.pointers.push(h),this.changedPointers.push(h)}An(this,this.rx[a.type],a);-1===this.Cu.indexOf(a.target)&&a.preventDefault()}};Rn.prototype.i=function(){this.Cu=null;yn.prototype.i.call(this)};function Sn(a){this.Nf=A(this.Nf,this);yn.call(this,a,[{ab:"mousedown",listener:this.Nf},{ab:"mousemove",listener:this.Nf,target:window},{ab:"mouseup",listener:this.Nf,target:window},{ab:"mouseover",listener:this.Nf},{ab:"mouseout",listener:this.Nf},{ab:"dragstart",listener:this.YB}])}u(Sn,yn);Sn.prototype.Vo=function(a){a=new nn(a.x,a.y,1,"mouse");this.pointers.push(a);return a};
Sn.prototype.Nf=function(a){var b=a.type,c=Gn(this.element),d={x:a.pageX-c.x,y:a.pageY-c.y};c=this.pointers.item(0)||this.Vo(d);this.changedPointers.push(c);on(c,d.x,d.y);/^mouse(?:move|over|out)$/.test(b)?An(this,"pointermove",a):(/^mouse(down|up)$/.test(b)&&(d=a.which-1,"up"===Hn.RegExp.$1?rn(c,d):pn(c,d)),An(this,b.replace("mouse","pointer"),a));this.changedPointers.clear()};Sn.prototype.YB=function(a){a.preventDefault()};function Tn(a){var b=a.pa.element.style;if(-1!==Un.indexOf(a))throw Error("InvalidArgument: map is already in use");this.v=a;Un.push(a);b.msTouchAction=b.touchAction="none";Ma||!window.PointerEvent&&!window.MSPointerEvent?(this.qx=new Rn(this.v),this.wv=new Sn(this.v)):this.qx=new Kn(this.v);this.xD=new Jn(this.v);this.ty=new On(this.v);this.v.bc(this.u,this);Zd.call(this)}u(Tn,Zd);t("H.mapevents.MapEvents",Tn);var Un=[];rb(Un);
Tn.prototype.u=function(){delete this.v;this.qx.u();this.xD.u();this.ty.u();this.wv&&this.wv.u();Un.splice(Un.indexOf(this.v),1);Zd.prototype.u.call(this)};Tn.prototype.dispose=Tn.prototype.u;Tn.prototype.hz=function(){return this.v};Tn.prototype.getAttachedMap=Tn.prototype.hz;function Vn(a,b){b=void 0===b?{}:b;var c;Vn.g.constructor.call(this);if(-1!==Wn.indexOf(a))throw new D(Vn,0,"events are already used");this.v=c=a.v;this.jv=a;Wn.push(a);c.draggable=!0;this.ua=b.kinetics||{duration:600,ease:Xl};this.yB=b.modifierKey||"Alt";this.enable(b.enabled);this.Bi=c.pa;this.il=this.Bi.element;this.Jm=0;c.addEventListener("dragstart",this.zd,!1,this);c.addEventListener("drag",this.cg,!1,this);c.addEventListener("dragend",this.$e,!0,this);c.addEventListener("wheel",this.Lv,!1,
this);c.addEventListener("dbltap",this.Ev,!1,this);c.addEventListener("pointermove",this.ee,!1,this);qe(this.il,"contextmenu",this.Wm,!1,this);a.bc(this.u,this)}u(Vn,Zd);t("H.mapevents.Behavior",Vn);var Wn=[];rb(Wn);Vn.prototype.Qb=0;var Xn={PANNING:1,PINCH_ZOOM:2,WHEEL_ZOOM:4,DBL_TAP_ZOOM:8,FRACTIONAL_ZOOM:16,TILT:32,HEADING:64};Vn.Feature=Xn;var Yn=Xn.PANNING,Zn=Xn.PINCH_ZOOM,$n=Xn.WHEEL_ZOOM,ao=Xn.DBL_TAP_ZOOM,bo=Xn.FRACTIONAL_ZOOM,co=Xn.TILT,eo=Xn.HEADING,fo=Yn|Zn|$n|ao|bo|co|eo;
Vn.DRAGGING=Yn;Vn.WHEELZOOM=$n;Vn.DBLTAPZOOM=ao;Vn.FRACTIONALZOOM=bo;function go(a,b){if(a!==+a||a%1||0>a||2147483647<a)throw new D(b,0,"integer in range [0...0x7FFFFFFF] required");}Vn.prototype.disable=function(a){var b=this.Qb;a!==B?(go(a,this.disable),b^=b&a):b=0;this.Bi.endInteraction(!0);this.Qb=b;this.v.draggable=0<(b&(Yn|co|eo|Zn))};Vn.prototype.disable=Vn.prototype.disable;
Vn.prototype.enable=function(a){var b=this.Qb;a!==B?(go(a,this.enable),b|=a&fo):b=fo;this.Qb=b;this.v.draggable=0<(b&(Yn|co|eo|Zn))};Vn.prototype.enable=Vn.prototype.enable;Vn.prototype.isEnabled=function(a){go(a,this.isEnabled);return a===(this.Qb&a)};Vn.prototype.isEnabled=Vn.prototype.isEnabled;
function ho(a,b,c){var d="touch"===b.currentPointer.type,e=0,f;if(f=!d){f=a.yB;var g=b.originalEvent;f=g.getModifierState?g.getModifierState(f):!!g[f.replace(/^Control$/,"ctrl").toLowerCase()+"Key"]}f?e|=co|eo:(e|=Yn,d&&(b=b.pointers,2===b.length&&(e|=Zn|eo,c?55>Hb(b[0].viewportY-b[1].viewportY)&&(e|=co):a.cq&xk.TILT&&(e|=co))));e&=a.Qb;return(e&co?xk.TILT:0)|(e&eo?xk.HEADING:0)|(e&Zn?xk.ZOOM:0)|(e&Yn?xk.COORD:0)}
function io(a){var b=a.pointers;a=b[0];b=b[1];a=[a.viewportX,a.viewportY];b&&a.push(b.viewportX,b.viewportY);return a}m=Vn.prototype;m.cq=0;m.zd=function(a){var b=ho(this,a,!0);if(this.cq=b){var c=this.Bi;a=io(a);c.startInteraction(b,this.ua);c.interaction.apply(c,a);if(this.Qb&$n&&!(this.Qb&bo)&&(b=a[0],c=a[1],this.Jm)){a=this.v.Tb();var d=(0>this.Jm?Gb:Fb)(a);a!==d&&(this.Jm=0,this.Ei(a,d,b,c))}}};
m.cg=function(a){var b=ho(this,a,!1);if(b!==this.cq)"pointerout"!==a.originalEvent.type&&"pointerover"!==a.originalEvent.type&&(this.$e(a),this.zd(a));else if(b){b=this.Bi;var c=io(a);b.interaction.apply(b,c);a.originalEvent.preventDefault()}};m.$e=function(a){ho(this,a,!1)&&this.Bi.endInteraction(!this.ua)};
m.Ei=function(a,b,c,d){var e=this.v.xa;if(isNaN(+a))throw Error("start zoom needs to be a number");if(isNaN(+b))throw Error("to zoom needs to be a number");0!==+b-+a&&(e.startControl(null,c,d),e.control(0,0,6,0,0,0),e.endControl(!0,function(f){f.zoom=b}))};m.Lv=function(a){if(!a.defaultPrevented&&this.Qb&$n){var b=a.delta;var c=this.v.Tb();var d=this.v;var e=d.Ca.type;d=this.Qb&bo?c-b:(0>-b?Gb:Fb)(c)-b;if(e===ph.P2D||e===ph.WEBGL||e===ph.HARP)this.Ei(c,d,a.viewportX,a.viewportY),this.Jm=b;a.preventDefault()}};
m.ee=function(){};m.Ev=function(a){var b=a.currentPointer,c=this.v.Tb(),d=a.currentPointer.type,e=this.v.Ca.type;(e===ph.P2D||e===ph.WEBGL||e===ph.HARP)&&this.Qb&ao&&(a="mouse"===d?0===a.originalEvent.button?-1:1:0<a.pointers.length?1:-1,a=this.Qb&bo?c-a:(0>-a?Gb:Fb)(c)-a,this.Ei(c,a,b.viewportX,b.viewportY))};m.Wm=function(a){return this.Qb&ao?(a.preventDefault(),!1):!0};
m.u=function(){var a=this.v;a&&(a.draggable=!1,a.removeEventListener("dragstart",this.zd,!1,this),a.removeEventListener("drag",this.cg,!1,this),a.removeEventListener("dragend",this.$e,!0,this),a.removeEventListener("wheel",this.Lv,!1,this),a.removeEventListener("dbltap",this.Ev,!1,this),a.removeEventListener("pointermove",this.ee,!1,this),delete this.v);this.il&&(this.il.style.msTouchAction="",ye(this.il,"contextmenu",this.Wm,!1,this),delete this.il);delete this.Bi;delete this.ua;Wn.splice(Wn.indexOf(this.jv),
1);delete this.jv;Zd.prototype.u.call(this)};Vn.prototype.dispose=Vn.prototype.u;t("H.mapevents.buildInfo",function(){return cn("H-mapevents","1.54.1","17144d2",{region:"row"})});

R.prototype.Un=ca(3,function(a){var b=this.getCache(),c=this;if(a!==z){C(a,ij,R.prototype.Un,0);var d=a}else d=pl;d!==b&&b.ja(function(e,f,g){return c.cc(e)?(d.add(e,f,g),!0):!1});this.ft=d});Zg.prototype.Yb=ca(2,function(a){this.ps=a;a=this.getState();a!==lg.INIT&&a!==lg.LOADING&&fh(this)});function jo(a){a=a.Sd("_#-;,:","_#-;,:","_#-;,:");return new RegExp("^"+a.replace(/[.*+?^${}()|[\]\\\/]/g,"\\$&").replace(/_#-;,:/g,"\\d+")+"$")}function ko(a,b){Ta.apply(null,arguments);return a}
function lo(a,b){var c=x.console;c&&c.warn&&(a=fb(a)+" is deprecated and will be removed soon. ",b&&(a+=b),c.warn(a))}var mo={};function no(){this.ms={}}function oo(a,b){for(var c in b)b.hasOwnProperty(c)&&a.wo(c,b[c])}no.prototype.wo=function(a,b){a=this.ms[a]||(this.ms[a]=[]);var c,d=b.length;for(c=0;c<d;c++){var e=new mo.Ns(b[c]);a.push(e)}};no.prototype.query=function(a,b,c){a=this.ms[a];var d,e=a?a.length:0,f=[];for(d=0;d<e;d++)a[d].Pf(b,c)&&f.push(a[d]);return f};
mo.Ns=function(a){var b,c=a.boxes;this.alt=a.alt;this.label=a.label;this.min=a.minLevel;this.max=a.maxLevel;this.Cn=[];if(c&&(b=c.length)){var d=c[0];var e=new F(d[0],d[1],d[2],d[3]);this.Cn.push(e);this.nn=new F(d[0],d[1],d[2],d[3]);for(a=1;a<b;a++)d=c[a],e=new F(d[0],d[1],d[2],d[3]),this.Cn.push(e),this.nn.wd(e,!1,this.nn)}};mo.Ns.prototype.Pf=function(a,b){if(a>=this.min&&a<=this.max)if((a=this.Cn.length)&&this.nn){if(this.nn.Pf(b))for(;a--;)if(this.Cn[a].Pf(b))return!0}else return!0;return!1};var po=globalThis;function qo(){}qo.prototype.pop=function(a){this[a]||(this[a]=[]);return this[a].pop()||document.createElement("canvas")};qo.prototype.push=function(a,b){this[b]||(this[b]=[]);this[b].push(a)};var ro=new qo;t("H.service.util.eval",function(a){return eval(a)});function V(a,b,c,d,e,f){if(a&&b)this.Vr(a),this.Gk(b),this.Ag(c),this.Rr(e),this.Gw(f),this.Jk(d);else throw new D(V,B,'Parameters "scheme" and "host" must be specified');}t("H.service.Url",V);
function so(a,b){var c=x.document,d;var e="";if(c){e=c.createElement("a");if(b){var f=(d=c.getElementsByTagName("base")[0])&&d.href;var g=c.head;var h=d||g.appendChild(c.createElement("base"));h.href=b}e.href=a;e=e.href;b&&(d?d.href=f:g.removeChild(h))}else/[\w]+:\/\//.test(a)&&(e=a);f=/(?:(\w+):\/\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\/[^?#]*)?(\?[^#]+)?(#.*)?/.exec(e);a=f[1];g=f[4];b=f[5];h=f[6];c=f[7];d=f[8];!f[2]&&g&&/@/.test(g)&&(g=g.split("@")[1]);f=V;h=h&&0<h.length?h.substr(1):
"";e={};var k,l;if(c)for(k=/([?&]?([^=&+]+))(=([^&]+))?/g;l=k.exec(c);)e[decodeURIComponent(l[2])]=l[4]?decodeURIComponent(l[4]):void 0;return new f(a,g,h,e,isNaN(+b)?void 0:+b,d&&0<d.length?d.substr(1):"")}V.parse=so;V.prototype.clone=function(){var a={},b;for(b in this.Ga)a[b]=this.Ga[b];return new V(this.ki,this.Ij,this.df,a,this.ik,this.Cb)};V.prototype.clone=V.prototype.clone;
V.prototype.Vr=function(a){if(!a||"string"!==typeof a)throw new D(this.Vr,0,'The "scheme" parameter must be a non-empty string.');this.ki=a;return this};V.prototype.setScheme=V.prototype.Vr;V.prototype.qA=function(){return this.ki};V.prototype.getScheme=V.prototype.qA;V.prototype.Gk=function(a){if(!a||"string"!==typeof a||"-"===a.charAt(0)||"."===a.charAt(0)||"."===a.charAt(a.length-1))throw new D(this.Gk,0,'The "host" parameter is not a valid host name.');this.Ij=a;return this};
V.prototype.setHost=V.prototype.Gk;V.prototype.Jz=function(){return this.Ij};V.prototype.getHost=V.prototype.Jz;V.prototype.Ag=function(a){this.df=a||void 0;return this};V.prototype.setPath=V.prototype.Ag;V.prototype.cA=function(){return this.df};V.prototype.getPath=V.prototype.cA;V.prototype.Jk=function(a){if(a)if("object"==typeof a)this.Ga=a;else throw new D(this.Jk,0,'Parameter "params" must be an object.');else this.Ga={};return this};V.prototype.setQuery=V.prototype.Jk;V.prototype.xu=function(){return!to(this)};
V.prototype.hasQuery=V.prototype.xu;V.prototype.getQuery=function(){return this.Ga};V.prototype.getQuery=V.prototype.getQuery;V.prototype.Rr=function(a){if(void 0===a)this.ik=a;else{var b=ec(+a<<0,0,65535);if(b!=a)throw new D(this.Rr,0,'Parameter "port" must be an integer in range [0...65535]');this.ik=b}return this};V.prototype.setPort=V.prototype.Rr;V.prototype.hA=function(){return this.ik};V.prototype.getPort=V.prototype.hA;V.prototype.Gw=function(a){this.Cb=a||void 0;return this};
V.prototype.setAnchor=V.prototype.Gw;V.prototype.tp=function(){return this.Cb};V.prototype.getAnchor=V.prototype.tp;V.prototype.B=function(a){if("object"!==typeof a)throw new D(this.B,0,'Parameter "other" must be an object.');var b=this.Ga,c;for(c in a)a.hasOwnProperty(c)&&"function"!==typeof a[c]&&(b[c]=a[c]);return this};V.prototype.mergeQuery=V.prototype.B;
V.prototype.Ha=function(a){if(!a||"string"!==typeof a)throw new D(this.Ha,0,'Parameter "subDomain" must be a non-empty string');"."===a.substr(a.length-1)&&(a=a.substr(0,a.length-1));return this.Gk(a+"."+this.Ij)};V.prototype.addSubDomain=V.prototype.Ha;V.prototype.A=function(a){if(!a||"string"!==typeof a)throw new D(this.A,0,'Parameter "subPath" must be a non-empty string');return this.Ag((this.df?this.df+"/":"")+a)};V.prototype.addSubPath=V.prototype.A;
V.prototype.toString=function(){return[this.ki+"://",this.Ij,this.ik?":"+this.ik:"",this.df||!to(this)||this.Cb?"/":"",this.df?encodeURI(this.df):"",uo(this),this.Cb?"#"+encodeURIComponent(this.Cb):""].join("")};V.prototype.toString=V.prototype.toString;function vo(a){return encodeURIComponent(a).replace(/[!'()*]/g,function(b){return"%"+b.charCodeAt(0).toString(16)})}
function uo(a){var b=[],c=a.Ga,d={},e;for(e in c){if(c.hasOwnProperty(e)&&"function"!==typeof c[e]){var f=a.Ga[e];d.Jg=vo(e);C(f,wo)?f.co.forEach(function(g){return function(h){b.push(g.Jg+"="+vo(h))}}(d)):C(f,xo)?b.push(d.Jg+"="+f.co.map(function(g){return vo(g)}).join(f.Gy)):b.push(void 0===f?d.Jg:d.Jg+"="+vo(f))}d={Jg:d.Jg}}return 0<b.length?"?"+b.join("&"):""}
function yo(a){var b=cn("H-service","1.54.1","17144d2",{region:"row"});a.Ga.xnlp="CL_JSMv3."+b.version;return a}function to(a){var b,c=0;for(b in a.Ga)if(a.Ga.hasOwnProperty(b)&&"function"!==typeof a.Ga[b]&&(c++,0<c))break;return!c}function zo(a,b){if(ib(a))for(var c=0;c<a.length;c++){var d=a[c];if(!jb(d)&&!ob(d)){var e="The Array does not contain only strings and numbers";break}}else e="Not an Array";if(e)throw new D(b,0,a);return a}
function wo(a){this.co=zo(a,wo)}V.MultiValueQueryParameter=wo;wo.prototype.BA=function(){return this.co};wo.prototype.getValues=wo.prototype.BA;function xo(a,b){this.co=zo(a,xo);if(!/^[!\$\(\)\*\+,;]$/.test(b))throw new D(xo,1,'Invalid delimiter "'+b+'"');this.Gy=b}V.DelimitedQuerySubValues=xo;function Ao(a,b){C(a,Bo,Ao,0);var c={};Object.assign(c,b);c.min=c.min||0;c.max=c.max||20;c.tileSize=c.tileSize||512;c.getURL=function(d,e,f){return a.Lf(d,e,f).clone().B({size:c.tileSize})};Kl.call(this,c);this.aa=a}u(Ao,Kl);t("H.service.rasterTile.Provider",Ao);Ao.prototype.V=function(a,b){var c=this.aa;return c.V().query(c.yi.Nn+"."+c.L(),b,a)};Ao.prototype.getCopyrights=Ao.prototype.V;Ao.prototype.Ri=function(){return nl()};Ao.prototype.qd=function(){return nl()?ml():Ao.g.qd.call(this)};function W(a){a=ko({},this.Ey,a);var b=a.apikey||a.apiKey,c=a.baseUrl;if(c=b?c?0:"baseUrl":"apikey")throw new D(W,0,'"'+c+'" must be specified');this.Jw(a.baseUrl);this.Zs=b;this.hd.B({apikey:b});this.Lc=a.headers||{};this.LC=Ra(a.servicesConfig||{})}t("H.service.Platform",W);W.prototype.Ey={apikey:null,baseUrl:new V("https","hereapi"+(Wm?".cn":".com"))};W.prototype.Jw=function(a){this.hd=yo(a.clone());this.Zs=a=this.Zs;this.hd.B({apikey:a})};W.prototype.setBaseUrl=W.prototype.Jw;
W.prototype.Fc=function(){return this.hd};W.prototype.getBaseUrl=W.prototype.Fc;W.prototype.Ua=function(a,b){try{return a.Am=!0,new a(ko({platformBaseUrl:this.Fc(),headers:this.Lc},this.LC[a.CONFIG_KEY]||{},b||{}))}finally{a.Am=!1}};W.prototype.createService=W.prototype.Ua;
W.prototype.Ql=function(a,b,c){var d=this;if(!H.map.render.harp)throw Error("HARP engine module not found");if(!ya(a)&&!jb(a))throw new D(this.Ql,0,"is invalid: must be either a configuration object or a URL");if(!ab(b))throw new D(this.Ql,1,"is invalid: must be a Function");if(!ab(c))throw new D(this.Ql,2,"is invalid: must be a Function");var e=new H.map.render.harp.Style(a);e.addEventListener("change",function(){var f=e.getState();if(-1===f)c(Error("H.service.platform#createHybridLayers method failed to load style configuration"));
else if(2===f){f={dark:!0};var g=d.Mp({resource:"background",queryParams:{style:"satellite.day"}}),h=e.Pd(),k={styles:[{technique:"raster",attr:{gamma:1,brightness:1}}]};h.definitions&&(void 0!==h.definitions["Satellite.Texture.Gamma"]&&(k.styles[0].attr.gamma=h.definitions["Satellite.Texture.Gamma"]),void 0!==h.definitions["Satellite.Texture.Brightness"]&&(k.styles[0].attr.brightness=h.definitions["Satellite.Texture.Brightness"]));g=new Ao(g,{engineType:$m,style:new H.map.render.harp.Style(k)});
b({raster:new ej(g,f),vector:d.wh().kd(e,{engineType:$m},f),traffic:d.Pp().kd(e,{engineType:$m},f)})}});e.load()};W.prototype.createHybridLayers=W.prototype.Ql;function Co(a,b){b=void 0===b?{}:b;if(!a.Am)throw new Ab(a);Co.g.constructor.call(this);var c=Do(this,b);if(!c.baseUrl&&!c.platformBaseUrl)throw new D(a,0,'either "baseUrl" or "platformBaseUrl" must be specified');this.uc=(c.baseUrl?c.baseUrl:c.platformBaseUrl).clone();a=c.baseUrl?b:c;a.host&&this.uc.Gk(a.host);a.subDomain&&this.uc.Ha(a.subDomain);a.path&&this.uc.Ag(a.path);yo(this.uc);this.Lc=c.headers||{}}u(Co,J);t("H.service.Service",Co);function Do(a,b){a=a.Da();return b?ko({},a,b):a}
Co.prototype.Da=function(){return{}};Co.prototype.j=function(){return this.uc};Co.prototype.getUrl=Co.prototype.j;Co.prototype.s=function(a,b,c,d){d=new Tg(void 0===d?"application/json":d,a.toString(),Ud,{headers:this.Lc});d.then(b,Eo(this,a,c));return d};function Eo(a,b,c){return function(d){return"function"!==typeof d.json?Promise.reject(c(Fo(b,d))):d.json().then(function(e){return c(a.od(e))},function(){return c(Fo(b,d))})}}Co.prototype.od=function(a){return Error(a.message)};
function Fo(a,b){return Error((b.statusText?"["+b.statusText+"] ":"")+a+" request failed")};function Bo(a){a=void 0===a?{}:a;Bo.g.constructor.call(this,Bo,a);this.yi={Nn:a.resource||"base",zn:a.projection||"mc",format:a.format||"png8"};this.Bn=a.queryParams||{}}u(Bo,Co);t("H.service.rasterTile.Service",Bo);m=Bo.prototype;m.L=function(){return this.Bn.style||"explore.day"};m.Lf=function(a,b,c){return this.j().clone().A(this.yi.Nn+"/"+(this.yi.zn+"/")+(c+"/"+a+"/"+b+"/")+this.yi.format).B(this.Bn)};m.Da=function(){return{subDomain:"maps",path:"v3"}};
m.V=function(){this.ec||this.Df();return this.ec};m.Df=function(){this.ec=new no;this.s(this.j().clone().A("copyright"),A(this.el,this),Xe)};m.el=function(a){var b=a.copyrights;a=a.resources;var c={},d=this.yi.Nn+"."+this.L();c[d]=[];a[this.yi.Nn].styles[this.L()].forEach(function(e){b[e].forEach(function(f){var g=[];f.boundingBoxes.forEach(function(h){g.push([h.north,h.west,h.south,h.east])});c[d].push({boxes:g,label:f.label,alt:f.alt,minLevel:f.minLevel,maxLevel:f.maxLevel})})});oo(this.ec,c)};
m.Dj=function(a,b){return this.s(this.j().clone().A("info"),a,b)};Bo.prototype.getInfo=Bo.prototype.Dj;Bo.prototype.Fj=function(a,b){return this.s(this.j().clone().A("politicalViews"),a,b)};Bo.prototype.getPoliticalViews=Bo.prototype.Fj;Bo.prototype.Ez=function(a,b){return this.s(this.j().clone().A("features"),a,b)};Bo.prototype.getFeatures=Bo.prototype.Ez;Bo.prototype.Ep=function(a,b){return this.s(this.j().clone().A("languages"),a,b)};Bo.prototype.getLanguages=Bo.prototype.Ep;Bo.CONFIG_KEY="rasterTile";
W.prototype.Mp=function(a){return this.Ua(Bo,a)};W.prototype.getRasterTileService=W.prototype.Mp;W.prototype.Pl=function(a,b,c,d,e,f){function g(ta,nb,zd){nb=ta.km(nb);nb=r?new Zg(nb):new H.map.render.harp.Style(nb);var rc={engineType:l};p&&p.politicalView&&(rc.politicalView=p.politicalView);c&&(rc.lg=c);d&&(rc.lg2=d);f&&(rc.pois=f);var bb;zd&&(bb={dark:zd});return ta.kd(nb,rc,bb)}function h(ta,nb,zd,rc,bb){return ta.Md(nb,zd,v,rc,w,1,bb,n)}var k=this,l=oh,n={crossOrigin:"anonymous"};if(ya(a)){var p=a;"crossOrigin"in p&&(n.crossOrigin=p.crossOrigin);a=p.tileSize;b=p.ppi;c=p.lg;d=p.lg2;e=p.style;
f=p.pois;void 0!==p.engineType&&(l=p.engineType,n.engineType=l)}var q=l===ph.HARP,r=l===ph.WEBGL,v=a||512,w={};if(0>[72,250,320,500].indexOf(+b)){if(b!==B)throw new D(this.Pl,1,b);}else w.ppi=+b;c&&(w.lg=c);d&&(w.lg2=d);e&&(w.style=e);f&&(w.pois=!!f);if(q&&!H.map.render.harp)throw new D(this.Pl,0,"HARP engine is not supported, module not found");a={};if(Wm)ko(a,{vector:{normal:{map:g(this.wh(),"harp/oslo/normal.day.json")}}});else{e=this.Gp();var y=this.Gp({type:"aerial"}),I=this.Op(),G=I.rt(w.lg?
{lg:w.lg,i18n:!0,engineType:l}:{engineType:l});ko(a,{raster:{normal:{xbase:h(e,"xbasetile","normal.day","png8",!1),xbasenight:h(e,"xbasetile","normal.night","png8",!0),base:h(e,"basetile","normal.day","png8",!1),basenight:h(e,"basetile","normal.night","png8",!0),map:h(e,"maptile","normal.day","png8",!1),mapnight:h(e,"maptile","normal.night","png8",!0),trafficincidents:G,transit:h(e,"maptile","normal.day.transit","png8",!1),labels:h(e,"labeltile","normal.day","png",!1)},satellite:{xbase:h(y,"xbasetile",
"hybrid.day","jpg",!0),base:h(y,"basetile","hybrid.day","jpg",!0),map:h(y,"maptile","hybrid.day","jpg",!0),labels:h(y,"labeltile","hybrid.day","png",!0)},terrain:{xbase:h(y,"xbasetile","terrain.day","jpg",!1),base:h(y,"basetile","terrain.day","jpg",!1),map:h(y,"maptile","terrain.day","jpg",!1),labels:h(y,"labeltile","terrain.day","png",!1)}}});if(q||r){ko(a,{vector:{normal:{traffic:I.qt(void 0,l),trafficincidents:G}}});y=this.wh();e=this.Pp();I=this.wh({queryParams:{content:"default,advanced_roads"}});
G=this.wh({queryParams:{content:"default,hillshade,contours"}});if(r)a.vector.normal.map=g(y,"omv/miami/normal.day.yaml"),a.vector.normal.truck=g(y,"omv/miami/truck.day.yaml");else if(q){a.vector.normal.map=g(y,"harp/oslo/normal.day.json");a.vector.normal.truck=g(y,"harp/oslo/normal.day.json");a.vector.normal.logistics=g(I,"harp/oslo/logistics.day.json");a.vector.normal.logisticsnight=g(I,"harp/oslo/logistics.night.json");G=g(G,"harp/oslo/topo.day.json");G.D.L().setEnabledFeatures([{feature:"terrain",
mode:"hillshading"}]);a.vector.normal.topo=G;var S={ppi:72<b?400:100,size:256<v?512:256,features:"pois:"+(!0===f||jb(f)&&/[^0]/.test(f)?"all":"disabled")};c&&(S.lang=c);d&&(S.lang2=d);p&&p.politicalView&&(S.pview=p.politicalView);b={dark:!0};G=function(ta,nb,zd,rc,bb){var Ke=ko({},S);/^explore\./.test(zd)||delete Ke.features;ta=k.Mp({format:nb,resource:ta,queryParams:ko({style:zd},Ke)});bb=new Ao(ta,{engineType:l,style:bb});return new ej(bb,rc)};ko(a.raster.normal,{base:G("background","png8","explore.day"),
basenight:G("background","png8","explore.night",b),map:G("base","png8","explore.day"),mapnight:G("base","png8","explore.night",b),labels:G("label","png","explore.day")});ko(a.raster.satellite,{xbase:G("background","jpeg","satellite.day",b),base:G("background","jpeg","explore.satellite.day",b),map:G("base","jpeg","explore.satellite.day",b),labels:G("label","png","explore.satellite.day")});ko(a.vector.normal,{mapnight:g(y,"harp/oslo/normal.night.json",!0),lite:g(y,"harp/oslo/lite.day.json"),litenight:g(y,
"harp/oslo/lite.night.json",!0),ism:g(y,"harp/oslo/road.network.day.json"),ismnight:g(y,"harp/oslo/road.network.night.json",!0),roadnetwork:g(y,"harp/oslo/road.network.day.json"),roadnetworknight:g(y,"harp/oslo/road.network.night.json",!0)});for(var X={styles:[{technique:"raster",attr:{gamma:["interpolate",["linear"],["zoom"],0,1,13,1.2,17,1.3],brightness:["interpolate",["linear"],["zoom"],0,.7,13,.9,17,1]}}]},Ga=[],ha=0;6>ha;ha++){var mb=new H.map.render.harp.Style(JSON.parse(JSON.stringify(X)));
mb=G("background","jpeg","satellite.day",b,mb);Ga.push(mb)}a.hybrid={day:{raster:Ga[0],vector:g(y,"harp/oslo/hybrid.day.json",!0),traffic:g(e,"harp/oslo/hybrid.day.json",!0)},night:{raster:Ga[1],vector:g(y,"harp/oslo/hybrid.night.json",!0),traffic:g(e,"harp/oslo/hybrid.night.json",!0)},liteday:{raster:Ga[2],vector:g(y,"harp/oslo/lite.hybrid.day.json",!0),traffic:g(e,"harp/oslo/lite.hybrid.day.json",!0)},litenight:{raster:Ga[3],vector:g(y,"harp/oslo/lite.hybrid.night.json",!0),traffic:g(e,"harp/oslo/lite.hybrid.night.json",
!0)},logistics:{raster:Ga[4],vector:g(I,"harp/oslo/logistics.hybrid.day.json",!0),traffic:g(e,"harp/oslo/logistics.hybrid.day.json",!0)},logisticsnight:{raster:Ga[5],vector:g(I,"harp/oslo/logistics.hybrid.night.json",!0),traffic:g(e,"harp/oslo/logistics.hybrid.night.json",!0)}}}y={traffic:{}};y.traffic.map=g(e,r?"traffic/vector.tile.yaml":"harp/oslo/normal.day.json");q&&(y.traffic.logistics=g(e,"harp/oslo/logistics.day.json"),y.traffic.logisticsnight=g(e,"harp/oslo/logistics.night.json"),y.traffic.mapnight=
g(e,"harp/oslo/normal.night.json"),y.traffic.lite=g(e,"harp/oslo/lite.day.json"),y.traffic.litenight=g(e,"harp/oslo/lite.night.json"));ko(a.vector,y)}}return a};W.prototype.createDefaultLayers=W.prototype.Pl;function Go(a){lo(Go,"Use HERE Geocoding and Search API v7 instead.");Go.g.constructor.call(this,Go,a)}u(Go,Co);t("H.service.PlacesService",Go);Go.prototype.Da=function(){return{subDomain:"places.ls",path:"places/v1"}};Go.CONFIG_KEY="places";Go.EntryPoint={SEARCH:"discover/search",SUGGEST:"suggest",EXPLORE:"discover/explore",AROUND:"discover/around",HERE:"discover/here",CATEGORIES:"categories/places"};Go.prototype.request=function(a,b,c,d){return this.K(a,b,c,d)};Go.prototype.request=Go.prototype.request;
Go.prototype.K=function(a,b,c,d){a=this.j().clone().A(a).B(b||{});return this.s(a,c,d)};Go.prototype.search=function(a,b,c){return this.K("discover/search",a,b,c)};Go.prototype.search=Go.prototype.search;Go.prototype.fD=function(a,b,c){return this.K("suggest",a,b,c)};Go.prototype.suggest=Go.prototype.fD;Go.prototype.Uy=function(a,b,c){return this.K("discover/explore",a,b,c)};Go.prototype.explore=Go.prototype.Uy;Go.prototype.cy=function(a,b,c){return this.K("discover/around",a,b,c)};
Go.prototype.around=Go.prototype.cy;Go.prototype.JA=function(a,b,c){return this.K("discover/here",a,b,c)};Go.prototype.here=Go.prototype.JA;Go.prototype.oy=function(a,b,c){return this.K("categories/places",a,b,c)};Go.prototype.categories=Go.prototype.oy;Go.prototype.Xy=function(a,b,c,d){a=so(a).B(this.j().getQuery()).B(d||{});return this.s(a,b,c)};Go.prototype.follow=Go.prototype.Xy;W.prototype.dA=function(a){return this.Ua(Go,a)};W.prototype.getPlacesService=W.prototype.dA;var Ho="A21 A22 F01 F02 F08 F04 F05 F07 F03 F06 A2F F13 A25 A2C F12 D1B F1B A27 E12 A3A A24 A3D A3F F1F F25 F2C E32 A33 F29 D26 D36 F26 D0F F0F F2B E0C D3A A45 D23 D11 F2E F19 F14 F39 A4A A4B A5C D38 F2A F1A D0A F1C A48 D25 D1D F32 A46 A3E D24 E1C E32 A5F D2E D22 D0A".split(" ");function Io(a,b,c,d){Io.g.constructor.call(this,{min:10,max:21,engineType:d});C(a,Jo,Io,0);this.aa=a;this.Ga=c||Ko;this.Ga.responseattributes="sh,fc";this.tr=setInterval(A(this.reload,this),b||18E4);this.vb===ph.WEBGL?this.Ya(new Zg(a.km("traffic/flow.yaml")),!0):this.Ya(new H.map.render.harp.Style({styles:[{when:["==",["geometry-type"],"LineString"],technique:"solid-line",renderOrder:10002,attr:{color:["case",[">=",["get","JF"],10],"black",[">=",["get","JF"],8],"red",[">=",["get","JF"],4],"yellow",
"green"],lineWidth:3,metricUnit:"Pixel"}}]}))}u(Io,R);t("H.service.traffic.flow.Provider",Io);Io.prototype.lr=Ve;Io.prototype.providesGeoJSON=Io.prototype.lr;Io.prototype.L=function(){return this.nb()};Io.prototype.getStyle=Io.prototype.L;Io.prototype.Bb=function(a){a.Yb&&a.Yb("GeoJSONTileSource");this.Ya(a)};Io.prototype.setStyle=Io.prototype.Bb;var Ko={locationreferences:"tmc,shp"};Io.prototype.i=function(){Io.g.i.call(this);clearInterval(this.tr)};
Io.prototype.s=function(a,b,c,d,e){return this.aa.requestFlowByTile(a,b,c,function(f){f.type&&-1!==f.type.indexOf("Error")?e(f.Details):d(f)},e,this.Ga)};Io.prototype.requestInternal=Io.prototype.s;
Io.prototype.ld=function(a,b,c,d,e){var f,g,h,k,l={type:"FeatureCollection",features:[]},n;var p=d.RWS.length;for(f=0;f<p;f++){var q=d.RWS[f];var r=q.RW;var v=r.length;var w=-1!==Ho.indexOf(q.EXTENDED_COUNTRY_CODE+q.EBU_COUNTRY_CODE);for(q=0;q<v;q++){var y=r[q].FIS;var I=y.length;for(y=0;y<I;y++){var G=r[q].FIS[y].FI;var S=G.length;for(g=0;g<S;g++){var X=G[g];var Ga=[];var ha=X.CF[0];var mb=!!ha.SSS;var ta={type:"Feature",properties:ha,geometry:{type:"MultiLineString",coordinates:Ga}};ta.properties.LHT=
w;X.SHP.length&&(ta.properties.FC=X.SHP[0].FC);mb&&(n=[]);for(ha=0;ha<X.SHP.length;ha++){var nb=X.SHP[ha].value;var zd=nb.length;for(h=0;h<zd;h++){var rc=mb?n:void 0,bb=new Oa(nb[h].trim()),Ke=[],pd={};for(bb.ui();-1!==(k=bb.fb());)k===Lo?(pd.lat=+String.fromCharCode.apply(Io,bb.ih()),bb.next(),bb.ui()):k===Mo?(pd.lng=+String.fromCharCode.apply(Io,bb.ih()),Ke.push([pd.lng,pd.lat]),rc&&rc.push(sc(pd)),pd=[],bb.next(),bb.ui()):bb.next();pd.lng=+String.fromCharCode.apply(Io,bb.ih());Ke.push([pd.lng,
pd.lat]);rc&&rc.push(sc(pd));k=Ke;Ga.push(k)}}l.features.push(ta)}}}}return Io.g.ld.call(this,a,b,c,l,e)};Io.prototype.createTileInternal=Io.prototype.ld;var Mo=32,Lo=44;function No(){this.sd={}}No.prototype.kc=function(a,b){var c=a+b,d;if(d=this.sd[c])return d;a=Oo.MARKER.replace("{{icon}}",Po[a]||Po.OTHER);a=a.replace("{{color}}",Qo[b]||Qo.BLOCKING);b={size:{w:26,h:33},anchor:{x:13,y:30},hitArea:new Ph(Qh.POLYGON,Ro.MARKER)};return this.sd[c]=d=new Sh(a,b)};
var Oo={MARKER:'<svg width="26" height="33" enable-background="new 0 0 26 33" viewBox="0 0 26 33" xmlns="http://www.w3.org/2000/svg"><path d="m26 33h-26v-33h26z" fill="#8c8c8c" opacity="0"/><path d="m17 29.566c0 1.116-1.791 2.022-4 2.022s-4-.906-4-2.022c0-1.118 1.791-2.026 4-2.026s4 .908 4 2.026" fill="#878787" opacity=".6"/><path d="m1.795 17.971c-1.562-1.555-1.574-3.828-.028-5.655l8.343-10.021c.769-.895 1.795-1.384 2.894-1.384 1.117 0 2.197.521 2.889 1.394l8.338 10.014c1.588 1.854 1.578 4.022-.029 5.65l-11.202 11.202z" fill="{{color}}"/>{{icon}}</svg>'},Po=
{CONGESTION:'<path style="fill:#FFFFFF;" d="M12.966,1.177c0.965,0,1.894,0.442,2.496,1.204l8.378,10.258c1.362,1.592,1.482,3.477,0,4.979L12.994,28.464L2.143,17.618c-1.381-1.375-1.38-3.348,0-4.979l8.314-10.258C11.174,1.547,12.085,1.177,12.966,1.177 M12.967,0.177L12.967,0.177c-1.247,0-2.408,0.551-3.269,1.552l-8.332,10.28c-1.711,2.022-1.688,4.567,0.07,6.317l10.85,10.845l0.707,0.707l0.707-0.707l10.847-10.846c1.784-1.807,1.803-4.292,0.053-6.337L16.237,1.748C15.462,0.769,14.236,0.177,12.967,0.177L12.967,0.177z M16.645,10.405l-2.025-2.22c-0.48-0.51-1.15-0.8-1.84-0.8H9.53c-0.69,0-1.36,0.29-1.84,0.8l-1.94,2.22c-0.39,0.63-0.59,1.35-0.59,2.09v1.64c0,0.69,0.56,1.25,1.25,1.25h1.44l0.255-0.539c0.204-0.431,0.456-0.837,0.753-1.21l0.962-1.211l0.83-0.9c0.32-0.35,0.72-0.63,1.15-0.82H8.23c-0.28,0-0.55-0.07-0.79-0.22l-0.28-0.17l1.27-1.45c0.28-0.31,0.68-0.48,1.1-0.48h3.25c0.42,0,0.82,0.17,1.1,0.48l1.354,1.54H16.645z M18.31,12.205c-0.35-0.37-0.81-0.63-1.3-0.74c-0.18-0.04-0.36-0.06-0.54-0.06h-3.24c-0.7,0-1.37,0.29-1.84,0.8l-1.13,1.22l-0.82,1c-0.38,0.63-0.59,1.35-0.59,2.09v1.64c0,0.69,0.56,1.25,1.25,1.25h1.75v-1h5.99v1h1.75c0.69,0,1.25-0.56,1.25-1.25v-1.64c0-0.74-0.2-1.46-0.59-2.09L18.31,12.205z M12.1,17.105h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C12.35,16.993,12.238,17.105,12.1,17.105z M18.59,17.105h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C18.84,16.993,18.728,17.105,18.59,17.105z M18.56,14.505c-0.24,0.15-0.51,0.22-0.79,0.22h-5.85c-0.28,0-0.55-0.07-0.78-0.22l-0.29-0.17l1.27-1.45c0.15-0.16,0.33-0.28,0.53-0.37c0.18-0.07,0.38-0.11,0.58-0.11h3.24c0.24,0,0.48,0.06,0.68,0.16c0.16,0.08,0.3,0.19,0.42,0.32l1.27,1.45L18.56,14.505z M8.42,13.03h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C8.67,12.918,8.559,13.03,8.42,13.03z"/>',
ROADWORKS:'<path d="m13.004 1.411c.964 0 1.894.441 2.496 1.204l8.346 10.023c1.363 1.592 1.482 3.477 0 4.979l-10.846 10.847-10.852-10.846c-1.381-1.375-1.379-3.348 0-4.979l8.346-10.023c.717-.835 1.628-1.205 2.51-1.205m0-1c-1.248 0-2.408.551-3.268 1.552l-8.356 10.035c-1.718 2.033-1.695 4.578.064 6.328l10.85 10.845.706.707.707-.707 10.846-10.846c1.784-1.808 1.803-4.293.053-6.337l-8.337-10.012c-.769-.973-1.996-1.565-3.265-1.565zm-.575 15.264c.018-.332-.13-.651-.394-.851l-2.945-2.235-.21.36c-.22.39-.41.78-.58 1.19l-.677 2.129-1.364 3.051h1.314l2.109-4.672 1.317 1.212.138 3.46h1.092zm6.16-1.327c-.401-.54-1.209-.539-1.609.001l-1.17 1.58-2.29-1.74-.139-4.054c-.011-.276-.134-.535-.342-.716l-.7-.61c-.185-.161-.422-.25-.667-.25h-1.885c-.335 0-.648.168-.833.447l-1.144 1.723 7.58 5.76-1.86 2.51c-.098.132-.004.32.161.32h6.648l1.142-1.077zm-8.79-2.989-.876-.665.841-1.018.965.043zm1.63 1.24.969-1.781.118 2.61zm2.76-5.79c-.64 0-1.16.52-1.16 1.16 0 .65.52 1.17 1.16 1.17s1.16-.52 1.16-1.17c0-.64-.52-1.16-1.16-1.16z" fill="#fff"/>',
ACCIDENT:'<path style="fill:#FFFFFF;" d="M12.998,1.091c0.964,0,1.894,0.442,2.496,1.204l8.346,10.344c1.363,1.592,1.482,3.477,0,4.979L12.994,28.465L2.143,17.618c-1.381-1.375-1.379-3.348,0-4.979l8.346-10.344C11.205,1.462,12.115,1.091,12.998,1.091 M12.998,0.091L12.998,0.091c-1.248,0-2.408,0.551-3.269,1.552L1.364,12.011c-1.708,2.021-1.685,4.566,0.073,6.316l10.85,10.845l0.707,0.707l0.707-0.707l10.846-10.846c1.784-1.808,1.803-4.293,0.053-6.337l-8.327-10.32C15.494,0.684,14.268,0.091,12.998,0.091L12.998,0.091z M7.83,18.982l-3.309-1.855l0.945,1.855H7.83z M16.111,19h3.942l1.596-2L16.111,19z M10.512,20.064l1.021-1.021l1.632,0.076c0.329,0.018,0.651-0.022,0.963-0.123c0.626-0.206,1.122-0.76,1.288-1.44l0.264-1.089l2.066-0.93c0.373-0.17,0.673-0.42,0.861-0.731c0.275-0.449,0.405-0.97,0.369-1.498L18.9,11.676l1.021-1.021l-0.724-0.724l-0.427,0.427l-0.121-0.364c-0.201-0.603-0.54-1.151-0.989-1.6l-1.159-1.159c-0.5-0.5-1.31-0.5-1.809,0l-1.267,1.267l0.724,0.724l-5.066,5.066l-0.724-0.724l-1.267,1.267c-0.5,0.5-0.5,1.31,0,1.809l1.159,1.159c0.449,0.449,0.997,0.788,1.6,0.989l0.364,0.121l-0.427,0.427L10.512,20.064z M14.901,10.349l0.732-0.732c0.098-0.098,0.256-0.098,0.354,0l0.732,0.732c0.098,0.098,0.098,0.256,0,0.354l-0.732,0.732c-0.098,0.098-0.256,0.098-0.354,0l-0.732-0.732C14.803,10.604,14.803,10.446,14.901,10.349z M9.472,15.777l0.732-0.732c0.098-0.098,0.256-0.098,0.354,0l0.732,0.732c0.098,0.098,0.098,0.256,0,0.354l-0.732,0.732c-0.098,0.098-0.256,0.098-0.354,0L9.472,16.13C9.375,16.033,9.375,15.874,9.472,15.777z M11.391,17.615c0.069-0.271,0.206-0.518,0.405-0.717l4.961-4.961c0.195-0.195,0.445-0.337,0.717-0.405l0.344-0.083l0.137,1.925c0.022,0.318-0.058,0.63-0.221,0.901c-0.101,0.166-0.279,0.271-0.409,0.329L14.8,15.74l-0.38,1.574c-0.083,0.344-0.318,0.615-0.612,0.713c-0.188,0.058-0.38,0.083-0.579,0.072l-1.925-0.138L11.391,17.615z"/>',
OTHER:'<path style="fill:#FFFFFF;" d="M13.004,1.411c0.964,0,1.894,0.441,2.496,1.204l8.346,10.023c1.363,1.592,1.482,3.477,0,4.979L13,28.465L2.148,17.618c-1.381-1.375-1.379-3.348,0-4.979l8.346-10.023C11.211,1.781,12.122,1.411,13.004,1.411 M13.004,0.411L13.004,0.411c-1.248,0-2.408,0.551-3.268,1.552L1.38,11.998c-1.718,2.033-1.694,4.579,0.064,6.328l10.85,10.845L13,29.878l0.707-0.707l10.846-10.846c1.784-1.808,1.803-4.293,0.053-6.337L16.269,1.976C15.5,1.003,14.273,0.411,13.004,0.411L13.004,0.411z M14.716,20.139c0,0.947-0.758,1.724-1.724,1.724c-0.947,0-1.704-0.777-1.704-1.724c0-0.928,0.757-1.704,1.704-1.704C13.958,18.435,14.716,19.211,14.716,20.139z M14.204,16.33H11.78l-0.537-8.533h3.5L14.204,16.33z"/>'},
Qo={BLOCKING:"#323232",VERYHIGH:"#d5232f",HIGH:"#ffa100"},Ro={MARKER:[24.1,17.8,14.2,28.42,16.8,29.4,12.8,31.4,8.79,29.4,11.23,28.42,1.7,17.8,1.7,12.1,10,1.9,12.9,.498,15.8,1.9,24.1,12.1,24.1,17.8]};function So(a){if(!a||!ab(a.requestData))throw new D(So,0,"options.requestData");So.g.constructor.call(this,a);this.vC=a.requestData;this.lC=!!a.providesDomMarkers}u(So,R);t("H.map.provider.MarkerTileProvider",So);So.prototype.s=function(a,b,c,d,e){var f=this;return this.vC(a,b,c,function(g){for(var h=[],k,l,n=g.length;n--;)l=g[n],l.hD=f.getTileKey(a,b,c),l.fa(f),k=l.kc(),(C(l,Ti)||1===k.getState())&&h.push(g[n]);d(h)},e)};So.prototype.requestInternal=So.prototype.s;
So.prototype.Dh=function(a,b){b===Ih.VISUAL&&(a=this.Rb().get(a.hD))&&(a.valid=!1,this.kb(a))};So.prototype.invalidateObject=So.prototype.Dh;So.prototype.Rc=function(){return this.lC};So.prototype.providesDomMarkers=So.prototype.Rc;So.prototype.Sc=Ve;So.prototype.providesMarkers=So.prototype.Sc;function To(a,b,c){c=c?c:{};c.criticality||(c.criticality="major,critical");C(a,Jo,To,0);So.call(this,{max:20,min:8,requestData:A(this.zC,this),engineType:c.engineType});this.sd=new No;this.aa=a;this.Ga=c;this.reload=A(this.reload,this);this.tr=setInterval(this.reload,b||18E4)}u(To,So);t("H.service.traffic.incidents.Provider",To);var Uo={minor:"HIGH","low impact":"HIGH",major:"VERYHIGH",critical:"BLOCKING"};
To.prototype.zC=function(a,b,c,d,e){var f=this,g=this.sd;return this.aa.requestIncidentsByTile(a,b,c,function(h){var k=[];h=h.TRAFFIC_ITEMS;var l;if(h)for(h=h.TRAFFIC_ITEM,l=h.length;l--;){var n=h[l];var p=n.TRAFFIC_ITEM_TYPE_DESC;switch(p){case "ACCIDENT":case "CONGESTION":var q=p;break;case "CONSTRUCTION":q="ROADWORKS";break;default:q="OTHER"}q=g.kc(q,Uo[n.CRITICALITY.DESCRIPTION]);p=n.LOCATION.GEOLOC.ORIGIN;p=new ci({lat:p.LATITUDE,lng:p.LONGITUDE},{provider:f,icon:q});p.setData(n);k.push(p)}d(k)},
e,this.Ga)};To.prototype.u=function(){So.prototype.u.call(this);clearInterval(this.tr)};To.prototype.dispose=To.prototype.u;function Vo(a){Vo.g.constructor.call(this,Vo,a)}u(Vo,Co);t("H.service.traffic.Service7",Vo);Vo.prototype.Da=function(){return{subDomain:"data.traffic",path:"v7"}};Vo.CONFIG_KEY="traffic_v7";Vo.prototype.yC=function(a,b,c,d){a=this.j().clone().A(["incidents",a].join("/")).B(b||{});return this.s(a,c,d)};Vo.prototype.requestIncidentById=Vo.prototype.yC;Vo.prototype.wC=function(a,b,c){a=this.j().clone().A("flow").B(a||{});return this.s(a,b,c)};Vo.prototype.requestFlowByArea=Vo.prototype.wC;
Vo.prototype.BC=function(a,b,c){a=this.j().clone().A("incidents").B(a||{});return this.s(a,b,c)};Vo.prototype.requestIncidentsByArea=Vo.prototype.BC;function Wo(a){function b(n){d.contains(e)&&d.removeChild(e);l&&clearTimeout(l);delete Wo.wr[f];n&&a.Kt&&a.Kt.call(k,n)}if(!a.url||!a.Jo)throw Error('Parameter "options" must specify at least a URL and a callback.');if("function"!==typeof a.Jo)throw Error("Parameters options.callback must be a function");var c=a.ND||document;var d=c.getElementsByTagName("head")[0];var e=c.createElement("script");c=a.url instanceof V?a.url:so(a.url,a.LD);var f=Wo.GC++;var g=a.ly||"callback";var h=a.Jo;var k={};var l=
null;k.id=f;k.cancel=function(){b("cancelled")};0!==a.timeout&&(l=x.setTimeout(function(){b("timeout")},a.timeout||3E4));Wo.wr[f]=function(n){b();h.call(k,n)};e.type="text/javascript";e.src=c.toString()+(c.xu()?"&":"?")+g+"="+(a.OD?"H.service.jsonp.handleResponse("+f+")":encodeURI("H.service.jsonp.handleResponse("+f+")"));d.appendChild(e);return k}t("H.service.jsonp",Wo);Wo.HA=function(a){return(a=Wo.wr[a])?a:function(){}};Wo.handleResponse=Wo.HA;Wo.GC=0;Wo.wr={};function Jo(a){Jo.g.constructor.call(this,Jo,a);this.my=Do(this,a).callbackKey;this.Te=!1}u(Jo,Co);t("H.service.traffic.Service",Jo);Jo.prototype.Da=function(){return{subDomain:"traffic.ls",path:"traffic/6.1",callbackKey:"jsoncallback"}};Jo.CONFIG_KEY="traffic";Jo.prototype.qt=function(a,b){return new ej(new Io(this,void 0,a,b),{max:22})};Jo.prototype.createFlowLayer=Jo.prototype.qt;Jo.prototype.rt=function(a){return new Dh(new To(this,void 0,a))};Jo.prototype.createIncidentsLayer=Jo.prototype.rt;
function Xo(a,b,c,d){a.Te||(lo(Jo,"Use HERE Traffic API v7 instead."),a.Te=!0);return Wo({url:b,Jo:c,Kt:function(e){d(Error("["+e+"] "+b+" request failed"))},ly:a.my})}Jo.prototype.AC=function(a,b,c){a=this.j().clone().A("incidents.json").B(a);return Xo(this,a,b,c)};Jo.prototype.requestIncidents=Jo.prototype.AC;Jo.prototype.xC=function(a,b,c,d,e,f){a=this.j().clone().A(["flow/json",c,a,b].join("/")).B(f||{});return Xo(this,a,d,e)};Jo.prototype.requestFlowByTile=Jo.prototype.xC;
Jo.prototype.CC=function(a,b,c,d,e,f){a=this.j().clone().A(["incidents/json",c,a,b].join("/")).B(f||{});return Xo(this,a,d,e)};Jo.prototype.requestIncidentsByTile=Jo.prototype.CC;Jo.prototype.km=function(a){return mn()+"/"+a};W.prototype.Op=function(a,b){b=b||6;if(6===b)b=Jo;else if(7===b)b=Vo;else throw new D(this.Op,1,"allowed values are 6 and 7");return this.Ua(b,a)};W.prototype.getTrafficService=W.prototype.Op;function Yo(a){Yo.g.constructor.call(this,Yo,a);lo(Yo,"Use HERE Routing API v8 instead.")}u(Yo,Co);t("H.service.RoutingService",Yo);Yo.prototype.Da=function(){return{subDomain:"route.ls",path:"routing/7.2"}};Yo.prototype.od=function(a){return Error(a.details)};Yo.CONFIG_KEY="routing";Yo.prototype.Tg=function(a,b,c){a=this.j().clone().A("calculateroute.json").B(a);return this.s(a,b,c)};Yo.prototype.calculateRoute=Yo.prototype.Tg;
Yo.prototype.Ho=function(a,b,c){a=this.j().clone().Ha("isoline").A("calculateisoline.json").B(a);return this.s(a,b,c)};Yo.prototype.calculateIsoline=Yo.prototype.Ho;function Zo(a){Zo.g.constructor.call(this,Zo,a)}u(Zo,Co);t("H.service.RoutingService8",Zo);Zo.CONFIG_KEY="routing_v8";Zo.prototype.Da=function(){return{subDomain:"router",path:"v8/routes"}};Zo.prototype.od=function(a){return Error(401===(a&&void 0===a.status?401:a.status)?a.error_description:a.title,{cause:a})};Zo.prototype.Tg=function(a,b,c){a=this.j().clone().B(a);return this.s(a,b,c)};Zo.prototype.calculateRoute=Zo.prototype.Tg;
Zo.prototype.Ho=function(a,b,c){a=this.j().clone().Ha("isoline").Ag("v8/isolines").B(a);return this.s(a,b,c)};Zo.prototype.calculateIsoline=Zo.prototype.Ho;W.prototype.nu=function(a,b){b=Wm?8:+b||7;if(7===b)b=Yo;else if(8===b)b=Zo;else throw new D(this.nu,1,"allowed values are 7 and 8");return this.Ua(b,a)};W.prototype.getRoutingService=W.prototype.nu;function $o(a){$o.g.constructor.call(this,$o,a);this.pu=a.getToken}u($o,Co);t("H.service.iml.Service",$o);$o.prototype.Da=function(){return{host:"interactive.data.api.platform.here.com",path:"interactive/v1/catalogs"}};
$o.prototype.od=function(a){function b(){for(var d=ea(c),e=d.next();!e.done;e=d.next()){e=e.value;var f=e.format;if(e.keys.every(function(g){return a[g]}))return f()}return JSON.stringify(a)}var c=[{keys:["code","title","cause","action"],format:function(){return a.code+": "+a.title+"; cause: "+a.cause+"; action: "+a.action}},{keys:["error","error_description"],format:function(){return a.error+": "+a.error_description}},{keys:["error","errorMessage"],format:function(){return a.error+": "+a.errorMessage}}];
return Error(ya(a)?b():a)};$o.prototype.zh=function(a,b,c,d,e){var f=this.zh;ap(f,0,a,b);bp(f,2,c,d);a=this.j().clone().A(a+"/layers/"+b+"/statistics").B(e||{});return this.K(a,"GET",c,d)};$o.prototype.getStatistics=$o.prototype.zh;$o.prototype.em=function(a,b,c,d,e,f,g,h,k){var l=k?"":".mvtf";a=this.j().clone().A(d+"/layers/"+e+"/tile/web/"+c+"_"+a+"_"+b+l).B(Object.assign({clip:!0},h));return this.K(a,"GET",k?f:function(n){return n.arrayBuffer().then(f)},g,void 0,k?"application/json":"arraybuffer")};
$o.prototype.getFeaturesByTile=$o.prototype.em;$o.prototype.du=function(a,b,c,d,e,f){var g=this.du;cp(g,a);ap(g,1,b,c);bp(g,3,d,e);a=dp(this,a,b,c,f);return this.K(a,"GET",d,e)};$o.prototype.getFeatureById=$o.prototype.du;$o.prototype.Pe=function(a,b,c,d,e,f){var g=this.Pe;ep(g,a);ap(g,1,b,c);bp(g,3,d,e);a=fp(this,a,b,c,f);return this.K(a,"GET",d,e)};$o.prototype.getFeaturesById=$o.prototype.Pe;
$o.prototype.rh=function(a,b,c,d,e){var f=this.rh;if(!ya(a)||!(a.bbox||a.north&&a.east&&a.south&&a.west))throw new D(f,0,'must be an object with either "bbox" or a full set of "north", "east", "south" and "west"');ap(f,1,b,c);bp(f,3,d,e);a=this.j().clone().A(b+"/layers/"+c+"/bbox").B(a);return this.K(a,"GET",d,e)};$o.prototype.getFeaturesByBoundingBox=$o.prototype.rh;
$o.prototype.fu=function(a,b,c,d,e){var f=this.fu;if(!(ya(a)&&a.radius&&(a.lat&&(a.lng||a.lon)||a.refCatalogHrn&&a.refLayerId&&a.refFeatureId)))throw new D(f,0,'must be an object with "radius" and a combination of either "lat"+"lng" or "refCatalogHrn"+"refLayerId"+"refFeatureId"');ap(f,1,b,c);bp(f,3,d,e);a=this.j().clone().A(b+"/layers/"+c+"/spatial").B(a);return this.K(a,"GET",d,e)};$o.prototype.getFeaturesByPointAndRadius=$o.prototype.fu;
$o.prototype.eu=function(a,b,c,d,e,f){var g=this.eu;if(!ya(a)||!a.radius)throw new D(g,0,'must be an object with "radius"');gp(g,1,b);ap(g,2,c,d);bp(g,4,e,f);a=this.j().clone().A(c+"/layers/"+d+"/spatial").B(a);return this.K(a,"POST",e,f,b)};$o.prototype.getFeaturesByGeometryAndRadius=$o.prototype.eu;$o.prototype.Ew=function(a,b,c,d,e){var f=this.Ew;ap(f,0,a,b);bp(f,2,c,d);a=this.j().clone().A(a+"/layers/"+b+"/search").B(e||{});return this.K(a,"GET",c,d)};$o.prototype.searchFeatures=$o.prototype.Ew;
$o.prototype.Tu=function(a,b,c,d,e){var f=this.Tu;ap(f,0,a,b);bp(f,2,c,d);a=this.j().clone().A(a+"/layers/"+b+"/iterate").B(e||{});return this.K(a,"GET",c,d)};$o.prototype.iterateFeatures=$o.prototype.Tu;$o.prototype.hf=function(a,b,c,d,e,f){var g=this.hf;gp(g,0,a);ap(g,1,b,c);bp(g,3,d,e);b=hp(this,b,c,f);return this.K(b,"PUT",d,e,a)};$o.prototype.putFeatures=$o.prototype.hf;
$o.prototype.ff=function(a,b,c,d,e,f){var g=this.ff;gp(g,0,a);ap(g,1,b,c);bp(g,3,d,e);b=hp(this,b,c,f);return this.K(b,"POST",d,e,a)};$o.prototype.postFeatures=$o.prototype.ff;$o.prototype.Bf=function(a,b,c,d,e){var f=this.Bf;ep(f,a);ap(f,1,b,c);bp(f,3,d,e);a=fp(this,a,b,c);return this.K(a,"DELETE",d,e)};$o.prototype.deleteFeatures=$o.prototype.Bf;$o.prototype.ow=function(a,b,c,d,e,f,g){var h=this.ow;cp(h,a);gp(h,1,b);ap(h,2,c,d);bp(h,4,e,f);a=dp(this,a,c,d,g);return this.K(a,"PUT",e,f,b)};
$o.prototype.putFeature=$o.prototype.ow;$o.prototype.Vv=function(a,b,c,d,e,f,g){var h=this.Vv;cp(h,a);gp(h,1,b);ap(h,2,c,d);bp(h,4,e,f);a=dp(this,a,c,d,g);return this.K(a,"PATCH",e,f,b)};$o.prototype.patchFeature=$o.prototype.Vv;$o.prototype.yt=function(a,b,c,d,e){var f=this.yt;cp(f,a);ap(f,1,b,c);bp(f,3,d,e);a=dp(this,a,b,c);return this.K(a,"DELETE",d,e,void 0,"text/plain")};$o.prototype.deleteFeature=$o.prototype.yt;
function hp(a,b,c,d){return a.j().clone().A(b+"/layers/"+c+"/features").B(d||{})}function fp(a,b,c,d,e){b=Object.assign({},e,{id:new wo(b)});return hp(a,c,d,b)}function dp(a,b,c,d,e){return a.j().clone().A(c+"/layers/"+d+"/features/"+b).B(e||{})}
$o.prototype.K=function(a,b,c,d,e,f){f=void 0===f?"application/json":f;b={method:b,headers:Object.assign({},e?{"Content-Type":"application/geo+json"}:void 0,"function"===typeof this.pu?{Authorization:"Bearer "+this.pu()}:void 0,this.Lc)};e&&(b.data=JSON.stringify(e));e=new Tg(f,a.toString(),Ud,b);e.then(c,Eo(this,a,d));return e};$o.CONFIG_KEY="iml";function ap(a,b,c,d){gb(c,"String",a,b,"must be a string");gb(d,"String",a,b+1,"must be a string")}
function cp(a,b){gb(b,"String",a,0,"must be a string")}function ep(a,b){if(!Array.isArray(b)||0===b.length||b.some(function(c){return"string"!==typeof c}))throw new D(a,0,"must be a non-empty array of strings");}function gp(a,b,c){if(!ya(c))throw new D(a,b,"must be a GeoJSON object");}function bp(a,b,c,d){if(!ab(c))throw new D(a,b,"must be a function");if(!ab(d))throw new D(a,b+1,"must be a function");}W.prototype.Kz=function(a){return this.Ua($o,a)};W.prototype.getIMLService=W.prototype.Kz;function ip(a,b,c,d){ip.g.constructor.call(this,d?{min:d.min,max:d.max,engineType:d.engineType}:void 0);C(a,$o,ip,0);if(!jb(b))throw new D(ip,1,'"catalogHrn" must be a string');if(!jb(c))throw new D(ip,2,'"layerId" must be a string');this.aa=a;this.Wg=b;this.Ih=c;this.Ek=ya(d)&&ya(d.parameters)?d.parameters:{};this.Ya(this.Ap())}u(ip,R);t("H.service.iml.Provider",ip);ip.prototype.s=function(a,b,c,d,e){return this.aa.em(a,b,c,this.Wg,this.Ih,d,e,this.Ek)};ip.prototype.requestInternal=ip.prototype.s;
ip.prototype.Tc=Ve;ip.prototype.providesOMV=ip.prototype.Tc;ip.prototype.L=function(){return this.nb()};ip.prototype.getStyle=ip.prototype.L;ip.prototype.Bb=function(a){C(a,Zg)&&a.Yb("MVT");this.Ya(a)};ip.prototype.setStyle=ip.prototype.Bb;
ip.prototype.Ap=function(){return this.vb===ph.WEBGL?new Zg({sources:{iml:{type:"MVT"}},layers:{iml:{data:{source:"iml",layer:this.Wg+":"+this.Ih},points:{filter:{$geometry:"point"},draw:{points:{collide:!1,order:200,color:"#92CF48",size:[[10,"8px"],[14,"12px"],[18,"16px"]]}}},polygons:{filter:{$geometry:"polygon"},draw:{polygons:{order:201,color:"#E39E3C"},lines:{order:202,color:"#755DA5",width:"1px"}}},lines:{filter:{$geometry:"line"},draw:{lines:{order:203,color:"#0258AE",width:"2px",join:"round",
cap:"round"}}}}}}):new H.map.render.harp.Style({styles:[{layer:this.Wg+":"+this.Ih,when:["==",["geometry-type"],"Point"],technique:"circles",renderOrder:200,color:"#92CF48",size:["interpolate",["linear"],["zoom"],10,8,14,12,18,16]},{layer:this.Wg+":"+this.Ih,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:"#E39E3C",renderOrder:201},{layer:this.Wg+":"+this.Ih,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#755DA5",lineWidth:"1px",renderOrder:202},{layer:this.Wg+
":"+this.Ih,when:["==",["geometry-type"],"LineString"],technique:"solid-line",color:"#0258AE",lineWidth:"2px",renderOrder:203}]})};function jp(a){jp.g.constructor.call(this,jp,a);this.Bw=Do(this,a).reverseSubDomain;lo(jp,"Use HERE Geocoding and Search API v7 instead.")}u(jp,Co);t("H.service.GeocodingService",jp);jp.prototype.Da=function(){return{subDomain:"geocoder.ls",reverseSubDomain:"reverse",path:"6.2"}};jp.CONFIG_KEY="geocoding";jp.prototype.od=function(a){return Error(a.Details||a.message||a.error)};jp.prototype.sp=function(a,b,c){a=this.j().clone().A("geocode.json").B(a);return this.s(a,b,c)};
jp.prototype.geocode=jp.prototype.sp;jp.prototype.Ar=function(a,b,c){a=this.j().clone().A("reversegeocode.json").B(a);this.Bw&&a.Ha(this.Bw);return this.s(a,b,c)};jp.prototype.reverseGeocode=jp.prototype.Ar;jp.prototype.search=function(a,b,c){a=this.j().clone().A("search.json").B(a);return this.s(a,b,c)};jp.prototype.search=jp.prototype.search;W.prototype.Fz=function(a){return this.Ua(jp,a)};W.prototype.getGeocodingService=W.prototype.Fz;function kp(a,b,c){var d=this,e=c||{},f=+e.min,g=+e.max;e.tileSize=e.tileSize||512;e.min=f?ec(f,1,17):1;e.min+=gj(e.tileSize,1);e.max=g?ec(g,1,17):17;kp.g.constructor.call(this,e);C(a,lp,kp,0);C(b,kg,kp,1);this.aa=a;b.Yb&&b.Yb("OMV");this.Ya(b,!0);this.tn=!1;c&&(c.politicalView&&(this.un=c.politicalView),mp(this,c.lg,c.lg2),this.tn=!!c.pois);this.qw=function(){d.xl=jo(d);d.reload(!1)};a.addEventListener("versionupdate",this.qw);this.xl=jo(this);kp.prototype.So=function(){var h=/^v2\/vectortiles\/(.+)\/mc$/.exec(a.j().df);
return h?h[1]:B+""}()}u(kp,R);t("H.service.omv.Provider",kp);kp.prototype.Tc=Ve;kp.prototype.providesOMV=kp.prototype.Tc;kp.prototype.cc=function(a){return this.xl.test(a)};kp.prototype.cacheFilter=kp.prototype.cc;kp.prototype.Sd=function(a,b,c){return this.aa.Lf(a,b,c).toString()};kp.prototype.getTileKey=kp.prototype.Sd;kp.prototype.Rb=function(){return this.FB};kp.prototype.getCache=kp.prototype.Rb;kp.prototype.gA=function(){return this.un};kp.prototype.getPoliticalView=kp.prototype.gA;
kp.prototype.PC=function(a){var b=this.un;this.un=a;this.dispatchEvent(new nh("politicalviewchange",this.un,b))};kp.prototype.setPoliticalView=kp.prototype.PC;kp.prototype.MAX_STORE_TIME=2592E6;kp.prototype.Ri=function(){return nl()};kp.prototype.qd=function(){return nl()?ml():kp.g.qd.call(this)};kp.prototype.s=function(a,b,c,d,e){return this.aa.Oa(a,b,c,d,e)};kp.prototype.requestInternal=kp.prototype.s;kp.prototype.Bb=function(a){a.Yb&&a.Yb("OMV");this.Ya(a)};kp.prototype.setStyle=kp.prototype.Bb;
kp.prototype.L=function(){return kp.g.nb.apply(this)};kp.prototype.getStyle=kp.prototype.L;kp.prototype.nb=function(){var a=kp.g.nb.apply(this),b=a.getState()===lg.READY,c=a.Pd();b&&c&&c.global&&(this.kq&&(this.fw&&(c.global.ux_language=this.fw),this.St&&(c.global.ux_language_fallback=this.St)),this.tn&&c.global.poi&&c.global.poi["default"]&&(c.global.poi["default"].visible=this.tn),this.kq||this.tn)&&(a=new Zg(c,a.Fc()));return a};kp.prototype.getStyleInternal=kp.prototype.nb;
function mp(a,b,c){var d=jb(b),e=jb(c);d&&(a.fw=b);e&&(a.St=c);if(d||e)a.Qj=[],d=/^([a-zA-Z]{2})(-|$)/,(e=d.exec(b))&&("zh"===e[1]?a.Qj.push(b):a.Qj.push(e[1])),(e=d.exec(c))&&("zh"===e[1]?a.Qj.push(c):a.Qj.push(e[1])),a.kq=!0}kp.prototype.kq=!1;var op=["en"];kp.prototype.Ep=function(){return this.Qj||op};kp.prototype.getLanguages=kp.prototype.Ep;kp.prototype.i=function(){kp.g.i.call(this);this.aa.removeEventListener("versionupdate",this.qw)};kp.prototype.FB=new ij(256);
kp.prototype.V=function(a,b){return this.aa.V().query(this.So,b,a)};kp.prototype.getCopyrights=kp.prototype.V;function lp(a){lp.g.constructor.call(this,lp,a);var b=Do(this,a).mapVersion;this.Bn=a.queryParams||{};this.Uj=db(b)?b:pp[this.j().toString()];db(this.Uj)||qp(this)}u(lp,Co);t("H.service.omv.Service",lp);lp.prototype.Da=function(){return{subDomain:"vector",path:"v2/vectortiles/base/mc"}};lp.CONFIG_KEY="omv";var pp={};rb(pp);lp.prototype.Vz=function(){return this.Uj};lp.prototype.getMapVersion=lp.prototype.Vz;
function qp(a){a.s(a.j().clone().A("../../info"),function(b){b=b.mapVersion;var c=a.j().toString();a.Uj=b;b!==pp[c]&&(pp[c]=b,a.dispatchEvent("versionupdate"))},function(){})}lp.prototype.kd=function(a,b,c){b=b||{};var d={min:0,max:22};ya(c)&&ko(d,c);Wm&&(b.min=d.min=4);return new ej(new kp(this,a,b),d)};lp.prototype.createLayer=lp.prototype.kd;lp.prototype.Oa=function(a,b,c,d,e){return this.s(this.Lf(a,b,c),function(f){return f.arrayBuffer().then(d,e)},e,"arraybuffer")};
lp.prototype.Lf=function(a,b,c){a=this.j().clone().A(c+"/"+a+"/"+b+"/omv");db(this.Uj)&&a.B({mv:this.Uj}).B(this.Bn);return a};lp.prototype.km=function(a){return mn()+"/"+a};lp.prototype.Fj=function(a,b){if(!ab(a))throw new D(this.Fj,0,'"onResult" must be a function');if(!ab(b))throw new D(this.Fj,1,'"onError" must be a function');return this.s(this.j().clone().Ag("v2/vectortiles/pviews"),a,b)};lp.prototype.getPoliticalViews=lp.prototype.Fj;W.prototype.wh=function(a){return this.Ua(lp,a)};
W.prototype.getOMVService=W.prototype.wh;lp.prototype.Df=function(){this.ec=new no;this.s(this.j().clone().A("../../copyrights"),A(this.el,this),Xe)};lp.prototype.el=function(a){oo(this.ec,a);this.dispatchEvent("copyrightupdate")};lp.prototype.V=function(){this.ec||this.Df();return this.ec};lp.prototype.getCopyrights=lp.prototype.V;function rp(a){this.js=!!a.toBypassToken;if(!this.js&&!a.token)throw new D(rp,0,'"token" must be specified');lo(rp,"Use HERE IML service instead.");rp.g.constructor.call(this,rp,a);this.ox=a.token;this.ot={};this.Nl={}}u(rp,Co);t("H.service.xyz.Service",rp);rp.prototype.Da=function(){return{host:"xyz.api.here.com",path:"hub/spaces"}};rp.prototype.od=function(a){return Error(a.errorMessage||a.message)};
rp.prototype.Jp=function(a,b,c){gb(a,"String",this.Jp,0,'"projectId" must be a string');sp(this.Jp,1,b,c);a=tp(this.j().clone().Ag("project-api/projects/"+a));return this.s(a,b,c)};rp.prototype.getProject=rp.prototype.Jp;rp.prototype.ou=function(a,b,c){sp(this.ou,0,a,b);c=up(this,this.j().clone().B(c||{}));return this.s(c,a,b)};rp.prototype.getSpaces=rp.prototype.ou;
rp.prototype.jm=function(a,b,c){gb(a,"String",this.jm,0,'"spaceId" must be a string');sp(this.jm,1,b,c);a=up(this,this.j().clone().A(a));return this.s(a,b,c)};rp.prototype.getSpace=rp.prototype.jm;rp.prototype.zh=function(a,b,c){gb(a,"String",this.zh,0,'"spaceId" must be a string');sp(this.zh,1,b,c);a=up(this,this.j().clone().A(a+"/statistics"));return this.s(a,b,c)};rp.prototype.getStatistics=rp.prototype.zh;
rp.prototype.em=function(a,b,c,d,e,f,g){a=up(this,this.j().clone().A(d+"/tile/web/"+c+"_"+a+"_"+b+".mvtf").B(Object.assign({clip:!0},g)));return this.s(a,function(h){return h.arrayBuffer().then(e)},f,"arraybuffer")};rp.prototype.search=function(a,b,c,d){gb(a,"String",this.search,0,'"spaceId" must be a string');sp(this.search,1,b,c);a=up(this,this.j().clone().A(a+"/search").B(d||{}));return this.s(a,b,c)};rp.prototype.search=rp.prototype.search;
rp.prototype.Pe=function(a,b,c,d){gb(a,"String",this.Pe,0,'"spaceId" must be a string');if(!ya(b))throw new D(this.Pe,1,'"params" must be an object');sp(this.Pe,2,c,d);a=up(this,this.j().clone().A(a+"/features").B(b));return this.s(a,c,d)};rp.prototype.getFeaturesById=rp.prototype.Pe;
rp.prototype.rh=function(a,b,c,d){gb(a,"String",this.rh,0,'"spaceId" must be a string');if(!ya(b))throw new D(this.Pe,1,'"params" must be an object');sp(this.rh,2,c,d);a=up(this,this.j().clone().A(a+"/bbox").B(b));return this.s(a,c,d)};rp.prototype.getFeaturesByBoundingBox=rp.prototype.rh;rp.prototype.V=function(a){var b=this.ot[a];if(b)return b;this.Nl[a]||this.Df(a);return null};
rp.prototype.hf=function(a,b,c,d,e){gb(a,"String",this.hf,0,'"spaceId" must be a string');if(!ya(b))throw new D(this.hf,1,'"geojsonObject" must be an object');sp(this.hf,2,c,d);if(e&&!ya(e))throw new D(this.hf,4,'"opt_params" must be an object');return vp(this,a,c,d,"PUT",b,e)};rp.prototype.putFeatures=rp.prototype.hf;
rp.prototype.ff=function(a,b,c,d,e){gb(a,"String",this.ff,0,'"spaceId" must be a string');if(!ya(b))throw new D(this.ff,1,'"featureCollection" must be an object');sp(this.ff,2,c,d);if(e&&!ya(e))throw new D(this.ff,4,'"opt_params" must be an object');return vp(this,a,c,d,"POST",b,e)};rp.prototype.postFeatures=rp.prototype.ff;
rp.prototype.Bf=function(a,b,c,d){gb(a,"String",this.Bf,0,'"spaceId" must be a string');if(!ya(b))throw new D(this.Bf,1,'"params" must be an object');sp(this.Bf,2,c,d);return vp(this,a,c,d,"DELETE",B,b)};rp.prototype.deleteFeatures=rp.prototype.Bf;
function vp(a,b,c,d,e,f,g){var h=Object.assign(a.js?{}:{authorization:"Bearer "+a.ox},{"Content-Type":"application/geo+json"},a.Lc);e={method:e,headers:h};f&&(e.data=JSON.stringify(f));b=tp(a.j().clone().A(b+"/features").B(g||{}));f=new Tg("application/json",b.toString(),Ud,e);f.then(c,Eo(a,b,d));return f}rp.prototype.Df=function(a){var b=this;this.Nl[a]=wp;this.jm(a,function(c){b.Nl[a]=xp;b.ot[a]=c.copyright;b.dispatchEvent("copyrightupdate")},function(c){b.Nl[a]=yp;throw c;})};
function up(a,b){return a.js?b:tp(b).B({access_token:a.ox})}function tp(a){var b=Object.assign({},a.getQuery());delete b.apikey;return a.Jk(b)}rp.CONFIG_KEY="xyz";var wp=1,xp=2,yp=-1;function sp(a,b,c,d){if(!ab(c))throw new D(a,b,'"onResult" must be a function');if(!ab(d))throw new D(a,b+1,'"onError" must be a function');}W.prototype.EA=function(a){return this.Ua(rp,a)};W.prototype.getXYZService=W.prototype.EA;function zp(a,b,c){var d;zp.g.constructor.call(this,c?{min:c.min,max:c.max,engineType:c.engineType}:void 0);C(a,rp,zp,0);if(!jb(b))throw new D(zp,1,'"spaceId" must be a string');this.aa=a;this.Bg=b;this.Ek={};if(c&&(["limit","simplificationLevel","tags"].forEach(function(e){e in c&&(this.Ek[e]=c[e])},this),a=c.parameters))for(d in a)this.Ek[d]=a[d];this.Ya(this.Ap())}u(zp,R);t("H.service.xyz.Provider",zp);zp.prototype.s=function(a,b,c,d,e){return this.aa.em(a,b,c,this.Bg,d,e,this.Ek)};
zp.prototype.requestInternal=zp.prototype.s;zp.prototype.V=function(){return this.aa.V(this.Bg)};zp.prototype.getCopyrights=zp.prototype.V;zp.prototype.Tc=Ve;zp.prototype.providesOMV=zp.prototype.Tc;zp.prototype.L=function(){return this.nb()};zp.prototype.getStyle=zp.prototype.L;zp.prototype.Bb=function(a){C(a,Zg)&&a.Yb("MVT");this.Ya(a)};zp.prototype.setStyle=zp.prototype.Bb;
zp.prototype.Ap=function(){return this.vb===ph.WEBGL?new Zg({sources:{xyz:{type:"MVT"}},layers:{xyz:{data:{source:"xyz",layer:this.Bg},points:{filter:{$geometry:"point"},draw:{points:{collide:!1,order:200,color:"#92CF48",size:[[10,"8px"],[14,"12px"],[18,"16px"]]}}},polygons:{filter:{$geometry:"polygon"},draw:{polygons:{order:201,color:"#E39E3C"},lines:{order:202,color:"#755DA5",width:"1px"}}},lines:{filter:{$geometry:"line"},draw:{lines:{order:203,color:"#000000",width:"2px",join:"round",cap:"round"}}}}}}):
new H.map.render.harp.Style({styles:[{layer:this.Bg,when:["==",["geometry-type"],"Point"],technique:"circles",renderOrder:200,color:"#92CF48",size:["interpolate",["linear"],["zoom"],10,8,14,12,18,16]},{layer:this.Bg,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:"#E39E3C",renderOrder:201},{layer:this.Bg,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#755DA5",lineWidth:"1px",renderOrder:202},{layer:this.Bg,when:["==",["geometry-type"],"LineString"],technique:"solid-line",
color:"#000000",lineWidth:"2px",renderOrder:203}]})};function Ap(a,b,c){c=c||{};var d=+c.min,e=+c.max;c.min=d?ec(d,1,17):1;c.max=e?ec(e,1,17):17;Ap.g.constructor.call(this,c);C(a,Bp,Ap,0);C(b,kg,Ap,1);this.aa=a;b.Yb&&b.Yb("OMV");this.Ya(b,!0);this.xl=jo(this)}u(Ap,R);t("H.service.trafficVectorTile.Provider",Ap);Ap.prototype.Tc=Ve;Ap.prototype.providesOMV=Ap.prototype.Tc;Ap.prototype.cc=function(a){return this.xl.test(a)};Ap.prototype.cacheFilter=Ap.prototype.cc;Ap.prototype.Sd=function(a,b,c){return this.aa.Lf(a,b,c).toString()};
Ap.prototype.getTileKey=Ap.prototype.Sd;Ap.prototype.Rb=function(){return this.qf};Ap.prototype.getCache=Ap.prototype.Rb;Ap.prototype.MAX_STORE_TIME=2592E6;Ap.prototype.Ri=function(){return nl()};Ap.prototype.qd=function(){return nl()?ml():Ap.g.qd.call(this)};Ap.prototype.s=function(a,b,c,d,e){return this.aa.Oa(a,b,c,d,e)};Ap.prototype.requestInternal=Ap.prototype.s;Ap.prototype.Bb=function(a){a.Yb&&a.Yb("OMV");this.Ya(a)};Ap.prototype.setStyle=Ap.prototype.Bb;Ap.prototype.L=function(){return Ap.g.nb.apply(this)};
Ap.prototype.getStyle=Ap.prototype.L;Ap.prototype.qf=new ij(256);Ap.prototype.V=function(){return null};Ap.prototype.getCopyrights=Ap.prototype.V;function Bp(a){Bp.g.constructor.call(this,Bp,a);this.vq=(a||Ze).layer||"traffic";this.he="mc";this.Zy="omv"}u(Bp,Co);t("H.service.trafficVectorTile.Service",Bp);Bp.prototype.Da=function(){return{subDomain:"traffic.vector",path:"v2"}};Bp.CONFIG_KEY="trafficVectorTile";Bp.prototype.kd=function(a,b,c){b=b||{};var d={min:0,max:22};ya(c)&&ko(d,c);return new ej(new Ap(this,a,b),d)};Bp.prototype.createLayer=Bp.prototype.kd;
Bp.prototype.Oa=function(a,b,c,d,e){return this.s(this.Lf(a,b,c),function(f){return f.arrayBuffer().then(d,e)},e,"arraybuffer")};Bp.prototype.Lf=function(a,b,c){return this.j().clone().A("traffictiles/"+this.vq+"/"+this.he+"/"+c+"/"+a+"/"+b+"/"+this.Zy)};Bp.prototype.km=function(a){return mn()+"/"+a};Bp.prototype.Qz=function(){return this.vq};Bp.prototype.getLayerName=Bp.prototype.Qz;W.prototype.Pp=function(a){return this.Ua(Bp,a)};W.prototype.getTrafficVectorTileService=W.prototype.Pp;function Cp(a,b,c,d,e,f,g){var h=this;g=g||{};f=f?f:{};var k=a.j().clone().A(b+"/"+a.gb+"/"+c).B(f),l=a.Yc;this.aa=a;this.ix=k;Kl.call(this,{tileSize:d,max:512===d?19:20,min:512===d?2:0,getURL:function(n,p,q){var r=h.ix.clone();l&&r.Ha(l[(q+p+n)%l.length]);r.A(q+"/"+n+"/"+p+"/"+d+"/"+e);return r.toString()},crossOrigin:g.crossOrigin,headers:g.headers,uri:k.toString().replace(/_/g,"")+d,engineType:g.engineType});this.jD=b;this.ki=c;this.Ga=f;this.So=c.split(".")[0];this.xe=A(this.xe,this);this.getCopyrights=
this.V;this.Te=!1;a.addEventListener("versionupdate",this.xe)}u(Cp,Kl);Cp.prototype.MAX_STORE_TIME=2592E6;Cp.prototype.s=function(a,b,c,d,e,f){this.Te||(lo(Dp,"Use HERE Vector Tile API or Raster Tile API v3 instead."),this.Te=!0);return Cp.g.s.call(this,a,b,c,d,e,f)};Cp.prototype.requestInternal=Cp.prototype.s;Cp.prototype.i=function(){Kl.prototype.i.call(this);this.aa.removeEventListener("versionupdate",this.xe)};Cp.prototype.V=function(a,b){return this.aa.V().query(this.So,b,a)};
Cp.prototype.getCopyrights=Cp.prototype.V;Cp.prototype.xe=function(){var a=this.aa;this.ix=a.j().clone().A(this.jD+"/"+a.gb+"/"+this.ki).B(this.Ga);this.reload(!1)};Cp.prototype.Ri=function(){return nl()};Cp.prototype.qd=function(){return nl()?ml():Cp.g.qd.call(this)};function Dp(a){Dp.g.constructor.call(this,Dp,a);a=Do(this,a);this.Yc=a.shards;(this.Qa=a.ignoreTypes?null:a.type)&&this.j().Ha(this.Qa);this.gb=a.version;this.ec=new no;this.jr={};this.Ol=0;"newest"===this.gb&&this.mp()}u(Dp,Co);t("H.service.MapTileService",Dp);Dp.prototype.Da=function(){return{subDomain:"maps.ls",path:"maptile/2.1",type:"base",version:"newest",shards:["1","2","3","4"]}};Dp.CONFIG_KEY="maptile";
function Ep(a,b){for(var c={},d=a[b+"s"][b],e=d.length;e--;)c[d[e].id]=d[e];a[b+"s"]=c}Dp.prototype.qu=function(){return this.Qa};Dp.prototype.getType=Dp.prototype.qu;Dp.prototype.Rp=function(){return this.gb};Dp.prototype.getVersion=Dp.prototype.Rp;Dp.prototype.Xr=function(a){this.gb=a};Dp.prototype.V=function(){this.Ol||(this.gb&&"newest"!==this.gb||"traffic"===this.Qa)&&this.Df();return this.ec};Dp.prototype.getCopyrights=Dp.prototype.V;m=Dp.prototype;
m.os=function(a){a=a.response;var b;Ep(a,"map");Ep(a,"scheme");Ep(a,"tiletype");Ep(a,"format");Ep(a,"resolution");Ep(a,"language");if("newest"===this.gb&&"traffic"!==this.Qa)for(b in a.maps)a.maps[b].hash&&a.maps[b].newest&&(this.Xr(a.maps[b].hash),this.dispatchEvent("versionupdate"));this.$p=a;this.dispatchEvent("infoupdate")};m.el=function(a){oo(this.ec,a);this.dispatchEvent("copyrightupdate")};
m.mp=function(){var a=this;var b=this.j().clone().A("info").B({output:"json"});this.Yc&&b.Ha(this.Yc[0]);this.s(b,function(c){a.os(c)},function(c){throw c;})};m.Df=function(){var a=this;var b=this.j().clone().A("copyright").A(a.gb).B({output:"json"});this.Yc&&b.Ha(this.Yc[0]);this.Ol=1;this.s(b,function(c){a.Ol=2;a.el(c)},function(c){a.Ol=-1;throw c;})};m.Dj=function(){return this.$p};Dp.prototype.getInfo=Dp.prototype.Dj;
Dp.prototype.ij=function(a,b,c,d,e,f){var g=this.j().clone().A(a+"/"+this.gb+"/"+b+"/"+c+"/"+d).B(e?e:{}).toString();var h=0,k,l=g.length;if(0!==l)for(k=0;k<l;k++){var n=g.charCodeAt(k);h=(h<<5)-h+n;h|=0}g=h;h=this.jr[g];h||(h=new Cp(this,a,b,c,d,e,ko({headers:this.Lc},f||{})),this.jr[g]=h);return h};Dp.prototype.createTileProvider=Dp.prototype.ij;Dp.prototype.Md=function(a,b,c,d,e,f,g,h){a=this.ij(a,b,c,d,e,h);return new ej(a,{opacity:f,dark:!!g})};Dp.prototype.createTileLayer=Dp.prototype.Md;
W.prototype.Gp=function(a){return this.Ua(Dp,a)};W.prototype.getMapTileService=W.prototype.Gp;function Fp(a){Fp.g.constructor.call(this,Fp,a)}u(Fp,Co);t("H.service.SearchService",Fp);Fp.CONFIG_KEY="search";Fp.prototype.Da=function(){return{subDomain:"search",path:"v1"}};Fp.prototype.od=function(a){a=[a.title,a.action,a.cause].filter(function(b){return b});return Error(a.join(". "))};Fp.prototype.sp=function(a,b,c){a=this.j().clone().Ha("geocode").A("geocode").B(a);return this.s(a,b,c)};Fp.prototype.geocode=Fp.prototype.sp;
Fp.prototype.Ar=function(a,b,c){a=this.j().clone().Ha("revgeocode").A("revgeocode").B(a);return this.s(a,b,c)};Fp.prototype.reverseGeocode=Fp.prototype.Ar;Fp.prototype.ey=function(a,b,c){a=this.j().clone().Ha("autosuggest").A("autosuggest").B(a);return this.s(a,b,c)};Fp.prototype.autosuggest=Fp.prototype.ey;Fp.prototype.Hy=function(a,b,c){a=this.j().clone().Ha("discover").A("discover").B(a);return this.s(a,b,c)};Fp.prototype.discover=Fp.prototype.Hy;
Fp.prototype.lB=function(a,b,c){a=this.j().clone().Ha("lookup").A("lookup").B(a);return this.s(a,b,c)};Fp.prototype.lookup=Fp.prototype.lB;Fp.prototype.iy=function(a,b,c){a=this.j().clone().Ha("browse").A("browse").B(a);return this.s(a,b,c)};Fp.prototype.browse=Fp.prototype.iy;W.prototype.rA=function(a){return this.Ua(Fp,a)};W.prototype.getSearchService=W.prototype.rA;function Gp(a){Gp.g.constructor.call(this,Gp,a)}u(Gp,Co);t("H.service.publicTransit.Service",Gp);Gp.prototype.Da=function(){return{subDomain:"transit.router",path:"v8"}};Gp.CONFIG_KEY="publicTransit";Gp.prototype.oA=function(a,b,c){a=this.j().clone().A("routes").B(a);return this.s(a,b,c)};Gp.prototype.getRoutes=Gp.prototype.oA;Gp.prototype.vz=function(a,b,c){a=this.j().clone().A("departures").B(a);return this.s(a,b,c)};Gp.prototype.getDepartures=Gp.prototype.vz;
Gp.prototype.sA=function(a,b,c){a=this.j().clone().A("stations").B(a);return this.s(a,b,c)};Gp.prototype.getStations=Gp.prototype.sA;Gp.prototype.od=function(a){return Error(JSON.stringify(a))};W.prototype.kA=function(a){return this.Ua(Gp,a)};W.prototype.getPublicTransitService=W.prototype.kA;function Hp(a,b,c,d){if(!ab(c))throw new D(a,b,"has invalid type");if(!ab(d))throw new D(a,b+1,"has invalid type");};function Ip(a,b,c,d,e,f){Hp(Ip,1,b,c);Hp(Ip,2,d,e);(this.Pn=a.length)?(this.Nb=a,this.gn=b,this.Ym=c,this.ak=0,this.rn=A(this.rn,this),this.xy=d,this.vy=e,this.Vh=Wa(),Ta(this.Vh,Jp,f||{}),this.es={},x.setTimeout(this.rn,0)):b(Ye,!0)}var Jp={duration:100,ez:"geometry",dz:"WKT",KC:"searchAttributes",vt:B};
Ip.prototype.rn=function(){var a=[];var b=!1;for(var c=Gj(),d;this.ak<this.Pn;){var e=this.Nb[this.ak];b=e.attributes;d=e.layerId||this.Vh.vt;e.distance&&(b[this.Vh.KC]={nearest:new pc(e.nearestLat,e.nearestLon),distance:e.distance});if(e=e[this.Vh.ez]){try{var f=Of(new Oa(e))}catch(g){this.Ym(new x.Error(g.message));b=!0;break}b[this.Vh.dz]=f}(e=this.es[d])||(e=this.es[d]=this.xy({layerId:d,columnNames:Object.keys(b)}));b=this.vy(e,b);a.push(b);this.ak++;if((b=this.ak===this.Pn)||Gj()-c>=this.Vh.duration){this.gn(a,
b);break}}b?this.es={}:this.$k=x.setTimeout(this.rn,0)};Ip.prototype.cancel=function(){x.clearTimeout(this.$k);this.ak<this.Pn&&this.Ym(new x.Error("parsing canceled"))};Ip.prototype.cancel=Ip.prototype.cancel;function Kp(a){var b=Lp;if(!a||!jb(Qe(a.layerId,a.layer))||!ob(a.level)||db(a.rowFilter)&&!ab(a.rowFilter)||db(a.rowFilterContext)&&!ya(a.rowFilterContext))throw new D(b,1,db("invalid layer config")?"invalid layer config":a);};function Mp(a,b){var c={};this.fC=a;Ta(c,b||c);Xk.call(this,c);this.Fn={};a=this.Hc(Wh.SPATIAL);a.update(a.Jd+1,Ih.ADD)}u(Mp,Xk);t("H.service.remote.ObjectProvider",Mp);Mp.prototype.u=function(){Xk.prototype.u.call(this)};Mp.prototype.dispose=Mp.prototype.u;Mp.prototype.le=function(){return Ye};Mp.prototype.requestMarkers=Mp.prototype.le;Mp.prototype.ke=function(){return Ye};Mp.prototype.requestDomMarkers=Mp.prototype.ke;Mp.prototype.rg=function(){return Ye};Mp.prototype.requestOverlays=Mp.prototype.rg;
Mp.prototype.Sc=Ve;Mp.prototype.providesMarkers=Mp.prototype.Sc;Mp.prototype.Rc=Ve;Mp.prototype.providesDomMarkers=Mp.prototype.Rc;Mp.prototype.ie=Ve;Mp.prototype.providesSpatials=Mp.prototype.ie;Mp.prototype.Jn=function(){return Ye};Mp.prototype.requestSpatials=Mp.prototype.Jn;function Np(a){return a.Td(!0)}Mp.prototype.Kn=function(a,b){a=Op(this,a,Pp);b&&(a=a.filter(Np));return a};Mp.prototype.requestSpatialsByTile=Mp.prototype.Kn;
function Op(a,b,c){var d=b.Fi&&b.Fi[c],e;!d&&(e=b.kl)&&(delete b.kl,(b.Fi=a=a.fC.parse(a,b,e))&&(d=a[c]));return d||Ye}Mp.prototype.$=function(a){var b=a.xb();if(this.Fn[b])throw new Ab(this.$,"Remote object "+b+" already added");return this.Fn[b]=a};Mp.prototype.Na=function(a){delete this.Fn[a.xb()]};var Pp="spatials";function Qp(a){a=a||{};var b=a.tileCacheSize||1024,c=a.resultType,d=a.styleCallback;db(a.min)||(a.min=12);Qp.g.constructor.call(this,a);if(-1===Rp.indexOf(c))throw new D(Qp,2,"invalid resultType");this.resultType=c;if(d&&!ab(d))throw new D(Qp,2,"invalid style callback");this.vi=d;this.oa=a.pixelRatio||Ie();this.Dc=A(this.Dc,this);this.Un(new ij(b,A(this.fe,this)));this.createTileInternal=4===c||8===c?A(this.wy,this):A(this.uy,this)}u(Qp,R);t("H.service.extension.TileProvider",Qp);
Qp.prototype.mq=!1;Qp.prototype.getCapabilities=function(){return Qp.g.getCapabilities.call(this)|hh.CROP_LINES_BY_TILE|hh.CROP_POLYGONS_BY_TILE};Qp.prototype.Oa=function(a,b,c,d){return this.mq?Qp.g.Oa.call(this,a,b,c,d):B};Qp.prototype.requestTile=Qp.prototype.Oa;Qp.prototype.Dc=function(a){this.dispatchEvent(new Ee("error",jb(a)?a:a+"",this))};Qp.prototype.Sc=function(){return 1===this.resultType};Qp.prototype.providesMarkers=Qp.prototype.Sc;Qp.prototype.Rc=function(){return 2===this.resultType};
Qp.prototype.providesDomMarkers=Qp.prototype.Rc;Qp.prototype.ie=function(){return 4===this.resultType||8===this.resultType};Qp.prototype.providesSpatials=Qp.prototype.ie;function Sp(a){var b=a.yd;b||(a.Uv||(a.Uv=a.lu(a.resultType,a.vi,a.Dc)),b=a.yd=new Mp(a.Uv),b.fa(a),b.addEventListener(a.l.Aa,A(a.de,a)),b.mw=!0);return b}
Qp.prototype.uy=function(a,b,c,d){var e=this.getTileKey(a,b,c);e=this.Rb().get(e);var f=2==this.resultType,g=[],h=Sp(this);e?e.valid=!0:(a=e=new qj(a,b,c,z),delete a.Fi,a.kl=d);d=f?Op(h,e,"domMarkers"):Op(h,e,"markers");for(b=d.length;b--;)a=d[b],a.us=e,(f||1===a.kc().getState())&&g.push(a);e.data=g;return e};Qp.prototype.de=function(a){if(a=a.target.us)a.valid=!1};Qp.prototype.RC=function(a){this.xw=!!a};Qp.prototype.setTileCanvasRendering=Qp.prototype.RC;Qp.prototype.xw=!0;
Qp.prototype.wy=function(a,b,c,d){var e=Sp(this),f=this.getTileKey(a,b,c),g=this.tileSize,h=this.Rb().get(f);h||(a=h=new rj(f,a,b,c,g,this.oa,c,e),delete a.Fi,a.kl=d);this.xw?(d=ro.pop(g),h.N(d)||ro.push(d,g)):xj(h);return h};Qp.prototype.fe=function(a,b){var c;if(4===this.resultType||8===this.resultType){a=b.cb();for(c=a.length;c--;)delete a[c].uk[b.key];if(a=b.Dn())ro.push(a,this.tileSize),b.En()}else for(a=b.data,c=a.length;c--;)delete a[c].us};Qp.prototype.i=function(){Qp.g.i.call(this);Sp(this).u()};
var Tp={MARKER:1,DOM_MARKER:2,POLYLINE:4,POLYGON:8};Qp.ResultType=Tp;var Rp=[1,2,4,8];function Up(){}t("H.service.extension.dataView.IColumn",Up);Up.prototype.va=function(){};Up.prototype.getCell=Up.prototype.va;function Vp(a,b){this.$b=a;this.Fl=b}t("H.service.extension.dataView.ObjColumn",Vp);Vp.prototype.va=function(a){return this.$b.va(a,this.Fl)};Vp.prototype.getCell=Vp.prototype.va;function Wp(){}t("H.service.extension.dataView.IRow",Wp);Wp.prototype.bb=function(){};Wp.prototype.getColumnNames=Wp.prototype.bb;Wp.prototype.va=function(){};Wp.prototype.getCell=Wp.prototype.va;Wp.prototype.Kf=function(){};Wp.prototype.getTable=Wp.prototype.Kf;function Xp(a,b){this.$b=a;this.Ak=b}t("H.service.extension.dataView.ObjRow",Xp);Xp.prototype.bb=function(){return this.$b.bb()};Xp.prototype.getColumnNames=Xp.prototype.bb;Xp.prototype.va=function(a){return this.$b.va(this.Ak,a)};Xp.prototype.getCell=Xp.prototype.va;Xp.prototype.Kf=function(){return this.$b};Xp.prototype.getTable=Xp.prototype.Kf;function Yp(){}t("H.service.extension.dataView.ITable",Yp);Yp.prototype.uh=function(){};Yp.prototype.getMeta=Yp.prototype.uh;Yp.prototype.yh=function(){};Yp.prototype.getRowCount=Yp.prototype.yh;Yp.prototype.Rd=function(){};Yp.prototype.getRow=Yp.prototype.Rd;Yp.prototype.bb=function(){};Yp.prototype.getColumnNames=Yp.prototype.bb;Yp.prototype.yj=function(){};Yp.prototype.getColumn=Yp.prototype.yj;Yp.prototype.va=function(){};Yp.prototype.getCell=Yp.prototype.va;Yp.prototype.concat=function(){};
Yp.prototype.concat=Yp.prototype.concat;function Zp(a,b,c){var d;b=b||(a&&a.length?Object.keys(a[0]):B);this.Nb=a;if(b)for(this.$g=b,this.Oo=a=Wa(),d=b.length;d--;)a[b[d]]=!0;c!==B&&(this.Gq=c)}t("H.service.extension.dataView.ObjTable",Zp);m=Zp.prototype;m.Gq=B;m.Nb=B;m.$g=B;m.Oo=B;m.uh=function(){return this.Gq};Zp.prototype.getMeta=Zp.prototype.uh;Zp.prototype.yh=function(){return this.Nb?this.Nb.length:0};Zp.prototype.getRowCount=Zp.prototype.yh;Zp.prototype.Rd=function(a){var b=this.Nb;return b&&b[a]?new Xp(this,a):B};
Zp.prototype.getRow=Zp.prototype.Rd;Zp.prototype.bb=function(){return this.$g||Ye};Zp.prototype.getColumnNames=Zp.prototype.bb;Zp.prototype.yj=function(a){return this.Oo[a]?new Vp(this,a):B};Zp.prototype.getColumn=Zp.prototype.yj;Zp.prototype.va=function(a,b){var c=this.Nb;return(a=c&&this.Oo[b]&&c[a])&&a[b]};Zp.prototype.getCell=Zp.prototype.va;
Zp.prototype.concat=function(){var a=arguments.length,b,c=this.$g,d=""+this.$g,e=(this.Nb||[]).slice();for(b=0;b<a;b++){var f=arguments[b];if(!(f instanceof Zp))throw new D(this.concat,b);if(f.Nb){if(c&&""+f.$g!==d)throw new D(this.concat,b,"Incompatible columns!");e=e.concat(f.Nb)}}return new Zp(e,this.$g,this.Gq)};Zp.prototype.concat=Zp.prototype.concat;function $p(a,b,c,d){d=d||aq;this.uk={};d.provider=a;this.invalidate=We;$p.g.constructor.call(this,b,d);delete this.invalidate;c&&(this.tD=c);this.sa(Ih.ADD)}u($p,ri);t("H.service.remote.Spatial",$p);var aq={};$p.prototype.xb=function(){return this.tD||ri.prototype.xb.call(this)};$p.prototype.getId=$p.prototype.xb;$p.prototype.On=Xe;$p.prototype.retain=$p.prototype.On;$p.prototype.release=Ve;$p.prototype.release=$p.prototype.release;function bq(a,b){this.Zl=a;b&&(this.labels=b)}var cq=new bq(Ye);
$p.prototype.sh=function(a){return(this.uk[a.key]||cq).Zl};$p.prototype.getGeometriesForTile=$p.prototype.sh;$p.prototype.Dp=function(a){return(this.uk[a.key]||cq).labels};$p.prototype.getLabels=$p.prototype.Dp;function dq(a,b,c){a.uk[b.key]=new bq(c,void 0)};function eq(a,b,c){var d=8===a;this.vi=b;this.Lt=c||Xe;(this.Fm=4===a||d)?this.Se=d:this.Pu=1===a;this.Zt=this.Fm?"$HProjGeometry":"geometry"}
eq.prototype.parse=function(a,b,c){var d,e={},f=[],g,h;var k=0;for(g=c.length;k<g;k++){var l=c[k];var n=l.Rows;if(l=n.length){var p=Object.keys(n[0]).filter(function(v){return"geometry"!==v&&"$HProjGeometry"!==v});p=new Zp(n,p);for(h=0;h<l;h++){var q=n[h];if(d=q[this.Zt]){if(delete q[this.Zt],q=p.Rd(h))try{var r=this.Fm?fq(this,a,b,q,d):gq(this,a,q,d.path);r.fa(a);f.push(r)}catch(v){this.Lt(v.message)}}else this.Lt("Layer must contain geometries")}}}e[this.Fm?"spatials":this.Pu?"markers":"domMarkers"]=
f;return e};function fq(a,b,c,d,e){var f=[],g=e.paths,h=g.length,k=0,l=a.vi&&a.vi(d);for(a=new $p(b,a.Se,B,{style:l||a.Fy,data:d});k!==h;){b=f;d=b.push;l=g[k++];for(var n=0,p=l.length,q=[];n<p;)q.push(new L(l[n++],l[n++]));d.call(b,q)}dq(a,c,[new ni(f,e.interiorsIndex,e.outlinesIndex)]);return a}function gq(a,b,c,d){d=new pc(d[0],d[1]);var e=a.vi&&a.vi(c);a.Pu?(a={icon:e,data:c,provider:b},a=new ci(d,a)):(a={icon:e,data:c,provider:b},a=new Ti(d,a));return a};function Lp(a,b,c){var d=this,e=b&&b.rowFilter,f=c.resultType;Lp.g.constructor.call(this,c);C(a,hq,Lp,0);Kp(b);e?(c=Ra(b),c.rowFilter=e.toString()):c=Ra(b);delete c.layer;c.layerId=Qe(b.layerId,b.layer);(new aj).registerProcessor("pde","H.service.extension.worker.processor");a=a.j().clone().A(iq+"."+jq).B({meta:1});(new cj("pde",{message:[this.uid,0,{tileSize:this.tileSize,projected:!0,onlyOutline:4===f,serverUrl:a.toString(),layerConfigs:[c],horizontalMargin:1}]})).then(function(){d.mq=!0;d.kb()},
this.Dc)}u(Lp,Qp);t("H.service.extension.platformData.TileProvider",Lp);Lp.prototype.lu=function(a,b,c){a=new eq(a,b,c);a.Fy=kq;return a};var kq=new di({strokeColor:"transparent",fillColor:"transparent",lineWidth:0,lineJoin:"round",lineCap:"round"});
Lp.prototype.s=function(a,b,c,d,e){var f=this,g=this.getTileKey(a,b,c),h;g=this.Rb().get(g);var k={cancel:Xe},l=!0,n=this.resultType;g&&(4===n||8===n?g.Eh()||(d(ro.pop(this.tileSize),null),l=!1):(d(z),l=!1));if(l){var p=po.setTimeout(function(){h=new cj("pde",{message:[f.uid,1,[a,b,c]]});h.then(d,e)},500);k.cancel=function(){h?h.cancel():po.clearTimeout(p)}}return k};Lp.prototype.requestInternal=Lp.prototype.s;Lp.prototype.i=function(){Lp.g.i.call(this);new cj("pde",{message:[this.uid,3]})};
Lp.ResultType=Tp;function lq(a){this.ny=a}lq.prototype.cancel=function(){for(var a=this.ny,b=a.length;b--;)a[b].cancel();a.length=0};lq.prototype.cancel=lq.prototype.cancel;function hq(a){hq.g.constructor.call(this,hq,a);lo(hq)}u(hq,Co);t("H.service.extension.platformData.Service",hq);hq.prototype.Da=function(){return{subDomain:"s.fleet.ls",path:"1"}};hq.CONFIG_KEY="platformData";hq.prototype.request=function(a,b,c,d,e){return this.K(a,b,c,d,e)};hq.prototype.request=hq.prototype.request;
hq.prototype.K=function(a,b,c,d,e){var f="text/plain";if(!a)throw new D(this.request,0,a);if(!b)throw new D(this.request,1,b);if(!d)throw new D(this.request,3,d);if(!e)throw new D(this.request,4,e);a=this.j().clone().A(a+"."+b).B(c);b===mq.JSON&&(f="application/json");return this.s(a,d,e,f)};var iq="tiles";
hq.EntryPoint={DOC_ATTRIBUTES:"doc/attributes",DOC_LAYER:"doc/layer",DOC_LAYERS:"doc/layers",DOC_MAPS:"doc/maps",DOC_INDEXES:"doc/indexes",SEARCH_BBOX:"search/bbox",SEARCH_CORRIDOR:"search/corridor",SEARCH_PROXIMITY:"search/proximity",SEARCH_QUADKEY:"search/quadkey",SERVICE_CONFIGURATION:"serviceconfiguration",STATIC:"static",TILE:"tile",TILES:iq,FILE:"file",INDEX:"index"};var jq="json",mq={TXT:"txt",JSON:jq,HTML:"html",BIN:"bin"};hq.EntryPointType=mq;
hq.prototype.Md=function(a,b){var c=b&&b.resultType;a=new Lp(this,a,b);return 1==c||2===c?new Dh(a):new ej(a)};hq.prototype.createTileLayer=hq.prototype.Md;hq.prototype.wg=function(a,b,c,d){var e=[],f,g=b.layer_id||b.layer_ids;a=this.request(a,jq,b,function(h){f=new Ip(h.geometries,c,d,function(k){return new Zp([],k.columnNames,k)},function(k,l){var n=k.Rd;k.Nb?k.Nb.push(l):k.Nb=[l];return n.call(k,k.Nb.length-1)},{vt:g});e.push(f)},function(h){d(new x.Error(h))});e.push(a);return new lq(e)};
function nq(a,b,c){if(!ib(a))throw new D(c,0,"has invalid type");if(!ib(b))throw new D(c,1,"has invalid type");if(a.length!==b.length||!a.length)throw new D(c,1,"specify one key attribute for each given layer id in the same order");}
hq.prototype.ne=function(a,b,c,d,e,f){function g(l,n){n&&h--;d(l,!h)}var h,k=[];nq(a,b,this.ne);Hp(this.ne,3,d,e);C(c,F,this.ne,2);c={bbox:c.ga+","+c.X+";"+c.ha+","+c.da};f&&Ta(c,f);a=c.layer_id?[c.layer_id]:a;f=0;for(h=a.length;f<h;f++)c.layer_id=a[f],c.key_attribute=b[f],k.push(this.wg("search/bbox",c,g,e));return new lq(k)};hq.prototype.searchByBoundingBox=hq.prototype.ne;
hq.prototype.Vc=function(a,b,c,d,e,f,g){nq(a,b,this.Vc);C(c,pc,this.Vc,2,"has invalid type");if(!ob(d))throw new D(this.Vc,3,"has invalid type");Hp(this.Vc,4,e,f);a={layer_ids:a.join(","),key_attributes:b.join(","),proximity:c.lat+","+c.lng+","+d};g&&Ta(a,g);return this.wg("search/proximity",a,e,f)};hq.prototype.searchByProximity=hq.prototype.Vc;
hq.prototype.Uc=function(a,b,c,d,e,f,g){var h="";nq(a,b,this.Uc);if(!jb(c)&&!C(c,K))throw new D(this.Uc,1,"has invalid type");if(!ob(d))throw new D(this.Uc,2,"has invalid type");Hp(this.Uc,4,e,f);a={layer_ids:a.join(","),key_attributes:b.join(","),radius:d};if(jb(c))a.route_id=c;else{d=c.T;c=0;for(b=d.length;c<b;c+=3)h+=d[c]+","+d[c+1],c<b-3&&(h+=";");a.corridor=h}g&&Ta(a,g);return this.wg("search/corridor",a,e,f)};hq.prototype.searchByCorridor=hq.prototype.Uc;
W.prototype.eA=function(a){return this.Ua(hq,a)};W.prototype.getPlatformDataService=W.prototype.eA;function oq(a){Go.g.constructor.call(this,oq,a);lo(oq)}u(oq,Co);t("H.service.extension.customRoute.Service",oq);oq.prototype.Da=function(){return{subDomain:"s.fleet.ls",path:"2"}};oq.CONFIG_KEY="customRoute";oq.prototype.od=function(a){return Error(a.issues&&a.issues.length?a.issues.map(function(b){return b.message}).join(". "):a)};oq.prototype.Tg=function(a,b,c){Hp(this.Tg,1,b,c);a=this.j().clone().A("calculateroute.json").B(a);return this.s(a,b,c)};oq.prototype.calculateRoute=oq.prototype.Tg;
W.prototype.uz=function(a){return this.Ua(oq,a)};W.prototype.getCustomRoutingService=W.prototype.uz;function pq(a){pq.g.constructor.call(this,pq,a);lo(pq)}u(pq,Co);t("H.service.extension.geofencing.Service",pq);pq.prototype.Da=function(){return{subDomain:"fleet.ls",path:"2"}};pq.CONFIG_KEY="geofencing";pq.prototype.request=function(a,b,c,d){return this.K(a,b,c,d)};pq.prototype.request=pq.prototype.request;pq.prototype.od=function(a){return Error(a.issues&&a.issues.length?a.issues.map(function(b){return b.message}).join(". "):a.message||a.response_code)};
pq.prototype.K=function(a,b,c,d){if(!a)throw new D(this.request,0,a);if(!ab(c))throw new TypeError("onResult must be a function");if(!ab(d))throw new TypeError("onError must be a function");a=this.j().clone().A(a+".json").B(b);return this.s(a,c,d)};pq.EntryPoint={SEARCH_PROXIMITY:"search/proximity"};W.prototype.Gz=function(a){return this.Ua(pq,a)};W.prototype.getGeofencingService=W.prototype.Gz;function qq(a){var b=rq;if(!a||!jb(a.layerId)||db(a.rowFilter)&&!ab(a.rowFilter)||db(a.rowFilterContext)&&!ya(a.rowFilterContext))throw new D(b,1,db("invalid layer config")?"invalid layer config":a);}function sq(a){return jb(a)&&/^[A-Z][A-Z0-9_]*$/.test(a)}function tq(a){for(var b=a&&a.length,c=2<=b&&"WKT"===a[--b]&&"GEOMETRY_ID"===a[--b];c&&b--;)c=sq(a[b]);return c}
function uq(a,b){var c="",d=[];if(b){var e=a.geometries;if(e&&e.length){var f=Object.keys(e[0].attributes);c=c+("Meta:\t"+b+"\n")+f.join("\t");c+="\tWKT\n";for(a=0;a<e.length;a++){var g=e[a].attributes;var h=e[a].geometry;for(b=0;b<f.length;b++)d.push(g[f[b]]);c+=d.join("\t");c+="\t"+h+"\n";d=[]}}}else{h={};d=[];if(a.geometries)for(e=0;e<a.geometries.length;e++)b=a.geometries[e],h[b.layerId]||(h[b.layerId]=[]),h[b.layerId].push(b);for(f in h)d.push({layerId:f,geometries:h[f]});for(a=0;a<d.length;a++)c+=
uq(d[a],d[a].layerId)}return c};function rq(a,b,c){var d=this,e=b&&b.rowFilter,f;rq.g.constructor.call(this,c);C(a,vq,rq,0);var g=c.resultType;qq(b);if(e){var h=Ra(b);h.rowFilter=e.toString()}else h=b;(new aj).registerProcessor("cle","H.service.extension.worker.processor");var k=b.layerId;a.request(wq,xq,{detail_level:"all",layer_id:k},function(l){l=l.layers;var n;for(n=0;n<l.length;n++)if(l[n].layerId===k){h.level=l[n].level;break}f=a.j().clone().A(yq+"."+xq).B({meta:1});(new cj("cle",{message:[d.uid,0,{tileSize:d.tileSize,
projected:!0,onlyOutline:4===g,serverUrl:f.toString(),layerConfigs:[h],batchTiles:!1,horizontalMargin:1}]})).then(function(){d.mq=!0;d.kb()},d.Dc)},function(l){d.Dc(l.message)})}u(rq,Qp);t("H.service.extension.customLocation.TileProvider",rq);rq.prototype.lu=function(a,b,c){return new eq(a,b,c)};
rq.prototype.s=function(a,b,c,d,e){var f=this,g=this.getTileKey(a,b,c),h;g=this.Rb().get(g);var k={cancel:Xe},l=!0,n=this.resultType;g&&(4===n||8===n?g.Eh()||(d(ro.pop(this.tileSize),null),l=!1):(d(z),l=!1));if(l){var p=po.setTimeout(function(){h=new cj("cle",{message:[f.uid,1,[a,b,c]]});h.then(d,e)},500);k.cancel=function(){h?h.cancel():po.clearTimeout(p)}}return k};rq.prototype.requestInternal=rq.prototype.s;rq.prototype.i=function(){rq.g.i.call(this);new cj("cle",{message:[this.uid,3]})};t("H.service.extension.customLocation.Permission",{READ:"read",WRITE:"write",EXPORT:"export"});t("H.service.extension.customLocation.Storage",{READONLY:"readonly",UPDATABLE:"updatable"});function zq(){if(Aq)throw new Ab(zq);}t("H.service.extension.customLocation.Table",zq);var Aq=!0;function Bq(a,b){var c;Aq=!1;var d=new zq;Aq=!0;d.Rm=Za(x.JSON.parse(x.JSON.stringify(a)));a=a.columnNames;var e=Wa();for(c=a.length;c--;)e[a[c]]=c;d.No=e;d.Cc=a.length;if(b){if(b.length%a.length)throw new D(Bq,1,"Invalid number of cells");}else b=[];d.ub=b;return d}zq.prototype.uh=function(){return this.Rm};zq.prototype.getMeta=zq.prototype.uh;zq.prototype.yh=function(){return this.ub.length/this.Cc};
zq.prototype.getRowCount=zq.prototype.yh;zq.prototype.Rd=function(a){return a<this.ub.length/this.Cc?new Cq(this,a):B};zq.prototype.getRow=zq.prototype.Rd;zq.prototype.pA=function(){var a=this.ub.length/this.Cc,b,c=new x.Array(a);for(b=0;b<a;b++)c[b]=new Cq(this,b);return c};zq.prototype.getRows=zq.prototype.pA;zq.prototype.uo=function(a){var b=this.Cc,c=this.ub,d=c.length/this.Cc;if(!a||a.length%b)throw new D(this.uo,0,"Invalid number of cells");this.ub=c.concat(a);return d};
zq.prototype.addCells=zq.prototype.uo;zq.prototype.Zx=function(){for(var a=this.Cc,b=this.ub,c=this.ub.length/this.Cc;a--;)b.push(z);return this.Rd(c)};zq.prototype.addRow=zq.prototype.Zx;zq.prototype.bb=function(){return this.Rm.columnNames};zq.prototype.getColumnNames=zq.prototype.bb;zq.prototype.yj=function(a){return this.No[a]===B?B:new Dq(this,a)};zq.prototype.getColumn=zq.prototype.yj;zq.prototype.va=function(a,b){return this.ub[a*this.Cc+this.No[b]]};zq.prototype.getCell=zq.prototype.va;
zq.prototype.pe=function(a,b,c){b=this.No[b];if(a>=this.ub.length/this.Cc)throw new D(this.pe,0,"Row index out of bounds");if(b===B)throw new D(this.pe,0,"Column unknown");this.ub[a*this.Cc+b]=c};zq.prototype.setCell=zq.prototype.pe;
zq.prototype.concat=function(a){var b=arguments.length,c,d=""+this.bb(),e=this.ub?this.ub.slice():[];for(c=0;c<b;c++){var f=arguments[c];if(!(f instanceof zq))throw new D(this.concat,c);if(""+f.bb()!==d)throw new D(this.concat,c,"Incompatible columns!");f.ub&&(e=e.concat(f.ub))}return Bq(this.Rm,e)};zq.prototype.concat=zq.prototype.concat;var Eq=/(\n|\t|\r|")/;
zq.prototype.ks=function(a,b){var c,d=this.Cc,e=this.bb(),f=[],g=[],h=this.ub,k=-1;for(c=0;c<d;c++)if(!a||a.test(e[c]))"WKT"===e[c]&&(k=f.length),f.push(c);if(!(a=f.length))throw new D(this.ks,1,"No columns filtered");Fq(this,g,e,0,d,f,a,k);if(b){var l=b.length;for(c=0;c<l;c++)g.push("\n"),e=b[c],Fq(this,g,h,e,d,f,a,k)}else for(l=this.yh(),e=0;e<l;e++)g.push("\n"),Fq(this,g,h,e,d,f,a,k);return g.join("")};
function Fq(a,b,c,d,e,f,g,h){var k;for(k=0;k<g;k++){k&&b.push("\t");var l=c[d*e+f[k]];if(k!==h){if(l!==z){l=String(l);if(Eq.test(l))throw new D(a.ks,0,'Invalid character (\\n, \\r, \\t, or ") in row '+d+" column "+a.Rm.columnNames[f[k]]);b.push(l)}}else b.push(l)}}function Dq(a,b){this.$b=a;this.Fl=b}zq.Column=Dq;Dq.prototype.va=function(a){return this.$b.va(a,this.Fl)};Dq.prototype.getCell=Dq.prototype.va;Dq.prototype.pe=function(a,b){this.$b.pe(a,this.Fl,b)};Dq.prototype.setCell=Dq.prototype.pe;
function Cq(a,b){this.$b=a;this.Ak=b}zq.Row=Cq;Cq.prototype.bb=function(){return this.$b.bb()};Cq.prototype.getColumnNames=Cq.prototype.bb;Cq.prototype.va=function(a){return this.$b.va(this.Ak,a)};Cq.prototype.getCell=Cq.prototype.va;Cq.prototype.pe=function(a,b){this.$b.pe(this.Ak,a,b)};Cq.prototype.setCell=Cq.prototype.pe;Cq.prototype.Kf=function(){return this.$b};Cq.prototype.getTable=Cq.prototype.Kf;function Gq(a){if(a===B)a="\t";else if(!/^[^"\r\n]$/.test(a))throw new D(Gq,0);this.Nx=String(a).charCodeAt(0);this.ud=A(this.ud,this);this.o=Hq}var Hq=0;m=Gq.prototype;m.getState=function(){return this.o};function Iq(a,b,c){var d=a.o;if(d!==b)throw 1===d&&(a.o=Hq),new Ab(c,"Requires state: "+["READY","PARSE","PAUSE"][b]+" but found "+["READY","PARSE","PAUSE"][d]);}m.abort=function(){Iq(this,2,Gq.prototype.abort);this.o=Hq};
m.ud=function(a){this.o=Hq;throw new D(Gq.prototype.parse,0,"Malformed DSV at row "+this.ad.Br+" column "+this.ad.aj+": "+a);};function Jq(a,b){var c=[];a.parse(b,function(d,e,f){1>d&&(c[e]=f);return 0<d});a.o=Hq;return c}m.parse=function(a,b,c){Iq(this,Hq,Gq.prototype.parse);a=a.trim();this.ad=new Kq(a,this.Nx,this.ud);this.LB=b;this.Bv=c||We;this.o=2;this.resume()};m.Bv=We;
m.resume=function(){var a=this.ad,b=[];Iq(this,2,Gq.prototype.resume);this.o=1;do{if(!a.Yp){this.o=Hq;break}if(e>a.aj){if(void 0!==c&&c!==e){this.ad.ud("The number of columns must be the same for all rows");return}var c=e}var d=a.Br;var e=a.aj;var f=a.Gl;var g=this.Bv(d,e,a);if(a.Gl>f)for(;-1!==a.next(););else{for(;-1!==(f=a.next());)b.push(f);g=String.fromCharCode.apply(z,b);b.length=0}Lq(a);this.LB(d,e,g)&&(this.o=a.Yp?2:Hq)}while(1===this.o);2!=this.o&&void 0!==c&&0<e&&c!==e&&this.ad.ud("The number of columns must be the same for all rows")};
function Kq(a,b,c){this.ad=new Oa(a);this.Es=b;this.Yp=!0;this.Gl=this.Br=this.aj=0;Lq(this);this.ud=c;this.Ac=[];this.Rf=!1}m=Kq.prototype;m.Gl=0;function Lq(a){var b=a.ad.fb();a.Ut=!1;(a.UA=34===b)&&a.ad.next()}function Mq(a,b){var c=a.ad;a.Ut=!0;switch(b){case a.Es:a.aj++;break;case 13:c.next(),10!==c.fb()&&a.ud("CR without LF");case 10:a.aj=0;a.Br++;break;case -1:a.Yp=!1;break;default:a.ud("End of field expected")}c.next();return-1}
m.fb=function(){if(this.Ut)var a=-1;else{var b=this.ad;a=b.fb();if(this.UA)switch(a){case 34:b.next();a=b.fb();34!==a&&(a=Mq(this,a));break;case -1:this.ud("Closing quotation mark expected")}else switch(a){case 34:this.ud("Unexpected quotation mark");case this.Es:case 13:case 10:case -1:a=Mq(this,a)}}return a};m.ui=function(){this.Rf=!0;this.Ac=[]};m.ih=function(){var a=this.Ac.slice();this.Rf=!1;this.Ac=[];return a};
m.next=function(){var a=this.fb();-1!==a&&this.ad.next();this.Rf&&this.Ac.push(a);this.Gl++;return a};function Nq(a,b,c,d){d=d||{};if(!b)throw new D(Nq,1,"has to be a function");if(!c)throw new D(Nq,2,"has to be a function");this.gn=b;this.Ym=c;this.Yg=[];this.Lc={};this.sq=[];this.hh={};this.$r={};this.gs={};this.dx={};this.mj=d.duration||100;this.zm=A(this.zm,this);a=a.split("Meta:\t").slice(1);for(b=0;b<a.length;b++){d=a[b].split("\n");c=d[0].split("\t")[0];d=d.slice(1).join("\n");this.hh[c]=new Gq;this.Lc[c]=Jq(this.hh[c],d);var e={layerId:c,columnNames:this.Lc[c]};this.sq.push(c);this.dx[c]=
Bq(e);this.$r[c]=Gj();Oq(this,d,c);this.zm(c)}}function Oq(a,b,c){var d=[],e=a.Lc[c].length-1,f=a.dx[c];try{a.hh[c].parse(b,function(g,h,k){var l=!1;0<g&&(d[h]=k,h===e&&(a.Yg.push(f.Rd(f.uo(d))),Gj()-a.$r[c]>a.mj&&(l=!0)));return l},function(g,h,k){if(0<g&&h===e)return Of(k)})}catch(g){a.Ym(g)}}Nq.prototype.cancel=function(){for(var a in this.gs)x.clearTimeout(this.gs[a])};Nq.prototype.cancel=Nq.prototype.cancel;
Nq.prototype.zm=function(a){var b=this,c,d;this.gs[a]=x.setTimeout(function(){if(2===b.hh[a].getState())b.$r[a]=Gj(),b.gn(b.Yg,!1),b.Yg=[],b.hh[a].resume(),b.zm(a);else{c=!0;for(d=0;d<b.sq.length;d++)if(b.hh[b.sq[d]].getState()!==Hq){c=!1;break}c&&(0<b.Yg.length&&b.gn(b.Yg,!0),b.Yg=[])}},0)};function vq(a){vq.g.constructor.call(this,vq,a);lo(vq)}u(vq,Co);t("H.service.extension.customLocation.Service",vq);vq.prototype.Da=function(){return{subDomain:"fleet.ls",path:"2"}};vq.CONFIG_KEY="customLocation";vq.prototype.Md=function(a,b){var c=b&&b.resultType;a=new rq(this,a,b);return 1===c||2===c?new Dh(a):new ej(a)};vq.prototype.createTileLayer=vq.prototype.Md;
function Pq(a,b,c,d){a=a===Qq?"changes":"file";var e=b[a];var f=jb(e),g=!f&&C(e,Blob);if(!f&&!g)throw new D(d,0,"Invalid "+a+" parameter");if(Rq)e=g?e:ef(e,"text/plain"),d=new x.FormData,d.append(a,e,e.name||a+".wkt"),c.method="POST",c.data=d,delete b[a];else if(g)throw new D(d,0,"Sending Blob data is not supported by the browser");}var Rq=x.FormData&&!!x.FormData.prototype.append;vq.prototype.request=function(a,b,c,d,e){return this.K(a,b,c,d,e)};vq.prototype.request=vq.prototype.request;
vq.prototype.K=function(a,b,c,d,e){var f="text/plain",g=a===Sq.LAYERS_UPLOAD||a===Sq.LAYERS_MODIFY||a===Sq.LAYERS_IMPORT,h=c,k={data:B,method:"GET",headers:this.Lc};if(!a)throw new D(this.request,0,a);if(!b)throw new D(this.request,1,b);Hp(this.request,3,d,e);g&&(C(c,Object,this.request,2,"Invalid request parameters"),h=Ra(c),Pq(a,h,k,this.request));var l=this.j().clone().A(a+"."+b).B(h);b===Tq.JSON&&(f="application/json");a=new Tg(f,l.toString(),Ud,k);a.then(function(n){var p=n.issues;p&&n.error_id&&
n.response_code?e(Error(p[0].message)):d(n)},function(n){"error"===n.type||404===n.status?e(Error(n.statusText||"Unable to load data")):n.json().then(function(p){e(Error("["+p.issues[0].message+"] "+l+" request failed"))},function(){e(Error("["+n.statusText+"] "+l+" request failed"))})});return a};
var wq="layers/list",Qq="layers/modify",yq="tiled/tile",Sq={LAYERS_DELETE:"layers/delete",LAYERS_GRANT:"layers/access/grant",LAYERS_LIST:wq,LAYERS_MODIFY:Qq,LAYERS_UPLOAD:"layers/upload",LAYERS_IMPORT:"layers/import",SEARCH_ALL:"search/all",SEARCH_BBOX:"search/bbox",SEARCH_CORRIDOR:"search/corridor",SEARCH_PROXIMITY:"search/proximity",SEARCH_QUADKEY:"search/quadkey",SEARCH_TILE:yq};vq.EntryPoint=Sq;var xq="json",Tq={TXT:"txt",JSON:xq};vq.EntryPointType=Tq;
vq.prototype.Sb=function(a,b,c){var d=this;return this.request("search/all","txt",{filter:'WKT==""',layer_id:a},function(e){var f=String(e).replace(/[\r\n]+$/g,"").split("\t");d.request(wq,xq,{layer_id:a,detail_level:"all"},function(g){g=g.layers[0];g.columnNames=f;b(Bq(g))},c)},c)};vq.prototype.getLayer=vq.prototype.Sb;
vq.prototype.uu=function(a,b,c,d){function e(){return++g<f?h.request("layers/access/grant",xq,{layer_id:a,granted_app_id:b[g].grantedAppId,permissions:b[g].permissions.join(",")},e,d):h.Sb(a,c,d)}var f=b&&b.length,g=-1,h=this;return e()};vq.prototype.grantAccess=vq.prototype.uu;vq.prototype.zt=function(a,b,c){return this.request("layers/delete",xq,{layer_ids:a},b,c)};vq.prototype.deleteLayer=vq.prototype.zt;
vq.prototype.kd=function(a,b,c){function d(){setTimeout(function(){k.Sb(g,function(q){setTimeout(e.bind(null,q),n)},function(){64E3>l?(l+=n,d()):c(x.Error("Timeout"))})},n);n*=2}function e(q){var r=JSON.stringify(q.bb()),v=a.grants;if(r!==JSON.stringify(h)){var w="Results into different column names on the backend: "+r;setTimeout(function(){k.zt(g,function(){c(x.Error(w))},function(y){c(x.Error(w+". "+y.message))})},n)}else v&&v.length?k.uu(g,v,b,c):b(q)}var f,g,h,k=this,l=0,n=1E3;var p=!a||!sq(g=
a.layerId)&&(f="layerId")||!tq(h=a.columnNames)&&(f="columnNames")?0:ab(b)?ab(c)?-1:2:1;if(0<=p)throw new D(k.kd,p,f||arguments[p]);return k.Sb(g,function(){c(x.Error("Layer exists already"))},function(){var q={layer_id:g,file:h.join("\t")},r=a.level,v=a.storage;r!==B&&(q.level=r);v!==B&&(q.storage=v);k.request("layers/upload",xq,q,d,c)})};vq.prototype.createLayer=vq.prototype.kd;
vq.prototype.wg=function(a,b,c,d){var e=[],f;a=this.request(a,xq,b,function(g){g.geometries.length?(g=uq(g,b.layer_id),f=new Nq(g,c,d),e.push(f)):c(Ye,!0)},d);e.push(a);return new lq(e)};vq.prototype.Vc=function(a,b,c,d,e,f){if(!ib(a))throw new D(this.Vc,0,"has invalid type");C(b,pc,this.Vc,1,"has invalid type");if(!ob(c))throw new D(this.Vc,2,"has invalid type");Hp(this.Vc,3,d,e);a={layer_ids:a.join(","),proximity:b.lat+","+b.lng+","+c};f&&Ta(a,f);return this.wg("search/proximity",a,d,e)};
vq.prototype.searchByProximity=vq.prototype.Vc;vq.prototype.Uc=function(a,b,c,d,e,f){var g="";if(!ib(a))throw new D(this.Uc,0,"has invalid type");if(!jb(b)&&!C(b,K))throw new D(this.Uc,1,"has invalid type");if(!ob(c))throw new D(this.Uc,2,"has invalid type");Hp(this.Uc,3,d,e);a={layer_ids:a.join(","),radius:c};if(jb(b))a.route_id=b;else{var h=b.T;b=0;for(c=h.length;b<c;b+=3)g+=h[b]+","+h[b+1],b<c-3&&(g+=",");a.corridor=g}f&&Ta(a,f);return this.wg("search/corridor",a,d,e)};
vq.prototype.searchByCorridor=vq.prototype.Uc;vq.prototype.ne=function(a,b,c,d,e){function f(k,l){l&&h--;c(k,!h)}var g=[],h;if(!ib(a))throw new D(this.ne,0,"has invalid type");C(b,F,this.ne,1,"has invalid type");Hp(this.ne,2,c,d);b={bbox:b.ga+","+b.X+";"+b.ha+","+b.da};e&&Ta(b,e);a=b.layer_id?[b.layer_id]:a;e=0;for(h=a.length;e<h;e++)b.layer_id=a[e],g.push(this.wg("search/bbox",b,f,d));return new lq(g)};vq.prototype.searchByBoundingBox=vq.prototype.ne;
vq.prototype.Gr=function(a,b,c,d){var e,f=[];if(!jb(a))throw new D(this.Gr,0,"has invalid type");Hp(this.Gr,1,b,c);var g={layer_id:a};d&&Ta(g,d);d=this.request("search/all",xq,g,function(h){h.geometries.length?(h=uq(h,a),e=new Nq(h,b,c),f.push(e)):b(Ye,!0)},c);f.push(d);return new lq(f)};vq.prototype.searchAll=vq.prototype.Gr;var Uq={"delete":/^GEOMETRY_ID$/,append:/^(?!GEOMETRY_ID$)/};
function Vq(a,b,c,d,e,f){function g(){v++;d(this,v===q)}function h(S){v++;e(S,this,v===q)}var k="append"!==b,l,n={},p=Wa(),q=0,r=[],v=0;if(!ib(c))throw new D(f,0,c);Hp(f,1,d,e);for(l=c.length;l--;){var w=c[l];if(C(w,Cq)){var y=w.Kf().uh().layerId;var I=w.va("GEOMETRY_ID");if(k){if(I===z||""===String(I))var G='GEOMETRY_ID must not be null or ""';n[I=y+"_"+I]&&(G="same GEOMETRY_ID for multiple rows");n[I]=w}else I!==z&&""!==String(I)&&(G='GEOMETRY_ID must be null or ""')}else G="Invalid type";if(G)throw new D(f,
0,"- Invalid row at index "+l+", "+G);I=p[y];I||(I=p[y]=[],q++);I.push(w)}for(y in p){I=p[y];c=[];for(l=I.length;l--;)c.push(I[l].Ak);r.push(a.request(Qq,xq,{layer_id:y,action:b,changes:I[0].Kf().ks(Uq[b]||null,c)},A(g,I),A(h,I)))}return new lq(r)}vq.prototype.$s=function(a,b,c){return Vq(this,"append",a,b,c,this.$s)};vq.prototype.appendRows=vq.prototype.$s;vq.prototype.vx=function(a,b,c){return Vq(this,"update",a,b,c,this.vx)};vq.prototype.updateRows=vq.prototype.vx;
vq.prototype.At=function(a,b,c){return Vq(this,"delete",a,b,c,this.At)};vq.prototype.deleteRows=vq.prototype.At;W.prototype.sz=function(a){return this.Ua(vq,a)};W.prototype.getCustomLocationService=W.prototype.sz;t("H.service.buildInfo",function(){return cn("H-service","1.54.1","17144d2",{region:"row"})});

function Wq(a,b){this.Za=a;this.Ke=b}
Wq.prototype.create=function(a,b){var c=a.coordinates;switch(a.type){case "Point":var d=new ci(Xq(c));break;case "LineString":d=new xi(Yq(c));break;case "Polygon":d=new Bi(Zq(c));break;case "MultiPoint":var e=0;var f=c.length;d=[];if(this.Ke){for(;e<f;e++)d.push(Xq(c[e]));c=new ci(new Lf(d))}else{for(;e<f;e++)d.push(new ci(Xq(c[e])));c=new Q;c.fd(d)}d=c;f="multiPoint";break;case "MultiLineString":e=0;f=c.length;d=[];if(this.Ke){for(;e<f;e++)d.push(Yq(c[e]));c=new xi(new Mf(d))}else{for(;e<f;e++)d.push(new xi(Yq(c[e])));
c=new Q;c.fd(d)}d=c;f="multiLineString";break;case "MultiPolygon":d=[];e=0;f=c.length;if(this.Ke){for(;e<f;e++)d.push(Zq(c[e]));c=new Bi(new Kf(d))}else{for(;e<f;e++)d.push(new Bi(Zq(c[e])));c=new Q;c.fd(d)}d=c;f="multiPolygon";break;case "GeometryCollection":c=d=new Q;e=a.geometries;f=0;for(var g=e.length;f<g;f++)this.create(e[f],c);f="geometryCollection"}d&&(c=d,e=a.properties,a=a.id,g={},e&&(this.Ke?g=e:g.properties=e),f&&!this.Ke&&(g[f]=!0),a&&c.Ur(a),c.setData(g),this.Za(d));b&&d&&b.$(d);return d};
Wq.prototype.create=Wq.prototype.create;function Xq(a){return new pc(a[1],a[0])}function Zq(a){for(var b=Yq(a[0]),c=[],d,e=1,f=a.length;e<f;e++)d=Yq(a[e]),c.push(d);return new M(b,c)}function Yq(a){for(var b=0,c=a.length,d=new K;b<c;b++)d.ng(Xq(a[b]));return d};function $q(a){eb(this,$q);this.url=a;this.bj=[];this.Zd=z;this.gj=A(this.gj,this);J.call(this)}u($q,J);t("H.data.AbstractReader",$q);var ar={ERROR:-1,LOADING:0,VISIT:1,READY:2};$q.State=ar;$q.prototype.state=ar.READY;$q.prototype.l={Ux:"statechange"};$q.prototype.Sb=function(){if(!this.Zd){this.Zd=new P;var a=this.Zd.pd();a.fd(this.bj)}return new Pj(this.Zd)};$q.prototype.getLayer=$q.prototype.Sb;$q.prototype.bA=function(){return this.bj.concat([])};$q.prototype.getParsedObjects=$q.prototype.bA;
$q.prototype.j=function(){return this.url};$q.prototype.getUrl=$q.prototype.j;$q.prototype.TC=function(a){if(this.state===ar.LOADING||this.state===ar.VISIT)throw Error("InvalidState: state "+this.state);this.bj=[];this.Zd=z;this.url=a;return this};$q.prototype.setUrl=$q.prototype.TC;$q.prototype.getState=function(){return this.state};$q.prototype.getState=$q.prototype.getState;$q.prototype.G=function(a,b,c){this.state=a;this.dispatchEvent(new br(b||this,this.l.Ux,a,c||""))};
$q.prototype.parse=function(){var a=this;db(this.url)?(this.G(ar.LOADING),(new Tg("text/plain",this.url)).then(function(b){try{a.gj(b)}catch(c){a.G(ar.ERROR,z,c.message)}},function(){a.G(ar.ERROR,z,"Error loading file")})):a.G(ar.ERROR,z,"File url was not set")};$q.prototype.parse=$q.prototype.parse;function br(a,b,c,d){br.g.constructor.call(this,b,a);this.state=c;this.message=d}u(br,ie);$q.Event=br;function cr(a,b){b=b||{};this.Za=b.style||this.bh;(this.Ke=!!b.disableLegacyMode)||window.console.warn("H.data.geojson.Reader: Legacy parser is enabled in GeoJSON Reader. Features like Multi-Geometries, Polygon interiors and GeoJSON feature properties might not work as expected. To maximise compatibility with the remote services it is recommended to set the `disableLegacyMode` flag to true.");$q.call(this,a)}u(cr,$q);t("H.data.geojson.Reader",cr);
cr.prototype.gj=function(a){var b,c;try{var d="string"===typeof a?JSON.parse(a):a;if("object"===typeof d){var e=new Wq(this.Za,this.Ke);switch(d.type){case "FeatureCollection":if(b=d.features){var f=new Q;this.Mg(f);for(c=0;c<b.length;c++){var g=dr(b[c]);(g=e.create(g))&&f.$(g)}}break;case "Feature":g=dr(d);(g=e.create(g))&&this.Mg(g);break;default:(g=e.create(d))&&this.Mg(g)}this.G(ar.READY)}else this.G(ar.ERROR,z,"Invalid syntax")}catch(h){this.G(ar.ERROR,z,"Parse error. "+h.message)}};
cr.prototype.eC=function(a){this.G(ar.LOADING);this.gj(a)};cr.prototype.parseData=cr.prototype.eC;cr.prototype.bh=function(){};function dr(a){var b={};if(a.geometry){var c=a.geometry;b.type=c.type;b.properties=a.properties;c.coordinates&&(b.coordinates=c.coordinates);c.geometries&&(b.geometries=c.geometries);a.id&&(b.id=a.id)}return b}cr.prototype.Mg=function(a){this.Zd&&this.Zd.pd().$(a);this.bj.push(a);this.G(ar.VISIT,a)};function er(a,b,c){this.Ye=a=ec(a,0,30);this.Qa=b;this.jj=c;this.bs=[];this.$h=[];do this.$h[a]=[],this.bs[a]=new fr;while(a--);b===gr?(this.Ps=hr,this.normalize=ir):(this.Ps=jr,this.normalize=kr);this.Xj=1/0;this.Qm=-1/0}var lr=Math.log(.5);function ir(a){return this.cp?Math.round((a-this.Xj)/this.cp*255):127}function kr(a){return void 0===this.Yt?127:Math.round(255*Math.pow(a,this.Yt))}
er.prototype.vc=function(a){var b,c;var d=a.value;void 0===d&&(d=1);d>this.Qm&&(this.Qm=d,this.cp=this.Qm-this.Xj);d<this.Xj&&(this.Xj=d,this.cp=this.Qm-this.Xj);var e=uh.Ne(a).scale(1073741823).floor();d=this.Ye;var f=e.x>>30-d;e=e.y>>30-d;for(c=this.Ps;-1<d;){this.$h[d][e]||(this.$h[d][e]=[]);(b=this.$h[d][e][f])||(b=this.$h[d][e][f]=new c(f,e,d));b.vc(a,d);var g=this.bs[d];g.tv>b.bd&&(g.tv=b.bd);g.Mh<b.bd&&(g.Mh=b.bd);g.sv>b.yc&&(g.sv=b.yc);g.Dq<b.yc&&(g.Dq=b.yc);d--;f>>=1;e>>=1}};
function mr(a,b,c,d,e){var f=1<<b,g,h;d=dc(d,f);f=0<=c&&c<f&&(g=a.$h[b])&&(h=g[c])&&(f=h[d])||null;!f&&e&&0<=b&&(f=mr(a,b-1,c>>1,d>>1,e));return f}function nr(a,b,c,d,e,f){for(var g,h=[];c<=d;c++)for(g=e;g<=f;g++)h.push(mr(a,b,c,g,!1));return h}function or(a,b){var c=0,d=0,e=mr(a,0,0,0,!1),f;if(b.Yl)return b.vj;b.z===a.Ye?b.vj=b.yc:(pr(a,b,function(g){var h=qr(a,g),k=4-h.length;if(g.z!==a.Ye){for(f=0;f<h.length;f++)c+=h[f].yc,d++;c+=k*e.yc;d+=k}}),b.vj=c/d);b.Yl=!0;return b.vj}
function pr(a,b,c){b=[b];for(var d,e;0<b.length;)e=b.shift(),d=qr(a,e),c(e),b.push.apply(b,d)}function qr(a,b){var c=[],d,e,f;for(e=0;1>=e;e++)for(f=0;1>=f;f++)(d=mr(a,b.z+1,2*b.x+e,2*b.y+f,!1))&&c.push(d);return c}er.prototype.clear=function(){er.call(this,this.Ye,this.Qa,this.jj)};function jr(a,b,c){this.x=a;this.y=b;this.z=c;this.yc=this.bd=this.count=0;this.Yl=!1;this.vj=0}jr.prototype.vc=function(a,b){this.count++;this.bd+=a.value||1;this.yc=this.bd/Math.pow(2,2*(30-b))};
function hr(a,b,c){this.x=a;this.y=b;this.z=c;this.yc=this.bd=this.count=0;this.Yl=!1;this.vj=0}hr.prototype.vc=function(a){a=a.value;this.bd+=void 0!==a?a:1;this.yc=this.bd/++this.count;this.Yl=!1};function fr(){this.tv=this.sv=1/0;this.Mh=this.Dq=-1/0};function rr(a,b){var c,d=0;if(!ya(a)||Qa(a))throw new D(rr,0,a);for(c in a){var e=+c;d++;if(!(ob(e)&&0<=e&&1>=e&&jb(a[c])))throw new D(rr,0,a);}if(2>d)throw new D(rr,0,"Specify at least 2 stops");this.cD=a;this.Ju=!!b}t("H.data.heatmap.Colors",rr);var sr=new rr({0:"#008","0.2":"#0b0","0.5":"#ff0","0.7":"#f00"},!0);rr.DEFAULT=sr;function tr(a,b,c,d,e){e&1&&ur(a,a,b,c,d,0);e&2&&ur(a,a,b,c,d,1);e&4&&ur(a,a,b,c,d,2);e&8&&ur(a,a,b,c,d,3)}
function ur(a,b,c,d,e,f){var g=(c+1)*(c+1),h,k=4*d,l=c+1,n,p=[{r:0,az:0,b:0,a:0,next:null}];var q=1;var r=["r","g","b","a"][f];var v=2*c+1;for(var w,y;q<v;q++)p[q]={r:0,az:0,b:0,a:0,next:null},p[q-1].next=p[q];p[2*c].next=p[0];var I=4*(d-1);for(h=0;h<e;h++){var G=h*k;var S=a[G+f];var X=S*l*(c+2)/2;v=S*l;for(q=0;q<=c;q++)p[q][r]=S;var Ga=0;for(q=1;q<=c;q++){var ha=q<d?G+4*q:G+I;ha=a[ha+f];X+=ha*(l-q);Ga+=ha;p[c+q][r]=ha}ha=p[0];w=p[l];q=G;y=4*l;var mb=G+I;for(S=0;S<d;S++){b[q+f]=X/g;X-=v;var ta=S+
l<d?q+y:mb;ta=a[ta+f];Ga+=ta;X+=Ga;v-=ha[r];v+=w[r];Ga-=w[r];ha[r]=ta;ha=ha.next;w=w.next;q+=4;if(!X)for(;(n=4*(S+l))<k&&0===a[G+f+n];)S++,q+=4}}G=(e-1)*k;for(S=0;S<d;S++){a=4*S;h=b[a+f];X=h*l*(c+2)/2;v=h*l;for(q=0;q<=c;q++)p[q][r]=h;Ga=0;for(q=1;q<=c;q++)ha=q<e?a+q*k:a+G,ha=b[ha+f],X+=ha*(c-q+1),Ga+=ha,p[c+q][r]=ha;ha=p[0];w=p[l];q=a;mb=l*k;I=a+G;for(h=0;h<e;h++)if(b[q+f]=X/g,X-=v,ta=h+l<e?q+mb:I,ta=b[ta+f],Ga+=ta,X+=Ga,v-=ha[r],v+=w[r],Ga-=w[r],ha[r]=ta,ha=ha.next,w=w.next,q+=k,!X)for(;(n=h+l)<
e&&0===b[n*k+f+a];)h++,q+=k}};function vr(a,b,c){this.MA=b=a>>b;this.oB=Math.log(b)*Math.LOG2E;this.Ac=a=document.createElement("CANVAS");this.jy=a.getContext("2d");this.ky=a.width=a.height=3*b;var d=document.createElement("canvas");a=c.Ju;var e=c.cD;b=[];var f;d.width=256;d.height=1;d=d.getContext("2d");for(g in e)e.hasOwnProperty(g)&&b.push({stop:parseFloat(g),value:e[g]});e=b.length;b.sort(this.bD);0<b[0].stop&&b.unshift({stop:0,value:b[0].value});1>b[e-1].stop&&b.push({stop:1,value:b[e-1].value});e=b.length;var g=d.createLinearGradient(0,
0,256,0);for(f=0;f<e;f++){if(!a&&k){var h=k.stop+(b[f].stop-k.stop)/2;g.addColorStop(h,k.value);g.addColorStop(h,b[f].value)}g.addColorStop(b[f].stop,b[f].value);var k=b[f]}d.fillStyle=g;d.fillRect(0,0,256,1);this.ry=d.getImageData(0,0,256,1).data;this.NA=c.Ju}vr.prototype.bD=function(a,b){return a.stop-b.stop};vr.prototype.Gx="#000";vr.prototype.Vx="#080";function wr(a,b){this.canvas=a;this.size=b};function xr(a){var b=a||{},c=+b.sampleDepth,d=b.pointSize;a=+b.coarseness;var e=b.colors,f={min:b.min,max:b.max,engineType:b.engineType},g=b.tileSize,h=+b.dataMax;b.tileSize&&(f.tileSize=g);R.call(this,f);this.zg(b.opacity);this.Qa="value"===b.type?gr:yr;this.sampleDepth_=ob(c)?ec(Math.round(c),1,8):4;this.Cw=this.Qa===yr?ob(d)?ec(Math.round(7-d),0,6):2:1;this.at=!!b.assumeValues;b=this.max;this.jj=ob(h)?ec(Math.round(h),this.min,b+this.sampleDepth_):b;a=ob(a)?ec(Math.round(a),0,3):1;if(e&&!C(e,rr))throw new D(xr,
0,"colors");this.xi=new er(b+this.sampleDepth_+this.Cw,this.Qa,this.jj);this.iD=new vr(this.tileSize,a,e||sr);this.mg=A(this.mg,this);this.fg=A(this.fg,this);this.In=new Mj(20,this.mg)}u(xr,R);t("H.data.heatmap.Provider",xr);xr.prototype.Cd=function(a){this.zg(a)};xr.prototype.setOpacity=xr.prototype.Cd;xr.prototype.Qe=function(){return this.Oc};xr.prototype.getOpacity=xr.prototype.Qe;xr.prototype.nk=Ve;xr.prototype.providesRasters=xr.prototype.nk;
xr.prototype.s=function(a,b,c,d,e){var f=this.at,g,h;if(mr(this.xi,0,0,0,!1)){if(!f){var k=nr(this.xi,c,b-1,b+1,a-1,a+1);for(g=k.length;g--&&!f;)if(null!==k[g]){f=!0;break}}f&&(h=this.In.push([a,b,c,d,e],this.fg))}f||d(null);return h||yl};xr.prototype.requestInternal=xr.prototype.s;
xr.prototype.mg=function(a,b){var c=a.done,d=b[0],e=b[1],f=b[2];b=document.createElement("canvas");var g=this.tileSize,h=b.getContext("2d");b.width=b.height=g;var k=this.iD;var l=this.xi,n=this.at,p=this.Qa,q=this.Cw;var r=k.MA;var v=k.jy,w,y,I=p===yr?void 0===q?2:q:1;q=I;I=Math.min(this.sampleDepth_+I,k.oB);var G=k.ky,S=l.Ye;if(n&&p===gr){for(y=-1;1>=y;y++)for(n=-1;1>=n;n++){var X=(X=mr(l,f,e+y,d+n,!0))?l.normalize(or(l,X)):128;v.fillStyle="rgba("+X+",128,0,1)";v.fillRect((n+1)*r,(y+1)*r,r,r)}n=
r-Math.floor(r/10);y=3;X=v.getImageData(0,0,G,G);tr(X.data,n,G,G,y);v.putImageData(X,0,0)}else v.fillStyle=n?k.Vx:k.Gx,v.fillRect(0,0,G,G);for(;q<=I&&f+q<=S;q++){n=r>>q;y=r-n;var Ga=p===yr?127+Math.floor(128/(1<<I-q)):255;X=(1<<q)+2;var ha=1<<q;var mb=d<<q;var ta=e<<q;ha=nr(l,f+q,ta-1,ta+ha,mb-1,mb+ha);for(mb=ha.length;mb--;){ta=mb%X;var nb=mb/X<<0;if(w=ha[mb])w=l.normalize(w.yc),v.fillStyle="rgba("+w+","+Ga+",0,1)",v.fillRect(ta*n+y,nb*n+y,n,n)}X=v;Ga=n;ha=y;mb=r+2*n;n=r+2*n;ta=ta=3;nb=v.getImageData(ha,
y,mb,n);tr(nb.data,Ga,mb,n,ta);X.putImageData(nb,ha,y)}d=v.getImageData(0,0,G,G);e=k.ry;f=k.NA;l=d.data;I=0;for(G=l.length;I<G;I+=4)p=l[I],q=l[I+1],4===e.length&&(p=0),l[I]=e[4*p],l[I+1]=e[4*p+1],l[I+2]=e[4*p+2],l[I+3]=e[4*p+3]*(f?q/255:10>q?0:1);v.putImageData(d,0,0);k=new wr(k.Ac,r);r=k.size;h.drawImage(k.canvas,r,r,r,r,0,0,g,g);c.call(a,b)};xr.prototype.fg=function(a,b,c){var d=a.data;a=d[3];d=d[4];c?d():a(b)};
xr.prototype.Vs=function(a,b){var c;if(!ib(a))throw new D(this.Vs,0,a);if(c=a.length){for(;c--;)this.xi.vc(a[c]);a=this.xi;var d;c=a.bs;var e=a.Ye,f=0;if(a.Qa===yr){var g=c[a.Ye].Mh;for(d=a.Ye;0<=d;d--)if(c[d].Mh===g)f=d;else break;g=c[0].Mh;for(d=0;d<=f;d++)if(g===c[d].Mh)e=d;else break;f>a.jj&&(f=a.jj);g=Math.round(e+(f-e)/2);a.Yt=lr/Math.log(c[g].Dq)}this.reload(!!b)}};xr.prototype.addData=xr.prototype.Vs;xr.prototype.clear=function(){this.xi.clear();this.reload(!0)};xr.prototype.clear=xr.prototype.clear;var yr=0,gr=1;function zr(){}t("H.data.utils.Dom",zr);zr.prototype.nh=function(a){return!!a&&/^\s*(1|true)\s*$/i.test(this.Va(a))};zr.prototype.getBoolean=zr.prototype.nh;zr.prototype.Va=function(a){var b;try{if(a.nodeType===Node.ATTRIBUTE_NODE)return a.value;var c="";var d=0;var e=a.childNodes;for(b=e.length;d<b;d++)e[d].nodeType!==Node.COMMENT_NODE&&(c+=e[d].nodeValue.replace(/^\s+|\s+$/g,""))}catch(f){}return c||""};zr.prototype.getString=zr.prototype.Va;
zr.prototype.fm=function(a){return parseFloat(this.Va(a))||0};zr.prototype.getFloat=zr.prototype.fm;zr.prototype.Tv=function(a){var b=a.split(/\s+/),c=b.length,d=!(b&&1==c),e=d?1:3,f=[],g;d||(b=a.split(","),c=b.length);for(g=0;g<c;g+=e)if(a=this.ar(d?b[g]:g+3>b.length?null:b.slice(g,g+3)))f.push(a);else return[];return f};zr.prototype.parseCoords=zr.prototype.Tv;
zr.prototype.ar=function(a){if(!a)return null;var b=a instanceof Array&&0<a.length&&4>a.length?a:a.split(",");a=parseFloat(b[0]);var c=parseFloat(b[1]);b=parseFloat(b[2]);return isNaN(c)||isNaN(a)?null:new pc(c,a,isNaN(b)?void 0:b)};zr.prototype.parseCoord=zr.prototype.ar;zr.prototype.dm=function(a){a=this.Va(a);return/^[0-9a-fA-F]{8}$/.test(a)?"#"+a.substr(6,2)+a.substr(4,2)+a.substr(2,2)+a.substr(0,2):"#000000ff"};zr.prototype.getColor=zr.prototype.dm;function Ar(a){a=a.attributes;for(var b,c=a.length;c--;)switch(b=a[c],b.name){case "x":this.x=parseFloat(b.value);break;case "y":this.y=parseFloat(b.value);break;case "xunits":this.Ue="fraction"===zr.prototype.Va(b);break;case "yunits":this.Xd="fraction"===zr.prototype.Va(b)}}t("H.data.kml.HotSpot",Ar);function Br(a){var b=a.childNodes,c=new zr;this.offsetX=this.offsetY=0;for(a=b.length;a--;){var d=b[a];switch(d.nodeName){case "href":this.href=c.Va(d)}}}t("H.data.kml.Icon",Br);function Cr(a){var b;if(a){a=a.childNodes;var c=a.length;for(b=new zr;c--;){var d=a[c];switch(d.nodeName){case "scale":this.scale=b.fm(d);break;case "Icon":this.icon=d=new Br(d);break;case "hotSpot":this.Au=d=new Ar(d)}}}}t("H.data.kml.IconStyle",Cr);function Dr(a){a=a.childNodes;for(var b,c=a.length,d=new zr;c--;)switch(b=a[c],b.nodeName){case "bgColor":this.bgColor=d.dm(b);break;case "textColor":this.textColor=d.dm(b);break;case "text":this.text=d.Va(b);break;case "displayMode":this.displayMode=d.Va(b)}}t("H.data.kml.BalloonStyle",Dr);function Er(){this.LA={4:function(a){return["#",a.charAt(1),a.charAt(1),a.charAt(2),a.charAt(2),a.charAt(3),a.charAt(3),"ff"].join("")},5:function(a){return["#",a.charAt(1),a.charAt(1),a.charAt(2),a.charAt(2),a.charAt(3),a.charAt(3),a.charAt(4),a.charAt(4)].join("")},7:function(a){return a+"ff"},9:function(a){return a}};this.HC={4:function(a){return[Fr(a.charAt(1)),Fr(a.charAt(2)),Fr(a.charAt(3)),255]},5:function(a){return[Fr(a.charAt(1)),Fr(a.charAt(2)),Fr(a.charAt(3)),Fr(a.charAt(4))]},7:function(a){a=
parseInt(a.substring(1),16);return[a>>16&255,a>>8&255,a&255,255]},9:function(a){a=parseInt(a.substring(1),16);return[a>>24&255,a>>16&255,a>>8&255,a&255]}}}t("H.data.utils.ColorHelper",Er);function Fr(a){a=parseInt(a,16);return(a<<4)+a}function Gr(a){return 16>a?"0"+Math.round(a).toString(16):Math.round(a).toString(16)}
function Hr(a,b,c){if(!/^(#|rgb).*/.test(b))return[0,0,0,255];c||(c="","#"===b.charAt(0)?c=a.LA[b.length]?b:"":"rgb"===b.substr(0,3)&&(b=b.match(/\d+(\.\d+)?/g),c=b.length,c=2<c&&5>c?["#",Gr(+b[0]),Gr(+b[1]),Gr(+b[2]),3<c?Gr(255*+b[3]):"ff"].join(""):""),b=c);a=a.HC[b.length](b);a[3]=Math.round(a[3]/255*100)/100;return a}
Er.prototype.mx=function(a,b){var c="";if(!/^(#|rgb).*/.test(a)){c="";for(a=0;6>a;a++)c+="ABCDEF0123456789".charAt(Math.floor(16*Math.random()));return c+"ff"}a=Hr(this,a,b);for(b=0;4>b;b++)c+=""+Gr(3>b?Math.floor(Math.random()*(a[b]-0+1))+0:255*a[b]);return c};Er.prototype.toRandomRGBA=Er.prototype.mx;function Ir(a){a=a.childNodes;for(var b,c=a.length,d=new zr,e=new Er;c--;)switch(b=a[c],b.nodeName){case "color":this.color=d.dm(b);break;case "colorMode":this.qy=d.Va(b)}"random"===this.qy&&(this.color="#"+e.mx(this.color,!1))}t("H.data.kml.ColorStyle",Ir);function Jr(a){var b=a.childNodes,c=b.length,d=new zr;for(this.El=new Ir(a);c--;)a=b[c],"width"===a.nodeName&&(this.width=d.fm(a))}t("H.data.kml.LineStyle",Jr);function Kr(a){var b=a.childNodes,c=b.length,d=new zr;this.outline=this.fill=!0;for(this.El=new Ir(a);c--;)switch(a=b[c],a.nodeName){case "fill":this.fill=d.nh(a);break;case "outline":this.outline=d.nh(a)}}t("H.data.kml.PolyStyle",Kr);function Lr(a){var b=a.childNodes,c=b.length;for(this.id=a.getAttribute("id");c--;)switch(a=b[c],a.nodeName){case "IconStyle":this.Bu=a=new Cr(a);break;case "LineStyle":this.Jh=a=new Jr(a);break;case "PolyStyle":this.$v=a=new Kr(a);break;case "BalloonStyle":this.tl=a=new Dr(a)}}t("H.data.kml.Style",Lr);function Mr(a,b){a=a.childNodes;var c=a.length,d=new zr;for(this.eD=b;c--;)switch(b=a[c],b.nodeName){case "key":this.key=d.Va(b);break;case "styleUrl":this.Sk=d.Va(b)}}t("H.data.kml.Pair",Mr);Mr.prototype.L=function(){if(this.Sk){var a="highlight"===this.key?!0:!1;a=this.eD.Np(this.Sk.substr(1),a)}return a};Mr.prototype.getStyle=Mr.prototype.L;function Nr(a,b){var c=a.childNodes,d=c.length;this.cs=b;this.id=a.getAttribute("id");for(this.qn=[];d--;)a=c[d],"Pair"===a.nodeName&&(a=new Mr(a,this.cs),this.qn.push(a))}t("H.data.kml.StyleMap",Nr);Nr.prototype.L=function(a){var b=null;a=a?"highlight":"normal";for(var c=this.qn.length;c--;)this.qn[c].key===a&&(b=this.qn[c].L());return b};Nr.prototype.getStyle=Nr.prototype.L;function Or(a){a=a.childNodes;for(var b,c=a.length,d=null,e=new zr;c--;)b=a[c],"coordinates"===b.nodeName&&(d=e.Va(b));this.cv=null;d&&(this.cv=e.ar(d)||null)}t("H.data.kml.Point",Or);Or.prototype.qh=function(){return this.cv};function Pr(){}Pr.prototype.elevation=0;Pr.prototype.Qt=0;function Qr(a){a=a.childNodes;for(var b,c=a.length,d=new zr;c--;)if(b=a[c],"coordinates"===b.nodeName){b=d.Va(b);var e=[],f=new zr;try{e=f.Tv(b)}catch(g){e=[]}this.Ll=2>e.length?[]:e}}t("H.data.kml.Line",Qr);Qr.prototype.qh=function(){for(var a=new K,b=this.Ll?this.Ll.length:0;b--;)a.ng(this.Ll[b]);return a};function Rr(a){var b=a.childNodes,c=b.length;this.Pt=new K;for(this.Iu=[];c--;){var d=b[c];var e=d.nodeName;if("outerBoundaryIs"===e||"innerBoundaryIs"===e){var f=d.childNodes;for(d=f.length;d--;){var g=f[d];if("LinearRing"===g.nodeName){var h=new Qr(g);if("outerBoundaryIs"===e){this.Pt=h.qh();var k=void 0,l=a,n=h.Ll;h=new zr;var p=l.querySelector("altitudeMode");if(p&&p.parentNode===l&&!/^\s*clampTo/.test(h.Va(p))&&n){p=n.length;for(var q=0;q<p&&0!==k;q++){var r=n[q].alt;r?k?r!==k&&(k=0):k=r:k=0}(n=
l.querySelector("*|altitudeOffset"))&&n.parentNode===g&&"http://www.google.com/kml/ext/2.2"===n.namespaceURI&&(g=h.fm(n))&&(k+=g);k&&(k=Cb(2047,k),(g=l.querySelector("extrude"))&&g.parentNode===l&&h.nh(g)?this.Qt=k:this.elevation=k)}}else this.Iu.push(h.qh())}}}}}u(Rr,Pr);t("H.data.kml.Polygon",Rr);function Sr(a,b){var c=a&&a.childNodes||[],d=new zr;if(!a||!b)throw Error("Node or stylesContainer is not defined");this.visibility=!0;this.hC=a;for(a=c.length;a--;){var e=c[a];switch(e.nodeName){case "name":this.name=d.Va(e);break;case "description":this.description=d.Va(e);break;case "visibility":this.visibility=d.nh(e);break;case "open":this.open=d.nh(e);break;case "styleUrl":if(this.Sk=d.Va(e))e=this.Sk.substr(1),this.Vy=b.Np(e,!1);break;case "Style":this.fv=e=new Lr(e)}}}
t("H.data.kml.Feature",Sr);function Tr(a,b){var c=document.createElement("CANVAS");c.width=1;c.height=1;this.cs=a;this.Zp={};this.cr={};this.Py=new Sh(c);this.hd=b||""}Tr.prototype.create=function(a){this.kh=new Sr(a,this.cs);return Ur(this,a)};
function Ur(a,b,c){b=b.childNodes;for(var d=b.length,e,f={},g;d--;){var h=b[d];switch(h.nodeName){case "Point":h=new Or(h);g=Vr(a,"Marker");if(h=h.qh())e=new ci(h,g),g.br&&re(g.br,"statechange",A(a.UB,a,g.br,e,g),!1);break;case "LineString":h=new Qr(h);g=Vr(a,"Polyline");e=new xi(h.qh(),g);break;case "LinearRing":h=new Qr(h);g=Vr(a,"Polyline");e=new xi(h.qh(),g);break;case "Polygon":h=new Rr(h);g=Vr(a,"Polygon");g.elevation=h.elevation;g.extrusion=h.Qt;e=new Bi(new M(h.Pt,h.Iu),g);break;case "MultiGeometry":e=
Ur(a,h,new Q)}e&&(a.kh.name&&(f.name=a.kh.name),a.kh.description&&(f.description=a.kh.description),g&&g.tl&&(f.balloonStyle=g.tl),f.kmlNode=a.kh.hC,e.setData(f),c&&c.$(e))}return c||e}
Tr.prototype.UB=function(a,b,c){var d=c.anchor,e=c.scale;c=e+"_"+d.x+d.y+d.Ue+d.Xd+"_"+c.href;var f={};if(1===a.getState()){var g=this.Zp[c];if(!g){var h=d.x;var k=d.y;if(g=a.lc())g={w:g.w*e,h:g.h*e},f.size=g;h=d.Ue&&g?g.w*h:h*e;k=d.Xd&&g?g.h*(1-k):!d.Xd&&g?g.h-k*e:k*e;f.anchor={x:h,y:k};g=new Sh(a.Oe(),f);this.Zp[c]=g}b.re(g)}delete this.cr[c]};
function Vr(a,b){var c=a.kh,d={visibility:c.visibility};var e=new Er;var f=1;var g={x:0,y:0,Ue:!1,Xd:!1};var h=Wr(a,c.Vy);c.fv&&(h=Wr(a,c.fv,h));switch(b){case "Marker":if(h&&h.Bu){e=h.Bu;e.scale&&(f=e.scale);if(e.Au){var k=e.Au;g={x:k.x,y:k.y,Ue:k.Ue,Xd:k.Xd}}e.icon&&e.icon.href?(b=e.icon.href,Xr.test(b)||(b=a.hd+b),e=f+"_"+g.x+g.y+g.Ue+g.Xd+"_"+b,k=a.Zp[e]||a.cr[e],k||(k=new Sh(b),a.cr[e]=k),0===k.getState()?(d.icon=a.Py,d.br=k,d.href=b,d.anchor=g,d.scale=f):1===k.getState()&&(d.icon=k)):1!==f&&
(k||(g={x:14,y:4,Ue:!1,Xd:!1}),e=Sh,a=a.zp(),k={w:28*f,h:36*f},f={size:new Jh(k.w,k.h),anchor:new L(g.Ue?k.w*g.x:g.x*f,g.Xd?k.h*(1-g.y):k.h-g.y*f),hitArea:new Ph(Qh.POLYGON,[0*f,16*f,0*f,7*f,8*f,0*f,18*f,0*f,26*f,7*f,26*f,16*f,18*f,34*f,8*f,34*f])},d.icon=new e(a,f))}break;case "Polyline":d.style={};h&&h.Jh&&(f=h.Jh,d.style.strokeColor="rgba("+Hr(e,f.El.color,!0)+")",0<=f.width&&(d.style.lineWidth=f.width));break;case "Polygon":d.style={},h&&(h.Jh&&(f=h.Jh,d.style.strokeColor="rgba("+Hr(e,f.El.color,
!0)+")",0<=f.width&&(d.style.lineWidth=f.width)),h.$v&&(f=h.$v,d.style.fillColor=f.fill?"rgba("+Hr(e,f.El.color,!0)+")":"rgba(0,0,0,0)",f.outline||(d.style.lineWidth=0)))}d.tl=h.tl;return d}function Wr(a,b,c){c=c||{};for(var d in b)b.hasOwnProperty(d)&&(c[d]="object"===typeof b[d]?Wr(a,b[d],c[d]):b[d]);return c}var Xr=/^[^:\/]+:/;Tr.prototype.zp=function(){return'<svg xmlns="http://www.w3.org/2000/svg" width="28px" height="36px"><path d="M 19 31 C 19 32.7 16.3 34 13 34 C 9.7 34 7 32.7 7 31 C 7 29.3 9.7 28 13 28 C 16.3 28 19 29.3 19 31 Z" fill="#000" fill-opacity=".2"/><path d="M 13 0 C 9.5 0 6.3 1.3 3.8 3.8 C 1.4 7.8 0 9.4 0 12.8 C 0 16.3 1.4 19.5 3.8 21.9 L 13 31 L 22.2 21.9 C 24.6 19.5 25.9 16.3 25.9 12.8 C 25.9 9.4 24.6 6.1 22.1 3.8 C 19.7 1.3 16.5 0 13 0 Z" fill="#fff"/><path d="M 13 2.2 C 6 2.2 2.3 7.2 2.1 12.8 C 2.1 16.1 3.1 18.4 5.2 20.5 L 13 28.2 L 20.8 20.5 C 22.9 18.4 23.8 16.2 23.8 12.8 C 23.6 7.07 20 2.2 13 2.2 Z" fill="#18d"/></svg>'};function Yr(){this.bx={}}t("H.data.kml.StyleContainer",Yr);Yr.prototype.vo=function(a){a&&a.id&&(this.bx["style_"+a.id]=a)};Yr.prototype.addStyle=Yr.prototype.vo;Yr.prototype.Np=function(a,b){a=this.bx["style_"+a];a instanceof Nr&&(a=a.L(b));return a};Yr.prototype.getStyleById=Yr.prototype.Np;function Zr(a){var b=a?a.lastIndexOf("/"):-1;this.pk=[];$q.call(this,a);0<=b&&(this.XA=a.substr(0,b)+"/")}u(Zr,$q);t("H.data.kml.Reader",Zr);
Zr.prototype.gj=function(a){var b,c=null;if(jb(a)&&""!=a.trim()){try{var d=(new DOMParser).parseFromString(a,"text/xml")}catch(h){this.G(ar.ERROR,z,"Error parsing KML document");return}if(d.getElementsByTagName("parsererror").length)this.G(ar.ERROR,z,"Error parsing KML document");else if((a=d.childNodes&&"kml"===d.childNodes[0].nodeName?d.childNodes[0]:void 0)&&(b=$r(a.childNodes,"Document")[0]),b=b||a){d=new Yr;for(var e=$r(b.childNodes,"Style"),f=$r(b.childNodes,"StyleMap"),g=e.length;g--;)a=new Lr(e[g]),
d.vo(a);for(g=f.length;g--;)a=new Nr(f[g],d),d.vo(a);this.DB=new Tr(d,this.XA);a=b.childNodes;for(b=a.length;b--;)if(e=a[b],d=c,"Placemark"===e.nodeName?(e=this.DB.create(e))&&this.Mg(e,d):"Folder"===e.nodeName&&(e={group:new Q,node:e},this.Mg(e.group,d),this.pk.push(e)),!b&&(d=this.pk.shift()))a=d.node.childNodes,c=d.group,b=a.length;this.G(ar.READY)}else this.G(ar.ERROR,z,"Invalid KML document")}else this.G(ar.ERROR,z,"Unable to create objects from the empty data")};
Zr.prototype.Mg=function(a,b){b?b.$(a):(this.Zd&&this.Zd.pd().$(a),this.bj.push(a),this.G(ar.VISIT,a))};function $r(a,b){for(var c=a.length,d,e=[];c--;)d=a[c],d.nodeName===b&&e.push(d);return e};t("H.data.buildInfo",function(){return cn("H-data","1.54.1","17144d2",{region:"row"})});

tc.prototype.ve=ca(1,function(a,b){this.root.ve(a,ob(b)?b:this.Lh)});xc.prototype.ve=ca(0,function(a,b){var c=0,d;if(!a(this)&&b--)for(;3>=c;c++)(d=this[c])&&d.ve(a,b)});function as(a,b,c,d,e,f){this.xo=b;a&&(this.parent=a,b&1?(c=a[8],e=a[5]):(c=a[7],e=a[8]),b&2?(d=a[9],f=a[6]):(d=a[4],f=a[9]));this[7]=c;this[5]=e;this[8]=(c+e)/2;this[4]=d;this[6]=f;this[9]=(d+f)/2}m=as.prototype;m.ib=0;m.oh=function(a){return this[a]||(++this.ib,this[a]=new as(this,a))};m.removeChild=function(a){var b=a.xo;this[b]===a&&(delete this[b],delete a.parent,--this.ib)};m.ve=function(a,b){for(var c=0,d=this;d=d.parent;)++c;bs(this,a,b,c)};
function bs(a,b,c,d){var e,f;if(!b(a,d)&&c--)for(++d,e=0;4>e;e++)(f=a[e])&&bs(f,b,c,d)}m.Lg=function(a){(this.entries||(this.entries=[])).push(a)};m.Zi=0;m.$i=0;m.Bc=0;function cs(a){this.Lh=a||10;this.rk=this.qk=this.Vi=this.Ui=2147483648;this.xm()}m=cs.prototype;m.xm=function(){this.head=this.root=new as(null,NaN,this.Ui-this.qk,this.Vi-this.rk,this.Ui+this.qk,this.Vi+this.rk)};m.Bl=function(){ds(this,this.root);this.xm()};function ds(a,b){var c,d;for(c=0;4>c;c++)if(d=b[c])ds(a,d),delete b[c];delete b.parent;delete b.entries}
m.gd=function(a){var b=this.head,c;if(a){var d=a;if(d!==b)for(b=d;d=d.parent;)if(d.entries||1<d.ib)b=d}else for(;!b.entries&&2>(c=b.ib);)if(c)b=d;else break;this.head=b};m.Wd=function(a,b,c,d){var e=this.root;if(!(a>=e[7]&&b>=e[4]&&a<=e[5]&&b<=e[6]))throw Error("Coordinates out of bounds");return this.Ub(this.root,a,b,c,this.Lh,d)};
m.Ub=function(a,b,c,d,e,f){var g=a.entries;e?a.ib?g=this.Kj(a,b,c,d,e,f):g?(g=g[0],g=a.oh(+(g[1]>=a[8])|+(g[0]>=a[9])<<1),g.entries=a.entries,g.Zi=a.Zi,g.$i=a.$i,g.Bc=a.Bc,g.Zg=a.Zg,g.Yi=a.Yi,g.Wi=a.Wi,g.Xi=a.Xi,delete a.entries,this.gd(g),g=this.Kj(a,b,c,d,e,f)):(a.Lg(g=new es(b,c,d,f)),this.gd(a)):(g||this.gd(a),a.Lg(g=new es(b,c,d,f)));a.Zi+=b*d;a.$i+=c*d;a.Bc+=d;a.Zg===B?(a.Zg=a.Wi=b,a.Yi=a.Xi=c):(b<a.Zg?a.Zg=b:b>a.Wi&&(a.Wi=b),c<a.Yi?a.Yi=c:c>a.Xi&&(a.Xi=c));return g};
m.Kj=function(a,b,c,d,e,f){return this.Ub(a.oh(+(b>=a[8])|+(c>=a[9])<<1),b,c,d,e-1,f)};m.ve=function(a,b){bs(this.root,a,b===+b?b:this.Lh,0)};function es(a,b,c,d){this[0]=b;this[1]=a;this.weight=c;this.data=d};function fs(a,b,c){this.ra=a;this.Wl=b;this.ae=c}t("H.clustering.fastgrid.NoisePoint",fs);fs.prototype.ya=function(){this.Qc||(this.Qc=this.ra.$a(this.Wl[1],this.Wl[0],1));return this.Qc};fs.prototype.getPosition=fs.prototype.ya;fs.prototype.Ud=function(){return this.Wl.weight};fs.prototype.getWeight=fs.prototype.Ud;fs.prototype.Sf=We;fs.prototype.isCluster=fs.prototype.Sf;fs.prototype.Qd=function(){return this.ae-this.ra.dh};fs.prototype.getMinZoom=fs.prototype.Qd;fs.prototype.getData=function(){return this.Wl.data};
fs.prototype.getData=fs.prototype.getData;function gs(a,b,c,d){this.ra=a;this.rc=b;this.ae=c;this.Eq=d;this.rp=Ia(this.rp,this);this.pp=Ia(this.pp,this)}t("H.clustering.fastgrid.Cluster",gs);gs.prototype.ya=function(){this.Qc||(this.Qc=this.ra.$a(this.rc.Zi,this.rc.$i,this.rc.Bc));return this.Qc};gs.prototype.getPosition=gs.prototype.ya;gs.prototype.Ud=function(){return this.rc.Bc};gs.prototype.getWeight=gs.prototype.Ud;gs.prototype.Sf=Ve;gs.prototype.isCluster=gs.prototype.Sf;
gs.prototype.Qd=function(){return this.ae?this.ae-this.ra.dh:-1/0};gs.prototype.getMinZoom=gs.prototype.Qd;gs.prototype.hm=function(){return this.Eq-this.ra.dh};gs.prototype.getMaxZoom=gs.prototype.hm;gs.prototype.C=function(){this.I||(this.I=Ic(this.ra.$a(this.rc.Zg,this.rc.Yi,1),this.ra.$a(this.rc.Wi,this.rc.Xi,1),!0));return this.I};gs.prototype.getBoundingBox=gs.prototype.C;gs.prototype.qp=function(a){this.Wt=a;this.rc.ve(this.rp,$b)};gs.prototype.forEachEntry=gs.prototype.qp;
gs.prototype.rp=function(a,b){var c=!1,d,e;a.Bc>=this.ra.uv&&a!==this.rc&&a.Bc!==this.rc.Bc&&(this.Wt(new gs(this.ra,a,0,b)),c=!0);if(!c&&(d=a.entries))for(a=d.length,e=0;e<a;e++)this.Wt(new fs(this.ra,d[e],b));return c};gs.prototype.uj=function(a){this.Yy=a;this.rc.ve(this.pp,$b)};gs.prototype.forEachDataPoint=gs.prototype.uj;gs.prototype.pp=function(a,b){var c;if(a=a.entries){var d=a.length;for(c=0;c<d;c++)this.Yy(new fs(this.ra,a[c],b))}return!1};function hs(a){Zd.call(this);this.fc=[];var b;a?Ta(b={},is,a):b=is;this.options=b;Zd.call(this)}u(hs,Zd);var js={clusters:[],noisePoints:[]},is={projection:uh,min:0,max:22,eps:32,minWeight:2};m=hs.prototype;m.qe=function(a){this.fc=a;this.md=!0};m.vc=function(a){this.fc.push(a);this.md=!0};m.ql=function(a){this.fc=this.fc.concat(a);this.md=!0};m.sk=function(a){this.fc=this.fc.filter(function(b){return b!==a});this.md=!0};m.i=function(){hs.g.i.call(this);delete this.fc};
hs.prototype.disposeInternal=hs.prototype.i;hs.prototype.Hw=Xe;function ks(a){hs.call(this,a);a=this.options;this.he=a.projection;this.Yj=a.min;this.Zf=a.max;this.uv=a.minWeight;this.dh=7-Eb(Ib(Db(1,a.eps))/Sb);this.qr=new cs(Db(this.Yj,this.Zf+this.dh))}u(ks,hs);m=ks.prototype;m.qe=function(a){var b=0,c=a.length,d,e=new L(0,0),f=this.he,g=this.qr;ks.g.qe.call(this,a);for(g.Bl();b<c;b++)f.Ne(d=a[b],e).scale(4294967296).floor(),g.Wd(e.x,e.y,d.wt,d.data);this.md=!0};m.vc=function(a){ks.g.vc.call(this,a);this.qe(this.fc)};
m.ql=function(a){for(var b=a.length,c=ks.g.vc;b--;)c.call(this,a[b]);this.qe(this.fc)};m.sk=function(a){ks.g.sk.call(this,a);this.qe(this.fc)};m.$a=function(a,b,c,d){return this.he.$a(a/c/4294967296,b/c/4294967296,d)};m.Zr=function(a){if(this.md){var b={clusters:[],noisePoints:[]};ls(this,this.qr.root,0,this.Zf+this.dh,-1/0,b,null);this.md=!1;a(b)}};
function ls(a,b,c,d,e,f,g){var h=b.Bc,k;g&&(g.node.Bc!==h?(f.clusters.push(new gs(a,g.node,g.depth,c-1)),g=null):e++);g||(h>=a.uv?(g={node:b,depth:c},e=c):ms(a,b,e+1,f));if(b.ib&&d--)for(c++,h=0;4>h;h++)if(k=b[h])ls(a,k,c,d,e,f,g),g=null;g&&f.clusters.push(new gs(a,g.node,g.depth,a.Zf+a.dh))}function ms(a,b,c,d){b=b.entries;var e;if(b){var f=b.length;d=d.noisePoints;for(e=0;e<f;e++)d.push(new fs(a,b[e],c))}else for(e=0;4>e;e++)(f=a[e])&&ms(a,f,c,d)}m.i=function(){ks.g.i.call(this);this.qr=null};
ks.prototype.disposeInternal=ks.prototype.i;function ns(a,b){this.dr=a;this.ae=b}t("H.clustering.grid.NoisePoint",ns);ns.prototype.ya=function(){return sc(this.dr)};ns.prototype.getPosition=ns.prototype.ya;ns.prototype.Ud=function(){return this.dr.wt};ns.prototype.getWeight=ns.prototype.Ud;ns.prototype.Sf=We;ns.prototype.isCluster=ns.prototype.Sf;ns.prototype.Qd=function(){return this.ae};ns.prototype.getMinZoom=ns.prototype.Qd;ns.prototype.getData=function(){return this.dr.data};ns.prototype.getData=ns.prototype.getData;function os(a,b,c){this.Eq=this.ae=c;this.er=[];this.qs=0;this.I=Ic(a,b,!0)}t("H.clustering.grid.Cluster",os);os.prototype.Li=function(a){this.Qc||(this.Qc=sc(a));this.qs+=a.wt||1;this.er.push(a)};os.prototype.ya=function(){return this.Qc};os.prototype.getPosition=os.prototype.ya;os.prototype.Ud=function(){return this.qs};os.prototype.getWeight=os.prototype.Ud;os.prototype.Sf=Ve;os.prototype.isCluster=os.prototype.Sf;os.prototype.Qd=function(){return this.ae};os.prototype.getMinZoom=os.prototype.Qd;
os.prototype.hm=function(){return this.Eq};os.prototype.getMaxZoom=os.prototype.hm;os.prototype.C=function(){return this.I};os.prototype.getBoundingBox=os.prototype.C;os.prototype.qp=function(a){this.uj(a)};os.prototype.forEachEntry=os.prototype.qp;os.prototype.uj=function(a){var b=this;if(!ab(a))throw new D(this.uj,0,a);this.er.forEach(function(c){a(new ns(c,b.ae+1))})};os.prototype.forEachDataPoint=os.prototype.uj;function ps(a){hs.call(this,a)}u(ps,hs);
ps.prototype.Zr=function(a){var b=this.options,c=b.min,d=b.max,e=[],f=[],g;if(this.md){for(g=this.fc;c<=d;c++){for(var h,k=void 0,l,n,p,q,r,v,w,y=c,I=g,G=e,S=f,X=b.eps,Ga=b.projection,ha=b.minWeight,mb=I.length,ta=Math.pow(2,y+8),nb=[];w=I[--mb];)if(!w.xs){n=Ga.Ne(w).scale(ta).floor();v=ta;r=n.x;q=n.y;for(l=nb.length;l--;)h=nb[l],p=h.ya(),h.vs||(h.vs=Ga.Ne(p).scale(ta).floor()),p=h.vs,p=p.lb(n),p<v&&(v=p,k=h);k&&k.C().zf(w)||(k=new os(Ga.sn({x:(r-X)/ta,y:(q-X)/ta}),Ga.sn({x:(r+X)/ta,y:(q+X)/ta}),
y),nb.push(k));k.Li(w);k=null}for(mb=nb.length;mb--;)if(h=nb[mb],l=h.Ud(),l<ha)for(h=h.er,l=h.length;w=h[--l];)S.push(new ns(w,y)),w.xs=!0;else G.push(h)}c=0;for(d=g.length;c<d;c++)delete g[c].xs;this.md=!1;a({clusters:e,noisePoints:f})}};function qs(a){hs.call(this,a);a=this.options;if(a.projection!==uh)throw new D(qs,0,"Other projection than mercator not supported yet");this.he=a.projection;this.gp=a.eps;this.wB=a.minWeight;this.Xv=new vh(this.he);(new aj).registerProcessor("cluster","H.clustering.dynamicgrid.worker");this.bg=A(this.bg,this);this.Kq=A(this.Kq,this)}u(qs,hs);qs.prototype.Hw=function(a,b){this.zy=a;this.Ay=Fb(b)};
qs.prototype.Zr=function(a,b){var c=this.Gg;var d=this.zy,e=this.Ay||0;var f=!c||!(c.zoom===e&&c.Oi.ea(d));if(d&&(this.md||f)){c&&3>c.state&&c.cancel();this.md=!1;c=this.gp;if(c>=128*Kb(2,e))var g=rs;else{f=this.Xv;f.Wa(e);var h=f.Gb(d.Kc());g=f.Gb(d.Gc());h.y-=c;g.y+=c;h=f.gk(h);var k=f.gk(g);g=new F(h.lat,h.lng,k.lat,k.lng);c=f.$a(c,0).lng+180;g=g.$d(h.lat,h.lng-c,k.lat,h.lng).$d(h.lat,k.lng,k.lat,k.lng+c)}c=g;h=this.fc;g=[];for(f=h.length;f--;)c.zf(h[f])&&g.push(h[f]);0<g.length?(this.Gg=new ss(d,
e,g,this.gp,this.wB,this.he!==uh,a,b),this.Gg.then(this.bg,this.Kq)):a(js)}};
qs.prototype.bg=function(a){Ba(a)||(a=new x.Uint32Array(a));for(var b=this.Gg,c=b.VB,d=0,e=a[d++],f=Array(e),g=0,h=[],k=a.length,l=this.Gg.Cy,n=this.Gg.zoom;e--;)f[g++]=new ns(l[a[d++]],n);for(;d<k;){e=a[d++];g=l[a[d]];var p=this.Xv;var q=this.gp;p.Wa(this.Gg.zoom);var r=p.Gb(g);g=p.$a(r.x-q,r.y-q);p=p.$a(r.x+q,r.y+q);g=new F(g.lat,g.lng,p.lat,p.lng);for(g=new os(g.Kc(),g.Gc(),n);e--;)g.Li(l[a[d++]]);h.push(g)}c.call(b,{clusters:h,noisePoints:f})};qs.prototype.Kq=function(a){jb(a)&&this.Gg.KB(a)};
var rs=new F(90,-180,-90,180);qs.prototype.i=function(){qs.g.i.call(this)};qs.prototype.disposeInternal=qs.prototype.i;function ss(a,b,c,d,e,f,g,h){this.Oi=a;this.zoom=b;this.Cy=c;this.VB=g;this.KB=h;a=c.length;g=3*a;h=new (x.Float64Array||Array)(g);for(var k;a--;)k=c[a],h[--g]=k.lat,h[--g]=k.lng,h[--g]=k.wt;Td.call(this,"cluster",{message:[h,d,e,b,f]},void 0)}u(ss,cj);function ts(a){this.oa=a;this.fy=11;a=document.createElement("canvas");var b=a.getContext("2d"),c=this.oa,d=14*c;a.width=d;a.height=d;b.scale(c,c);b.beginPath();b.strokeStyle="#FFFFFF";b.fillStyle="#1080DD";b.arc(7,7,6,0,2*Math.PI,!1);b.fill();b.lineWidth=1;b.stroke();this.BB=new Sh(a,{size:{w:14,h:14},anchor:{x:7,y:7}});this.kt={};this.lt={}}t("H.clustering.theme.Circular",ts);
function us(a,b,c){var d,e=document.createElement("canvas"),f=e.getContext("2d");var g=a.oa;var h=b*g;e.width=h;e.height=h;f.scale(g,g);g=b+":"+c;(d=a.kt[g])?f.putImageData(d,0,0):(b/=2,f.beginPath(),f.strokeStyle="rgba("+c+",0.2)",f.fillStyle="rgba("+c+",1)",f.arc(b,b,b/5*3,0,2*Math.PI,!1),f.fill(),f.lineWidth=b/5*4,f.stroke(),a.kt[g]=f.getImageData(0,0,h,h));return e}
ts.prototype.mz=function(a){var b=a.Ud();var c=this.lt[b];if(!c){if(10>b){c=us(this,28,"118,209,0");var d={x:11,y:18}}else 25>b?(c=us(this,38,"255,105,0"),d={x:13,y:23}):50>b?(c=us(this,38,"240,60,0"),d={x:13,y:23}):100>b?(c=us(this,38,"181,0,21"),d={x:13,y:23}):1E3>b?(c=us(this,48,"181,0,21"),d={x:15,y:28}):(c=us(this,66,"181,0,21"),d={x:20,y:38});var e=c.getContext("2d");e.fillStyle="#FFFFFF";e.font="bold "+this.fy+"px Arial";e.fillText(String(b),d.x,d.y);d=c.width/this.oa;c=new Sh(c,{size:{w:d,
h:d},anchor:{x:d/2,y:d/2}});this.lt[b]=c}b=new ci(a.ya(),{icon:c,min:a.Qd(),max:a.hm()});b.setData(a);return b};ts.prototype.getClusterPresentation=ts.prototype.mz;ts.prototype.Zz=function(a){var b=new ci(a.ya(),{icon:this.BB,min:a.Qd()});b.setData(a);return b};ts.prototype.getNoisePresentation=ts.prototype.Zz;t("H.clustering.DataPoint",function(a,b,c,d){this.lat=a;this.lng=b;this.wt=c===+c?c:1;this.data=d});function vs(a,b){b=b||{};var c={},d=b.min||0,e=Db(d,b.max||22);d={min:d,max:e};vs.g.constructor.call(this,d);this.oa=b.pixelRatio||Ie();Ta(c,is,d,b.clusteringOptions||{});c.minWeight=Db(is.minWeight,c.minWeight);switch(c.strategy){case ws.DYNAMICGRID:if(c.projection!==uh)throw new D(vs,1,"Unsupported projection");this.ra=new qs(c);break;case ws.GRID:this.ra=new ps(c);break;default:this.ra=new ks(c)}this.ra.qe(a);this.Wk=b.theme||new ts(this.oa);this.Io=A(this.Io,this);this.bg=A(this.bg,this);xs(this)}
u(vs,P);t("H.clustering.Provider",vs);vs.prototype.i=function(){vs.g.i.call(this);this.vg.ja();this.ra.u();delete this.ra;delete this.Im;delete this.Wk;x.clearTimeout(this.bp)};var ws={FASTGRID:0,GRID:1,DYNAMICGRID:2};vs.Strategy=ws;vs.prototype.Tx=150;vs.prototype.Io=function(){this.dispatchEvent("start");this.ra.Zr(this.bg,Xe)};function xs(a,b,c){a.bp&&x.clearTimeout(a.bp);b&&a.ra.Hw(b,c);a.bp=x.setTimeout(a.Io,a.Tx)}vs.prototype.bg=function(a){this.Im=a;ys(this);this.dispatchEvent("end")};
vs.prototype.qe=function(a){this.ra.qe(a);xs(this)};vs.prototype.setDataPoints=vs.prototype.qe;vs.prototype.vc=function(a){this.ra.vc(a);xs(this)};vs.prototype.addDataPoint=vs.prototype.vc;vs.prototype.ql=function(a){this.ra.ql(a);xs(this)};vs.prototype.addDataPoints=vs.prototype.ql;vs.prototype.sk=function(a){this.ra.sk(a);xs(this)};vs.prototype.removeDataPoint=vs.prototype.sk;vs.prototype.uA=function(){return this.Wk};vs.prototype.getTheme=vs.prototype.uA;
vs.prototype.QC=function(a){this.Wk=a;this.Im&&(this.vg.ja(),ys(this))};vs.prototype.setTheme=vs.prototype.QC;function ys(a){var b=a.Im.clusters,c=a.Im.noisePoints,d=b.length,e=c.length,f=0<d+e;for(a.vg.ja();e--;){var g=c[e];a.vg.$(a.Wk.getNoisePresentation(g))}for(;d--;)c=b[d],a.vg.$(a.Wk.getClusterPresentation(c));f&&a.kb()}vs.prototype.Rc=function(){return!0};vs.prototype.providesDomMarkers=vs.prototype.Rc;vs.prototype.Sc=function(){return!0};vs.prototype.providesMarkers=vs.prototype.Sc;
vs.prototype.ie=function(){return!0};vs.prototype.providesSpatials=vs.prototype.ie;vs.prototype.lk=function(a,b){xs(this,a,b)};vs.prototype.preprocessData=vs.prototype.lk;t("H.clustering.buildInfo",function(){return cn("H-clustering","1.54.1","17144d2",{region:"row"})});

function zs(a,b){a:{for(var c=a.length,d="string"===typeof a?a.split(""):a,e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a)){b=e;break a}b=-1}return 0>b?null:"string"===typeof a?a.charAt(b):a[b]}var As={};function Bs(a){var b=a.ownerDocument,c=b.documentElement;b=b.defaultView;var d=a.getBoundingClientRect();a=d.left;d=d.top;isNaN(b.pageXOffset)?(a+=c.scrollLeft,d+=c.scrollTop):(a+=b.pageXOffset,d+=b.pageYOffset);return new L(a,d)}
function Cs(a,b,c){b=ob(b)?b+"px":b;c=ob(c)?c+"px":c;a.style[um("transform")]="translate("+b+","+c+")"}var Ds,Es=navigator.userAgent,Fs=-1<Es.indexOf("Android")&&-1<Es.indexOf("Mozilla/5.0")&&-1<Es.indexOf("AppleWebKit"),Gs=/AppleWebKit\/([\d.]+)/,Hs=null===Gs.exec(Es)?null:parseFloat(Gs.exec(Es)[1]);Ds=Fs&&null!==Hs&&537>Hs;var Is=globalThis,Js=document.createElement("T");function Ks(){this.Sw=this.Ct()}Ks.prototype.Ct=function(){var a=navigator,b=[];a&&(a.msPointerEnabled?b.push(Ls):a.pointerEnabled&&b.push(Ms));1>b.length&&("TouchEvent"in Is&&b.push(Ns),b.push(Os));return b};Ks.prototype.detectEventSets=Ks.prototype.Ct;Ks.prototype.addEventListener=function(a,b,c,d){for(var e=this.Sw,f,g=e.length,h=!1;g--;)if(f=e[g][b])h=!0,a.addEventListener(f,c,d||!1);h||a.addEventListener(b,c,d||!1)};
Ks.prototype.removeEventListener=function(a,b,c,d){for(var e=this.Sw,f,g=e.length,h=!1;g--;)if(f=e[g][b])h=!0,a.removeEventListener(f,c,d||!1);h||a.removeEventListener(b,c,d||!1)};
var Ms={start:"pointerdown",end:"pointerup",move:"pointermove",cancel:"pointercancel",over:"pointerover",out:"pointerout",hover:"pointerhover"},Ls={start:"MSPointerDown",end:"MSPointerUp",move:"MSPointerMove",cancel:"MSPointerCancel",over:"MSPointerOver",out:"MSPointerOut",hover:"MSPointerHover"},Ns={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},Os={start:"mousedown",end:"mouseup",move:"mousemove",over:"mouseover",out:"mouseout",hover:"mousehover"};function Ps(a,b,c,d){a=a.createElement(b);c&&(a.className=c);d&&(a.innerHTML=d);return a}function Qs(a,b){for(var c=1,d=arguments.length;c<d;c++)a.appendChild(arguments[c])}var Rs=new Ks;function Ss(a,b,c){Rs.addEventListener(a,b,c,void 0)}function Ts(a,b,c){Rs.removeEventListener(a,b,c,void 0)};function Y(a,b){J.call(this);this.Qa=a||"div";this.He=b?b.split(" "):[];this.Db=!1;this.He.push("H_el")}u(Y,J);t("H.ui.base.Element",Y);Y.prototype.N=function(a){if(!a)throw Error("Wrong document object");this.J=Ps(a,this.Qa,this.He.join(" "));this.renderInternal(this.J,a);this.wa(this.Db,!0);this.Dd(this.px);this.Zb(this.Id);return this.J};Y.prototype.subscribe=function(){};Y.prototype.unsubscribe=function(){};Y.prototype.O=function(){};Y.prototype.renderInternal=Y.prototype.O;
Y.prototype.hq=function(){return this.Db};Y.prototype.isDisabled=Y.prototype.hq;Y.prototype.wa=function(a,b){a=!!a;if(a!==this.Db||b)(this.Db=a)?this.Sa("H_disabled"):this.Mb("H_disabled");return this};Y.prototype.setDisabled=Y.prototype.wa;Y.prototype.Zo=null;Y.prototype.getData=function(){return this.Zo};Y.prototype.getData=Y.prototype.getData;Y.prototype.setData=function(a){this.Zo=a};Y.prototype.setData=Y.prototype.setData;
Y.prototype.Dd=function(a){var b=this.F();this.px=a;b&&(a?b.setAttribute("title",a):b.removeAttribute("title"))};Y.prototype.setTooltip=Y.prototype.Dd;Y.prototype.J=null;Y.prototype.F=function(){return this.J};Y.prototype.getElement=Y.prototype.F;Y.prototype.Id=!0;Y.prototype.Zb=function(a){var b=this.F();this.Id=a;b&&(b.style.display=a?"":"none")};Y.prototype.setVisibility=Y.prototype.Zb;Y.prototype.Td=function(){return this.Id};Y.prototype.getVisibility=Y.prototype.Td;
Y.prototype.Sa=function(a){var b=this.F();0>this.He.indexOf(a)&&this.He.push(a);b&&(b.className=this.He.join(" "));return this};Y.prototype.addClass=Y.prototype.Sa;Y.prototype.Mb=function(a){a=this.He.indexOf(a);var b=this.F();-1<a&&this.He.splice(a,1);b&&(b.className=this.He.join(" "));return this};Y.prototype.removeClass=Y.prototype.Mb;function Us(a){(a=a.F())&&a.parentNode&&a.parentNode.removeChild(a)}Y.prototype.i=function(){Y.g.i.call(this);Us(this);this.Zo=this.J=null;delete this.px};function Vs(a,b){b=b||{};var c=this;Y.call(this,"div","H_ib H_ib_top");this.Kv=A(function(d){c.Db||(c.close(),d.preventDefault())},this);this.update=A(this.update,this);this.Tl=A(this.Tl,this);this.setPosition(a);this.Fk(b.content);b.onStateChange&&this.addEventListener("statechange",b.onStateChange);this.G(Ws.OPEN)}u(Vs,Y);t("H.ui.InfoBubble",Vs);Vs.prototype.v=null;Vs.prototype.ya=function(){return this.Qc};Vs.prototype.setPosition=function(a){this.Qc=sc(a);this.update()};
Vs.prototype.setPosition=Vs.prototype.setPosition;Vs.prototype.Pa=function(a){this.v=a};
Vs.prototype.O=function(a,b){this.Eo=Ps(b,"div","H_ib_body");this.tailEl_=Ps(b,"div","H_ib_tail");this.Cl=Ps(b,"div","H_ib_close H_btn",'<svg version="1.1" class="H_icon" viewBox="0 0 12 12"><path d="m8.12 6 3.66-3.66c.29-.29.29-.76 0-1.05l-1.06-1.06c-.29-.29-.76-.29-1.05 0l-3.66 3.66-3.66-3.66c-.29-.29-.76-.29-1.05 0l-1.06 1.06c-.29.29-.3.76 0 1.05l3.66 3.66-3.66 3.66c-.29.29-.29.76 0 1.05l1.06 1.06c.29.29.76.29 1.05 0l3.66-3.66 3.66 3.66c.29.29.76.29 1.05 0l1.06-1.06c.29-.29.3-.76 0-1.05z"></path></svg>');this.ah=
Ps(b,"div","H_ib_content","&nbsp;");this.Eo.appendChild(this.Cl);this.Eo.appendChild(this.ah);Ss(this.Cl,"start",this.Kv);this.v.xa.addEventListener("sync",this.update);this.v.pa.addEventListener("sync",this.update);a.appendChild(this.Eo);a.appendChild(this.tailEl_);this.Fk(this.Jl)};Vs.prototype.renderInternal=Vs.prototype.O;Vs.prototype.Tl=function(){this.xt||(this.xt=setTimeout(this.update,0))};
Vs.prototype.update=function(){var a=this.F(),b=this.v,c,d="none";this.xt=0;if(b&&a&&this.getState()===Ws.OPEN){if(c=b.Ka(this.Qc)){var e=c.x;c=c.y;b=b.pa.width;if(e>=-b||e<=2*b||c>=-b||c<=2*b)d="",Ds?(a.style.left=e-b+"px",a.style.top=c+"px"):Cs(a,e,c)}a.style.display=d;""===d&&(a.style.visibility="visible")}};var Ws={OPEN:"open",CLOSED:"closed"};Vs.State=Ws;Vs.prototype.o=Ws.OPEN;Vs.prototype.getState=function(){return this.o};Vs.prototype.getState=Vs.prototype.getState;
Vs.prototype.G=function(a){a!==this.o&&(this.o=a,this.dispatchEvent("statechange"));if(a=this.F())this.o===Ws.OPEN?(a.style.display="block",a.style.visibility="hidden",this.Tl()):a.style.display="none"};Vs.prototype.setState=Vs.prototype.G;Vs.prototype.close=function(){this.G(Ws.CLOSED)};Vs.prototype.close=Vs.prototype.close;Vs.prototype.open=function(){this.G(Ws.OPEN)};Vs.prototype.open=Vs.prototype.open;Vs.prototype.oz=function(){return this.ah||null};Vs.prototype.getContentElement=Vs.prototype.oz;
Vs.prototype.Fk=function(a){if(a)if("string"===typeof a||"number"===typeof a.nodeType&&"string"===typeof a.nodeName)this.Jl=a;else throw Error("InfoBubble content must be a string or HTML node.");else this.Jl="";this.F()&&(this.Jl?(this.ah.innerHTML="","string"===typeof this.Jl?this.ah.innerHTML=a:"number"===typeof a.nodeType&&"string"===typeof a.nodeName&&this.ah.appendChild(a)):this.ah.innerHTML="&nbsp;",this.Tl())};Vs.prototype.setContent=Vs.prototype.Fk;
Vs.prototype.i=function(){this.close();this.Fk("");this.Cl&&Ts(this.Cl,"end",this.Kv);this.v&&(this.v.xa.removeEventListener("sync",this.update),this.v.pa.removeEventListener("sync",this.update));Y.prototype.i.call(this)};function Xs(a,b,c){Y.call(this,a,b);this.dc=c?[].concat(c):[]}u(Xs,Y);t("H.ui.base.Container",Xs);Xs.prototype.wa=function(a,b){var c=this.dc?this.dc.length:0;for(Y.prototype.wa.call(this,a,b);c--;)this.dc[c].wa(a,b);return this};Xs.prototype.setDisabled=Xs.prototype.wa;Xs.prototype.Ra=function(a){var b=this.F();this.dc.push(a);b&&(a.N(b.ownerDocument),b.appendChild(a.F()));return this};Xs.prototype.addChild=Xs.prototype.Ra;Xs.prototype.xp=function(){return[].concat(this.dc)};
Xs.prototype.getChildren=Xs.prototype.xp;Xs.prototype.removeChild=function(a){var b=this.dc.indexOf(a),c=this.F();0<=b&&(this.dc.splice(b,1),c&&c.removeChild(a.F()))};Xs.prototype.removeChild=Xs.prototype.removeChild;Xs.prototype.ja=function(){var a=this.F();a&&this.dc.forEach(function(b){a.removeChild(b.F())});this.dc=[]};Xs.prototype.O=function(a,b){for(var c=0,d=this.dc.length;c<d;c++)a.appendChild(this.dc[c].N(b))};Xs.prototype.renderInternal=Xs.prototype.O;
Xs.prototype.i=function(){this.ja();this.dc.forEach(this.Ny,this);Y.prototype.i.call(this)};Xs.prototype.Ny=function(a){a.u()};function Ys(){this.o=Zs.CLOSED;Xs.call(this,"div","H_overlay")}u(Ys,Xs);t("H.ui.base.OverlayPanel",Ys);Ys.prototype.G=function(a,b){if(a!==this.o||b)this.o=a,a===Zs.OPEN?this.Sa("H_open"):this.Mb("H_open");return this};Ys.prototype.setState=Ys.prototype.G;Ys.prototype.getState=function(){return this.o};Ys.prototype.getState=Ys.prototype.getState;
Ys.prototype.Zv=function(a){var b=a.Ae;a=a.F();var c=this.F(),d=c.style;this.Mb("H_top");this.Mb("H_middle");this.Mb("H_bottom");this.Mb("H_left");this.Mb("H_center");this.Mb("H_right");d.bottom=d.top=d.left=d.right=d.margin="";if(/top/g.test(b)){this.Sa("H_top");d.top="0";d.margin="0 12px";var e=-1}else/bottom/g.test(b)?(this.Sa("H_bottom"),d.bottom="0",d.margin="0 12px",e=1):(this.Sa("H_middle"),d.top="50%",d.margin="0 12px",d.marginTop=-Math.round(.5*
c.offsetHeight)+"px",e=0);/left/g.test(b)?(this.Sa("H_left"),d.left=a.offsetWidth+"px",d.marginLeft="12px"):/right/g.test(b)?(this.Sa("H_right"),d.right=a.offsetWidth+"px",d.marginRight="12px"):(this.Sa("H_center"),d.left="50%",0>e?(d.top=a.offsetHeight+"px",d.marginTop="12px"):0<e&&(d.bottom=a.offsetHeight+"px",d.marginBottom="12px"),d.marginLeft=-Math.round(.5*c.offsetWidth)+"px",a.appendChild(c))};Ys.prototype.pointToControl=Ys.prototype.Zv;var Zs={OPEN:"open",CLOSED:"closed"};
Ys.State=Zs;function $s(a){a=a||{};Y.call(this,"div","H_btn");this.se(a.label||" ");this.Dd(a.tooltip||"");this.setData(a.data);this.wa(!!a.disabled);this.G(at.UP,!0);a.onStateChange&&this.addEventListener("statechange",a.onStateChange);this.Xm=A(this.Xm,this);this.Sh=A(this.Sh,this)}u($s,Y);t("H.ui.base.Button",$s);$s.prototype.wa=function(a,b){a&&this.Mb("H_active");return $s.g.wa.call(this,a,b)};$s.prototype.setDisabled=$s.prototype.wa;
$s.prototype.O=function(a){Ss(a,"start",this.Xm);Ss(a,"end",this.Sh);Ss(a,"out",this.Sh);this.se(this.Vb,!0)};$s.prototype.renderInternal=$s.prototype.O;$s.prototype.getState=function(){return this.o};$s.prototype.getState=$s.prototype.getState;$s.prototype.G=function(a,b){a!==this.o&&(this.o=a,a===at.DOWN?this.Sa("H_active"):this.Mb("H_active"),b||this.dispatchEvent("statechange"));return this};$s.prototype.setState=$s.prototype.G;$s.prototype.Cp=function(){return this.Vb};
$s.prototype.getLabel=$s.prototype.Cp;$s.prototype.se=function(a,b){if(b||a!==this.Vb)if(this.Vb=a,b=this.F())b.innerHTML=a;return this};$s.prototype.setLabel=$s.prototype.se;$s.prototype.Xm=function(a){this.Db||this.G(at.DOWN);a.preventDefault()};$s.prototype.Sh=function(a){this.Db||this.G(at.UP);a.preventDefault()};$s.prototype.i=function(){var a=this.F();a&&(Ts(a,"start",this.Xm),Ts(a,"end",this.Sh),Ts(a,"out",this.Sh));Y.prototype.i.call(this)};var at={UP:"up",DOWN:"down"};$s.State=at;function bt(a){$s.call(this,a);this.JB=function(b){b.preventDefault()};this.hn=A(function(b){this.Db||this.toggleState();b.preventDefault()},this)}u(bt,$s);t("H.ui.base.PushButton",bt);bt.prototype.O=function(a){Ss(a,"start",this.hn);Ss(a,"end",this.JB);this.se(this.Vb,!0)};bt.prototype.renderInternal=bt.prototype.O;bt.prototype.oD=function(){var a=at.DOWN;this.G(this.getState()===a?at.UP:a);return this};bt.prototype.toggleState=bt.prototype.oD;
bt.prototype.i=function(){var a=this.F();a&&Ts(a,"start",this.hn);$s.prototype.i.call(this)};function ct(a){a=a||{};Xs.call(this,"div","H_rdo");this.hs=new Y("div","H_rdo_title");this.Pi=new Xs("div","H_rdo_buttons");this.Ra(this.hs);this.Ra(this.Pi);this.Cv=A(function(b){b.target.getState()===at.DOWN?(this.Fw(b.target,!0),this.dispatchEvent(dt)):b.target.G(at.DOWN,!0)},this);this.addEventListener("statechange",this.Cv);this.Wr(a.title||"");a.onActiveButtonChange&&this.addEventListener(dt,a.onActiveButtonChange);a.buttonsOptions&&a.buttonsOptions.forEach(function(b){this.to(new bt(b))},
this)}u(ct,Xs);t("H.ui.base.RadioGroup",ct);var dt="activebuttonchange";ct.prototype.O=function(a,b){Xs.prototype.renderInternal.call(this,a,b);this.Wr(this.bo,!0)};ct.prototype.renderInternal=ct.prototype.O;ct.prototype.ja=function(){this.Pi.ja()};ct.prototype.Wr=function(a,b){if(a!==this.bo||b)this.bo=a,this.hs.F()&&(this.hs.F().innerHTML=this.bo);return this};ct.prototype.setTitle=ct.prototype.Wr;ct.prototype.wA=function(){return this.bo};ct.prototype.getTitle=ct.prototype.wA;
ct.prototype.to=function(a){if(!(a instanceof bt))throw Error("PushButton expected");a.fa(this);this.Pi.Ra(a);return this};ct.prototype.addButton=ct.prototype.to;ct.prototype.oC=function(a){this.Pi.removeChild(a);a.fa(null);return this};ct.prototype.removeButton=ct.prototype.oC;ct.prototype.cm=function(){return this.Pi.xp()};ct.prototype.getButtons=ct.prototype.cm;ct.prototype.Fw=function(a,b){for(var c=this.cm(),d=c.length;d--;)c[d].G(c[d]===a?at.DOWN:at.UP,b)};ct.prototype.setActiveButton=ct.prototype.Fw;
ct.prototype.i=function(){this.removeEventListener("statechange",this.Cv);this.ja();Xs.prototype.i.call(this)};var et={btn:'<svg class="H_icon" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill-rule="evenodd"><g transform="translate(3 2)"><path d="m18 13v7h-18v-7h2v5h2v-2h2v2h2v-3h2v3h2v-2h2v2h2v-5z"></path><path d="m2.3.3c.7 0 1.3.1 1.8.4s.9.6 1.1 1 .4.9.4 1.4c0 .5-.1 1-.3 1.4s-.57 1-1 1.6-1.3 1.3-2.3 2.2h3.9l-.2 1.7h-6.16v-1.6c1.1-1.1 2-2 2.5-2.6s.9-1 1-1.4.3-.8.3-1.2c0-.4-.1-.7-.3-.9s-.5-.3-.9-.3c-.3 0-.6 0-.9.2s-.5.4-.8.7l-1.3-1c.4-.5.9-.9 1.4-1.2s1.2-.4 1.8-.4zm14.4 9.7h-2.3l-.2-3.8c 0-.9-.1-1.7-.1-2.4 0-.5 0-1 0-1.5l-1.5 6.7h-2.2l-1.6-6.7c.1.8.1 1.6.1 2.3 0 .5 0 1.1 0 1.7l-.2 3.8h-2.2l.7-9.7h2.9l1.5 6.6 1.4-6.6h2.9z"></path></g></g></svg>',
point:'<svg height="22" viewBox="0 0 12 12" width="22" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m6 12c3.3 0 6-2.7 6-6s-2.7-6-6-6-6 2.7-6 6 2.7 6 6 6z" fill="#fff"></path><path d="m6 10c2.2 0 4-1.8 4-4s-1.8-4-4-4-4 1.8-4 4 1.8 4 4 4z" fill="#2ed5c9" stroke="#272c36" stroke-width="2"></path></g></svg>'};function ft(a,b,c){Ti.call(this,a,{icon:gt,visibility:c});ht(this,b)}u(ft,Ti);function ht(a,b){a.ZA=b;a.J&&(a.J.textContent=b)}var gt=new Ri(Ps(Is.document,"span","H_dm_label"),{onAttach:function(a,b,c){c.J=a;ht(c,c.ZA)},onDetach:function(a,b,c){delete c.J}});function it(a,b){J.call(this);this.Ie=a;this.Vb=new ft(this.mD,"");b.push(this.Vb);this.rd=new Q({objects:b,data:this});this.Wn=this.Wn.bind(this)}u(it,J);m=it.prototype;m.Ve=!1;m.mD={lat:0,lng:0};m.se=function(a,b){ht(this.Vb,a);this.Vb.Y(b)};m.Ik=function(a){(this.Id=a)?this.Wn():(this.$k&&x.clearTimeout(this.$k),this.$k=x.setTimeout(this.Wn,100))};m.$k=0;m.Wn=function(){this.Vb.Zb(this.Id)};function jt(a,b){b&&(a.nextSibling=b,b.previousSibling=a)};function kt(a,b,c){c=b.Cj(c||0);this.Yf=new ci(a,{icon:c,zIndex:0});this.Yf.draggable=!0;it.call(this,b,[this.Yf]);a=this.rd;a.addEventListener("dragstart",this.zd,!0,this);a.addEventListener("drag",this.cg,!0,this);a.addEventListener("dragend",this.$e,!0,this)}u(kt,it);m=kt.prototype;m.gh=0;m.l={uf:"change"};m.Bj=function(){return this.gh};m.ya=function(){return this.Yf.W()};
function lt(a){var b=0;a.nextSibling&&a.previousSibling&&(a.nextSibling.Ve||a.previousSibling.Ve?a.nextSibling.Ve&&!a.previousSibling.Ve&&(b=2):b=1);b=a.Ie.Cj(b);a.Yf.re(b)}m.cg=function(a){var b=a.currentPointer;a=b.viewportX;b=b.viewportY;if(this.$A!==a||this.aB!==b)this.$A=a,this.aB=b,this.Yf.Y(this.Ie.map.Xa(a-this.ov.x,b-this.ov.y)),this.dispatchEvent(new ie(this.l.uf,this))};
m.zd=function(a){var b=a.currentPointer,c=b.viewportX;b=b.viewportY;var d=this.Ie.map.Ka(this.ya());this.Yf.pi(1);this.ov={x:c-d.x,y:b-d.y};a.stopPropagation()};m.$e=function(){this.Yf.pi(0)};m.Ir=function(a){this.gh=a;this.se(this.Ie.Ft(a),this.ya())};var mt={IMPERIAL:"imperial",METRIC:"metric"};t("H.ui.UnitSystem",mt);function nt(a,b,c,d){var e=new K,f=[];jt(a,this);jt(this,b);e.ng(a.ya());e.ng(b.ya());this.Kh=new xi(e,{style:c.Jh});this.tu=new xi(e,{style:{strokeColor:"transparent",lineWidth:Math.min(100,this.Kh.L().lineWidth+2*(d||5))}});c.outlineStyle&&(this.Yq=new xi(e,{style:c.outlineStyle}),f.push(this.Yq));f.push(this.Kh,this.tu);it.call(this,c,f);this.Yu=this.Xu=-1;a=this.rd;a.addEventListener("pointermove",this.ee,!0,this);a.addEventListener("pointerleave",this.Rq,!0,this)}u(nt,it);
nt.prototype.Bj=function(){var a=this.Kh.W();return a.rj(0).lb(a.rj(1))};function ot(a,b,c){var d=a.Kh.W();d.Ok(3*+c,3,[b.lat,b.lng,0]);a.Yq&&a.Yq.Y(d);a.tu.Y(d);a.Kh.Y(d)}nt.prototype.ee=function(a){var b=a.currentPointer;a=this.previousSibling.ya();var c=this.nextSibling.ya(),d=this.Ie.Yw,e=b.viewportX;b=b.viewportY;if(this.Xu!==e||this.Yu!==b)this.Xu=e,this.Yu=b,d.Y(this.Ie.Yz(a,c,{x:e,y:b})),d.Zb(!0)};nt.prototype.Rq=function(){this.Ie.Yw.Zb()};
nt.prototype.Ir=function(){this.se(this.Ie.Ft(this.Bj()),this.Kh.C().wb())};function pt(a,b){this.Ia=b;this.sc=a;this.ob={Ve:!0};qt(this,this.ob);this.bn=A(this.bn,this)}t("H.ui.distanceMeasurement.Model",pt);m=pt.prototype;m.Bm=function(){return this.ob.nextSibling===this.ob};m.Ik=function(a){for(var b=this.ob,c=b.nextSibling;c!==b;)c.Ik(c.previousSibling===b?!1:a),c=c.nextSibling};
function rt(a,b){var c=b||a.ob.nextSibling,d=0,e=0;if(b&&!st(a,b))throw new D(a.tk,0,b);c instanceof kt?d=c.Bj():c instanceof nt&&(d=c.previousSibling.Bj());for(b=c;b&&b!==a.ob;b=b.nextSibling,e++)b.Ir(d),1===e%2&&(d+=b.Bj())}m.Li=function(a){var b=this.ob.previousSibling,c=this.Bm();a=new kt(a,this.Ia,c?0:2);this.sc.$(a.rd);jt(a,this.ob);a.addEventListener(a.l.uf,this.bn);c?qt(this,a):(tt(this,b,a),lt(b),rt(this,b));return a};
m.insertBefore=function(a,b){var c;var d=1;if(b){if(!st(this,b))throw new D(this.insertBefore,1,b);if(c=b.previousSibling.Ve)d=0;a=new kt(a,this.Ia,d);a.addEventListener(a.l.uf,this.bn);this.sc.$(a.rd);c?(c=this.ob.nextSibling,tt(this,a,c),qt(this,a),b=a,lt(c)):(c=b.previousSibling,b=c.previousSibling,d=c.nextSibling,this.sc.Na(c.rd),tt(this,b,a),tt(this,a,d));rt(this,b)}else a=this.Li(a);return a};m.ja=function(){qt(this,this.ob);this.sc.ja()};
m.tk=function(a){var b=this.ob,c=a.previousSibling,d=a.nextSibling;if(!st(this,a))throw new D(this.tk,0,a);this.sc.Na(a.rd);if(c===b){var e=d;e!==b?(a=e.nextSibling,qt(this,a),a.Ir(0),lt(a),rt(this,a)):qt(this,this.ob)}else d===b?(e=c,a=e.previousSibling,jt(a,b),lt(a)):c&&d&&(tt(this,c.previousSibling,d.nextSibling),this.sc.pg([d.rd,c.rd]),rt(this,c.previousSibling));e&&e!==b&&this.sc.Na(e.rd)};
function st(a,b){for(var c=a.ob.nextSibling,d=!1;c!==a.ob;){if(c===b){d=!0;break}c=c.nextSibling}return d}function tt(a,b,c){b=new nt(b,c,a.Ia);a.sc.$(b.rd)}function qt(a,b){a.ob.nextSibling=b;b.previousSibling=a.ob}m.bn=function(a){a=a.target;var b=a.previousSibling,c=a.nextSibling,d=a.ya();if(!c.Ve){ot(c,d,!1);var e=a}b.Ve||(ot(b,d,!0),e=b.previousSibling);rt(this,e)};var ut={TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right",LEFT_TOP:"left-top",LEFT_MIDDLE:"left-middle",LEFT_BOTTOM:"left-bottom",RIGHT_TOP:"right-top",RIGHT_MIDDLE:"right-middle",RIGHT_BOTTOM:"right-bottom",BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right"};t("H.ui.LayoutAlignment",ut);function vt(){Xs.call(this,"div","H_ctl");this.map=null;this.Ae="top-left"}u(vt,Xs);t("H.ui.Control",vt);vt.prototype.Pa=function(a){this.map=a};vt.prototype.N=function(a){return Xs.prototype.N.call(this,a)};vt.prototype.O=function(a,b){Xs.prototype.renderInternal.call(this,a,b);this.Wc(this.Ae)};vt.prototype.renderInternal=vt.prototype.O;vt.prototype.ek=function(){};vt.prototype.onUnitSystemChange=vt.prototype.ek;vt.prototype.Ic=function(){return this.map};vt.prototype.getMap=vt.prototype.Ic;
vt.prototype.ma=function(){return this.kB};vt.prototype.getLocalization=vt.prototype.ma;vt.prototype.fz=function(){return this.Ae};vt.prototype.getAlignment=vt.prototype.fz;vt.prototype.Wc=function(a){"string"===typeof a&&ut[a.replace("-","_").toUpperCase()]===a&&(this.Ae=a,this.dispatchEvent("alignmentchange"));return this};vt.prototype.setAlignment=vt.prototype.Wc;function wt(a){a=a||{};var b,c=a.lineStyle;vt.call(this);this.Go=new bt({label:et.btn,onStateChange:A(this.bf,this)});this.Ra(this.Go);if(b=a.distanceFormatter)this.Gt=b;c&&(this.ev=c,this.Ov=B);this.Wc(a.alignment||"right-bottom");this.sd={};this.sd[0]=a.startIcon;this.sd[2]=a.endIcon;this.sd[1]=a.stopoverIcon;this.sd[3]=a.splitIcon}u(wt,vt);t("H.ui.DistanceMeasurement",wt);m=wt.prototype;m.Pb=mt.METRIC;m.Ix=22;m.ev={strokeColor:"rgb(39,44,54)",lineWidth:5};m.Ov={strokeColor:"white",lineWidth:7};
m.Mk=function(){var a=this.map,b,c={};this.Oj||(this.qc=new P,this.rb=new Pj(this.qc,{pixelRatio:this.map.mb()}),this.sc=b=this.qc.pd(),this.sc.Rw(!0),b.addEventListener("dragstart",this.zd,!0,this),b.addEventListener("dragend",this.Nk,!0,this),b.addEventListener("pointerenter",this.Nk,!0,this),b.addEventListener("pointerleave",this.Rq,!0,this),b.addEventListener("tap",this.WB,!0,this),this.Pk=xt(this),c.Ft=A(this.Gt,this),c.Cj=A(this.Cj,this),c.Yz=A(this.ku,this),c.map=this.map,c.Yw=this.Pk,c.Jh=
this.ev,c.outlineStyle=this.Ov,this.Wb=new pt(this.sc,c),this.Oj=!0);this.Pk&&this.sc.$(this.Pk);a.addEventListener("tap",this.Hv,!0,this);a.P.add(this.rb)};m.wi=function(){var a=this.map;this.Oj&&(a.removeEventListener("tap",this.Hv,!0,this),a.ei(this.rb),this.Wb.ja())};
function xt(a){function b(){var h=c.lc();h={anchor:c.Cb.clone().scale(f).floor(),size:new Jh(Fb(h.w*f),Fb(h.h*f)),hitArea:d};return new Sh(c.Oe(),h)}var c=a.Cj(3),d=new Ph(Qh.NONE,[]),e,f=c===a.Ds?.5:1;if(1===c.getState())var g=b();else g=new Sh("<svg/>",{hitArea:d}),c.addEventListener("statechange",function(){1===c.getState()&&e.re(b())});return e=new ci(a.map.wb(),{visibility:!1,icon:g})}
m.Gt=function(a){var b="m",c=0;"metric"===this.Pb?1E3<=a&&(a/=1E3,b="km",c=1):(a/=.3048,b="ft",5280<=a&&(a/=5280,b="mi",c=1));return a.toFixed(c)+" "+this.ma().translate("scale."+b)};m.ku=function(a,b,c){var d=this.map.Ka(a);b=this.map.Ka(b);c=(new L(c.x,c.y)).ju(d,b);return this.map.Xa(c.x,c.y)||sc(a)};
m.O=function(a,b){var c=this.map.Ca.type===ph.P2D?this.map.mb():1;c*=this.Ix;var d=c/2;vt.prototype.renderInternal.call(this,a,b);this.Pb=mt.METRIC;this.Ds=new Sh(et.point,{anchor:{x:d,y:d},size:{w:c,h:c},hitArea:new Ph(Qh.CIRCLE,[d,d,d])});this.Go.Dd(this.ma().translate("distance.measurement"))};wt.prototype.renderInternal=wt.prototype.O;m=wt.prototype;m.Cj=function(a){return this.sd[a]||this.Ds};m.Nk=function(){this.Wb.Ik(!0)};m.zd=function(){this.Wb.Ik()};
m.Rq=function(a){"touch"!==a.currentPointer.type&&this.Wb.Ik()};m.WB=function(a){var b=a.currentPointer;var c=a.target.Ma;var d;c&&(c=c.getData())instanceof it&&(d=c);c=d;a=a.originalEvent;a=a.metaKey||a.altKey;c&&(a&&c instanceof kt?this.Wb.tk(c):c instanceof nt&&(a=c.previousSibling.ya(),d=c.nextSibling.ya(),b={x:b.viewportX,y:b.viewportY},this.Wb.insertBefore(this.ku(a,d,b),c.nextSibling),this.Pk.Zb()),this.Nk())};
m.Hv=function(a){var b=a.currentPointer;a=a.target;a!==this.map&&a.getProvider&&a.getProvider()===this.qc||(this.Wb.Li(this.map.Xa(b.viewportX,b.viewportY)),this.Pk.Zb(),this.Nk())};m.bf=function(a){"down"===a.target.getState()?this.Mk():this.wi()};m.ek=function(a){this.Pb=a;this.Oj&&(rt(this.Wb),this.Nk())};wt.prototype.onUnitSystemChange=wt.prototype.ek;wt.prototype.i=function(){this.wi();this.Oj&&(this.qc.u(),this.rb.u());wt.g.i.call(this)};
wt.prototype.Pa=function(a){a?this.Go.getState()===at.DOWN&&(this.map=a,this.Mk()):(this.wi(),this.Oj=!1);vt.prototype.Pa.apply(this,arguments)};wt.prototype.setMap=wt.prototype.Pa;function yt(a){a=a||{};vt.call(this);this.Nh=new bt({label:'<svg xmlns="http://www.w3.org/2000/svg" class="H_icon" viewBox="0 0 24 24"><g transform="translate(1 3)"><path fill-rule="nonzero" d="M5,0 L5,2 L2,2 L2,16 L5,16 L5,18 L2,18 C0.9,18 0,17 0,15.75 L0,2.25 C0,1 0.9,0 2,0 L5,0 Z M17,0 L20,0 C21.1,0 22,1 22,2.25 L22,15.75 C22,17 21.1,18 20,18 L17,18 L17,16 L20,16 L20,2 L17,2 L17,0 Z"></path><rect width="10" height="2" x="6" y="8"></rect><rect width="2" height="10" x="10" y="4"></rect></g></svg>',
onStateChange:A(this.bf,this)});this.Ra(this.Nh);this.Wc(a.alignment||"right-bottom")}u(yt,vt);t("H.ui.ZoomRectangle",yt);m=yt.prototype;
m.bf=function(a){var b=this.map,c=b.pa.element;a.target.getState()===at.DOWN?(b.addEventListener("dragstart",this.zd,!0,this),b.addEventListener("drag",this.cg,!0,this),b.addEventListener("dragend",this.$e,!0,this),a=c.ownerDocument.createElement("div"),a.className="H_zoom_lasso",c.appendChild(a),this.Gm=a):(b.removeEventListener("dragstart",this.zd,!0,this),b.removeEventListener("drag",this.cg,!0,this),b.removeEventListener("dragend",this.$e,!0,this),c.removeChild(this.Gm))};
m.zd=function(a){var b=this.Gm.style,c=a.currentPointer,d=c.viewportX;c=c.viewportY;a.target===this.map&&(a.stopPropagation(),b.width="0px",b.height="0px",b.top=c+"px",b.left=d+"px",b.display="block",this.$w=c,this.Zw=d)};m.cg=function(a){var b=a.currentPointer,c=b.viewportX,d=b.viewportY;b=this.Zw;var e=this.$w,f=this.Gm.style;a.target===this.map&&(a.stopPropagation(),a=c-b,c=d-e,f.left=b+(0>a?a:0)+"px",f.top=e+(0>c?c:0)+"px",f.width=Math.abs(a)+"px",f.height=Math.abs(c)+"px")};
m.$e=function(a){var b=this.map,c=a.currentPointer;a.target===this.map&&(a.stopPropagation(),this.Gm.style.display="none",b.xa.Xc({bounds:Jc([b.Xa(this.Zw,this.$w),b.Xa(c.viewportX,c.viewportY)])},!0))};m.O=function(a,b){vt.prototype.renderInternal.call(this,a,b);this.Nh.Dd(this.ma().translate("zoom.rectangle"))};yt.prototype.renderInternal=yt.prototype.O;function zt(a){a=a||{};vt.call(this);this.$f=new Ys;this.oe=this.oe.bind(this);this.Dl=this.Dl.bind(this);this.nm=this.nm.bind(this);this.Wc(a.alignment||"bottom-right");At(this,a.baseLayers,a.layers)}u(zt,vt);t("H.ui.MapSettingsControl",zt);function Bt(a,b){var c=[];a.concat(b).forEach(function(d){c=c.concat(d.layer)});return c}function Ct(a,b,c){var d=a.Ic();if(d){a=Bt(a.Ce,a.Uf);var e=Bt(b,c);a.forEach(function(f){e.includes(f)||d.ei(f)})}}
function At(a,b,c){Ct(a,b,c);a.qq=NaN;a.Ce=ib(b)?b:[];a.Uf=ib(c)?c:[];a.Rg&&(a.Rg.ja(),a.Lm.ja(),Dt(a))}zt.prototype.subscribe=function(){var a=this.Ic();a&&(a.addEventListener("tap",this.Dl),a=a.P,a.addEventListener("add",this.oe),a.addEventListener("remove",this.oe),a.addEventListener("set",this.oe))};
zt.prototype.unsubscribe=function(){var a=this.Ic();a&&(a.removeEventListener("tap",this.Dl),a=a.P,a.removeEventListener("add",this.oe),a.removeEventListener("remove",this.oe),a.removeEventListener("set",this.oe))};
zt.prototype.O=function(a,b){var c=this.ma().translate("layers.choose");vt.prototype.renderInternal.call(this,a,b);this.subscribe();this.Nh=new bt({tooltip:c,label:'<svg xmlns="http://www.w3.org/2000/svg" class="H_icon" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M6.7,14.6 L4.5,16 L12,20.6 L19.5,16 L17.3,14.6 L19.1,13.5 L23,16 L12,23 L1,16 L4.9,13.5 L6.7,14.6 Z M12,2 L23,9 L12,16 L1,9 L12,2 Z"></path></svg>',onStateChange:A(function(d){d.target.getState()===at.DOWN?(this.$f.G(Zs.OPEN),this.$f.Zv(this)):
this.$f.G(Zs.CLOSED)},this)});zt.prototype.$x=function(d){if(this.map.Ca.type===$m){var e=H.map.render.harp.Style;d=[].concat(d);for(var f=0;!h&&f<d.length;f++){var g=d[f].D;if(g.Tc()&&g.L){g=g.L();var h=g.getConfig()||g.getUrl()}}if(h){var k=function(l){l=l.D;l.Tc()&&l.L&&l.L()instanceof e&&l.Bb(new e(h))};this.Uf.forEach(function(l){l=l.layer;ib(l)?l.forEach(k):l&&k(l)})}}};this.Rg=new ct({title:c,onActiveButtonChange:function(){var d=this.qq;a:{var e=this.Rg.cm();for(var f=e.length;f--;)if(e[f].getState()===
at.DOWN){e=e[f];break a}e=null}e=e.getData();e=this.Ce[e].layer;f=ib(e);this.map.xg(f?e[0]:e);if(d=this.Ce[d])if(d=d.layer,ib(d))for(var g=d.length;1<g--;)this.map.ei(d[g]);if(f)for(d=e.length;1<d--;)this.map.rl(e[d],1);this.$x(e);this.nm()}.bind(this)});this.Lm=new Xs("div","H_grp");this.vu=new Y("div","H_separator");this.Ra(this.Nh);this.Ra(this.$f);this.$f.Ra(this.Rg);this.$f.Ra(this.vu);this.$f.Ra(this.Lm);Dt(this)};zt.prototype.renderInternal=zt.prototype.O;
function Dt(a){var b=a.ma();a.Ce.forEach(function(c,d){var e=c.layer;this.Rg.to(new bt({label:Et(b,c.label),data:d,disabled:!e||ib(e)&&!e.length}))},a);a.Uf.forEach(function(c,d){var e=c.layer;this.Lm.Ra(new bt({label:Et(b,c.label),onStateChange:this.PB.bind(this,c.layer),data:d,disabled:!e||ib(e)&&!e.length}))},a);a.vu.Zb(!(!a.Uf.length||!a.Ce.length));x.setTimeout(function(){this.map&&(this.oe(),this.Nh.wa(!(this.Ce&&this.Ce.length||this.Uf&&this.Uf.length)))}.bind(a))}
zt.prototype.oe=function(){var a=this.map.qa,b=this.map.P;this.qq=NaN;this.Ce.forEach(function(c,d){c=c.layer;c=a===(ib(c)?c[0]:c);this.Rg.cm()[d].G(at[c?"DOWN":"UP"],!0);c&&(this.qq=d)},this);this.Uf.forEach(function(c,d){c=c.layer;var e=ib(c);d=this.Lm.xp()[d];!c||e&&!c.length?d.wa(!0):d.G(at[-1!==b.indexOf(e?c[0]:c)?"DOWN":"UP"],!0)},this)};zt.prototype.PB=function(a,b){a=ib(a)?a:[a];b=b.target.getState()===at.DOWN;for(var c=0;c<a.length;c++)b?this.map.rl(a[c]):this.map.ei(a[c]);this.nm()};
zt.prototype.nm=function(){var a=Ft(this);a&&(a.qo.D.L().Wj(a.D.L().Pd()),this.map.ei(a),a.u(),delete a.qo);Gt(this)&&Ht(this,this.map.qa)};
function Ht(a,b){var c=window.H.service&&window.H.service.omv.Provider,d=b.D;if(c&&b.D instanceof c&&d.L().qj){var e=d.L(),f=function(){var g=It.ground.filter(function(l){return!!e.Kp("layers."+l)}),h=It.water.filter(function(l){return!!e.Kp("layers."+l)});if(g.concat(h).length){var k={};pg(k,e.qj(g));pg(k,e.qj(h,!1,!0));delete k.global;g=new Zg(k,e.Fc());g=d.aa.kd(g);g.qo=b;this.map.rl(g)}e.removeEventListener(ng.CHANGE,f)}.bind(a);e.getState()!==lg.READY?e.addEventListener(ng.CHANGE,f):
f()}}function Ft(a){return zs(a.map.P.Ta(),function(b){return!!b.qo})}function Gt(a){a=a.map.P.Ta();var b=window.H.service&&window.H.service.traffic.flow.Provider;return!!b&&a.some(function(c){return c.D instanceof b})}var It={water:["water.water-labels"],ground:"road_labels continent_label island_label roads.shields roads.directions truck-restriction.signs places landuse.label".split(" ")};function Et(a,b){return/^layers?/.test(b)&&a.qm(b)?a.translate(b):b}zt.prototype.Dl=function(){this.Nh.G(at.UP)};
zt.prototype.i=function(){zt.g.i.call(this);this.unsubscribe()};var Jt={"in":'<svg version="1.1" class="H_icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g><path d="m5 10.6h5.6v-5.6h2.8v5.6h5.6v2.8h-5.6v5.6h-2.8v-5.6h-5.6v-2.8z"></path></g></svg>',out:'<svg version="1.1" class="H_icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><path d="m5 10.6h14v2.8h-14z"/></svg>'};function Kt(a){a=a||{};var b;this.tf=!!a.vertical;this.dB=a.length||this.Jx;this.zb=ob(b=a.min)?b:this.Lx;this.Nc=Db(this.zb,ob(b=a.max)?b:this.Kx);this.ZC=E(b=a.step)?this.Mx:b;this.Ai=Lt(this,ob(b=a.value)?b:(this.zb+this.Nc)/2);this.cn=A(this.cn,this);this.ee=A(this.ee,this);this.en=A(this.en,this);this.dn=A(this.dn,this);this.hk=a.pointerArea;Y.call(this,"div","H_slider"+(this.tf?"":" H_l_horizontal"))}u(Kt,Y);t("H.ui.base.Slider",Kt);m=Kt.prototype;m.Is=1;m.Lx=0;m.Kx=100;
m.Mx=1;m.Jx="16em";m.Yn=function(a,b){var c=this.tf,d=c?"top":"left";if(!this.Ja||b)a=ec(a,this.zb,this.Nc),this.Hh&&(b=100*(a-this.zb)/(this.Nc-this.zb),c=(c?-1:1)*b,this.Hh.style[d]=c+"%",this.pD.style[d]=100+c+"%"),this.Ai=Lt(this,a);return this.Ai};Kt.prototype.setValue=Kt.prototype.Yn;Kt.prototype.AA=function(){return this.Ai};Kt.prototype.getValue=Kt.prototype.AA;m=Kt.prototype;
m.Mk=function(){if(!this.eq){Ss(this.F(),"start",this.cn);var a=this.hk;Ss(a,"move",this.ee);Ss(a,"end",this.en);Ss(a,"out",this.dn);this.eq=!0}};m.wi=function(){if(this.eq){Ts(this.F(),"start",this.cn);var a=this.hk;Ts(a,"move",this.ee);Ts(a,"end",this.en);Ts(a,"out",this.dn);this.eq=!1}};function Lt(a,b){var c=a.ZC;b=ec(b,a.zb,a.Nc);return c?a.zb+Eb((b-a.zb)/c)*c:b}
function Mt(a,b){var c=a.tx,d=a.tf;a.sx||(a.sx=c["offset"+(d?"Height":"Width")]);b-=Bs(c)[d?"y":"x"];0>b&&(b=0);b=(a.Nc-a.zb)*b/a.sx;b=Lt(a,d?a.Nc-b:a.zb+b);a.Ai!==b&&(a.Yn(b,!0),a.dispatchEvent(new nh(a.l.uf,b,a.Ai)))}function Nt(a,b){return(b.touches?b.targetTouches[0]:b)["page"+(a.tf?"Y":"X")]}function Ot(a,b){var c=!1,d=a.type;-1!==d.indexOf("pointer")||-1!==d.indexOf("touch")?c=!0:C(a,MouseEvent)&&(c=a.which===b||a.buttons===b);return c}
function Pt(a){var b=a.touches;return b&&1===b.length||C(a,MouseEvent)}m.cn=function(a){var b=this.tf;if(Ot(a,this.Is)&&Pt(a)){var c=Nt(this,a);var d=a.target;d===this.Hh||d.parentElement===this.Hh?(this.YA=c-Bs(this.Hh)[b?"y":"x"]-this.Hh.offsetWidth/2,this.F().className="H_slider H_slider_active"+(this.tf?"":" H_l_horizontal"),this.Ja=!0):Mt(this,c);a.preventDefault()}};m.en=function(){this.Ja&&(this.F().className="H_slider "+(this.tf?"":" H_l_horizontal"),this.Ja=!1)};
m.dn=function(a){this.Ja&&a.target===this.hk&&(this.Ja=!1)};m.ee=function(a){this.Ja&&Pt(a)&&(Ot(a,this.Is)?(Mt(this,Nt(this,a)-this.YA),a.preventDefault()):this.Ja=!1)};m.l={uf:"change"};
m.O=function(a,b){var c=Ps(b,"div","H_slider_cont"),d=Ps(b,"div","H_slider_knob_cont"),e=Ps(b,"div","H_slider_knob"),f=Ps(b,"div","H_slider_knob_halo"),g=Ps(b,"div","H_slider_track");b=Ps(b,"div","H_slider_track H_slider_track_active");a.appendChild(c);c.appendChild(g);g.appendChild(b);c.appendChild(d);d.appendChild(e);d.appendChild(f);this.tx=g;this.pD=b;this.Hh=d;this.hk||(this.hk=a.ownerDocument.body);c.style[this.tf?"height":"width"]=this.dB;this.Yn(this.Ai);
this.Mk()};Kt.prototype.renderInternal=Kt.prototype.O;Kt.prototype.i=function(){this.wi()};Kt.prototype.wa=function(a,b){a?this.wi():this.tx&&this.Mk();return Y.prototype.wa.call(this,a,b)};Kt.prototype.setDisabled=Kt.prototype.wa;function Qt(a){a=a||{};var b=a.slider;vt.call(this);this.kn=A(this.kn,this);this.fl=A(this.fl,this);this.Hd=A(this.Hd,this);b&&(this.Sq=A(this.Sq,this),this.yu=b,this.YC=a.sliderSnaps,this.Sa("H_zoom_slider"));this.jl=new $s({label:Jt["in"],onStateChange:this.kn});this.no=new $s({label:Jt.out,onStateChange:this.kn});this.Sa("H_zoom");this.Sa("H_grp");this.$y=!1!==a.fractionalZoom;this.setZoomSpeed(a.zoomSpeed||4);this.Wc(a.alignment||"right-middle")}u(Qt,vt);
t("H.ui.ZoomControl",Qt);Qt.prototype.FA=function(){return this.Dx};Qt.prototype.getZoomSpeed=Qt.prototype.FA;Qt.prototype.UC=function(a){this.Dx=a};Qt.prototype.setZoomSpeed=Qt.prototype.UC;Qt.prototype.Pa=function(a){this.map!==a&&(this.map&&this.map.removeEventListener("mapviewchange",this.fl),Rt(this));vt.prototype.Pa.apply(this,arguments);this.map&&(this.Hd(),a.addEventListener("mapviewchange",this.fl),a.addEventListener("baselayerchange",this.Hd))};Qt.prototype.setMap=Qt.prototype.Pa;
Qt.prototype.i=function(){vt.prototype.i.apply(this,arguments);this.map.removeEventListener("baselayerchange",this.Hd);Rt(this)};Qt.prototype.O=function(a,b){vt.prototype.renderInternal.call(this,a,b);this.jl.Dd(this.ma().translate("zoom.in"));this.no.Dd(this.ma().translate("zoom.out"))};Qt.prototype.renderInternal=Qt.prototype.O;Qt.prototype.Wc=function(a){var b=this.Ae;vt.prototype.Wc.call(this,a);b!==a&&this.Hd();return this};Qt.prototype.setAlignment=Qt.prototype.Wc;
Qt.prototype.fl=function(){var a=this.map,b=a.Tb(),c=a.mb()-1;a=a.qa||a.Ca.getCapabilities().lookAt.zoom;this.yu&&this.ri.Yn(b);this.Db||(this.jl.wa(b+c>=a.max),this.no.wa(b<=a.min))};Qt.prototype.wa=function(a,b){Qt.g.wa.call(this,a,b);this.fl();return this};Qt.prototype.setDisabled=Qt.prototype.wa;function Rt(a){a.removeChild(a.ri);a.ri=null;a.qa&&(a.qa.removeEventListener("minchange",a.Hd),a.qa.removeEventListener("maxchange",a.Hd),a.qa=null)}
Qt.prototype.kn=function(a){a=a.target;var b=a===this.jl?1:-1,c=0<b?Math.ceil:Math.floor,d=this.map,e,f=this;d&&("down"===a.getState()?(d.xa.startControl(),d.xa.control(0,0,b*this.Dx,0,0,0)):d.xa.endControl(!0,function(g){e=f.$y?g.zoom:c(g.zoom);g.zoom=e}))};Qt.prototype.Sq=function(a){this.map&&this.map.Lk(a.newValue)};
Qt.prototype.Hd=function(){var a=this.Ae,b=this.Ic();if(/^top/g.test(a)||/^bottom/g.test(a)){var c=this.no;a=this.jl;var d=!1}else c=this.jl,a=this.no,d=!0;this.removeChild(c);this.removeChild(a);this.Ra(c);if(this.yu&&b){Rt(this);b=d;var e=(d=(c=this.map)&&c.qa)||c.Ca.getCapabilities().lookAt.zoom;if(this.qa=d)d.addEventListener("minchange",this.Hd),d.addEventListener("maxchange",this.Hd);this.ri=new Kt({step:this.YC?1:0,vertical:b,min:e.min,max:e.max,value:c.Tb(),pointerArea:c.F()});this.ri.addEventListener(this.ri.l.uf,
this.Sq);this.Ra(this.ri)}this.Ra(a)};function St(a){C(a,Ce,St,1);Y.call(this,"div","H_context_menu_item");this.Wb=a;this.Vm=A(this.Vm,this);this.ye=A(this.ye,this);this.Wb.addEventListener("update",this.ye)}u(St,Y);t("H.ui.context.Item",St);St.prototype.Vm=function(a){var b=this.Wb,c=b.callback;c&&!b.isDisabled()&&(this.dispatchEvent("click"),c(a))};St.prototype.O=function(){var a=this,b=this.F();qe(b,"click",this.Vm);b.addEventListener("keyup",function(c){13==c.keyCode&&a.Vm(c)});this.ye()};St.prototype.renderInternal=St.prototype.O;
St.prototype.ye=function(){var a=this.F(),b=this.Wb;b.callback?(this.Sa("clickable"),a.setAttribute("tabindex","0")):(this.Mb("clickable"),a.removeAttribute("tabindex"));b.isDisabled()?this.Sa("disabled"):this.Mb("disabled");b=b.getLabel();Js.textContent=b;a.innerHTML=Js.innerHTML.split("\n").join("<br/>")};St.prototype.i=function(){Y.prototype.i.call(this);this.Wb.removeEventListener("update",this.ye)};function Tt(a){C(a,Array,Tt,1);Xs.call(this,"div","H_context_menu");this.rB=a;this.v=null}u(Tt,Xs);t("H.ui.context.Menu",Tt);Tt.prototype.O=function(){Xs.prototype.O.apply(this,arguments);this.rB.forEach(function(a){a===De?a=new Y("div","H_context_menu_item_separator"):(a=new St(a),a.addEventListener("click",this.OB.bind(this)));this.Ra(a)},this);qe(this.F(),["mousedown","touchstart","pointerdown","wheel"],function(a){a.stopPropagation()})};Tt.prototype.renderInternal=Tt.prototype.O;
Tt.prototype.setPosition=function(a,b){if(this.v){var c=this.F();var d=c.offsetWidth;var e=c.offsetHeight;var f=this.v;var g=f.pa.width;f=f.pa.height;a+d>g&&a>g/2&&(a-=d);b+e>f&&b>f/2&&(b-=e);Cs(c,a,b)}};Tt.prototype.setPosition=Tt.prototype.setPosition;Tt.prototype.OB=function(){this.v&&this.v.dispatchEvent(new ie("contextmenuclose",this.v))};Tt.prototype.Pa=function(a){this.v=a};Tt.prototype.setMap=Tt.prototype.Pa;function Ut(a){a=a||{};vt.call(this);this.Sa("H_scalebar");this.Wc(a.alignment||"right-bottom");this.maxWidth=150;this.update=A(this.update,this);this.Uu=this.Dr=this.Ck=this.Uk=null}u(Ut,vt);t("H.ui.ScaleBar",Ut);
Ut.prototype.O=function(a,b){vt.prototype.renderInternal.call(this,a,b);a.innerHTML='<svg height="12" version="1.1" xmlns="http://www.w3.org/2000/svg"><polyline style="fill:none; stroke:white; stroke-width:4" points="2,2 2,10 98,10 98,2"/><polyline style="fill:none; stroke:black; stroke-width:2" points="2,2 2,10 98,10 98,2"/></svg><div style="padding: 0 0 0 10px"></div>';a.style.direction="ltr";this.Uk=a.firstChild;b=this.Uk.childNodes;this.Ck=b[0];this.Dr=b[1];this.Uu=a.lastChild;this.Pb=mt.METRIC;
this.My=A(function(c){this.Db||(this.dispatchEvent("toggleunitsystem"),c.preventDefault())},this);this.hn=A(function(c){c.preventDefault()},this);Ss(a,"start",this.hn);Ss(a,"end",this.My);this.Dd(this.ma().translate("scale.switchToImperial"));this.update()};Ut.prototype.renderInternal=Ut.prototype.O;Ut.prototype.Pa=function(a){this.map&&this.map.removeEventListener("mapviewchange",this.update);a&&a.addEventListener("mapviewchange",this.update);vt.prototype.Pa.apply(this,arguments)};
Ut.prototype.setMap=Ut.prototype.Pa;
Ut.prototype.capture=function(a,b,c){var d=this.F();var e=d.ownerDocument,f=e.createElement("canvas"),g=f.getContext("2d"),h=e.createElementNS("http://www.w3.org/2000/svg","svg"),k=e.createElementNS("http://www.w3.org/2000/svg","foreignObject"),l=af(d,e,!1);e=parseFloat(d.offsetWidth)+1;var n=parseFloat(d.offsetHeight),p=e*a;a*=n;f.width=p;f.height=a;h.setAttribute("xmlns","http://www.w3.org/2000/svg");h.setAttribute("width",p);h.setAttribute("height",a);h.setAttribute("viewBox","0 0 "+e+" "+n);k.setAttribute("width",
"100%");k.setAttribute("height","100%");h.appendChild(k);l.setAttribute("width","100%");l.setAttribute("height","100%");l.setAttribute("xmlns","http://www.w3.org/1999/xhtml");var q=window.getComputedStyle(d);"box-shadow display align-items font font-family font-size height text-shadow direction".split(" ").forEach(function(r){l.style.setProperty(r,q.getPropertyValue(r))});k.appendChild(l);d=Re(h.outerHTML);(new Tg("image",d)).then(function(r){g.drawImage(r,0,0);b(f)},c)};Ut.prototype.capture=Ut.prototype.capture;
Ut.prototype.ek=function(a){this.Pb=a;this.Dd("imperial"===a?this.ma().translate("scale.switchToMetric"):this.ma().translate("scale.switchToImperial"));this.update()};Ut.prototype.onUnitSystemChange=Ut.prototype.ek;
Ut.prototype.update=function(){var a;if(this.F()){this.Uk=this.Uk;this.Ck=this.Ck;var b=this.maxWidth;var c=0;var d=this.map;if(d){var e=Math.round(.5*d.pa.width);var f=Math.round(.5*d.pa.height);(a=d.Xa(e,f))&&(d=d.Xa(e+1,f))&&(c=100*a.lb(d))}c&&(this.Pb===mt.IMPERIAL?1609.344>c?(d=c/.3048006,a=this.ma().translate("scale.ft")):(d=c/1609.344,a=this.ma().translate("scale.mi")):1E3>c?(d=c,a=this.ma().translate("scale.m")):(d=c/1E3,a=this.ma().translate("scale.km")),c=Math.pow(10,Math.floor(Math.log(d)/
Math.LN10)),d=c/d*100,d<b/5?(c*=5,d*=5):d<b/2?(c*=2,d*=2):d>b&&(c/=2,d/=2),d=Math.round(d),this.Uk.setAttribute("width",d),this.Uu.textContent=c+" "+a,this.Ck.points.getItem(2).x=this.Dr.points.getItem(2).x=this.Ck.points.getItem(3).x=this.Dr.points.getItem(3).x=d-2)}};var Vt=[];t("H.ui.i18n.defaultLocales",Vt);var Wt={},Xt=[];function Yt(a,b){Wt[a]=b;-1===Vt.indexOf(a)&&Vt.push(a);Xt.length?Zt(a,b):Xt=Object.keys(b)}function Zt(a,b){for(var c=Xt,d=c.length,e;d--;)if(e=c[d],!b[e])throw Error("'"+e+"' key missing in translation map for "+a);};Yt("tr-TR",{"layers.normal":"Harita g\u00f6r\u00fcn\u00fcm\u00fc","layers.satellite":"Uydu","layers.terrain":"Arazi","layer.transit":"Toplu ula\u015f\u0131m","layer.traffic":"Trafik durumlar\u0131","layer.incidents":"Trafik olaylar\u0131n\u0131 g\u00f6ster","layers.choose":"G\u00f6r\u00fcn\u00fcm se\u00e7",minimap:"Minimap","scale.switchToImperial":"Mile d\u00f6n\u00fc\u015ft\u00fcr","scale.switchToMetric":"Kilometreye d\u00f6n\u00fc\u015ft\u00fcr","scale.km":"km","scale.m":"m","scale.mi":"mil","scale.ft":"ft",
"zoom.out":"Uzakla\u015ft\u0131r","zoom.in":"Yak\u0131nla\u015ft\u0131r","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Toplu ula\u015f\u0131m","traffic.MISCELLANEOUS":"\u00c7e\u015fitli","traffic.ACCIDENT":"Kaza","traffic.OTHER_NEWS":"Di\u011fer haberler","traffic.OTHER":"Di\u011fer haberler","traffic.PLANNED_EVENT":"Planl\u0131 etkinlik","traffic.ROAD_HAZARD":"Yol tehlikesi","traffic.ROAD_CLOSURE":"Yol kapal\u0131","traffic.WEATHER":"Hava durumu","traffic.CONGESTION":"Yo\u011funluk",
"traffic.CONSTRUCTION":"Yol \u00e7al\u0131\u015fmas\u0131","traffic.DISABLED_VEHICLE":"Ara\u00e7 ar\u0131zas\u0131","traffic.LANE_RESTRICTION":"\u015eerit k\u0131s\u0131tlamas\u0131","traffic.from":"Ba\u015flang\u0131\u00e7 zaman\u0131:","traffic.until":"Tahmini biti\u015f zaman\u0131:","distance.measurement":"Measure distance"});Yt("fr-FR",{"layers.normal":"Carte","layers.satellite":"Satellite","layers.terrain":"Terrain","layer.transit":"Transports publics","layer.traffic":"Conditions de circulation","layer.incidents":"Afficher les incidents de circulation","layers.choose":"Choisir la vue",minimap:"Minimap","scale.switchToImperial":"Passer en miles","scale.switchToMetric":"Passer en km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom arri\u00e8re","zoom.in":"Zoom avant","zoom.rectangle":"Zoom rectangle",
"traffic.MASS_TRANSIT":"Transports publics","traffic.MISCELLANEOUS":"Divers","traffic.ACCIDENT":"Accident","traffic.OTHER_NEWS":"Autre","traffic.OTHER":"Autre","traffic.PLANNED_EVENT":"\u00c9v\u00e9nement pr\u00e9vu","traffic.ROAD_HAZARD":"Danger routier","traffic.ROAD_CLOSURE":"Chauss\u00e9e ferm\u00e9e","traffic.WEATHER":"M\u00e9t\u00e9o","traffic.CONGESTION":"Embouteillage","traffic.CONSTRUCTION":"Travaux","traffic.DISABLED_VEHICLE":"V\u00e9hicule en panne","traffic.LANE_RESTRICTION":"Restriction de voie",
"traffic.from":"Date ou heure de d\u00e9but:","traffic.until":"Date et heure de fin estim\u00e9es:","distance.measurement":"Measure distance"});Yt("it-IT",{"layers.normal":"Vista mappa","layers.satellite":"Satellite","layers.terrain":"Terreno","layer.transit":"Mezzi pubblici","layer.traffic":"Condizioni del traffico","layer.incidents":"Mostra incidenti stradali","layers.choose":"Scegli vista",minimap:"Minimap","scale.switchToImperial":"Passa a miglia","scale.switchToMetric":"Passa a km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom indietro","zoom.in":"Zoom avanti","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Mezzi pubblici",
"traffic.MISCELLANEOUS":"Varie","traffic.ACCIDENT":"Incidente","traffic.OTHER_NEWS":"Altre notizie","traffic.OTHER":"Altre notizie","traffic.PLANNED_EVENT":"Evento pianificato","traffic.ROAD_HAZARD":"Strada dissestata","traffic.ROAD_CLOSURE":"Strada chiusa","traffic.WEATHER":"Maltempo","traffic.CONGESTION":"Ingorgo","traffic.CONSTRUCTION":"Lavori in corso","traffic.DISABLED_VEHICLE":"Veicolo in panne","traffic.LANE_RESTRICTION":"Restrizione di corsia","traffic.from":"Ora di inizio:","traffic.until":"Ora di fine stimata:",
"distance.measurement":"Measure distance"});Yt("ru-RU",{"layers.normal":"\u0420\u0435\u0436\u0438\u043c \u043a\u0430\u0440\u0442\u044b","layers.satellite":"\u0421\u043f\u0443\u0442\u043d\u0438\u043a\u043e\u0432\u0430\u044f","layers.terrain":"\u041c\u0435\u0441\u0442\u043d\u043e\u0441\u0442\u044c","layer.transit":"\u041e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442","layer.traffic":"\u0414\u043e\u0440\u043e\u0436\u043d\u044b\u0435 \u0443\u0441\u043b\u043e\u0432\u0438\u044f",
"layer.incidents":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0434\u043e\u0440\u043e\u0436\u043d\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f","layers.choose":"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0438\u0434",minimap:"Minimap","scale.switchToImperial":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043c\u0438\u043b\u0438","scale.switchToMetric":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043a\u0438\u043b\u043e\u043c\u0435\u0442\u0440\u044b",
"scale.km":"\u043a\u043c","scale.m":"\u043c","scale.mi":"\u043c\u0438\u043b\u044c","scale.ft":"\u0444\u0443\u0442","zoom.out":"\u041e\u0442\u0434\u0430\u043b\u0438\u0442\u044c","zoom.in":"\u041f\u0440\u0438\u0431\u043b\u0438\u0437\u0438\u0442\u044c","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"\u041e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442","traffic.MISCELLANEOUS":"\u041f\u0440\u043e\u0447\u0435\u0435 \u0414\u0422\u041f",
"traffic.ACCIDENT":"\u0414\u0422\u041f","traffic.OTHER_NEWS":"\u0414\u0440\u0443\u0433\u0438\u0435 \u043d\u043e\u0432\u043e\u0441\u0442\u0438","traffic.OTHER":"\u0414\u0440\u0443\u0433\u0438\u0435 \u043d\u043e\u0432\u043e\u0441\u0442\u0438","traffic.PLANNED_EVENT":"\u041f\u043b\u0430\u043d\u043e\u0432\u043e\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435","traffic.ROAD_HAZARD":"\u0414\u043e\u0440\u043e\u0436\u043d\u0430\u044f \u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c",
"traffic.ROAD_CLOSURE":"\u0414\u043e\u0440\u043e\u0433\u0430 \u0437\u0430\u043a\u0440\u044b\u0442\u0430","traffic.WEATHER":"\u041f\u043e\u0433\u043e\u0434\u0430","traffic.CONGESTION":"\u041f\u0440\u043e\u0431\u043a\u0430","traffic.CONSTRUCTION":"\u0420\u0435\u043c\u043e\u043d\u0442","traffic.DISABLED_VEHICLE":"\u041d\u0435\u0438\u0441\u043f\u0440\u0430\u0432\u043d\u044b\u0439 \u0430\u0432\u0442\u043e\u043c\u043e\u0431\u0438\u043b\u044c","traffic.LANE_RESTRICTION":"\u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u043e\u0441\u044b \u0434\u0432\u0438\u0436\u0435\u043d\u0438\u044f",
"traffic.from":"\u0412\u0440\u0435\u043c\u044f \u043d\u0430\u0447\u0430\u043b\u0430:","traffic.until":"\u041e\u0436\u0438\u0434\u0430\u0435\u043c\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f:","distance.measurement":"\u0418\u0437\u043c\u0435\u0440\u0438\u0442\u044c \u0440\u0430\u0441\u0441\u0442\u043e\u044f\u043d\u0438\u0435"});Yt("pt-BR",{"layers.normal":"Exibi\u00e7\u00e3o do mapa","layers.satellite":"Sat\u00e9lite","layers.terrain":"Terreno","layer.transit":"Transporte p\u00fablico","layer.traffic":"Condi\u00e7\u00f5es do tr\u00e2nsito","layer.incidents":"Mostrar incidentes no tr\u00e2nsito","layers.choose":"Escolher exibi\u00e7\u00e3o",minimap:"Minimap","scale.switchToImperial":"Mudar para milhas","scale.switchToMetric":"Mudar para km","scale.km":"km","scale.m":"m","scale.mi":"milhas","scale.ft":"p\u00e9s","zoom.out":"Menos zoom",
"zoom.in":"Mais zoom","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transporte p\u00fablico","traffic.MISCELLANEOUS":"Miscel\u00e2nea","traffic.ACCIDENT":"Acidente","traffic.OTHER_NEWS":"Outras not\u00edcias","traffic.OTHER":"Outras not\u00edcias","traffic.PLANNED_EVENT":"Evento planejado","traffic.ROAD_HAZARD":"Risco na estrada","traffic.ROAD_CLOSURE":"Estrada fechada","traffic.WEATHER":"Clima","traffic.CONGESTION":"Congestionamento","traffic.CONSTRUCTION":"Constru\u00e7\u00e3o","traffic.DISABLED_VEHICLE":"Ve\u00edculo incapacitado",
"traffic.LANE_RESTRICTION":"Restri\u00e7\u00e3o de pista","traffic.from":"Hora de in\u00edcio:","traffic.until":"Tempo final estimado:","distance.measurement":"Measure distance"});Yt("es-ES",{"layers.normal":"Mapa","layers.satellite":"Sat\u00e9lite","layers.terrain":"Terreno","layer.transit":"Transporte p\u00fablico","layer.traffic":"Estado del tr\u00e1fico","layer.incidents":"Mostrar incidentes de tr\u00e1fico","layers.choose":"Elija una vista",minimap:"Minimap","scale.switchToImperial":"Cambiar a millas","scale.switchToMetric":"Cambiar a km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Alejar","zoom.in":"Acercar","zoom.rectangle":"Zoom rectangle",
"traffic.MASS_TRANSIT":"Transporte p\u00fablico","traffic.MISCELLANEOUS":"Varios","traffic.ACCIDENT":"Accidente","traffic.OTHER_NEWS":"M\u00e1s noticias","traffic.OTHER":"M\u00e1s noticias","traffic.PLANNED_EVENT":"Acto programado","traffic.ROAD_HAZARD":"Riesgo en carretera","traffic.ROAD_CLOSURE":"Carretera cerrada","traffic.WEATHER":"Tiempo","traffic.CONGESTION":"Atasco","traffic.CONSTRUCTION":"Construcci\u00f3n","traffic.DISABLED_VEHICLE":"Veh\u00edculo averiado","traffic.LANE_RESTRICTION":"Restricci\u00f3n de carril",
"traffic.from":"Inicio:","traffic.until":"Finalizaci\u00f3n estimada:","distance.measurement":"Measure distance"});Yt("pl-PL",{"layers.normal":"Widok mapy","layers.satellite":"Satelita","layers.terrain":"Teren","layer.transit":"Transport publiczny","layer.traffic":"Warunki drogowe","layer.incidents":"Poka\u017c zdarzenia drogowe","layers.choose":"Wybierz widok",minimap:"Minimap","scale.switchToImperial":"Zmie\u0144 na mile","scale.switchToMetric":"Zmie\u0144 na km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Oddal","zoom.in":"Przybli\u017c","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transport publiczny",
"traffic.MISCELLANEOUS":"Inne zdarzenie","traffic.ACCIDENT":"Wypadek","traffic.OTHER_NEWS":"Inne wiadomo\u015bci","traffic.OTHER":"Inne wiadomo\u015bci","traffic.PLANNED_EVENT":"Zdarzenie planowane","traffic.ROAD_HAZARD":"Niebezpiecze\u0144stwo na drodze","traffic.ROAD_CLOSURE":"Jezdnia zamkni\u0119ta","traffic.WEATHER":"Pogoda","traffic.CONGESTION":"Korek","traffic.CONSTRUCTION":"Budowa","traffic.DISABLED_VEHICLE":"Uszkodzony pojazd","traffic.LANE_RESTRICTION":"Ograniczenie pasa ruchu","traffic.from":"Data rozpocz\u0119cia:",
"traffic.until":"Przybli\u017cona data zako\u0144czenia:","distance.measurement":"Measure distance"});Yt("en-US",{"layers.normal":"Map view","layers.satellite":"Satellite","layers.terrain":"Terrain","layer.transit":"Public transport","layer.traffic":"Traffic conditions","layer.incidents":"Show traffic incidents","layers.choose":"Choose view",minimap:"Minimap","scale.switchToImperial":"Change to miles","scale.switchToMetric":"Change to km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom out","zoom.in":"Zoom in","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Public transport",
"traffic.MISCELLANEOUS":"Miscellaneous","traffic.ACCIDENT":"Accident","traffic.OTHER_NEWS":"Other news","traffic.OTHER":"Other news","traffic.PLANNED_EVENT":"Planned event","traffic.ROAD_HAZARD":"Road hazard","traffic.ROAD_CLOSURE":"Roadway closed","traffic.WEATHER":"Weather","traffic.CONGESTION":"Congestion","traffic.CONSTRUCTION":"Construction","traffic.DISABLED_VEHICLE":"Disabled vehicle","traffic.LANE_RESTRICTION":"Lane restriction","traffic.from":"Start time:","traffic.until":"Estimated end time:",
"distance.measurement":"Measure distance"});Yt("de-DE",{"layers.normal":"Kartenansicht","layers.satellite":"Satellit","layers.terrain":"Gel\u00e4nde","layer.transit":"\u00d6ffentliche Verkehrsmittel","layer.traffic":"Verkehrslage","layer.incidents":"Verkehrsst\u00f6rungen anzeigen","layers.choose":"Ansicht ausw\u00e4hlen",minimap:"Minimap","scale.switchToImperial":"Umrechnung in Meilen","scale.switchToMetric":"Umrechnung in Kilometer","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Verkleinern","zoom.in":"Vergr\u00f6\u00dfern",
"zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"\u00d6ffentliche Verkehrsmittel","traffic.MISCELLANEOUS":"Diverse","traffic.ACCIDENT":"Unfall","traffic.OTHER_NEWS":"Anderes Ereignis","traffic.OTHER":"Anderes Ereignis","traffic.PLANNED_EVENT":"Geplantes Ereignis","traffic.ROAD_HAZARD":"Verkehrshindernis","traffic.ROAD_CLOSURE":"Fahrbahn gesperrt","traffic.WEATHER":"Wetter","traffic.CONGESTION":"Verkehrsstau","traffic.CONSTRUCTION":"Baustelle","traffic.DISABLED_VEHICLE":"Liegengebliebenes Fahrzeug",
"traffic.LANE_RESTRICTION":"Fahrstreifensperrung","traffic.from":"Beginn:","traffic.until":"Voraussichtliches Ende:","distance.measurement":"Measure distance"});Yt("fi-FI",{"layers.normal":"Karttan\u00e4kym\u00e4","layers.satellite":"Satelliitti","layers.terrain":"Maasto","layer.transit":"Julkinen liikenne","layer.traffic":"Liikenneolosuhteet","layer.incidents":"N\u00e4yt\u00e4 liikennetapahtumat","layers.choose":"Valitse n\u00e4kym\u00e4",minimap:"Minimap","scale.switchToImperial":"Vaihda maileihin","scale.switchToMetric":"Vaihda kilometreihin","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Loitonna","zoom.in":"L\u00e4henn\u00e4",
"zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Julkinen liikenne","traffic.MISCELLANEOUS":"Erittelem\u00e4t\u00f6n syy","traffic.ACCIDENT":"Onnettomuus","traffic.OTHER_NEWS":"Muu tapahtuma","traffic.OTHER":"Muu tapahtuma","traffic.PLANNED_EVENT":"Suunniteltu tapahtuma","traffic.ROAD_HAZARD":"Vaara tiell\u00e4","traffic.ROAD_CLOSURE":"Tie suljettu","traffic.WEATHER":"S\u00e4\u00e4","traffic.CONGESTION":"Ruuhka","traffic.CONSTRUCTION":"Rakennusty\u00f6","traffic.DISABLED_VEHICLE":"Pys\u00e4htynyt ajoneuvo",
"traffic.LANE_RESTRICTION":"Kaista rajoitus","traffic.from":"Alkamisaika:","traffic.until":"Arvioitu p\u00e4\u00e4ttymisaika:","distance.measurement":"Measure distance"});Yt("nl-NL",{"layers.normal":"Kaartweergave","layers.satellite":"Satelliet","layers.terrain":"Terrein","layer.transit":"Openbaar vervoer","layer.traffic":"Verkeerssituatie","layer.incidents":"Toon verkeersincidenten","layers.choose":"Weergave kiezen",minimap:"Minimap","scale.switchToImperial":"Overgaan naar mijlen","scale.switchToMetric":"Wijzigen naar km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Uitzoomen","zoom.in":"Inzoomen","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Openbaar vervoer",
"traffic.MISCELLANEOUS":"Diversen","traffic.ACCIDENT":"Ongeval","traffic.OTHER_NEWS":"Meer informatie","traffic.OTHER":"Meer informatie","traffic.PLANNED_EVENT":"Geplande afzetting","traffic.ROAD_HAZARD":"Gevaar op de weg","traffic.ROAD_CLOSURE":"Rijbaan afgesloten","traffic.WEATHER":"Weer","traffic.CONGESTION":"Verkeersopstopping","traffic.CONSTRUCTION":"Wegwerkzaamheden","traffic.DISABLED_VEHICLE":"Voertuig met pech","traffic.LANE_RESTRICTION":"Rijstrookbeperking","traffic.from":"Begintijd:","traffic.until":"Geschatte eindtijd:",
"distance.measurement":"Measure distance"});Yt("pt-PT",{"layers.normal":"Vista do mapa","layers.satellite":"Sat\u00e9lite","layers.terrain":"Terreno","layer.transit":"Transportes p\u00fablicos","layer.traffic":"Condi\u00e7\u00f5es de tr\u00e2nsito","layer.incidents":"Mostrar incidentes de tr\u00e2nsito","layers.choose":"Escolher vista",minimap:"Minimap","scale.switchToImperial":"Mudar para milhas","scale.switchToMetric":"Mudar para km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Diminuir","zoom.in":"Aumentar",
"zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transportes p\u00fablicos","traffic.MISCELLANEOUS":"Diversos","traffic.ACCIDENT":"Acidente","traffic.OTHER_NEWS":"Outras not\u00edcias","traffic.OTHER":"Outras not\u00edcias","traffic.PLANNED_EVENT":"Evento planeado","traffic.ROAD_HAZARD":"Perigo na estrada","traffic.ROAD_CLOSURE":"Estrada fechada","traffic.WEATHER":"Meteorologia","traffic.CONGESTION":"Congestionamento","traffic.CONSTRUCTION":"Constru\u00e7\u00e3o","traffic.DISABLED_VEHICLE":"Ve\u00edculo avariado",
"traffic.LANE_RESTRICTION":"Limita\u00e7\u00e3o da faixa de rodagem","traffic.from":"Hora de in\u00edcio:","traffic.until":"Hora de fim prevista:","distance.measurement":"Measure distance"});Yt("zh-CN",{"layers.normal":"\u5730\u56fe\u89c6\u56fe","layers.satellite":"\u536b\u661f","layers.terrain":"\u5730\u5f62","layer.transit":"\u516c\u5171\u4ea4\u901a","layer.traffic":"\u4ea4\u901a\u60c5\u51b5","layer.incidents":"\u663e\u793a\u4ea4\u901a\u4e8b\u4ef6","layers.choose":"\u9009\u62e9\u89c6\u56fe",minimap:"Minimap","scale.switchToImperial":"\u5207\u6362\u4e3a\u300c\u82f1\u91cc\u300d","scale.switchToMetric":"\u5207\u6362\u4e3a\u300c\u516c\u91cc\u300d","scale.km":"\u516c\u91cc","scale.m":"\u7c73",
"scale.mi":"\u82f1\u91cc","scale.ft":"\u82f1\u5c3a","zoom.out":"\u7f29\u5c0f","zoom.in":"\u653e\u5927","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"\u516c\u5171\u4ea4\u901a","traffic.MISCELLANEOUS":"\u7efc\u5408\u4e8b\u4ef6","traffic.ACCIDENT":"\u4ea4\u901a\u610f\u5916","traffic.OTHER_NEWS":"\u5176\u4ed6\u65b0\u95fb","traffic.OTHER":"\u5176\u4ed6\u65b0\u95fb","traffic.PLANNED_EVENT":"\u9884\u5b9a\u4e8b\u4ef6","traffic.ROAD_HAZARD":"\u9053\u8def\u5371\u9669","traffic.ROAD_CLOSURE":"\u9053\u8def\u5df2\u5173\u95ed",
"traffic.WEATHER":"\u5929\u6c14","traffic.CONGESTION":"\u5835\u585e","traffic.CONSTRUCTION":"\u65bd\u5de5","traffic.DISABLED_VEHICLE":"\u8f66\u8f86\u629b\u951a","traffic.LANE_RESTRICTION":"\u8f66\u9053\u9650\u5236","traffic.from":"\u5f00\u59cb\u65f6\u95f4\uff1a","traffic.until":"\u9884\u8ba1\u7ed3\u675f\u65f6\u95f4\uff1a","distance.measurement":"Measure distance"});function $t(a,b){if(!jb(a))throw new TypeError("string locale code required");if(ya(b))Zt(a,b);else{if(-1===Vt.indexOf(a))throw Error("Default locale '"+a+"' does nto exist.");b=Wt[a]}this.v=b||{};this.Mm=a}t("H.ui.i18n.Localization",$t);$t.prototype.Uz=function(){return this.Mm};$t.prototype.getLocale=$t.prototype.Uz;$t.prototype.Nz=function(){return Object.keys(this.v)};$t.prototype.getKeys=$t.prototype.Nz;$t.prototype.qm=function(a){return!(!this.v||!this.v[a])};$t.prototype.hasKey=$t.prototype.qm;
$t.prototype.translate=function(a){var b=this.v[a];if(!jb(b))throw Error("Translation missing for key '"+a+"'.");return b};$t.prototype.translate=$t.prototype.translate;function au(a,b){this.tc=a;this.zc=null;this.Yj=0;this.Zf=22;this.qD=b;this.Zm=A(this.Zm,this);this.Uo=A(this.Uo,this);a=this.tc.Ic();a.addEventListener("mapviewchange",this.TB,!1,this);this.vb=a.Ca.type;a=a.P;a.addEventListener("add",this.dg,!1,this);a.addEventListener("remove",this.eg,!1,this)}function bu(a,b,c){var d=b.D;d&&(void 0===c?0:c)&&d.removeEventListener("tap",a.Zm);b?(d.addEventListener("tap",a.Zm),a.Yj=d.min,a.Zf=d.max):(a.Yj=0,a.Zf=22)}m=au.prototype;
m.TB=function(a){var b=a.newValue.zoom;this.zc&&a.modifiers&a.ZOOM&&(b<this.Yj||b>this.Zf)&&this.zc.close()};m.dg=function(a){a=a.added;cu(a)&&bu(this,a)};m.eg=function(a){a=a.removed;cu(a)&&(this.zc&&this.zc.close(),bu(this,a,!0))};function cu(a){return window.H.service&&(a.D instanceof window.H.service.traffic.incidents.Provider||a.D instanceof window.H.service.trafficVectorTile.Provider&&"incident"===a.D.aa.vq)}
m.Zm=function(a){var b,c=this.vb===ph.HARP;a.target&&(b=a.target.getData())&&0===a.currentPointer.button&&(c?(b=this.tc.Ic().Xa(a.currentPointer.viewportX,a.currentPointer.viewportY),(c=a.target.getData()?a.target.getData().properties.id:null)&&this.qD.requestIncidentById(c,{locationReferencing:"none",lang:this.tc.ma().Mm,units:this.tc.Pb===mt.METRIC?"metric":"imperial"},this.ux.bind(this,b),console.error)):(c=a.target.W(),this.ux(c,b)),a.stopPropagation())};
m.ux=function(a,b){if(this.vb===ph.HARP){b=b.incidentDetails;var c=this.tc.ma().Mm,d=b.type,e=d.split(/(?=[A-Z])/).join("_").toUpperCase();this.tc.ma().qm("traffic."+e)&&(d=this.tc.ma().translate("traffic."+e));a={position:a,title:d,description:b.description.value,startTime:(new Date(b.startTime)).toLocaleString(c).split(",").join(" "),endTime:(new Date(b.endTime)).toLocaleString(c).split(",").join(" ")}}else c=b.TRAFFIC_ITEM_TYPE_DESC.replace(" ","_"),c=this.tc.ma().qm("traffic."+c)?this.tc.ma().translate("traffic."+
c):b.TRAFFIC_ITEM_DESCRIPTION[b.TRAFFIC_ITEM_DESCRIPTION.length-1].value,a={position:a,title:c,description:b.TRAFFIC_ITEM_DESCRIPTION[0].value,startTime:b.START_TIME,endTime:b.END_TIME};this.Uo(a)};
m.Uo=function(a){var b=a.position,c=a.title,d=a.description,e=a.startTime;a=a.endTime;this.zc||(this.zc=new Vs(b),this.zc.Sa("H_tib"),this.tc.Us(this.zc));this.zc.setPosition(b);this.zc.Fk('<div class="H_tib_content"><div class="H_rdo_title" dir="auto">{{title}}</div><div class="H_tib_desc" dir="auto"><span>{{desc}}</span><div class="H_tib_time"><span class="H_tib_left">{{traffic.from}}</span><span class="H_tib_right">{{from}}</span><br/><span class="H_tib_left">{{traffic.until}}</span><span class="H_tib_right">{{until}}</span></div></div>'.replace("{{title}}",c).replace("{{desc}}",
d).replace("{{traffic.from}}",this.tc.ma().translate("traffic.from")).replace("{{traffic.until}}",this.tc.ma().translate("traffic.until")).replace("{{from}}",e).replace("{{until}}",a));this.zc.open()};function du(a,b){var c={},d={};c["top-left"]=Ps(b,"div",[eu,fu].join(" "));c["top-center"]=Ps(b,"div",[eu,gu,hu,fu].join(" "));c["top-right"]=Ps(b,"div",[eu,fu].join(" "));c["left-top"]=Ps(b,"div",[eu,iu].join(" "));c["left-middle"]=Ps(b,"div",[eu,ju,ku,iu].join(" "));c["left-bottom"]=Ps(b,"div",[eu,iu].join(" "));c["right-top"]=Ps(b,"div",[eu,iu].join(" "));c["right-middle"]=Ps(b,"div",[eu,lu,ku,iu].join(" "));c["right-bottom"]=Ps(b,"div",[eu,iu].join(" "));c["bottom-left"]=Ps(b,"div",[eu,fu].join(" "));
c["bottom-center"]=Ps(b,"div",[eu,mu,hu,fu].join(" "));c["bottom-right"]=Ps(b,"div",[eu,fu].join(" "));d["top-left"]=Ps(b,"div",[gu,ju].join(" "));d["top-right"]=Ps(b,"div",[gu,lu].join(" "));d["bottom-left"]=Ps(b,"div",[mu,ju].join(" "));d["bottom-right"]=Ps(b,"div",[mu,lu].join(" "));Qs(d["top-left"],c["top-left"],c["left-top"]);Qs(d["top-right"],c["top-right"],c["right-top"]);Qs(d["bottom-left"],c["left-bottom"],c["bottom-left"]);Qs(d["bottom-right"],c["right-bottom"],c["bottom-right"]);Qs(a,d["top-left"],
d["top-right"],d["bottom-left"],d["bottom-right"],c["top-center"],c["left-middle"],c["right-middle"],c["bottom-center"]);this.Xs=c}var gu="H_l_top",mu="H_l_bottom",ju="H_l_left",lu="H_l_right",hu="H_l_center",ku="H_l_middle",fu="H_l_horizontal",iu="H_l_vertical",eu="H_l_anchor";du.prototype.update=function(){var a=this.Xs;nu(a["top-center"],!0);nu(a["bottom-center"],!0);nu(a["left-middle"],!1);nu(a["right-middle"],!1)};
function nu(a,b){b?(b=a.offsetWidth,a.style.marginLeft=-Math.round(.5*b)+"px"):(b=a.offsetHeight,a.style.marginTop=-Math.round(.5*b)+"px")}du.prototype.put=function(a,b){a=a?a.F():null;var c=b?this.Xs[b]:null;a&&c&&(a.parentElement&&a.parentElement.removeChild(a),c.insertBefore(a,/(bottom|right)$/.test(b)||/(center|middle)/.test(b)&&c.childNodes.length%2?c.firstChild:null));this.update()};function ou(a,b){try{return a.Am=!0,new a(b)}finally{a.Am=!1}}
function pu(a,b){var c=a.F(),d=this;J.call(this);this.v=a;this.lj=c.ownerDocument;this.Af={};this.Ee=[];this.J=Ps(this.lj,"div","H_ui");this.setDirection();this.GB=A(function(e){this.dv.put(e.target,e.target.Ae)},this);this.addEventListener("alignmentchange",this.GB);this.XB=A(function(){this.nx()},this);this.addEventListener("toggleunitsystem",this.XB);this.J.addEventListener("contextmenu",this.dw,!1);this.J.addEventListener("MSHoldVisual",this.dw,!1);this.v.addEventListener("contextmenu",this.Wm,
!1,this);this.v.addEventListener("contextmenuclose",this.Dv,!1,this);this.v.bc(this.u.bind(this));this.Ld=null;this.nt=-1;this.dv=new du(this.J,this.lj);this.Pb=mt.METRIC;qu(this,"en-US");b&&ru(this,b);c.appendChild(this.J);x.setTimeout(function(){d.dv.update()},1)}u(pu,J);t("H.ui.UI",pu);pu.prototype.dw=function(a){for(var b=a.target;b&&!/\bH_ib_content\b/.test(b.className);)b=b.parentNode;b||a.preventDefault()};pu.prototype.F=function(){return this.J};pu.prototype.getElement=pu.prototype.F;
pu.prototype.Ic=function(){return this.v};pu.prototype.getMap=pu.prototype.Ic;pu.prototype.zA=function(){return this.Pb};pu.prototype.getUnitSystem=pu.prototype.zA;pu.prototype.Xn=function(a){var b=this.Af,c;if(a!==this.Pb)for(c in this.Pb=a,b)if(b[c]instanceof vt)b[c].onUnitSystemChange(this.Pb)};pu.prototype.setUnitSystem=pu.prototype.Xn;pu.prototype.setDirection=function(a){this.J.setAttribute("dir",a||getComputedStyle(this.Ic().F()).direction)};pu.prototype.setDirection=pu.prototype.setDirection;
function qu(a,b){if(jb(b))var c=b;else if(b instanceof $t){c=b.Mm;var d=b}else throw Error("The locale parameter must be a string or a H.ui.i18n.Localization object.");if(c)if(d)a.wq=d;else if(0<=Vt.indexOf(c))a.wq=new $t(c);else throw Error("Locale ["+c+"] is not supported.");else throw Error("No locale was defined.");}pu.prototype.ma=function(){return this.wq};pu.prototype.nx=function(){this.Pb===mt.METRIC?this.Xn(mt.IMPERIAL):this.Xn(mt.METRIC)};pu.prototype.toggleUnitSystem=pu.prototype.nx;
pu.prototype.Us=function(a){var b=this.Ee.length,c=this.J;if(0>this.Ee.indexOf(a)){a.fa(this);a.Pa(this.v);var d=a.N(this.lj);b=0<b?this.Ee[b-1].F().nextSibling:this.J.firstChild;c.insertBefore(d,b);this.Ee.push(a)}};pu.prototype.addBubble=pu.prototype.Us;
pu.prototype.Wm=function(a){var b=a.items;this.Ld&&this.Dv();clearTimeout(this.nt);this.nt=x.setTimeout(function(){b.length&&(this.Ld=new Tt(b),this.J.insertBefore(this.Ld.N(this.lj),this.J.firstChild),this.Ld.fa(this),this.Ld.Pa(this.v),this.Ld.setPosition(a.viewportX,a.viewportY))}.bind(this),0)};pu.prototype.Dv=function(){this.Ld&&(this.Ld.u(),this.Ld=null)};pu.prototype.nC=function(a){var b=this.Ee.indexOf(a);-1<b&&(a.fa(null),a.Pa(null),this.Ee.splice(b,1),this.J.removeChild(a.F()))};
pu.prototype.removeBubble=pu.prototype.nC;pu.prototype.kz=function(){return this.Ee};pu.prototype.getBubbles=pu.prototype.kz;pu.prototype.Kg=function(a,b){if(this.zj(a))throw Error("A control with name ["+a+"] is already registered.");b.fa(this);b.Pa(this.v);b.kB=this.wq;b.N(this.lj);b.onUnitSystemChange(this.Pb);this.Af[a]=b};pu.prototype.addControl=pu.prototype.Kg;
pu.prototype.pC=function(a){var b=this.zj(a);if(b)b.unsubscribe(),b.fa(null),b.Pa(null),Us(b),delete this.Af[a];else throw Error("Control ["+a+"] not found in this UI's controls.");return b};pu.prototype.removeControl=pu.prototype.pC;pu.prototype.zj=function(a){return this.Af[a]};pu.prototype.getControl=pu.prototype.zj;
pu.prototype.i=function(){for(var a in this.Af)As.hasOwnProperty.call(this.Af,a)&&this.Af[a].u();this.Ee.forEach(function(b){b.u()});(a=this.J.parentNode)&&a.removeChild(this.J);J.prototype.i.call(this);delete this.J};
function ru(a,b){var c,d;b.unitSystem&&a.Xn(b.unitSystem);(d=b.locale)&&qu(a,d);(c=b.zoom)&&a.Kg("zoom",new Qt(ya(c)?c:null));(c=b.zoomrectangle)&&a.Kg("zoomrectangle",new yt(ya(c)?c:null));(c=b.mapsettings)&&a.Kg("mapsettings",new zt(ya(c)?c:null));(c=b.scalebar)&&a.Kg("scalebar",new Ut(ya(c)?c:null));(c=b.distancemeasurement)&&a.Kg("distancemeasurement",new wt(ya(c)?c:null))}
pu.prototype.capture=function(a,b,c,d){var e=this.zj("scalebar"),f=a.getContext("2d"),g=a.width,h=a.height,k=this.v.Vd,l=5+(k?k.F().childNodes[1].offsetHeight:0);e&&e.Td()?e.capture(b,function(n){f.drawImage(n,g-n.width-5*b,h-n.height-l*b);c(a)},d):c(a)};pu.prototype.capture=pu.prototype.capture;
pu.createDefault=function(a,b,c){var d=a.Ca.type;c=new pu(a,{unitSystem:mt.METRIC,zoom:{alignment:"right-bottom"},mapsettings:su(d,b,a.qa),scalebar:{alignment:"bottom-right"},locale:c||"en-US"});if(d===ph.P2D){var e=c.zj("mapsettings");var f=function(){if(e.Ic()){var l=su(d,b,a.qa);At(e,l.baseLayers,l.layers)}};a.addEventListener(a.l.nl,f);c.bc(function(){a.removeEventListener(a.l.nl,f)});e.bc(function(){a.removeEventListener(a.l.nl,f)})}if(d===ph.HARP){if(window.H.service){var g=b.vector.traffic.map.D.aa.j(),
h=new window.H.service.Url(g.ki,g.Ij.split(".").slice(-2).join("."));h=ou(window.H.service.traffic.Service7,{platformBaseUrl:h});var k=h.j().getQuery();k.apikey=g.getQuery().apikey;h.j().Jk(k);new au(c,h)}}else new au(c);return c};pu.prototype.SC=function(){};pu.prototype.setTrafficIncidentsHandle=pu.prototype.SC;function tu(a,b,c,d){for(var e=a,f=0;e&&f<b.length;f++)e=e[b[f]];if(e&&e!==a)return a={label:c,layer:e},d.push(a),a}
function su(a,b,c){var d=[],e=[],f=b.raster;if(a===ph.P2D&&f){tu(b,["raster","normal","map"],"layers.normal",d);tu(b,["raster","satellite","map"],"layers.satellite",d);tu(b,["raster","terrain","map"],"layers.terrain",d);if(c)for(var g in f)if(f[g]&&f[g].map===c){var h=g;break}tu(b,["raster","normal","trafficincidents"],"layer.incidents",e);tu(b,["raster",h,"transit"],"layer.transit",e)}else tu(b,["vector","normal","map"],"layers.normal",d),a===ph.WEBGL?(tu(b,["raster","satellite","map"],"layers.satellite",
d),tu(b,["vector","normal","traffic"],"layer.traffic",e),tu(b,["vector","normal","trafficincidents"],"layer.incidents",e)):(c=tu(b,["hybrid","day","vector"],"",[]),f=tu(b,["hybrid","day","raster"],"layers.satellite",d),f.layer=[f.layer,c.layer],window.H.service&&(c=b.vector.traffic.map.D.aa.j(),b=ou(window.H.service.trafficVectorTile.Service,{baseUrl:c,layer:"flow"}),c=ou(window.H.service.trafficVectorTile.Service,{baseUrl:c,layer:"incident"}),h=mn()+"/harp/oslo/normal.day.json",f=
new H.map.render.harp.Style(h),h=new H.map.render.harp.Style(h),b=b.createLayer(f,{engineType:a}),a=c.createLayer(h,{engineType:a}),e.push({label:"layer.traffic",layer:b},{label:"layer.incidents",layer:a})));return{alignment:"bottom-right",baseLayers:d,layers:e}};function uu(a,b){b=b||{};if(!(a&&a instanceof ej))throw Error("Base layer is mandatory for overview UI element");vt.call(this);this.Zq=new bt({label:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="H_icon"><g fill-rule="evenodd" transform="translate(2 2)"><rect width="9" height="9" x="10" y="10"/><rect class="H_icon_stroke" width="18" height="18" x="1" y="1" fill="none" stroke="#000" stroke-width="2" rx="2"/></g></svg>',onStateChange:A(this.bf,this)});this.Ra(this.Zq);
this.Xh=new vu(a,b.zoomDelta,b.scaleX,b.scaleY);this.Wc(b.alignment||"right-bottom");this.Ra(this.Xh)}u(uu,vt);t("H.ui.Overview",uu);uu.prototype.xg=function(a){this.Xh.xg(a);return this};uu.prototype.setBaseLayer=uu.prototype.xg;uu.prototype.bf=function(a){a.target.getState()===at.DOWN?(a=this.Xh,wu(a,!0),a.ds(),a.Sa(a.Ts),a.v.addEventListener("mapviewchange",a.ds,!1,a)):xu(this.Xh)};
uu.prototype.O=function(a,b){vt.prototype.renderInternal.call(this,a,b);this.Zq.F().style["float"]=this.Ae.match("right")?"right":"left";this.Xh.Pa(this.map);this.Zq.Dd(this.ma().translate("minimap"))};uu.prototype.renderInternal=uu.prototype.O;uu.prototype.i=function(){this.Xh.u();Y.prototype.i.call(this)};
function vu(a,b,c,d){this.qa=a;this.Ts="H_overview_active";"number"===typeof b&&(this.Cx=b);"number"===typeof c&&(this.Rv=c);"number"===typeof d&&(this.Sv=d);Xs.call(this,"div","H_overview")}u(vu,vt);vu.prototype.xg=function(a){this.Yh.xg(a)};vu.prototype.O=function(a,b){b=Ps(b,"div","H_overview_map");Qs(a,b);this.zq=b};vu.prototype.renderInternal=vu.prototype.O;vu.prototype.renderInternal=vu.prototype.O;m=vu.prototype;m.Cx=3;m.Rv=5;m.Sv=5;
m.Pa=function(a){this.v=a;this.Yh=new U(this.zq,this.qa,{pixelRatio:this.v.mb(),engineType:this.v.Ca.type});this.Yh.Vd.F().style.display="none";this.Qv=this.Yh.xa;this.kv=this.v.xa};function xu(a){!a.fh&&wu(a);a.Mb(a.Ts);a.v.removeEventListener("mapviewchange",a.ds,!1,a)}m.ds=function(a){a&&a.modifiers&a.SIZE&&wu(this,!0);a=this.kv.Ib();a.zoom-=this.Cx;this.Qv.Xc(a)};
function wu(a,b){var c=a.v.pa.element,d=a.F().style,e=c.offsetWidth/a.Rv/10;c=c.offsetHeight/a.Sv/10;var f=a.zq.style;b?(d.width=e+"em",d.height=c+"em",f.width=e+"em",f.height=c+"em"):d.width=d.height="0em";a.Yh.pa.resize()}m.i=function(){vu.g.i.call(this);xu(this);this.Yh.u();this.Yh=this.Qv=this.kv=this.v=this.qa=this.zq=null};t("H.ui.buildInfo",function(){return cn("H-ui","1.54.1","17144d2",{region:"row"})});

var yu={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:0},incline:{min:0,max:0},heading:{min:180,max:180}},interaction:{ZOOM:xk.ZOOM,COORD:xk.COORD},capture:!0};t("H.map.render.p2d.capabilities",yu);function zu(a,b){if(!a)throw new D(zu,0,a);zu.g.constructor.call(this,a);this.Yv={};this.oj=!(!b||!b.Nd);this.Jj=Au++}u(zu,zl);var Au=0;
zu.prototype.N=function(a,b,c,d,e,f){var g=Eb(d),h=this.yb,k=g+(c.exp-h.pixelProjection.exp),l=h.min,n=h.max;d=h.tileSize;var p=h.D.Oc,q=this.Ob,r=q.Qe();var v=q.lc().w;var w=c.w,y=c.x,I=c.y,G={};if(g<l||g>n)return Ni.DONE;e=h.requestTiles(a,k,e,f,this.Jj);a=e.total;e=e.tiles;f=e.length;this.he=c;this.JC=b;this.ss=k;r!==p&&q.Cd(p);c=d=d*w/(Kb(2,k)*d);this.oj||(d%1&&(d=Fb(d),w=c/d,y/=w,I/=w,w=Kb(2,k)*d),y=Fb(y),I=Fb(I));this.uC=c;k=-d;g=v+d;for(h=0;h<f;h++){v=e[h];if((l=v.data)&&l.tagName){c=b.x-(y-
v.x*d);p=b.y-(I-v.y*d);q.Me(l,c,p,d,d);for(r=c;(r-=w)>k;)q.Me(l,r,p,d,d);for(r=c;(r+=w)<g;)q.Me(l,r,p,d,d)}G[this.ss+"_"+v.x+"_"+v.y]=v}this.Yv=G;return f===a?Ni.DONE:Ni.PENDING};zu.prototype.La=function(a,b,c){var d=this.uC,e=d/this.yb.tileSize,f=this.he,g=this.JC,h;if(db(this.ss)&&f){a=f.x+(a-g.x);b=f.y+(b-g.y);var k=Fb(f.w/d);var l=f=Fb(a/d);g=Fb(b/d);Hb(l)>=k&&(l%=k);0>l&&(l=k+l);(k=this.Yv[this.ss+"_"+l+"_"+g])&&k.La&&(h=k.La((a-d*f)/e,(b-d*g)/e,c))}return h||Ye};zu.prototype.Ah=function(){return"2d"};function Bu(a,b){b=b||{};C(a,Pj,Bu,0);Bu.g.constructor.call(this,a);this.Nd=!!b.Nd;this.gC=b.Ab||0;this.pn=[];this.Pv={}}u(Bu,zl);
Bu.prototype.N=function(a,b,c,d,e,f){var g,h=this.yb,k;d-=this.gC;this.pn.length=0;var l=this.Pv;this.Pv=g={};if(d>=h.min&&d<=h.max){var n=h.rg(a,d,e,f);var p=n.overlays;if(a=p.length)for(p.sort(Yh),d=this.Ob,e=this.Nd,f=0;f<a;f++){h=p[f];var q=h.C();var r=c.Gb(q.Kc());var v=c.Gb(q.Gc());q=c.w;r.x>=v.x&&(r.x-=q);q*=-((r.x+v.x)/q>>1);r.x+=q;r.add(b);v.x+=q;v.add(b);e||(r.round(),v.round());(q=l[k=h.xb()])?delete l[k]:q={cC:h};g[k]=q;var w=r.x;r=r.y;var y=v.x;v=v.y;var I=y-w;var G=v-r;d.Cd(h.Qe());
d.Me(h.Oe(),w,r,I,G);q.details?q.details.set(w,r,y,v):q.details=new fg(w,r,y,v);this.pn.push(q)}}return!n||n.requested&&n.requested===n.total||!n.requested&&p.length===n.total?Ni.DONE:Ni.PENDING};Bu.prototype.La=function(a,b,c){for(var d=this.pn,e=d.length,f,g,h;e--;)if(f=d[e],g=f.details,g.Il(a,b))if(f=f.cC,h)h.push(f);else if(h=[f],c)break;return h||Ye};Bu.prototype.Ah=function(){return"2d"};Bu.prototype.i=function(){delete this.pn;Bu.g.i.call(this)};Bu.prototype.disposeInternal=Bu.prototype.i;function Cu(a,b){this.Pm=[];Cu.g.constructor.apply(this,arguments)}u(Cu,Al);m=Cu.prototype;m.Tt=function(){return this.yb.le.apply(this.yb,arguments)};m.N=function(a,b,c,d,e,f,g){this.Pm=[];return Cu.g.N.apply(this,arguments)};m.oa=1;m.ww=function(a,b,c,d,e,f){var g=this.oa=d.mb();e*=g;f*=g;var h=c.lc();b=h.w*g;h=h.h*g;var k=c.Cb;this.Nd?(e-=k.x*g,f-=k.y*g):(e=Eb(e-k.x*g),f=Eb(f-k.y*g));d.Me(c.Oe(),e,f,b,h);a.detail?a.detail.set(e,f,e+b,f+h):a.detail=new fg(e,f,e+b,f+h);this.Pm.push(a)};
m.La=function(a,b,c){for(var d=this.Pm,e=d.length,f,g,h,k=Ye,l=this.oa;e--&&!(f=d[e],g=f.detail,g.Il(a,b)&&(f=f.nv,(!(h=f.kc().tm)||h.um((a-g.left)/l,(b-g.top)/l,0))&&0>k.indexOf(f)&&(k===Ye&&(k=[]),k.push(f),c))););return k};m.Ah=function(){return"2d"};m.i=function(){this.Pm=[];Cu.g.i.call(this)};Cu.prototype.disposeInternal=Cu.prototype.i;function Z(a,b,c,d){Z.g.constructor.call(this,a,b,c,d);this.Xb=new L(0,0);if(c=d.renderBaseBackground)this.vw=c.lower,this.uw=c.higher;this.oj=!!d.enableSubpixelRendering;this.Fg=Du;this.bv=0;this.ts=this.Vu=!1;this.na=new gm;this.U=d=new om;this.ag=A(this.ag,this);d.addEventListener(d.l.ro,this.ag);this.Ka=A(this.Ka,this);d=a.element;this.pc=a=d.ownerDocument.createElement("div");a.style.position="absolute";a.style.width=a.style.height="100%";a.style.zIndex=0;d.insertBefore(a,d.firstChild);this.Tk=
new Am(this.pc,this.ka);this.Be=[];this.aq();this.qg=A(Z.prototype.qg,this);this.o=Eu;this.Mn();this.zoom=Fu(this,this.ze.Tb()+this.Ab);this.wc();Gu(this,b.Ib().position,this.zoom);this.sb();this.gg()}u(Z,uk);t("H.map.render.p2d.RenderEngine",Z);Z.prototype.type=Dk.P2D;var Eu=2;Z.prototype.getState=function(){return this.o};Z.prototype.getState=Z.prototype.getState;Z.prototype.xj=function(a,b){a=b-a;return Hb(a)<this.pixelProjection.w/2?a:a-this.pixelProjection.w*b/Hb(b)};
Z.prototype.Wq=function(a){var b=this,c=a.animate,d=a.newValue,e=a.modifiers;a=d.position;var f=d.bounds,g,h=this.zoom,k=this.vd,l=0;e&Zj.POSITION&&(g=b.pixelProjection.Gb(a));if(e&Zj.BOUNDS)d=Hu(this,f.C(),e&Zj.ZOOM?d.zoom:B,e&Zj.POSITION?a:B),this.ze.Xc(d,c);else{e&Zj.POSITION||(g=b.pixelProjection.Gb(d.position));var n=g.x;var p=g.y;this.Eg();this.Xb.set(0,0);d=this.yo(d);var q=d.zoom;var r=d.position;if(c){var v=q-h;var w={x:k.x,y:k.y};c=this.pixelProjection.Zh(w).x;var y=this.pixelProjection.projection.Ne(a);
if(y.x!==this.vd.x||y.y!==this.vd.y||q!==this.zoom)n=this.xj(c,n),this.Zc(function(I){var G=I-l;if(q!==h){g=b.pixelProjection.Zh(y);var S=b.pixelProjection.Zh(w);n=b.xj(S.x,g.x);p=g.y-S.y}l=I;b.Ng(n*G,p*G);h+=v*G;b.tb(h);b.sb();b.ca()},this.ll,function(){Gu(b,r,q);b.tb(q);b.sb(r);b.ca()},this.ml)}else this.$c(),Gu(this,r,q),this.tb(q),this.sb(r);this.ca()}};Z.prototype.ll=300;Z.prototype.Sn=function(a){var b=ob(a);if(!b||b&&0>a)throw new D(this.Sn,1,"positive number required");this.ll=a};
Z.prototype.setAnimationDuration=Z.prototype.Sn;Z.prototype.up=function(){return this.ll};Z.prototype.getAnimationDuration=Z.prototype.up;Z.prototype.ml=Xl;Z.prototype.Tn=function(a){if(!ab(a))throw new D(this.Tn,1,"function required");this.ml=a};Z.prototype.setAnimationEase=Z.prototype.Tn;Z.prototype.vp=function(){return this.ml};Z.prototype.getAnimationEase=Z.prototype.vp;Z.prototype.Mn=function(){this.ml=Xl;this.ll=300};Z.prototype.resetAnimationDefaults=Z.prototype.Mn;m=Z.prototype;
m.Pq=function(a,b,c){var d;this.Rj=Gj();(d=this.Wh.la.splice(a,1)[0])&&d.u&&d.u();(d=this.Ff.la.splice(a,1)[0])&&d.u&&d.u();(d=this.mi.la.splice(a,1)[0])&&d.u&&d.u();(d=this.li.la.splice(a,1)[0])&&d.u&&d.u();this.Xe=this.jb.Ta();0===a&&(yk(this,b,!1),this.wc());this.Be=Bm(this.Tk,this.Mf(),this.Jf());this.hi();c||this.ca()};
m.aq=function(){var a=this.jb.Ta(),b=0,c=a.length;[this.Wh={},this.Ff={},this.mi={},this.li={}].forEach(function(d){d.Le=[];d.la=[]});for(this.Xe=this.jb.Ta();b<c;b++)this.dk(b,a[b]);this.wc()};m.Qq=function(){this.wc();this.ca()};
m.bq=function(a,b,c){var d,e,f,g;if(b){var h={Nd:this.oj,Ab:this.Ab};b.N?C(b,Oi)?e=new tm(b):C(b,Qi)&&(g=new tm(b)):(b.requestOverlays&&(d=new Bu(b,h)),b.requestTiles&&(e=new zu(b,h)),b.requestMarkers&&(f=new Cu(b,h)),b.requestDomMarkers&&(g=new Dl(b,h)))}c=c||0;this.Wh.la.splice(a,c,d);this.Ff.la.splice(a,c,e);this.mi.la.splice(a,c,f);this.li.la.splice(a,c,g);this.Xe=this.jb.Ta();this.Be=Bm(this.Tk,this.Mf(),this.Jf())};
m.Jf=function(){var a=[];a=a.concat(this.Ff.la);a=a.concat(this.Wh.la);a=a.concat(this.mi.la);a=a.concat(this.li.la);return a=a.filter(db)};m.Ko=function(){return this.o===Eu};m.yo=function(a){var b=zk(this,zk(this,a.zoom)+this.Ab);a=Ak(this,a);a.zoom=b;return a};function Gu(a,b,c){var d=a.pixelProjection;d.Wa(c);a.vd=d.projection.Ne(b);d.x=d.w*a.vd.x;d.y=d.h*a.vd.y}m.Xa=function(a,b){var c=this.za.center,d=this.ka;return this.pixelProjection.$a((a-c.x)*d,(b-c.y)*d)};Z.prototype.screenToGeo=Z.prototype.Xa;
Z.prototype.Qn=function(a,b){a=this.Xa(a,b);b=this.ze.Ib();b.position=a;return b};Z.prototype.Ka=function(a){var b=this.ka,c=this.za.center,d=c.x*b;c=c.y*b;a=this.pixelProjection.Gb(a);var e=this.pixelProjection.w;return new L(Eb((a.x-Eb(a.x/e)*e+d)/b),Eb((a.y+c)/b))};Z.prototype.geoToScreen=Z.prototype.Ka;Z.prototype.C=function(a,b){var c=this.hl[a||4];a=this.pixelProjection;var d=c.left-b,e=a.$a(d,c.top-b),f=c.right+b;b=a.$a(f,c.bottom+b);f-d>=a.w&&(e.lng=-(b.lng=180));return Ic(e,b)};
Z.prototype.La=function(a,b,c,d){var e=[],f=this.ka,g;a*=f;b*=f;f=[this.Wh,this.Ff,this.mi,this.li];for(g=f.length;g--&&(!c||!e.length);)e=this.Ip(e,f[g].la,a,b,c);d(e)};Z.prototype.getObjectsAt=Z.prototype.La;m=Z.prototype;m.Ip=function(a,b,c,d,e){for(var f=b.length,g;f--&&!((g=b[f])&&g.La&&(a=a.concat(g.La(c,d,e)),a.length&&e)););return a};m.te=z;m.Mf=function(){var a=this.hl[2];return{w:a.right-a.left,h:a.bottom-a.top}};
m.gg=function(){var a=this.Be.length,b;Z.g.gg.call(this);var c=this.Mf();this.Xb.set(0,0);var d=c.w;for(b=c.h;a--;){c=this.Be[a];var e=c.lc();e.w===d&&e.h===b||c.Kk(d,b)}this.te=new Jh(d,b);this.ca()};m.getCapabilities=function(){return yu};Z.prototype.getCapabilities=Z.prototype.getCapabilities;m=Z.prototype;m.Bk=function(){this.ta&&this.ta.S||Gj()-this.Rj<this.Fg&&!this.je?this.mh=Ej(this.qg):(this.je&&(this.hi(),this.kj()),this.o=Eu)};
m.hi=function(){this.Wh.Le.length=0;this.Ff.Le.length=0;this.mi.Le.length=0;this.li.Le.length=0};
m.qg=function(){var a;this.af&&this.af.before();var b=this.Ff.la;var c=this.za.center.clone().scale(this.ka).round();var d=this.C(1,0);var e=this.C(1,Iu);var f=this.zoom;var g=f-this.Ab;var h=this.pixelProjection;var k=this.vw;var l=this.uw;var n=b[0];b=this.Xb;var p=this.Be.length;var q=this.Xe;for(a=q.length;p--;){var r=this.Be[p];C(r,sm)&&r.clear()}if(n){if(k)for(;k;)p=f-k,n.N(d,c,h,p,!0,b),--k;if(l&&this.ts)for(r=1;r<=l&&(p=f+r,h.Wa(p),k=this.C(2,0),h.Wa(f),!n.N(k,c,h,p,!0,b));r++);}for(this.Fg=
Du;a--;)h=q[a],C(h,yh)&&h.D&&h.D.lk(e,g);d=this.Hn(d,c,f,!1,b,Ju,this.Ff,this.Wh);c=this.Hn(e,c,g,!1,b,Ku,this.mi,this.li);this.je=d&&c;this.ta&&this.ta.S&&this.Ao();this.pf||(this.pf=this.ze.Ib());this.pf.bounds=this.C(4,0);this.ze.sb(this.pf);this.pf=null;this.te&&(this.za.sb(this.te),this.te=z);f<this.bv?this.ts=!0:this.Vu&&(this.ts=!1);this.bv=f;this.Vu=d;this.af&&this.af.after();this.Bk()};
m.Hn=function(a,b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments,6),k=h.length,l=h[0].la.length,n=k*l,p=!!n,q;for(q=0;q<n;q++){if(f===Ju){var r=q%k;var v=Math.floor(q/k)}else r=Math.floor(q/l),v=q%l;var w=h[r].la[v];r=h[r].Le;w&&(w=w.N(a,b,this.pixelProjection,c,d,e,this.Ka),w===Ni.ACTIVE&&(this.Fg=Infinity),w!==Ni.DONE||r[v]||(this.kj(this.Xe[v]),r[v]=!0),r[v]||(p=!1))}return p};m.kj=function(a){this.dispatchEvent({type:this.l.Qs,target:a||this})};
m.i=function(){var a=this.jb.Ta()[0],b=this.za;Fj(this.mh);this.$c(!0);a&&yk(this,a,!1);this.Jf().forEach(function(c){c.u()});b.element&&b.element.removeChild(this.pc);this.pc=null;this.o=3;Z.g.i.call(this)};m.ca=function(){this.Rj=Gj();this.Ko()&&(this.je=!1,this.o=1,this.Bk())};m.xc=function(a,b){this.Ng(a*this.ka,b*this.ka);this.Xb.set(0,0);this.sb();this.ca()};m.Ng=function(a,b){var c=this.pixelProjection,d=this.vd;c.x=cc(c.x+a,c.w);c.y=Db(0,Cb(c.w,c.y+b));d.x=c.x/c.w;d.y=c.y/c.h};
m.Ig=function(a,b,c){a=zk(this,zk(this,a)+this.Ab);this.tb(a,b,c)};Z.prototype.zoomAt=Z.prototype.Ig;Z.prototype.tb=function(a,b,c){var d=this.ka,e=this.za.center;b===+b&&c===+c?(b=(b-e.x)*d,c=(c-e.y)*d,this.Xb.set(b,c),this.Ng(b,c),this.pixelProjection.Wa(a),this.Ng(-b,-c)):(this.Xb.set(0,0),this.pixelProjection.Wa(a));this.zoom=a;this.sb();this.ca()};
function Hu(a,b,c,d){var e=a.getCapabilities().lookAt.zoom.max,f=b.wb(),g=d||f;if(b.Bm()||c&&d)c=c===B?e:c;else{var h=new vh(a.pixelProjection.projection);h.Wa(e);var k=h.Gb(b.Kc()).round();var l=h.Gb(b.Gc()).round();e=h.w;b.oc()&&(k.x-=e);d?(f=h.Gb(g),b=2*Db(f.x-k.x,l.x-f.x),k=2*Db(f.y-k.y,l.y-f.y)):(b=l.x-k.x,k=l.y-k.y,g=f);c===B&&(f=a.hl[4],c=f.right-f.left,f=f.bottom-f.top,c=-8+Cb(Ib(c/b*e)/Sb,Ib(f/k*e)/Sb)-a.Ab,c=zk(a,c))}return{zoom:Fb(c),position:g}}
Z.prototype.Eg=function(){this.$c(!0);this.U.S&&this.hc(!0);this.na.S&&this.ic(!0);this.$c(!0)};Z.prototype.Gd=function(a,b){this.Eg();this.Hk(b);this.na.start(a,!!b)};Z.prototype.startInteraction=Z.prototype.Gd;Z.prototype.Hk=function(a){if(a){var b={};b.kk=a.power;b.nj=a.ease;b.duration=a.duration;this.ua=b}};function Fu(a,b){return zk(a,zk(a,b-a.Ab)+a.Ab)}
Z.prototype.td=function(a,b,c,d,e){var f=!1;this.na.S&&(b=this.na.store(a,b,c,d,e),this.na.Yd(xk.COORD)&&(a=this.na.vh(),0<fm(a)&&(this.xc(-a.x,-a.y),f=!0)),b&&this.na.Yd(xk.ZOOM)&&(a=this.na.am(),b=this.na.bm(),b=Ib(Kb(2,this.zoom)*b)/Sb,b!==this.zoom&&(b=Fu(this,b),this.tb(b,a.x,a.y),f=!0)),f&&this.ca())};Z.prototype.interaction=Z.prototype.td;
Z.prototype.ic=function(a){var b=this;if(this.na.S&&!a){if(this.ua){a=this.na.mc();var c=this.na.Gf();var d=this.ua.duration;var e=(this.ua.kk||1)*a;var f=new Vl(-e/(0<d?d:1),e);!E(c.x)&&!E(c.y)&&0<e&&b.na.Yd(xk.COORD)&&this.Zc(function(g){e=f.Aj(g*d);E(e)||b.xc(Eb(-c.x*e),Eb(-c.y*e))},d,void 0,this.ua.nj)}this.ua=null;this.na.clear()}};Z.prototype.endInteraction=Z.prototype.ic;Z.prototype.Fd=function(a,b,c){this.Eg();this.U.start(b,c);this.Hk(a)};Z.prototype.startControl=Z.prototype.Fd;
Z.prototype.control=function(a,b,c){if(E(+c))throw new D(this.control,2,c);if(E(a))throw new D(this.control,0,a);if(E(b))throw new D(this.control,1,b);this.U.S&&this.U.set(a,b,c,0,0,0)};Z.prototype.control=Z.prototype.control;
Z.prototype.hc=function(a,b){var c=this,d;if(this.U.S){this.$c(!0);var e=Gj();var f=e-this.ej;if(1<=f){var g=rm(this.U);this.Mi(g,f)}if(!this.ua||a||b)"function"===typeof b&&(a=this.Ib(),a.zoom=this.zoom-this.Ab,b(a),a.zoom+=this.Ab,this.Bo(a));else{b=this.U.mc();var h=this.U.Gf();var k=this.ua.duration;var l=(this.ua.kk||1)*b;var n=new Vl(-l/(0<k?k:1),l);!E(h.Jb)&&!E(h.Kb)&&0<l&&this.Zc(function(p,q,r,v){e&&(r=v-e,e=0);l=n.Aj(p*k)*r;E(l)||((d=h.Lb*l)&&c.tb(Fu(c,c.zoom+d),c.U.Pg,c.U.Qg),c.xc(Eb(h.Jb*
l),Eb(h.Kb*l)))},k,void 0,this.ua.nj)}this.U.reset()}};Z.prototype.endControl=Z.prototype.hc;m=Z.prototype;
m.Bo=function(a){var b=this,c=this.vd,d=this.pixelProjection.projection.Ne(a.position),e=this.pixelProjection.Zh(d),f=e.y;e=e.x;var g=a.zoom;c=this.pixelProjection.Zh(c);a=c.y;var h=c.x;c=this.zoom;var k=this.U.mc(),l=this.U.Pg,n=this.U.Qg,p=0;e=this.xj(h,e);e-=h;f-=a;c=g-c;a=Jb(e*e+f*f+c*c);if(0!==k&&0!==a){var q=e/a;var r=f/a;var v=c/a;var w=k*k/(2*a);this.Zc(function(y,I){var G;if(1!==y){y=k*I-w*I*I/2;I=y-p;if(G=v*I)G=Fu(b,b.zoom+G),b.tb(Fu(b,G),l,n);b.xc(Eb(q*I),Eb(r*I));p=y}else b.vd=d,b.tb(Fu(b,
g),l,n),b.sb(),b.ca()},2*a/k)}};m.ag=function(a){var b=this,c=a.it;this.Xb.set(0,0);c.Jb||c.Kb||c.Lb?(this.ej=Gj(),this.Zc(function(d,e,f,g){b.ej=g;b.Mi(c,f)},Number.POSITIVE_INFINITY),this.ca()):this.$c(!0)};m.Mi=function(a,b){b=b||0;a.Lb&&this.tb(Fu(this,this.zoom+a.Lb*b),this.U.atX,this.U.atY);this.xc(a.Jb*b,a.Kb*b)};m.Zc=function(a,b,c,d){this.ta&&this.ta.S&&this.ta.stop(!0);this.ta=new Cm(this,a,b,c,d);this.ta.start()};m.$c=function(a){this.ta&&this.ta.S&&this.ta.stop(a)};m.fp=function(){};
Z.prototype.enter=Z.prototype.fp;Z.prototype.kp=function(a){wk(this.pc,a)};Z.prototype.exit=Z.prototype.kp;Z.prototype.capture=function(a,b,c,d){var e=this.pc.ownerDocument.createElement("canvas"),f=e.getContext("2d"),g=this.ka;e.width=(c-a)*g;e.height=(d-b)*g;for(c=0;c<this.Be.length;c++)d=this.Be[c],C(d,sm)&&f.drawImage(d.F(),-a*g,-b*g);return Dd(e)};var Ku=0,Ju=1,Du=1E3,Iu=256;

function Lu(a){var b;if(a)for(Mu={},b=a.length;b--;)Mu[a[b]]=!0;this.ax={}}var Nu,Mu={};Lu.prototype.parse=function(a,b,c){var d,e,f,g,h;Nu=!1;try{c=JSON.parse(c)}catch(n){Nu=!0}if(c&&(d=c.metadata)){var k={spatials:[]};for(e in d){if(c=!Mu[e]&&(f=Ou[e]))(g=d[e])||(Nu=!0,g=void 0),c=g;if(c)for(c=g.length;c--;){var l;(l=g[c])||(Nu=!0,l=void 0);(h=l)&&f(b,a,this,e,h,k)}}}else Nu=!0;return Nu?void 0:k};Lu.prototype.parse=Lu.prototype.parse;
var Ou={"street labels":function(a,b,c,d,e,f){var g;(g=e.vertices)||(Nu=!0,g=void 0);if(g){var h,k=g.length,l;(l=0<k)||(Nu=!0,l=void 0);if(l)for(h=Array(k/2);k;){var n=g[--k];l=g[--k];h[k/2]=new L(l,n)}h=h?{Pc:[h]}:B;k=+e["font size"]/a.mb();g=c.ax[k];g||(Pu.lineWidth=k,g=c.ax[k]=c.bh.bu(Pu));Qu(a,b,h,!1,g,e,d,f)}delete e.vertices},"city center labels":function(a,b,c,d,e,f){Qu(a,b,Ru(e,new ni([])),!0,c.bh,e,d,f)},labels:function(a,b,c,d,e,f){var g;(g=e["bounding boxes"])||(Nu=!0,g=void 0);if(g){for(var h=
g.length,k=new ni([]),l;h--;){var n;(n=g[h])||(Nu=!0,n=void 0);(l=n)&&Ru(l,k)}Qu(a,b,k,!0,c.bh,e,d,f)}delete e["bounding boxes"]},buildings:function(a,b,c,d,e,f){var g=e.id,h=b.Fn[g],k,l,n,p=[],q=[];(k=e)||(Nu=!0,k=void 0);if(k&&((l=k.vertices)||(Nu=!0,l=void 0),l)){var r;(r=k.polygons)||(Nu=!0,r=void 0);(n=r)&&p.push.apply(p,Su(l,n));(k=k.outlines)||(Nu=!0,k=void 0);(n=k)&&q.push.apply(q,Su(l,n))}n=p.length;p.push.apply(p,q);q=new ni(p,$b,n);(p=p.length)||(Nu=!0,p=void 0);p&&(h?(dq(h,a,[q]),f.spatials.push(h)):
(h=Qu(a,b,q,!0,c.bh,e,d,f,g),b.$(h)))}};Ou["transit stops"]=Ou.POIs=Ou.labels;var Tu=["box 2","box 1","annotation box","icon box"];function Ru(a,b){for(var c=Tu.length,d,e;c--;)if(d=Tu[c],e=a[d]){var f=e[0],g=e[1],h=e[2];e=e[3];b.Pc.push([new L(f,g),new L(f+h,g),new L(f+h,g+e),new L(f,g+e)]);delete a[d]}return b}
function Su(a,b){var c=b.length,d,e,f;if(0<c)for(e=Array(c);c--;)if((d=b[c])||(Nu=!0,d=void 0),d){var g=d.length;if(0<g)for(e[c]=f=Array(g);g--;){var h=2*d[g];f[g]=new L(a[h],a[h+1])}}return e||[]}var Uu={};function Qu(a,b,c,d,e,f,g,h,k){Uu.style=e;d=new $p(b,d,k,Uu);c&&dq(d,a,[c]);Vu(f);f.category=g;d.setData(f);h.spatials.push(d);d.fa(b);return d}Lu.prototype.bh=new di({strokeColor:"transparent",fillColor:"transparent",lineWidth:0});var Pu={};
function Vu(a){var b,c=!1;switch(typeof a){case "object":if(a instanceof Array)for(b=a.length;b--;)Vu(a[b])?c=!0:delete a[b];else if(a)for(b in a)Vu(a[b])?c=!0:delete a[b];break;case "number":c=!0;break;default:c=!!a}return c};function Wu(a,b,c){c=c||{};b=b||{};var d=c.tileType||"maptile",e=c.scheme||"normal.day";R.call(this,{min:0,max:20});!0===b.pois&&(b.pois="!F");this.Ga=b;if(!(a&&a instanceof Xu))throw Error("InvalidArgument: service required");this.aa=a;this.xe=A(this.xe,this);this.aa.addEventListener("versionupdate",this.xe);this.hd=a.j().clone().A(d+"/"+a.gb+"/"+e).B(Yu).B(b);this.Yc=a.Yc||null;this.oa=c.pixelRatio||c.pixelratio||Ie();this.tileSize=c.tileSize||256;this.tileType=d;this.scheme=e;this.rs=0;this.yd=
new Mp(new Lu(c.categoryFilter));this.yd.fa(this);this.de=A(this.de,this);this.yd.addEventListener("update",this.de);this.Te=!1;R.call(this,{min:0,max:20});this.Un(new ij(c.tileCacheSize||256,A(this.fe,this)))}u(Wu,R);t("H.service.metaInfo.TileProvider",Wu);Wu.prototype.fe=function(a,b){a=b.cb();for(var c=a.length,d;c--;)d=a[c],delete d.uk[b.key],d.release();b.data&&(ro.push(b.Dn(),this.tileSize),b.En())};Wu.prototype.de=function(){this.dispatchEvent("update")};
Wu.prototype.s=function(a,b,c,d,e){var f=this.hd.clone(),g=this.Yc,h=this.tileSize,k=this.getTileKey(a,b,c);k=this.Rb().get(k);var l;if(k&&!k.Eh()){d(ro.pop(this.tileSize),null);var n={cancel:function(){}}}else{g&&f.Ha(g[(c+b+a)%g.length]);f.A(c+"/"+a+"/"+b+"/"+h+"/png8");var p=po.setTimeout(function(){l=new Tg("text/plain",f.toString());l.then(function(q){d(null,q)},e)},500)}this.Te||(lo(Wu,"Use HERE Vector Tile API or Raster Tile API v3 instead."),this.Te=!0);return n||{cancel:function(){l?l.cancel():
po.clearTimeout(p)}}};Wu.prototype.requestInternal=Wu.prototype.s;Wu.prototype.ld=function(a,b,c,d,e){var f=this.yd;var g=d||ro.pop(this.tileSize);if(d)a=this.Rb().get(this.getTileKey(a,b,c)),a.N(d);else if(d=a=new rj(this.Sd(a,b,c),a,b,c,this.tileSize,this.oa,c+this.rs,f),delete d.Fi,d.kl=e,a.N(g))for(e=a.cb(),g=e.length;g--;)e[g].On();else ro.push(g,this.tileSize);return a};Wu.prototype.createTileInternal=Wu.prototype.ld;
Wu.prototype.u=function(){this.yd.u();this.aa.removeEventListener("versionupdate",this.xe);R.prototype.u.call(this)};Wu.prototype.dispose=Wu.prototype.u;Wu.prototype.xe=function(){var a=this.aa;this.hd=a.j().clone().A(this.tileType+"/"+a.gb+"/"+this.scheme).B(Yu).B(this.Ga);this.reload(!1)};var Yu={metadata:"metaonly",mgen:"2"};function Xu(a){Xu.g.constructor.call(this,Xu,a);a=Do(this,a);this.Yc=a.shards;(this.Qa=a.ignoreTypes?null:a.type)&&this.j().Ha(this.Qa);this.gb=a.version;this.jr={};this.ec=new no;"newest"===this.gb&&this.mp()}u(Xu,Co);t("H.service.metaInfo.Service",Xu);Xu.prototype.Da=function(){return{type:"base",version:"newest",subDomain:"maps.ls",path:"maptile/2.1",shards:["1","2","3","4"]}};Xu.CONFIG_KEY="metaInfo";function Zu(a,b){for(var c={},d=a[b+"s"][b],e=d.length;e--;)c[d[e].id]=d[e];a[b+"s"]=c}
Xu.prototype.qu=function(){return this.Qa};Xu.prototype.Rp=function(){return this.gb};Xu.prototype.getVersion=Xu.prototype.Rp;Xu.prototype.Xr=function(a){this.gb=a};Xu.prototype.V=function(){return this.ec};Xu.prototype.getCopyrights=Xu.prototype.V;
Xu.prototype.os=function(a){a=a.response;var b;Zu(a,"map");Zu(a,"scheme");Zu(a,"tiletype");Zu(a,"format");Zu(a,"resolution");Zu(a,"language");if("newest"===this.gb&&"traffic"!==this.Qa)for(b in a.maps)a.maps[b].hash&&a.maps[b].newest&&(this.Xr(a.maps[b].hash),this.dispatchEvent("versionupdate"));this.$p=a;this.dispatchEvent("infoupdate")};
Xu.prototype.mp=function(){var a=this;var b=this.j().clone().A("info").B({output:"json"});this.Yc&&b.Ha(this.Yc[0]);this.s(b,function(c){a.os(c)},function(c){throw c;})};Xu.prototype.Dj=function(){return this.$p};Xu.prototype.getInfo=Xu.prototype.Dj;Xu.prototype.ij=function(a,b,c,d,e,f){return new Wu(this,d,{tileSize:a,pixelRatio:b,categoryFilter:c,tileType:e,scheme:f})};Xu.prototype.createTileProvider=Xu.prototype.ij;Xu.prototype.Md=function(a,b,c,d,e,f){return new ej(this.ij(a,b,c,d,e,f))};
Xu.prototype.createTileLayer=Xu.prototype.Md;W.prototype.hu=function(a){return this.Ua(Xu,a)};W.prototype.getMetaInfoService=W.prototype.hu;(function(){var a=W.prototype.createDefaultLayers;W.prototype.createDefaultLayers=function(b,c,d,e,f,g){var h=a.call(this,b,c,d,e,f,g),k={},l=this.hu();"object"===typeof b&&(g=b,b=g.tileSize,c=g.ppi,d=g.lg,e=g.lg2,f=g.style,g=g.pois);b=b||256;var n=320===c?2:1;if(0>[72,250,320,500].indexOf(+c)){if(c!==B)throw new D(this.Pl,1,c);}else k.ppi=+c;d&&(k.lg=d);e&&(k.lg2=e);f&&(k.style=f);g&&(k.pois=g);h.raster.normal.metaInfo=l.Md(b,n,["buildings"],k);return h}})();

H.__bootstrap__="/*\n\n Copyright The Closure Library Authors.\n SPDX-License-Identifier: Apache-2.0\n*/\nvar l;function ba(a){a=[\"object\"==typeof globalThis&&globalThis,a,\"object\"==typeof window&&window,\"object\"==typeof self&&self,\"object\"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error(\"Cannot find global object\");}var ca=ba(this);function da(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}\nvar ea=\"function\"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};function fa(a,b){if(b)a:{var c=ca;a=a.split(\".\");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ea(c,a,{configurable:!0,writable:!0,value:b})}}\nfa(\"Symbol\",function(a){function b(f){if(this instanceof b)throw new TypeError(\"Symbol is not a constructor\");return new c(d+(f||\"\")+\"_\"+e++,f)}function c(f,g){this.fc=f;ea(this,\"description\",{configurable:!0,writable:!0,value:g})}if(a)return a;c.prototype.toString=function(){return this.fc};var d=\"jscomp_symbol_\"+(1E9*Math.random()>>>0)+\"_\",e=0;return b});\nfa(\"Symbol.iterator\",function(a){if(a)return a;a=Symbol(\"Symbol.iterator\");for(var b=\"Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array\".split(\" \"),c=0;c<b.length;c++){var d=ca[b[c]];\"function\"===typeof d&&\"function\"!=typeof d.prototype[a]&&ea(d.prototype,a,{configurable:!0,writable:!0,value:function(){return ha(da(this))}})}return a});function ha(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}\nfunction ka(a,b){a instanceof String&&(a+=\"\");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}fa(\"Array.prototype.keys\",function(a){return a?a:function(){return ka(this,function(b){return b})}});var la;\nif(\"function\"==typeof Object.setPrototypeOf)la=Object.setPrototypeOf;else{var ma;a:{var na={a:!0},oa={};try{oa.__proto__=na;ma=oa.a;break a}catch(a){}ma=!1}la=ma?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+\" is not extensible\");return a}:null}var pa=la;fa(\"Object.setPrototypeOf\",function(a){return a||pa});var p=this||self;\nfunction qa(a,b,c,d){a=a.split(\".\");d=d||p;a[0]in d||\"undefined\"==typeof d.execScript||d.execScript(\"var \"+a[0]);for(var e;a.length&&(e=a.shift());)if(a.length||void 0===b)d=d[e]&&d[e]!==Object.prototype[e]?d[e]:d[e]={};else if(!c&&ra(b)&&ra(d[e]))for(var f in b)b.hasOwnProperty(f)&&(d[e][f]=b[f]);else d[e]=b}function sa(){}function ta(a){var b=typeof a;return\"object\"!=b?b:a?Array.isArray(a)?\"array\":b:\"null\"}function ra(a){var b=typeof a;return\"object\"==b&&null!=a||\"function\"==b}\nfunction ua(a){return Object.prototype.hasOwnProperty.call(a,ya)&&a[ya]||(a[ya]=++za)}var ya=\"closure_uid_\"+(1E9*Math.random()>>>0),za=0;function Aa(a,b,c){return a.call.apply(a.bind,arguments)}function Ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(b,e)}}return function(){return a.apply(b,arguments)}}\nfunction Ca(a,b,c){Ca=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf(\"native code\")?Aa:Ba;return Ca.apply(null,arguments)}function Da(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function r(a,b){qa(a,b,!0,void 0)}\nfunction Fa(a,b){function c(){}c.prototype=b.prototype;a.Z=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Cd=function(d,e,f){for(var g=Array(arguments.length-2),h=2;h<arguments.length;h++)g[h-2]=arguments[h];return b.prototype[e].apply(d,g)}};function t(){}r(\"H.util.ICache\",t);t.prototype.add=function(){};t.prototype.add=t.prototype.add;t.prototype.get=function(){};t.prototype.get=t.prototype.get;t.prototype.fb=function(){};t.prototype.drop=t.prototype.fb;t.prototype.forEach=function(){};t.prototype.forEach=t.prototype.forEach;t.prototype.ia=function(){};t.prototype.removeAll=t.prototype.ia;t.prototype.ya=function(){};t.prototype.registerOnDrop=t.prototype.ya;t.prototype.bb=function(){};t.prototype.deRegisterOnDrop=t.prototype.bb;function Ga(){var a=Ha,b;for(b in a)return!1;return!0}function Ia(a){var b={},c;for(c in a)b[c]=a[c];return b}var Ja=\"constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf\".split(\" \");function Ka(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Ja.length;f++)c=Ja[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};function La(a){if(Error.captureStackTrace)Error.captureStackTrace(this,La);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}Fa(La,Error);La.prototype.name=\"CustomError\";var Ma=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if(\"string\"===typeof a)return\"string\"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};var Na=this;var Oa=Ca,Pa=String,Qa=Na.Object.freeze||function(a){return a},x=[].pop(),Ra=/x/.exec(\"\");function Sa(a){return Pa(a).split(\",\"!==x?\",\":\" \")}var Ta=\"prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf\".split(\" \");function Ua(a,b,c,d){if(!(b=a instanceof b)&&c)throw new y(c,d,void 0!==x?void 0:a);return b}function Va(a){return\"function\"==ta(a)}function Wa(a,b,c,d){var e;if(!(e=\"Array\"===Xa(a))&&b)throw new y(b,c,d!==x?d:a);return e}\nr(\"H.lang.isArray\",function(a,b,c,d){return Wa(a,b,c,d)});function Ya(a){return\"string\"===typeof a}r(\"H.lang.isString\",Ya);var $a=isNaN;function ab(a){return a===+a}r(\"H.lang.isNumber\",ab);r(\"H.lang.isInteger\",Number.isInteger?Number.isInteger:function(a){return\"number\"===typeof a&&0===a%1});function Xa(a){var b=Object[Ta[0]][Ta[6]].call(a).match(/^\\[object (\\w+)\\]$/);return b?b[1]:typeof a}var bb=[];0>bb.indexOf(bb)&&bb.push(bb);\nfunction cb(a,b,c,d){var e=\"\",f=2>arguments.length,g;f&&(b={H:Na.H},c=\"\",d=bb.slice());db(b,!0,function(h,k){try{if(g=h[k],k=eb(h,g),!(ra(g)&&g.window===g&&g.self===g||ra(g)&&0<g.nodeType&&Va(g.cloneNode))&&ra(g)){if(g===a)return e=c+\".\"+k,!0;if(0>d.indexOf(g)&&(d.push(g),e=cb(a,g,c+\".\"+k,d)))return!0}}catch(m){}});f&&(e=e?e.substr(1).replace(\".\"+Ta[0]+\".\",\"#\"):\"~\"+(Va(a)?fb(a)+\"()\":Xa(a)));return e}\nfunction eb(a,b){var c=[];db(a,!1,function(d,e){d[e]===b&&c.push(e)});return c.sort(gb)[0]}function gb(a,b){return b.length-a.length}var hb=Object[Ta[0]][Ta[2]];function db(a,b,c){var d;if(a){for(e in a)if((!b||hb.call(a,e))&&c(a,e,!0))return;for(d=Ta.length;d--;){var e=Ta[d];if((!b||hb.call(a,e))&&c(a,e,!1))break}}}function fb(a){return(a=/^\\s*function ([^\\( ]+)/.exec(a))?a[1]:\"anonymous\"}function ib(a,b,c){c[b]=\"#\"+b}\nfunction y(a,b,c){var d=arguments.length;b=b!==x?+b:b;if(b!==x){var e=(e=/^.*?\\(([^\\)]+)/.exec((\"\"+a).replace(/(\\/\\*([\\s\\S]*?)\\*\\/)|(\\/\\/(.*)$)/gm,\"\")))?Sa(e[1].replace(/\\s+/g,\"\")):[];e.forEach(ib);e=e[b]||\"#\"+b}var f=a?cb(a):\"\";d=2<d?Pa(c):\"\";if(e||d)f+=\" (Argument \"+(e||\"\")+(d?\" \"+d:\"\")+\")\";d=Error(f);Object.setPrototypeOf(d,y.prototype);return d}Fa(y,Error);r(\"H.lang.InvalidArgumentError\",y);y.prototype.name=\"InvalidArgumentError\";\nfunction jb(a,b){var c=[];a&&c.push(cb(a));1<arguments.length&&c.push(\"\"+b);c=Error(c.join(\" \"));Object.setPrototypeOf(c,jb.prototype);return c}Fa(jb,Error);r(\"H.lang.IllegalOperationError\",jb);jb.prototype.name=\"IllegalOperationError\";function z(a,b,c){this.ta=[];b&&this.ya(b);if(c&&!Va(c))throw new y(z,2,c);this.J=0;this.filter=c;this.s={};this.qa=this.ea=null;this.zb(a)}r(\"H.util.Cache\",z);z.prototype.add=function(a,b,c){var d,e;c=+c;if(!ab(c)||0>c)throw new y(this.add,2,c);a=String(a);if(e=this.filter?this.filter(a,b,c):!0)(d=this.s[a])?(d.data!==b&&kb(this,d),this.J+=c-d.size,d.size=c,d.data=b,lb(this,d)):this.s[a]=mb(this,{id:a,data:b,size:c,v:null,N:null},this.ea),nb(this);return e};z.prototype.add=z.prototype.add;\nz.prototype.ya=function(a){if(!Va(a))throw new y(this.ya,0,a);this.ta.push(a)};z.prototype.registerOnDrop=z.prototype.ya;z.prototype.bb=function(a){this.ta=this.ta.filter(function(b){return b!==a})};z.prototype.deRegisterOnDrop=z.prototype.bb;z.prototype.get=function(a,b){return(a=b?this.s[a]:lb(this,this.s[a]))&&a.data};z.prototype.get=z.prototype.get;z.prototype.fb=function(a){var b;(b=this.s[a])&&ob(this,b,!0)};z.prototype.drop=z.prototype.fb;\nz.prototype.forEach=function(a,b,c){var d;for(d in this.s){var e=this.s[d];(c?c(d,e.data,e.size):1)&&a.call(b,d,e.data,e.size)}};z.prototype.forEach=z.prototype.forEach;z.prototype.ia=function(a){var b;for(b in this.s){var c=this.s[b];(a?a(b,c.data,c.size):1)&&ob(this,this.s[b],!0)}};z.prototype.removeAll=z.prototype.ia;z.prototype.zb=function(a){if(!(0<+a))throw new y(z.prototype.zb,0,a);this.Tb=+a;nb(this);return this};z.prototype.setMaxSize=z.prototype.zb;z.prototype.Jc=function(){return this.Tb};\nz.prototype.getMaxSize=z.prototype.Jc;z.prototype.Ec=function(){return this.J};z.prototype.getCurrentSize=z.prototype.Ec;function lb(a,b){b&&(a.ea=mb(a,b,a.ea));return b}function nb(a){for(;a.J>a.Tb&&a.qa;)ob(a,a.qa,!0)}function mb(a,b,c){if(c!==b){(b.v||b.N)&&ob(a,b,!1);if(b.v=c)b.N=c.N,c.N=b;b.N||(a.ea=b);b.v||(a.qa=b);a.J+=b.size}return b}function ob(a,b,c){var d=b.N,e=b.v;if(d||e||b==a.ea&&b==a.qa)d?d.v=e:a.ea=e,e?e.N=d:a.qa=d,a.J-=b.size,c&&(delete a.s[b.id],kb(a,b));b.v=b.N=null}\nfunction kb(a,b){for(var c=a.ta.length;c--;)a.ta[c].call(a,b.id,b.data,b.size)};function pb(a,b){b=180/(1<<b);var c=a.lat+90;a=(a.lng+180)%360;var d=0;180==c&&d--;d+=Math.floor(c/b);return[d,0+Math.floor(a/b)]}var qb=1/Math.pow(10,10);function rb(a,b){var c=[],d=a.Nb();a=a.Mb();var e;180==a.lng&&(a.lng-=qb);d=pb(d,b);a=pb(a,b);for(e=d[0];e>=a[0];e--)for(b=d[1];b<=a[1];b++)c.push(e,b);return c};function sb(){}r(\"H.service.extension.dataView.IColumn\",sb);sb.prototype.o=function(){};sb.prototype.getCell=sb.prototype.o;function tb(a,b){this.Ca=a;this.qc=b}r(\"H.service.extension.dataView.ObjColumn\",tb);tb.prototype.o=function(a){return this.Ca.o(a,this.qc)};tb.prototype.getCell=tb.prototype.o;function ub(){}r(\"H.service.extension.dataView.IRow\",ub);ub.prototype.L=function(){};ub.prototype.getColumnNames=ub.prototype.L;ub.prototype.o=function(){};ub.prototype.getCell=ub.prototype.o;ub.prototype.pb=function(){};ub.prototype.getTable=ub.prototype.pb;function vb(a,b){this.Ca=a;this.nd=b}r(\"H.service.extension.dataView.ObjRow\",vb);vb.prototype.L=function(){return this.Ca.L()};vb.prototype.getColumnNames=vb.prototype.L;vb.prototype.o=function(a){return this.Ca.o(this.nd,a)};vb.prototype.getCell=vb.prototype.o;vb.prototype.pb=function(){return this.Ca};vb.prototype.getTable=vb.prototype.pb;function A(){}r(\"H.service.extension.dataView.ITable\",A);A.prototype.nb=function(){};A.prototype.getMeta=A.prototype.nb;A.prototype.ob=function(){};A.prototype.getRowCount=A.prototype.ob;A.prototype.Ja=function(){};A.prototype.getRow=A.prototype.Ja;A.prototype.L=function(){};A.prototype.getColumnNames=A.prototype.L;A.prototype.lb=function(){};A.prototype.getColumn=A.prototype.lb;A.prototype.o=function(){};A.prototype.getCell=A.prototype.o;A.prototype.concat=function(){};A.prototype.concat=A.prototype.concat;function B(){0!=wb&&(xb[ua(this)]=this);this.na=this.na;this.G=this.G}var wb=0,xb={};B.prototype.na=!1;B.prototype.C=function(){if(!this.na&&(this.na=!0,this.K(),0!=wb)){var a=ua(this);if(0!=wb&&this.G&&0<this.G.length)throw Error(this+\" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.\");delete xb[a]}};\nB.prototype.aa=function(a,b){this.na?void 0!==b?a.call(b):a():(this.G||(this.G=[]),this.G.push(void 0!==b?Ca(a,b):a))};B.prototype.K=function(){if(this.G)for(;this.G.length;)this.G.shift()()};function yb(a,b){return-1!=a.indexOf(b)};var C;a:{var zb=p.navigator;if(zb){var Ab=zb.userAgent;if(Ab){C=Ab;break a}}C=\"\"};function Cb(a){Cb[\" \"](a);return a}Cb[\" \"]=sa;var Db=yb(C,\"Gecko\")&&!(yb(C.toLowerCase(),\"webkit\")&&!yb(C,\"Edge\"))&&!(yb(C,\"Trident\")||yb(C,\"MSIE\"))&&!yb(C,\"Edge\"),Eb=yb(C.toLowerCase(),\"webkit\")&&!yb(C,\"Edge\");var Fb=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},\"passive\",{get:function(){a=!0}});try{p.addEventListener(\"test\",sa,b),p.removeEventListener(\"test\",sa,b)}catch(c){}return a}();function D(a,b){this.type=a;this.currentTarget=this.target=b;this.defaultPrevented=this.xa=!1}D.prototype.stopPropagation=function(){this.xa=!0};D.prototype.preventDefault=function(){this.defaultPrevented=!0};function Gb(a,b){D.call(this,a?a.type:\"\");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.key=\"\";this.charCode=this.keyCode=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.state=null;this.pointerId=0;this.pointerType=\"\";this.oa=null;if(a){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=\nb;if(b=a.relatedTarget){if(Db){a:{try{Cb(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else\"mouseover\"==c?b=a.fromElement:\"mouseout\"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.offsetX=Eb||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=Eb||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,\nthis.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.keyCode=a.keyCode||0;this.key=a.key||\"\";this.charCode=a.charCode||(\"keypress\"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.pointerId=a.pointerId||0;this.pointerType=\"string\"===typeof a.pointerType?a.pointerType:Hb[a.pointerType]||\"\";this.state=a.state;this.oa=a;a.defaultPrevented&&Gb.Z.preventDefault.call(this)}}\nFa(Gb,D);var Hb={2:\"touch\",3:\"pen\",4:\"mouse\"};Gb.prototype.stopPropagation=function(){Gb.Z.stopPropagation.call(this);this.oa.stopPropagation?this.oa.stopPropagation():this.oa.cancelBubble=!0};Gb.prototype.preventDefault=function(){Gb.Z.preventDefault.call(this);var a=this.oa;a.preventDefault?a.preventDefault():a.returnValue=!1};var Ib=\"closure_listenable_\"+(1E6*Math.random()|0);var Jb=0;function Kb(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.La=e;this.key=++Jb;this.za=this.Ga=!1}function Lb(a){a.za=!0;a.listener=null;a.proxy=null;a.src=null;a.La=null};function Mb(a){this.src=a;this.m={};this.Ea=0}Mb.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.m[f];a||(a=this.m[f]=[],this.Ea++);var g=Nb(a,b,d,e);-1<g?(b=a[g],c||(b.Ga=!1)):(b=new Kb(b,this.src,f,!!d,e),b.Ga=c,a.push(b));return b};Mb.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.m))return!1;var e=this.m[a];b=Nb(e,b,c,d);return-1<b?(Lb(e[b]),Array.prototype.splice.call(e,b,1),0==e.length&&(delete this.m[a],this.Ea--),!0):!1};\nfunction Ob(a,b){var c=b.type;if(c in a.m){var d=a.m[c],e=Ma(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(Lb(b),0==a.m[c].length&&(delete a.m[c],a.Ea--))}}Mb.prototype.ia=function(a){a=a&&a.toString();var b=0,c;for(c in this.m)if(!a||c==a){for(var d=this.m[c],e=0;e<d.length;e++)++b,Lb(d[e]);delete this.m[c];this.Ea--}return b};Mb.prototype.mb=function(a,b,c,d){a=this.m[a.toString()];var e=-1;a&&(e=Nb(a,b,c,d));return-1<e?a[e]:null};\nfunction Nb(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.za&&f.listener==b&&f.capture==!!c&&f.La==d)return e}return-1};var Pb=\"closure_lm_\"+(1E6*Math.random()|0),Qb={},Rb=0;function Sb(a,b,c,d,e){if(d&&d.once)Tb(a,b,c,d,e);else if(Array.isArray(b))for(var f=0;f<b.length;f++)Sb(a,b[f],c,d,e);else c=Ub(c),a&&a[Ib]?a.D.add(String(b),c,!1,ra(d)?!!d.capture:!!d,e):Vb(a,b,c,!1,d,e)}\nfunction Vb(a,b,c,d,e,f){if(!b)throw Error(\"Invalid event type\");var g=ra(e)?!!e.capture:!!e,h=Wb(a);h||(a[Pb]=h=new Mb(a));c=h.add(b,c,d,g,f);if(!c.proxy){d=Xb();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)Fb||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(Yb(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error(\"addEventListener and attachEvent are unavailable.\");Rb++}}\nfunction Xb(){function a(c){return b.call(a.src,a.listener,c)}var b=Zb;return a}function Tb(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)Tb(a,b[f],c,d,e);else c=Ub(c),a&&a[Ib]?a.D.add(String(b),c,!0,ra(d)?!!d.capture:!!d,e):Vb(a,b,c,!0,d,e)}function $b(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)$b(a,b[f],c,d,e);else d=ra(d)?!!d.capture:!!d,c=Ub(c),a&&a[Ib]?a.D.remove(String(b),c,d,e):a&&(a=Wb(a))&&(b=a.mb(b,c,d,e))&&ac(b)}\nfunction ac(a){if(\"number\"!==typeof a&&a&&!a.za){var b=a.src;if(b&&b[Ib])Ob(b.D,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(Yb(c),d):b.addListener&&b.removeListener&&b.removeListener(d);Rb--;(c=Wb(b))?(Ob(c,a),0==c.Ea&&(c.src=null,b[Pb]=null)):Lb(a)}}}function Yb(a){return a in Qb?Qb[a]:Qb[a]=\"on\"+a}function Zb(a,b){if(a.za)a=!0;else{b=new Gb(b,this);var c=a.listener,d=a.La||a.src;a.Ga&&ac(a);a=c.call(d,b)}return a}\nfunction Wb(a){a=a[Pb];return a instanceof Mb?a:null}var bc=\"__closure_events_fn_\"+(1E9*Math.random()>>>0);function Ub(a){if(\"function\"===typeof a)return a;a[bc]||(a[bc]=function(b){return a.handleEvent(b)});return a[bc]};r(\"H.util.Event\",D);D.prototype.stopPropagation=D.prototype.stopPropagation;D.prototype.stopPropagation=D.prototype.stopPropagation;D.prototype.CAPTURING_PHASE=1;D.prototype.CAPTURING_PHASE=D.prototype.CAPTURING_PHASE;D.prototype.AT_TARGET=2;D.prototype.AT_TARGET=D.prototype.AT_TARGET;D.prototype.BUBBLING_PHASE=3;D.prototype.BUBBLING_PHASE=D.prototype.BUBBLING_PHASE;D.prototype.eventPhase=0;D.prototype.eventPhase=D.prototype.eventPhase;function cc(a,b,c){cc.Z.constructor.call(this,a,c);this.message=b}Fa(cc,D);r(\"H.util.ErrorEvent\",cc);function dc(){}r(\"H.util.ICancelable\",dc);dc.prototype.cancel=function(){};dc.prototype.cancel=dc.prototype.cancel;function ec(a){p.setTimeout(function(){throw a;},0)};function fc(a,b){this.$c=100;this.rc=a;this.md=b;this.Qa=0;this.Ma=null}fc.prototype.get=function(){if(0<this.Qa){this.Qa--;var a=this.Ma;this.Ma=a.next;a.next=null}else a=this.rc();return a};fc.prototype.put=function(a){this.md(a);this.Qa<this.$c&&(this.Qa++,a.next=this.Ma,this.Ma=a)};function gc(){this.Ya=this.ja=null}gc.prototype.add=function(a,b){var c=hc.get();c.set(a,b);this.Ya?this.Ya.next=c:this.ja=c;this.Ya=c};gc.prototype.remove=function(){var a=null;this.ja&&(a=this.ja,this.ja=this.ja.next,this.ja||(this.Ya=null),a.next=null);return a};var hc=new fc(function(){return new ic},function(a){return a.reset()});function ic(){this.next=this.scope=this.hb=null}ic.prototype.set=function(a,b){this.hb=a;this.scope=b;this.next=null};\nic.prototype.reset=function(){this.next=this.scope=this.hb=null};function jc(){var a=document;var b=\"IFRAME\";\"application/xhtml+xml\"===a.contentType&&(b=b.toLowerCase());return a.createElement(b)};var mc;\nfunction nc(){var a=p.MessageChannel;\"undefined\"===typeof a&&\"undefined\"!==typeof window&&window.postMessage&&window.addEventListener&&!yb(C,\"Presto\")&&(a=function(){var e=jc();e.style.display=\"none\";document.documentElement.appendChild(e);var f=e.contentWindow;e=f.document;e.open();e.close();var g=\"callImmediate\"+Math.random(),h=\"file:\"==f.location.protocol?\"*\":f.location.protocol+\"//\"+f.location.host;e=Ca(function(k){if((\"*\"==h||k.origin==h)&&k.data==g)this.port1.onmessage()},this);f.addEventListener(\"message\",e,\n!1);this.port1={};this.port2={postMessage:function(){f.postMessage(g,h)}}});if(\"undefined\"!==typeof a&&!yb(C,\"Trident\")&&!yb(C,\"MSIE\")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var e=c.Jb;c.Jb=null;e()}};return function(e){d.next={Jb:e};d=d.next;b.port2.postMessage(0)}}return function(e){p.setTimeout(e,0)}};function oc(a,b){pc||qc();rc||(pc(),rc=!0);sc.add(a,b)}var pc;function qc(){if(p.Promise&&p.Promise.resolve){var a=p.Promise.resolve(void 0);pc=function(){a.then(tc)}}else pc=function(){var b=tc;\"function\"!==typeof p.setImmediate||p.Window&&p.Window.prototype&&!yb(C,\"Edge\")&&p.Window.prototype.setImmediate==p.setImmediate?(mc||(mc=nc()),mc(b)):p.setImmediate(b)}}var rc=!1,sc=new gc;function tc(){for(var a;a=sc.remove();){try{a.hb.call(a.scope)}catch(b){ec(b)}hc.put(a)}rc=!1};function uc(a){this.u=vc;this.Zb=void 0;this.ba=this.I=this.W=null;this.Ka=this.gb=!1;if(a!=sa)try{var b=this;a.call(void 0,function(c){wc(b,xc,c)},function(c){wc(b,yc,c)})}catch(c){wc(this,yc,c)}}var vc=0,xc=2,yc=3;function zc(){this.next=this.context=this.ha=this.ua=this.R=null;this.Fa=!1}zc.prototype.reset=function(){this.context=this.ha=this.ua=this.R=null;this.Fa=!1};var Ac=new fc(function(){return new zc},function(a){a.reset()});\nfunction Bc(a,b,c){var d=Ac.get();d.ua=a;d.ha=b;d.context=c;return d}function Cc(a,b,c){Dc(a,b,c,null)||oc(Da(b,a))}function Ec(a){return new uc(function(b,c){var d=a.length,e=[];if(d)for(var f=function(m,n){d--;e[m]=n;0==d&&b(e)},g=function(m){c(m)},h=0,k;h<a.length;h++)k=a[h],Cc(k,Da(f,h),g);else b(e)})}function Fc(){var a,b,c=new uc(function(d,e){a=d;b=e});return new Gc(c,a,b)}uc.prototype.then=function(a,b,c){return Hc(this,\"function\"===typeof a?a:null,\"function\"===typeof b?b:null,c)};\nuc.prototype.$goog_Thenable=!0;uc.prototype.cancel=function(a){if(this.u==vc){var b=new Ic(a);oc(function(){Jc(this,b)},this)}};function Jc(a,b){if(a.u==vc)if(a.W){var c=a.W;if(c.I){for(var d=0,e=null,f=null,g=c.I;g&&(g.Fa||(d++,g.R==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.u==vc&&1==d?Jc(c,b):(f?(d=f,d.next==c.ba&&(c.ba=d),d.next=d.next.next):Kc(c),Lc(c,e,yc,b)))}a.W=null}else wc(a,yc,b)}function Mc(a,b){a.I||a.u!=xc&&a.u!=yc||Nc(a);a.ba?a.ba.next=b:a.I=b;a.ba=b}\nfunction Hc(a,b,c,d){var e=Bc(null,null,null);e.R=new uc(function(f,g){e.ua=b?function(h){try{var k=b.call(d,h);f(k)}catch(m){g(m)}}:f;e.ha=c?function(h){try{var k=c.call(d,h);void 0===k&&h instanceof Ic?g(h):f(k)}catch(m){g(m)}}:g});e.R.W=a;Mc(a,e);return e.R}uc.prototype.td=function(a){this.u=vc;wc(this,xc,a)};uc.prototype.ud=function(a){this.u=vc;wc(this,yc,a)};\nfunction wc(a,b,c){a.u==vc&&(a===c&&(b=yc,c=new TypeError(\"Promise cannot resolve to itself\")),a.u=1,Dc(c,a.td,a.ud,a)||(a.Zb=c,a.u=b,a.W=null,Nc(a),b!=yc||c instanceof Ic||Oc(a,c)))}function Dc(a,b,c,d){if(a instanceof uc)return Mc(a,Bc(b||sa,c||null,d)),!0;if(a)try{var e=!!a.$goog_Thenable}catch(g){e=!1}else e=!1;if(e)return a.then(b,c,d),!0;if(ra(a))try{var f=a.then;if(\"function\"===typeof f)return Pc(a,f,b,c,d),!0}catch(g){return c.call(d,g),!0}return!1}\nfunction Pc(a,b,c,d,e){function f(k){h||(h=!0,d.call(e,k))}function g(k){h||(h=!0,c.call(e,k))}var h=!1;try{b.call(a,g,f)}catch(k){f(k)}}function Nc(a){a.gb||(a.gb=!0,oc(a.uc,a))}function Kc(a){var b=null;a.I&&(b=a.I,a.I=b.next,b.next=null);a.I||(a.ba=null);return b}uc.prototype.uc=function(){for(var a;a=Kc(this);)Lc(this,a,this.u,this.Zb);this.gb=!1};\nfunction Lc(a,b,c,d){if(c==yc&&b.ha&&!b.Fa)for(;a&&a.Ka;a=a.W)a.Ka=!1;if(b.R)b.R.W=null,Qc(b,c,d);else try{b.Fa?b.ua.call(b.context):Qc(b,c,d)}catch(e){Rc.call(null,e)}Ac.put(b)}function Qc(a,b,c){b==xc?a.ua.call(a.context,c):a.ha&&a.ha.call(a.context,c)}function Oc(a,b){a.Ka=!0;oc(function(){a.Ka&&Rc.call(null,b)})}var Rc=ec;function Ic(a){La.call(this,a)}Fa(Ic,La);Ic.prototype.name=\"cancel\";function Gc(a,b,c){this.promise=a;this.resolve=b;this.reject=c};function Sc(a,b,c){this.type=a;this.data=b;this.O=Fc();this.resolve=Oa(this.resolve,this);this.reject=Oa(this.reject,this);this.priority=Tc;c!==x&&(this.priority=c);this.Gc().add(this)}var Tc=1,Uc={zd:0,Ad:Tc,yd:2};l=Sc.prototype;l.then=function(a,b,c){return this.O.promise.then(a,b,c)};l.resolve=function(a){this.state=3;this.O.resolve(a)};l.reject=function(a){this.state=5;this.O.reject(a)};l.state=0;l.cancel=function(){3>this.state&&(this.Dd(),this.Gc().remove(this),this.state=4)};\nSc.prototype.cancel=Sc.prototype.cancel;function Vc(a){var b;this.Y={};for(b in Uc)this.Y[Uc[b]]=[];this.Ba=a;this.Ba.addEventListener(\"allocatable\",Oa(this.Lb,this))}r(\"H.util.JobManager\",Vc);var Wc=Object.keys(Uc).map(function(a){return Uc[a]}).sort().reverse();Vc.prototype.add=function(a){Ua(a,Sc,this.add,0);this.Y[a.priority].push(a);this.Lb()};Vc.prototype.contains=function(a){return-1<this.Y[a.priority].indexOf(a)};\nVc.prototype.remove=function(a){var b=a.priority,c=this.Y[b].indexOf(a);if(-1<c)return this.Y[b].splice(c,1),!0;a.Fb&&this.Ba.sc(a.Fb);return!1};Vc.prototype.Lb=function(){Wc.forEach(function(a){this.Y[a]=this.Y[a].filter(function(b){var c;if((c=this.Ba.Bd(b))!==Ra){var d=Oa(this.Ba.sc,this.Ba,c,b);b.Fb=c;b.then(d,d);b.state=b.Ed(c)?1:5}else return!0},this)},this)};var E=Math,Xc=E.min,Yc=E.max,Zc=E.round,$c=E.floor,ad=E.ceil,bd=E.abs,cd=E.log,dd=E.sqrt,F=E.pow,ed=E.exp,fd=E.sin,gd=E.asin,hd=E.cos,id=E.tan,jd=E.atan,kd=E.atan2,ld=E.LN2,K=E.PI,md=K/2,nd=K/4,od=2*K,pd=3*K,qd=K/180,rd=180/K,sd=1/0;function td(a,b){var c;return 0>(c=a%b)===0>b?c:c+b}r(\"H.math.normalize\",function(a,b,c){b-=c=c||0;a-=c;return a-$c(a/b)*b+c});function ud(a,b,c){return(a-=0)>c?c:a<b?b:a}r(\"H.math.clamp\",ud);\nfunction vd(a,b,c){var d=0;(d-=0)||(d=0);return b<c?a>=b-d&&a<=c+d:a>=c-d&&a<=b+d}var wd={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};r(\"H.math.CoverType\",wd);\nfunction xd(a,b,c){for(var d=c.length,e=d,f,g,h,k,m=c[0],n=0,q=0,u=0;1!=n&&1<e;){e-=0;g=c[--e];f=c[--e];k=c[e?e-0-1:(d+(e-0-1))%d];h=c[e?e-0-2:(d+(e-0-2))%d];if(f>=a-0&&f<=a+0&&g>=b-0&&g<=b+0||h>=a-0&&h<=a+0&&k>=b-0&&k<=b+0)n=1;else if(!n&&f===a)h===a&&(g<b&&k>b||g>b&&k<b)||(m<=a&&h>a||m>=a&&h<a)&&(g>=b?++q:++u),n=vd(b,g,k)&&0>=dd(F((a-h)*(g-k)-(b-k)*(f-h),2)/(F(f-h,2)+F(g-k,2)))?2:0;else if(!n&&vd(a,f,h)){if(f<a&&h>a||f>a&&h<a)m=g+(a-f)/(h-f)*(k-g),q+=m>b,u+=m<b;n=vd(b,g,k)&&0>=dd(F((a-h)*(g-k)-\n(b-k)*(f-h),2)/(F(f-h,2)+F(g-k,2)))?2:0}m=f}!n&&0!==u&&0!==q%2&&(n=3);return n}function yd(a,b){return xd(a.x,a.y,b)!==wd.NONE}r(\"H.math.isPointInsidePolygon\",yd);function zd(a){for(var b=a.length,c=new Float64Array(2*b),d=b&&a[0].x!==x;b--;){var e=a[b],f=b<<1;c[f]=d?e.x:e[0];c[f+1]=d?e.y:e[1]}return c}r(\"H.math.flatten\",zd);function Ad(a,b,c){Ad.Z.constructor.call(this,a,c);this.data=b}Fa(Ad,D);r(\"H.util.DataEvent\",Ad);function Bd(a,b,c){var d=[],e=arguments.length;a&&d.push(cb(a));1<e&&(e=2<e&&Wa(c,void 0,void 0,void 0)?\" out of [\"+c[0]+\"...\"+c[1]+\"]\":\"\",d.push(\"(\"+b+e+\")\"));d=Error(d.join(\" \"));Object.setPrototypeOf(d,Bd.prototype);return d}Fa(Bd,Error);r(\"H.lang.OutOfRangeError\",Bd);Bd.prototype.name=\"OutOfRangeError\";function L(){B.call(this);this.D=new Mb(this);this.hc=this;this.wb=null}Fa(L,B);L.prototype[Ib]=!0;l=L.prototype;l.M=function(){return this.wb};l.Sa=function(a){this.wb=a};l.addEventListener=function(a,b,c,d){Sb(this,a,b,c,d)};l.removeEventListener=function(a,b,c,d){$b(this,a,b,c,d)};\nl.dispatchEvent=function(a){var b,c=this.M();if(c)for(b=[];c;c=c.M())b.push(c);c=this.hc;var d=a.type||a;if(\"string\"===typeof a)a=new D(a,c);else if(a instanceof D)a.target=a.target||c;else{var e=a;a=new D(d,c);Ka(a,e)}e=!0;if(b)for(var f=b.length-1;!a.xa&&0<=f;f--){var g=a.currentTarget=b[f];e=g.da(d,!0,a)&&e}a.xa||(g=a.currentTarget=c,e=g.da(d,!0,a)&&e,a.xa||(e=g.da(d,!1,a)&&e));if(b)for(f=0;!a.xa&&f<b.length;f++)g=a.currentTarget=b[f],e=g.da(d,!1,a)&&e;return e};\nl.K=function(){L.Z.K.call(this);this.D&&this.D.ia(void 0);this.wb=null};l.da=function(a,b,c){a=this.D.m[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.za&&f.capture==b){var g=f.listener,h=f.La||f.src;f.Ga&&Ob(this.D,f);d=!1!==g.call(h,c)&&d}}return d&&!c.defaultPrevented};l.mb=function(a,b,c,d){return this.D.mb(String(a),b,c,d)};r(\"H.util.EventTarget\",L);L.prototype.Sa=L.prototype.Sa;L.prototype.setParentEventTarget=L.prototype.Sa;L.prototype.M=L.prototype.M;L.prototype.getParentEventTarget=L.prototype.M;L.prototype.addEventListener=L.prototype.addEventListener;L.prototype.addEventListener=L.prototype.addEventListener;L.prototype.removeEventListener=L.prototype.removeEventListener;L.prototype.removeEventListener=L.prototype.removeEventListener;L.prototype.dispatchEvent=L.prototype.dispatchEvent;\nL.prototype.dispatchEvent=L.prototype.dispatchEvent;L.prototype.C=L.prototype.C;L.prototype.dispose=L.prototype.C;L.prototype.aa=L.prototype.aa;L.prototype.addOnDisposeCallback=L.prototype.aa;L.prototype.yc=L.prototype.da;\nL.prototype.da=function(a,b,c){var d,e,f=!0;var g=c[c.currentTarget===c.target?\"AT_TARGET\":b?\"CAPTURING_PHASE\":(d=!0,\"BUBBLING_PHASE\")];if(!d||\"pointerenter\"!==(e=c.type)&&\"pointerleave\"!==e)c.eventPhase=g,f=L.prototype.yc.apply(this,arguments),d&&this.M&&null===this.M()&&delete c.eventPhase;return f};L.prototype.qd=function(a){for(var b,c=this;c&&(b=c.M())&&b!==a;)c=b;b||c.Sa(a)};L.prototype.setRootParentEventTarget=L.prototype.qd;function O(a){a=a||{};var b=a.callback;this.rb=a.label;Va(b)&&(this.callback=b);this.cb=!!a.disabled;O.Z.constructor.call(this)}Fa(O,L);r(\"H.util.ContextItem\",O);O.prototype.Hc=function(){return this.rb};O.prototype.getLabel=O.prototype.Hc;O.prototype.pd=function(a){this.rb!==a&&(this.rb=a,this.dispatchEvent(\"update\"));return this};O.prototype.setLabel=O.prototype.pd;O.prototype.Xc=function(){return this.cb};O.prototype.isDisabled=O.prototype.Xc;\nO.prototype.od=function(a){a!==this.cb&&(this.cb=a,this.dispatchEvent(\"update\"));return this};O.prototype.setDisabled=O.prototype.od;var Cd=new O;O.SEPARATOR=Cd;function Dd(a){if(Na.document){var b=document.createElement(\"canvas\");b.width=b.height=1;b.getContext(\"2d\",{Fd:a})}}r(\"H.util.getPixelRatio\",function(){return window.devicePixelRatio||1});Object.create(Ra,void 0);r(\"H.util.eval\",function(a){return eval(a)});r(\"H.util.provide\",function(a){var b=p.$jscomp;if(b&&(\"function\"!=typeof b.Dc?0:b.Dc()))throw Error(\"goog.provide cannot be used within a module.\");qa(a,void 0,void 0)});function Ed(){this.v=0}\nEd.prototype.next=function(a){if(9007199254740992===this.v)throw new Bd(a,this.v,[0,9007199254740991]);return this.v++};var Fd=new Ed;Oa(Fd.next,Fd);var Gd=Qa([]);Qa({});Dd(!0);Dd(!1);function Q(a,b,c){var d;b=b||(a&&a.length?Object.keys(a[0]):x);this.P=a;if(b)for(this.ca=b,this.ab=a=Object.create(Ra,void 0),d=b.length;d--;)a[b[d]]=!0;c!==x&&(this.ub=c)}r(\"H.service.extension.dataView.ObjTable\",Q);l=Q.prototype;l.ub=x;l.P=x;l.ca=x;l.ab=x;l.nb=function(){return this.ub};Q.prototype.getMeta=Q.prototype.nb;Q.prototype.ob=function(){return this.P?this.P.length:0};Q.prototype.getRowCount=Q.prototype.ob;Q.prototype.Ja=function(a){var b=this.P;return b&&b[a]?new vb(this,a):x};\nQ.prototype.getRow=Q.prototype.Ja;Q.prototype.L=function(){return this.ca||Gd};Q.prototype.getColumnNames=Q.prototype.L;Q.prototype.lb=function(a){return this.ab[a]?new tb(this,a):x};Q.prototype.getColumn=Q.prototype.lb;Q.prototype.o=function(a,b){var c=this.P;return(a=c&&this.ab[b]&&c[a])&&a[b]};Q.prototype.getCell=Q.prototype.o;\nQ.prototype.concat=function(){var a=arguments.length,b,c=this.ca,d=\"\"+this.ca,e=(this.P||[]).slice();for(b=0;b<a;b++){var f=arguments[b];if(!(f instanceof Q))throw new y(this.concat,b);if(f.P){if(c&&\"\"+f.ca!==d)throw new y(this.concat,b,\"Incompatible columns!\");e=e.concat(f.P)}}return new Q(e,this.ca,this.ub)};Q.prototype.concat=Q.prototype.concat;function Hd(a,b,c,d){if(!a||!b||!c)throw new y(Hd,x,\"Must specify name, version and revision parameter\");this.name=a;this.version=b;this.revision=c;d&&Ka(this,d)}r(\"H.util.BuildInfo\",Hd);Hd.prototype.toString=function(){var a,b=[];for(a in this)Ya(this[a])&&b.push(this[a]);return b.join(\";\")};var Id={};function Jd(a,b,c,d){if(!a)throw new y(Jd,1,\"Must specify a name parameter\");return Id[a]||(Id[a]=new Hd(a,b,c,d))}Hd.get=Jd;function S(a,b,c,d,e,f){if(a&&b)this.Cb(a),this.Ra(b),this.Ab(c),this.Bb(e),this.ac(f),this.Ta(d);else throw new y(S,x,'Parameters \"scheme\" and \"host\" must be specified');}r(\"H.service.Url\",S);\nfunction Kd(a,b){var c=Na.document,d;var e=\"\";if(c){e=c.createElement(\"a\");if(b){var f=(d=c.getElementsByTagName(\"base\")[0])&&d.href;var g=c.head;var h=d||g.appendChild(c.createElement(\"base\"));h.href=b}e.href=a;e=e.href;b&&(d?d.href=f:g.removeChild(h))}else/[\\w]+:\\/\\//.test(a)&&(e=a);f=/(?:(\\w+):\\/\\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\\/[^?#]*)?(\\?[^#]+)?(#.*)?/.exec(e);a=f[1];g=f[4];b=f[5];h=f[6];c=f[7];d=f[8];!f[2]&&g&&/@/.test(g)&&(g=g.split(\"@\")[1]);f=S;h=h&&0<h.length?h.substr(1):\n\"\";e={};var k,m;if(c)for(k=/([?&]?([^=&+]+))(=([^&]+))?/g;m=k.exec(c);)e[decodeURIComponent(m[2])]=m[4]?decodeURIComponent(m[4]):void 0;return new f(a,g,h,e,isNaN(+b)?void 0:+b,d&&0<d.length?d.substr(1):\"\")}S.parse=Kd;S.prototype.clone=function(){var a={},b;for(b in this.A)a[b]=this.A[b];return new S(this.yb,this.Na,this.X,a,this.wa,this.la)};S.prototype.clone=S.prototype.clone;\nS.prototype.Cb=function(a){if(!a||\"string\"!==typeof a)throw new y(this.Cb,0,'The \"scheme\" parameter must be a non-empty string.');this.yb=a;return this};S.prototype.setScheme=S.prototype.Cb;S.prototype.Oc=function(){return this.yb};S.prototype.getScheme=S.prototype.Oc;S.prototype.Ra=function(a){if(!a||\"string\"!==typeof a||\"-\"===a.charAt(0)||\".\"===a.charAt(0)||\".\"===a.charAt(a.length-1))throw new y(this.Ra,0,'The \"host\" parameter is not a valid host name.');this.Na=a;return this};\nS.prototype.setHost=S.prototype.Ra;S.prototype.Fc=function(){return this.Na};S.prototype.getHost=S.prototype.Fc;S.prototype.Ab=function(a){this.X=a||void 0;return this};S.prototype.setPath=S.prototype.Ab;S.prototype.Lc=function(){return this.X};S.prototype.getPath=S.prototype.Lc;S.prototype.Ta=function(a){if(a)if(\"object\"==typeof a)this.A=a;else throw new y(this.Ta,0,'Parameter \"params\" must be an object.');else this.A={};return this};S.prototype.setQuery=S.prototype.Ta;S.prototype.Sc=function(){return!Ld(this)};\nS.prototype.hasQuery=S.prototype.Sc;S.prototype.getQuery=function(){return this.A};S.prototype.getQuery=S.prototype.getQuery;S.prototype.Bb=function(a){if(void 0===a)this.wa=a;else{var b=ud(+a<<0,0,65535);if(b!=a)throw new y(this.Bb,0,'Parameter \"port\" must be an integer in range [0...65535]');this.wa=b}return this};S.prototype.setPort=S.prototype.Bb;S.prototype.Mc=function(){return this.wa};S.prototype.getPort=S.prototype.Mc;S.prototype.ac=function(a){this.la=a||void 0;return this};\nS.prototype.setAnchor=S.prototype.ac;S.prototype.Bc=function(){return this.la};S.prototype.getAnchor=S.prototype.Bc;S.prototype.ga=function(a){if(\"object\"!==typeof a)throw new y(this.ga,0,'Parameter \"other\" must be an object.');var b=this.A,c;for(c in a)a.hasOwnProperty(c)&&\"function\"!==typeof a[c]&&(b[c]=a[c]);return this};S.prototype.mergeQuery=S.prototype.ga;\nS.prototype.Gb=function(a){if(!a||\"string\"!==typeof a)throw new y(this.Gb,0,'Parameter \"subDomain\" must be a non-empty string');\".\"===a.substr(a.length-1)&&(a=a.substr(0,a.length-1));return this.Ra(a+\".\"+this.Na)};S.prototype.addSubDomain=S.prototype.Gb;S.prototype.Hb=function(a){if(!a||\"string\"!==typeof a)throw new y(this.Hb,0,'Parameter \"subPath\" must be a non-empty string');return this.Ab((this.X?this.X+\"/\":\"\")+a)};S.prototype.addSubPath=S.prototype.Hb;\nS.prototype.toString=function(){return[this.yb+\"://\",this.Na,this.wa?\":\"+this.wa:\"\",this.X||!Ld(this)||this.la?\"/\":\"\",this.X?encodeURI(this.X):\"\",Md(this),this.la?\"#\"+encodeURIComponent(this.la):\"\"].join(\"\")};S.prototype.toString=S.prototype.toString;function Nd(a){return encodeURIComponent(a).replace(/[!'()*]/g,function(b){return\"%\"+b.charCodeAt(0).toString(16)})}\nfunction Md(a){var b=[],c=a.A,d={},e;for(e in c){if(c.hasOwnProperty(e)&&\"function\"!==typeof c[e]){var f=a.A[e];d.$=Nd(e);Ua(f,Od)?f.Va.forEach(function(g){return function(h){b.push(g.$+\"=\"+Nd(h))}}(d)):Ua(f,Pd)?b.push(d.$+\"=\"+f.Va.map(function(g){return Nd(g)}).join(f.tc)):b.push(void 0===f?d.$:d.$+\"=\"+Nd(f))}d={$:d.$}}return 0<b.length?\"?\"+b.join(\"&\"):\"\"}function Ld(a){var b,c=0;for(b in a.A)if(a.A.hasOwnProperty(b)&&\"function\"!==typeof a.A[b]&&(c++,0<c))break;return!c}\nfunction Qd(a,b){if(Wa(a,void 0,void 0,void 0))for(var c=0;c<a.length;c++){var d=a[c];if(!Ya(d)&&!ab(d)){var e=\"The Array does not contain only strings and numbers\";break}}else e=\"Not an Array\";if(e)throw new y(b,0,a);return a}function Od(a){this.Va=Qd(a,Od)}S.MultiValueQueryParameter=Od;Od.prototype.Qc=function(){return this.Va};Od.prototype.getValues=Od.prototype.Qc;function Pd(a,b){this.Va=Qd(a,Pd);if(!/^[!\\$\\(\\)\\*\\+,;]$/.test(b))throw new y(Pd,1,'Invalid delimiter \"'+b+'\"');this.tc=b}\nS.DelimitedQuerySubValues=Pd;var Rd={};function Sd(a){try{importScripts.apply(self,arguments)}catch(b){this.postError(\"invalid_script\")}}function Td(a){delete Rd[a];this.postMessage(a)}function Ud(a,b,c){if(Va(b))var d=b;else try{d=self.eval(\"(\"+b+\")\"),Va(d)||(d=null)}catch(e){}d?(Rd[a]=d,c||this.postMessage(a)):this.postError(\"invalid_processor\")}function Vd(a){this.Wb=a&&a[0];this.Ua=a&&a[1];this.kc=a&&a[2]||[]}Vd.prototype.postError=function(a){this.postMessage(a,x,0)};\nVd.prototype.postMessage=function(a,b,c){self.postMessage({processor:this.Wb,taskId:this.Ua,type:c===x?1:c,data:a},b||x)};function Xd(a,b,c){if(!Ya(a))throw new y(Xd,0,\"InvalidArgument\");if(!Va(b))throw new y(Xd,1,\"InvalidArgument\");var d=Yd++;Zd[d]={mimeType:c||$d,nc:b};(new Vd([\"3\",d,[]])).postMessage(a,[],2)}var Zd={},Yd=0;\nfunction ae(a,b){var c=a;if(Zd[this.Ua]){var d=Zd[this.Ua];var e=d.nc;delete Zd[this.Ua];if(b)e(null,b);else{if(d.mimeType===be){a=new Uint8Array(a);b=a.byteLength;d=\"\";c=0;for(var f,g,h,k;c<b;)f=a[c++],192>f||(g=a[c++],224>f?f=(f&31)<<6|g&63:(h=a[c++],240>f?f=(f&15)<<12|(g&63)<<6|h&63:(k=a[c++],f=(f&7)<<18|(g&63)<<12|(h&63)<<6|k&63))),65536>f?d+=String.fromCharCode(f):(f-=65536,d+=String.fromCharCode((f>>10)+55296,(f&1023)+56320));c=d}e(c)}}}var $d=0,be=1;r(\"H.util.Disposable\",B);B.prototype.aa=B.prototype.aa;B.prototype.addOnDisposeCallback=B.prototype.aa;r(\"H.util.dispose\",function(a){a&&\"function\"==typeof a.C&&a.C()});B.prototype.C=B.prototype.C;B.prototype.dispose=B.prototype.C;B.prototype.K=B.prototype.K;B.prototype.disposeInternal=B.prototype.K;function ce(a,b,c){var d=ud(+a,-90,90);if(b&&$a(d))throw new y(b,c,a);return d}function de(a,b,c){var d=+a;if(-180>d||180<d)d=td(d+180,360)-180;if(b&&$a(d))throw new y(b,c,a);return d}function ee(a,b,c){var d;if(a!==x&&$a(d=+a)&&b)throw new y(b,c,a);return d}r(\"H.geo.isDBC\",function(a,b){return 0>a!==0>b&&180<bd(b-a)});function T(){var a=T;if(!0===(Ua(this,a)&&this.constructor===a))throw new TypeError(\"Illegal constructor \"+cb(a));}r(\"H.geo.AbstractGeometry\",T);T.prototype.getBoundingBox=T.prototype.pa;T.prototype.equals=T.prototype.S;T.prototype.Xa=\"\";T.prototype.kb=\"\";T.prototype.toString=function(){return this.dc([this.Xa.toUpperCase(),\" \"]).join(\"\")};T.prototype.toString=T.prototype.toString;T.prototype.sd=function(){return{type:this.kb,coordinates:this.cc()}};T.prototype.toGeoJSON=T.prototype.sd;\nT.prototype.ib=function(){return{type:this.Xa,coordinates:this.jb(),boundingBox:this.pa().ib()}};T.prototype.forWorkerMessage=T.prototype.ib;function U(a,b,c){this.lat=ce(a,U,0);this.lng=de(b,U,1);c!==x&&(this.alt=ee(c,U,2))}Fa(U,T);r(\"H.geo.Point\",U);U.prototype.S=function(a){return this===a||!!a&&this.lat===a.lat&&this.lng===a.lng&&(this.alt||0)===(a.alt||0)};U.prototype.equals=U.prototype.S;U.prototype.eb=function(a){if(this===a||this.lat===a.lat&&this.lng===a.lng)a=0;else{var b=this.lat*qd;var c=a.lat*qd;a=1.274200158E7*gd(Xc(1,dd(F(fd((b-c)/2),2)+hd(b)*hd(c)*F(fd((this.lng*qd-a.lng*qd)/2),2))))}return a};\nU.prototype.distance=U.prototype.eb;\nU.prototype.vd=function(a,b,c){var d;if(c){if(d=b/6371000.79){b=a*qd;a=qd*this.lat;var e=fd(a);c=fd(d);var f=hd(d);d=qd*this.lng;var g=hd(a);a=gd(g*hd(b)*c+e*f);b=kd(fd(b)*g*c,f-e*fd(a));b=(d+b+K)%(2*K)-K;b*=rd;e=new U(a*rd,(b+540)%360-180)}return e||this}a=(a%360+360)%360;if(0===(a+90)%180)return a=this.lng+b/(6371000.79*od*hd(this.lat*qd))*(270===a?-360:360),new U(this.lat,(a+540)%360-180);if(b/=6371000.79)a*=qd,e=this.lat*qd,c=this.lng*qd,d=e+b*hd(a),f=d-e,g=cd(id(d/2+nd)/id(e/2+nd)),g=$a(f/g)?\nhd(e):f/g,a=b*fd(a)/g,bd(d)>md&&(d=0<d?K-d:-(K+d)),d=new U(d*rd,((c+a+pd+(bd(e+f)>md?K:0))%od-K)*rd);return d||this};U.prototype.walk=U.prototype.vd;U.prototype.pa=function(){return new X(this.lat,this.lng,this.lat,this.lng)};U.prototype.getBoundingBox=U.prototype.pa;function fe(a,b,c){var d=ra(a)&&!($a(a.lat=ce(a.lat))||$a(a.lng=de(a.lng))||a.alt!==x&&$a(a.alt=ee(a.alt)));if(!d&&b)throw new y(b,c,a);return d}U.validate=fe;function ge(a){if(!a)throw new y(ge,0,a);return new U(a.lat,a.lng,a.alt)}\nU.fromIPoint=ge;l=U.prototype;l.Xa=\"Point\";l.dc=function(a){a.push(\"(\",this.lng,\" \",this.lat,\")\");return a};l.kb=\"Point\";l.cc=function(){return[this.lng,this.lat,this.alt||0]};l.jb=function(){return[this.lat,this.lng,this.alt||0]};function X(a,b,c,d){he(this,ce(a,X,0),de(b,X,1),ce(c,X,2),de(d,X,3))}Fa(X,T);r(\"H.geo.Rect\",X);X.prototype.Xa=\"Polygon\";X.prototype.dc=function(a){var b=this.l,c=this.g,d=this.j,e=this.i;a.push(\"(\",\"(\",c,\" \",b,\",\",e,\" \",b,\",\",e,\" \",d,\",\",c,\" \",d,\",\",c,\" \",b,\")\",\")\");return a};X.prototype.S=function(a){var b=this===a;!b&&Ua(a,X)&&(b=this.l===a.l&&this.g===a.g&&this.j===a.j&&this.i===a.i);return b};X.prototype.equals=X.prototype.S;\nX.prototype.clone=function(){return new X(this.l,this.g,this.j,this.i)};X.prototype.clone=X.prototype.clone;function he(a,b,c,d,e){a.g=c;a.i=e;b<d&&(c=b,b=d,d=c);a.l=b;a.j=d;a.Db=a.Za=a.$a=null;return a}X.prototype.Nb=function(){this.Db||(this.Db=new U(this.l,this.g));return this.Db};X.prototype.getTopLeft=X.prototype.Nb;X.prototype.Mb=function(){this.Za||(this.Za=new U(this.j,this.i));return this.Za};X.prototype.getBottomRight=X.prototype.Mb;X.prototype.Pc=function(){return this.l};\nX.prototype.getTop=X.prototype.Pc;X.prototype.Cc=function(){return this.j};X.prototype.getBottom=X.prototype.Cc;X.prototype.Ic=function(){return this.g};X.prototype.getLeft=X.prototype.Ic;X.prototype.Nc=function(){return this.i};X.prototype.getRight=X.prototype.Nc;X.prototype.T=function(){this.$a||(this.$a=new U(this.j+(this.l-this.j)/2,ie(this.g,this.U())));return this.$a};X.prototype.getCenter=X.prototype.T;X.prototype.U=function(){return je(this.g,this.i)};X.prototype.getWidth=X.prototype.U;\nX.prototype.fa=function(){return this.l-this.j};X.prototype.getHeight=X.prototype.fa;X.prototype.Wc=function(){return this.g>this.i};X.prototype.isCDB=X.prototype.Wc;X.prototype.Yc=function(){return!this.U()&&!this.fa()};X.prototype.isEmpty=X.prototype.Yc;X.prototype.pa=function(){return new X(this.l,this.g,this.j,this.i)};X.prototype.getBoundingBox=X.prototype.pa;\nX.prototype.Ha=function(a,b,c){var d=this.T();c||(a=ce(a,this.Ha,0),b=de(b,this.Ha,1));b=this.V(a,b,c);a=b.T();return a.lat===d.lat&&a.lng===d.lng&&this.fa()===b.fa()&&this.U()===b.U()};X.prototype.containsLatLng=X.prototype.Ha;X.prototype.Ia=function(a,b){b||fe(a,this.Ia,0);return this.Ha(a.lat,a.lng,b)};X.prototype.containsPoint=X.prototype.Ia;\nX.prototype.Kb=function(a,b){var c=this.T();if(!b&&!Ua(a,X))throw new y(this.Kb,0,a);b=this.Pa(a,b);a=b.T();return a.lat===c.lat&&a.lng===c.lng&&this.fa()===b.fa()&&this.U()===b.U()};X.prototype.containsRect=X.prototype.Kb;X.prototype.V=function(a,b,c,d){if(!c){if($a(a=ce(a)))throw new y(this.V,0,a);if($a(b=de(b)))throw new y(this.V,1,b);}return ke(this.l,this.g,this.j,this.i,a,b,a,b,d)};X.prototype.mergeLatLng=X.prototype.V;\nX.prototype.Ub=function(a,b,c){b||fe(a,this.Ub,0);return this.V(a.lat,a.lng,b,c)};X.prototype.mergePoint=X.prototype.Ub;X.prototype.Pa=function(a,b,c){if(!b&&!Ua(a,X))throw new y(this.Pa,0,a);return ke(this.l,this.g,this.j,this.i,a.l,a.g,a.j,a.i,c)};X.prototype.mergeRect=X.prototype.Pa;X.prototype.sa=function(a,b,c,d,e,f){e||(a=ce(a,this.sa,0),b=de(b,this.sa,1),c=ce(c,this.sa,2),d=de(d,this.sa,3));return ke(this.l,this.g,this.j,this.i,a,b,c,d,f)};X.prototype.mergeTopLeftBottomRight=X.prototype.sa;\nX.prototype.Qb=function(a,b){var c=this.g<=this.i,d=a.g<=a.i,e=this.g<a.i,f=a.g<this.i;if(!b&&!Ua(a,X))throw new y(this.Qb,0,a);return this.j<=a.l&&a.j<=this.l&&(!c&&(!d||e||f)||!d&&(e||f)||e&&f)};X.prototype.intersects=X.prototype.Qb;function je(a,b){a=b-a;return a+(0>a?360:0)}function ie(a,b){a+=b/2;return a-(180<a?360:0)}\nfunction ke(a,b,c,d,e,f,g,h,k){c=Xc(c,g);a=Yc(a,e);e=je(b,d);var m=ie(b,e);g=je(f,h);var n=ie(f,g)-m;n+=0>n-1E-6?360:0;if(180>n-1E-6){m=b;var q=h}else n=360-n,m=f,q=d;n=n+e/2+g/2;360<=n+5E-7?(m=-180,q=180):n-5E-7<e?(m=b,q=d):n-5E-7<g&&(m=f,q=h);return k?he(k,a,m,c,q):new X(a,m,c,q)}X.merge=ke;function le(a,b,c){c||(fe(a,le,0),fe(b,le,1));return new X(a.lat,a.lng,b.lat,b.lng)}X.fromPoints=le;\nfunction me(a,b){var c=1,d=a.length,e=null;var f=ta(a);if(\"array\"!=f&&(\"object\"!=f||\"number\"!=typeof a.length))throw new y(me,0,a);if(0<d)for(f=a[0],e=le(f,f,b);c<d;c++)f=a[c],e.V(f.lat,f.lng,b,e);return e}X.coverPoints=me;function ne(a,b){var c=3,d=a.length,e;if(!(b||a&&null!=a.length))throw new y(ne,0,a);if(0<d)for(e=new X(a[0],a[1],a[0],a[1]);c<d;c+=3)e.V(a[c],a[c+1],b,e);return e}X.coverLatLngAlts=ne;\nfunction oe(a,b){var c=1,d=a.length,e;if(b&&(!a||null==a.length))throw new y(oe,0,a);if(0<d)for(e=new X(a[0].l,a[0].g,a[0].j,a[0].i);c<d;c++)e.Pa(a[c],b,e);return e}X.coverRects=oe;\nX.prototype.Yb=function(a,b){var c=this.g,d=this.l,e=this.i,f=this.j,g=this.T().lng;fe(a,this.Yb,0);var h=a.lat-f-(d-f)/2;var k=a.lng-g;k=180<k||-180>k?-(g+a.lng):k;a=c+(0>k?2*k:0);a=-180>a?360+a:a;e+=0<k?2*k:0;e=180<e?e-360:e;d=0<h?d+2*h:d;90<=d&&(d=90);f=0>h?f+2*h:f;-90>=f&&(f=-90);return b?he(b,d,a,f,e):new X(d,a,f,e)};X.prototype.resizeToCenter=X.prototype.Yb;X.prototype.kb=\"Polygon\";\nX.prototype.cc=function(){return[[this.g,this.l,0],[this.i,this.l,0],[this.i,this.j,0],[this.g,this.j,0],[this.g,this.l,0]]};X.prototype.ib=function(){return this.jb()};X.prototype.jb=function(){return[this.l,this.g,this.j,this.i]};function Y(a,b){this.x=+a;this.y=+b}r(\"H.math.Point\",Y);Y.prototype.set=Y;Y.prototype.set=Y.prototype.set;Y.prototype.clone=function(a){a?(a.x=this.x,a.y=this.y):a=new Y(this.x,this.y);return a};Y.prototype.clone=Y.prototype.clone;Y.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};Y.prototype.add=Y.prototype.add;Y.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};Y.prototype.sub=Y.prototype.sub;Y.prototype.scale=function(a,b){this.x*=a;this.y*=void 0===b?a:b;return this};\nY.prototype.scale=Y.prototype.scale;Y.prototype.round=function(){this.x=Zc(this.x);this.y=Zc(this.y);return this};Y.prototype.round=Y.prototype.round;Y.prototype.floor=function(){this.x=$c(this.x);this.y=$c(this.y);return this};Y.prototype.floor=Y.prototype.floor;Y.prototype.ceil=function(){this.x=ad(this.x);this.y=ad(this.y);return this};Y.prototype.ceil=Y.prototype.ceil;Y.prototype.S=function(a){return!(!a||this.x!==a.x||this.y!==a.y)};Y.prototype.equals=Y.prototype.S;\nY.prototype.Kc=function(a,b){var c=b.x-a.x,d=b.y-a.y;var e=a;if(c||d)e=((this.x-a.x)*c+(this.y-a.y)*d)/(c*c+d*d),e=0>=e?a:1<=e?b:new Y(a.x+e*c,a.y+e*d);return e};Y.prototype.getNearest=Y.prototype.Kc;Y.prototype.eb=function(a){return dd(F(this.x-a.x,2)+F(this.y-a.y,2))};Y.prototype.distance=Y.prototype.eb;Y.fromIPoint=function(a){if(!a)throw Error(\"invalid argument\");return a instanceof Y?a:new Y(a.x,a.y)};function pe(){}function qe(a){return Xc(1,Yc(0,.5-cd(id(nd+md*a/180))/K/2))}pe.prototype.Oa=function(a,b,c){c?(c.x=b/360+.5,c.y=qe(a)):c=new Y(b/360+.5,qe(a));return c};pe.prototype.latLngToPoint=pe.prototype.Oa;pe.prototype.Ac=function(a,b){return this.Oa(a.lat,a.lng,b)};pe.prototype.geoToPoint=pe.prototype.Ac;function re(a){return 0>=a?90:1<=a?-90:rd*(2*jd(ed(K*(1-2*a)))-md)}\npe.prototype.ka=function(a,b,c){c?(c.lat=re(b),c.lng=360*(1===a?1:td(a,1))-180):c=new U(re(b),360*(1===a?1:td(a,1))-180);return c};pe.prototype.xyToGeo=pe.prototype.ka;pe.prototype.ed=function(a,b){return this.ka(a.x,a.y,b)};pe.prototype.pointToGeo=pe.prototype.ed;var se=new pe;r(\"H.geo.mercator\",se);r(\"H.util.constants.DEFAULT_MIN_ZOOM_LEVEL\",0);r(\"H.util.constants.DEFAULT_MAX_ZOOM_LEVEL\",22);function Z(a,b){this.projection=a||se;this.ec=0;this.Da=this.exp=cd(b||256)/ld;te(this);this.y=this.x=0}r(\"H.geo.PixelProjection\",Z);var ue=bd(24)+bd(-8);Z.prototype.hd=se;Z.prototype.projection=Z.prototype.hd;Z.prototype.x=0;Z.prototype.x=Z.prototype.x;Z.prototype.y=0;Z.prototype.y=Z.prototype.y;Z.prototype.w=F(2,ue);Z.prototype.w=Z.prototype.w;Z.prototype.Rc=F(2,ue);Z.prototype.h=Z.prototype.Rc;\nZ.prototype.Aa=function(a){if($a(a))throw new y(this.Aa,0,a);var b=this.x/this.w;var c=this.y/this.h;this.ec=a;this.Da=this.exp+a;te(this);this.x=b*this.w;this.y=c*this.h};Z.prototype.rescale=Z.prototype.Aa;function te(a){a.Da>ue&&(a.Da=ue);a.w=F(2,a.Da);a.h=F(2,a.Da)}Z.prototype.Ob=function(){return this.ec||0};Z.prototype.getZoomScale=Z.prototype.Ob;Z.prototype.zc=function(a,b){a=this.projection.Oa(a.lat,a.lng,b);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};Z.prototype.geoToPixel=Z.prototype.zc;\nZ.prototype.xb=function(a,b){return this.projection.ka((a.x+this.x)/this.w,(a.y+this.y)/this.h,b)};Z.prototype.pixelToGeo=Z.prototype.xb;Z.prototype.ka=function(a,b,c){return this.projection.ka((a+this.x)/this.w,(b+this.y)/this.h,c)};Z.prototype.xyToGeo=Z.prototype.ka;Z.prototype.sb=function(a,b,c){a=this.projection.Oa(a,b,c);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};Z.prototype.latLngToPixel=Z.prototype.sb;Z.prototype.fd=function(a){return new Y(a.x*this.w-this.x,a.y*this.h-this.y)};\nZ.prototype.pointToPixel=Z.prototype.fd;function ve(a,b,c,d){this.key=\"\";this.x=a;this.y=b;this.Sb=c;this.ra=d;this.O=Fc()}ve.prototype.then=function(a,b,c){return this.O.promise.then(a,b,c)};ve.prototype.resolve=function(a){this.O.resolve(a)};ve.prototype.reject=function(a){this.O.reject(a)};ve.prototype.cancel=function(){this.O.promise.cancel()};ve.prototype.cancel=ve.prototype.cancel;function we(a,b,c,d,e,f){var g,h,k=a.length,m,n;if(k)for(g=[];k--;){var q=a[k];var u=q.length;var I=0;for(m=1;m<u;m++)if(n=xe(q[m-1],q[m],c,b,d,e)){var M=n[0];var w=n[1];I&&I.S(M)?h.push(w):g.push(h=n);I=w;f&&(m=u,k=0)}}else g=a;return g}r(\"H.math.clipping.clipStrips\",we);\nfunction xe(a,b,c,d,e,f){var g=a.x;a=-a.y;var h=b.x;b=-b.y;c=-c;f=-f;if(g>h){if(h>e||g<d)return;var k=g;var m=a;g=h;a=b;h=k;b=m;k=1}else if(g>e||h<d)return;if(a>b){if(b>c||a<f)return;var n=1;a=-a;b=-b;m=f;f=-c;c=-m}else if(a>c||b<f)return;if(g<d){if((a+=(d-g)*(b-a)/(h-g))>c)return;g=d}if(a<f){if((g+=(f-a)*(h-g)/(b-a))>e)return;a=f}h>e&&(b=a+(e-g)*(b-a)/(h-g),h=e);b>c&&(h=g+(c-a)*(h-g)/(b-a),b=c);n&&(a=-a,b=-b);return k?[new Y(h,-b),new Y(g,-a)]:[new Y(g,-a),new Y(h,-b)]}\nfunction ye(a,b,c){a=ze(a,!0);b=ze(b,!1);var d,e;var f={};var g=d=1;switch(~~(1*(c||0))){case 1:g=d=0;break;case 2:d=0;g=1;break;case 3:d=1,g=0}c=d;var h=g;if(b&&a){b.ma=new Ae(b.x,b.y,null,Be(b));a.ma=new Ae(a.x,a.y,null,Be(a));for(g=b;g.next;g=g.next)if(!g.F)for(d=a;d.next;d=d.next)if(!d.F){var k=Ce(g.next);var m=Ce(d.next);if(e=De(g,k,d,m,f)){e=f.ic;var n=f.jc;var q=f.wd;var u=f.xd;e=new Ae(q,u,null,null,null,null,!0,0,0,e);Ee(e,g,k);k=new Ae(q,u,null,null,null,null,!0,0,0,n);Ee(k,d,m);e.vb=k;\nk.vb=e}}f=yd(b,Fe(a));c&&(f=!f);for(g=b;g;g=g.next)g.F&&(g.qb=f,f=!f);f=yd(a,Fe(b));h&&(f=!f);for(d=a;d.next;d=d.next)d.F&&(d.qb=f,f=!f);Ge(b);for(Ge(a);(a=He(b))!=b;){for(c=null;!a.Wa;a=a.vb){for(f=a.qb;;){c=new Ae(a.x,a.y,c);c.artificial=a.F||a.Rb;a.Wa=1;a=f?a.next:a.B;if(!a)break;if(a.F){a.Wa=1;break}}if(!a)break}c.Vb=I||null;var I=c}return I}}r(\"H.math.clipping.clipPolygon\",ye);\nfunction Ae(a,b,c,d,e,f,g,h,k,m){this.x=a;this.y=b;this.next=c||null;this.B=d||null;this.Vb=e||null;this.vb=f||null;this.F=!!g;this.qb=!!h;this.Wa=k||0;this.alpha=m||0;d&&(d.next=this);c&&(c.B=this);this.Rb=!1;this.ma=null}function Ce(a){for(;a&&a.F;)a=a.next;return a}function Be(a){if(a)for(;a.next;)a=a.next;return a}function He(a){var b=a;if(b){do b=b.next;while(b!=a&&(!b.F||b.F&&b.Wa))}return b}function Ge(a){var b=Be(a);b.B.next=a;a.B=b.B}\nfunction De(a,b,c,d,e){var f,g=b.x-a.x,h=b.y-a.y;var k=d.x-c.x;var m=d.y-c.y;var n=g*m-h*k;if(!n)return 0;k=((c.x-a.x)*m-(c.y-a.y)*k)/n;n=(h*(c.x-a.x)-g*(c.y-a.y))/n;if(0>k||1<k||0>n||1<n)return 0;0===k?f=a:1===k?f=b:0===n?f=c:1===n&&(f=d);if(f)return f.x+=2.480549651603763E-5,f.y+=7.321997314118067E-5,f.ma&&(f.ma.x=f.x,f.ma.y=f.y),De(a,b,c,d,e);e.wd=a.x+k*g;e.xd=a.y+k*h;e.ic=k;e.jc=n;return 1}function Fe(a){for(var b=[];a;)b.push(a.x,a.y),a=a.next;return b}\nfunction Ee(a,b,c){for(b=b.next;b!==c&&b.alpha<=a.alpha;)b=b.next;a.next=b;a.B=b.B;a.next.B=a;a.B.next=a}function ze(a,b){for(var c,d=null,e=0,f=a.length;e<f;e++){c=new Ae(a[e].x,a[e].y,d);c.Rb=b;if(c.next=d)d.B=c;d=c}return d};function Ie(a,b,c,d){var e=!!c,f,g=0,h=0,k=0,m=0,n=0,q,u=-1;var I=Na.Float32Array;var M,w=[];if(b){b=Sa(b);a=Sa(a);e&&(f=Sa(c));c=b.length;d=d?1E-7:1E-5;for(M=new I(3*c);g<c;){I=b[g];var G=+I;var W=+a[g];e&&(q=+f[g]);Je.test(I)?0<=u&&(0<g-u&&w.push(u,g+1),u=-1):0>u&&(u=g);g++;m=M[h++]=m+W*d;k=M[h++]=k+G*d;e&&(n=M[h]=n+q);h++}0<=u&&1<c-u&&w.push(u,c)}else M=new I(0);return{path:M,outlineIndices:w}}var Je=/^-?0\\d/;\nfunction Ke(a,b){for(var c=0,d=a.length/3,e=new Na.Array(d),f=0;c<d;)e[c++]=b.sb(a[f],a[++f]),f+=2;return e};function Le(a,b){var c=a.tileSize||256;this.va={};this.$b=Kd(a.serverUrl);this.Ib=b;this.Zc=a.layerConfigs||[];this.Xb=a.projected;this.bc=c;this.lc=!1!==a.batchTiles;this.Tc=a.horizontalMargin||0;this.ad=a.onlyOutline;this.jd=new Z(x,c);this.tb=new Z(x,c);this.tb.Aa(22-Math.log(c)/Math.LN2+8)}Fa(Le,B);\nLe.prototype.ld=function(a,b,c){var d=this.bc,e=this.Tc,f={x:a*d-e,y:b*d};d={x:(a+1)*d-1+e,y:(b+1)*d-1};e=this.jd;e.Aa(c);f=e.xb(f);d=e.xb(d);return Me(this,new X(f.lat,f.lng,d.lat,d.lng),this.Zc,{x:a,y:b,z:c})};Le.prototype.kd=function(a,b,c,d,e){return Me(this,new X(a,b,c,d),e)};\nfunction Me(a,b,c,d){var e=Ne(c),f=e.length,g={},h,k=a.va,m=[],n=[];for(c=0;c<f;c++){var q=e[c];var u=q.layerId;var I=q.level;g[u]=q.columns;q=rb(b,I);var M=q.length-1;for(h=0;h<M;h+=2){var w=[u,q[h+1],q[h],I].join(\"_\");var G=k[w]||a.Ib.get(w);G||(G=new ve(q[h+1],q[h],I,u),G.key=w,k[w]=G,n.push(G));m.push(G)}}n.length&&(a.lc?Oe(a,n):Pe(a,n));return Ec(m.map(function(W){var ia=Oa(this.xc,this,g[W.ra]),N=Oa(this.gd,this,W,d||Qe),Ea=W.then,va=this.wc,wa=W.ra,xa={},v,R=e.length;for(v=0;v<R;v++){var J=\ne[v];if(J.rowFilter){var V=J.layerId;V=V!==x?V:J.layer;xa[V]=Oa(J.rowFilter,J.rowFilterContext)}}return Ea.call(W,Oa(va,this,wa,xa)).then(N).then(ia)},a))}var Qe={x:0,y:0,z:0};Le.prototype.wc=function(a,b,c){var d=c.Rows,e=d.length,f,g;if(e&&(f=b[a])){b=new Q(c.Rows);var h=[];for(g=0;g<e;g++){var k=d[g];f(b.Ja(g),a)&&h.push(k)}a={Rows:h};if(c=c.Meta)a.Meta=c}else a=c;return a};\nfunction Pe(a,b){function c(k,m,n){n?(delete a.va[k.key],k.reject(n)):Re(a,k,m)}var d,e=b.length,f=a.$b;for(d=0;d<e;d++){var g=b[d];var h=f.clone().ga({tilex:g.x}).ga({tiley:g.y}).ga({level:g.Sb}).ga({layer:g.ra});new Xd(h.toString(),Oa(c,null,g),be)}}function Oe(a,b){var c=b.length,d;for(d=0;d<c;d+=15){var e=b.slice(d,d+15);Se(a,e)}}\nfunction Se(a,b){var c=a.$b.clone(),d=[],e=[],f=[],g=c.getQuery();b.length&&(b.forEach(function(h){d.push(h.x,h.y);e.push(h.Sb);f.push(h.ra)}),g.tilexy=d.join(\",\"),g.layers=f.join(\",\"),g.levels=e.join(\",\"),c.Ta(g),new Xd(c.toString(),function(h,k){k?b.forEach(function(m){delete a.va[m.key];m.reject(\"error\")}):Re(a,b,h)},be))}\nfunction Re(a,b,c){var d=b.length,e;if(Wa(b,void 0,void 0,void 0)){var f=c.indexOf(\"[\")+1;for(e=0;e<d;e++){var g=c.indexOf(\"]},{\",f+3)+2;g<f&&(g=c.lastIndexOf(\"]}\"));var h=c.substr(f,g-f);f=g+1;Te(a,b[e],h)}}else Te(a,b,c)}function Te(a,b,c){try{var d=c.length;var e=b.key;delete a.va[e];a.Ib.add(e,b,2*d);b.resolve(JSON.parse(c))}catch(f){b.reject(f.message)}}function Ue(a,b,c,d,e){return e?[new Y(a,b),new Y(c,b),new Y(c,d),new Y(a,d),new Y(a,b)]:[a,b,c,b,c,d,a,d]}\nLe.prototype.gd=function(a,b,c){var d=this.tb.Ob()-b.z,e=this.bc<<d,f=50<<d,g=b.x*e;b=b.y*e;var h=g+e;e=b+e;var k=g-f,m=b-f,n=h+f;f=e+f;var q,u,I=c.Rows,M=I.length,w,G=/^ADAS/.test(a.ra),W=this.tb,ia=this.ad,N,Ea=[],va=[],wa=[],xa=[];for(a=0;a<M;a++){var v=w=I[a];var R=(N=G)?\"HPY\":\"LAT\";var J=N?\"HPX\":\"LON\";var V=N?\"HPZ\":\"ZLEVEL\";if(v[R]){var P=Ie(v[R],v[J],v[V],N);v.geometry=P;delete v[R];delete v[J];delete v[V];if(v.INNER_LAT)for(R=v.INNER_LAT.split(\";\"),P=v.INNER_LON.split(\";\"),delete v.INNER_LAT,\ndelete v.INNER_LON,v.interiors=V=[],J=R.length,v=0;v<J;v++)V.push(Ie(R[v],P[v],\"\",N))}if(this.Xb){J=w;v=W;P=J.$$projected$$;R=0;if(!P){var aa=J.geometry;N=Ke(aa.path,v);w=[N];J.$$projected$$=P={dd:w};J=(V=J.interiors)?V.length:0;w.length+=J;R|=+Ve(w,N,aa.outlineIndices);if(J)for(P.Uc=1,q=0;q<J;q++)aa=V[q],N=Ke(aa.path,v),w[1+q]=N,R|=+Ve(w,N,aa.outlineIndices);R&&(P.bd=1+J)}v=P;N=v.dd;w=v.Uc;var kc=v.bd;P=[];R=J=sd;var Za=V=x;v=N[0];if(1===v.length){var lc=lc||(lc=Ue(g,b,h,e,!1));w=v[0];xd(w.x,w.y,\nlc)&&P.push(We(v,g,b,d))}else{var Wd=N.length;for(aa=ia?kc:0;aa<Wd&&(ia||!aa||P.length);aa++)if(v=N[aa],aa>=kc){aa===kc&&(R=P.length);var ja=we([v],k,m,n,f,!1);Xe(ja,g,b,d,P)}else{var Bb=Bb||(Bb=Ue(k,m,n,f,!0));if(aa>=w)if(aa===w&&(J=P.length),Za)for(q=Za.length;q--;){if(ja=Ye(Za[q],v),u=ja.length){for(V=V||[];u--;)V.push(q);Xe(ja,g,b,d,P)}}else ja=Ye(Bb,v),Xe(ja,g,b,d,P);else if(ja=Ye(Bb,v),Xe(ja,g,b,d,P),1<ja.length&&w<Wd)for(Za=[],q=ja.length;q--;)Za[q]=ja[q]}}P.length&&(Ea[a]=P,va[a]=J,wa[a]=\nV,xa[a]=R)}}return{rd:c,pc:Ea,Vc:va,vc:wa,cd:xa}};function Ve(a,b,c){for(var d=c.length,e=0,f,g,h=b.length;e<d;)f=c[e++],g=c[e++],a.push(g-f===h?b:b.slice(f,g));return 0<c.length}function Ye(a,b){var c,d=[];if(c=ye(a,b)){do{a=[];b=c;do a.push(b);while(b=b.next);d.push(a)}while(c=c.Vb)}else yd(b[0],zd(a))?d.push(b):yd(a[0],zd(b))&&d.push(a);return d}function Xe(a,b,c,d,e){for(var f=0,g=a.length;f<g;f++)e.push(We(a[f],b,c,d))}\nfunction We(a,b,c,d){var e,f=a.length,g=new Int32Array(2*f),h=0;for(e=0;e<f;e++){var k=a[e];g[h++]=k.x-b>>d;g[h++]=k.y-c>>d}return g}\nLe.prototype.xc=function(a,b){var c=b.rd,d=b.pc,e=b.Vc,f=b.cd;b=b.vc;for(var g=[],h,k={Rows:g},m,n=a?a.length:0,q=0,u,I=c.Rows,M=I.length,w;q<M;q+=1)if(d[q]||!this.Xb){h={};u=I[q];if(n)for(m=0;m<n;m++)u.hasOwnProperty(a[m])&&(h[a[m]]=u[a[m]]);else for(w in u)\"$$projected$$\"!==w&&(h[w]=u[w]);u.geometry&&(h.geometry=u.geometry);m=void 0;var G,W=h,ia=d[q],N=e[q],Ea=b[q],va=f[q],wa=g;if(ia){var xa=ia.length;if(Ea)for(G=N;G--;){if(G){var v={};for(m in W)v[m]=W[m]}else v=W;u=[ia[G]];var R=Xc(xa,va)-N;for(h=\n0;h<R;h++)Ea[h]===G&&u.push(ia[N+h]);R=u.length;if(!G)for(h=va;h<xa;h++)u.push(ia[h]);v.$HProjGeometry={paths:u,interiorsIndex:1,outlinesIndex:R};wa.push(v)}else W.$HProjGeometry={paths:ia,interiorsIndex:N,outlinesIndex:va},wa.push(W)}else wa.push(W)}c.Meta&&(k.Meta=c.Meta);return k};Le.prototype.K=function(){var a,b=this.va;for(a in b)b.hasOwnProperty(a)&&(b[a].reject(\"disposed\"),delete b[a])};Le.prototype.disposeInternal=Le.prototype.K;\nfunction Ne(a){for(var b=[],c,d=a.length,e=0;e<d;e++){c=Ia(a[e]);if(c.rowFilter&&(c.rowFilter=eval(\"(\"+c.rowFilter+\")\"),!Va(c.rowFilter)))throw Error(\"Invalid row filter for layer \"+c.layerId);b.push(c)}return b};r(\"H.service.extension.worker.processor\",function(a,b,c){function d(h){e.postMessage(h)}var e=this,f=Ha[a];var g=function(h){e.postError(h.toString())};if(0===b)f||(Ha[a]=new Le(c,Ze)),this.postMessage(void 0);else if(f)switch(b){case 1:try{f.ld.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 2:try{f.kd.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 3:f.C();delete Ha[a];Ga()&&Ze.ia();break;default:e.postError(\"Unsupported command\")}});\nvar Ze=new z(26214400),Ha=Object.create(Ra,void 0);function $e(a,b,c){var d=a[b];a=a[b+1];this.Pb=[];this.Eb=0;this.oc=b;this.mc=[a-c,d-c,a+c,d+c]}$e.prototype.Ia=function(a,b){var c=a[b];a=a[b+1];b=this.mc;return b[1]<=c&&c<=b[3]&&b[0]<=a&&a<=b[2]};$e.prototype.T=function(){return this.oc};var af=new Y(0,0);function bf(a,b,c,d,e){d[e]=b;d[e+1]=a}var cf=new Z;function df(a,b,c,d,e){cf.sb(a,b,af);d[e]=af.x;d[e+1]=af.y}\nr(\"H.clustering.dynamicgrid.worker\",function(a,b,c,d,e){var f=e?bf:df,g=0;e=!!self.ArrayBuffer;var h=a.byteLength?new Float64Array(a):a,k=h.length/3;a=[];var m=[],n=[],q=e?new Float64Array(2*k):[];k=0;var u=0;for(cf.Aa(d);g<h.length;){var I=h[g++];var M=h[g++];var w=h[g++];f(w,M,d,q,u);for(w=a.length;w--;)if(M=a[w],M.Ia(q,u)){var G=M;break}G||(G=new $e(q,u,b),a.push(G));w=u/2;G.Eb+=I||1;G.Pb.push(w);G=null;u+=2}for(w=a.length;w--;)M=a[w],b=M.Eb>=c,f=M.Pb,d=f.length,b?(m.push(d),m=m.concat(f)):\n(k+=d,n=n.concat(f));c=[k].concat(n).concat(m);c=e?(new Uint32Array(c)).buffer:c;this.postMessage(c,[c])});self.addEventListener(\"message\",function(a){a=new Vd(a.data);var b=Rd[a.Wb];if(b)try{b.apply(a,a.kc)}catch(c){a.postError(c.message)}else a.postError(\"processor_not_found\")});(function(){var a=new Vd;var b=function(c,d){Ud.apply(a,[c,d,!0])};b(\"0\",Sd);b(\"1\",Ud);b(\"2\",Td);b(\"3\",ae)})();\n";
/**!
 * The code below uses open source software. Please visit the URL below for an overview of the licenses: 
 * https://sdk.venues.here.com/v3/3.1/HERE_NOTICE 
 */
this.H=this.H||{},this.H.venues=function(e){"use strict";function t(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}function n(e,t,n){if(r())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,t);var o=new(e.bind.apply(e,i));return n&&g(o,n.prototype),o}function r(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(r=function(){return!!e})()}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(){a=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,a=Object.create(o.prototype),s=new w(r||[]);return i(a,"_invoke",{value:T(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",f="suspendedYield",v="executing",g="completed",y={};function m(){}function E(){}function I(){}var _={};c(_,s,(function(){return this}));var S=Object.getPrototypeOf,b=S&&S(S(x([])));b&&b!==n&&r.call(b,s)&&(_=b);var M=I.prototype=m.prototype=Object.create(_);function L(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function n(i,o,a,s){var u=d(e[i],e,o);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==typeof c&&r.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(c).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function T(t,n,r){var i=p;return function(o,a){if(i===v)throw Error("Generator is already running");if(i===g){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=O(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=v;var l=d(t,n,r);if("normal"===l.type){if(i=r.done?g:f,l.arg===y)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=g,r.method="throw",r.arg=l.arg)}}}function O(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=d(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function x(t){if(t||""===t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return E.prototype=I,i(M,"constructor",{value:I,configurable:!0}),i(I,"constructor",{value:E,configurable:!0}),E.displayName=c(I,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,I):(e.__proto__=I,c(e,l,"GeneratorFunction")),e.prototype=Object.create(M),e},t.awrap=function(e){return{__await:e}},L(A.prototype),c(A.prototype,u,(function(){return this})),t.AsyncIterator=A,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new A(h(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},L(M),c(M,l,"Generator"),c(M,s,(function(){return this})),c(M,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=x,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:x(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function d(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function y(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e){var t=r();return function(){var n,r=v(e);if(t){var i=v(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}(this,n)}}function I(){return I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},I.apply(this,arguments)}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||b(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||b(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}t(".H_l_right .venues-ui__drawings .trigger.button--active .arrow {\n  transform: rotate(90deg);\n}\n.H_l_right .venues-ui__drawings .drawings {\n  right: 45px;\n  left: initial;\n}");var L=function(e){f(n,H.map.Feature);var t=E(n);function n(e){var r;return c(this,n),(r=t.call(this)).id=e.id,r.model=e,r}return d(n,[{key:"getData",value:function(){return this.model}},{key:"getAddress",value:function(){return this.model.getInternalAddress()}},{key:"getCenter",value:function(){var e=_(this.model.getCenter(),2),t=e[0],n=e[1];return new H.geo.Point(n,t)}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"toGeoJSON",value:function(){return this.model.toJSON()}},{key:"getLevel",value:function(){return this.getParentEventTarget()}},{key:"getVenue",value:function(){return this.getLevel().getDrawing().getParentEventTarget()}}]),n}(),A=function(e){f(r,H.map.Feature);var t=E(r);function r(e){var n;return c(this,r),(n=t.call(this)).id=e.id,n.model=e,n}return d(r,[{key:"getData",value:function(){return this.model}},{key:"getBoundingBox",value:function(){return n(H.geo.Rect,S(this.model.getBoundingBox()))}},{key:"getCenter",value:function(){var e=_(this.model.getCenter(),2),t=e[0],n=e[1];return new H.geo.Point(n,t)}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"getLevel",value:function(e){return this.getLevels().find((function(t){return t.getIdentifier()===e}))}},{key:"getLevels",value:function(){var e=this.getData().getLevels().map((function(e){return e.getIdentifier()}));return this.getVenue().getLevels().filter((function(t){return-1!==e.indexOf(t.id)}))}},{key:"getMainLevel",value:function(){return this.getLevel(this.model.getMainLevel().getIdentifier())}},{key:"getVenue",value:function(){return this.getParentEventTarget()}}]),r}(),T=function(e){f(n,H.map.Feature);var t=E(n);function n(e){var r;return c(this,n),(r=t.call(this)).id=e.id,r.model=e,r}return d(n,[{key:"getGeometry",value:function(e){return this.getGeometries().find((function(t){return t.getIdentifier()===e}))}},{key:"getGeometries",value:function(){var e=this.getData().getGeometries().map((function(e){return e.getIdentifier()}));return this.getDrawing().getVenue().getGeometries().filter((function(t){return-1!==e.indexOf(t.id)}))}},{key:"getData",value:function(){return this.model}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"getShortName",value:function(){return this.model.getShortName()}},{key:"getZIndex",value:function(){return this.model.getZIndex()}},{key:"isMain",value:function(){return this.model.isMain()}},{key:"getDrawing",value:function(){return this.getParentEventTarget()}},{key:"getVenue",value:function(){return this.getDrawing().getParentEventTarget()}}]),n}();function O(e,t,n,r){for(var i,o=r,a=n-t>>1,s=n-t,u=e[t],l=e[t+1],c=e[n],h=e[n+1],d=t+3;d<n;d+=3){var p=N(e[d],e[d+1],u,l,c,h);if(p>o)i=d,o=p;else if(p===o){var f=Math.abs(d-a);f<s&&(i=d,s=f)}}o>r&&(i-t>3&&O(e,t,i,r),e[i+2]=o,n-i>3&&O(e,i,n,r))}function N(e,t,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((e-n)*a+(t-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=e-n)*a+(s=t-r)*s}function k(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)w(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)w(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)w(e,t[r][i])}(i),i}function w(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function x(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=t.id;if(n.promoteId?u=t.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)P(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)P(i[l],s);else if("LineString"===o)C(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],C(i[l],s,a,!1),e.push(k(u,"LineString",s,t.properties));return}D(i,s,a,!1)}else if("Polygon"===o)D(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<t.geometry.geometries.length;l++)x(e,{id:u,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];D(i[l],c,a,!0),s.push(c)}}e.push(k(u,o,s,t.properties))}}function P(e,t){t.push(j(e[0])),t.push(G(e[1])),t.push(0)}function C(e,t,n,r){for(var i,o,a=0,s=0;s<e.length;s++){var u=j(e[s][0]),l=G(e[s][1]);t.push(u),t.push(l),t.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=t.length-3;t[2]=1,O(t,0,c,n),t[c+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function D(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];C(e[i],o,n,r),t.push(o)}}function j(e){return e/360+.5}function G(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function R(e,t,n,r,i,o,a,s){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;for(var u=[],l=0;l<e.length;l++){var c=e[l],h=c.geometry,d=c.type,p=0===i?c.minX:c.minY,f=0===i?c.maxX:c.maxY;if(p>=n&&f<r)u.push(c);else if(!(f<n||p>=r)){var v=[];if("Point"===d||"MultiPoint"===d)V(h,v,n,r,i);else if("LineString"===d)z(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===d)U(h,v,n,r,i,!1);else if("Polygon"===d)U(h,v,n,r,i,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var y=[];U(h[g],y,n,r,i,!0),y.length&&v.push(y)}if(v.length){if(s.lineMetrics&&"LineString"===d){for(g=0;g<v.length;g++)u.push(k(c.id,d,v[g],c.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===v.length?(d="LineString",v=v[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===v.length?"Point":"MultiPoint"),u.push(k(c.id,d,v,c.tags))}}}return u.length?u:null}function V(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=n&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function z(e,t,n,r,i,o,a){for(var s,u,l=B(e),c=0===i?Y:Z,h=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],v=e[d+2],g=e[d+3],y=e[d+4],m=0===i?p:f,E=0===i?g:y,I=!1;a&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-y,2))),m<n?E>n&&(u=c(l,p,f,g,y,n),a&&(l.start=h+s*u)):m>r?E<r&&(u=c(l,p,f,g,y,r),a&&(l.start=h+s*u)):F(l,p,f,v),E<n&&m>=n&&(u=c(l,p,f,g,y,n),I=!0),E>r&&m<=r&&(u=c(l,p,f,g,y,r),I=!0),!o&&I&&(a&&(l.end=h+s*u),t.push(l),l=B(e)),a&&(h+=s)}var _=e.length-3;p=e[_],f=e[_+1],v=e[_+2],(m=0===i?p:f)>=n&&m<=r&&F(l,p,f,v),_=l.length-3,o&&_>=3&&(l[_]!==l[0]||l[_+1]!==l[1])&&F(l,l[0],l[1],l[2]),l.length&&t.push(l)}function B(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function U(e,t,n,r,i,o){for(var a=0;a<e.length;a++)z(e[a],t,n,r,i,o,!1)}function F(e,t,n,r){e.push(t),e.push(n),e.push(r)}function Y(e,t,n,r,i,o){var a=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*a),e.push(1),a}function Z(e,t,n,r,i,o){var a=(o-n)/(i-n);return e.push(t+(r-t)*a),e.push(o),e.push(1),a}function W(e,t){for(var n=[],r=0;r<e.length;r++){var i,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=K(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(K(o.geometry[s],t))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(K(o.geometry[s][l],t));i.push(u)}n.push(k(o.id,a,i,o.tags))}return n}function K(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function J(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,a=e.x,s=e.y;for(n=0;n<e.features.length;n++){var u=e.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(X(l[r],l[r+1],t,o,a,s));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push(X(l[r][i],l[r][i+1],t,o,a,s));u.geometry.push(h)}}return e.transformed=!0,e}function X(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function Q(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,q(a,e[s],o,i);var u=e[s].minX,l=e[s].minY,c=e[s].maxX,h=e[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function q(e,t,n,r){var i=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)$(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)$(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)$(a,l[s],e,n,!0,0===s)}if(a.length){var c=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var d={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(d.id=t.id),e.features.push(d)}}function $(e,t,n,r,i,o){var a=r*r;if(r>0&&t.size<(i?a:r))n.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>a)&&(n.numSimplified++,s.push(t[u]),s.push(t[u+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=a,e[i-1-r]=s}}(s,o),e.push(s)}}function ee(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)x(n,e.features[r],t,r);else"Feature"===e.type?x(n,e,t):x(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(e,t){var n=t.buffer/t.extent,r=e,i=R(e,1,-1-n,n,0,-1,2,t),o=R(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=R(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=W(i,1).concat(r)),o&&(r=r.concat(W(o,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function te(e,t,n){return 32*((1<<e)*n+t)+e}ee.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ee.prototype.splitTile=function(e,t,n,r,i,o,a){for(var s=[e,t,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,h=te(t,n,r),d=this.tiles[h];if(!d&&(l>1&&console.time("creation"),d=this.tiles[h]=Q(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=e,i){if(t===u.maxZoom||t===i)continue;var f=1<<i-t;if(n!==Math.floor(o/f)||r!==Math.floor(a/f))continue}else if(t===u.indexMaxZoom||d.numPoints<=u.indexMaxPoints)continue;if(d.source=null,0!==e.length){l>1&&console.time("clipping");var v,g,y,m,E,I,_=.5*u.buffer/u.extent,S=.5-_,b=.5+_,M=1+_;v=g=y=m=null,E=R(e,c,n-_,n+b,0,d.minX,d.maxX,u),I=R(e,c,n+S,n+M,0,d.minX,d.maxX,u),e=null,E&&(v=R(E,c,r-_,r+b,1,d.minY,d.maxY,u),g=R(E,c,r+S,r+M,1,d.minY,d.maxY,u),E=null),I&&(y=R(I,c,r-_,r+b,1,d.minY,d.maxY,u),m=R(I,c,r+S,r+M,1,d.minY,d.maxY,u),I=null),l>1&&console.timeEnd("clipping"),s.push(v||[],t+1,2*n,2*r),s.push(g||[],t+1,2*n,2*r+1),s.push(y||[],t+1,2*n+1,2*r),s.push(m||[],t+1,2*n+1,2*r+1)}}},ee.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var a=1<<e,s=te(e,t=(t%a+a)%a,n);if(this.tiles[s])return J(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var u,l=e,c=t,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[te(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?J(this.tiles[s],i):null):null};var ne="Point",re="Polygon",ie="MultiPoint",oe="MultiLineString",ae="MultiPolygon",se={fillColor:"#e0e0e0",outlineColor:"#829DB4",outlineWidth:1},ue={fill:"#333333",size:13},le={fillColor:"#F2F285",outlineColor:"#0088BF",outlineWidth:1.2},ce=16,he=18,de=24,pe={FOOTPRINT:"FOOTPRINT",ICON:"ICON",TEXT:"TEXT",VECTOR:"VECTOR"},fe=Object.freeze({v1:1,v2:2}),ve=1,ge=2,ye=3,me="CW",Ee="CCW",Ie=function(e){var t=function(e){for(var t=0,n=e.length,r=0;r<n-1;r+=1){var i=e[r],o=e[r+1];t+=i[0]*o[1]-o[0]*i[1]}return t+(e[n-1][0]*e[0][1]-e[0][0]*e[n-1][1])}(e);return t>0?me:t<0?Ee:void 0},_e=function(e){for(var t,n=[],r=[],i=0,o=e.coordinates.length;i<o;i+=1){var a=e.coordinates[i],s=Ie(a);null!==s&&(s===(t=t||s)&&r.length&&(n.push(r),r=[]),r.push(a))}return r.length>0&&n.push(r),1===n.length?(e.type=re,e.coordinates=n[0]):n.length>1?(e.type=ae,e.coordinates=n):e=null,e},Se=function(e,t,n,r,i){var o,a,s,u,l,c,h=function(e,t,n,r,i){var o=1<<t,a=[];return a[0]=(e[0]/i+n)/o,a[1]=(e[1]/i+r)/o,{x:a[0],y:a[1]}}(e,t,n,r,i);return a=(o=h).x,s=o.y,u=360*(a-.5),l=Math.exp(Math.PI*(.5-s)/.25)-1,c=Math.exp(Math.PI*(.5-s)/.25)+1,[u,180*Math.asin(l/c)/Math.PI]};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof __webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self&&self;var be,Me,Le,Ae=(be=function(e,t){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==u(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==u(Symbol.iterator)?function(e){return u(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":u(e)})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(1),a=n(7),s=a.get,l=(a.deepValue,a.isArray),c=function(){function e(t,n){var r=n.location,i=void 0===r?0:r,o=n.distance,a=void 0===o?100:o,u=n.threshold,l=void 0===u?.6:u,c=n.maxPatternLength,h=void 0===c?32:c,d=n.caseSensitive,p=void 0!==d&&d,f=n.tokenSeparator,v=void 0===f?/ +/g:f,g=n.findAllMatches,y=void 0!==g&&g,m=n.minMatchCharLength,E=void 0===m?1:m,I=n.id,_=void 0===I?null:I,S=n.keys,b=void 0===S?[]:S,M=n.shouldSort,L=void 0===M||M,A=n.getFn,T=void 0===A?s:A,O=n.sortFn,N=void 0===O?function(e,t){return e.score-t.score}:O,k=n.tokenize,w=void 0!==k&&k,x=n.matchAllTokens,P=void 0!==x&&x,C=n.includeMatches,D=void 0!==C&&C,j=n.includeScore,G=void 0!==j&&j,R=n.verbose,V=void 0!==R&&R;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:a,threshold:l,maxPatternLength:h,isCaseSensitive:p,tokenSeparator:v,findAllMatches:y,minMatchCharLength:E,id:_,keys:b,includeMatches:D,includeScore:G,shouldSort:L,getFn:T,sortFn:N,verbose:V,tokenize:w,matchAllTokens:P},this.setCollection(t),this._processKeys(b)}var t;return(t=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"_processKeys",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&"string"==typeof e[0])for(var t=0,n=e.length;t<n;t+=1){var r=e[t];this._keyWeights[r]=1,this._keyNames.push(r)}else{for(var i=null,o=null,a=0,s=0,u=e.length;s<u;s+=1){var l=e[s];if(!l.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var c=l.name;if(this._keyNames.push(c),!l.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var h=l.weight;if(h<0||h>1)throw new Error('"weight" property in key must bein the range of [0, 1)');o=null==o?h:Math.max(o,h),i=null==i?h:Math.min(i,h),this._keyWeights[c]=h,a+=h}if(a>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var n=this._prepareSearchers(e),r=n.tokenSearchers,i=n.fullSearcher,o=this._search(r,i);return this._computeScore(o),this.options.shouldSort&&this._sort(o),t.limit&&"number"==typeof t.limit&&(o=o.slice(0,t.limit)),this._format(o)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),r=0,i=n.length;r<i;r+=1)t.push(new o(n[r],this.options));return{tokenSearchers:t,fullSearcher:new o(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.list,r={},i=[];if("string"==typeof n[0]){for(var o=0,a=n.length;o<a;o+=1)this._analyze({key:"",value:n[o],record:o,index:o},{resultMap:r,results:i,tokenSearchers:e,fullSearcher:t});return i}for(var s=0,u=n.length;s<u;s+=1)for(var l=n[s],c=0,h=this._keyNames.length;c<h;c+=1){var d=this._keyNames[c];this._analyze({key:d,value:this.options.getFn(l,d),record:l,index:s},{resultMap:r,results:i,tokenSearchers:e,fullSearcher:t})}return i}},{key:"_analyze",value:function(e,t){var n=this,r=e.key,i=e.arrayIndex,o=void 0===i?-1:i,a=e.value,s=e.record,u=e.index,c=t.tokenSearchers,h=void 0===c?[]:c,d=t.fullSearcher,p=t.resultMap,f=void 0===p?{}:p,v=t.results,g=void 0===v?[]:v;!function e(t,i,o,a){if(null!=i)if("string"==typeof i){var s=!1,u=-1,c=0;n._log("\nKey: ".concat(""===r?"--":r));var p=d.search(i);if(n._log('Full text: "'.concat(i,'", score: ').concat(p.score)),n.options.tokenize){for(var v=i.split(n.options.tokenSeparator),y=v.length,m=[],E=0,I=h.length;E<I;E+=1){var _=h[E];n._log('\nPattern: "'.concat(_.pattern,'"'));for(var S=!1,b=0;b<y;b+=1){var M=v[b],L=_.search(M),A={};L.isMatch?(A[M]=L.score,s=!0,S=!0,m.push(L.score)):(A[M]=1,n.options.matchAllTokens||m.push(1)),n._log('Token: "'.concat(M,'", score: ').concat(A[M]))}S&&(c+=1)}u=m[0];for(var T=m.length,O=1;O<T;O+=1)u+=m[O];u/=T,n._log("Token score average:",u)}var N=p.score;u>-1&&(N=(N+u)/2),n._log("Score average:",N);var k=!n.options.tokenize||!n.options.matchAllTokens||c>=h.length;if(n._log("\nCheck Matches: ".concat(k)),(s||p.isMatch)&&k){var w={key:r,arrayIndex:t,value:i,score:N};n.options.includeMatches&&(w.matchedIndices=p.matchedIndices);var x=f[a];x?x.output.push(w):(f[a]={item:o,output:[w]},g.push(f[a]))}}else if(l(i))for(var P=0,C=i.length;P<C;P+=1)e(P,i[P],o,a)}(o,a,s,u)}},{key:"_computeScore",value:function(e){this._log("\n\nComputing score:\n");for(var t=this._keyWeights,n=!!Object.keys(t).length,r=0,i=e.length;r<i;r+=1){for(var o=e[r],a=o.output,s=a.length,u=1,l=0;l<s;l+=1){var c=a[l],h=c.key,d=n?t[h]:1,p=0===c.score&&t&&t[h]>0?Number.EPSILON:c.score;u*=Math.pow(p,d)}o.score=u,this._log(o)}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var n=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,(function(e,t){if("object"===r(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}),2)),n=null}var i=[];this.options.includeMatches&&i.push((function(e,t){var n=e.output;t.matches=[];for(var r=0,i=n.length;r<i;r+=1){var o=n[r];if(0!==o.matchedIndices.length){var a={indices:o.matchedIndices,value:o.value};o.key&&(a.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(a.arrayIndex=o.arrayIndex),t.matches.push(a)}}})),this.options.includeScore&&i.push((function(e,t){t.score=e.score}));for(var o=0,a=e.length;o<a;o+=1){var s=e[o];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),i.length){for(var u={item:s.item},l=0,c=i.length;l<c;l+=1)i[l](s,u);t.push(u)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&i(e.prototype,t),e}();e.exports=c},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=n(2),o=n(3),a=n(6),s=function(){function e(t,n){var r=n.location,i=void 0===r?0:r,o=n.distance,s=void 0===o?100:o,u=n.threshold,l=void 0===u?.6:u,c=n.maxPatternLength,h=void 0===c?32:c,d=n.isCaseSensitive,p=void 0!==d&&d,f=n.tokenSeparator,v=void 0===f?/ +/g:f,g=n.findAllMatches,y=void 0!==g&&g,m=n.minMatchCharLength,E=void 0===m?1:m,I=n.includeMatches,_=void 0!==I&&I;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:s,threshold:l,maxPatternLength:h,isCaseSensitive:p,tokenSeparator:v,findAllMatches:y,includeMatches:_,minMatchCharLength:E},this.pattern=p?t:t.toLowerCase(),this.pattern.length<=h&&(this.patternAlphabet=a(this.pattern))}var t;return(t=[{key:"search",value:function(e){var t=this.options,n=t.isCaseSensitive,r=t.includeMatches;if(n||(e=e.toLowerCase()),this.pattern===e){var a={isMatch:!0,score:0};return r&&(a.matchedIndices=[[0,e.length-1]]),a}var s=this.options,u=s.maxPatternLength,l=s.tokenSeparator;if(this.pattern.length>u)return i(e,this.pattern,l);var c=this.options,h=c.location,d=c.distance,p=c.threshold,f=c.findAllMatches,v=c.minMatchCharLength;return o(e,this.pattern,this.patternAlphabet,{location:h,distance:d,threshold:p,findAllMatches:f,minMatchCharLength:v,includeMatches:r})}}])&&r(e.prototype,t),e}();e.exports=s},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,i=new RegExp(t.replace(n,"\\$&").replace(r,"|")),o=e.match(i),a=!!o,s=[];if(a)for(var u=0,l=o.length;u<l;u+=1){var c=o[u];s.push([e.indexOf(c),c.length-1])}return{score:a?.5:1,isMatch:a,matchedIndices:s}}},function(e,t,n){var r=n(4),i=n(5);e.exports=function(e,t,n,o){for(var a=o.location,s=void 0===a?0:a,u=o.distance,l=void 0===u?100:u,c=o.threshold,h=void 0===c?.6:c,d=o.findAllMatches,p=void 0!==d&&d,f=o.minMatchCharLength,v=void 0===f?1:f,g=o.includeMatches,y=void 0!==g&&g,m=s,E=e.length,I=h,_=e.indexOf(t,m),S=t.length,b=[],M=0;M<E;M+=1)b[M]=0;if(-1!==_){var L=r(t,{errors:0,currentLocation:_,expectedLocation:m,distance:l});if(I=Math.min(L,I),-1!==(_=e.lastIndexOf(t,m+S))){var A=r(t,{errors:0,currentLocation:_,expectedLocation:m,distance:l});I=Math.min(A,I)}}_=-1;for(var T=[],O=1,N=S+E,k=1<<(S<=31?S-1:30),w=0;w<S;w+=1){for(var x=0,P=N;x<P;)r(t,{errors:w,currentLocation:m+P,expectedLocation:m,distance:l})<=I?x=P:N=P,P=Math.floor((N-x)/2+x);N=P;var C=Math.max(1,m-P+1),D=p?E:Math.min(m+P,E)+S,j=Array(D+2);j[D+1]=(1<<w)-1;for(var G=D;G>=C;G-=1){var R=G-1,V=n[e.charAt(R)];if(V&&(b[R]=1),j[G]=(j[G+1]<<1|1)&V,0!==w&&(j[G]|=(T[G+1]|T[G])<<1|1|T[G+1]),j[G]&k&&(O=r(t,{errors:w,currentLocation:R,expectedLocation:m,distance:l}))<=I){if(I=O,(_=R)<=m)break;C=Math.max(1,2*m-_)}}if(r(t,{errors:w+1,currentLocation:m,expectedLocation:m,distance:l})>I)break;T=j}var z={isMatch:_>=0,score:0===O?.001:O};return y&&(z.matchedIndices=i(b,v)),z}},function(e,t){e.exports=function(e,t){var n=t.errors,r=void 0===n?0:n,i=t.currentLocation,o=void 0===i?0:i,a=t.expectedLocation,s=void 0===a?0:a,u=t.distance,l=void 0===u?100:u,c=r/e.length,h=Math.abs(s-o);return l?c+h/l:h?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],r=-1,i=-1,o=0,a=e.length;o<a;o+=1){var s=e[o];s&&-1===r?r=o:s||-1===r||((i=o-1)-r+1>=t&&n.push([r,i]),r=-1)}return e[o-1]&&o-r>=t&&n.push([r,o-1]),n}},function(e,t){e.exports=function(e){for(var t={},n=e.length,r=0;r<n;r+=1)t[e.charAt(r)]=0;for(var i=0;i<n;i+=1)t[e.charAt(i)]|=1<<n-i-1;return t}},function(e,t){var n=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},r=function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)},i=function(e){return"string"==typeof e},o=function(e){return"number"==typeof e};e.exports={get:function(e,t){var a=[];return function e(t,s){if(s){var u=s.indexOf("."),l=s,c=null;-1!==u&&(l=s.slice(0,u),c=s.slice(u+1));var h=t[l];if(null!=h)if(c||!i(h)&&!o(h))if(n(h))for(var d=0,p=h.length;d<p;d+=1)e(h[d],c);else c&&e(h,c);else a.push(r(h))}else a.push(t)}(e,t),a},isArray:n,isString:i,isNum:o,toString:r}}])},be(Me={exports:{}},Me.exports),Me.exports),Te=(Le=Ae)&&Le.__esModule&&Object.prototype.hasOwnProperty.call(Le,"default")?Le.default:Le;Ae.Fuse;var Oe,Ne,ke,we,xe,Pe=d((function e(t){var n=t.addressList,r=void 0===n?[]:n,i=t.geometries,o=void 0===i?[]:i,a=t.entity,s=void 0===a?null:a,u=t.name,l=void 0===u?"":u,h=t.icon,d=void 0===h?"":h;c(this,e),this.addressList=r,this.geometries=o,this.icon=d,this.entity=s,this.name=l})),Ce={keys:[{name:"name",weight:.6},{name:"addressList",weight:.4}],threshold:.2},De=function(){function e(t){c(this,e),this.fuseSearch=null,this.levels_=null,this.searchListEntities_=[],this.searchListIcons_=[],this.searchList_=[],this.venueModel=t,this.init()}return d(e,[{key:"init",value:function(){var e=this.venueModel.getGeometries().reduce((function(e,t){var n=e;return n[t.getId()]=t,n}),{});this.initEntityList(this.venueModel.getOccupant()),this.initIconList(e),this.levels_=this.venueModel.getLevels().map((function(e){return{levelId:e.getId(),levelName:e.getName(),drawingId:e.getDrawing().getId(),drawingName:e.getDrawing().getName()}}));var t=[].concat(S(this.searchListEntities_),S(this.searchListIcons_));this.searchList_=t.sort((function(e,t){return e.name.localeCompare(t.name)})),this.fuseSearch_=new Te(this.searchList_,Ce)}},{key:"initEntityList",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((function(e){return e.spaceIds?new Pe({geometries:e.space,addressList:e.spaceIds||[],name:e.properties.name||"",entity:e}):null})).filter((function(e){return null!==e}));this.searchListEntities_=e}},{key:"initIconList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.searchListIcons_=Object.values(e).filter((function(e){return e.isIcon()})).map((function(e){var t=e.getIcon();return new Pe({geometries:[e],icon:t,name:e.properties.name||""})}))}},{key:"all",value:function(){return this.searchList_}},{key:"allIconTypes",value:function(){var e=this.searchListIcons_.reduce((function(e,t){var n=e;return n[t.name]=t.name,n}),{});return Object.keys(e)}},{key:"find",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return""===e?this.searchList_:this.fuseSearch_.search(e)}}]),e}(),je=Object.freeze({SITE:"SITE",IMAGES:"IMAGES",THEME:"THEME"}),Ge={SITE:"indoor.Site",STRUCTURE:"indoor.Structure",OCCUPANT:"indoor.Occupant",SPACE:"indoor.Space",SPACEGROUPS:"indoor.SpaceGroups",TOPOLOGY:"Topology",ADDRESS:"Address",LEVEL:"indoor.Level",LEVELCONNECTOR:"indoor.LevelConnector",ENTRANCE:"indoor.Entrance"},Re="OCCUPANT_NAMES",Ve="SPACE_NAME",He="INTERNAL_ADDRESS_SHORT",ze="INTERNAL_ADDRESS",Be="INTERNAL_ADDRESS_LONG",Ue="SPACE_TYPE_NAME",Fe="SPACE_CATEGORY_NAME",Ye="Point",Ze="LineString",We="Polygon",Ke="MultiPoint",Je="MultiLineString",Xe="MultiPolygon",Qe=Object.freeze({STANDARD:"STANDARD",FLATTEN:"FLATTEN",OUTDOOR_MAIN:"OUTDOOR_MAIN",INDOOR_MAIN:"INDOOR_MAIN",NO_OUTDOORS:"NO_OUTDOORS",FLATTEN_INDOOR_MAIN:"FLATTEN_INDOOR_MAIN",FLATTEN_OUTDOOR_COPY:"FLATTEN_OUTDOOR_COPY"}),qe="9999999999999",$e="icons",et="config",tt="https://interactive.data.api.platform.here.com/interactive/v1/catalogs",nt=Object.freeze({THEME:"THEME",THEME_MAP:"THEME_MAP",PRESETS:"PRESETS",SDK_STRINGS:"SDK_STRINGS",ICON_FILE:"ICON_FILE",INPUT_COLORS:"INPUT_COLORS",BASE_MAP_INFO:"BASE_MAP_INFO",CONFIG_PROFILE:"CONFIG_PROFILE",NAV_THEME:"NAV_THEME",NAV_NAME_THEME:"NAV_NAME_THEME",NAV_PROP_MAP:"NAV_PROP_MAP",NAV_STRINGS:"NAV_STRINGS",NAV_THEME_MAP:"NAV_THEME_MAP",NAV_NAME_THEME_MAP:"NAV_NAME_THEME_MAP",V4_THEME_FAMILY:"V4_THEME_FAMILY",V4_MAPTYPE_THEME:"V4_MAPTYPE_THEME",ICON:"ICON",MARKER:"MARKER",PERMISSIONS:"PERMISSIONS",NAICS_ARRAY:"NAICS_ARRAY",NAICS_MAP:"NAICS_MAP"});Object.freeze((p(Oe={},nt.THEME,"themeUrls"),p(Oe,nt.THEME_MAP,"themeMapUrl"),p(Oe,nt.PRESETS,"presetsUrl"),p(Oe,nt.SDK_STRINGS,"stringsUrl"),Oe)),Object.freeze((p(Ne={},nt.THEME,"themeOverrides"),p(Ne,nt.THEME_MAP,"themeMapOverrides"),p(Ne,nt.PRESETS,"presetOverrides"),p(Ne,nt.SDK_STRINGS,"stringsOverrides"),p(Ne,nt.INPUT_COLORS,"inputColorOverrides"),Ne)),Object.freeze((p(ke={},nt.THEME,["Modern","Standard","Factory","Navteq","TheBase","Westfield_noLabels","Westfield","TDM_noLabel"]),p(ke,nt.SDK_STRINGS,["Standard","SDK","sdk/standard"]),p(ke,nt.V4_THEME_FAMILY,["modern","standard"]),p(ke,nt.V4_MAPTYPE_THEME,["Airport Terminal","Airport","Casino","College Building","College Campus","Convention","General","Hospital","Outdoor","Retail","School Building","School Campus","Shopping Mall","Traffic","Train Station"]),p(ke,nt.NAV_THEME,["Factory","MapEditor"]),p(ke,nt.ICON,["Multicolor","Standard","TheBase","Factory"]),ke)),Object.freeze((p(we={},nt.THEME,"Modern"),p(we,nt.THEME_MAP,"Standard"),p(we,nt.PRESETS,"Standard"),p(we,nt.SDK_STRINGS,"Standard"),p(we,nt.ICON_FILE,"Standard"),p(we,nt.INPUT_COLORS,"Standard"),p(we,nt.BASE_MAP_INFO,"Standard"),p(we,nt.CONFIG_PROFILE,"factory"),p(we,nt.NAV_THEME,"Factory"),p(we,nt.NAV_NAME_THEME,"FactoryName"),p(we,nt.NAV_PROP_MAP,"Standard"),p(we,nt.NAV_STRINGS,"Standard"),p(we,nt.NAV_THEME_MAP,"Standard"),p(we,nt.NAV_NAME_THEME_MAP,"StandardName"),p(we,nt.V4_THEME_FAMILY,"Standard"),p(we,nt.V4_MAPTYPE_THEME,"Standard"),p(we,nt.ICON,"Multicolor"),p(we,nt.MARKER,"Standard"),we));var rt=Object.freeze({GEO_JSON:"GEO_JSON",V5_MAP:"V5_MAP",V5_NAV:"V5_NAV",V5_INFO:"V5_INFO",KML:"KML",SVG:"SVG",PNG:"PNG"});Object.freeze(p({},rt.GEO_JSON,{COMMUNITY_MAP:"COMMUNITY_MAP",COMMUNITY_ENTITY:"COMMUNITY_ENTITY",PATH_LEVEL_GEOMETRY:"PATH_LEVEL_GEOMETRY",GEOJSON_LEVEL_GEOMETRY:"GEOJSON_LEVEL_GEOMETRY"}));var it=Object.freeze({ACCOUNT_API:"ACCOUNT_API",DEFAULT_COLLECTION:"DEFAULT_COLLECTION",CATALOG_LAYER:"CATALOG_LAYER"}),ot=Object.freeze((p(xe={},it.ACCOUNT_API,{BASE_URL:"https://account.api.here.com/authorization/v1.1/projects/me"}),p(xe,it.DEFAULT_COLLECTION,{BASE_URL:"https://config.data.api.platform.here.com/config/v1/catalogs",PARAMS:{CREATED_BY:"created",COLLECTION:"-collection"}}),p(xe,it.CATALOG_LAYER,{BASE_URL:"https://interactive.data.api.platform.here.com/interactive/v1/catalogs",MOMDATA_LAYER:"9999999999999",ICON_LAYER:"icons",THEMERULE_LAYER:"config",COLLECTION_LAYER:"layers/9999999999999/search",PARAMS:{FEATURE_TYPE:{KEY:"p.featureType",VALUE:"indoor.Site"}}}),xe)),at=Object.freeze({isIconsEnabled:!0,isMetaEnabled:!0,metaOptions:{},iconOptions:{}}),st=Object.freeze({GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE",PATCH:"PATCH",OPTIONS:"OPTIONS",HEAD:"HEAD"});function ut(){}function lt(){lt.init.call(this)}function ct(e){return void 0===e._maxListeners?lt.defaultMaxListeners:e._maxListeners}function ht(e,t,n,r){var i,o,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=new ut,e._eventsCount=0),a){if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=ct(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=o[t]=n,++e._eventsCount;return e}function dt(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function pt(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function ft(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}ut.prototype=Object.create(null),lt.EventEmitter=lt,lt.usingDomains=!1,lt.prototype.domain=void 0,lt.prototype._events=void 0,lt.prototype._maxListeners=void 0,lt.defaultMaxListeners=10,lt.init=function(){this.domain=null,lt.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new ut,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},lt.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},lt.prototype.getMaxListeners=function(){return ct(this)},lt.prototype.emit=function(e){var t,n,r,i,o,a,s,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=a[e]))return!1;var c="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=ft(e,r),o=0;o<r;++o)i[o].call(n)}(n,c,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=ft(e,i),a=0;a<i;++a)o[a].call(n,r)}(n,c,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,a=ft(e,o),s=0;s<o;++s)a[s].call(n,r,i)}(n,c,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var a=e.length,s=ft(e,a),u=0;u<a;++u)s[u].call(n,r,i,o)}(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=ft(e,i),a=0;a<i;++a)o[a].apply(n,r)}(n,c,this,i)}return!0},lt.prototype.addListener=function(e,t){return ht(this,e,t,!1)},lt.prototype.on=lt.prototype.addListener,lt.prototype.prependListener=function(e,t){return ht(this,e,t,!0)},lt.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,dt(this,e,t)),this},lt.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,dt(this,e,t)),this},lt.prototype.removeListener=function(e,t){var n,r,i,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new ut:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new ut,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},lt.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new ut,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new ut:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new ut,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},lt.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},lt.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):pt.call(e,t)},lt.prototype.listenerCount=pt,lt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var vt,gt="venues-ui-button--active",yt="venues-ui-button",mt="venues-ui__drawings",Et="data-drawing",It=function(){function e(t,n,r){var i=this;c(this,e),this.clickHandler=r,this.containerDiv=document.createElement("div"),this.containerDiv.setAttribute("class",mt);var o=document.createElement("div");o.setAttribute("class","trigger ".concat(yt));var a=document.createElement("div");a.setAttribute("class","arrow arrow--down"),o.appendChild(a),o.addEventListener("click",(function(){o.classList.toggle(gt),i.containerButtons.classList.toggle("drawings--open")})),this.containerDiv.appendChild(o),this.containerButtons=document.createElement("div"),this.containerButtons.setAttribute("class","drawings"),this.containerDiv.appendChild(this.containerButtons),n&&this.update(n),t.appendChild(this.containerDiv)}return d(e,[{key:"drawButton",value:function(e,t,n){var r=this,i=document.createElement("div"),o=Number(n)===Number(e);i.setAttribute("class",o?"".concat(yt," ").concat(gt):yt),i.innerHTML=t,i.setAttribute(Et,e),i.addEventListener("click",(function(){r.switch(e),r.clickHandler(e)})),this.containerButtons.appendChild(i)}},{key:"switch",value:function(e){this.containerButtons.querySelectorAll(".".concat(mt," .").concat(gt)).forEach((function(e){return e.setAttribute("class",yt)}));var t=this.containerButtons.querySelector("[".concat(Et,"='").concat(e,"']"));t&&t.setAttribute("class","".concat(yt," ").concat(gt))}},{key:"update",value:function(e){var t=this;this.containerButtons.innerHTML="";var n=function(e){var t=e.getDrawings();return new Map(t.map((function(e){var t=e.getDisplayName()||e.getName();return[e.getId(),t]})))}(e);n.size>0&&n.forEach((function(n,r){return t.drawButton(r,n,e.getRootDrawing().getId())}))}}]),e}(),_t="venues-ui-button--active",St="venues-ui-button",bt="data-level",Mt="venues-ui__levels",Lt=function(){function e(t,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;c(this,e),this.clickHandler=i,this.levelButtonCount=o,this.currentScrollIndex=0,this.containerUI=document.createElement("div"),this.containerUI.setAttribute("class","".concat(Mt)),this.containerButtons=document.createElement("div"),this.containerButtons.setAttribute("class","levels"),this.containerUI.appendChild(this.containerButtons),n&&this.update(n,r),t.appendChild(this.containerUI)}return d(e,[{key:"clear",value:function(){this.containerButtons.innerHTML="",this.buttonScrollUp&&(this.containerUI.removeChild(this.buttonScrollUp),this.buttonScrollUp=null),this.buttonScrollDown&&(this.containerUI.removeChild(this.buttonScrollDown),this.buttonScrollDown=null)}},{key:"drawLevelButton",value:function(e,t){var n=this,r=document.createElement("div");r.innerHTML=t,r.style.fontSize="".concat(Math.max(Math.min(28.8/t.length,11.52),10),"px"),r.style.display="block",r.setAttribute("class",St),r.setAttribute(bt,e),r.addEventListener("click",(function(){n.switch(e),n.clickHandler(e)})),this.containerButtons.appendChild(r)}},{key:"drawScrollButtons",value:function(){var e=this;this.buttonScrollUp=document.createElement("div"),this.buttonScrollUp.setAttribute("class","".concat(St," ").concat(St,"--up"));var t=document.createElement("div");t.setAttribute("class","arrow arrow--up"),this.buttonScrollUp.appendChild(t),this.buttonScrollUp.addEventListener("click",(function(){return e.scroll(1)})),this.containerUI.insertBefore(this.buttonScrollUp,this.containerButtons),this.buttonScrollDown=document.createElement("div"),this.buttonScrollDown.setAttribute("class","".concat(St," ").concat(St,"--down"));var n=document.createElement("div");n.setAttribute("class","arrow arrow--down"),this.buttonScrollDown.appendChild(n),this.buttonScrollDown.addEventListener("click",(function(){return e.scroll(-1)})),this.containerUI.appendChild(this.buttonScrollDown)}},{key:"scroll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=Array.from(this.containerButtons.querySelectorAll(".".concat(St))).reverse(),n=[];if(e>=0){this.currentScrollIndex=Math.min(this.currentScrollIndex+e,t.length-this.levelButtonCount);var r=Math.min(this.currentScrollIndex,t.length-this.levelButtonCount),i=Math.min(this.currentScrollIndex+this.levelButtonCount,t.length);n=t.slice(r,i)}else if(e<0){this.currentScrollIndex=Math.max(this.currentScrollIndex+e,0);var o=Math.max(0,this.currentScrollIndex),a=Math.min(t.length,this.currentScrollIndex+this.levelButtonCount);n=t.slice(o,a)}t.forEach((function(e){-1!==n.indexOf(e)?e.style.display="block":e.style.display="none"})),this.buttonScrollDown&&(0===this.currentScrollIndex?this.buttonScrollDown.setAttribute("disabled","disabled"):this.buttonScrollDown.removeAttribute("disabled")),this.buttonScrollUp&&(this.currentScrollIndex===t.length-this.levelButtonCount?this.buttonScrollUp.setAttribute("disabled","disabled"):this.buttonScrollUp.removeAttribute("disabled"))}},{key:"switch",value:function(e){this.containerButtons.querySelectorAll(".".concat(_t)).forEach((function(e){return e.setAttribute("class",St)}));var t=this.containerButtons.querySelector(".".concat(Mt," [").concat(bt,"='").concat(e,"']"));if(t){var n=Array.from(this.containerButtons.querySelectorAll(".".concat(St))).reverse();t.setAttribute("class","".concat(St," ").concat(_t));var r=n.indexOf(t);(r<this.currentScrollIndex||r>=this.currentScrollIndex+4)&&this.scroll(r-this.currentScrollIndex)}}},{key:"update",value:function(e,t){var n=this,r=function(){return new Map((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((function(e){return[e.getZIndex(),e.getShortName()||e.getDisplayName()||e.getName()]})))}(function(e,t){if(t===Qe.FLATTEN){var n=e.getVenueModel().getLevelMapFlattenedByZIndex_();return Object.values(n).map((function(e){return e[0]}))}return e.getLevels()}(e,t).sort((function(e,t){return t.getZIndex()-e.getZIndex()}))),i=e.getMainLevel().getZIndex();this.clear(),r.forEach((function(e,t){return n.drawLevelButton(t,e)})),r.size>this.levelButtonCount&&(r.size>this.levelButtonCount+1?this.currentScrollIndex=Math.min(Array.from(r).reverse().findIndex((function(e){return e[0]===i})),r.size-this.levelButtonCount):this.currentScrollIndex=0,this.drawScrollButtons(),this.scroll(0)),this.switch(i)}}]),e}(),At=function(){function e(t,n){c(this,e),this.baseTheme=t,this.metaInformation=n,this.labelStyleMap={},this.styleMap={},this.setStyleMap()}return d(e,[{key:"setStyleMap",value:function(){this.styleMap.ENTRANCE=this.baseTheme.entranceRules.default.styleProperties,this.labelStyleMap.ENTRANCE=this.baseTheme.entranceRules.default.textLabelStyleProperties;for(var e=0,t=Object.entries(this.baseTheme.spaceRules);e<t.length;e++){var n=_(t[e],2),r=n[0],i=n[1],o=i.properties.behavioralAppearance.default.styleProperties,a=i.properties.behavioralAppearance.default.textLabelStyleProperties;if(this.styleMap[r]=o,this.labelStyleMap[r]=a,i.spaceTypes)for(var s=0,u=Object.entries(i.spaceTypes);s<u.length;s++){var l=_(u[s],2),c=l[0],h=l[1],d=h.behavioralAppearance.default.styleProperties,p=h.behavioralAppearance.default.textLabelStyleProperties;this.styleMap["".concat(r,"_").concat(c)]=d&&0!==Object.keys(d)?d:o,this.labelStyleMap["".concat(r,"_").concat(c)]=p&&0!==Object.keys(p)?p:a}}}},{key:"getBaseTheme",value:function(){return this.baseTheme}},{key:"getStyleMap",value:function(){return this.styleMap}},{key:"getGeometryStyle",value:function(e){return this.styleMap&&Object.getOwnPropertyNames(this.styleMap)?this.styleMap[e]:null}},{key:"getLabelStyle",value:function(e){return this.labelStyleMap&&Object.getOwnPropertyNames(this.labelStyleMap)?this.labelStyleMap[e]:null}}],[{key:"getGeometryDefaultStyle",value:function(){return{fill:"#e5e5e5",fillOpacity:1,stroke:"#6c7a89",strokeOpacity:1,strokeWidth:2}}},{key:"getLabelDefaultStyle",value:function(){return{stroke:"#6c7a89",zmin:15}}}]),e}(),Tt=function(){function e(){c(this,e),this.config=Object.seal({emitEventOnOverrideUpdate:!0}),this.imageCache={},this.releaseSettings_={displayOptions:{},mom:[]},this.theme={}}return d(e,[{key:"getMomData",value:function(){return this.releaseSettings_.mom}},{key:"getTheme",value:function(){return this.theme||{}}},{key:"getStyle",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.getTheme(),i=At.getGeometryDefaultStyle(),o=e.properties.spaceType,a=e.properties.spaceCategory,s=a;return o&&(s="".concat(a,"_").concat(o)),(t=r.getGeometryStyle(s))&&!n||(t=i),{m:t.fill&&t.fill.toLowerCase()||"#fff",w:t.strokeWidth/10||.1,o:t.stroke&&t.stroke.toLowerCase()||"#fff",l:"Dark"}||void 0}},{key:"getLabelStyle",value:function(e){this.getTheme();var t=At.getLabelDefaultStyle();return{fill:t.stroke,zmin:t.zmin}}}]),e}(),Ot=Math.PI/180,Nt=180/Math.PI,kt=function(){function e(){c(this,e)}return d(e,null,[{key:"toRadians",value:function(e){return e*Ot}},{key:"toDegrees",value:function(e){return e*Nt}},{key:"getBoundingBox",value:function(t,n){var r=[];switch(t){case Ye:r=[n,n];break;case Ke:case Ze:r=n;break;case Je:case We:r=n.reduce((function(e,t){return e.concat(t)}),[]);break;case Xe:r=n.reduce((function(e,t){return e.concat(t)}),[]).reduce((function(e,t){return e.concat(t)}),[])}return e.getBoundingBoxVertices(r)}},{key:"getInverseTransform",value:function(e){var t=e[0]*e[3]-e[1]*e[2],n=[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,0,0];return n[4]=-(n[0]*e[4]+n[2]*e[5]),n[5]=-(n[1]*e[4]+n[3]*e[5]),n}},{key:"applyTransformToPoint",value:function(e,t){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}},{key:"transformProduct",value:function(e,t){var n=[0,0,0,0,0,0];return n[0]=t[0]*e[0]+t[2]*e[1],n[1]=t[1]*e[0]+t[3]*e[1],n[2]=t[0]*e[2]+t[2]*e[3],n[3]=t[1]*e[2]+t[3]*e[3],n[4]=t[0]*e[4]+t[2]*e[5]+t[4],n[5]=t[1]*e[4]+t[3]*e[5]+t[5],n}},{key:"convertLonLatToMerc",value:function(e){var t=e[0]*Ot,n=e[1]*Ot,r=Math.sin(n);return[.5+t/(2*Math.PI),.5-Math.log((1+r)/(1-r))/(4*Math.PI)]}},{key:"convertMercToLatLon",value:function(e){var t=2*Math.PI*(e[0]-.5),n=Math.atan(Math.sinh(2*Math.PI*(.5-e[1])));return[t/Ot,n/Ot]}},{key:"getTransformScale",value:function(e){return Math.sqrt(e[0]*e[3]-e[1]*e[2])}},{key:"getLonLatToMercTransform",value:function(t){var n=[1/360,0,0,-1/(360*Math.cos(t[1]*Ot)),0,0],r=e.applyTransformToPoint(n,t),i=e.convertLonLatToMerc(t);return n[4]=i[0]-r[0],n[5]=i[1]-r[1],n}},{key:"getNatToMercTransform",value:function(t){var n=[t[4],t[5]],r=e.getLonLatToMercTransform(n);return e.transformProduct(t,r)}},{key:"convertMxMy2LonLat",value:function(t,n){return t.length&&n.length?e.applyTransformToPoint(t,n):[]}},{key:"convertLonLat2MxMy",value:function(t,n){if(!t.length||!n.length)return[];var r=e.getInverseTransform(t);return e.applyTransformToPoint(r,n)}},{key:"getFlattenedQuadraticBezierCurve",value:function(e,t,n){var r=[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;i<1&&(i=6);for(var o=0;o<=i;o+=1){var a=o/i,s=(1-a)*(1-a),u=2*a*(1-a),l=a*a,c=s*e[0]+u*t[0]+l*n[0],h=s*e[1]+u*t[1]+l*n[1];r.push([c,h])}return r}},{key:"getFlattenedCubicBezierCurve",value:function(e,t,n,r){var i=[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;o<1&&(o=6);for(var a=0;a<=o;a+=1){var s=a/o,u=(1-s)*(1-s)*(1-s),l=3*s*(1-s)*(1-s),c=3*s*s*(1-s),h=s*s*s,d=u*e[0]+l*t[0]+c*n[0]+h*r[0],p=u*e[1]+l*t[1]+c*n[1]+h*r[1];i.push([d,p])}return i}},{key:"getRectangularCoordinatesOfLabelArea",value:function(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=_(t,6),o=i[0],a=i[1],s=i[2],u=i[3],l=i[5],c=e.getDeltaLonLatForMeterAtGivenLonLat(o,a),h=t[4];return r?(l&&(h*=-1),null!=n&&(h=(h+=n<0?2*Math.PI+n:n)<0?2*Math.PI+h:h)):h=0,e.getRectVerticesFromSignatureRectRepresentation([o,a],{xLength:s,yLength:u},h,c)}},{key:"getRotatedPoint",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0],i=Math.cos(t),o=Math.sin(t),a=e[0]-r[0],s=e[1]-r[1],u=[];return[(u=n?[a*i+s*o,s*i-a*o]:[a*i-s*o,s*i+a*o])[0]+r[0],u[1]+r[1]]}},{key:"getRectVerticesFromSignatureRectRepresentation",value:function(t,n,r,i){var o=n.xLength,a=n.yLength,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u=_(t,2),l=u[0],c=u[1],h=o/2,H=a/2,d=_(i,2),p=d[0],f=d[1];return[[1,1],[-1,1],[-1,-1],[1,-1]].map((function(e){return[e[0]*h,e[1]*H]})).map((function(t){return e.getRotatedPoint(t,r,s)})).map((function(e){return[e[0]*p,e[1]*f]})).map((function(e){return[e[0]+l,e[1]+c]}))}},{key:"getScaleFactorForRectInSpace",value:function(e,t,n,r){var i=e/n,o=t/r;return i>o?o:i}},{key:"getDeltaLonLatForMeterAtGivenLonLat",value:function(e,t){var n=6371e3;return[1/n*(180/Math.PI)/Math.cos(t*Math.PI/180),1/n*(180/Math.PI)]}},{key:"getBoundingBoxVertices",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]];return e.reduce((function(e,t){return[[Math.min(t[0],e[0][0]),Math.min(t[1],e[0][1])],[Math.max(t[0],e[1][0]),Math.max(t[1],e[1][1])]]}),t)}},{key:"isPointInBoundingBox",value:function(e,t){if(e&&t){var n=_(e,2),r=n[0],i=n[1],o=_(t,2),a=_(o[0],2),s=a[0],u=a[1],l=_(o[1],2),c=l[0],h=l[1];return r<=c&&r>=s&&i<=h&&i>=u}}},{key:"isPointOnLineSegment",value:function(e,t,n){var r=_(e,2),i=r[0],o=r[1],a=_(t,2),s=a[0],u=a[1],l=_(n,2),c=l[0],h=l[1],d=(u-o)*(h-o)<=0;return s===c?s===i&&d:!(o-h!=(h-u)/(c-s)*(i-c)||!d)}},{key:"rayIntersectLineSegment",value:function(e,t,n){var r=_(e,2),i=r[0],o=r[1],a=_(t,2),s=a[0],u=a[1],l=_(n,2),c=l[0],h=l[1];if(s===c)return!1;var d=(i-s)/(c-s);return d>=0&&d<1&&(h-u)*d+u>o}},{key:"isPointInPolygon",value:function(t,n){var r=_(t,2),i=r[0],o=r[1],a=n.length;if(a<3)return!1;var s=0,u=n[a-1];return n.forEach((function(t){e.rayIntersectLineSegment([i,o],u,t)&&(s+=1),u=t})),s%2!=0}},{key:"isPointOnLineString",value:function(t,n){var r=_(t,2),i=r[0],o=r[1],a=n.length;if(a<2)return!1;for(var s=n[a-1],u=0;u<a;u+=1){var l=n[u];if(e.isPointOnLineSegment([i,o],s,l))return!0;s=n[u]}return!1}},{key:"getAreaOfPolygon",value:function(e){var t=e.length;if(t<3)return null;var n=0,r=e[t-1];return e.forEach((function(e){var t,i,o,a,s,u;n+=.5*(t=e,i=_(r,2),o=i[0],a=i[1],s=_(t,2),u=s[0],o*s[1]-a*u),r=e})),n}},{key:"getDistanceBetweenPoints",value:function(e,t){var n=_(e,2),r=n[0],i=n[1],o=_(t,2),a=r-o[0],s=i-o[1];return Math.sqrt(a*a+s*s)}}]),e}(),wt=function(){function e(){c(this,e),this.spaceRules={}}return d(e,null,[{key:"getDataEntriesOne",value:function(e,t){var n=[e,""];if(null!==t&&Array.isArray(t))n[1]=t.toString();else if(null!==t&&"object"===u(t)){var r=Object.entries(t);if(r.length>0){var i=this.getDataEntriesOne(r[0][0],r[0][1]);n[0]="".concat(n[0],".").concat(i[0]),n[1]=i[1]}}else n[1]=t;return n}},{key:"getDataEntriesAll",value:function(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var i=_(r[n],2),o=i[0],a=i[1],s=this.getDataEntriesOne(o,a);t.push(s)}return t}},{key:"doFindComboMatch",value:function(e,t){var n=this,r="";return e&&e.configuration&&e.configuration.combinations&&function(){for(var i=n.getDataEntriesAll(t),o=Object.entries(e.configuration.combinations),a=0,s=function(){var e=l[u],t=Object.keys(e[1]).filter((function(t){return i.some((function(n){return t===n[0]&&e[1][t]===n[1]}))}));t.length===Object.keys(e[1]).length&&t.length>a&&(r=e[0],a=t.length)},u=0,l=o;u<l.length;u++)s()}(),r}},{key:"getIconFromCombinations",value:function(e,t){if(e&&e.configuration.combinations&&t&&Object.keys(t).length>0&&e.behavioralAppearance.combinations&&Object.keys(e.behavioralAppearance.combinations).length>0){var n=this.doFindComboMatch(e,t);if(""===n||!e.behavioralAppearance.combinations[n].labelIcon)return"";if(e.behavioralAppearance.combinations&&e.behavioralAppearance.combinations[n]&&e.behavioralAppearance.combinations[n].labelIcon)return e.behavioralAppearance.combinations[n].labelIcon.referenceUri}return""}},{key:"findSpace",value:function(e,t){if(t.spaceTypes&&t.spaceTypes[e])return t.spaceTypes[e]}},{key:"findCategory",value:function(e){if(this.spaceRules[e])return this.spaceRules[e]}},{key:"setSpaceRules",value:function(e){this.spaceRules=e}},{key:"getSpaceIcon",value:function(e,t,n){var r="",i=this.findCategory(t);if(i){var o=this.findSpace(e,i);if(o){var a="";n&&(a=this.getIconFromCombinations(o,n)),a&&""!==a?r=a:o.behavioralAppearance.default.labelIcon?r=o.behavioralAppearance.default.labelIcon.referenceUri:i.properties.behavioralAppearance.default.labelIcon&&(r=i.properties.behavioralAppearance.default.labelIcon.referenceUri)}}return r}}]),e}(),xt=function(){function e(){c(this,e),this.themeRule={},this.svgList={},this.defaultLang="ENG"}return d(e,null,[{key:"getNumberFromAlphaNumeric",value:function(e){try{var t=e.split("").reverse().join("").replace(/[^0-9]/g,"").substr(0,6);return parseInt(t,10)}catch(e){return null}}},{key:"extractNumFromSting",value:function(e){try{var t=e.replace(/[^0-9]/g,"");return parseInt(t,10)}catch(t){return console.warn("Exception in converting string to Id"),this.getNumberFromAlphaNumeric(e)}}},{key:"getVenueId",value:function(e){if("number"!=typeof e){var t=e.substr(e.length-6);return parseInt(t,10)}return e}},{key:"getStringFormatIdentifier",value:function(e){return"number"==typeof e||e.length<13?"indoormap-00000000-0000-4000-a000-".concat(e.toString().padStart(12,"0")):e}},{key:"setSite",value:function(e,t){var n=this.getName(e),r={id:this.getStringFormatIdentifier(t),location:e.referencePoint,properties:e.properties,geometry:e.geometry,map_version:e.properties.indoorSiteMetadata.legacyVersion.mapVersion,identifier:this.getVenueId(t),obj_type:"CommunityMap"};return r.properties.name=n,r.properties.display_name=n,r}},{key:"setEntrance",value:function(e){var t=this.themeRule.entranceRules.default.labelIcon.referenceUri,n=this.extractNumFromSting(e.id),r=this.getName(e),i=e.properties;return i.icon=!0,i.svg=this.svgList[t.toLowerCase()],i.name=r||"entrance",i.display_name=r||"entrance",i.level={id:e.properties.level.id},{id:e.id,levelId:e.properties.level.id,momType:Ge.ENTRANCE,geometry:e.geometry,location:e.geometry,properties:i,identifier:n,label_area:[e.referencePoint.coordinates[0],e.referencePoint.coordinates[1],50,50,180]}}},{key:"setStructure",value:function(e){var t=this.extractNumFromSting(e.id),n=this.getName(e),r=e.properties;return r.is_root=0===e.properties.drawOrder,r.display_name=n,r.map_type=e.properties.structureType,r.name=n,{id:e.id,obj_type:"Drawing",identifier:t,properties:r}}},{key:"getNameByPriority",value:function(e,t){for(var n=this,r="",i=function(e){return"OFFICIAL"===e.nameType&&e.languageCode&&e.languageCode===n.defaultLang||"OFFICIAL"===e.nameType},o=0;o<e.length;o++){var a=e[o];if(i(a)&&(t&&t===a.nameType||!t)){r=a.name;break}if("ABBREVIATION"===a.nameType&&(t&&t===a.nameType||!t)){r=a.name;break}if("UNCLASSIFIED"===a.nameType&&(t&&t===a.nameType||!t)){r=a.name;break}if(!a.nameType&&a.name){r=a.name;break}}return r}},{key:"getName",value:function(e,t){return e.properties&&e.properties.names?this.getNameByPriority(e.properties.names,t):e.properties.placeProperties&&e.properties.placeProperties&&e.properties.placeProperties.names?this.getNameByPriority(e.properties.placeProperties.names,t):e.properties.locationDetails&&e.properties.locationDetails[0]&&e.properties.locationDetails[0].names?this.getNameByPriority(e.properties.locationDetails[0].names,t):""}},{key:"setLevel",value:function(e){var t=this.extractNumFromSting(e.id),n=e.properties.names,r=e.properties,i=e.geometry;return r["short name"]=this.getNameByPriority(n,n&&1!==n.length?"ABBREVIATION":""),r.name=this.getNameByPriority(n,n&&1!==n.length?"ABBREVIATION":""),{id:e.id,obj_type:"Level",identifier:t,properties:r,geometry:i}}},{key:"setLevelConnector",value:function(e){var t=this.extractNumFromSting(e.id);return{id:e.id,obj_type:"LevelConnector",properties:e.properties,geometry:e.geometry,identifier:t,location:e.geometry}}},{key:"setOccupant",value:function(e){var t=this.getName(e),n=this.extractNumFromSting(e.id),r=e.properties;return r.occupantName=t,r.email=e.properties.placeProperties&&e.properties.placeProperties.contacts&&e.properties.placeProperties.contacts.find((function(e){return"EMAIL"===e.contactType}))&&e.properties.placeProperties.contacts.find((function(e){return"EMAIL"===e.contactType})).value,r.name=t,r.tags=e.properties.attributes&&e.properties.attributes.tags,{geometry:e.geometry,id:e.id,obj_type:"Geometry",properties:r,identifier:n,spaceIds:e.properties.spaces?e.properties.spaces:[],type:"Feature",momType:Ge.OCCUPANT}}},{key:"getIcon",value:function(e){var t=!1,n="";return this.svgList[e]&&(t=!0,n=this.svgList[e]),{icon:t,svg:n}}},{key:"setSpace",value:function(e){var t=wt.getSpaceIcon(e.properties.spaceType,e.properties.spaceCategory,e.properties.spaceTypeProperties),n=this.getName(e),r=this.getIcon(t),i=r.icon,o=r.svg,a=this.extractNumFromSting(e.id),s=(e.properties.level.id.includes("out"),e.properties.level.id),u=e.properties;u.spaceName=n,u[e.properties.spaceCategory]=e.properties.spaceType,u.spaceType=e.properties.spaceType,u.spaceCategory=e.properties.spaceCategory,u.icon=i,u.svg=o;var l={geometry:e.geometry,id:e.id,levelId:s,label_area:[e.referencePoint.coordinates[0],e.referencePoint.coordinates[1],50,50,180],location:e.referencePoint,obj_type:"Geometry",identifier:a,properties:u,momType:Ge.SPACE,type:"Feature"};return e.properties.spaceAddress&&e.properties.spaceAddress.id&&(l.addressId=e.properties.spaceAddress.id),l}},{key:"setSpaceGroups",value:function(e){var t=this.extractNumFromSting(e.id);return{id:e.id,obj_type:"SpaceGroups",properties:e.properties,geometry:e.geometry,location:e.referencePoint,identifier:t}}},{key:"setTopology",value:function(e){var t=this.extractNumFromSting(e.id);return{id:e.id,obj_type:"Topology",properties:e.properties,geometry:e.geometry,identifier:t}}},{key:"setAddress",value:function(e){var t=this.extractNumFromSting(e.id),n=this.getName(e),r=e.properties;return r.addressName=n,r.name=n,{id:e.id,properties:r,obj_type:"Address",identifier:t}}},{key:"manageSvgDimensions",value:function(e){for(var t={},n=0,r=Object.entries(e);n<r.length;n++){var i=_(r[n],2),o=i[0],a=i[1];if("string"==typeof a){var s=-1!==a.indexOf("<g")&&a.indexOf("<g")||a.indexOf("<p"),u=a.indexOf("</s");if(s&&u){var l=a.substring(s-1,u-1);t[o]="<svg width='64' height='64' viewBox='0 0 24 32' fill='none' xmlns='http://www.w3.org/2000/svg'>".concat(l,"</svg>")}}}return t}},{key:"getSiteBoundingBox",value:function(e){if(e){var t=_(kt.getBoundingBox(e.geometry.type,e.geometry.coordinates),2),n=t[0],r=t[1];if(n)return"".concat(n[0],",").concat(n[1],",").concat(r[0],",").concat(r[1])}return"null, null, null, null"}}]),e}(),Pt=function(){function e(){c(this,e)}return d(e,null,[{key:"get",value:function(e){return fetch(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{method:"GET"}).then((function(t){return t.ok?t.json():Promise.reject(new Error("Call failed for ".concat(e," : ").concat(t.status," ").concat(t.statusText)))}))}},{key:"getFormattedIndoorMapId",value:function(e){return"number"==typeof e?"indoormap-00000000-0000-4000-a000-".concat(e.toString().padStart(12,"0")):e.includes("indoormap")?e:"indoormap-00000000-0000-4000-a000-".concat(e.padStart(12,"0"))}},{key:"getConfigUrl",value:function(e,t,n){var r=n.apiKey,i=n.url,o=n.token,a=n.hrn,s={method:"GET",mode:"cors",cache:"default"},u="".concat(i||tt,"/").concat(a),l="";return t===je.SITE&&(l="".concat(u,"/layers/").concat(qe,"/search?p.featureType=indoor.Site&p.indoorMapId='").concat(this.getFormattedIndoorMapId(e),"'")),t===je.IMAGES&&(l="".concat(u,"/layers/").concat($e,"/features/svg")),t===je.Theme&&(l="".concat(u,"/layers/").concat(et,"/features/indoorMapRules")),o?s.headers={Authorization:"Bearer ".concat(o)}:l=l.concat("".concat(t===je.SITE?"&":"?","apiKey=").concat(r)),this.get(l,s)}},{key:"getMomData",value:function(e,t){var n=t.apiKey,r=t.url,i=t.token,o=t.hrn,a={method:"GET",mode:"cors",cache:"default"},s="".concat(r||tt,"/").concat(o),u=e&&e.features&&e.features.find((function(e){return e.momType===Ge.SITE})),l=xt.getSiteBoundingBox(u),c=[Ge.TOPOLOGY,Ge.LEVELCONNECTOR],h=Object.values(Ge).filter((function(e){return!c.includes(e)})).join(),d="".concat(s,"/layers/").concat(qe,"/bbox?bbox=").concat(l,"&limit=100000&f.momType=").concat(h);return i?a.headers={Authorization:"Bearer ".concat(i)}:d=d.concat("&apiKey=".concat(n)),{mom:this.get(d,a),site:u}}},{key:"getDefaultCollection",value:function(e){var t=e.token,n=ot[it.DEFAULT_COLLECTION],r=n.PARAMS,i=n.BASE_URL,o=encodeURI("".concat(i,"?sortBy=").concat(r.CREATED_BY,"&q=").concat(r.COLLECTION));if(t){var a={method:"GET",headers:{Authorization:"Bearer ".concat(t)}};return this.get(o,a)}return Promise.reject(new Error("Please provide valid token"))}},{key:"getProjectAccountDetails",value:function(e){var t=e.token,n=ot[it.ACCOUNT_API].BASE_URL;if(t){var r={method:"GET",mode:"cors",headers:{Authorization:"Bearer ".concat(t)}};return this.get(n,r)}return Promise.reject(new Error("Please provide valid token"))}},{key:"fetchIndoorMapList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.hrn,n=e.url,r=ot[it.CATALOG_LAYER],i=r.PARAMS,o=r.COLLECTION_LAYER;if(t){var a=encodeURI("".concat(n||tt,"/").concat(t,"/").concat(o,"?").concat(i.FEATURE_TYPE.KEY,"=").concat(i.FEATURE_TYPE.VALUE)),s=this.createBaseUrl(a,st.GET,{},e),u=s.URL,l=s.options;return this.get(u,l)}return Promise.reject(new Error("Please provide valid hrn"))}},{key:"createBaseUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:st.GET,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.token,a=r.apiKey,s=e,u={method:t,mode:"cors"};return i?u.headers=o({Authorization:"Bearer ".concat(i)},n):s=e.concat("&apiKey=".concat(a)),{URL:s,options:u}}}]),e}(),Ct=function(){function e(){c(this,e)}return d(e,null,[{key:"isPointOnGeoJSONLineString",value:function(e,t){var n=!1;if(t&&t.length>1)for(var r=0,i=0,o=1;o<t.length;o+=1)if(r=t[o-1],i=t[o],kt.isPointOnLineSegment(e,r,i)){n=!0;break}return n}},{key:"isPointOnGeoJSONMultiLineString",value:function(t,n){for(var r=!1,i=0;i<n.length;i+=1)if(e.isPointOnGeoJSONLineString(t,n[i])){r=!0;break}return r}},{key:"isPointInsideGeoJSONPolygon",value:function(e,t){var n=!1;if(kt.isPointInPolygon(e,t[0])&&(n=!0),n)for(var r=1;r<t.length;r+=1)if(kt.isPointInPolygon(e,t[r])){n=!1;break}return n}},{key:"isPointInsideGeoJSONMultiPolygon",value:function(t,n){for(var r=n.length,i=0;i<r;i+=1)if(e.isPointInsideGeoJSONPolygon(t,n[i]))return!0;return!1}},{key:"getGeometriesByLonLat",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],i=t.filter((function(t){return kt.isPointInBoundingBox(e,t.getBoundingBox())})),o=0;o<i.length;o+=1){var a=i[o];if(a.isPointInsideGeometry(e,true)&&(r.push(a),!n))break}return r.sort((function(e,t){return t.getZIndex()-e.getZIndex()}))}}]),e}(),Dt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;c(this,e),this.id=t.id,this.properties=t.properties||{},this.labelArea=t.label_area||[],this.geometry=t.geometry||{},this.location=t.location||{},this.address=t.address||{},this.level=n,this.zIndex=r,this.spaceId=t.spaceId,this.state_={isHighlighted:!1,highlightedStyle:{}},this.geometryData=t}return d(e,[{key:"getId",value:function(){return this.geometryData&&this.geometryData.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"getInternalAddress",value:function(){return this.address?this.address.properties&&this.address.properties.name:null}},{key:"getCenter",value:function(){return this.location.coordinates||[]}},{key:"getCoordinates",value:function(){return this.geometry.coordinates||[]}},{key:"getDisplayName",value:function(){return this.properties.display_name||""}},{key:"getName",value:function(){return this.properties.name||""}},{key:"getStyle",value:function(){return this.getMetaInformation_().getStyle(this)}},{key:"getIcon",value:function(){return this.properties.svg}},{key:"getLabelArea",value:function(){return this.labelArea||[]}},{key:"getLabelStyle",value:function(){return this.getMetaInformation_().getLabelStyle(this)||null}},{key:"getLevel",value:function(){return this.level}},{key:"getType",value:function(){return this.geometry.type}},{key:"getZIndex",value:function(){return this.zIndex}},{key:"getBoundingBox",value:function(){var e=this.getType(),t=this.getCoordinates(),n=[];switch(e){case Ye:n=[t,t];break;case Ke:case Ze:n=t;break;case Je:case We:n=t.reduce((function(e,t){return e.concat(t)}),[]);break;case Xe:n=t.reduce((function(e,t){return e.concat(t)}),[]).reduce((function(e,t){return e.concat(t)}),[])}return kt.getBoundingBoxVertices(n)}},{key:"isIcon",value:function(){return!!this.properties.icon}},{key:"isPointInsideGeometry",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!1;switch(this.getType()){case Ye:t=this.getLabelArea()&&kt.getRectangularCoordinatesOfLabelArea(this.getLabelArea()),r=kt.isPointInPolygon(e,t);break;case Ke:break;case Ze:r=n&&Ct.isPointOnGeoJSONLineString(e,this.getCoordinates());break;case Je:r=n&&Ct.isPointOnGeoJSONMultiLineString(e,this.getCoordinates());break;case We:r=Ct.isPointInsideGeoJSONPolygon(e,this.getCoordinates());break;case Xe:r=Ct.isPointInsideGeoJSONMultiPolygon(e,this.getCoordinates())}return r}},{key:"highlight",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;this.state_.isHighlighted=e,this.state_.highlightedStyle=e?t:{}}},{key:"isHighlighted",value:function(){return Boolean(this.state_.isHighlighted)}},{key:"getHighlightedStyle",value:function(){return this.state_.highlightedStyle||{}}},{key:"toJSON",value:function(){return o({},this.geometry)}},{key:"getMetaInformation_",value:function(){return this.getLevel()?this.getLevel().getDrawing().getVenueModel().metaInformation_:null}}]),e}(),jt=function(){function e(t,n){var r=this;c(this,e),this.id=t&&t.id,this.properties=t&&t.properties,this.zIndexCount=0,this.geometries=t&&t.features&&Object.values(t.features).reduce((function(e,t){return e[[t.id]]=new Dt(t,r,t.properties.drawOrder),e}),{}),this.drawing=n,this.levelData=t}return d(e,[{key:"getId",value:function(){return this.levelData&&this.levelData.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"getName",value:function(){return this.properties&&this.properties.name||""}},{key:"getDisplayName",value:function(){return this.properties&&this.properties.display_name||""}},{key:"getDrawing",value:function(){return this.drawing}},{key:"getShortName",value:function(){return this.properties&&this.properties["short name"]||""}},{key:"getZIndex",value:function(){return this.properties&&this.properties.zLevel}},{key:"getFeatureCollectionArray",value:function(){return this.getGeometries().map((function(e){return e.toJSON()}))}},{key:"getGeometryById",value:function(e){return this.geometries[e]}},{key:"getGeometries",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.geometries&&Object.values(this.geometries).sort((function(e,t){return t.getZIndex()-e.getZIndex()})):this.geometries&&Object.values(this.geometries).sort((function(e,t){return e.getZIndex()-t.getZIndex()}))}},{key:"getGeometriesByAddress",value:function(e){return Object.values(this.geometries).filter((function(t){return t.address&&t.address.properties&&t.address.properties.name&&t.address.properties.name===e}))}},{key:"isMain",value:function(){return Boolean(this.properties.isMain)}}]),e}(),Gt=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0;c(this,e),this.venueModel=o,this.levels=i.map((function(e){return new jt(e,n)})),this.structure=t,this.id=t&&t.id,this.properties=r}return d(e,[{key:"getId",value:function(){return this.structure&&this.structure&&this.structure.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"isRoot",value:function(){return Boolean(this.properties.is_root)}},{key:"getDisplayName",value:function(){return this.properties.display_name||""}},{key:"getName",value:function(){return this.properties.name||""}},{key:"getBoundingBox",value:function(){if(this.structure&&this.structure.geometry){var e=_(kt.getBoundingBox(this.structure.geometry.type,this.structure.geometry.coordinates),2),t=e[0],n=e[1];if(t)return[n[1],t[0],t[1],n[0]]}return[null,null,null,null]}},{key:"getCenter",value:function(){return this.structure&&this.structure.location&&this.structure.location.coordinates}},{key:"getGeometryById",value:function(e){return this.getGeometries().find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getGeometries",value:function(){return this.levels.flatMap((function(e){return e.getGeometries()}))}},{key:"getLevelById",value:function(e){return this.levels.find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getLevelByZIndex",value:function(e){return this.levels.find((function(t){return t.getZIndex()===e}))}},{key:"getLevels",value:function(){return this.levels}},{key:"getMainLevel",value:function(){return this.levels.find((function(e){return e.isMain()}))}},{key:"getVenueModel",value:function(){return this.venueModel}}]),e}(),Rt=Qe.STANDARD,Vt=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt;c(this,e),this.metaInformation_=r,this.momStructure=t,this.id=t&&t.site&&t.site.id,this.location=t&&t.site&&t.site.location||{},this.properties=t&&t.site&&o({},t.site.properties),this.drawings=t&&t.structure&&Object.values(t.structure).map((function(e){var r=t.getStructureWiseGeometry(e.id);return new Gt(e,e.properties,Object.values(r),n)}))}return d(e,[{key:"getDisplaySettings",value:function(){return(this.metaInformation_.releaseSettings_?this.metaInformation_.releaseSettings_.displayOptions:"").display||Rt}},{key:"getId",value:function(){return this.momStructure&&this.momStructure.site&&this.momStructure.site.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getName",value:function(){return this.properties.name}},{key:"getBoundingBox",value:function(){if(this.momStructure){var e=_(kt.getBoundingBox(this.momStructure.site.geometry.type,this.momStructure.site.geometry.coordinates),2),t=e[0],n=e[1];if(t)return[n[1],t[0],t[1],n[0]]}return[null,null,null,null]}},{key:"getCenter",value:function(){return this.location.coordinates}},{key:"getGeometryById",value:function(e){return this.getGeometries().find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getGeometries",value:function(){return this.getLevels().sort((function(e,t){return e.getZIndex()-t.getZIndex()})).flatMap((function(e){return e.getGeometries()}))}},{key:"getGeometriesByLonLat",value:function(e){var t=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).map((function(e){return t.getLevelById(e)}));0===r.length&&(r=this.drawings.filter((function(t){var n=t.getBoundingBox();return kt.isPointInBoundingBox(e,n)})).flatMap((function(e){return e.getLevels()})));return Ct.getGeometriesByLonLat(e,r.flatMap((function(e){return e.getGeometries(!0)})),n)}},{key:"getDrawingById",value:function(e){return this.drawings.find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getDrawings",value:function(){return this.drawings}},{key:"getRootDrawing",value:function(){return this.drawings.find((function(e){return e.isRoot()}))}},{key:"getLevelById",value:function(e){return this.getLevels().find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getLevelsByZIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.getLevels().filter((function(t){return Number(t.getZIndex())===Number(e)}))}},{key:"getLevels",value:function(){return this.drawings.flatMap((function(e){return e.getLevels()}))}},{key:"getMomStructure",value:function(){return this.momStructure}},{key:"getLevelMapFlattenedByZIndex_",value:function(){var e=this.getLevels().reduce((function(e,t){var n=t.getZIndex(),r=e;return r[n]||(r[n]=[]),r[n].push(t),r}),{});return e}},{key:"getOccupant",value:function(){var e=this.momStructure.occupant;return Object.values(e)}}]),e}(),Ht=function(){function e(t){c(this,e),this.theme=t&&t.theme,this.level=t&&t.level,this.site=t&&t.site,this.spaces=t&&t.spaces,this.address=t&&t.address,this.levelConnector=t&&t.levelConnector,this.topology=t&&t.topology,this.entrance=t&&t.entrance,this.occupant=t&&t.occupant,this.structure=t&&t.structure,this.spaceGroups=t&&t.spaceGroups,this.levelWiseGeometry={},this.levelStructureMapping=t&&t.levelStructureMapping,this.outdoorLevelMapping=t&&t.outdoorLevelMapping||{},this.labelTextPreference=t&&t.labelTextPreference||null}return d(e,[{key:"setSpaceWithLevel",value:function(){var e=this;this.spaces&&Object.values(this.spaces).forEach((function(t){var n="";t.addressId&&(n=e.address&&e.address[t.addressId]&&e.address[t.addressId].properties.addressName);var r=t.properties;r.addressName=n;var i=e.getLabelAsPerPreference(o(o({},t),{},{properties:r})),a=t.properties;a.name=i,a.display_name=i,t.properties.icon&&(a.name=t.id,a.display_name=t.id);var s=t;s.properties=a,s.address=e.address[t.addressId],e.spaces[t.id]=t;var u=t.levelId;e.outdoorLevelMapping[u]&&(u=e.outdoorLevelMapping[u]),e.levelWiseGeometry[u]||(e.levelWiseGeometry[u]={}),e.levelWiseGeometry[u][s.id]=s}))}},{key:"setOccupantWithLevel",value:function(){var e=this;this.occupant&&Object.values(this.occupant).forEach((function(t){if(t.spaceIds&&t.properties.occupantName){var n=[],r=[];t.spaceIds.forEach((function(i){var o=i.id,a=e.spaces[o],s=null;e.spaceGroups&&Object.values(e.spaceGroups).forEach((function(e){e.properties.spaceGroups&&e.properties.spaceGroups&&e.properties.spaceGroups.forEach((function(e){e.mainSpace&&e.mainSpace.id===i.id&&(s=e.spaces.map((function(e){return e.id})))}))}));var u=function(i){var o=!1;e.labelTextPreference&&e.labelTextPreference.length&&(o=-1!==e.labelTextPreference.indexOf("OCCUPANT_NAMES"));var a=null===e.labelTextPreference||o,s=i,u=i.properties;u.name=i.properties.icon||!a?i.properties.name:t.properties.occupantName,u.display_name=i.properties.icon||!a?i.properties.display_name:t.properties.occupantName,u.address=i.address,u.occupantName=t.properties.occupantName;var l=i.levelId;e.outdoorLevelMapping[l]&&(l=e.outdoorLevelMapping[l]),e.levelWiseGeometry[l]||(e.levelWiseGeometry[l]={}),e.levelWiseGeometry[l][i.id]=s,n.push(s),r.push(i.id)};s&&s.length>0&&s.forEach((function(t){u(e.spaces[t])})),a&&u(a)})),e.occupant[t.id]=t,e.occupant[t.id].space=n,e.occupant[t.id].spaceIds=r}}))}},{key:"setEntrance",value:function(){var e=this;this.entrance&&Object.values(this.entrance).forEach((function(t){var n=t.properties.level.id;e.levelWiseGeometry[n]||(e.levelWiseGeometry[t.properties.level.id]={}),e.outdoorLevelMapping[n]&&(n=e.outdoorLevelMapping[n]),e.levelWiseGeometry[n][t.id]=t}))}},{key:"setLevelWiseGeometry",value:function(){var e=this;this.level&&Object.keys(this.level).forEach((function(t){e.levelWiseGeometry[t]={}})),this.setSpaceWithLevel(),this.setOccupantWithLevel(),this.setEntrance()}},{key:"getStructureWiseGeometry",value:function(e){for(var t={},n=0,r=Object.entries(this.levelWiseGeometry);n<r.length;n++){var i=_(r[n],2),o=i[0],a=i[1];e===this.levelStructureMapping[o]&&(t[o]=this.level[o],t[o].features=a)}return t}},{key:"getLabelAsPerPreference",value:function(e){var t,n=e.properties,r=n.spaceType,i=n.occupantName,o=n.spaceName,a=n.addressName,s=n.spaceCategory,u=(p(t={},Re,i),p(t,Ve,o),p(t,Ue,r?r.charAt(0).toUpperCase()+r.slice(1).toLowerCase():""),p(t,Fe,s?s.charAt(0).toUpperCase()+s.slice(1).toLowerCase():""),p(t,He,a),p(t,ze,a),p(t,Be,a),t),l=this.theme.spaceRules,c="",h=s&&r&&l[s]&&l[s].spaceTypes&&l[s].spaceTypes[r].behavioralAppearance.default.labelType;if("NONE"===h){if(!this.labelTextPreference)return"";u[Ue]=""}var d=s&&r&&l[s]&&l[s].properties&&l[s].properties.behavioralAppearance&&l[s].properties.behavioralAppearance.default&&l[s].properties.behavioralAppearance.default.labelType;if(("NONE"===d||void 0===d)&&void 0===h){if(!this.labelTextPreference)return"";u[Ue]="",u[Fe]=""}var f=s&&r&&l[s]&&l[s].properties&&l[s].properties.behavioralAppearance&&l[s].properties.behavioralAppearance.default&&l[s].properties.behavioralAppearance.default.labelTextPreference,v=f&&this.labelTextPreference?this.labelTextPreference:f;if(v)for(var g=0;g<v.length;g++)if(u[v[g]]){c=u[v[g]];break}return c}}]),e}(),zt=function(){function e(t){var n=t.apiKey,r=t.baseUrl,i=t.token,o=t.hrn;c(this,e);var a={apiKey:n,url:r,token:i,hrn:o};this.hostOptions_=a,this.momData=[],this.theme={},this.loadOptions={}}var t;return d(e,[{key:"setHostOptions",value:function(e){0===Object.keys(e).length||(this.hostOptions_=o(o({},this.hostOptions_),e))}},{key:"getToken",value:function(){return this.hostOptions_.token}},{key:"getHrn",value:function(){return this.hostOptions_.hrn}},{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.loadOptions=o(o(o({},at),n),{},{venueId:e}),this.hostOptions_.mapData=n.mapData,this.hostOptions_.themeRule=n.themeRule,this.hostOptions_.svgList=n.svgList,this.hostOptions_.labelTextPreference=n.labelTextPreferenceOverride,this.getHrn()?this.getVenueModalInstance():this.getToken()?this.getDefaultCollectionWithToken().then((function(){return t.getVenueModalInstance()})).catch((function(){return Promise.reject(new Error("Unable to find indoor map collection. Please contact your administrator"))})):Promise.reject(new Error("In order to load indoor map, Please provide either hrn or token"))}},{key:"getVenueModalInstance",value:function(){var e=this;return Promise.resolve().then((function(){return e.loadOptions.isMetaEnabled?e.getMeta_(e.loadOptions.isIconsEnabled).catch((function(e){return console.warn(e),Promise.resolve()})):Promise.reject()})).then((function(t){return e.getVenue_(t)})).then((function(e){return e})).catch((function(e){console.debug("Captured event VENUE_ERROR_STATE",e)}))}},{key:"createMomStructure",value:function(){var e=this,t={site:{},structure:{},level:{},levelConnector:{},occupant:{},spaces:{},spaceGroups:{},topology:{},address:{},outdoorLevelMapping:{},entrance:{},levelStructureMapping:{}};return this.momData.forEach((function(n){var r="indoormap-00000000-0000-4000-a000-".concat(e.loadOptions.venueId.toString().padStart(12,"0")),i=n.id;(n.momType===Ge.ADDRESS||e.hostOptions_.mapData||n.properties.indoorMapId==e.loadOptions.venueId||n.properties.indoorMapId===r)&&(n.momType===Ge.SITE?t.site=xt.setSite(n,e.loadOptions.venueId):n.momType===Ge.STRUCTURE?t.structure[i]=xt.setStructure(n):n.momType!==Ge.LEVEL||n.properties.isOutdoor&&(!n.properties.isOutdoor||n.properties.parentIndoorLevel)?n.momType===Ge.LEVEL&&n.properties.isOutdoor&&n.properties.parentIndoorLevel?t.outdoorLevelMapping[n.id]=n.properties.parentIndoorLevel.id:n.momType===Ge.ENTRANCE?t.entrance[i]=xt.setEntrance(n):n.momType===Ge.OCCUPANT?t.occupant[i]=xt.setOccupant(n):n.momType===Ge.SPACE?t.spaces[i]=xt.setSpace(n):n.momType===Ge.SPACEGROUPS?t.spaceGroups[i]=xt.setSpaceGroups(n):n.momType===Ge.ADDRESS&&(t.address[i]=xt.setAddress(n)):(t.level[i]=xt.setLevel(n),t.levelStructureMapping[i]=n.properties.structure.id))})),t.theme=this.theme,t.labelTextPreference=this.hostOptions_.labelTextPreference,new Ht(t)}},{key:"getVenue_",value:function(e){this.momData=e.getMomData();var t=this.createMomStructure();return t.setLevelWiseGeometry(),new Vt(t,e)}},{key:"setConfigData",value:function(e){var t=e.themeRule,n=e.svgList,r=e.defaultLang;wt.setSpaceRules(t.spaceRules),xt.svgList=n,xt.themeRule=t,xt.defaultLang=r,this.theme=t}},{key:"getMeta_",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=new Tt,r=this.hostOptions_.mapData?{}:this.getMetaConfig_(this.loadOptions.venueId,je.SITE),i=this.hostOptions_.themeRule||this.getMetaConfig_(this.loadOptions.venueId,je.Theme),o=[];return t&&(o=this.hostOptions_.svgList||this.getMetaConfig_(this.loadOptions.venueId,je.IMAGES)),new Promise((function(a){Promise.all([r,i,o]).then((function(r){var i=_(r,3),o=i[0],s=i[1],u=i[2],l=e.hostOptions_.mapData?{mom:new Promise((function(t){return t(e.hostOptions_.mapData)})),site:e.hostOptions_.mapData.features.find((function(e){return e.momType===Ge.SITE}))}:Pt.getMomData(o,e.hostOptions_);l.mom.then((function(r){var i=s.properties;n.imageCache=t?xt.manageSvgDimensions(u.properties):[],e.setConfigData({themeRule:i,svgList:n.imageCache,defaultLang:l&&l.site&&l.site.properties.defaultLanguageCode}),n.releaseSettings_={displayOptions:{display:i.entranceRules.default.displayName||Qe.STANDARD},mom:r.features},n.theme=new At(i,n),a(n)}))}))}))}},{key:"getMetaConfig_",value:function(e,t){return Pt.getConfigUrl(e,t,this.hostOptions_)}},{key:"fetchCollections",value:function(){return Pt.getDefaultCollection(this.hostOptions_)}},{key:"fetchUserProjects",value:function(){return Pt.getProjectAccountDetails(this.hostOptions_)}},{key:"getDefaultCollectionWithToken",value:(t=function(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){l(o,r,i,a,s,"next",e)}function s(e){l(o,r,i,a,s,"throw",e)}a(void 0)}))}}(a().mark((function e(){var t=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.fetchCollections(),this.fetchUserProjects()]).then((function(e){var n=_(e,2),r=n[0],i=n[1],o=t.getHrnFromDefaultCollection(r,i);if(o.hrn){var a={hrn:o.hrn};return t.setHostOptions(a),Promise.resolve()}return Promise.reject()})).catch((function(e){return Promise.reject(e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getHrnFromDefaultCollection",value:function(e,t){var n=e.results.items;if(Array.isArray(n)&&n.length){var r=this.getProjectRealm(t);return n.find((function(e){return e.hrn.includes(r)}))}return Promise.reject(new Error("Error while accessing default collection"))}},{key:"getProjectRealm",value:function(e){if(Array.isArray(e.items)&&e.items.length&&e.items[0].id.includes("indoor-")){var t=e.items[0].hrn;return this.getRealmNameFromHrn(t)}return""}},{key:"getRealmNameFromHrn",value:function(e){if(e){var t=e.split(":");return t.length&&t[4]}return""}},{key:"getSupportedMapList",value:function(){var e=this,t=this.hostOptions_,n=t.hrn,r=t.token;return n?this.fetchMapInfoList():r?this.getDefaultCollectionWithToken().then((function(){return e.fetchMapInfoList()})).catch((function(){return Promise.reject(new Error("Unable to find indoor map collection. Please contact your administrator"))})):Promise.reject(new Error("In order to load map list, Please provide either hrn or token"))}},{key:"fetchMapInfoList",value:function(){var e=this;return Pt.fetchIndoorMapList(this.hostOptions_).then((function(t){var n=t.features;return n.length>0?n.map((function(t){var n=t.properties,r=n.placeProperties,i=n.indoorMapId,o=i.split("-").pop(),a=o.substring(o.length-5);return{mapIdentifier:i,mapName:e.getMapName(r.names).name,mapId:a}})):[]})).catch((function(e){Promise.reject(new Error("".concat(e,": Error while fetching map list")))}))}},{key:"getMapName",value:function(e){return Array.isArray(e)&&e.length>0?e.find((function(e){return"OFFICIAL"===e.nameType})):{}}}]),e}(),Bt=["origin","destination"],Ut=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(c(this,e),!t.apiKey&&!t.token)throw new Error("API key or Token is missing");this.config_=o({baseUrl:"https://meta-indoor-routing.api-gateway.ls.hereapi.com"},t)}return d(e,[{key:"calculateRoute",value:function(e){var t=e.origin,n=void 0===t?{}:t,r=e.destination,i=void 0===r?{}:r,o=y(e,Bt);if(!n.coordinates||!i.coordinates)throw new Error("Waypoint coordinates are missing");var a=function(e){var t=e.coordinates,n=e.venueId,r=e.levelId,i=t.join(",");return n&&r?i.concat(";indoorMapId=",n,";levelId=",r):i},s=new URL("".concat(this.config_.baseUrl,"/v1/routes")),l=new URLSearchParams({origin:a(n),destination:a(i),apiKey:this.config_.apiKey});return Object.entries(o).forEach((function(e){var t=_(e,2),n=t[0],r=t[1];l.append(n,"object"===u(r)?JSON.stringify(r):r)})),s.search=l,fetch(s,{headers:{"X-Api-Key":this.config_.apiKey}}).then((function(e){return e.json()}))}}]),e}(),Ft={VENUE_DATA_LOADED:"VENUE_DATA_LOADED",VENUE_THEME_LOADED:"VENUE_THEME_LOADED",VENUE_ICONS_LOADED:"VENUE_ICONS_LOADED",VENUE_MOM_DATA_LOADED:"VENUE_MOM_DATA_LOADED",VENUE_ERROR_STATE:"VENUE_ERROR_STATE",VENUE_MAP_DATA_LOADED:"VENUE_MAP_DATA_LOADED",VENUE_ENTITY_DATA_LOADED:"VENUE_ENTITY_DATA_LOADED",VENUE_DATA_MODEL_LOADED:"VENUE_DATA_MODEL_LOADED",VENUE_NAV_DATA_LOADED:"VENUE_NAV_DATA_LOADED",META_DATA_LOADED:"META_DATA_LOADED",META_DATA_MODEL_LOADED:"META_DATA_MODEL_LOADED",META_DATA_MODEL_UPDATED:"META_DATA_MODEL_UPDATED"};Object.freeze((p(vt={},Ft.VENUE_DATA_LOADED,{description:"event fired when all requested files along with metadata & overrides are loaded",emitTemplate:{}}),p(vt,Ft.VENUE_MAP_DATA_LOADED,{description:"event fired when requested levels, drawings & community files are loaded",emitTemplate:{}}),p(vt,Ft.VENUE_ENTITY_DATA_LOADED,{description:"event fired when requested entity data is loaded",emitTemplate:{}}),p(vt,Ft.VENUE_DATA_MODEL_LOADED,{description:"event fired when a map file is loaded",emitTemplate:{}}),p(vt,Ft.VENUE_NAV_DATA_LOADED,{description:"event fired when requested navigation product is loaded",emitTemplate:{}}),p(vt,Ft.META_DATA_LOADED,{description:"event fired when all requested meta files are loaded except icon & marker",emitTemplate:{}}),p(vt,Ft.META_DATA_MODEL_LOADED,{description:"event fired when a specific model is loaded except icon & marker",emitTemplate:{}}),p(vt,Ft.META_DATA_MODEL_UPDATED,{description:"event fired when a specific meta override is added or removed",emitTemplate:{}}),p(vt,Ft.VENUE_ICONS_LOADED,{description:"event fired when all icons of venue are loaded",emitTemplate:{}}),vt));var Yt=new lt;Yt.EVENT_NAME=Ft,Yt.on("newListener",(function(e){Ft[e]||console.warn("subscribing for un-registered/documented event")}));var Zt=function(e){f(r,H.map.Feature);var t=E(r);function r(e){var n;if(c(this,r),n=t.call(this),!(e instanceof Vt))throw new Error("It is mandatory to provide valid instance of venueModel");return n.venueModel=e,n.search_=new De(e),n.status_={activeDrawingId:e.getRootDrawing().getIdentifier(),activeLevelIndex:e.getRootDrawing().getMainLevel().getZIndex()},n.mapObjectStore_=n.getDefaultMapObjectsStore_(),n.drawings=e.getDrawings().map((function(e){var t=new A(e);return t.setParentEventTarget(m(n)),t})),n.levels=e.getLevels().map((function(e){var t=new T(e);return t.setParentEventTarget(n.drawings.find((function(e){return e.getIdentifier()===t.getData().getDrawing().getIdentifier()}))),t})),n.geometries=e.getGeometries().map((function(e){var t=new L(e);return t.setParentEventTarget(n.levels.find((function(e){return e.getIdentifier()===t.getData().getLevel().getIdentifier()}))),t})),n.mutualExclusiveHighlight_=!1,n}return d(r,[{key:"getData",value:function(){return this.venueModel}},{key:"getBoundingBox",value:function(){return n(H.geo.Rect,S(this.venueModel.getBoundingBox()))}},{key:"getCenter",value:function(){var e=_(this.venueModel.getCenter(),2),t=e[0],n=e[1];return new H.geo.Point(n,t)}},{key:"getId",value:function(){return this.venueModel.getId()}},{key:"getIdentifier",value:function(){return this.venueModel.getIdentifier()}},{key:"getName",value:function(){return this.venueModel.getName()}},{key:"getDrawing",value:function(e){return this.drawings.find((function(t){return t.getIdentifier()===e}))}},{key:"getDrawings",value:function(){return this.drawings}},{key:"getLevel",value:function(e){return this.levels.find((function(t){return t.getIdentifier()===e}))}},{key:"getLevels",value:function(){return this.levels}},{key:"getGeometry",value:function(e){return this.getGeometries().find((function(t){return t.getIdentifier()===e}))}},{key:"getGeometries",value:function(){return this.geometries}},{key:"getActiveLevels",value:function(){var e=this;return this.getData().getDisplaySettings()===Qe.FLATTEN?this.venueModel.getLevelsByZIndex(this.status_.activeLevelIndex).map((function(t){return e.getLevel(t.getIdentifier())})):[this.venueModel.getDrawingById(this.status_.activeDrawingId).getLevelByZIndex(this.status_.activeLevelIndex)].map((function(t){return e.getLevel(t.getIdentifier())}))}},{key:"getActiveDrawing",value:function(){return this.getDrawing(this.status_.activeDrawingId)}},{key:"setActiveDrawing",value:function(e){if(this.status_.activeDrawingId!==e){var t=this.venueModel.getDrawingById(e);if(!t)throw new Error("Drawing ".concat(e," was not found"));var n=this.status_.activeDrawingId;this.status_.activeDrawingId=t.id,this.setActiveLevelIndex(t.getMainLevel().getZIndex()),this.dispatchEvent(new H.util.ChangeEvent(r.EVENTS.DRAWING_CHANGE,e,n))}}},{key:"getActiveLevelIndex",value:function(){return this.status_.activeLevelIndex}},{key:"setActiveLevelIndex",value:function(e){if(this.venueModel.getLevelsByZIndex(e)){var t=this.status_.activeLevelIndex;this.status_.activeLevelIndex=e,this.dispatchEvent(new H.util.ChangeEvent(r.EVENTS.LEVEL_CHANGE,e,t))}}},{key:"isActive",value:function(){var e=this.getParentEventTarget();return!!e&&this===e.activeVenue}},{key:"getHighlightedGeometries",value:function(){var e=this;return this.venueModel.getGeometries().filter((function(e){return e.isHighlighted()})).map((function(t){return e.getGeometry(t.getIdentifier())}))}},{key:"setHighlightedGeometries",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=o(o({},le),n),s=a.fillColor,u=a.outlineColor,l=a.outlineWidth;(this.mutualExclusiveHighlight_=!!i,this.mutualExclusiveHighlight_)&&this.getHighlightedGeometries().forEach((function(e){e.getData().highlight(!1)}));t.forEach((function(t){t.getData().highlight(e,{m:s,o:u,w:l})})),this.dispatchEvent(r.EVENTS.GEOMETRY_HIGHLIGHT)}},{key:"getMapObjects",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getActiveLevelIndex(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getActiveDrawing();return this.mapObjectStore_[e][t.getIdentifier()]}},{key:"setMapObjects",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getActiveLevelIndex(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getActiveDrawing();this.mapObjectStore_[t]&&this.mapObjectStore_[t][n.getIdentifier()]&&(this.mapObjectStore_[t][n.getIdentifier()]=S(e)),this.updateMapObjectsVisibility_()}},{key:"search",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.search_.find(t).flatMap((function(t){return t.geometries.map((function(t){return e.getGeometry(t.id)}))}))}},{key:"updateMapObjectsVisibility_",value:function(){Object.values(this.mapObjectStore_).forEach((function(e){Object.values(e).forEach((function(e){return e.forEach((function(e){return e.setVisibility(!1)}))}))})),this.isActive()&&this.mapObjectStore_[this.getActiveLevelIndex()][this.getActiveDrawing().getIdentifier()].forEach((function(e){return e.setVisibility(!0)}))}},{key:"getDefaultMapObjectsStore_",value:function(){var e=this,t=this.getData().getDisplaySettings()===Qe.FLATTEN;return this.venueModel.getLevels().reduce((function(n,r){var i=r.getZIndex(),a=o({},n);return a[i]||(a[i]={}),a[i][r.getDrawing().getIdentifier()]=[],t&&(a[i][e.venueModel.getRootDrawing().getIdentifier()]=[]),a}),{})}}]),r}();Zt.EVENTS={ACTIVE_VENUE_CHANGE:"activevenuechange",DRAWING_CHANGE:"drawingchange",LEVEL_CHANGE:"levelchange",GEOMETRY_HIGHLIGHT:"geometryhighlight"};var Wt=function(){function e(){c(this,e)}return d(e,null,[{key:"getIconLayer",value:function(){return{type:"FeatureCollection",features:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).flatMap((function(e){return e.getData().getGeometries()})).filter((function(e){return e.isIcon()&&e.getIcon()})).map((function(e){var t=_(e.getLabelArea(),2),n=t[0],r=t[1],i=e.getLevel(),o=e.getIcon(),a=e.properties.spaceType||e.properties.spaceCategory||e.getDisplayName();return{type:"Feature",properties:{id:e.getIdentifier(),geometryId:e.getIdentifier(),levelId:i.getIdentifier(),name:a,venueId:i.getDrawing().getVenueModel().getIdentifier(),url:o?"data:image/svg+xml;utf8,".concat(encodeURIComponent(o)):""},geometry:{type:ne,coordinates:[n,r]}}}))}}},{key:"getLabelLayer",value:function(){return{type:"FeatureCollection",features:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).flatMap((function(e){return e.getData().getGeometries()})).filter((function(e){return e.getDisplayName()&&!e.isIcon()})).map((function(e){var t=_(e.getLabelArea(),2),n=t[0],r=t[1],i=e.getLabelStyle(),o=i.fill,a=i.zmin,s=e.getLevel();return{type:"Feature",properties:{id:e.getIdentifier(),geometryId:e.getIdentifier(),levelId:s.getIdentifier(),venueId:s.getDrawing().getVenueModel().getIdentifier(),name:e.getDisplayName(),minZoom:a||15,textFillColor:o.toLowerCase()},geometry:{type:ne,coordinates:[n,r]}}}))}}},{key:"getGeometryLayer",value:function(){return{type:"FeatureCollection",features:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).flatMap((function(e){return e.getData().getGeometries()})).filter((function(e){return e.getType()!==ne})).map((function(e){var t=e.getHighlightedStyle()||{},n=t.m,r=t.o,i=t.w,a=o({},e.getStyle()),s=a.m,u=a.o,l=a.w,c=se,h=c.fillColor,d=c.outlineColor,p=c.outlineWidth,f=e.getLevel();return{type:"Feature",properties:{id:e.getIdentifier(),fillColor:(n||s||h).toLowerCase(),geometryId:e.getIdentifier(),levelId:f.getIdentifier(),venueId:f.getDrawing().getVenueModel().getIdentifier(),outlineColor:(r||u||d).toLowerCase(),outlineWidth:Number(((i||l||p)/3).toFixed(2)),zIndex:e.getZIndex()},geometry:{type:e.getType(),coordinates:e.getCoordinates()}}}))}}},{key:"getFootprintLayer",value:function(e){return{type:"FeatureCollection",features:e.flatMap((function(e){return e.getData().getLevels().map((function(t){var n=t.getIdentifier(),r=e.getLevel(n).getData().levelData.geometry;return{type:"Feature",properties:{isFootprint:!0,levelId:n,venueId:e.getIdentifier(),zIndex:1},geometry:{type:"MultiPolygon",coordinates:r.coordinates}}}))}))}}}]),e}(),Kt=function(){function e(){c(this,e)}return d(e,null,[{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n={styles:[{layer:pe.FOOTPRINT,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#4E5663",lineWidth:["interpolate",["linear"],["zoom"],0,"1px",6,"1px",7,"2px",18,"2px",19,"4px",24,"4px"],renderOrder:1},{layer:pe.FOOTPRINT,when:["==",["geometry-type"],"Point"],technique:"text",color:"black",size:16,text:["get","venueName"],priority:61},{layer:pe.VECTOR,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:["get","fillColor"],renderOrder:["get","zIndex"]},{layer:pe.VECTOR,technique:"solid-line",color:["get","outlineColor"],lineWidth:["get","outlineWidth"],renderOrder:["get","zIndex"]},{layer:pe.TEXT,minZoomLevel:["get","minZoom"],technique:"text",color:["get","textFillColor"],size:ue.size,text:["get","name"],priority:60},{layer:pe.ICON,minZoomLevel:ce,when:["==",["geometry-type"],"Point"],technique:"labeled-icon",textIsOptional:!0,size:0,imageTexture:["concat","texture",["get","name"]],screenWidth:["interpolate",["linear"],["zoom"],15,3,21,70],screenHeight:["interpolate",["linear"],["zoom"],15,3,21,70],priority:61}],images:{},imageTextures:[]};return e.forEach((function(e){var t="texture"+e.properties.name;n.images[t]||(n.images[t]={url:e.properties.url,preload:!0},n.imageTextures.push({name:t,image:t}))})),t.forEach((function(e){var t,r=e.getData().getHighlightedStyle(),i=r.m,o=r.o,a=r.w;(t=n.styles).push.apply(t,[{layer:pe.VECTOR,when:["==",["get","id"],e.id],technique:"fill",color:i,renderOrder:["get","zIndex"]},{layer:pe.VECTOR,when:["==",["get","id"],e.id],technique:"solid-line",color:o,lineWidth:a,renderOrder:["get","zIndex"]}])})),new H.map.render.harp.Style(n)}}]),e}(),Jt=function(){function e(){c(this,e)}return d(e,null,[{key:"getIconsTextures",value:function(){var e={},t={},n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce((function(e,t){var n=t.properties.name;return e[n]||(e[n]=[]),e[n].push(t),e}),{});return Object.keys(n).forEach((function(r){var i="texture".concat(r),o="sprite".concat(r),a=n[r][0].properties.url;e[i]={url:a,sprites:p({},o,[0,0,50,50])},n[r].forEach((function(e){var n=e.properties;t["icon".concat(n.name)]={filter:{name:n.name,$zoom:{min:ce}},draw:{points:{interactive:!0,priority:1,size:[[15,"50%"],[16,"55%"],[17,"60%"],[18,"65%"],[19,"75%"],[20,"80%"],[21,"100%"]],texture:i,sprite:o}}}}))})),{textures:e,iconLayers:t}}},{key:"getFootprintLayer",value:function(){return{data:{source:"venues",layer:pe.FOOTPRINT},draw:{lines:{color:"#4E5663",width:[[0,"1px"],[6,"1px"],[7,"2px"],[18,"2px"],[19,"4px"],[24,"4px"]],order:1},points:{color:"[0, 0, 0, 0]",size:"0px",order:3,priority:1,text:{anchor:"center",collide:!1,font:{fill:"black",size:"16px"},text_source:"function() { return feature.venueName }"}}}}}},{key:"getGeometryLayer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={};if(e.length){var n=e[0].getData().getHighlightedStyle(),r=n.m,i=n.o,o=n.w;t={filter:{id:e.map((function(e){return e.id}))},draw:{polygons:{interactive:!0,color:r},lines:{color:i,width:o}}}}return{data:{source:"venues",layer:pe.VECTOR},draw:{polygons:{interactive:!0,color:"function() { return feature.fillColor }",order:"function() { return feature.zIndex }"},lines:{color:"function() { return feature.outlineColor }",order:"function() { return feature.zIndex }",width:"function() { return feature.outlineWidth }"}},highlighted:t}}},{key:"getTextLayer",value:function(){return{filter:{$zoom:{min:he}},data:{source:"venues",layer:pe.TEXT},draw:{points:{filter:"function() { return $zoom > feature.minZoom }",color:"[0, 0, 0, 0]",size:"0px",offset:["0px","-10px"],priority:2,text:{font:{fill:"function() { return feature.textFillColor }",size:ue.size},text_source:"function() { return feature.name }"}}}}}},{key:"getIconLayer",value:function(e){return o({data:{source:"venues",layer:pe.ICON}},e)}},{key:"getStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=e.getIconsTextures(t),i=r.textures,o=r.iconLayers,a={venue_footprints:e.getFootprintLayer(),venue_geometries:e.getGeometryLayer(n),venue_labels:e.getTextLayer(),venue_icons:e.getIconLayer(o)},s=H.gl.yaml.dump({sources:{venues:{max_zoom:de,type:"GeoJSONTileSource"}},layers:a,textures:i});return new H.map.render.webgl.Style(s)}}]),e}(),Xt={type:"FeatureCollection",features:[]},Qt={extent:4096,indexMaxZoom:0,maxZoom:24,tolerance:3},qt=function(e){f(n,H.map.provider.RemoteTileProvider);var t=E(n);function n(e){var r;return c(this,n),(r=t.call(this,e)).venues=[],r.activeVenue=null,r.dataLayers_={},r.tileIndexes_={},r.addEventListener(Zt.EVENTS.ACTIVE_VENUE_CHANGE,r.activeVenueChangeHandler_,void 0,m(r)),r}return d(n,[{key:"setStyle",value:function(e){return this.setStyleInternal(e)}},{key:"getStyle",value:function(){return this.getStyleInternal()}},{key:"isFeatureVisible_",value:function(e){var t=e.properties;return!!this.activeVenue.getActiveLevels().some((function(e){return e.id===t.levelId}))}},{key:"requestInternal",value:function(e,t,n,r){var i=this,o=function(r){for(var i=0;i<r.length;i+=1)r[i]=r[i].map((function(r){return Se(r,n,e,t,Qt.extent)}))},a={};return Object.keys(this.tileIndexes_).forEach((function(r){var s=i.tileIndexes_[r].getTile(n,e,t);a[r]=s?function(e){var t=[],n=e&&e.features;if(n)for(var r=0,i=n.length;r<i;r+=1){var o=n[r],a=o.type,s=void 0,u=!1;switch(a){case ve:s={type:ie,coordinates:o.geometry.map((function(e){return e.slice()}))};break;case ge:case ye:s={type:oe,coordinates:o.geometry.map((function(e){return e.map((function(e){return e.slice()}))}))},a===ye&&null==(s=_e(s))&&(u=!0);break;default:u=!0}u||t.push({geometry:s,id:o.id,properties:o.tags,type:"Feature"})}return{type:"FeatureCollection",features:t}}(s):Xt,a[r].features=a[r].features.filter((function(e){return i.isFeatureVisible_(e)}));for(var u=0;u<a[r].features.length;u+=1){var l=a[r].features[u],c=l.geometry.type;if(c===re||c===oe)o(l.geometry.coordinates);else if(c===ae)l.geometry.coordinates.map(o);else for(var h=l.geometry.coordinates,d=0;d<h.length;d+=1)h[d]=Se(h[d],n,e,t,Qt.extent)}})),r(a),{cancel:function(){}}}},{key:"getActiveVenue",value:function(){return this.activeVenue}},{key:"getVenue",value:function(e){return e?this.venues.find((function(t){return t.getIdentifier()===e})):this.activeVenue}},{key:"setActiveVenue",value:function(e){var t=this.activeVenue;this.activeVenue=e,this.dispatchEvent(new H.util.ChangeEvent(Zt.EVENTS.ACTIVE_VENUE_CHANGE,e,t)),this.reload()}},{key:"addVenue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(e instanceof Zt))throw new Error("Invalid argument");var n=e.getIdentifier();if(this.getVenue(n))throw new Error("Please invoke provider.removeVenue to remove old instance of venue ".concat(n," before adding new"));e.setParentEventTarget(this),this.venues.push(e),t||(this.reloadData_(),this.reloadStyle_())}},{key:"addVenues",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length>0&&(t.forEach((function(t){t instanceof Zt&&e.addVenue(t,!0)})),this.reloadData_(),this.reloadStyle_())}},{key:"removeVenue",value:function(e){if(e instanceof Zt&&this.venues.indexOf(e)>-1){var t=e.getIdentifier();this.activeVenue&&this.activeVenue.getIdentifier()===t&&this.setActiveVenue(null),this.venues.splice(this.venues.indexOf(e),1),this.reloadData_(),this.reloadStyle_(),this.reload()}}},{key:"getFeatureProxy",value:function(e,t,n){var r=e.geometryId,i=e.venueId,o=this.getVenue(i);return r?n(o.getGeometries().find((function(e){return e.id===r}))):o&&n(o),!0}},{key:"addVenueEventListeners_",value:function(e){e&&(e.addEventListener(Zt.EVENTS.GEOMETRY_HIGHLIGHT,this.geometryHighlightHandler_,void 0,this),e.addEventListener(Zt.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),e.addEventListener(Zt.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this))}},{key:"removeVenueEventListeners_",value:function(e){e&&(e.removeEventListener(Zt.EVENTS.GEOMETRY_HIGHLIGHT,this.geometryHighlightHandler_,void 0,this),e.removeEventListener(Zt.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),e.removeEventListener(Zt.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this))}},{key:"activeVenueChangeHandler_",value:function(e){var t=e.oldValue,n=e.newValue;t&&(this.removeVenueEventListeners_(t),t.updateMapObjectsVisibility_()),n&&(this.addVenueEventListeners_(n),n.updateMapObjectsVisibility_())}},{key:"drawingChangeHandler_",value:function(){this.reload()}},{key:"levelChangeHandler_",value:function(){this.activeVenue&&(this.activeVenue.updateMapObjectsVisibility_(),this.reload())}},{key:"geometryHighlightHandler_",value:function(){this.reloadStyle_(this.activeVenue.getHighlightedGeometries())}},{key:"createDataLayers_",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(pe),n=pe.FOOTPRINT,r=pe.ICON,i=pe.TEXT,o=pe.VECTOR;t.forEach((function(t){switch(t){case o:e.dataLayers_[o]=Wt.getGeometryLayer(e.venues);break;case n:e.dataLayers_[n]=Wt.getFootprintLayer(e.venues);break;case r:e.dataLayers_[r]=Wt.getIconLayer(e.venues);break;case i:e.dataLayers_[i]=Wt.getLabelLayer(e.venues);break;default:throw new Error("Unsupported Layer ".concat(t))}}))}},{key:"createTileIndexes_",value:function(){var e=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(pe)).forEach((function(t){e.tileIndexes_[t]=new ee(e.dataLayers_[t],Qt)}))}},{key:"reloadData_",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(pe);this.createDataLayers_(e),this.createTileIndexes_(e)}},{key:"reloadStyle_",value:function(e){var t=this.dataLayers_[pe.ICON]?this.dataLayers_[pe.ICON].features:[];this.getEngineType()===H.Map.EngineType.WEBGL?this.setStyle(Jt.getStyle(t,e)):this.getEngineType()===H.Map.EngineType.HARP&&this.setStyle(Kt.getStyle(t,e))}},{key:"providesGeoJSON",value:function(){return!0}}]),n}(),$t=new H.map.SpatialStyle({strokeColor:"#1ab4bf",lineWidth:3}),en=new H.map.SpatialStyle({strokeColor:"#1ab4bf",lineWidth:3}),tn=new H.map.Icon("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDQwIDUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHBhdGggaWQ9ImIiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzNC4yNSAzMS42NTJ6Ii8+PHBhdGggaWQ9ImEiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzNC4yNSAzMS42NTJ6Ii8+PG1hc2sgaWQ9ImMiIHdpZHRoPSIzOCIgaGVpZ2h0PSI0NiIgeD0iMCIgeT0iMCIgZmlsbD0iI2ZmZiI+PHVzZSB4bGluazpocmVmPSIjYSIvPjwvbWFzaz48L2RlZnM+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48ZWxsaXBzZSBjeD0iMjAiIGN5PSI0NS4xNiIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjOTc5Nzk3IiBzdHJva2Utd2lkdGg9Ii4yNSIgcng9IjMuNSIgcnk9IjMuNSIvPjx1c2UgZmlsbD0iIzAxQjZCMiIgeGxpbms6aHJlZj0iI2IiLz48cGF0aCBmaWxsPSIjMzIzMjMyIiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJNMTEuODEgMzcuNjZoMTYuMzhsLTguMiA4eiIvPjx1c2Ugc3Ryb2tlPSIjNDE2QTg2IiBzdHJva2Utd2lkdGg9Ii41IiBtYXNrPSJ1cmwoI2MpIiB4bGluazpocmVmPSIjYSIvPjxlbGxpcHNlIGN4PSIxOS44MSIgY3k9IjE5LjE5IiBmaWxsPSIjRkZGIiByeD0iNC44MSIgcnk9IjQuODEiLz48L2c+PC9zdmc+"),nn=new H.map.Icon("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDQwIDUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHBhdGggaWQ9ImEiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzMi44MyAzMy4xMDRjLjQwNy0uMzc0IDEuNDE5LTEuNDUyIDEuNDE5LTEuNDUyeiIvPjxtYXNrIGlkPSJjIiB3aWR0aD0iMzgiIGhlaWdodD0iNDYiIHg9IjAiIHk9IjAiIGZpbGw9IiNmZmYiPjx1c2UgeGxpbms6aHJlZj0iI2EiLz48L21hc2s+PGVsbGlwc2UgaWQ9ImIiIGN4PSIxOS44MDciIGN5PSIxOS4xNjgiIHJ4PSIxMi4zNjMiIHJ5PSIxMi4xOTciLz48bWFzayBpZD0iZCIgd2lkdGg9IjI1LjcyNSIgaGVpZ2h0PSIyNS4zOTQiIHg9Ii0uNSIgeT0iLS41Ij48cGF0aCBmaWxsPSIjZmZmIiBkPSJNNi45NDQgNi40NzFoMjUuNzI1djI1LjM5NEg2Ljk0NHoiLz48dXNlIHhsaW5rOmhyZWY9IiNiIi8+PC9tYXNrPjwvZGVmcz48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxlbGxpcHNlIGN4PSIyMCIgY3k9IjQ1LjE2IiBmaWxsPSIjRkZGIiBzdHJva2U9IiM5Nzk3OTciIHN0cm9rZS13aWR0aD0iLjI1IiByeD0iMy41IiByeT0iMy41Ii8+PHVzZSBmaWxsPSIjMzIzMjMyIiB4bGluazpocmVmPSIjYSIvPjxwYXRoIGZpbGw9IiM3RDdEN0QiIGQ9Ik0xMi4wMTEgMzcuODA1aDE1Ljk3OGwtNy45MTYgOHoiLz48dXNlIHN0cm9rZT0iIzdDN0M3QyIgc3Ryb2tlLXdpZHRoPSIuNSIgbWFzaz0idXJsKCNlKSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIHN0cm9rZT0iI0ZGRiIgc3Ryb2tlLXdpZHRoPSIuNSIgbWFzaz0idXJsKCNjKSIgeGxpbms6aHJlZj0iI2EiLz48ZWxsaXBzZSBmaWxsPSIjRkZGIiBjeD0iMTkuODA3IiBjeT0iMTkuMTY4IiByeD0iMTIuMzYzIiByeT0iMTIuMTk3Ii8+PHBhdGggZmlsbD0iIzMyMzIzMiIgZD0iTTYuODEyIDYuOTQ4aDYuNDV2Ni4zNjRoLTYuNDV6bTAgMTIuNzI3aDYuNDV2Ni4zNjRoLTYuNDV6bTYuNDUtNi4zNjNoNi40NXY2LjM2NGgtNi40NXptMCAxMi43MjdoNi40NXY2LjM2NGgtNi40NXptNi40NS0xOS4wOTFoNi40NXY2LjM2NGgtNi40NXptMCAxMi43MjdoNi40NXY2LjM2NGgtNi40NXptNi40NS02LjM2M2g2LjQ1djYuMzY0aC02LjQ1em0wIDEyLjcyN2g2LjQ1djYuMzY0aC02LjQ1eiIvPjx1c2Ugc3Ryb2tlPSIjRkZGIiBtYXNrPSJ1cmwoI2QpIiB4bGluazpocmVmPSIjYiIgc3Ryb2tlLWxpbmVjYXA9InNxdWFyZSIvPjwvZz48L3N2Zz4="),rn=function(e,t,n){return n===on.ObjectType.SEGMENT_START_MARKER?0===e?tn:null:n===on.ObjectType.SEGMENT_FINISH_MARKER?1===t.length||e===t.length-1?nn:null:"indoor"===t[e].departure.place.type?$t:en},on=function(){function e(t,n){c(this,e),this.indoorMapObjects_=null,this.outdoorMapObjects_=null,this.createRouteObjects_(t,n)}return d(e,[{key:"createRouteObjects_",value:function(t){var n=this,r=t.sections,i=void 0===r?[]:r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn;this.indoorMapObjects_={},this.outdoorMapObjects_=new H.map.Group;for(var s=function(t){var r=i[t],s=r.departure.place,u=s.id,l=s.type,c=H.util.flexiblePolyline.decode(r.polyline).polyline,h=void 0,d=void 0,p=a(t,i,e.ObjectType.SEGMENT_START_MARKER);p&&(h=new H.map.Marker(r.departure.place.location,{icon:p}));var f=a(t,i,e.ObjectType.SEGMENT_FINISH_MARKER);f&&(d=new H.map.Marker(r.arrival.place.location,{icon:f}));var v=a(t,i,e.ObjectType.SEGMENT_POLYLINE);if("indoor"===l){var g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=new Map,n=new H.geo.LineString,r=_(e[0],3)[2];return t.set(r,[n]),e.forEach((function(e){var i;e[2]!==r&&(r=e[2],n=new H.geo.LineString,t.has(r)?t.get(r).push(n):t.set(r,[n])),(i=n).pushLatLngAlt.apply(i,S(e))})),t}(c),y=Array.from(g.keys()).reduce((function(e,t){return e[t]||(e[t]=new H.map.Group),e}),{});v&&g.forEach((function(e,t){e.forEach((function(e){if(e.getPointCount()>1){var n=new H.map.Polyline(e,{style:v});y[t].addObject(n)}}))})),h&&y[r.departure.place.location.lvl].addObject(h),d&&y[r.arrival.place.location.lvl].addObject(d),n.indoorMapObjects_[u]=o(o({},n.indoorMapObjects_[u]||{}),y)}else{if(v){var m=new H.geo.LineString(c.flatMap((function(e){return[e[0],e[1],0]}))),E=new H.map.Polyline(m,{style:v});n.outdoorMapObjects_.addObject(E)}h&&n.outdoorMapObjects_.addObject(h),d&&n.outdoorMapObjects_.addObject(d)}},u=0;u<i.length;u++)s(u)}},{key:"getIndoorObjects",value:function(){return this.indoorMapObjects_}},{key:"getOutdoorObjects",value:function(){return this.outdoorMapObjects_}}]),e}();on.ObjectType={SEGMENT_START_MARKER:1,SEGMENT_FINISH_MARKER:2,SEGMENT_POLYLINE:3};var an=function(e){f(n,H.service.Service);var t=E(n);function n(e){var r;c(this,n),r=t.call(this,n,o(o({},e),{},{baseUrl:void 0}));var i={apiKey:e.apikey,baseUrl:e.baseUrl,token:e.token},a={apiKey:i.apiKey,token:i.token};i.apiKey||(i.apiKey=r.getUrl().getQuery().apikey);var s=e.useLegacy||!1;return r.venueService_=new zt(i,s),a.apiKey||(a.apiKey=r.getUrl().getQuery().apikey),e.routingBaseUrl&&(a.baseUrl=e.routingBaseUrl),r.routingService_=new Ut(a),r}return d(n,[{key:"loadVenue",value:function(e){return console.warn("Venue service version 1 is no longer supported hence "+e+" could not be loaded"),Promise.resolve()}},{key:"calculateRoute",value:function(e){return console.warn("HERE Indoor Routing is deprecated and will be removed soon."),this.routingService_.calculateRoute(e)}}]),n}();an.CONFIG_KEY="venues";var sn=function(e){f(n,H.service.Service);var t=E(n);function n(e){var r;c(this,n),r=t.call(this,n,o(o({},e),{},{baseUrl:void 0}));var i={apiKey:e.apikey,baseUrl:e.baseUrl,token:e.token,hrn:e.hrn};i.apiKey||(i.apiKey=r.getUrl().getQuery().apikey);var a=e.useLegacy||!1;return r.venueService_=new zt(i,a),r}return d(n,[{key:"loadVenue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.venueService_.load(e,t).then((function(e){return new Zt(e)}))}},{key:"getMapInfoList",value:function(){return this.venueService_.getSupportedMapList()}}]),n}();sn.CONFIG_KEY="indoorMaps",H.service.Platform.prototype.getVenuesService=function(e,t){var n=sn;return 1!==t&&t?t!==fe.v2||e.token||(e.hrn?e.apikey||console.error("Venue Service version 2 requires either apikey or token"):console.error("Token is mandatory when Hrn is not provided in Venue Service version 2")):(console.warn("Venue service version 1 is no longer supported"),n=an),this.createService(n,e)},sn.LABEL_TEXT_PREFERENCE_OVERRIDE={OCCUPANT_NAMES:"OCCUPANT_NAMES",SPACE_NAME:"SPACE_NAME",SPACE_TYPE_NAME:"SPACE_TYPE_NAME",SPACE_CATEGORY_NAME:"SPACE_CATEGORY_NAME",INTERNAL_ADDRESS:"INTERNAL_ADDRESS"};var un=function(e){f(n,H.ui.Control);var t=E(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c(this,n),(r=t.call(this)).provider_=null,r.levelSelectorUI_=null,r.setAlignment(i&&i.alignment||H.ui.LayoutAlignment.RIGHT_BOTTOM),r.addClass("venues-ui"),e instanceof Zt&&r.setVenue(e),r}return d(n,[{key:"renderInternal",value:function(e,t){I(v(n.prototype),"renderInternal",this).call(this,e,t),this.createLevelSelectorUI_(e),this.venue&&this.setVenue(this.venue)}},{key:"setVenue",value:function(e){e instanceof Zt&&(this.removeEventListeners_(),this.venue=e,this.provider_=e.getParentEventTarget(),this.update_(),this.addEventListeners_())}},{key:"createLevelSelectorUI_",value:function(e){var t=this;e.innerHTML="",this.levelSelectorUI_=null;this.levelSelectorUI_=new Lt(e,null,null,(function(e){return t.venue.setActiveLevelIndex(e)}))}},{key:"update_",value:function(){if(this.levelSelectorUI_){var e=this.venue.getActiveDrawing().getData(),t=this.venue.getData().getDisplaySettings();this.levelSelectorUI_.update(e,t),this.levelChangeHandler_()}}},{key:"addEventListeners_",value:function(){this.venue&&(this.venue.addEventListener(Zt.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),this.venue.addEventListener(Zt.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this)),this.provider_&&this.provider_.addEventListener(Zt.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"removeEventListeners_",value:function(){this.venue&&(this.venue.removeEventListener(Zt.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),this.venue.removeEventListener(Zt.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this)),this.provider_&&this.provider_.removeEventListener(Zt.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"levelChangeHandler_",value:function(){this.levelSelectorUI_.switch(this.venue.getActiveLevelIndex())}},{key:"drawingChangeHandler_",value:function(){this.update_()}},{key:"activeVenueChangeHandler_",value:function(e){this.setVenue(e.newValue)}}]),n}(),ln=function(e){f(n,H.ui.Control);var t=E(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c(this,n),(r=t.call(this)).provider_=null,r.drawingSelectorUI_=null,r.addClass("venues-ui"),r.setAlignment(i&&i.alignment||H.ui.LayoutAlignment.RIGHT_BOTTOM),e instanceof Zt&&r.setVenue(e),r}return d(n,[{key:"renderInternal",value:function(e,t){I(v(n.prototype),"renderInternal",this).call(this,e,t),this.createDrawingSelectorUI_(e),this.venue&&this.setVenue(this.venue)}},{key:"setVenue",value:function(e){e instanceof Zt&&(this.removeEventListeners_(),this.venue=e,this.provider_=e.getParentEventTarget(),this.drawingSelectorUI_&&this.drawingSelectorUI_.update(e.getData()),this.addEventListeners_())}},{key:"createDrawingSelectorUI_",value:function(e){var t=this;e.innerHTML="",this.drawingSelectorUI_=null,this.drawingSelectorUI_=new It(e,null,(function(e){return t.venue.setActiveDrawing(e)}))}},{key:"addEventListeners_",value:function(){this.venue&&this.venue.addEventListener(Zt.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this),this.provider_&&this.provider_.addEventListener(Zt.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"removeEventListeners_",value:function(){this.venue&&this.venue.removeEventListener(Zt.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this),this.provider_&&this.provider_.removeEventListener(Zt.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"drawingChangeHandler_",value:function(){this.drawingSelectorUI_.switch(this.venue.getActiveDrawing().id)}},{key:"activeVenueChangeHandler_",value:function(e){this.setVenue(e.newValue)}}]),n}(),cn=Object.freeze({__proto__:null,DrawingControl:ln,LevelControl:un});return t(".venues-ui * {\n  font-family: \"Fira Sans\", \"Helvetica Neue\", Helvetica, sans-serif;\n  color: #0F1621;\n}\n.venues-ui .arrow {\n  display: block;\n  width: 100%;\n  height: 100%;\n  background-repeat: no-repeat;\n  background-position: center;\n}\n.venues-ui .arrow--up {\n  background-image: url(\"data:image/svg+xml,%0A%3Csvg width='13px' height='9px' viewBox='0 0 13 9' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cg id='VenueMap_Facilities_Detail' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='Floorplan-Switcher' transform='translate(-426.000000, -584.000000)' fill='%23383C45'%3E%3Cg id='Map-Controls-Copy' transform='translate(417.753906, 572.000000)'%3E%3Cg id='Chevron,-Dark' transform='translate(15.000000, 16.499023) rotate(-180.000000) translate(-15.000000, -16.499023) translate(9.000000, 12.749023)'%3E%3Cpath d='M6.0105,7.5 L4.1895,5.76404817 L0.1695,1.90510321 C0.057,1.79759174 0,1.68291284 0,1.56106651 C0,1.44065367 0.057,1.32597477 0.1695,1.2184633 L1.2465,0.16771789 C1.347,0.0587729358 1.47,0.00430045872 1.617,0.00430045872 C1.764,0.00430045872 1.887,0.0587729358 1.986,0.166284404 L6.009,3.98365826 L10.023,0.161983945 C10.122,0.0530389908 10.236,0 10.3695,0 C10.503,0 10.62,0.0530389908 10.7205,0.161983945 L11.841,1.21129587 C12.0525,1.43922018 12.0525,1.67144495 11.8425,1.89793578 L7.827,5.76118119 L6.0105,7.5 Z' id='Fill-3'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");\n}\n.venues-ui .arrow--down {\n  background-image: url(\"data:image/svg+xml,%0A%3Csvg width='13px' height='9px' viewBox='0 0 13 9' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cg id='VenueMap_Facilities_Detail' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='Floorplan-Switcher' transform='translate(-347.000000, -704.000000)' fill='%23383C45'%3E%3Cg id='Map-Controls' transform='translate(338.251953, 572.000000)'%3E%3Cg id='Chevron,-Dark' transform='translate(9.000000, 132.746094)'%3E%3Cpath d='M6.0105,7.5 L4.1895,5.76404817 L0.1695,1.90510321 C0.057,1.79759174 0,1.68291284 0,1.56106651 C0,1.44065367 0.057,1.32597477 0.1695,1.2184633 L1.2465,0.16771789 C1.347,0.0587729358 1.47,0.00430045872 1.617,0.00430045872 C1.764,0.00430045872 1.887,0.0587729358 1.986,0.166284404 L6.009,3.98365826 L10.023,0.161983945 C10.122,0.0530389908 10.236,0 10.3695,0 C10.503,0 10.62,0.0530389908 10.7205,0.161983945 L11.841,1.21129587 C12.0525,1.43922018 12.0525,1.67144495 11.8425,1.89793578 L7.827,5.76118119 L6.0105,7.5 Z' id='Fill-3'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");\n}\n.venues-ui .venues-ui-button {\n  display: block;\n  width: 40px;\n  height: 40px;\n  line-height: 40px;\n  font-size: 16px;\n  font-weight: 600;\n  background-color: #fff;\n  border: none;\n  border-bottom: 1px solid #9FA2A6;\n  cursor: pointer;\n  overflow: hidden;\n  color: #6e737a;\n  text-align: center;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.venues-ui .venues-ui-button:hover, .venues-ui .venues-ui-button--active {\n  background-color: #f0f0f0;\n  color: #0F1621;\n}\n@keyframes fade {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n.venues-ui__drawings .drawings {\n  position: absolute;\n  top: 0;\n  right: 45px;\n  display: none;\n  opacity: 0;\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__drawings .drawings--open {\n  display: block;\n  opacity: 1;\n  animation: fade 1s;\n}\n.venues-ui__drawings .drawings .venues-ui-button {\n  width: auto;\n  padding: 0 10px;\n}\n.venues-ui__drawings .drawings .venues-ui-button:first-of-type {\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n}\n.venues-ui__drawings .drawings .venues-ui-button:last-of-type {\n  border-bottom-left-radius: 5px;\n  border-bottom-right-radius: 5px;\n}\n.venues-ui__drawings .trigger {\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__drawings .trigger .arrow {\n  transform: rotate(0);\n  transition: 0.4s;\n}\n.venues-ui__drawings .trigger.venues-ui-button--active .arrow {\n  transform: rotate(90deg);\n  transition: 0.4s;\n}\n.venues-ui__levels {\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__levels .levels {\n  overflow: hidden;\n}\n.venues-ui__levels .venues-ui-button--up + .levels .venues-ui-button {\n  border-radius: 0;\n}\n.venues-ui__levels .venues-ui-button:first-of-type {\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n}\n.venues-ui__levels .venues-ui-button:last-of-type {\n  border-bottom-left-radius: 5px;\n  border-bottom-right-radius: 5px;\n}\n.venues-ui__levels .venues-ui-button[disabled=disabled] .arrow {\n  opacity: 0.5;\n}\n.venues-ui__directory {\n  position: absolute;\n  top: 10px;\n  right: 60px;\n  bottom: calc(100% - 45px);\n  width: 350px;\n  overflow: hidden;\n  background: white;\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__directory.active {\n  bottom: 10px;\n}\n.venues-ui__directory .directory__list {\n  top: 80px;\n  bottom: 20px;\n  position: absolute;\n  overflow-y: scroll;\n  right: 10px;\n  left: 10px;\n  font-size: 12px;\n}\n.venues-ui__directory .directory__list svg {\n  width: 25px;\n  height: 25px;\n}\n.venues-ui__directory .directory__heading {\n  margin: 8px;\n  font-size: 15px;\n  font-weight: normal;\n  cursor: pointer;\n}\n.venues-ui__directory .directory__input {\n  margin: 10px;\n}\n.venues-ui__directory .directory__input input {\n  width: 100%;\n  padding: 5px 0;\n}\n.venues-ui__directory .directory__trigger {\n  position: absolute;\n  right: 10px;\n  top: 15px;\n  width: 10px;\n  height: 10px;\n}\n.venues-ui__directory .directory__trigger .arrow {\n  transform: rotate(0);\n  transition: 0.4s;\n}\n.venues-ui__directory .directory__trigger--active .arrow {\n  transform: rotate(-180deg);\n  transition: 0.4s;\n}"),e.Drawing=A,e.Geometry=L,e.Level=T,e.Provider=qt,e.Route=on,e.Service=an,e.Service2=sn,e.Venue=Zt,e.ui=cn,Object.defineProperty(e,"__esModule",{value:!0}),e}({});

H.__harp_worker_decoders__="/*! For license information please see mapsjs-harp-decoders.js.LICENSE.txt */\n(()=>{var __webpack_modules__={3577:(e,t,n)=>{\"use strict\";const i=n(5133);var r=n(5218),o=n(6918);o.util.Long=i,o.configure(),e.exports=r},5218:(e,t,n)=>{\"use strict\";var i,r,o,s=n(6918),a=s.Reader,l=s.util,c=s.roots.default||(s.roots.default={});c.com=((o={}).mapbox=((r={}).pb=((i={}).Tile=function(){function e(e){if(this.layers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t,n;return e.prototype.layers=l.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.com.mapbox.pb.Tile;e.pos<n;){var r=e.uint32();r>>>3==3?(i.layers&&i.layers.length||(i.layers=[]),i.layers.push(c.com.mapbox.pb.Tile.Layer.decode(e,e.uint32()))):e.skipType(7&r)}return i},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile)return e;var t=new c.com.mapbox.pb.Tile;if(e.layers){if(!Array.isArray(e.layers))throw TypeError(\".com.mapbox.pb.Tile.layers: array expected\");t.layers=[];for(var n=0;n<e.layers.length;++n){if(\"object\"!=typeof e.layers[n])throw TypeError(\".com.mapbox.pb.Tile.layers: object expected\");t.layers[n]=c.com.mapbox.pb.Tile.Layer.fromObject(e.layers[n])}}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.layers=[]),e.layers&&e.layers.length){n.layers=[];for(var i=0;i<e.layers.length;++i)n.layers[i]=c.com.mapbox.pb.Tile.Layer.toObject(e.layers[i],t)}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e.GeomType=(t={},(n=Object.create(t))[t[0]=\"UNKNOWN\"]=0,n[t[1]=\"POINT\"]=1,n[t[2]=\"LINESTRING\"]=2,n[t[3]=\"POLYGON\"]=3,n),e.Value=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.stringValue=\"\",e.prototype.floatValue=0,e.prototype.doubleValue=0,e.prototype.intValue=l.Long?l.Long.fromBits(0,0,!1):0,e.prototype.uintValue=l.Long?l.Long.fromBits(0,0,!0):0,e.prototype.sintValue=l.Long?l.Long.fromBits(0,0,!1):0,e.prototype.boolValue=!1,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.com.mapbox.pb.Tile.Value;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.stringValue=e.string();break;case 2:i.floatValue=e.float();break;case 3:i.doubleValue=e.double();break;case 4:i.intValue=e.int64();break;case 5:i.uintValue=e.uint64();break;case 6:i.sintValue=e.sint64();break;case 7:i.boolValue=e.bool();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Value)return e;var t=new c.com.mapbox.pb.Tile.Value;return null!=e.stringValue&&(t.stringValue=String(e.stringValue)),null!=e.floatValue&&(t.floatValue=Number(e.floatValue)),null!=e.doubleValue&&(t.doubleValue=Number(e.doubleValue)),null!=e.intValue&&(l.Long?(t.intValue=l.Long.fromValue(e.intValue)).unsigned=!1:\"string\"==typeof e.intValue?t.intValue=parseInt(e.intValue,10):\"number\"==typeof e.intValue?t.intValue=e.intValue:\"object\"==typeof e.intValue&&(t.intValue=new l.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber())),null!=e.uintValue&&(l.Long?(t.uintValue=l.Long.fromValue(e.uintValue)).unsigned=!0:\"string\"==typeof e.uintValue?t.uintValue=parseInt(e.uintValue,10):\"number\"==typeof e.uintValue?t.uintValue=e.uintValue:\"object\"==typeof e.uintValue&&(t.uintValue=new l.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0))),null!=e.sintValue&&(l.Long?(t.sintValue=l.Long.fromValue(e.sintValue)).unsigned=!1:\"string\"==typeof e.sintValue?t.sintValue=parseInt(e.sintValue,10):\"number\"==typeof e.sintValue?t.sintValue=e.sintValue:\"object\"==typeof e.sintValue&&(t.sintValue=new l.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber())),null!=e.boolValue&&(t.boolValue=Boolean(e.boolValue)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(n.stringValue=\"\",n.floatValue=0,n.doubleValue=0,l.Long){var i=new l.Long(0,0,!1);n.intValue=t.longs===String?i.toString():t.longs===Number?i.toNumber():i}else n.intValue=t.longs===String?\"0\":0;l.Long?(i=new l.Long(0,0,!0),n.uintValue=t.longs===String?i.toString():t.longs===Number?i.toNumber():i):n.uintValue=t.longs===String?\"0\":0,l.Long?(i=new l.Long(0,0,!1),n.sintValue=t.longs===String?i.toString():t.longs===Number?i.toNumber():i):n.sintValue=t.longs===String?\"0\":0,n.boolValue=!1}return null!=e.stringValue&&e.hasOwnProperty(\"stringValue\")&&(n.stringValue=e.stringValue),null!=e.floatValue&&e.hasOwnProperty(\"floatValue\")&&(n.floatValue=t.json&&!isFinite(e.floatValue)?String(e.floatValue):e.floatValue),null!=e.doubleValue&&e.hasOwnProperty(\"doubleValue\")&&(n.doubleValue=t.json&&!isFinite(e.doubleValue)?String(e.doubleValue):e.doubleValue),null!=e.intValue&&e.hasOwnProperty(\"intValue\")&&(\"number\"==typeof e.intValue?n.intValue=t.longs===String?String(e.intValue):e.intValue:n.intValue=t.longs===String?l.Long.prototype.toString.call(e.intValue):t.longs===Number?new l.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber():e.intValue),null!=e.uintValue&&e.hasOwnProperty(\"uintValue\")&&(\"number\"==typeof e.uintValue?n.uintValue=t.longs===String?String(e.uintValue):e.uintValue:n.uintValue=t.longs===String?l.Long.prototype.toString.call(e.uintValue):t.longs===Number?new l.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0):e.uintValue),null!=e.sintValue&&e.hasOwnProperty(\"sintValue\")&&(\"number\"==typeof e.sintValue?n.sintValue=t.longs===String?String(e.sintValue):e.sintValue:n.sintValue=t.longs===String?l.Long.prototype.toString.call(e.sintValue):t.longs===Number?new l.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber():e.sintValue),null!=e.boolValue&&e.hasOwnProperty(\"boolValue\")&&(n.boolValue=e.boolValue),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e}(),e.Feature=function(){function e(e){if(this.tags=[],this.geometry=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id=l.Long?l.Long.fromBits(0,0,!0):0,e.prototype.tags=l.emptyArray,e.prototype.type=0,e.prototype.geometry=l.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.com.mapbox.pb.Tile.Feature;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.id=e.uint64();break;case 2:if(i.tags&&i.tags.length||(i.tags=[]),2==(7&r))for(var o=e.uint32()+e.pos;e.pos<o;)i.tags.push(e.uint32());else i.tags.push(e.uint32());break;case 3:i.type=e.int32();break;case 4:if(i.geometry&&i.geometry.length||(i.geometry=[]),2==(7&r))for(o=e.uint32()+e.pos;e.pos<o;)i.geometry.push(e.uint32());else i.geometry.push(e.uint32());break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Feature)return e;var t=new c.com.mapbox.pb.Tile.Feature;if(null!=e.id&&(l.Long?(t.id=l.Long.fromValue(e.id)).unsigned=!0:\"string\"==typeof e.id?t.id=parseInt(e.id,10):\"number\"==typeof e.id?t.id=e.id:\"object\"==typeof e.id&&(t.id=new l.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0))),e.tags){if(!Array.isArray(e.tags))throw TypeError(\".com.mapbox.pb.Tile.Feature.tags: array expected\");t.tags=[];for(var n=0;n<e.tags.length;++n)t.tags[n]=e.tags[n]>>>0}switch(e.type){case\"UNKNOWN\":case 0:t.type=0;break;case\"POINT\":case 1:t.type=1;break;case\"LINESTRING\":case 2:t.type=2;break;case\"POLYGON\":case 3:t.type=3}if(e.geometry){if(!Array.isArray(e.geometry))throw TypeError(\".com.mapbox.pb.Tile.Feature.geometry: array expected\");for(t.geometry=[],n=0;n<e.geometry.length;++n)t.geometry[n]=e.geometry[n]>>>0}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.tags=[],n.geometry=[]),t.defaults){if(l.Long){var i=new l.Long(0,0,!0);n.id=t.longs===String?i.toString():t.longs===Number?i.toNumber():i}else n.id=t.longs===String?\"0\":0;n.type=t.enums===String?\"UNKNOWN\":0}if(null!=e.id&&e.hasOwnProperty(\"id\")&&(\"number\"==typeof e.id?n.id=t.longs===String?String(e.id):e.id:n.id=t.longs===String?l.Long.prototype.toString.call(e.id):t.longs===Number?new l.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0):e.id),e.tags&&e.tags.length){n.tags=[];for(var r=0;r<e.tags.length;++r)n.tags[r]=e.tags[r]}if(null!=e.type&&e.hasOwnProperty(\"type\")&&(n.type=t.enums===String?c.com.mapbox.pb.Tile.GeomType[e.type]:e.type),e.geometry&&e.geometry.length)for(n.geometry=[],r=0;r<e.geometry.length;++r)n.geometry[r]=e.geometry[r];return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e}(),e.Layer=function(){function e(e){if(this.features=[],this.keys=[],this.values=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.version=1,e.prototype.name=\"\",e.prototype.features=l.emptyArray,e.prototype.keys=l.emptyArray,e.prototype.values=l.emptyArray,e.prototype.extent=4096,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.com.mapbox.pb.Tile.Layer;e.pos<n;){var r=e.uint32();switch(r>>>3){case 15:i.version=e.uint32();break;case 1:i.name=e.string();break;case 2:i.features&&i.features.length||(i.features=[]),i.features.push(c.com.mapbox.pb.Tile.Feature.decode(e,e.uint32()));break;case 3:i.keys&&i.keys.length||(i.keys=[]),i.keys.push(e.string());break;case 4:i.values&&i.values.length||(i.values=[]),i.values.push(c.com.mapbox.pb.Tile.Value.decode(e,e.uint32()));break;case 5:i.extent=e.uint32();break;default:e.skipType(7&r)}}if(!i.hasOwnProperty(\"version\"))throw l.ProtocolError(\"missing required 'version'\",{instance:i});if(!i.hasOwnProperty(\"name\"))throw l.ProtocolError(\"missing required 'name'\",{instance:i});return i},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Layer)return e;var t=new c.com.mapbox.pb.Tile.Layer;if(null!=e.version&&(t.version=e.version>>>0),null!=e.name&&(t.name=String(e.name)),e.features){if(!Array.isArray(e.features))throw TypeError(\".com.mapbox.pb.Tile.Layer.features: array expected\");t.features=[];for(var n=0;n<e.features.length;++n){if(\"object\"!=typeof e.features[n])throw TypeError(\".com.mapbox.pb.Tile.Layer.features: object expected\");t.features[n]=c.com.mapbox.pb.Tile.Feature.fromObject(e.features[n])}}if(e.keys){if(!Array.isArray(e.keys))throw TypeError(\".com.mapbox.pb.Tile.Layer.keys: array expected\");for(t.keys=[],n=0;n<e.keys.length;++n)t.keys[n]=String(e.keys[n])}if(e.values){if(!Array.isArray(e.values))throw TypeError(\".com.mapbox.pb.Tile.Layer.values: array expected\");for(t.values=[],n=0;n<e.values.length;++n){if(\"object\"!=typeof e.values[n])throw TypeError(\".com.mapbox.pb.Tile.Layer.values: object expected\");t.values[n]=c.com.mapbox.pb.Tile.Value.fromObject(e.values[n])}}return null!=e.extent&&(t.extent=e.extent>>>0),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.features=[],n.keys=[],n.values=[]),t.defaults&&(n.name=\"\",n.extent=4096,n.version=1),null!=e.name&&e.hasOwnProperty(\"name\")&&(n.name=e.name),e.features&&e.features.length){n.features=[];for(var i=0;i<e.features.length;++i)n.features[i]=c.com.mapbox.pb.Tile.Feature.toObject(e.features[i],t)}if(e.keys&&e.keys.length)for(n.keys=[],i=0;i<e.keys.length;++i)n.keys[i]=e.keys[i];if(e.values&&e.values.length)for(n.values=[],i=0;i<e.values.length;++i)n.values[i]=c.com.mapbox.pb.Tile.Value.toObject(e.values[i],t);return null!=e.extent&&e.hasOwnProperty(\"extent\")&&(n.extent=e.extent),null!=e.version&&e.hasOwnProperty(\"version\")&&(n.version=e.version),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e}(),e}(),i),r),o),e.exports=c},7018:e=>{\"use strict\";e.exports=function(e,t){for(var n=new Array(arguments.length-1),i=0,r=2,o=!0;r<arguments.length;)n[i++]=arguments[r++];return new Promise((function(r,s){n[i]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];r.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,s(e))}}))}},2647:(e,t)=>{\"use strict\";var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&\"=\"===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var i=new Array(64),r=new Array(123),o=0;o<64;)r[i[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;n.encode=function(e,t,n){for(var r,o=null,s=[],a=0,l=0;t<n;){var c=e[t++];switch(l){case 0:s[a++]=i[c>>2],r=(3&c)<<4,l=1;break;case 1:s[a++]=i[r|c>>4],r=(15&c)<<2,l=2;break;case 2:s[a++]=i[r|c>>6],s[a++]=i[63&c],l=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return l&&(s[a++]=i[r],s[a++]=61,1===l&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join(\"\")):String.fromCharCode.apply(String,s.slice(0,a))};var s=\"invalid encoding\";n.decode=function(e,t,n){for(var i,o=n,a=0,l=0;l<e.length;){var c=e.charCodeAt(l++);if(61===c&&a>1)break;if(void 0===(c=r[c]))throw Error(s);switch(a){case 0:i=c,a=1;break;case 1:t[n++]=i<<2|(48&c)>>4,i=c,a=2;break;case 2:t[n++]=(15&i)<<4|(60&c)>>2,i=c,a=3;break;case 3:t[n++]=(3&i)<<6|c,a=0}}if(1===a)throw Error(s);return n-o},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},2922:e=>{\"use strict\";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this}},7955:e=>{\"use strict\";function t(e){return\"undefined\"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),i=128===n[3];function r(e,i,r){t[0]=e,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3]}function o(e,i,r){t[0]=e,i[r]=n[3],i[r+1]=n[2],i[r+2]=n[1],i[r+3]=n[0]}function s(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],t[0]}function a(e,i){return n[3]=e[i],n[2]=e[i+1],n[1]=e[i+2],n[0]=e[i+3],t[0]}e.writeFloatLE=i?r:o,e.writeFloatBE=i?o:r,e.readFloatLE=i?s:a,e.readFloatBE=i?a:s}():function(){function t(e,t,n,i){var r=t<0?1:0;if(r&&(t=-t),0===t)e(1/t>0?0:2147483648,n,i);else if(isNaN(t))e(2143289344,n,i);else if(t>34028234663852886e22)e((r<<31|2139095040)>>>0,n,i);else if(t<11754943508222875e-54)e((r<<31|Math.round(t/1401298464324817e-60))>>>0,n,i);else{var o=Math.floor(Math.log(t)/Math.LN2);e((r<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,i)}}function s(e,t,n){var i=e(t,n),r=2*(i>>31)+1,o=i>>>23&255,s=8388607&i;return 255===o?s?NaN:r*(1/0):0===o?1401298464324817e-60*r*s:r*Math.pow(2,o-150)*(s+8388608)}e.writeFloatLE=t.bind(null,n),e.writeFloatBE=t.bind(null,i),e.readFloatLE=s.bind(null,r),e.readFloatBE=s.bind(null,o)}(),\"undefined\"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),i=128===n[7];function r(e,i,r){t[0]=e,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3],i[r+4]=n[4],i[r+5]=n[5],i[r+6]=n[6],i[r+7]=n[7]}function o(e,i,r){t[0]=e,i[r]=n[7],i[r+1]=n[6],i[r+2]=n[5],i[r+3]=n[4],i[r+4]=n[3],i[r+5]=n[2],i[r+6]=n[1],i[r+7]=n[0]}function s(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],n[4]=e[i+4],n[5]=e[i+5],n[6]=e[i+6],n[7]=e[i+7],t[0]}function a(e,i){return n[7]=e[i],n[6]=e[i+1],n[5]=e[i+2],n[4]=e[i+3],n[3]=e[i+4],n[2]=e[i+5],n[1]=e[i+6],n[0]=e[i+7],t[0]}e.writeDoubleLE=i?r:o,e.writeDoubleBE=i?o:r,e.readDoubleLE=i?s:a,e.readDoubleBE=i?a:s}():function(){function t(e,t,n,i,r,o){var s=i<0?1:0;if(s&&(i=-i),0===i)e(0,r,o+t),e(1/i>0?0:2147483648,r,o+n);else if(isNaN(i))e(0,r,o+t),e(2146959360,r,o+n);else if(i>17976931348623157e292)e(0,r,o+t),e((s<<31|2146435072)>>>0,r,o+n);else{var a;if(i<22250738585072014e-324)e((a=i/5e-324)>>>0,r,o+t),e((s<<31|a/4294967296)>>>0,r,o+n);else{var l=Math.floor(Math.log(i)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(a=i*Math.pow(2,-l))>>>0,r,o+t),e((s<<31|l+1023<<20|1048576*a&1048575)>>>0,r,o+n)}}}function s(e,t,n,i,r){var o=e(i,r+t),s=e(i,r+n),a=2*(s>>31)+1,l=s>>>20&2047,c=4294967296*(1048575&s)+o;return 2047===l?c?NaN:a*(1/0):0===l?5e-324*a*c:a*Math.pow(2,l-1075)*(c+4503599627370496)}e.writeDoubleLE=t.bind(null,n,0,4),e.writeDoubleBE=t.bind(null,i,4,0),e.readDoubleLE=s.bind(null,r,0,4),e.readDoubleBE=s.bind(null,o,4,0)}(),e}function n(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function i(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function r(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function o(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},8446:module=>{\"use strict\";function inquire(moduleName){try{var mod=eval(\"quire\".replace(/^/,\"re\"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},5374:e=>{\"use strict\";e.exports=function(e,t,n){var i=n||8192,r=i>>>1,o=null,s=i;return function(n){if(n<1||n>r)return e(n);s+n>i&&(o=e(i),s=0);var a=t.call(o,s,s+=n);return 7&s&&(s=1+(7|s)),a}}},5226:(e,t)=>{\"use strict\";var n=t;n.length=function(e){for(var t=0,n=0,i=0;i<e.length;++i)(n=e.charCodeAt(i))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(i+1))?(++i,t+=4):t+=3;return t},n.read=function(e,t,n){if(n-t<1)return\"\";for(var i,r=null,o=[],s=0;t<n;)(i=e[t++])<128?o[s++]=i:i>191&&i<224?o[s++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(i>>10),o[s++]=56320+(1023&i)):o[s++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,o)),s=0);return r?(s&&r.push(String.fromCharCode.apply(String,o.slice(0,s))),r.join(\"\")):String.fromCharCode.apply(String,o.slice(0,s))},n.write=function(e,t,n){for(var i,r,o=n,s=0;s<e.length;++s)(i=e.charCodeAt(s))<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&56320==(64512&(r=e.charCodeAt(s+1)))?(i=65536+((1023&i)<<10)+(1023&r),++s,t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128);return n-o}},6925:(e,t)=>{var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(e){return(e=Math.round(e))<0?0:e>255?255:e}function r(e){return e<0?0:e>1?1:e}function o(e){return\"%\"===e[e.length-1]?i(parseFloat(e)/100*255):i(parseInt(e))}function s(e){return\"%\"===e[e.length-1]?r(parseFloat(e)/100):r(parseFloat(e))}function a(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{t.parseCSSColor=function(e){var t,r=e.replace(/ /g,\"\").toLowerCase();if(r in n)return n[r].slice();if(\"#\"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=r.indexOf(\"(\"),c=r.indexOf(\")\");if(-1!==l&&c+1===r.length){var u=r.substr(0,l),h=r.substr(l+1,c-(l+1)).split(\",\"),d=1;switch(u){case\"rgba\":if(4!==h.length)return null;d=s(h.pop());case\"rgb\":return 3!==h.length?null:[o(h[0]),o(h[1]),o(h[2]),d];case\"hsla\":if(4!==h.length)return null;d=s(h.pop());case\"hsl\":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,f=s(h[1]),m=s(h[2]),g=m<=.5?m*(f+1):m+f-m*f,v=2*m-g;return[i(255*a(v,g,p+1/3)),i(255*a(v,g,p)),i(255*a(v,g,p-1/3)),d];default:return null}}return null}}catch(e){}},1874:e=>{\"use strict\";function t(e,t,o){o=o||2;var s,a,l,h,d,f,m,g=t&&t.length,v=g?t[0]*o:e.length,y=n(e,0,v,o,!0),x=[];if(!y||y.next===y.prev)return x;if(g&&(y=function(e,t,r,o){var s,a,l,h=[];for(s=0,a=t.length;s<a;s++)(l=n(e,t[s]*o,s<a-1?t[s+1]*o:e.length,o,!1))===l.next&&(l.steiner=!0),h.push(p(l));for(h.sort(c),s=0;s<h.length;s++)u(h[s],r),r=i(r,r.next);return r}(e,t,y,o)),e.length>80*o){s=l=e[0],a=h=e[1];for(var _=o;_<v;_+=o)(d=e[_])<s&&(s=d),(f=e[_+1])<a&&(a=f),d>l&&(l=d),f>h&&(h=f);m=0!==(m=Math.max(l-s,h-a))?1/m:0}return r(y,x,o,s,a,m),x}function n(e,t,n,i,r){var o,s;if(r===T(e,t,n,i)>0)for(o=t;o<n;o+=i)s=M(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=M(o,e[o],e[o+1],s);return s&&v(s,s.next)&&(S(s),s=s.next),s}function i(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!v(i,i.next)&&0!==g(i.prev,i,i.next))i=i.next;else{if(S(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function r(e,t,n,c,u,h,p){if(e){!p&&h&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=d(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(e,c,u,h);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?s(e,c,u,h):o(e))t.push(f.i/n),t.push(e.i/n),t.push(m.i/n),S(e),e=m.next,g=m.next;else if((e=m)===g){p?1===p?r(e=a(i(e),t,n),t,n,c,u,h,2):2===p&&l(e,t,n,c,u,h):r(i(e),t,n,c,u,h,1);break}}}function o(e){var t=e.prev,n=e,i=e.next;if(g(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(f(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&g(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function s(e,t,n,i){var r=e.prev,o=e,s=e.next;if(g(r,o,s)>=0)return!1;for(var a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,l=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,c=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,u=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,h=d(a,l,t,n,i),p=d(c,u,t,n,i),m=e.prevZ,v=e.nextZ;m&&m.z>=h&&v&&v.z<=p;){if(m!==e.prev&&m!==e.next&&f(r.x,r.y,o.x,o.y,s.x,s.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,v!==e.prev&&v!==e.next&&f(r.x,r.y,o.x,o.y,s.x,s.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;m&&m.z>=h;){if(m!==e.prev&&m!==e.next&&f(r.x,r.y,o.x,o.y,s.x,s.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;v&&v.z<=p;){if(v!==e.prev&&v!==e.next&&f(r.x,r.y,o.x,o.y,s.x,s.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function a(e,t,n){var r=e;do{var o=r.prev,s=r.next.next;!v(o,s)&&y(o,r,r.next,s)&&b(o,s)&&b(s,o)&&(t.push(o.i/n),t.push(r.i/n),t.push(s.i/n),S(r),S(r.next),r=e=s),r=r.next}while(r!==e);return i(r)}function l(e,t,n,o,s,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&m(l,c)){var u=w(l,c);return l=i(l,l.next),u=i(u,u.next),r(l,t,n,o,s,a),void r(u,t,n,o,s,a)}c=c.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function u(e,t){if(t=function(e,t){var n,i=t,r=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s){if(s=a,a===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===s)return n;var l,c=n,u=n.x,d=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&f(o<d?r:s,o,u,d,o<d?s:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),b(i,e)&&(l<p||l===p&&(i.x>n.x||i.x===n.x&&h(n,i)))&&(n=i,p=l)),i=i.next}while(i!==c);return n}(e,t),t){var n=w(t,e);i(t,t.next),i(n,n.next)}}function h(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function d(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function f(e,t,n,i,r,o,s,a){return(r-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(i-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(r-s)*(i-a)>=0}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(b(e,t)&&b(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||v(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,i){var r=_(g(e,t,n)),o=_(g(e,t,i)),s=_(g(n,i,e)),a=_(g(n,i,t));return r!==o&&s!==a||!(0!==r||!x(e,n,t))||!(0!==o||!x(e,i,t))||!(0!==s||!x(n,e,i))||!(0!==a||!x(n,t,i))}function x(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function _(e){return e>0?1:e<0?-1:0}function b(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function w(e,t){var n=new E(e.i,e.x,e.y),i=new E(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function M(e,t,n,i){var r=new E(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(e,t,n,i){for(var r=0,o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,i){var r=t&&t.length,o=r?t[0]*n:e.length,s=Math.abs(T(e,0,o,n));if(r)for(var a=0,l=t.length;a<l;a++){var c=t[a]*n,u=a<l-1?t[a+1]*n:e.length;s-=Math.abs(T(e,c,u,n))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*n,p=i[a+1]*n,f=i[a+2]*n;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[r][o][s]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n}},242:(e,t,n)=>{\"use strict\";function i(e,t,n,o){for(var s,a=o,l=n-t>>1,c=n-t,u=e[t],h=e[t+1],d=e[n],p=e[n+1],f=t+3;f<n;f+=3){var m=r(e[f],e[f+1],u,h,d,p);if(m>a)s=f,a=m;else if(m===a){var g=Math.abs(f-l);g<c&&(s=f,c=g)}}a>o&&(s-t>3&&i(e,t,s,o),e[s+2]=a,n-s>3&&i(e,s,n,o))}function r(e,t,n,i,r,o){var s=r-n,a=o-i;if(0!==s||0!==a){var l=((e-n)*s+(t-i)*a)/(s*s+a*a);l>1?(n=r,i=o):l>0&&(n+=s*l,i+=a*l)}return(s=e-n)*s+(a=t-i)*a}function o(e,t,n,i){var r={id:void 0===e?null:e,type:t,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if(\"Point\"===n||\"MultiPoint\"===n||\"LineString\"===n)s(e,t);else if(\"Polygon\"===n||\"MultiLineString\"===n)for(var i=0;i<t.length;i++)s(e,t[i]);else if(\"MultiPolygon\"===n)for(i=0;i<t.length;i++)for(var r=0;r<t[i].length;r++)s(e,t[i][r])}(r),r}function s(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function a(e,t,n,i){if(t.geometry){var r=t.geometry.coordinates,s=t.geometry.type,h=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),d=[],p=t.id;if(n.promoteId?p=t.properties[n.promoteId]:n.generateId&&(p=i||0),\"Point\"===s)l(r,d);else if(\"MultiPoint\"===s)for(var f=0;f<r.length;f++)l(r[f],d);else if(\"LineString\"===s)c(r,d,h,!1);else if(\"MultiLineString\"===s){if(n.lineMetrics){for(f=0;f<r.length;f++)d=[],c(r[f],d,h,!1),e.push(o(p,\"LineString\",d,t.properties));return}u(r,d,h,!1)}else if(\"Polygon\"===s)u(r,d,h,!0);else{if(\"MultiPolygon\"!==s){if(\"GeometryCollection\"===s){for(f=0;f<t.geometry.geometries.length;f++)a(e,{id:p,geometry:t.geometry.geometries[f],properties:t.properties},n,i);return}throw new Error(\"Input data is not a valid GeoJSON object.\")}for(f=0;f<r.length;f++){var m=[];u(r[f],m,h,!0),d.push(m)}}e.push(o(p,s,d,t.properties))}}function l(e,t){t.push(h(e[0])),t.push(d(e[1])),t.push(0)}function c(e,t,n,r){for(var o,s,a=0,l=0;l<e.length;l++){var c=h(e[l][0]),u=d(e[l][1]);t.push(c),t.push(u),t.push(0),l>0&&(a+=r?(o*u-c*s)/2:Math.sqrt(Math.pow(c-o,2)+Math.pow(u-s,2))),o=c,s=u}var p=t.length-3;t[2]=1,i(t,0,p,n),t[p+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function u(e,t,n,i){for(var r=0;r<e.length;r++){var o=[];c(e[r],o,n,i),t.push(o)}}function h(e){return e/360+.5}function d(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function p(e,t,n,i,r,s,a,l){if(i/=t,s>=(n/=t)&&a<i)return e;if(a<n||s>=i)return null;for(var c=[],u=0;u<e.length;u++){var h=e[u],d=h.geometry,p=h.type,g=0===r?h.minX:h.minY,y=0===r?h.maxX:h.maxY;if(g>=n&&y<i)c.push(h);else if(!(y<n||g>=i)){var x=[];if(\"Point\"===p||\"MultiPoint\"===p)f(d,x,n,i,r);else if(\"LineString\"===p)m(d,x,n,i,r,!1,l.lineMetrics);else if(\"MultiLineString\"===p)v(d,x,n,i,r,!1);else if(\"Polygon\"===p)v(d,x,n,i,r,!0);else if(\"MultiPolygon\"===p)for(var _=0;_<d.length;_++){var b=[];v(d[_],b,n,i,r,!0),b.length&&x.push(b)}if(x.length){if(l.lineMetrics&&\"LineString\"===p){for(_=0;_<x.length;_++)c.push(o(h.id,p,x[_],h.tags));continue}\"LineString\"!==p&&\"MultiLineString\"!==p||(1===x.length?(p=\"LineString\",x=x[0]):p=\"MultiLineString\"),\"Point\"!==p&&\"MultiPoint\"!==p||(p=3===x.length?\"Point\":\"MultiPoint\"),c.push(o(h.id,p,x,h.tags))}}}return c.length?c:null}function f(e,t,n,i,r){for(var o=0;o<e.length;o+=3){var s=e[o+r];s>=n&&s<=i&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function m(e,t,n,i,r,o,s){for(var a,l,c=g(e),u=0===r?x:_,h=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],m=e[d+2],v=e[d+3],b=e[d+4],w=0===r?p:f,M=0===r?v:b,S=!1;s&&(a=Math.sqrt(Math.pow(p-v,2)+Math.pow(f-b,2))),w<n?M>n&&(l=u(c,p,f,v,b,n),s&&(c.start=h+a*l)):w>i?M<i&&(l=u(c,p,f,v,b,i),s&&(c.start=h+a*l)):y(c,p,f,m),M<n&&w>=n&&(l=u(c,p,f,v,b,n),S=!0),M>i&&w<=i&&(l=u(c,p,f,v,b,i),S=!0),!o&&S&&(s&&(c.end=h+a*l),t.push(c),c=g(e)),s&&(h+=a)}var E=e.length-3;p=e[E],f=e[E+1],m=e[E+2],(w=0===r?p:f)>=n&&w<=i&&y(c,p,f,m),E=c.length-3,o&&E>=3&&(c[E]!==c[0]||c[E+1]!==c[1])&&y(c,c[0],c[1],c[2]),c.length&&t.push(c)}function g(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function v(e,t,n,i,r,o){for(var s=0;s<e.length;s++)m(e[s],t,n,i,r,o,!1)}function y(e,t,n,i){e.push(t),e.push(n),e.push(i)}function x(e,t,n,i,r,o){var s=(o-t)/(i-t);return e.push(o),e.push(n+(r-n)*s),e.push(1),s}function _(e,t,n,i,r,o){var s=(o-n)/(r-n);return e.push(t+(i-t)*s),e.push(o),e.push(1),s}function b(e,t){for(var n=[],i=0;i<e.length;i++){var r,s=e[i],a=s.type;if(\"Point\"===a||\"MultiPoint\"===a||\"LineString\"===a)r=w(s.geometry,t);else if(\"MultiLineString\"===a||\"Polygon\"===a){r=[];for(var l=0;l<s.geometry.length;l++)r.push(w(s.geometry[l],t))}else if(\"MultiPolygon\"===a)for(r=[],l=0;l<s.geometry.length;l++){for(var c=[],u=0;u<s.geometry[l].length;u++)c.push(w(s.geometry[l][u],t));r.push(c)}n.push(o(s.id,a,r,s.tags))}return n}function w(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var i=0;i<e.length;i+=3)n.push(e[i]+t,e[i+1],e[i+2]);return n}function M(e,t){if(e.transformed)return e;var n,i,r,o=1<<e.z,s=e.x,a=e.y;for(n=0;n<e.features.length;n++){var l=e.features[n],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(i=0;i<c.length;i+=2)l.geometry.push(S(c[i],c[i+1],t,o,s,a));else for(i=0;i<c.length;i++){var h=[];for(r=0;r<c[i].length;r+=2)h.push(S(c[i][r],c[i][r+1],t,o,s,a));l.geometry.push(h)}}return e.transformed=!0,e}function S(e,t,n,i,r,o){return[Math.round(n*(e*i-r)),Math.round(n*(t*i-o))]}function E(e,t,n,i,r){for(var o=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,T(s,e[a],o,r);var l=e[a].minX,c=e[a].minY,u=e[a].maxX,h=e[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function T(e,t,n,i){var r=t.geometry,o=t.type,s=[];if(\"Point\"===o||\"MultiPoint\"===o)for(var a=0;a<r.length;a+=3)s.push(r[a]),s.push(r[a+1]),e.numPoints++,e.numSimplified++;else if(\"LineString\"===o)A(s,r,e,n,!1,!1);else if(\"MultiLineString\"===o||\"Polygon\"===o)for(a=0;a<r.length;a++)A(s,r[a],e,n,\"Polygon\"===o,0===a);else if(\"MultiPolygon\"===o)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)A(s,c[a],e,n,!0,0===a)}if(s.length){var u=t.tags||null;if(\"LineString\"===o&&i.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:s,type:\"Polygon\"===o||\"MultiPolygon\"===o?3:\"LineString\"===o||\"MultiLineString\"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function A(e,t,n,i,r,o){var s=i*i;if(i>0&&t.size<(r?s:i))n.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===i||t[l+2]>s)&&(n.numSimplified++,a.push(t[l]),a.push(t[l+1])),n.numPoints++;r&&function(e,t){for(var n=0,i=0,r=e.length,o=r-2;i<r;o=i,i+=2)n+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(n>0===t)for(i=0,r=e.length;i<r/2;i+=2){var s=e[i],a=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=s,e[r-1-i]=a}}(a,o),e.push(a)}}function L(e,t){return new C(e,t)}function C(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time(\"preprocess data\"),t.maxZoom<0||t.maxZoom>24)throw new Error(\"maxZoom should be in the 0-24 range\");if(t.promoteId&&t.generateId)throw new Error(\"promoteId and generateId cannot be used together.\");var i=function(e,t){var n=[];if(\"FeatureCollection\"===e.type)for(var i=0;i<e.features.length;i++)a(n,e.features[i],t,i);else\"Feature\"===e.type?a(n,e,t):a(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd(\"preprocess data\"),console.log(\"index: maxZoom: %d, maxPoints: %d\",t.indexMaxZoom,t.indexMaxPoints),console.time(\"generate tiles\"),this.stats={},this.total=0),i=function(e,t){var n=t.buffer/t.extent,i=e,r=p(e,1,-1-n,n,0,-1,2,t),o=p(e,1,1-n,2+n,0,-1,2,t);return(r||o)&&(i=p(e,1,-n,1+n,0,-1,2,t)||[],r&&(i=b(r,1).concat(i)),o&&(i=i.concat(b(o,-1)))),i}(i,t),i.length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log(\"features: %d, points: %d\",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd(\"generate tiles\"),console.log(\"tiles generated:\",this.total,JSON.stringify(this.stats)))}function P(e,t,n){return 32*((1<<e)*n+t)+e}n.r(t),n.d(t,{default:()=>L}),C.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},C.prototype.splitTile=function(e,t,n,i,r,o,s){for(var a=[e,t,n,i],l=this.options,c=l.debug;a.length;){i=a.pop(),n=a.pop(),t=a.pop(),e=a.pop();var u=1<<t,h=P(t,n,i),d=this.tiles[h];if(!d&&(c>1&&console.time(\"creation\"),d=this.tiles[h]=E(e,t,n,i,l),this.tileCoords.push({z:t,x:n,y:i}),c)){c>1&&(console.log(\"tile z%d-%d-%d (features: %d, points: %d, simplified: %d)\",t,n,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd(\"creation\"));var f=\"z\"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(d.source=e,r){if(t===l.maxZoom||t===r)continue;var m=1<<r-t;if(n!==Math.floor(o/m)||i!==Math.floor(s/m))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==e.length){c>1&&console.time(\"clipping\");var g,v,y,x,_,b,w=.5*l.buffer/l.extent,M=.5-w,S=.5+w,T=1+w;g=v=y=x=null,_=p(e,u,n-w,n+S,0,d.minX,d.maxX,l),b=p(e,u,n+M,n+T,0,d.minX,d.maxX,l),e=null,_&&(g=p(_,u,i-w,i+S,1,d.minY,d.maxY,l),v=p(_,u,i+M,i+T,1,d.minY,d.maxY,l),_=null),b&&(y=p(b,u,i-w,i+S,1,d.minY,d.maxY,l),x=p(b,u,i+M,i+T,1,d.minY,d.maxY,l),b=null),c>1&&console.timeEnd(\"clipping\"),a.push(g||[],t+1,2*n,2*i),a.push(v||[],t+1,2*n,2*i+1),a.push(y||[],t+1,2*n+1,2*i),a.push(x||[],t+1,2*n+1,2*i+1)}}},C.prototype.getTile=function(e,t,n){var i=this.options,r=i.extent,o=i.debug;if(e<0||e>24)return null;var s=1<<e,a=P(e,t=(t%s+s)%s,n);if(this.tiles[a])return M(this.tiles[a],r);o>1&&console.log(\"drilling down to z%d-%d-%d\",e,t,n);for(var l,c=e,u=t,h=n;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[P(c,u,h)];return l&&l.source?(o>1&&console.log(\"found parent tile z%d-%d-%d\",c,u,h),o>1&&console.time(\"drilling down\"),this.splitTile(l.source,c,u,h,e,t,n),o>1&&console.timeEnd(\"drilling down\"),this.tiles[a]?M(this.tiles[a],r):null):null}},5133:e=>{e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function i(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,\"__isLong__\",{value:!0}),n.isLong=i;var r={},o={};function s(e,t){var n,i,s;return t?(s=0<=(e>>>=0)&&e<256)&&(i=o[e])?i:(n=l(e,(0|e)<0?-1:0,!0),s&&(o[e]=n),n):(s=-128<=(e|=0)&&e<128)&&(i=r[e])?i:(n=l(e,e<0?-1:0,!1),s&&(r[e]=n),n)}function a(e,t){if(isNaN(e))return t?v:g;if(t){if(e<0)return v;if(e>=p)return w}else{if(e<=-f)return M;if(e+1>=f)return b}return e<0?a(-e,t).neg():l(e%d|0,e/d|0,t)}function l(e,t,i){return new n(e,t,i)}n.fromInt=s,n.fromNumber=a,n.fromBits=l;var c=Math.pow;function u(e,t,n){if(0===e.length)throw Error(\"empty string\");if(\"NaN\"===e||\"Infinity\"===e||\"+Infinity\"===e||\"-Infinity\"===e)return g;if(\"number\"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError(\"radix\");var i;if((i=e.indexOf(\"-\"))>0)throw Error(\"interior hyphen\");if(0===i)return u(e.substring(1),t,n).neg();for(var r=a(c(n,8)),o=g,s=0;s<e.length;s+=8){var l=Math.min(8,e.length-s),h=parseInt(e.substring(s,s+l),n);if(l<8){var d=a(c(n,l));o=o.mul(d).add(a(h))}else o=(o=o.mul(r)).add(a(h))}return o.unsigned=t,o}function h(e,t){return\"number\"==typeof e?a(e,t):\"string\"==typeof e?u(e,t):l(e.low,e.high,\"boolean\"==typeof t?t:e.unsigned)}n.fromString=u,n.fromValue=h;var d=4294967296,p=d*d,f=p/2,m=s(1<<24),g=s(0);n.ZERO=g;var v=s(0,!0);n.UZERO=v;var y=s(1);n.ONE=y;var x=s(1,!0);n.UONE=x;var _=s(-1);n.NEG_ONE=_;var b=l(-1,2147483647,!1);n.MAX_VALUE=b;var w=l(-1,-1,!0);n.MAX_UNSIGNED_VALUE=w;var M=l(0,-2147483648,!1);n.MIN_VALUE=M;var S=n.prototype;S.toInt=function(){return this.unsigned?this.low>>>0:this.low},S.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},S.toString=function(e){if((e=e||10)<2||36<e)throw RangeError(\"radix\");if(this.isZero())return\"0\";if(this.isNegative()){if(this.eq(M)){var t=a(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}return\"-\"+this.neg().toString(e)}for(var r=a(c(e,6),this.unsigned),o=this,s=\"\";;){var l=o.div(r),u=(o.sub(l.mul(r)).toInt()>>>0).toString(e);if((o=l).isZero())return u+s;for(;u.length<6;)u=\"0\"+u;s=\"\"+u+s}},S.getHighBits=function(){return this.high},S.getHighBitsUnsigned=function(){return this.high>>>0},S.getLowBits=function(){return this.low},S.getLowBitsUnsigned=function(){return this.low>>>0},S.getNumBitsAbs=function(){if(this.isNegative())return this.eq(M)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},S.isZero=function(){return 0===this.high&&0===this.low},S.eqz=S.isZero,S.isNegative=function(){return!this.unsigned&&this.high<0},S.isPositive=function(){return this.unsigned||this.high>=0},S.isOdd=function(){return 1==(1&this.low)},S.isEven=function(){return 0==(1&this.low)},S.equals=function(e){return i(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},S.eq=S.equals,S.notEquals=function(e){return!this.eq(e)},S.neq=S.notEquals,S.ne=S.notEquals,S.lessThan=function(e){return this.comp(e)<0},S.lt=S.lessThan,S.lessThanOrEqual=function(e){return this.comp(e)<=0},S.lte=S.lessThanOrEqual,S.le=S.lessThanOrEqual,S.greaterThan=function(e){return this.comp(e)>0},S.gt=S.greaterThan,S.greaterThanOrEqual=function(e){return this.comp(e)>=0},S.gte=S.greaterThanOrEqual,S.ge=S.greaterThanOrEqual,S.compare=function(e){if(i(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},S.comp=S.compare,S.negate=function(){return!this.unsigned&&this.eq(M)?M:this.not().add(y)},S.neg=S.negate,S.add=function(e){i(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,o=65535&this.low,s=e.high>>>16,a=65535&e.high,c=e.low>>>16,u=0,d=0,p=0,f=0;return p+=(f+=o+(65535&e.low))>>>16,d+=(p+=r+c)>>>16,u+=(d+=n+a)>>>16,u+=t+s,l((p&=65535)<<16|(f&=65535),(u&=65535)<<16|(d&=65535),this.unsigned)},S.subtract=function(e){return i(e)||(e=h(e)),this.add(e.neg())},S.sub=S.subtract,S.multiply=function(e){if(this.isZero())return g;if(i(e)||(e=h(e)),t)return l(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return g;if(this.eq(M))return e.isOdd()?M:g;if(e.eq(M))return this.isOdd()?M:g;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(m)&&e.lt(m))return a(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,r=65535&this.high,o=this.low>>>16,s=65535&this.low,c=e.high>>>16,u=65535&e.high,d=e.low>>>16,p=65535&e.low,f=0,v=0,y=0,x=0;return y+=(x+=s*p)>>>16,v+=(y+=o*p)>>>16,y&=65535,v+=(y+=s*d)>>>16,f+=(v+=r*p)>>>16,v&=65535,f+=(v+=o*d)>>>16,v&=65535,f+=(v+=s*u)>>>16,f+=n*p+r*d+o*u+s*c,l((y&=65535)<<16|(x&=65535),(f&=65535)<<16|(v&=65535),this.unsigned)},S.mul=S.multiply,S.divide=function(e){if(i(e)||(e=h(e)),e.isZero())throw Error(\"division by zero\");var n,r,o;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?v:g;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return x;o=v}else{if(this.eq(M))return e.eq(y)||e.eq(_)?M:e.eq(M)?y:(n=this.shr(1).div(e).shl(1)).eq(g)?e.isNegative()?y:_:(r=this.sub(e.mul(n)),o=n.add(r.div(e)));if(e.eq(M))return this.unsigned?v:g;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=g}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:c(2,s-48),d=a(n),p=d.mul(e);p.isNegative()||p.gt(r);)p=(d=a(n-=u,this.unsigned)).mul(e);d.isZero()&&(d=y),o=o.add(d),r=r.sub(p)}return o},S.div=S.divide,S.modulo=function(e){return i(e)||(e=h(e)),t?l((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},S.mod=S.modulo,S.rem=S.modulo,S.not=function(){return l(~this.low,~this.high,this.unsigned)},S.and=function(e){return i(e)||(e=h(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},S.or=function(e){return i(e)||(e=h(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},S.xor=function(e){return i(e)||(e=h(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},S.shiftLeft=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},S.shl=S.shiftLeft,S.shiftRight=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},S.shr=S.shiftRight,S.shiftRightUnsigned=function(e){if(i(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?l(this.low>>>e|t<<32-e,t>>>e,this.unsigned):l(32===e?t:t>>>e-32,0,this.unsigned)},S.shru=S.shiftRightUnsigned,S.shr_u=S.shiftRightUnsigned,S.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},S.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},S.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},S.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},S.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,i){return i?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},6918:(e,t,n)=>{\"use strict\";e.exports=n(3729)},3729:(e,t,n)=>{\"use strict\";var i=t;function r(){i.util._configure(),i.Writer._configure(i.BufferWriter),i.Reader._configure(i.BufferReader)}i.build=\"minimal\",i.Writer=n(8116),i.BufferWriter=n(1819),i.Reader=n(2461),i.BufferReader=n(9117),i.util=n(1679),i.rpc=n(8082),i.roots=n(575),i.configure=r,r()},2461:(e,t,n)=>{\"use strict\";e.exports=l;var i,r=n(1679),o=r.LongBits,s=r.utf8;function a(e,t){return RangeError(\"index out of range: \"+e.pos+\" + \"+(t||1)+\" > \"+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var c,u=\"undefined\"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error(\"illegal buffer\")}:function(e){if(Array.isArray(e))return new l(e);throw Error(\"illegal buffer\")},h=function(){return r.Buffer?function(e){return(l.create=function(e){return r.Buffer.isBuffer(e)?new i(e):u(e)})(e)}:u};function d(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error(\"invalid varint encoding\")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new o(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}l.create=h(),l.prototype._slice=r.Array.prototype.subarray||r.Array.prototype.slice,l.prototype.uint32=(c=4294967295,function(){if(c=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return c;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return c}),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=r.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=r.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},l.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},l.prototype.skip=function(e){if(\"number\"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(\"invalid wire type \"+e+\" at offset \"+this.pos)}return this},l._configure=function(e){i=e,l.create=h(),i._configure();var t=r.Long?\"toLong\":\"toNumber\";r.merge(l.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},9117:(e,t,n)=>{\"use strict\";e.exports=o;var i=n(2461);(o.prototype=Object.create(i.prototype)).constructor=o;var r=n(1679);function o(e){i.call(this,e)}o._configure=function(){r.Buffer&&(o.prototype._slice=r.Buffer.prototype.slice)},o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString(\"utf-8\",this.pos,this.pos=Math.min(this.pos+e,this.len))},o._configure()},575:e=>{\"use strict\";e.exports={}},8082:(e,t,n)=>{\"use strict\";t.Service=n(7927)},7927:(e,t,n)=>{\"use strict\";e.exports=r;var i=n(1679);function r(e,t,n){if(\"function\"!=typeof e)throw TypeError(\"rpcImpl must be a function\");i.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(r.prototype=Object.create(i.EventEmitter.prototype)).constructor=r,r.prototype.rpcCall=function e(t,n,r,o,s){if(!o)throw TypeError(\"request must be specified\");var a=this;if(!s)return i.asPromise(e,a,t,n,r,o);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?\"encodeDelimited\":\"encode\"](o).finish(),(function(e,n){if(e)return a.emit(\"error\",e,t),s(e);if(null!==n){if(!(n instanceof r))try{n=r[a.responseDelimited?\"decodeDelimited\":\"decode\"](n)}catch(e){return a.emit(\"error\",e,t),s(e)}return a.emit(\"data\",n,t),s(null,n)}a.end(!0)}))}catch(e){return a.emit(\"error\",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error(\"already ended\"))}),0)},r.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit(\"end\").off()),this}},8294:(e,t,n)=>{\"use strict\";e.exports=r;var i=n(1679);function r(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=r.zero=new r(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var s=r.zeroHash=\"\\0\\0\\0\\0\\0\\0\\0\\0\";r.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new r(n,i)},r.from=function(e){if(\"number\"==typeof e)return r.fromNumber(e);if(i.isString(e)){if(!i.Long)return r.fromNumber(parseInt(e,10));e=i.Long.fromString(e)}return e.low||e.high?new r(e.low>>>0,e.high>>>0):o},r.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},r.prototype.toLong=function(e){return i.Long?new i.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;r.fromHash=function(e){return e===s?o:new r((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},r.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},r.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},r.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},r.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},1679:function(e,t,n){\"use strict\";var i=t;function r(e,t,n){for(var i=Object.keys(t),r=0;r<i.length;++r)void 0!==e[i[r]]&&n||(e[i[r]]=t[i[r]]);return e}function o(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,\"message\",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,\"stack\",{value:(new Error).stack||\"\"}),n&&r(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,\"name\",{get:function(){return e}}),t.prototype.toString=function(){return this.name+\": \"+this.message},t}i.asPromise=n(7018),i.base64=n(2647),i.EventEmitter=n(2922),i.float=n(7955),i.inquire=n(8446),i.utf8=n(5226),i.pool=n(5374),i.LongBits=n(8294),i.isNode=Boolean(void 0!==n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),i.global=i.isNode&&n.g||\"undefined\"!=typeof window&&window||\"undefined\"!=typeof self&&self||this,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isInteger=Number.isInteger||function(e){return\"number\"==typeof e&&isFinite(e)&&Math.floor(e)===e},i.isString=function(e){return\"string\"==typeof e||e instanceof String},i.isObject=function(e){return e&&\"object\"==typeof e},i.isset=i.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&(\"object\"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},i.Buffer=function(){try{var e=i.inquire(\"buffer\").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(e){return\"number\"==typeof e?i.Buffer?i._Buffer_allocUnsafe(e):new i.Array(e):i.Buffer?i._Buffer_from(e):\"undefined\"==typeof Uint8Array?e:new Uint8Array(e)},i.Array=\"undefined\"!=typeof Uint8Array?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire(\"long\"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\\\x00-\\\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(e){return e?i.LongBits.from(e).toHash():i.LongBits.zeroHash},i.longFromHash=function(e,t){var n=i.LongBits.fromHash(e);return i.Long?i.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},i.merge=r,i.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},i.newError=o,i.ProtocolError=o(\"ProtocolError\"),i.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},i.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var e=i.Buffer;e?(i._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},i._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):i._Buffer_from=i._Buffer_allocUnsafe=null}},8116:(e,t,n)=>{\"use strict\";e.exports=h;var i,r=n(1679),o=r.LongBits,s=r.base64,a=r.utf8;function l(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function c(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(c,0,0),this.tail=this.head,this.states=null}var d=function(){return r.Buffer?function(){return(h.create=function(){return new i})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function m(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=d(),h.alloc=function(e){return new r.Array(e)},r.Array!==Array&&(h.alloc=r.pool(h.alloc,r.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new l(e,t,n),this.len+=t,this},f.prototype=Object.create(l.prototype),f.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(m,10,o.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=o.from(e);return this._push(m,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(m,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=o.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(r.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(r.float.writeDoubleLE,8,e)};var v=r.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(r.isString(e)){var n=h.alloc(t=s.length(e));s.decode(e,n,0),e=n}return this.uint32(t)._push(v,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new l(c,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(c,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){i=e,h.create=d(),i._configure()}},1819:(e,t,n)=>{\"use strict\";e.exports=o;var i=n(8116);(o.prototype=Object.create(i.prototype)).constructor=o;var r=n(1679);function o(){i.call(this)}function s(e,t,n){e.length<40?r.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}o._configure=function(){o.alloc=r._Buffer_allocUnsafe,o.writeBytesBuffer=r.Buffer&&r.Buffer.prototype instanceof Uint8Array&&\"set\"===r.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}},o.prototype.bytes=function(e){r.isString(e)&&(e=r._Buffer_from(e,\"base64\"));var t=e.length>>>0;return this.uint32(t),t&&this._push(o.writeBytesBuffer,t,e),this},o.prototype.string=function(e){var t=r.Buffer.byteLength(e);return this.uint32(t),t&&this._push(s,t,e),this},o._configure()},82:(e,t,n)=>{\"use strict\";n.r(t),n.d(t,{ACESFilmicToneMapping:()=>ne,AddEquation:()=>E,AddOperation:()=>$,AdditiveAnimationBlendMode:()=>qt,AdditiveBlending:()=>b,AlphaFormat:()=>Ne,AlwaysDepth:()=>V,AlwaysStencilFunc:()=>Sn,AmbientLight:()=>Oh,AmbientLightProbe:()=>nd,AnimationClip:()=>Fu,AnimationLoader:()=>Hu,AnimationMixer:()=>Od,AnimationObjectGroup:()=>Dd,AnimationUtils:()=>wu,ArcCurve:()=>$u,ArrayCamera:()=>Za,ArrowHelper:()=>Sp,Audio:()=>pd,AudioAnalyser:()=>xd,AudioContext:()=>Qh,AudioListener:()=>dd,AudioLoader:()=>ed,AxesHelper:()=>Ep,AxisHelper:()=>Mf,BackSide:()=>m,BasicDepthPacking:()=>on,BasicShadowMap:()=>u,BinaryTextureLoader:()=>Lf,Bone:()=>Ol,BooleanKeyframeTrack:()=>Lu,BoundingBoxHelper:()=>Sf,Box2:()=>jd,Box3:()=>ui,Box3Helper:()=>xp,BoxBufferGeometry:()=>Eo,BoxGeometry:()=>Eo,BoxHelper:()=>yp,BufferAttribute:()=>zr,BufferGeometry:()=>ro,BufferGeometryLoader:()=>Vh,ByteType:()=>Ee,Cache:()=>zu,Camera:()=>Po,CameraHelper:()=>mp,CanvasRenderer:()=>Pf,CanvasTexture:()=>uc,CatmullRomCurve3:()=>ih,CineonToneMapping:()=>te,CircleBufferGeometry:()=>dc,CircleGeometry:()=>dc,ClampToEdgeWrapping:()=>de,Clock:()=>sd,Color:()=>Ir,ColorKeyframeTrack:()=>Cu,CompressedTexture:()=>cc,CompressedTextureLoader:()=>ju,ConeBufferGeometry:()=>fc,ConeGeometry:()=>fc,CubeCamera:()=>Io,CubeReflectionMapping:()=>oe,CubeRefractionMapping:()=>se,CubeTexture:()=>Oo,CubeTextureLoader:()=>qu,CubeUVReflectionMapping:()=>ce,CubeUVRefractionMapping:()=>ue,CubicBezierCurve:()=>ah,CubicBezierCurve3:()=>lh,CubicInterpolant:()=>Su,CullFaceBack:()=>a,CullFaceFront:()=>l,CullFaceFrontBack:()=>c,CullFaceNone:()=>s,Curve:()=>Zu,CurvePath:()=>mh,CustomBlending:()=>S,CustomToneMapping:()=>ie,CylinderBufferGeometry:()=>pc,CylinderGeometry:()=>pc,Cylindrical:()=>Vd,DataTexture:()=>Fl,DataTexture2DArray:()=>os,DataTexture3D:()=>ss,DataTextureLoader:()=>Xu,DataUtils:()=>Lp,DecrementStencilOp:()=>pn,DecrementWrapStencilOp:()=>mn,DefaultLoadingManager:()=>Bu,DepthFormat:()=>Ve,DepthStencilFormat:()=>He,DepthTexture:()=>hc,DirectionalLight:()=>Ih,DirectionalLightHelper:()=>dp,DiscreteInterpolant:()=>Tu,DodecahedronBufferGeometry:()=>gc,DodecahedronGeometry:()=>gc,DoubleSide:()=>g,DstAlphaFactor:()=>N,DstColorFactor:()=>U,DynamicBufferAttribute:()=>pf,DynamicCopyUsage:()=>Dn,DynamicDrawUsage:()=>Tn,DynamicReadUsage:()=>Cn,EdgesGeometry:()=>bc,EdgesHelper:()=>Ef,EllipseCurve:()=>Ju,EqualDepth:()=>W,EqualStencilFunc:()=>xn,EquirectangularReflectionMapping:()=>ae,EquirectangularRefractionMapping:()=>le,Euler:()=>Yi,EventDispatcher:()=>Nn,ExtrudeBufferGeometry:()=>Zc,ExtrudeGeometry:()=>Zc,FaceColors:()=>tf,FileLoader:()=>Vu,FlatShading:()=>v,Float16BufferAttribute:()=>Wr,Float32Attribute:()=>bf,Float32BufferAttribute:()=>qr,Float64Attribute:()=>wf,Float64BufferAttribute:()=>Xr,FloatType:()=>Pe,Fog:()=>rl,FogExp2:()=>il,Font:()=>Zh,FontLoader:()=>$h,FrontSide:()=>f,Frustum:()=>Uo,GLBufferAttribute:()=>zd,GLSL1:()=>On,GLSL3:()=>Fn,GammaEncoding:()=>Kt,GreaterDepth:()=>X,GreaterEqualDepth:()=>q,GreaterEqualStencilFunc:()=>Mn,GreaterStencilFunc:()=>bn,GridHelper:()=>ap,Group:()=>Ja,HalfFloatType:()=>Re,HemisphereLight:()=>xh,HemisphereLightHelper:()=>sp,HemisphereLightProbe:()=>td,IcosahedronBufferGeometry:()=>$c,IcosahedronGeometry:()=>$c,ImageBitmapLoader:()=>Xh,ImageLoader:()=>Wu,ImageUtils:()=>Kn,ImmediateRenderObject:()=>Yd,IncrementStencilOp:()=>dn,IncrementWrapStencilOp:()=>fn,InstancedBufferAttribute:()=>kh,InstancedBufferGeometry:()=>Gh,InstancedInterleavedBuffer:()=>Nd,InstancedMesh:()=>Hl,Int16Attribute:()=>vf,Int16BufferAttribute:()=>kr,Int32Attribute:()=>xf,Int32BufferAttribute:()=>Hr,Int8Attribute:()=>ff,Int8BufferAttribute:()=>Ur,IntType:()=>Le,InterleavedBuffer:()=>sl,InterleavedBufferAttribute:()=>ll,Interpolant:()=>Mu,InterpolateDiscrete:()=>Bt,InterpolateLinear:()=>Gt,InterpolateSmooth:()=>kt,InvertStencilOp:()=>gn,JSONLoader:()=>Rf,KeepStencilOp:()=>un,KeyframeTrack:()=>Au,LOD:()=>Al,LatheBufferGeometry:()=>Kc,LatheGeometry:()=>Kc,Layers:()=>Zi,LensFlare:()=>If,LessDepth:()=>H,LessEqualDepth:()=>j,LessEqualStencilFunc:()=>_n,LessStencilFunc:()=>yn,Light:()=>yh,LightProbe:()=>zh,Line:()=>Jl,Line3:()=>Xd,LineBasicMaterial:()=>jl,LineCurve:()=>ch,LineCurve3:()=>uh,LineDashedMaterial:()=>_u,LineLoop:()=>ec,LinePieces:()=>Qp,LineSegments:()=>Ql,LineStrip:()=>Kp,LinearEncoding:()=>Jt,LinearFilter:()=>xe,LinearInterpolant:()=>Eu,LinearMipMapLinearFilter:()=>Me,LinearMipMapNearestFilter:()=>be,LinearMipmapLinearFilter:()=>we,LinearMipmapNearestFilter:()=>_e,LinearToneMapping:()=>Q,Loader:()=>Gu,LoaderUtils:()=>Bh,LoadingManager:()=>Uu,LogLuvEncoding:()=>en,LoopOnce:()=>Nt,LoopPingPong:()=>Ut,LoopRepeat:()=>zt,LuminanceAlphaFormat:()=>Ge,LuminanceFormat:()=>Be,MOUSE:()=>r,Material:()=>Tr,MaterialLoader:()=>Uh,Math:()=>Yn,MathUtils:()=>Yn,Matrix3:()=>Jn,Matrix4:()=>Ui,MaxEquation:()=>C,Mesh:()=>Mo,MeshBasicMaterial:()=>Or,MeshDepthMaterial:()=>ka,MeshDistanceMaterial:()=>Va,MeshFaceMaterial:()=>rf,MeshLambertMaterial:()=>yu,MeshMatcapMaterial:()=>xu,MeshNormalMaterial:()=>vu,MeshPhongMaterial:()=>mu,MeshPhysicalMaterial:()=>fu,MeshStandardMaterial:()=>pu,MeshToonMaterial:()=>gu,MinEquation:()=>L,MirroredRepeatWrapping:()=>pe,MixOperation:()=>J,MultiMaterial:()=>of,MultiplyBlending:()=>M,MultiplyOperation:()=>Z,NearestFilter:()=>fe,NearestMipMapLinearFilter:()=>ye,NearestMipMapNearestFilter:()=>ge,NearestMipmapLinearFilter:()=>ve,NearestMipmapNearestFilter:()=>me,NeverDepth:()=>k,NeverStencilFunc:()=>vn,NoBlending:()=>x,NoColors:()=>ef,NoToneMapping:()=>K,NormalAnimationBlendMode:()=>Wt,NormalBlending:()=>_,NotEqualDepth:()=>Y,NotEqualStencilFunc:()=>wn,NumberKeyframeTrack:()=>Pu,Object3D:()=>cr,ObjectLoader:()=>Hh,ObjectSpaceNormalMap:()=>ln,OctahedronBufferGeometry:()=>Qc,OctahedronGeometry:()=>Qc,OneFactor:()=>R,OneMinusDstAlphaFactor:()=>z,OneMinusDstColorFactor:()=>B,OneMinusSrcAlphaFactor:()=>F,OneMinusSrcColorFactor:()=>I,OrthographicCamera:()=>Rh,PCFShadowMap:()=>h,PCFSoftShadowMap:()=>d,PMREMGenerator:()=>Wp,ParametricBufferGeometry:()=>eu,ParametricGeometry:()=>eu,Particle:()=>af,ParticleBasicMaterial:()=>uf,ParticleSystem:()=>lf,ParticleSystemMaterial:()=>hf,Path:()=>gh,PerspectiveCamera:()=>Ro,Plane:()=>pr,PlaneBufferGeometry:()=>ko,PlaneGeometry:()=>ko,PlaneHelper:()=>_p,PointCloud:()=>sf,PointCloudMaterial:()=>cf,PointLight:()=>Ph,PointLightHelper:()=>np,Points:()=>sc,PointsMaterial:()=>tc,PolarGridHelper:()=>lp,PolyhedronBufferGeometry:()=>mc,PolyhedronGeometry:()=>mc,PositionalAudio:()=>yd,PropertyBinding:()=>Rd,PropertyMixer:()=>_d,QuadraticBezierCurve:()=>hh,QuadraticBezierCurve3:()=>dh,Quaternion:()=>si,QuaternionKeyframeTrack:()=>Du,QuaternionLinearInterpolant:()=>Ru,REVISION:()=>i,RGBADepthPacking:()=>sn,RGBAFormat:()=>Ue,RGBAIntegerFormat:()=>Ze,RGBA_ASTC_10x10_Format:()=>yt,RGBA_ASTC_10x5_Format:()=>mt,RGBA_ASTC_10x6_Format:()=>gt,RGBA_ASTC_10x8_Format:()=>vt,RGBA_ASTC_12x10_Format:()=>xt,RGBA_ASTC_12x12_Format:()=>_t,RGBA_ASTC_4x4_Format:()=>at,RGBA_ASTC_5x4_Format:()=>lt,RGBA_ASTC_5x5_Format:()=>ct,RGBA_ASTC_6x5_Format:()=>ut,RGBA_ASTC_6x6_Format:()=>ht,RGBA_ASTC_8x5_Format:()=>dt,RGBA_ASTC_8x6_Format:()=>pt,RGBA_ASTC_8x8_Format:()=>ft,RGBA_BPTC_Format:()=>bt,RGBA_ETC2_EAC_Format:()=>st,RGBA_PVRTC_2BPPV1_Format:()=>it,RGBA_PVRTC_4BPPV1_Format:()=>nt,RGBA_S3TC_DXT1_Format:()=>$e,RGBA_S3TC_DXT3_Format:()=>Ke,RGBA_S3TC_DXT5_Format:()=>Qe,RGBDEncoding:()=>rn,RGBEEncoding:()=>Qt,RGBEFormat:()=>ke,RGBFormat:()=>ze,RGBIntegerFormat:()=>Ye,RGBM16Encoding:()=>nn,RGBM7Encoding:()=>tn,RGB_ETC1_Format:()=>rt,RGB_ETC2_Format:()=>ot,RGB_PVRTC_2BPPV1_Format:()=>tt,RGB_PVRTC_4BPPV1_Format:()=>et,RGB_S3TC_DXT1_Format:()=>Je,RGFormat:()=>qe,RGIntegerFormat:()=>Xe,RawShaderMaterial:()=>du,Ray:()=>zi,Raycaster:()=>Ud,RectAreaLight:()=>Fh,RedFormat:()=>je,RedIntegerFormat:()=>We,ReinhardToneMapping:()=>ee,RepeatWrapping:()=>he,ReplaceStencilOp:()=>hn,ReverseSubtractEquation:()=>A,RingBufferGeometry:()=>tu,RingGeometry:()=>tu,SRGB8_ALPHA8_ASTC_10x10_Format:()=>It,SRGB8_ALPHA8_ASTC_10x5_Format:()=>Pt,SRGB8_ALPHA8_ASTC_10x6_Format:()=>Rt,SRGB8_ALPHA8_ASTC_10x8_Format:()=>Dt,SRGB8_ALPHA8_ASTC_12x10_Format:()=>Ot,SRGB8_ALPHA8_ASTC_12x12_Format:()=>Ft,SRGB8_ALPHA8_ASTC_4x4_Format:()=>wt,SRGB8_ALPHA8_ASTC_5x4_Format:()=>Mt,SRGB8_ALPHA8_ASTC_5x5_Format:()=>St,SRGB8_ALPHA8_ASTC_6x5_Format:()=>Et,SRGB8_ALPHA8_ASTC_6x6_Format:()=>Tt,SRGB8_ALPHA8_ASTC_8x5_Format:()=>At,SRGB8_ALPHA8_ASTC_8x6_Format:()=>Lt,SRGB8_ALPHA8_ASTC_8x8_Format:()=>Ct,Scene:()=>ol,SceneUtils:()=>Df,ShaderChunk:()=>Vo,ShaderLib:()=>jo,ShaderMaterial:()=>Co,ShadowMaterial:()=>hu,Shape:()=>vh,ShapeBufferGeometry:()=>nu,ShapeGeometry:()=>nu,ShapePath:()=>Yh,ShapeUtils:()=>qc,ShortType:()=>Te,Skeleton:()=>Ul,SkeletonHelper:()=>ep,SkinnedMesh:()=>Il,SmoothShading:()=>y,Sphere:()=>Ci,SphereBufferGeometry:()=>iu,SphereGeometry:()=>iu,Spherical:()=>kd,SphericalHarmonics3:()=>Nh,SplineCurve:()=>ph,SpotLight:()=>Eh,SpotLightHelper:()=>Jd,Sprite:()=>Ml,SpriteMaterial:()=>cl,SrcAlphaFactor:()=>O,SrcAlphaSaturateFactor:()=>G,SrcColorFactor:()=>D,StaticCopyUsage:()=>Rn,StaticDrawUsage:()=>En,StaticReadUsage:()=>Ln,StereoCamera:()=>od,StreamCopyUsage:()=>In,StreamDrawUsage:()=>An,StreamReadUsage:()=>Pn,StringKeyframeTrack:()=>Iu,SubtractEquation:()=>T,SubtractiveBlending:()=>w,TOUCH:()=>o,TangentSpaceNormalMap:()=>an,TetrahedronBufferGeometry:()=>ru,TetrahedronGeometry:()=>ru,TextBufferGeometry:()=>ou,TextGeometry:()=>ou,Texture:()=>ei,TextureLoader:()=>Yu,TorusBufferGeometry:()=>su,TorusGeometry:()=>su,TorusKnotBufferGeometry:()=>au,TorusKnotGeometry:()=>au,Triangle:()=>Sr,TriangleFanDrawMode:()=>Zt,TriangleStripDrawMode:()=>Yt,TrianglesDrawMode:()=>Xt,TubeBufferGeometry:()=>lu,TubeGeometry:()=>lu,UVMapping:()=>re,Uint16Attribute:()=>yf,Uint16BufferAttribute:()=>Vr,Uint32Attribute:()=>_f,Uint32BufferAttribute:()=>jr,Uint8Attribute:()=>mf,Uint8BufferAttribute:()=>Br,Uint8ClampedAttribute:()=>gf,Uint8ClampedBufferAttribute:()=>Gr,Uniform:()=>Fd,UniformsLib:()=>Ho,UniformsUtils:()=>Lo,UnsignedByteType:()=>Se,UnsignedInt248Type:()=>Fe,UnsignedIntType:()=>Ce,UnsignedShort4444Type:()=>De,UnsignedShort5551Type:()=>Ie,UnsignedShort565Type:()=>Oe,UnsignedShortType:()=>Ae,VSMShadowMap:()=>p,Vector2:()=>Zn,Vector3:()=>ai,Vector4:()=>ni,VectorKeyframeTrack:()=>Ou,Vertex:()=>df,VertexColors:()=>nf,VideoTexture:()=>lc,WebGL1Renderer:()=>nl,WebGLCubeRenderTarget:()=>Fo,WebGLMultipleRenderTargets:()=>ri,WebGLMultisampleRenderTarget:()=>oi,WebGLRenderTarget:()=>ii,WebGLRenderTargetCube:()=>Cf,WebGLRenderer:()=>tl,WebGLUtils:()=>Ya,WireframeGeometry:()=>cu,WireframeHelper:()=>Tf,WrapAroundEnding:()=>jt,XHRLoader:()=>Af,ZeroCurvatureEnding:()=>Vt,ZeroFactor:()=>P,ZeroSlopeEnding:()=>Ht,ZeroStencilOp:()=>cn,sRGBEncoding:()=>$t});const i=\"129\",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},o={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},s=0,a=1,l=2,c=3,u=0,h=1,d=2,p=3,f=0,m=1,g=2,v=1,y=2,x=0,_=1,b=2,w=3,M=4,S=5,E=100,T=101,A=102,L=103,C=104,P=200,R=201,D=202,I=203,O=204,F=205,N=206,z=207,U=208,B=209,G=210,k=0,V=1,H=2,j=3,W=4,q=5,X=6,Y=7,Z=0,J=1,$=2,K=0,Q=1,ee=2,te=3,ne=4,ie=5,re=300,oe=301,se=302,ae=303,le=304,ce=306,ue=307,he=1e3,de=1001,pe=1002,fe=1003,me=1004,ge=1004,ve=1005,ye=1005,xe=1006,_e=1007,be=1007,we=1008,Me=1008,Se=1009,Ee=1010,Te=1011,Ae=1012,Le=1013,Ce=1014,Pe=1015,Re=1016,De=1017,Ie=1018,Oe=1019,Fe=1020,Ne=1021,ze=1022,Ue=1023,Be=1024,Ge=1025,ke=Ue,Ve=1026,He=1027,je=1028,We=1029,qe=1030,Xe=1031,Ye=1032,Ze=1033,Je=33776,$e=33777,Ke=33778,Qe=33779,et=35840,tt=35841,nt=35842,it=35843,rt=36196,ot=37492,st=37496,at=37808,lt=37809,ct=37810,ut=37811,ht=37812,dt=37813,pt=37814,ft=37815,mt=37816,gt=37817,vt=37818,yt=37819,xt=37820,_t=37821,bt=36492,wt=37840,Mt=37841,St=37842,Et=37843,Tt=37844,At=37845,Lt=37846,Ct=37847,Pt=37848,Rt=37849,Dt=37850,It=37851,Ot=37852,Ft=37853,Nt=2200,zt=2201,Ut=2202,Bt=2300,Gt=2301,kt=2302,Vt=2400,Ht=2401,jt=2402,Wt=2500,qt=2501,Xt=0,Yt=1,Zt=2,Jt=3e3,$t=3001,Kt=3007,Qt=3002,en=3003,tn=3004,nn=3005,rn=3006,on=3200,sn=3201,an=0,ln=1,cn=0,un=7680,hn=7681,dn=7682,pn=7683,fn=34055,mn=34056,gn=5386,vn=512,yn=513,xn=514,_n=515,bn=516,wn=517,Mn=518,Sn=519,En=35044,Tn=35048,An=35040,Ln=35045,Cn=35049,Pn=35041,Rn=35046,Dn=35050,In=35042,On=\"100\",Fn=\"300 es\";class Nn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const zn=[];for(let e=0;e<256;e++)zn[e]=(e<16?\"0\":\"\")+e.toString(16);let Un=1234567;const Bn=Math.PI/180,Gn=180/Math.PI;function kn(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(zn[255&e]+zn[e>>8&255]+zn[e>>16&255]+zn[e>>24&255]+\"-\"+zn[255&t]+zn[t>>8&255]+\"-\"+zn[t>>16&15|64]+zn[t>>24&255]+\"-\"+zn[63&n|128]+zn[n>>8&255]+\"-\"+zn[n>>16&255]+zn[n>>24&255]+zn[255&i]+zn[i>>8&255]+zn[i>>16&255]+zn[i>>24&255]).toUpperCase()}function Vn(e,t,n){return Math.max(t,Math.min(n,e))}function Hn(e,t){return(e%t+t)%t}function jn(e,t,n){return(1-n)*e+n*t}function Wn(e){return 0==(e&e-1)&&0!==e}function qn(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Xn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Yn=Object.freeze({__proto__:null,DEG2RAD:Bn,RAD2DEG:Gn,generateUUID:kn,clamp:Vn,euclideanModulo:Hn,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:jn,damp:function(e,t,n,i){return jn(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(Hn(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Un=e%2147483647),Un=16807*Un%2147483647,(Un-1)/2147483646},degToRad:function(e){return e*Bn},radToDeg:function(e){return e*Gn},isPowerOfTwo:Wn,ceilPowerOfTwo:qn,floorPowerOfTwo:Xn,setQuaternionFromProperEuler:function(e,t,n,i,r){const o=Math.cos,s=Math.sin,a=o(n/2),l=s(n/2),c=o((t+i)/2),u=s((t+i)/2),h=o((t-i)/2),d=s((t-i)/2),p=o((i-t)/2),f=s((i-t)/2);switch(r){case\"XYX\":e.set(a*u,l*h,l*d,a*c);break;case\"YZY\":e.set(l*d,a*u,l*h,a*c);break;case\"ZXZ\":e.set(l*h,l*d,a*u,a*c);break;case\"XZX\":e.set(a*u,l*f,l*p,a*c);break;case\"YXY\":e.set(l*p,a*u,l*f,a*c);break;case\"ZYZ\":e.set(l*f,l*p,a*u,a*c);break;default:console.warn(\"THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: \"+r)}}});class Zn{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error(\"index is out of range: \"+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error(\"index is out of range: \"+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn(\"THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn(\"THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn(\"THREE.Vector2: offset has been removed from .fromBufferAttribute().\"),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Zn.prototype.isVector2=!0;class Jn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error(\"THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.\")}set(e,t,n,i,r,o,s,a,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=s,c[3]=t,c[4]=r,c[5]=a,c[6]=n,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],x=i[7],_=i[2],b=i[5],w=i[8];return r[0]=o*f+s*v+a*_,r[3]=o*m+s*y+a*b,r[6]=o*g+s*x+a*w,r[1]=l*f+c*v+u*_,r[4]=l*m+c*y+u*b,r[7]=l*g+c*x+u*w,r[2]=h*f+d*v+p*_,r[5]=h*m+d*y+p*b,r[8]=h*g+d*x+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-n*r*c+n*s*a+i*r*l-i*o*a}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=c*o-s*l,h=s*a-c*r,d=l*r-o*a,p=t*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(i*l-c*n)*f,e[2]=(s*n-i*o)*f,e[3]=h*f,e[4]=(c*t-i*a)*f,e[5]=(i*r-s*t)*f,e[6]=d*f,e[7]=(n*a-l*t)*f,e[8]=(o*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,s){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*o+l*s)+o+e,-i*l,i*a,-i*(-l*o+a*s)+s+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],o=i[3],s=i[6],a=i[1],l=i[4],c=i[7];return i[0]=t*r+n*a,i[3]=t*o+n*l,i[6]=t*s+n*c,i[1]=-n*r+t*a,i[4]=-n*o+t*l,i[7]=-n*s+t*c,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}let $n;Jn.prototype.isMatrix3=!0;class Kn{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if(\"undefined\"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===$n&&($n=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\")),$n.width=e.width,$n.height=e.height;const n=$n.getContext(\"2d\");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=$n}return t.width>2048||t.height>2048?(console.warn(\"THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons\",e),t.toDataURL(\"image/jpeg\",.6)):t.toDataURL(\"image/png\")}}let Qn=0;class ei extends Nn{constructor(e=ei.DEFAULT_IMAGE,t=ei.DEFAULT_MAPPING,n=de,i=de,r=xe,o=we,s=Ue,a=Se,l=1,c=Jt){super(),Object.defineProperty(this,\"id\",{value:Qn++}),this.uuid=kn(),this.name=\"\",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=a,this.offset=new Zn(0,0),this.repeat=new Zn(1,1),this.center=new Zn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Jn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=void 0===e||\"string\"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:\"Texture\",generator:\"Texture.toJSON\"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=kn()),!t&&void 0===e.images[i.uuid]){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(ti(i[e].image)):t.push(ti(i[e]))}else t=ti(i);e.images[i.uuid]={uuid:i.uuid,url:t}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:\"dispose\"})}transformUv(e){if(this.mapping!==re)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case he:e.x=e.x-Math.floor(e.x);break;case de:e.x=e.x<0?0:1;break;case pe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case he:e.y=e.y-Math.floor(e.y);break;case de:e.y=e.y<0?0:1;break;case pe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function ti(e){return\"undefined\"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||\"undefined\"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||\"undefined\"!=typeof ImageBitmap&&e instanceof ImageBitmap?Kn.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn(\"THREE.Texture: Unable to serialize Texture.\"),{})}ei.DEFAULT_IMAGE=void 0,ei.DEFAULT_MAPPING=re,ei.prototype.isTexture=!0;class ni{constructor(e=0,t=0,n=0,i=1){this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error(\"index is out of range: \"+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error(\"index is out of range: \"+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn(\"THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn(\"THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const o=.01,s=.1,a=e.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<o&&Math.abs(u-f)<o&&Math.abs(p-m)<o){if(Math.abs(c+h)<s&&Math.abs(u+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(d+1)/2,v=(g+1)/2,y=(c+h)/4,x=(u+f)/4,_=(p+m)/4;return e>a&&e>v?e<o?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=y/n,r=x/n):a>v?a<o?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=y/i,r=_/i):v<o?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=x/r,i=_/r),this.set(n,i,r,t),this}let v=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(u-f)/v,this.z=(h-c)/v,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn(\"THREE.Vector4: offset has been removed from .fromBufferAttribute().\"),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}ni.prototype.isVector4=!0;class ii extends Nn{constructor(e,t,n){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new ni(0,0,e,t),this.scissorTest=!1,this.viewport=new ni(0,0,e,t),n=n||{},this.texture=new ei(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:xe,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:\"dispose\"})}}ii.prototype.isWebGLRenderTarget=!0;class ri extends ii{constructor(e,t,n){super(e,t);const i=this.texture;this.texture=[];for(let e=0;e<n;e++)this.texture[e]=i.clone()}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}ri.prototype.isWebGLMultipleRenderTargets=!0;class oi extends ii{constructor(e,t,n){super(e,t,n),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}oi.prototype.isWebGLMultisampleRenderTarget=!0;class si{constructor(e=0,t=0,n=0,i=1){this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn(\"THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead.\"),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,r,o,s){let a=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[o+0],d=r[o+1],p=r[o+2],f=r[o+3];if(0===s)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||a!==h||l!==d||c!==p){let e=1-s;const t=a*h+l*d+c*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,s=Math.sin(s*o)/r}const r=s*n;if(a=a*e+h*r,l=l*e+d*r,c=c*e+p*r,u=u*e+f*r,e===1-s){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,o){const s=n[i],a=n[i+1],l=n[i+2],c=n[i+3],u=r[o],h=r[o+1],d=r[o+2],p=r[o+3];return e[t]=s*p+c*u+a*d-l*h,e[t+1]=a*p+c*h+l*u-s*d,e[t+2]=l*p+c*d+s*h-a*u,e[t+3]=c*p-s*u-a*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error(\"THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.\");const n=e._x,i=e._y,r=e._z,o=e._order,s=Math.cos,a=Math.sin,l=s(n/2),c=s(i/2),u=s(r/2),h=a(n/2),d=a(i/2),p=a(r/2);switch(o){case\"XYZ\":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case\"YXZ\":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case\"ZXY\":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case\"ZYX\":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case\"YZX\":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case\"XZY\":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn(\"THREE.Quaternion: .setFromEuler() encountered an unknown order: \"+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],s=t[5],a=t[9],l=t[2],c=t[6],u=t[10],h=n+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-a)*e,this._y=(r-l)*e,this._z=(o-i)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-a)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(r+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(r-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(o-i)/e,this._x=(r+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Vn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn(\"THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.\"),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+o*s+i*l-r*a,this._y=i*c+o*a+r*s-n*l,this._z=r*c+o*l+n*a-i*s,this._w=o*c-n*s-i*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let s=o*e._w+n*e._x+i*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}si.prototype.isQuaternion=!0;class ai{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error(\"index is out of range: \"+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error(\"index is out of range: \"+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.\"),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error(\"THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.\"),this.applyQuaternion(ci.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(ci.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*i-s*n,c=a*n+s*t-r*i,u=a*i+r*n-o*t,h=-r*t-o*n-s*i;return this.x=l*a+h*-r+c*-s-u*-o,this.y=c*a+h*-o+u*-r-l*-s,this.z=u*a+h*-s+l*-o-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.\"),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=i*a-r*s,this.y=r*o-n*a,this.z=n*s-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return li.copy(this).projectOnVector(e),this.sub(li)}reflect(e){return this.sub(li.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Vn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn(\"THREE.Vector3: offset has been removed from .fromBufferAttribute().\"),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}ai.prototype.isVector3=!0;const li=new ai,ci=new si;class ui{constructor(e=new ai(1/0,1/0,1/0),t=new ai(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],u=e[a+2];l<t&&(t=l),c<n&&(n=c),u<i&&(i=u),l>r&&(r=l),c>o&&(o=c),u>s&&(s=u)}return this.min.set(t,n,i),this.max.set(r,o,s),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),c=e.getY(a),u=e.getZ(a);l<t&&(t=l),c<n&&(n=c),u<i&&(i=u),l>r&&(r=l),c>o&&(o=c),u>s&&(s=u)}return this.min.set(t,n,i),this.max.set(r,o,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=di.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn(\"THREE.Box3: .getCenter() target is now required\"),e=new ai),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn(\"THREE.Box3: .getSize() target is now required\"),e=new ai),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),pi.copy(t.boundingBox),pi.applyMatrix4(e.matrixWorld),this.union(pi));const n=e.children;for(let e=0,t=n.length;e<t;e++)this.expandByObject(n[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn(\"THREE.Box3: .getParameter() target is now required\"),t=new ai),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,di),di.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(_i),bi.subVectors(this.max,_i),fi.subVectors(e.a,_i),mi.subVectors(e.b,_i),gi.subVectors(e.c,_i),vi.subVectors(mi,fi),yi.subVectors(gi,mi),xi.subVectors(fi,gi);let t=[0,-vi.z,vi.y,0,-yi.z,yi.y,0,-xi.z,xi.y,vi.z,0,-vi.x,yi.z,0,-yi.x,xi.z,0,-xi.x,-vi.y,vi.x,0,-yi.y,yi.x,0,-xi.y,xi.x,0];return!!Si(t,fi,mi,gi,bi)&&(t=[1,0,0,0,1,0,0,0,1],!!Si(t,fi,mi,gi,bi)&&(wi.crossVectors(vi,yi),t=[wi.x,wi.y,wi.z],Si(t,fi,mi,gi,bi)))}clampPoint(e,t){return void 0===t&&(console.warn(\"THREE.Box3: .clampPoint() target is now required\"),t=new ai),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return di.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error(\"THREE.Box3: .getBoundingSphere() target is now required\"),this.getCenter(e.center),e.radius=.5*this.getSize(di).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(hi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),hi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),hi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),hi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),hi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),hi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),hi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),hi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(hi)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}ui.prototype.isBox3=!0;const hi=[new ai,new ai,new ai,new ai,new ai,new ai,new ai,new ai],di=new ai,pi=new ui,fi=new ai,mi=new ai,gi=new ai,vi=new ai,yi=new ai,xi=new ai,_i=new ai,bi=new ai,wi=new ai,Mi=new ai;function Si(e,t,n,i,r){for(let o=0,s=e.length-3;o<=s;o+=3){Mi.fromArray(e,o);const s=r.x*Math.abs(Mi.x)+r.y*Math.abs(Mi.y)+r.z*Math.abs(Mi.z),a=t.dot(Mi),l=n.dot(Mi),c=i.dot(Mi);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>s)return!1}return!0}const Ei=new ui,Ti=new ai,Ai=new ai,Li=new ai;class Ci{constructor(e=new ai,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Ei.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return void 0===t&&(console.warn(\"THREE.Sphere: .clampPoint() target is now required\"),t=new ai),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn(\"THREE.Sphere: .getBoundingBox() target is now required\"),e=new ui),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Li.subVectors(e,this.center);const t=Li.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(Li.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return Ai.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Ti.copy(e.center).add(Ai)),this.expandByPoint(Ti.copy(e.center).sub(Ai)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Pi=new ai,Ri=new ai,Di=new ai,Ii=new ai,Oi=new ai,Fi=new ai,Ni=new ai;class zi{constructor(e=new ai,t=new ai(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn(\"THREE.Ray: .at() target is now required\"),t=new ai),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Pi)),this}closestPointToPoint(e,t){void 0===t&&(console.warn(\"THREE.Ray: .closestPointToPoint() target is now required\"),t=new ai),t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Pi.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Pi.copy(this.direction).multiplyScalar(t).add(this.origin),Pi.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Ri.copy(e).add(t).multiplyScalar(.5),Di.copy(t).sub(e).normalize(),Ii.copy(this.origin).sub(Ri);const r=.5*e.distanceTo(t),o=-this.direction.dot(Di),s=Ii.dot(this.direction),a=-Ii.dot(Di),l=Ii.lengthSq(),c=Math.abs(1-o*o);let u,h,d,p;if(c>0)if(u=o*a-s,h=o*s-a,p=r*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+o*h+2*s)+h*(o*u+h+2*a)+l}else h=r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h=-r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-o*r+s)),h=u>0?-r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-a),r),d=h*(h+2*a)+l):(u=Math.max(0,-(o*r+s)),h=u>0?r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l);else h=o>0?-r:r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),i&&i.copy(Di).multiplyScalar(h).add(Ri),d}intersectSphere(e,t){Pi.subVectors(e.center,this.origin);const n=Pi.dot(this.direction),i=Pi.dot(Pi)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),s=n-o,a=n+o;return s<0&&a<0?null:s<0?this.at(a,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,s,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||s>i?null:((s>n||n!=n)&&(n=s),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,Pi)}intersectTriangle(e,t,n,i,r){Oi.subVectors(t,e),Fi.subVectors(n,e),Ni.crossVectors(Oi,Fi);let o,s=this.direction.dot(Ni);if(s>0){if(i)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}Ii.subVectors(this.origin,e);const a=o*this.direction.dot(Fi.crossVectors(Ii,Fi));if(a<0)return null;const l=o*this.direction.dot(Oi.cross(Ii));if(l<0)return null;if(a+l>s)return null;const c=-o*Ii.dot(Ni);return c<0?null:this.at(c/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ui{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error(\"THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.\")}set(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ui).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Bi.setFromMatrixColumn(e,0).length(),r=1/Bi.setFromMatrixColumn(e,1).length(),o=1/Bi.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error(\"THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.\");const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if(\"XYZ\"===e.order){const e=o*c,n=o*u,i=s*c,r=s*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-s*a,t[2]=r-e*l,t[6]=i+n*l,t[10]=o*a}else if(\"YXZ\"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e+r*s,t[4]=i*s-n,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-s,t[2]=n*s-i,t[6]=r+e*s,t[10]=o*a}else if(\"ZXY\"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e-r*s,t[4]=-o*u,t[8]=i+n*s,t[1]=n+i*s,t[5]=o*c,t[9]=r-e*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if(\"ZYX\"===e.order){const e=o*c,n=o*u,i=s*c,r=s*u;t[0]=a*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=a*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=s*a,t[10]=o*a}else if(\"YZX\"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if(\"XZY\"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=o*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=s*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ki,e,Vi)}lookAt(e,t,n){const i=this.elements;return Wi.subVectors(e,t),0===Wi.lengthSq()&&(Wi.z=1),Wi.normalize(),Hi.crossVectors(n,Wi),0===Hi.lengthSq()&&(1===Math.abs(n.z)?Wi.x+=1e-4:Wi.z+=1e-4,Wi.normalize(),Hi.crossVectors(n,Wi)),Hi.normalize(),ji.crossVectors(Wi,Hi),i[0]=Hi.x,i[4]=ji.x,i[8]=Wi.x,i[1]=Hi.y,i[5]=ji.y,i[9]=Wi.y,i[2]=Hi.z,i[6]=ji.z,i[10]=Wi.z,this}multiply(e,t){return void 0!==t?(console.warn(\"THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.\"),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],_=n[15],b=i[0],w=i[4],M=i[8],S=i[12],E=i[1],T=i[5],A=i[9],L=i[13],C=i[2],P=i[6],R=i[10],D=i[14],I=i[3],O=i[7],F=i[11],N=i[15];return r[0]=o*b+s*E+a*C+l*I,r[4]=o*w+s*T+a*P+l*O,r[8]=o*M+s*A+a*R+l*F,r[12]=o*S+s*L+a*D+l*N,r[1]=c*b+u*E+h*C+d*I,r[5]=c*w+u*T+h*P+d*O,r[9]=c*M+u*A+h*R+d*F,r[13]=c*S+u*L+h*D+d*N,r[2]=p*b+f*E+m*C+g*I,r[6]=p*w+f*T+m*P+g*O,r[10]=p*M+f*A+m*R+g*F,r[14]=p*S+f*L+m*D+g*N,r[3]=v*b+y*E+x*C+_*I,r[7]=v*w+y*T+x*P+_*O,r[11]=v*M+y*A+x*R+_*F,r[15]=v*S+y*L+x*D+_*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*a*u-i*l*u-r*s*h+n*l*h+i*s*d-n*a*d)+e[7]*(+t*a*d-t*l*h+r*o*h-i*o*d+i*l*c-r*a*c)+e[11]*(+t*l*u-t*s*d-r*o*u+n*o*d+r*s*c-n*l*c)+e[15]*(-i*s*c-t*a*u+t*s*h+i*o*u-n*o*h+n*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*l-f*h*l+f*a*d-s*m*d-u*a*g+s*h*g,y=p*h*l-c*m*l-p*a*d+o*m*d+c*a*g-o*h*g,x=c*f*l-p*u*l+p*s*d-o*f*d-c*s*g+o*u*g,_=p*u*a-c*f*a-p*s*h+o*f*h+c*s*m-o*u*m,b=t*v+n*y+i*x+r*_;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return e[0]=v*w,e[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*w,e[2]=(s*m*r-f*a*r+f*i*l-n*m*l-s*i*g+n*a*g)*w,e[3]=(u*a*r-s*h*r-u*i*l+n*h*l+s*i*d-n*a*d)*w,e[4]=y*w,e[5]=(c*m*r-p*h*r+p*i*d-t*m*d-c*i*g+t*h*g)*w,e[6]=(p*a*r-o*m*r-p*i*l+t*m*l+o*i*g-t*a*g)*w,e[7]=(o*h*r-c*a*r+c*i*l-t*h*l-o*i*d+t*a*d)*w,e[8]=x*w,e[9]=(p*u*r-c*f*r-p*n*d+t*f*d+c*n*g-t*u*g)*w,e[10]=(o*f*r-p*s*r+p*n*l-t*f*l-o*n*g+t*s*g)*w,e[11]=(c*s*r-o*u*r-c*n*l+t*u*l+o*n*d-t*s*d)*w,e[12]=_*w,e[13]=(c*f*i-p*u*i+p*n*h-t*f*h-c*n*m+t*u*m)*w,e[14]=(p*s*i-o*f*i-p*n*a+t*f*a+o*n*m-t*s*m)*w,e[15]=(o*u*i-c*s*i+c*n*a-t*u*a-o*n*h+t*s*h)*w,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,s=e.y,a=e.z,l=r*o,c=r*s;return this.set(l*o+n,l*s-i*a,l*a+i*s,0,l*s+i*a,c*s+n,c*a-i*o,0,l*a-i*s,c*a+i*o,r*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,s=t._z,a=t._w,l=r+r,c=o+o,u=s+s,h=r*l,d=r*c,p=r*u,f=o*c,m=o*u,g=s*u,v=a*l,y=a*c,x=a*u,_=n.x,b=n.y,w=n.z;return i[0]=(1-(f+g))*_,i[1]=(d+x)*_,i[2]=(p-y)*_,i[3]=0,i[4]=(d-x)*b,i[5]=(1-(h+g))*b,i[6]=(m+v)*b,i[7]=0,i[8]=(p+y)*w,i[9]=(m-v)*w,i[10]=(1-(h+f))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=Bi.set(i[0],i[1],i[2]).length();const o=Bi.set(i[4],i[5],i[6]).length(),s=Bi.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Gi.copy(this);const a=1/r,l=1/o,c=1/s;return Gi.elements[0]*=a,Gi.elements[1]*=a,Gi.elements[2]*=a,Gi.elements[4]*=l,Gi.elements[5]*=l,Gi.elements[6]*=l,Gi.elements[8]*=c,Gi.elements[9]*=c,Gi.elements[10]*=c,t.setFromRotationMatrix(Gi),n.x=r,n.y=o,n.z=s,this}makePerspective(e,t,n,i,r,o){void 0===o&&console.warn(\"THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.\");const s=this.elements,a=2*r/(t-e),l=2*r/(n-i),c=(t+e)/(t-e),u=(n+i)/(n-i),h=-(o+r)/(o-r),d=-2*o*r/(o-r);return s[0]=a,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=l,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,i,r,o){const s=this.elements,a=1/(t-e),l=1/(n-i),c=1/(o-r),u=(t+e)*a,h=(n+i)*l,d=(o+r)*c;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}Ui.prototype.isMatrix4=!0;const Bi=new ai,Gi=new Ui,ki=new ai(0,0,0),Vi=new ai(1,1,1),Hi=new ai,ji=new ai,Wi=new ai,qi=new Ui,Xi=new si;class Yi{constructor(e=0,t=0,n=0,i=Yi.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,n){const i=e.elements,r=i[0],o=i[4],s=i[8],a=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(t=t||this._order){case\"XYZ\":this._y=Math.asin(Vn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(h,l),this._z=0);break;case\"YXZ\":this._x=Math.asin(-Vn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case\"ZXY\":this._x=Math.asin(Vn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(a,r));break;case\"ZYX\":this._y=Math.asin(-Vn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case\"YZX\":this._z=Math.asin(Vn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(s,d));break;case\"XZY\":this._z=Math.asin(-Vn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn(\"THREE.Euler: .setFromRotationMatrix() encountered an unknown order: \"+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return qi.makeRotationFromQuaternion(e),this.setFromRotationMatrix(qi,t,n)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return Xi.setFromEuler(this),this.setFromQuaternion(Xi,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new ai(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Yi.prototype.isEuler=!0,Yi.DefaultOrder=\"XYZ\",Yi.RotationOrders=[\"XYZ\",\"YZX\",\"ZXY\",\"XZY\",\"YXZ\",\"ZYX\"];class Zi{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let Ji=0;const $i=new ai,Ki=new si,Qi=new Ui,er=new ai,tr=new ai,nr=new ai,ir=new si,rr=new ai(1,0,0),or=new ai(0,1,0),sr=new ai(0,0,1),ar={type:\"added\"},lr={type:\"removed\"};class cr extends Nn{constructor(){super(),Object.defineProperty(this,\"id\",{value:Ji++}),this.uuid=kn(),this.name=\"\",this.type=\"Object3D\",this.parent=null,this.children=[],this.up=cr.DefaultUp.clone();const e=new ai,t=new Yi,n=new si,i=new ai(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ui},normalMatrix:{value:new Jn}}),this.matrix=new Ui,this.matrixWorld=new Ui,this.matrixAutoUpdate=cr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Zi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Ki.setFromAxisAngle(e,t),this.quaternion.multiply(Ki),this}rotateOnWorldAxis(e,t){return Ki.setFromAxisAngle(e,t),this.quaternion.premultiply(Ki),this}rotateX(e){return this.rotateOnAxis(rr,e)}rotateY(e){return this.rotateOnAxis(or,e)}rotateZ(e){return this.rotateOnAxis(sr,e)}translateOnAxis(e,t){return $i.copy(e).applyQuaternion(this.quaternion),this.position.add($i.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(rr,e)}translateY(e){return this.translateOnAxis(or,e)}translateZ(e){return this.translateOnAxis(sr,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Qi.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?er.copy(e):er.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),tr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Qi.lookAt(tr,er,this.up):Qi.lookAt(er,tr,this.up),this.quaternion.setFromRotationMatrix(Qi),i&&(Qi.extractRotation(i.matrixWorld),Ki.setFromRotationMatrix(Qi),this.quaternion.premultiply(Ki.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error(\"THREE.Object3D.add: object can't be added as a child of itself.\",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ar)):console.error(\"THREE.Object3D.add: object not an instance of THREE.Object3D.\",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(lr)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(lr)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Qi.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Qi.multiply(e.parent.matrixWorld)),e.applyMatrix4(Qi),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty(\"id\",e)}getObjectByName(e){return this.getObjectByProperty(\"name\",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getWorldPosition(e){return void 0===e&&(console.warn(\"THREE.Object3D: .getWorldPosition() target is now required\"),e=new ai),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return void 0===e&&(console.warn(\"THREE.Object3D: .getWorldQuaternion() target is now required\"),e=new si),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tr,e,nr),e}getWorldScale(e){return void 0===e&&(console.warn(\"THREE.Object3D: .getWorldScale() target is now required\"),e=new ai),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tr,ir,e),e}getWorldDirection(e){void 0===e&&(console.warn(\"THREE.Object3D: .getWorldDirection() target is now required\"),e=new ai),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||\"string\"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:\"Object\",generator:\"Object3D.toJSON\"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,\"\"!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),\"{}\"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type=\"InstancedMesh\",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),s=o(e.images),a=o(e.shapes),l=o(e.skeletons),c=o(e.animations);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}cr.DefaultUp=new ai(0,1,0),cr.DefaultMatrixAutoUpdate=!0,cr.prototype.isObject3D=!0;const ur=new ai,hr=new ai,dr=new Jn;class pr{constructor(e=new ai(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=ur.subVectors(n,t).cross(hr.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn(\"THREE.Plane: .projectPoint() target is now required\"),t=new ai),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn(\"THREE.Plane: .intersectLine() target is now required\"),t=new ai);const n=e.delta(ur),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn(\"THREE.Plane: .coplanarPoint() target is now required\"),e=new ai),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||dr.getNormalMatrix(e),i=this.coplanarPoint(ur).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}pr.prototype.isPlane=!0;const fr=new ai,mr=new ai,gr=new ai,vr=new ai,yr=new ai,xr=new ai,_r=new ai,br=new ai,wr=new ai,Mr=new ai;class Sr{constructor(e=new ai,t=new ai,n=new ai){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){void 0===i&&(console.warn(\"THREE.Triangle: .getNormal() target is now required\"),i=new ai),i.subVectors(n,t),fr.subVectors(e,t),i.cross(fr);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){fr.subVectors(i,t),mr.subVectors(n,t),gr.subVectors(e,t);const o=fr.dot(fr),s=fr.dot(mr),a=fr.dot(gr),l=mr.dot(mr),c=mr.dot(gr),u=o*l-s*s;if(void 0===r&&(console.warn(\"THREE.Triangle: .getBarycoord() target is now required\"),r=new ai),0===u)return r.set(-2,-1,-1);const h=1/u,d=(l*a-s*c)*h,p=(o*c-s*a)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,vr),vr.x>=0&&vr.y>=0&&vr.x+vr.y<=1}static getUV(e,t,n,i,r,o,s,a){return this.getBarycoord(e,t,n,i,vr),a.set(0,0),a.addScaledVector(r,vr.x),a.addScaledVector(o,vr.y),a.addScaledVector(s,vr.z),a}static isFrontFacing(e,t,n,i){return fr.subVectors(n,t),mr.subVectors(e,t),fr.cross(mr).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return fr.subVectors(this.c,this.b),mr.subVectors(this.a,this.b),.5*fr.cross(mr).length()}getMidpoint(e){return void 0===e&&(console.warn(\"THREE.Triangle: .getMidpoint() target is now required\"),e=new ai),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Sr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn(\"THREE.Triangle: .getPlane() target is now required\"),e=new pr),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Sr.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return Sr.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Sr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Sr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn(\"THREE.Triangle: .closestPointToPoint() target is now required\"),t=new ai);const n=this.a,i=this.b,r=this.c;let o,s;yr.subVectors(i,n),xr.subVectors(r,n),br.subVectors(e,n);const a=yr.dot(br),l=xr.dot(br);if(a<=0&&l<=0)return t.copy(n);wr.subVectors(e,i);const c=yr.dot(wr),u=xr.dot(wr);if(c>=0&&u<=c)return t.copy(i);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return o=a/(a-c),t.copy(n).addScaledVector(yr,o);Mr.subVectors(e,r);const d=yr.dot(Mr),p=xr.dot(Mr);if(p>=0&&d<=p)return t.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(n).addScaledVector(xr,s);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return _r.subVectors(r,i),s=(u-c)/(u-c+(d-p)),t.copy(i).addScaledVector(_r,s);const g=1/(m+f+h);return o=f*g,s=h*g,t.copy(n).addScaledVector(yr,o).addScaledVector(xr,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Er=0;class Tr extends Nn{constructor(){super(),Object.defineProperty(this,\"id\",{value:Er++}),this.uuid=kn(),this.name=\"\",this.type=\"Material\",this.fog=!0,this.blending=_,this.side=f,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=O,this.blendDst=F,this.blendEquation=E,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=j,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Sn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=un,this.stencilZFail=un,this.stencilZPass=un,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(\"THREE.Material: '\"+t+\"' parameter is undefined.\");continue}if(\"shading\"===t){console.warn(\"THREE.\"+this.type+\": .shading has been removed. Use the boolean .flatShading instead.\"),this.flatShading=n===v;continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(\"THREE.\"+this.type+\": '\"+t+\"' is not a property of this material.\")}}toJSON(e){const t=void 0===e||\"string\"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:\"Material\",generator:\"Material.toJSON\"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,\"\"!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==_&&(n.blending=this.blending),this.side!==f&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),\"round\"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),\"round\"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),\"{}\"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:\"dispose\"})}set needsUpdate(e){!0===e&&this.version++}}Tr.prototype.isMaterial=!0;const Ar={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Lr={h:0,s:0,l:0},Cr={h:0,s:0,l:0};function Pr(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Rr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Dr(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Ir{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):\"number\"==typeof e?this.setHex(e):\"string\"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Hn(e,1),t=Vn(t,0,1),n=Vn(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Pr(r,i,e+1/3),this.g=Pr(r,i,e),this.b=Pr(r,i,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn(\"THREE.Color: Alpha component of \"+e+\" will be ignored.\")}let n;if(n=/^((?:rgb|hsl)a?)\\(([^\\)]*)\\)/.exec(e)){let e;const i=n[1],r=n[2];switch(i){case\"rgb\":case\"rgba\":if(e=/^\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case\"hsl\":case\"hsla\":if(e=/^\\s*(\\d*\\.?\\d+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(r)){const n=parseFloat(e[1])/360,i=parseInt(e[2],10)/100,r=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,i,r)}}}else if(n=/^\\#([A-Fa-f\\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Ar[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn(\"THREE.Color: Unknown color \"+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Rr(e.r),this.g=Rr(e.g),this.b=Rr(e.b),this}copyLinearToSRGB(e){return this.r=Dr(e.r),this.g=Dr(e.g),this.b=Dr(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return(\"000000\"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn(\"THREE.Color: .getHSL() target is now required\"),e={h:0,s:0,l:0});const t=this.r,n=this.g,i=this.b,r=Math.max(t,n,i),o=Math.min(t,n,i);let s,a;const l=(o+r)/2;if(o===r)s=0,a=0;else{const e=r-o;switch(a=l<=.5?e/(r+o):e/(2-r-o),r){case t:s=(n-i)/e+(n<i?6:0);break;case n:s=(i-t)/e+2;break;case i:s=(t-n)/e+4}s/=6}return e.h=s,e.s=a,e.l=l,e}getStyle(){return\"rgb(\"+(255*this.r|0)+\",\"+(255*this.g|0)+\",\"+(255*this.b|0)+\")\"}offsetHSL(e,t,n){return this.getHSL(Lr),Lr.h+=e,Lr.s+=t,Lr.l+=n,this.setHSL(Lr.h,Lr.s,Lr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Lr),e.getHSL(Cr);const n=jn(Lr.h,Cr.h,t),i=jn(Lr.s,Cr.s,t),r=jn(Lr.l,Cr.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Ir.NAMES=Ar,Ir.prototype.isColor=!0,Ir.prototype.r=1,Ir.prototype.g=1,Ir.prototype.b=1;class Or extends Tr{constructor(e){super(),this.type=\"MeshBasicMaterial\",this.color=new Ir(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this}}Or.prototype.isMeshBasicMaterial=!0;const Fr=new ai,Nr=new Zn;class zr{constructor(e,t,n){if(Array.isArray(e))throw new TypeError(\"THREE.BufferAttribute: array should be a Typed Array.\");this.name=\"\",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=En,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn(\"THREE.BufferAttribute.copyColorsArray(): color is undefined\",i),r=new Ir),t[n++]=r.r,t[n++]=r.g,t[n++]=r.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn(\"THREE.BufferAttribute.copyVector2sArray(): vector is undefined\",i),r=new Zn),t[n++]=r.x,t[n++]=r.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn(\"THREE.BufferAttribute.copyVector3sArray(): vector is undefined\",i),r=new ai),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn(\"THREE.BufferAttribute.copyVector4sArray(): vector is undefined\",i),r=new ni),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z,t[n++]=r.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Nr.fromBufferAttribute(this,t),Nr.applyMatrix3(e),this.setXY(t,Nr.x,Nr.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Fr.fromBufferAttribute(this,t),Fr.applyMatrix3(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Fr.x=this.getX(t),Fr.y=this.getY(t),Fr.z=this.getZ(t),Fr.applyMatrix4(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Fr.x=this.getX(t),Fr.y=this.getY(t),Fr.z=this.getZ(t),Fr.applyNormalMatrix(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Fr.x=this.getX(t),Fr.y=this.getY(t),Fr.z=this.getZ(t),Fr.transformDirection(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return\"\"!==this.name&&(e.name=this.name),this.usage!==En&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}zr.prototype.isBufferAttribute=!0;class Ur extends zr{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Br extends zr{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class Gr extends zr{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class kr extends zr{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Vr extends zr{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Hr extends zr{constructor(e,t,n){super(new Int32Array(e),t,n)}}class jr extends zr{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Wr extends zr{constructor(e,t,n){super(new Uint16Array(e),t,n)}}Wr.prototype.isFloat16BufferAttribute=!0;class qr extends zr{constructor(e,t,n){super(new Float32Array(e),t,n)}}class Xr extends zr{constructor(e,t,n){super(new Float64Array(e),t,n)}}function Yr(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}const Zr={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Jr(e,t){return new Zr[e](t)}let $r=0;const Kr=new Ui,Qr=new cr,eo=new ai,to=new ui,no=new ui,io=new ai;class ro extends Nn{constructor(){super(),Object.defineProperty(this,\"id\",{value:$r++}),this.uuid=kn(),this.name=\"\",this.type=\"BufferGeometry\",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Yr(e)>65535?jr:Vr)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Jn).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Kr.makeRotationFromQuaternion(e),this.applyMatrix4(Kr),this}rotateX(e){return Kr.makeRotationX(e),this.applyMatrix4(Kr),this}rotateY(e){return Kr.makeRotationY(e),this.applyMatrix4(Kr),this}rotateZ(e){return Kr.makeRotationZ(e),this.applyMatrix4(Kr),this}translate(e,t,n){return Kr.makeTranslation(e,t,n),this.applyMatrix4(Kr),this}scale(e,t,n){return Kr.makeScale(e,t,n),this.applyMatrix4(Kr),this}lookAt(e){return Qr.lookAt(e),Qr.updateMatrix(),this.applyMatrix4(Qr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(eo).negate(),this.translate(eo.x,eo.y,eo.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute(\"position\",new qr(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ui);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set \"mesh.frustumCulled\" to \"false\".',this),void this.boundingBox.set(new ai(-1/0,-1/0,-1/0),new ai(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];to.setFromBufferAttribute(n),this.morphTargetsRelative?(io.addVectors(this.boundingBox.min,to.min),this.boundingBox.expandByPoint(io),io.addVectors(this.boundingBox.max,to.max),this.boundingBox.expandByPoint(io)):(this.boundingBox.expandByPoint(to.min),this.boundingBox.expandByPoint(to.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ci);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set \"mesh.frustumCulled\" to \"false\".',this),void this.boundingSphere.set(new ai,1/0);if(e){const n=this.boundingSphere.center;if(to.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];no.setFromBufferAttribute(n),this.morphTargetsRelative?(io.addVectors(to.min,no.min),to.expandByPoint(io),io.addVectors(to.max,no.max),to.expandByPoint(io)):(to.expandByPoint(no.min),to.expandByPoint(no.max))}to.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)io.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(io));if(t)for(let r=0,o=t.length;r<o;r++){const o=t[r],s=this.morphTargetsRelative;for(let t=0,r=o.count;t<r;t++)io.fromBufferAttribute(o,t),s&&(eo.fromBufferAttribute(e,t),io.add(eo)),i=Math.max(i,n.distanceToSquared(io))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error(\"THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)\");const n=e.array,i=t.position.array,r=t.normal.array,o=t.uv.array,s=i.length/3;void 0===t.tangent&&this.setAttribute(\"tangent\",new zr(new Float32Array(4*s),4));const a=t.tangent.array,l=[],c=[];for(let e=0;e<s;e++)l[e]=new ai,c[e]=new ai;const u=new ai,h=new ai,d=new ai,p=new Zn,f=new Zn,m=new Zn,g=new ai,v=new ai;function y(e,t,n){u.fromArray(i,3*e),h.fromArray(i,3*t),d.fromArray(i,3*n),p.fromArray(o,2*e),f.fromArray(o,2*t),m.fromArray(o,2*n),h.sub(u),d.sub(u),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(v),c[t].add(v),c[n].add(v))}let x=this.groups;0===x.length&&(x=[{start:0,count:n.length}]);for(let e=0,t=x.length;e<t;++e){const t=x[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)y(n[e+0],n[e+1],n[e+2])}const _=new ai,b=new ai,w=new ai,M=new ai;function S(e){w.fromArray(r,3*e),M.copy(w);const t=l[e];_.copy(t),_.sub(w.multiplyScalar(w.dot(t))).normalize(),b.crossVectors(M,t);const n=b.dot(c[e])<0?-1:1;a[4*e]=_.x,a[4*e+1]=_.y,a[4*e+2]=_.z,a[4*e+3]=n}for(let e=0,t=x.length;e<t;++e){const t=x[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)S(n[e+0]),S(n[e+1]),S(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute(\"position\");if(void 0!==t){let n=this.getAttribute(\"normal\");if(void 0===n)n=new zr(new Float32Array(3*t.count),3),this.setAttribute(\"normal\",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new ai,r=new ai,o=new ai,s=new ai,a=new ai,l=new ai,c=new ai,u=new ai;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),o.fromBufferAttribute(t,f),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),s.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(c),a.add(c),l.add(c),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,s=t.count;e<s;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error(\"THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.\",e);void 0===t&&(t=0,console.warn(\"THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge.\"));const n=this.attributes;for(const i in n){if(void 0===e.attributes[i])continue;const r=n[i].array,o=e.attributes[i],s=o.array,a=o.itemSize*t,l=Math.min(s.length,r.length-a);for(let e=0,t=a;e<l;e++,t++)r[t]=s[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)io.fromBufferAttribute(e,t),io.normalize(),e.setXYZ(t,io.x,io.y,io.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i);let s=0,a=0;for(let e=0,r=t.length;e<r;e++){s=t[e]*i;for(let e=0;e<i;e++)o[a++]=n[s++]}return new zr(o,i,r)}if(null===this.index)return console.warn(\"THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed.\"),this;const t=new ro,n=this.index.array,i=this.attributes;for(const r in i){const o=e(i[r],n);t.setAttribute(r,o)}const r=this.morphAttributes;for(const i in r){const o=[],s=r[i];for(let t=0,i=s.length;t<i;t++){const i=e(s[t],n);o.push(i)}t.morphAttributes[i]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:\"BufferGeometry\",generator:\"BufferGeometry.toJSON\"}};if(e.uuid=this.uuid,e.type=this.type,\"\"!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];o.push(i.toJSON(e.data))}o.length>0&&(i[t]=o,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new ro).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:\"dispose\"})}}ro.prototype.isBufferGeometry=!0;const oo=new Ui,so=new zi,ao=new Ci,lo=new ai,co=new ai,uo=new ai,ho=new ai,po=new ai,fo=new ai,mo=new ai,go=new ai,vo=new ai,yo=new Zn,xo=new Zn,_o=new Zn,bo=new ai,wo=new ai;class Mo extends cr{constructor(e=new ro,t=new Or){super(),this.type=\"Mesh\",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error(\"THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\")}}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),ao.copy(n.boundingSphere),ao.applyMatrix4(r),!1===e.ray.intersectsSphere(ao))return;if(oo.copy(r).invert(),so.copy(e.ray).applyMatrix4(oo),null!==n.boundingBox&&!1===so.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const r=n.index,s=n.attributes.position,a=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,u=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==r)if(Array.isArray(i))for(let n=0,p=h.length;n<p;n++){const p=h[n],f=i[p.materialIndex];for(let n=Math.max(p.start,d.start),i=Math.min(p.start+p.count,d.start+d.count);n<i;n+=3){const i=r.getX(n),h=r.getX(n+1),d=r.getX(n+2);o=So(this,f,e,so,s,a,l,c,u,i,h,d),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=p.materialIndex,t.push(o))}}else for(let n=Math.max(0,d.start),h=Math.min(r.count,d.start+d.count);n<h;n+=3){const h=r.getX(n),d=r.getX(n+1),p=r.getX(n+2);o=So(this,i,e,so,s,a,l,c,u,h,d,p),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(void 0!==s)if(Array.isArray(i))for(let n=0,r=h.length;n<r;n++){const r=h[n],p=i[r.materialIndex];for(let n=Math.max(r.start,d.start),i=Math.min(r.start+r.count,d.start+d.count);n<i;n+=3)o=So(this,p,e,so,s,a,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=r.materialIndex,t.push(o))}else for(let n=Math.max(0,d.start),r=Math.min(s.count,d.start+d.count);n<r;n+=3)o=So(this,i,e,so,s,a,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else n.isGeometry&&console.error(\"THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\")}}function So(e,t,n,i,r,o,s,a,l,c,u,h){lo.fromBufferAttribute(r,c),co.fromBufferAttribute(r,u),uo.fromBufferAttribute(r,h);const d=e.morphTargetInfluences;if(t.morphTargets&&o&&d){mo.set(0,0,0),go.set(0,0,0),vo.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=d[e],n=o[e];0!==t&&(ho.fromBufferAttribute(n,c),po.fromBufferAttribute(n,u),fo.fromBufferAttribute(n,h),s?(mo.addScaledVector(ho,t),go.addScaledVector(po,t),vo.addScaledVector(fo,t)):(mo.addScaledVector(ho.sub(lo),t),go.addScaledVector(po.sub(co),t),vo.addScaledVector(fo.sub(uo),t)))}lo.add(mo),co.add(go),uo.add(vo)}e.isSkinnedMesh&&(e.boneTransform(c,lo),e.boneTransform(u,co),e.boneTransform(h,uo));const p=function(e,t,n,i,r,o,s,a){let l;if(l=t.side===m?i.intersectTriangle(s,o,r,!0,a):i.intersectTriangle(r,o,s,t.side!==g,a),null===l)return null;wo.copy(a),wo.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(wo);return c<n.near||c>n.far?null:{distance:c,point:wo.clone(),object:e}}(e,t,n,i,lo,co,uo,bo);if(p){a&&(yo.fromBufferAttribute(a,c),xo.fromBufferAttribute(a,u),_o.fromBufferAttribute(a,h),p.uv=Sr.getUV(bo,lo,co,uo,yo,xo,_o,new Zn)),l&&(yo.fromBufferAttribute(l,c),xo.fromBufferAttribute(l,u),_o.fromBufferAttribute(l,h),p.uv2=Sr.getUV(bo,lo,co,uo,yo,xo,_o,new Zn));const e={a:c,b:u,c:h,normal:new ai,materialIndex:0};Sr.getNormal(lo,co,uo,e.normal),p.face=e}return p}Mo.prototype.isMesh=!0;class Eo extends ro{constructor(e=1,t=1,n=1,i=1,r=1,o=1){super(),this.type=\"BoxGeometry\",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const s=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const a=[],l=[],c=[],u=[];let h=0,d=0;function p(e,t,n,i,r,o,p,f,m,g,v){const y=o/m,x=p/g,_=o/2,b=p/2,w=f/2,M=m+1,S=g+1;let E=0,T=0;const A=new ai;for(let o=0;o<S;o++){const s=o*x-b;for(let a=0;a<M;a++){const h=a*y-_;A[e]=h*i,A[t]=s*r,A[n]=w,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=f>0?1:-1,c.push(A.x,A.y,A.z),u.push(a/m),u.push(1-o/g),E+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+M*e,i=h+t+M*(e+1),r=h+(t+1)+M*(e+1),o=h+(t+1)+M*e;a.push(n,i,o),a.push(i,r,o),T+=6}s.addGroup(d,T,v),d+=T,h+=E}p(\"z\",\"y\",\"x\",-1,-1,n,t,e,o,r,0),p(\"z\",\"y\",\"x\",1,-1,n,t,-e,o,r,1),p(\"x\",\"z\",\"y\",1,1,e,n,t,i,o,2),p(\"x\",\"z\",\"y\",1,-1,e,n,-t,i,o,3),p(\"x\",\"y\",\"z\",1,-1,e,t,n,i,r,4),p(\"x\",\"y\",\"z\",-1,-1,e,t,-n,i,r,5),this.setIndex(a),this.setAttribute(\"position\",new qr(l,3)),this.setAttribute(\"normal\",new qr(c,3)),this.setAttribute(\"uv\",new qr(u,2))}}function To(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function Ao(e){const t={};for(let n=0;n<e.length;n++){const i=To(e[n]);for(const e in i)t[e]=i[e]}return t}const Lo={clone:To,merge:Ao};class Co extends Tr{constructor(e){super(),this.type=\"ShaderMaterial\",this.defines={},this.uniforms={},this.vertexShader=\"void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}\",this.fragmentShader=\"void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}\",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error(\"THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.\"),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=To(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:\"t\",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:\"c\",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:\"v2\",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:\"v3\",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:\"v4\",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:\"m3\",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:\"m4\",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}Co.prototype.isShaderMaterial=!0;class Po extends cr{constructor(){super(),this.type=\"Camera\",this.matrixWorldInverse=new Ui,this.projectionMatrix=new Ui,this.projectionMatrixInverse=new Ui}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){void 0===e&&(console.warn(\"THREE.Camera: .getWorldDirection() target is now required\"),e=new ai),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Po.prototype.isCamera=!0;class Ro extends Po{constructor(e=50,t=1,n=.1,i=2e3){super(),this.type=\"PerspectiveCamera\",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Gn*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Bn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Gn*Math.atan(Math.tan(.5*Bn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Bn*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;r+=o.offsetX*i/e,t-=o.offsetY*n/s,i*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Ro.prototype.isPerspectiveCamera=!0;const Do=90;class Io extends cr{constructor(e,t,n){if(super(),this.type=\"CubeCamera\",!0!==n.isWebGLCubeRenderTarget)return void console.error(\"THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.\");this.renderTarget=n;const i=new Ro(Do,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new ai(1,0,0)),this.add(i);const r=new Ro(Do,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new ai(-1,0,0)),this.add(r);const o=new Ro(Do,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new ai(0,1,0)),this.add(o);const s=new Ro(Do,1,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new ai(0,-1,0)),this.add(s);const a=new Ro(Do,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new ai(0,0,1)),this.add(a);const l=new Ro(Do,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new ai(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,o,s,a,l]=this.children,c=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,a),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=c}}class Oo extends ei{constructor(e,t,n,i,r,o,s,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:oe,n,i,r,o,s=void 0!==s?s:ze,a,l,c),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Oo.prototype.isCubeTexture=!0;class Fo extends ii{constructor(e,t,n){Number.isInteger(t)&&(console.warn(\"THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )\"),t=n),super(e,e,t),t=t||{},this.texture=new Oo(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:xe,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Ue,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},i=\"\\n\\n\\t\\t\\t\\tvarying vec3 vWorldDirection;\\n\\n\\t\\t\\t\\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\\n\\n\\t\\t\\t\\t\\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\\n\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\t\\tvWorldDirection = transformDirection( position, modelMatrix );\\n\\n\\t\\t\\t\\t\\t#include <begin_vertex>\\n\\t\\t\\t\\t\\t#include <project_vertex>\\n\\n\\t\\t\\t\\t}\\n\\t\\t\\t\",r=\"\\n\\n\\t\\t\\t\\tuniform sampler2D tEquirect;\\n\\n\\t\\t\\t\\tvarying vec3 vWorldDirection;\\n\\n\\t\\t\\t\\t#include <common>\\n\\n\\t\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\t\\tvec3 direction = normalize( vWorldDirection );\\n\\n\\t\\t\\t\\t\\tvec2 sampleUV = equirectUv( direction );\\n\\n\\t\\t\\t\\t\\tgl_FragColor = texture2D( tEquirect, sampleUV );\\n\\n\\t\\t\\t\\t}\\n\\t\\t\\t\",o=new Eo(5,5,5),s=new Co({name:\"CubemapFromEquirect\",uniforms:To(n),vertexShader:i,fragmentShader:r,side:m,blending:x});s.uniforms.tEquirect.value=t;const a=new Mo(o,s),l=t.minFilter;return t.minFilter===we&&(t.minFilter=xe),new Io(1,10,this).update(e,a),t.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(r)}}Fo.prototype.isWebGLCubeRenderTarget=!0;const No=new Ci,zo=new ai;class Uo{constructor(e=new pr,t=new pr,n=new pr,i=new pr,r=new pr,o=new pr){this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],s=n[3],a=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(s-i,u-a,f-h,y-m).normalize(),t[1].setComponents(s+i,u+a,f+h,y+m).normalize(),t[2].setComponents(s+r,u+l,f+d,y+g).normalize(),t[3].setComponents(s-r,u-l,f-d,y-g).normalize(),t[4].setComponents(s-o,u-c,f-p,y-v).normalize(),t[5].setComponents(s+o,u+c,f+p,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),No.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(No)}intersectsSprite(e){return No.center.set(0,0,0),No.radius=.7071067811865476,No.applyMatrix4(e.matrixWorld),this.intersectsSphere(No)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(zo.x=i.normal.x>0?e.max.x:e.min.x,zo.y=i.normal.y>0?e.max.y:e.min.y,zo.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(zo)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Bo(){let e=null,t=!1,n=null,i=null;function r(t,o){n(t,o),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Go(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=i.get(t);void 0===o?i.set(t,function(t,i){const r=t.array,o=t.usage,s=e.createBuffer();e.bindBuffer(i,s),e.bufferData(i,r,o),t.onUploadCallback();let a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn(\"THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.\"):r instanceof Uint16Array?t.isFloat16BufferAttribute?n?a=5131:console.warn(\"THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.\"):a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(a=5121),{buffer:s,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):o.version<t.version&&(function(t,i,r){const o=i.array,s=i.updateRange;e.bindBuffer(r,t),-1===s.count?e.bufferSubData(r,0,o):(n?e.bufferSubData(r,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):e.bufferSubData(r,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}(o.buffer,t,r),o.version=t.version)}}}class ko extends ro{constructor(e=1,t=1,n=1,i=1){super(),this.type=\"PlaneGeometry\",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,o=t/2,s=Math.floor(n),a=Math.floor(i),l=s+1,c=a+1,u=e/s,h=t/a,d=[],p=[],f=[],m=[];for(let e=0;e<c;e++){const t=e*h-o;for(let n=0;n<l;n++){const i=n*u-r;p.push(i,-t,0),f.push(0,0,1),m.push(n/s),m.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<s;t++){const n=t+l*e,i=t+l*(e+1),r=t+1+l*(e+1),o=t+1+l*e;d.push(n,i,o),d.push(i,r,o)}this.setIndex(d),this.setAttribute(\"position\",new qr(p,3)),this.setAttribute(\"normal\",new qr(f,3)),this.setAttribute(\"uv\",new qr(m,2))}}const Vo={alphamap_fragment:\"#ifdef USE_ALPHAMAP\\n\\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n#endif\",alphamap_pars_fragment:\"#ifdef USE_ALPHAMAP\\n\\tuniform sampler2D alphaMap;\\n#endif\",alphatest_fragment:\"#ifdef ALPHATEST\\n\\tif ( diffuseColor.a < ALPHATEST ) discard;\\n#endif\",aomap_fragment:\"#ifdef USE_AOMAP\\n\\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\\n\\treflectedLight.indirectDiffuse *= ambientOcclusion;\\n\\t#if defined( USE_ENVMAP ) && defined( STANDARD )\\n\\t\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\t\\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\\n\\t#endif\\n#endif\",aomap_pars_fragment:\"#ifdef USE_AOMAP\\n\\tuniform sampler2D aoMap;\\n\\tuniform float aoMapIntensity;\\n#endif\",begin_vertex:\"vec3 transformed = vec3( position );\",beginnormal_vertex:\"vec3 objectNormal = vec3( normal );\\n#ifdef USE_TANGENT\\n\\tvec3 objectTangent = vec3( tangent.xyz );\\n#endif\",bsdfs:\"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\\n\\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\\n\\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\\n\\tvec4 r = roughness * c0 + c1;\\n\\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\\n\\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\\n}\\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\\n\\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\\n\\tif( cutoffDistance > 0.0 ) {\\n\\t\\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\\n\\t}\\n\\treturn distanceFalloff;\\n#else\\n\\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\\n\\t\\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\\n\\t}\\n\\treturn 1.0;\\n#endif\\n}\\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\\n\\treturn RECIPROCAL_PI * diffuseColor;\\n}\\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\\n\\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\\n\\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\\n}\\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\\n\\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\\n\\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\\n\\treturn Fr * fresnel + F0;\\n}\\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\treturn 1.0 / ( gl * gv );\\n}\\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\treturn 0.5 / max( gv + gl, EPSILON );\\n}\\nfloat D_GGX( const in float alpha, const in float dotNH ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\\n\\treturn RECIPROCAL_PI * a2 / pow2( denom );\\n}\\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat alpha = pow2( roughness );\\n\\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\\n\\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\\n\\tfloat dotNV = saturate( dot( normal, viewDir ) );\\n\\tfloat dotNH = saturate( dot( normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\\n\\tfloat D = D_GGX( alpha, dotNH );\\n\\treturn F * ( G * D );\\n}\\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\\n\\tconst float LUT_SIZE = 64.0;\\n\\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\\n\\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\\n\\tfloat dotNV = saturate( dot( N, V ) );\\n\\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\\n\\tuv = uv * LUT_SCALE + LUT_BIAS;\\n\\treturn uv;\\n}\\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\\n\\tfloat l = length( f );\\n\\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\\n}\\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\\n\\tfloat x = dot( v1, v2 );\\n\\tfloat y = abs( x );\\n\\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\\n\\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\\n\\tfloat v = a / b;\\n\\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\\n\\treturn cross( v1, v2 ) * theta_sintheta;\\n}\\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\\n\\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\\n\\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\\n\\tvec3 lightNormal = cross( v1, v2 );\\n\\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\\n\\tvec3 T1, T2;\\n\\tT1 = normalize( V - N * dot( V, N ) );\\n\\tT2 = - cross( N, T1 );\\n\\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\\n\\tvec3 coords[ 4 ];\\n\\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\\n\\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\\n\\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\\n\\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\\n\\tcoords[ 0 ] = normalize( coords[ 0 ] );\\n\\tcoords[ 1 ] = normalize( coords[ 1 ] );\\n\\tcoords[ 2 ] = normalize( coords[ 2 ] );\\n\\tcoords[ 3 ] = normalize( coords[ 3 ] );\\n\\tvec3 vectorFormFactor = vec3( 0.0 );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\\n\\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\\n\\treturn vec3( result );\\n}\\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat dotNV = saturate( dot( normal, viewDir ) );\\n\\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\\n\\treturn specularColor * brdf.x + brdf.y;\\n}\\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\\n\\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\\n\\tvec3 FssEss = F * brdf.x + brdf.y;\\n\\tfloat Ess = brdf.x + brdf.y;\\n\\tfloat Ems = 1.0 - Ess;\\n\\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\\n\\tsingleScatter += FssEss;\\n\\tmultiScatter += Fms * Ems;\\n}\\nfloat G_BlinnPhong_Implicit( ) {\\n\\treturn 0.25;\\n}\\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\\n\\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\\n}\\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_BlinnPhong_Implicit( );\\n\\tfloat D = D_BlinnPhong( shininess, dotNH );\\n\\treturn F * ( G * D );\\n}\\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\\n\\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\\n}\\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\\n\\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\\n}\\n#if defined( USE_SHEEN )\\nfloat D_Charlie(float roughness, float NoH) {\\n\\tfloat invAlpha = 1.0 / roughness;\\n\\tfloat cos2h = NoH * NoH;\\n\\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\\n}\\nfloat V_Neubelt(float NoV, float NoL) {\\n\\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\\n}\\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\\n\\tvec3 N = geometry.normal;\\n\\tvec3 V = geometry.viewDir;\\n\\tvec3 H = normalize( V + L );\\n\\tfloat dotNH = saturate( dot( N, H ) );\\n\\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\\n}\\n#endif\",bumpmap_pars_fragment:\"#ifdef USE_BUMPMAP\\n\\tuniform sampler2D bumpMap;\\n\\tuniform float bumpScale;\\n\\tvec2 dHdxy_fwd() {\\n\\t\\tvec2 dSTdx = dFdx( vUv );\\n\\t\\tvec2 dSTdy = dFdy( vUv );\\n\\t\\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\\t\\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\\t\\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\t\\treturn vec2( dBx, dBy );\\n\\t}\\n\\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\\n\\t\\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\\n\\t\\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\\n\\t\\tvec3 vN = surf_norm;\\n\\t\\tvec3 R1 = cross( vSigmaY, vN );\\n\\t\\tvec3 R2 = cross( vN, vSigmaX );\\n\\t\\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\\n\\t\\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\\t\\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\t}\\n#endif\",clipping_planes_fragment:\"#if NUM_CLIPPING_PLANES > 0\\n\\tvec4 plane;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\\n\\t\\tplane = clippingPlanes[ i ];\\n\\t\\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\\n\\t\\tbool clipped = true;\\n\\t\\t#pragma unroll_loop_start\\n\\t\\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\\n\\t\\t\\tplane = clippingPlanes[ i ];\\n\\t\\t\\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\\n\\t\\t}\\n\\t\\t#pragma unroll_loop_end\\n\\t\\tif ( clipped ) discard;\\n\\t#endif\\n#endif\",clipping_planes_pars_fragment:\"#if NUM_CLIPPING_PLANES > 0\\n\\tvarying vec3 vClipPosition;\\n\\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\\n#endif\",clipping_planes_pars_vertex:\"#if NUM_CLIPPING_PLANES > 0\\n\\tvarying vec3 vClipPosition;\\n#endif\",clipping_planes_vertex:\"#if NUM_CLIPPING_PLANES > 0\\n\\tvClipPosition = - mvPosition.xyz;\\n#endif\",color_fragment:\"#if defined( USE_COLOR_ALPHA )\\n\\tdiffuseColor *= vColor;\\n#elif defined( USE_COLOR )\\n\\tdiffuseColor.rgb *= vColor;\\n#endif\",color_pars_fragment:\"#if defined( USE_COLOR_ALPHA )\\n\\tvarying vec4 vColor;\\n#elif defined( USE_COLOR )\\n\\tvarying vec3 vColor;\\n#endif\",color_pars_vertex:\"#if defined( USE_COLOR_ALPHA )\\n\\tvarying vec4 vColor;\\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\\n\\tvarying vec3 vColor;\\n#endif\",color_vertex:\"#if defined( USE_COLOR_ALPHA )\\n\\tvColor = vec4( 1.0 );\\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\\n\\tvColor = vec3( 1.0 );\\n#endif\\n#ifdef USE_COLOR\\n\\tvColor *= color;\\n#endif\\n#ifdef USE_INSTANCING_COLOR\\n\\tvColor.xyz *= instanceColor.xyz;\\n#endif\",common:\"#define PI 3.141592653589793\\n#define PI2 6.283185307179586\\n#define PI_HALF 1.5707963267948966\\n#define RECIPROCAL_PI 0.3183098861837907\\n#define RECIPROCAL_PI2 0.15915494309189535\\n#define EPSILON 1e-6\\n#ifndef saturate\\n#define saturate(a) clamp( a, 0.0, 1.0 )\\n#endif\\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\\nfloat pow2( const in float x ) { return x*x; }\\nfloat pow3( const in float x ) { return x*x*x; }\\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\\nhighp float rand( const in vec2 uv ) {\\n\\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\\n\\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\\n\\treturn fract(sin(sn) * c);\\n}\\n#ifdef HIGH_PRECISION\\n\\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\\n#else\\n\\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\\n\\tfloat precisionSafeLength( vec3 v ) {\\n\\t\\tfloat maxComponent = max3( abs( v ) );\\n\\t\\treturn length( v / maxComponent ) * maxComponent;\\n\\t}\\n#endif\\nstruct IncidentLight {\\n\\tvec3 color;\\n\\tvec3 direction;\\n\\tbool visible;\\n};\\nstruct ReflectedLight {\\n\\tvec3 directDiffuse;\\n\\tvec3 directSpecular;\\n\\tvec3 indirectDiffuse;\\n\\tvec3 indirectSpecular;\\n};\\nstruct GeometricContext {\\n\\tvec3 position;\\n\\tvec3 normal;\\n\\tvec3 viewDir;\\n#ifdef CLEARCOAT\\n\\tvec3 clearcoatNormal;\\n#endif\\n};\\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\\n}\\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\tfloat distance = dot( planeNormal, point - pointOnPlane );\\n\\treturn - distance * planeNormal + point;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\\n}\\nmat3 transposeMat3( const in mat3 m ) {\\n\\tmat3 tmp;\\n\\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\\n\\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\\n\\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\\n\\treturn tmp;\\n}\\nfloat linearToRelativeLuminance( const in vec3 color ) {\\n\\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\\n\\treturn dot( weights, color.rgb );\\n}\\nbool isPerspectiveMatrix( mat4 m ) {\\n\\treturn m[ 2 ][ 3 ] == - 1.0;\\n}\\nvec2 equirectUv( in vec3 dir ) {\\n\\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\\n\\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\\n\\treturn vec2( u, v );\\n}\",cube_uv_reflection_fragment:\"#ifdef ENVMAP_TYPE_CUBE_UV\\n\\t#define cubeUV_maxMipLevel 8.0\\n\\t#define cubeUV_minMipLevel 4.0\\n\\t#define cubeUV_maxTileSize 256.0\\n\\t#define cubeUV_minTileSize 16.0\\n\\tfloat getFace( vec3 direction ) {\\n\\t\\tvec3 absDirection = abs( direction );\\n\\t\\tfloat face = - 1.0;\\n\\t\\tif ( absDirection.x > absDirection.z ) {\\n\\t\\t\\tif ( absDirection.x > absDirection.y )\\n\\t\\t\\t\\tface = direction.x > 0.0 ? 0.0 : 3.0;\\n\\t\\t\\telse\\n\\t\\t\\t\\tface = direction.y > 0.0 ? 1.0 : 4.0;\\n\\t\\t} else {\\n\\t\\t\\tif ( absDirection.z > absDirection.y )\\n\\t\\t\\t\\tface = direction.z > 0.0 ? 2.0 : 5.0;\\n\\t\\t\\telse\\n\\t\\t\\t\\tface = direction.y > 0.0 ? 1.0 : 4.0;\\n\\t\\t}\\n\\t\\treturn face;\\n\\t}\\n\\tvec2 getUV( vec3 direction, float face ) {\\n\\t\\tvec2 uv;\\n\\t\\tif ( face == 0.0 ) {\\n\\t\\t\\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\\n\\t\\t} else if ( face == 1.0 ) {\\n\\t\\t\\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\\n\\t\\t} else if ( face == 2.0 ) {\\n\\t\\t\\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\\n\\t\\t} else if ( face == 3.0 ) {\\n\\t\\t\\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\\n\\t\\t} else if ( face == 4.0 ) {\\n\\t\\t\\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\\n\\t\\t} else {\\n\\t\\t\\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\\n\\t\\t}\\n\\t\\treturn 0.5 * ( uv + 1.0 );\\n\\t}\\n\\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\\n\\t\\tfloat face = getFace( direction );\\n\\t\\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\\n\\t\\tmipInt = max( mipInt, cubeUV_minMipLevel );\\n\\t\\tfloat faceSize = exp2( mipInt );\\n\\t\\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\\n\\t\\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\\n\\t\\tvec2 f = fract( uv );\\n\\t\\tuv += 0.5 - f;\\n\\t\\tif ( face > 2.0 ) {\\n\\t\\t\\tuv.y += faceSize;\\n\\t\\t\\tface -= 3.0;\\n\\t\\t}\\n\\t\\tuv.x += face * faceSize;\\n\\t\\tif ( mipInt < cubeUV_maxMipLevel ) {\\n\\t\\t\\tuv.y += 2.0 * cubeUV_maxTileSize;\\n\\t\\t}\\n\\t\\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\\n\\t\\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\\n\\t\\tuv *= texelSize;\\n\\t\\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\\n\\t\\tuv.x += texelSize;\\n\\t\\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\\n\\t\\tuv.y += texelSize;\\n\\t\\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\\n\\t\\tuv.x -= texelSize;\\n\\t\\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\\n\\t\\tvec3 tm = mix( tl, tr, f.x );\\n\\t\\tvec3 bm = mix( bl, br, f.x );\\n\\t\\treturn mix( tm, bm, f.y );\\n\\t}\\n\\t#define r0 1.0\\n\\t#define v0 0.339\\n\\t#define m0 - 2.0\\n\\t#define r1 0.8\\n\\t#define v1 0.276\\n\\t#define m1 - 1.0\\n\\t#define r4 0.4\\n\\t#define v4 0.046\\n\\t#define m4 2.0\\n\\t#define r5 0.305\\n\\t#define v5 0.016\\n\\t#define m5 3.0\\n\\t#define r6 0.21\\n\\t#define v6 0.0038\\n\\t#define m6 4.0\\n\\tfloat roughnessToMip( float roughness ) {\\n\\t\\tfloat mip = 0.0;\\n\\t\\tif ( roughness >= r1 ) {\\n\\t\\t\\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\\n\\t\\t} else if ( roughness >= r4 ) {\\n\\t\\t\\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\\n\\t\\t} else if ( roughness >= r5 ) {\\n\\t\\t\\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\\n\\t\\t} else if ( roughness >= r6 ) {\\n\\t\\t\\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\\n\\t\\t} else {\\n\\t\\t\\tmip = - 2.0 * log2( 1.16 * roughness );\\t\\t}\\n\\t\\treturn mip;\\n\\t}\\n\\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\\n\\t\\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\\n\\t\\tfloat mipF = fract( mip );\\n\\t\\tfloat mipInt = floor( mip );\\n\\t\\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\\n\\t\\tif ( mipF == 0.0 ) {\\n\\t\\t\\treturn vec4( color0, 1.0 );\\n\\t\\t} else {\\n\\t\\t\\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\\n\\t\\t\\treturn vec4( mix( color0, color1, mipF ), 1.0 );\\n\\t\\t}\\n\\t}\\n#endif\",defaultnormal_vertex:\"vec3 transformedNormal = objectNormal;\\n#ifdef USE_INSTANCING\\n\\tmat3 m = mat3( instanceMatrix );\\n\\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\\n\\ttransformedNormal = m * transformedNormal;\\n#endif\\ntransformedNormal = normalMatrix * transformedNormal;\\n#ifdef FLIP_SIDED\\n\\ttransformedNormal = - transformedNormal;\\n#endif\\n#ifdef USE_TANGENT\\n\\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\\n\\t#ifdef FLIP_SIDED\\n\\t\\ttransformedTangent = - transformedTangent;\\n\\t#endif\\n#endif\",displacementmap_pars_vertex:\"#ifdef USE_DISPLACEMENTMAP\\n\\tuniform sampler2D displacementMap;\\n\\tuniform float displacementScale;\\n\\tuniform float displacementBias;\\n#endif\",displacementmap_vertex:\"#ifdef USE_DISPLACEMENTMAP\\n\\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\\n#endif\",emissivemap_fragment:\"#ifdef USE_EMISSIVEMAP\\n\\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\\n\\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\\n\\ttotalEmissiveRadiance *= emissiveColor.rgb;\\n#endif\",emissivemap_pars_fragment:\"#ifdef USE_EMISSIVEMAP\\n\\tuniform sampler2D emissiveMap;\\n#endif\",encodings_fragment:\"gl_FragColor = linearToOutputTexel( gl_FragColor );\",encodings_pars_fragment:\"\\nvec4 LinearToLinear( in vec4 value ) {\\n\\treturn value;\\n}\\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\\n\\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\\n}\\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\\n\\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\\n}\\nvec4 sRGBToLinear( in vec4 value ) {\\n\\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\\n}\\nvec4 LinearTosRGB( in vec4 value ) {\\n\\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\\n}\\nvec4 RGBEToLinear( in vec4 value ) {\\n\\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\\n}\\nvec4 LinearToRGBE( in vec4 value ) {\\n\\tfloat maxComponent = max( max( value.r, value.g ), value.b );\\n\\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\\n\\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\\n}\\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\\n\\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\\n}\\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\\n\\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\\n\\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\\n\\tM = ceil( M * 255.0 ) / 255.0;\\n\\treturn vec4( value.rgb / ( M * maxRange ), M );\\n}\\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\\n\\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\\n}\\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\\n\\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\\n\\tfloat D = max( maxRange / maxRGB, 1.0 );\\n\\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\\n\\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\\n}\\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\\nvec4 LinearToLogLuv( in vec4 value ) {\\n\\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\\n\\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\\n\\tvec4 vResult;\\n\\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\\n\\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\\n\\tvResult.w = fract( Le );\\n\\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\\n\\treturn vResult;\\n}\\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\\nvec4 LogLuvToLinear( in vec4 value ) {\\n\\tfloat Le = value.z * 255.0 + value.w;\\n\\tvec3 Xp_Y_XYZp;\\n\\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\\n\\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\\n\\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\\n\\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\\n\\treturn vec4( max( vRGB, 0.0 ), 1.0 );\\n}\",envmap_fragment:\"#ifdef USE_ENVMAP\\n\\t#ifdef ENV_WORLDPOS\\n\\t\\tvec3 cameraToFrag;\\n\\t\\tif ( isOrthographic ) {\\n\\t\\t\\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\\n\\t\\t} else {\\n\\t\\t\\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\\n\\t\\t}\\n\\t\\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#else\\n\\t\\tvec3 reflectVec = vReflect;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\\n\\t#else\\n\\t\\tvec4 envColor = vec4( 0.0 );\\n\\t#endif\\n\\t#ifndef ENVMAP_TYPE_CUBE_UV\\n\\t\\tenvColor = envMapTexelToLinear( envColor );\\n\\t#endif\\n\\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\t\\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\t\\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\t\\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\t#endif\\n#endif\",envmap_common_pars_fragment:\"#ifdef USE_ENVMAP\\n\\tuniform float envMapIntensity;\\n\\tuniform float flipEnvMap;\\n\\tuniform int maxMipLevel;\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tuniform samplerCube envMap;\\n\\t#else\\n\\t\\tuniform sampler2D envMap;\\n\\t#endif\\n\\t\\n#endif\",envmap_pars_fragment:\"#ifdef USE_ENVMAP\\n\\tuniform float reflectivity;\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\t#define ENV_WORLDPOS\\n\\t#endif\\n\\t#ifdef ENV_WORLDPOS\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t\\tuniform float refractionRatio;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t#endif\\n#endif\",envmap_pars_vertex:\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\\n\\t\\t#define ENV_WORLDPOS\\n\\t#endif\\n\\t#ifdef ENV_WORLDPOS\\n\\t\\t\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t\\tuniform float refractionRatio;\\n\\t#endif\\n#endif\",envmap_physical_pars_fragment:\"#if defined( USE_ENVMAP )\\n\\t#ifdef ENVMAP_MODE_REFRACTION\\n\\t\\tuniform float refractionRatio;\\n\\t#endif\\n\\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\\n\\t\\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\\n\\t\\t#else\\n\\t\\t\\tvec4 envMapColor = vec4( 0.0 );\\n\\t\\t#endif\\n\\t\\treturn PI * envMapColor.rgb * envMapIntensity;\\n\\t}\\n\\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\\n\\t\\tfloat maxMIPLevelScalar = float( maxMIPLevel );\\n\\t\\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\\n\\t\\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\\n\\t\\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\\n\\t}\\n\\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( -viewDir, normal );\\n\\t\\t\\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\\n\\t\\t#endif\\n\\t\\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\\n\\t\\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\\n\\t\\t#endif\\n\\t\\treturn envMapColor.rgb * envMapIntensity;\\n\\t}\\n#endif\",envmap_vertex:\"#ifdef USE_ENVMAP\\n\\t#ifdef ENV_WORLDPOS\\n\\t\\tvWorldPosition = worldPosition.xyz;\\n\\t#else\\n\\t\\tvec3 cameraToVertex;\\n\\t\\tif ( isOrthographic ) {\\n\\t\\t\\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\\n\\t\\t} else {\\n\\t\\t\\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\t\\t}\\n\\t\\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#endif\\n#endif\",fog_vertex:\"#ifdef USE_FOG\\n\\tfogDepth = - mvPosition.z;\\n#endif\",fog_pars_vertex:\"#ifdef USE_FOG\\n\\tvarying float fogDepth;\\n#endif\",fog_fragment:\"#ifdef USE_FOG\\n\\t#ifdef FOG_EXP2\\n\\t\\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\\n\\t#else\\n\\t\\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\\n\\t#endif\\n\\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\\n#endif\",fog_pars_fragment:\"#ifdef USE_FOG\\n\\tuniform vec3 fogColor;\\n\\tvarying float fogDepth;\\n\\t#ifdef FOG_EXP2\\n\\t\\tuniform float fogDensity;\\n\\t#else\\n\\t\\tuniform float fogNear;\\n\\t\\tuniform float fogFar;\\n\\t#endif\\n#endif\",gradientmap_pars_fragment:\"#ifdef USE_GRADIENTMAP\\n\\tuniform sampler2D gradientMap;\\n#endif\\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\\n\\tfloat dotNL = dot( normal, lightDirection );\\n\\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\\n\\t#ifdef USE_GRADIENTMAP\\n\\t\\treturn texture2D( gradientMap, coord ).rgb;\\n\\t#else\\n\\t\\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\\n\\t#endif\\n}\",lightmap_fragment:\"#ifdef USE_LIGHTMAP\\n\\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\\n\\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\\n#endif\",lightmap_pars_fragment:\"#ifdef USE_LIGHTMAP\\n\\tuniform sampler2D lightMap;\\n\\tuniform float lightMapIntensity;\\n#endif\",lights_lambert_vertex:\"vec3 diffuse = vec3( 1.0 );\\nGeometricContext geometry;\\ngeometry.position = mvPosition.xyz;\\ngeometry.normal = normalize( transformedNormal );\\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\\nGeometricContext backGeometry;\\nbackGeometry.position = geometry.position;\\nbackGeometry.normal = -geometry.normal;\\nbackGeometry.viewDir = geometry.viewDir;\\nvLightFront = vec3( 0.0 );\\nvIndirectFront = vec3( 0.0 );\\n#ifdef DOUBLE_SIDED\\n\\tvLightBack = vec3( 0.0 );\\n\\tvIndirectBack = vec3( 0.0 );\\n#endif\\nIncidentLight directLight;\\nfloat dotNL;\\nvec3 directLightColor_Diffuse;\\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\\n#ifdef DOUBLE_SIDED\\n\\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\\n\\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\\n#endif\\n#if NUM_POINT_LIGHTS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if NUM_DIR_LIGHTS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\\n\\t\\t#endif\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\",lights_pars_begin:\"uniform bool receiveShadow;\\nuniform vec3 ambientLightColor;\\nuniform vec3 lightProbe[ 9 ];\\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\\n\\tfloat x = normal.x, y = normal.y, z = normal.z;\\n\\tvec3 result = shCoefficients[ 0 ] * 0.886227;\\n\\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\\n\\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\\n\\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\\n\\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\\n\\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\\n\\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\\n\\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\\n\\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\\n\\treturn result;\\n}\\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\\n\\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\\n\\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\\n\\treturn irradiance;\\n}\\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\\n\\tvec3 irradiance = ambientLightColor;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treturn irradiance;\\n}\\n#if NUM_DIR_LIGHTS > 0\\n\\tstruct DirectionalLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t};\\n\\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\\n\\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tdirectLight.color = directionalLight.color;\\n\\t\\tdirectLight.direction = directionalLight.direction;\\n\\t\\tdirectLight.visible = true;\\n\\t}\\n#endif\\n#if NUM_POINT_LIGHTS > 0\\n\\tstruct PointLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t};\\n\\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\\n\\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tvec3 lVector = pointLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tdirectLight.color = pointLight.color;\\n\\t\\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\\n\\t\\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\tstruct SpotLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tfloat coneCos;\\n\\t\\tfloat penumbraCos;\\n\\t};\\n\\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\\n\\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tvec3 lVector = spotLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tfloat angleCos = dot( directLight.direction, spotLight.direction );\\n\\t\\tif ( angleCos > spotLight.coneCos ) {\\n\\t\\t\\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\\n\\t\\t\\tdirectLight.color = spotLight.color;\\n\\t\\t\\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\\n\\t\\t\\tdirectLight.visible = true;\\n\\t\\t} else {\\n\\t\\t\\tdirectLight.color = vec3( 0.0 );\\n\\t\\t\\tdirectLight.visible = false;\\n\\t\\t}\\n\\t}\\n#endif\\n#if NUM_RECT_AREA_LIGHTS > 0\\n\\tstruct RectAreaLight {\\n\\t\\tvec3 color;\\n\\t\\tvec3 position;\\n\\t\\tvec3 halfWidth;\\n\\t\\tvec3 halfHeight;\\n\\t};\\n\\tuniform sampler2D ltc_1;\\tuniform sampler2D ltc_2;\\n\\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\tstruct HemisphereLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 skyColor;\\n\\t\\tvec3 groundColor;\\n\\t};\\n\\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\\n\\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\\n\\t\\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\\n\\t\\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\\n\\t\\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tirradiance *= PI;\\n\\t\\t#endif\\n\\t\\treturn irradiance;\\n\\t}\\n#endif\",lights_toon_fragment:\"ToonMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb;\",lights_toon_pars_fragment:\"varying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\nstruct ToonMaterial {\\n\\tvec3 diffuseColor;\\n};\\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_Toon\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_Toon\\n#define Material_LightProbeLOD( material )\\t(0)\",lights_phong_fragment:\"BlinnPhongMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb;\\nmaterial.specularColor = specular;\\nmaterial.specularShininess = shininess;\\nmaterial.specularStrength = specularStrength;\",lights_phong_pars_fragment:\"varying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\nstruct BlinnPhongMaterial {\\n\\tvec3 diffuseColor;\\n\\tvec3 specularColor;\\n\\tfloat specularShininess;\\n\\tfloat specularStrength;\\n};\\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\\n}\\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_BlinnPhong\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_BlinnPhong\\n#define Material_LightProbeLOD( material )\\t(0)\",lights_physical_fragment:\"PhysicalMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\\n#ifdef REFLECTIVITY\\n\\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), rawDiffuseColor, metalnessFactor );\\n#else\\n\\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), rawDiffuseColor, metalnessFactor );\\n#endif\\n#ifdef CLEARCOAT\\n\\tmaterial.clearcoat = clearcoat;\\n\\tmaterial.clearcoatRoughness = clearcoatRoughness;\\n\\t#ifdef USE_CLEARCOATMAP\\n\\t\\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\\n\\t#endif\\n\\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\\n\\t\\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\\n\\t#endif\\n\\tmaterial.clearcoat = saturate( material.clearcoat );\\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\\n\\tmaterial.clearcoatRoughness += geometryRoughness;\\n\\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\\n#endif\\n#ifdef USE_SHEEN\\n\\tmaterial.sheenColor = sheen;\\n#endif\",lights_physical_pars_fragment:\"struct PhysicalMaterial {\\n\\tvec3 diffuseColor;\\n\\tfloat specularRoughness;\\n\\tvec3 specularColor;\\n#ifdef CLEARCOAT\\n\\tfloat clearcoat;\\n\\tfloat clearcoatRoughness;\\n#endif\\n#ifdef USE_SHEEN\\n\\tvec3 sheenColor;\\n#endif\\n};\\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\\n\\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\\n}\\n#if NUM_RECT_AREA_LIGHTS > 0\\n\\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\t\\tvec3 normal = geometry.normal;\\n\\t\\tvec3 viewDir = geometry.viewDir;\\n\\t\\tvec3 position = geometry.position;\\n\\t\\tvec3 lightPos = rectAreaLight.position;\\n\\t\\tvec3 halfWidth = rectAreaLight.halfWidth;\\n\\t\\tvec3 halfHeight = rectAreaLight.halfHeight;\\n\\t\\tvec3 lightColor = rectAreaLight.color;\\n\\t\\tfloat roughness = material.specularRoughness;\\n\\t\\tvec3 rectCoords[ 4 ];\\n\\t\\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\\t\\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\\n\\t\\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\\n\\t\\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\\n\\t\\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\\n\\t\\tvec4 t1 = texture2D( ltc_1, uv );\\n\\t\\tvec4 t2 = texture2D( ltc_2, uv );\\n\\t\\tmat3 mInv = mat3(\\n\\t\\t\\tvec3( t1.x, 0, t1.y ),\\n\\t\\t\\tvec3(    0, 1,    0 ),\\n\\t\\t\\tvec3( t1.z, 0, t1.w )\\n\\t\\t);\\n\\t\\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\\n\\t\\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\\n\\t\\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\\n\\t}\\n#endif\\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\t#ifdef CLEARCOAT\\n\\t\\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\\n\\t\\tvec3 ccIrradiance = ccDotNL * directLight.color;\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tccIrradiance *= PI;\\n\\t\\t#endif\\n\\t\\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\\n\\t\\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\\n\\t#else\\n\\t\\tfloat clearcoatDHR = 0.0;\\n\\t#endif\\n\\t#ifdef USE_SHEEN\\n\\t\\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\\n\\t\\t\\tmaterial.specularRoughness,\\n\\t\\t\\tdirectLight.direction,\\n\\t\\t\\tgeometry,\\n\\t\\t\\tmaterial.sheenColor\\n\\t\\t);\\n\\t#else\\n\\t\\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\\n\\t#endif\\n\\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\\n\\t#ifdef CLEARCOAT\\n\\t\\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\\n\\t\\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\\n\\t\\tfloat ccDotNL = ccDotNV;\\n\\t\\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\\n\\t#else\\n\\t\\tfloat clearcoatDHR = 0.0;\\n\\t#endif\\n\\tfloat clearcoatInv = 1.0 - clearcoatDHR;\\n\\tvec3 singleScattering = vec3( 0.0 );\\n\\tvec3 multiScattering = vec3( 0.0 );\\n\\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\\n\\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\\n\\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\\n\\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\\n\\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\\n\\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_Physical\\n#define RE_Direct_RectArea\\t\\tRE_Direct_RectArea_Physical\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_Physical\\n#define RE_IndirectSpecular\\t\\tRE_IndirectSpecular_Physical\\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\\n\\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\\n}\",lights_fragment_begin:\"\\nGeometricContext geometry;\\ngeometry.position = - vViewPosition;\\ngeometry.normal = normal;\\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\\n#ifdef CLEARCOAT\\n\\tgeometry.clearcoatNormal = clearcoatNormal;\\n#endif\\nIncidentLight directLight;\\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tPointLight pointLight;\\n\\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\\n\\tPointLightShadow pointLightShadow;\\n\\t#endif\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\\n\\t\\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\\n\\t\\tpointLightShadow = pointLightShadows[ i ];\\n\\t\\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tSpotLight spotLight;\\n\\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\\n\\tSpotLightShadow spotLightShadow;\\n\\t#endif\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\\n\\t\\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\\n\\t\\tspotLightShadow = spotLightShadows[ i ];\\n\\t\\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tDirectionalLight directionalLight;\\n\\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\\n\\tDirectionalLightShadow directionalLightShadow;\\n\\t#endif\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\\n\\t\\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\\n\\t\\tdirectionalLightShadow = directionalLightShadows[ i ];\\n\\t\\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\\n\\tRectAreaLight rectAreaLight;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\\n\\t\\trectAreaLight = rectAreaLights[ i ];\\n\\t\\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\\n\\t}\\n\\t#pragma unroll_loop_end\\n#endif\\n#if defined( RE_IndirectDiffuse )\\n\\tvec3 iblIrradiance = vec3( 0.0 );\\n\\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\\n\\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\\n\\t#if ( NUM_HEMI_LIGHTS > 0 )\\n\\t\\t#pragma unroll_loop_start\\n\\t\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\t\\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t}\\n\\t\\t#pragma unroll_loop_end\\n\\t#endif\\n#endif\\n#if defined( RE_IndirectSpecular )\\n\\tvec3 radiance = vec3( 0.0 );\\n\\tvec3 clearcoatRadiance = vec3( 0.0 );\\n#endif\",lights_fragment_maps:\"#if defined( RE_IndirectDiffuse )\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\\n\\t\\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tlightMapIrradiance *= PI;\\n\\t\\t#endif\\n\\t\\tirradiance += lightMapIrradiance;\\n\\t#endif\\n\\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\\n\\t#endif\\n#endif\\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\\n\\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\\n\\t#ifdef CLEARCOAT\\n\\t\\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\\n\\t#endif\\n#endif\",lights_fragment_end:\"#if defined( RE_IndirectDiffuse )\\n\\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\\n#endif\\n#if defined( RE_IndirectSpecular )\\n\\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\\n#endif\",logdepthbuf_fragment:\"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\\n\\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\\n#endif\",logdepthbuf_pars_fragment:\"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\\n\\tuniform float logDepthBufFC;\\n\\tvarying float vFragDepth;\\n\\tvarying float vIsPerspective;\\n#endif\",logdepthbuf_pars_vertex:\"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvarying float vFragDepth;\\n\\t\\tvarying float vIsPerspective;\\n\\t#else\\n\\t\\tuniform float logDepthBufFC;\\n\\t#endif\\n#endif\",logdepthbuf_vertex:\"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvFragDepth = 1.0 + gl_Position.w;\\n\\t\\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\\n\\t#else\\n\\t\\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\\n\\t\\t\\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\\n\\t\\t\\tgl_Position.z *= gl_Position.w;\\n\\t\\t}\\n\\t#endif\\n#endif\",map_fragment:\"#ifdef USE_MAP\\n\\tvec4 texelColor = texture2D( map, vUv );\\n\\ttexelColor = mapTexelToLinear( texelColor );\\n\\tdiffuseColor *= texelColor;\\n#endif\",map_pars_fragment:\"#ifdef USE_MAP\\n\\tuniform sampler2D map;\\n#endif\",map_particle_fragment:\"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\\n\\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\\n#endif\\n#ifdef USE_MAP\\n\\tvec4 mapTexel = texture2D( map, uv );\\n\\tdiffuseColor *= mapTexelToLinear( mapTexel );\\n#endif\\n#ifdef USE_ALPHAMAP\\n\\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\\n#endif\",map_particle_pars_fragment:\"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\\n\\tuniform mat3 uvTransform;\\n#endif\\n#ifdef USE_MAP\\n\\tuniform sampler2D map;\\n#endif\\n#ifdef USE_ALPHAMAP\\n\\tuniform sampler2D alphaMap;\\n#endif\",metalnessmap_fragment:\"float metalnessFactor = metalness;\\n#ifdef USE_METALNESSMAP\\n\\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\\n\\tmetalnessFactor *= texelMetalness.b;\\n#endif\",metalnessmap_pars_fragment:\"#ifdef USE_METALNESSMAP\\n\\tuniform sampler2D metalnessMap;\\n#endif\",morphnormal_vertex:\"#ifdef USE_MORPHNORMALS\\n\\tobjectNormal *= morphTargetBaseInfluence;\\n\\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\\n\\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\\n\\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\\n\\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\\n#endif\",morphtarget_pars_vertex:\"#ifdef USE_MORPHTARGETS\\n\\tuniform float morphTargetBaseInfluence;\\n\\t#ifndef USE_MORPHNORMALS\\n\\t\\tuniform float morphTargetInfluences[ 8 ];\\n\\t#else\\n\\t\\tuniform float morphTargetInfluences[ 4 ];\\n\\t#endif\\n#endif\",morphtarget_vertex:\"#ifdef USE_MORPHTARGETS\\n\\ttransformed *= morphTargetBaseInfluence;\\n\\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\\n\\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\\n\\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\\n\\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\\n\\t#ifndef USE_MORPHNORMALS\\n\\t\\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\\n\\t\\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\\n\\t\\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\\n\\t\\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\\n\\t#endif\\n#endif\",normal_fragment_begin:\"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\\n#ifdef FLAT_SHADED\\n\\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\\n\\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\\n\\tvec3 normal = normalize( cross( fdx, fdy ) );\\n#else\\n\\tvec3 normal = normalize( vNormal );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\tnormal = normal * faceDirection;\\n\\t#endif\\n\\t#ifdef USE_TANGENT\\n\\t\\tvec3 tangent = normalize( vTangent );\\n\\t\\tvec3 bitangent = normalize( vBitangent );\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\ttangent = tangent * faceDirection;\\n\\t\\t\\tbitangent = bitangent * faceDirection;\\n\\t\\t#endif\\n\\t\\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\\n\\t\\t\\tmat3 vTBN = mat3( tangent, bitangent, normal );\\n\\t\\t#endif\\n\\t#endif\\n#endif\\nvec3 geometryNormal = normal;\",normal_fragment_maps:\"#ifdef OBJECTSPACE_NORMALMAP\\n\\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\t#ifdef FLIP_SIDED\\n\\t\\tnormal = - normal;\\n\\t#endif\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\tnormal = normal * faceDirection;\\n\\t#endif\\n\\tnormal = normalize( normalMatrix * normal );\\n#elif defined( TANGENTSPACE_NORMALMAP )\\n\\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\tmapN.xy *= normalScale;\\n\\t#ifdef USE_TANGENT\\n\\t\\tnormal = normalize( vTBN * mapN );\\n\\t#else\\n\\t\\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\\n\\t#endif\\n#elif defined( USE_BUMPMAP )\\n\\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\\n#endif\",normalmap_pars_fragment:\"#ifdef USE_NORMALMAP\\n\\tuniform sampler2D normalMap;\\n\\tuniform vec2 normalScale;\\n#endif\\n#ifdef OBJECTSPACE_NORMALMAP\\n\\tuniform mat3 normalMatrix;\\n#endif\\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\\n\\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\\n\\t\\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\\n\\t\\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\\n\\t\\tvec2 st0 = dFdx( vUv.st );\\n\\t\\tvec2 st1 = dFdy( vUv.st );\\n\\t\\tvec3 N = surf_norm;\\n\\t\\tvec3 q1perp = cross( q1, N );\\n\\t\\tvec3 q0perp = cross( N, q0 );\\n\\t\\tvec3 T = q1perp * st0.x + q0perp * st1.x;\\n\\t\\tvec3 B = q1perp * st0.y + q0perp * st1.y;\\n\\t\\tfloat det = max( dot( T, T ), dot( B, B ) );\\n\\t\\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\\n\\t\\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\\n\\t}\\n#endif\",clearcoat_normal_fragment_begin:\"#ifdef CLEARCOAT\\n\\tvec3 clearcoatNormal = geometryNormal;\\n#endif\",clearcoat_normal_fragment_maps:\"#ifdef USE_CLEARCOAT_NORMALMAP\\n\\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\\n\\tclearcoatMapN.xy *= clearcoatNormalScale;\\n\\t#ifdef USE_TANGENT\\n\\t\\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\\n\\t#else\\n\\t\\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\\n\\t#endif\\n#endif\",clearcoat_pars_fragment:\"#ifdef USE_CLEARCOATMAP\\n\\tuniform sampler2D clearcoatMap;\\n#endif\\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\\n\\tuniform sampler2D clearcoatRoughnessMap;\\n#endif\\n#ifdef USE_CLEARCOAT_NORMALMAP\\n\\tuniform sampler2D clearcoatNormalMap;\\n\\tuniform vec2 clearcoatNormalScale;\\n#endif\",packing:\"vec3 packNormalToRGB( const in vec3 normal ) {\\n\\treturn normalize( normal ) * 0.5 + 0.5;\\n}\\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\\n\\treturn 2.0 * rgb.xyz - 1.0;\\n}\\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\\nconst float ShiftRight8 = 1. / 256.;\\nvec4 packDepthToRGBA( const in float v ) {\\n\\tvec4 r = vec4( fract( v * PackFactors ), v );\\n\\tr.yzw -= r.xyz * ShiftRight8;\\treturn r * PackUpscale;\\n}\\nfloat unpackRGBAToDepth( const in vec4 v ) {\\n\\treturn dot( v, UnpackFactors );\\n}\\nvec4 pack2HalfToRGBA( vec2 v ) {\\n\\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\\n\\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\\n}\\nvec2 unpackRGBATo2Half( vec4 v ) {\\n\\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\\n}\\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\\n\\treturn ( viewZ + near ) / ( near - far );\\n}\\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\\n\\treturn linearClipZ * ( near - far ) - near;\\n}\\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\\n\\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\\n}\\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\\n\\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\\n}\",premultiplied_alpha_fragment:\"#ifdef PREMULTIPLIED_ALPHA\\n\\tgl_FragColor.rgb *= gl_FragColor.a;\\n#endif\",project_vertex:\"vec4 mvPosition = vec4( transformed, 1.0 );\\n#ifdef USE_INSTANCING\\n\\tmvPosition = instanceMatrix * mvPosition;\\n#endif\\nmvPosition = modelViewMatrix * mvPosition;\\ngl_Position = projectionMatrix * mvPosition;\",dithering_fragment:\"#ifdef DITHERING\\n\\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\\n#endif\",dithering_pars_fragment:\"#ifdef DITHERING\\n\\tvec3 dithering( vec3 color ) {\\n\\t\\tfloat grid_position = rand( gl_FragCoord.xy );\\n\\t\\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\\n\\t\\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\\n\\t\\treturn color + dither_shift_RGB;\\n\\t}\\n#endif\",roughnessmap_fragment:\"float roughnessFactor = roughness;\\n#ifdef USE_ROUGHNESSMAP\\n\\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\\n\\troughnessFactor *= texelRoughness.g;\\n#endif\",roughnessmap_pars_fragment:\"#ifdef USE_ROUGHNESSMAP\\n\\tuniform sampler2D roughnessMap;\\n#endif\",shadowmap_pars_fragment:\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n\\t\\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tstruct DirectionalLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t};\\n\\t\\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHT_SHADOWS > 0\\n\\t\\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t\\tstruct SpotLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t};\\n\\t\\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHT_SHADOWS > 0\\n\\t\\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t\\tstruct PointLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t\\tfloat shadowCameraNear;\\n\\t\\t\\tfloat shadowCameraFar;\\n\\t\\t};\\n\\t\\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t#endif\\n\\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\\n\\t\\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\\n\\t}\\n\\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\\n\\t\\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\\n\\t}\\n\\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\\n\\t\\tfloat occlusion = 1.0;\\n\\t\\tvec2 distribution = texture2DDistribution( shadow, uv );\\n\\t\\tfloat hard_shadow = step( compare , distribution.x );\\n\\t\\tif (hard_shadow != 1.0 ) {\\n\\t\\t\\tfloat distance = compare - distribution.x ;\\n\\t\\t\\tfloat variance = max( 0.00000, distribution.y * distribution.y );\\n\\t\\t\\tfloat softness_probability = variance / (variance + distance * distance );\\t\\t\\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\\t\\t\\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\\n\\t\\t}\\n\\t\\treturn occlusion;\\n\\t}\\n\\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\\t\\tfloat shadow = 1.0;\\n\\t\\tshadowCoord.xyz /= shadowCoord.w;\\n\\t\\tshadowCoord.z += shadowBias;\\n\\t\\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\\t\\tbool inFrustum = all( inFrustumVec );\\n\\t\\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\t\\tbool frustumTest = all( frustumTestVec );\\n\\t\\tif ( frustumTest ) {\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx2 = dx0 / 2.0;\\n\\t\\t\\tfloat dy2 = dy0 / 2.0;\\n\\t\\t\\tfloat dx3 = dx1 / 2.0;\\n\\t\\t\\tfloat dy3 = dy1 / 2.0;\\n\\t\\t\\tshadow = (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 17.0 );\\n\\t\\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx = texelSize.x;\\n\\t\\t\\tfloat dy = texelSize.y;\\n\\t\\t\\tvec2 uv = shadowCoord.xy;\\n\\t\\t\\tvec2 f = fract( uv * shadowMapSize + 0.5 );\\n\\t\\t\\tuv -= f * texelSize;\\n\\t\\t\\tshadow = (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\\n\\t\\t\\t\\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t f.x ) +\\n\\t\\t\\t\\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t f.x ) +\\n\\t\\t\\t\\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t f.y ) +\\n\\t\\t\\t\\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t f.y ) +\\n\\t\\t\\t\\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t\\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t\\t  f.x ),\\n\\t\\t\\t\\t\\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \\n\\t\\t\\t\\t\\t\\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\\n\\t\\t\\t\\t\\t\\t  f.x ),\\n\\t\\t\\t\\t\\t f.y )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#elif defined( SHADOWMAP_TYPE_VSM )\\n\\t\\t\\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\\n\\t\\t#else\\n\\t\\t\\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\\n\\t\\t#endif\\n\\t\\t}\\n\\t\\treturn shadow;\\n\\t}\\n\\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\\n\\t\\tvec3 absV = abs( v );\\n\\t\\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\\n\\t\\tabsV *= scaleToCube;\\n\\t\\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\\n\\t\\tvec2 planar = v.xy;\\n\\t\\tfloat almostATexel = 1.5 * texelSizeY;\\n\\t\\tfloat almostOne = 1.0 - almostATexel;\\n\\t\\tif ( absV.z >= almostOne ) {\\n\\t\\t\\tif ( v.z > 0.0 )\\n\\t\\t\\t\\tplanar.x = 4.0 - v.x;\\n\\t\\t} else if ( absV.x >= almostOne ) {\\n\\t\\t\\tfloat signX = sign( v.x );\\n\\t\\t\\tplanar.x = v.z * signX + 2.0 * signX;\\n\\t\\t} else if ( absV.y >= almostOne ) {\\n\\t\\t\\tfloat signY = sign( v.y );\\n\\t\\t\\tplanar.x = v.x + 2.0 * signY + 2.0;\\n\\t\\t\\tplanar.y = v.z * signY - 2.0;\\n\\t\\t}\\n\\t\\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\\n\\t}\\n\\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\\n\\t\\tvec3 lightToPosition = shadowCoord.xyz;\\n\\t\\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\\t\\tdp += shadowBias;\\n\\t\\tvec3 bd3D = normalize( lightToPosition );\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\\n\\t\\t\\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\\n\\t\\t#endif\\n\\t}\\n#endif\",shadowmap_pars_vertex:\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n\\t\\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tstruct DirectionalLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t};\\n\\t\\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHT_SHADOWS > 0\\n\\t\\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t\\tstruct SpotLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t};\\n\\t\\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHT_SHADOWS > 0\\n\\t\\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t\\tstruct PointLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowNormalBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t\\tfloat shadowCameraNear;\\n\\t\\t\\tfloat shadowCameraFar;\\n\\t\\t};\\n\\t\\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\\n\\t#endif\\n#endif\",shadowmap_vertex:\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\\n\\t\\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\\n\\t\\tvec4 shadowWorldPosition;\\n\\t#endif\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\\n\\t\\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHT_SHADOWS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\\n\\t\\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#if NUM_POINT_LIGHT_SHADOWS > 0\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\\n\\t\\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n#endif\",shadowmask_pars_fragment:\"float getShadowMask() {\\n\\tfloat shadow = 1.0;\\n\\t#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n\\tDirectionalLightShadow directionalLight;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLightShadows[ i ];\\n\\t\\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHT_SHADOWS > 0\\n\\tSpotLightShadow spotLight;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tspotLight = spotLightShadows[ i ];\\n\\t\\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#if NUM_POINT_LIGHT_SHADOWS > 0\\n\\tPointLightShadow pointLight;\\n\\t#pragma unroll_loop_start\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\\n\\t\\tpointLight = pointLightShadows[ i ];\\n\\t\\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\\n\\t}\\n\\t#pragma unroll_loop_end\\n\\t#endif\\n\\t#endif\\n\\treturn shadow;\\n}\",skinbase_vertex:\"#ifdef USE_SKINNING\\n\\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n#endif\",skinning_pars_vertex:\"#ifdef USE_SKINNING\\n\\tuniform mat4 bindMatrix;\\n\\tuniform mat4 bindMatrixInverse;\\n\\t#ifdef BONE_TEXTURE\\n\\t\\tuniform highp sampler2D boneTexture;\\n\\t\\tuniform int boneTextureSize;\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tfloat j = i * 4.0;\\n\\t\\t\\tfloat x = mod( j, float( boneTextureSize ) );\\n\\t\\t\\tfloat y = floor( j / float( boneTextureSize ) );\\n\\t\\t\\tfloat dx = 1.0 / float( boneTextureSize );\\n\\t\\t\\tfloat dy = 1.0 / float( boneTextureSize );\\n\\t\\t\\ty = dy * ( y + 0.5 );\\n\\t\\t\\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\\t\\t\\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\\t\\t\\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\\t\\t\\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\t\\t\\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#else\\n\\t\\tuniform mat4 boneMatrices[ MAX_BONES ];\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tmat4 bone = boneMatrices[ int(i) ];\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#endif\\n#endif\",skinning_vertex:\"#ifdef USE_SKINNING\\n\\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\\n\\tvec4 skinned = vec4( 0.0 );\\n\\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\\ttransformed = ( bindMatrixInverse * skinned ).xyz;\\n#endif\",skinnormal_vertex:\"#ifdef USE_SKINNING\\n\\tmat4 skinMatrix = mat4( 0.0 );\\n\\tskinMatrix += skinWeight.x * boneMatX;\\n\\tskinMatrix += skinWeight.y * boneMatY;\\n\\tskinMatrix += skinWeight.z * boneMatZ;\\n\\tskinMatrix += skinWeight.w * boneMatW;\\n\\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\\n\\t#ifdef USE_TANGENT\\n\\t\\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\\n\\t#endif\\n#endif\",specularmap_fragment:\"float specularStrength;\\n#ifdef USE_SPECULARMAP\\n\\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\\tspecularStrength = texelSpecular.r;\\n#else\\n\\tspecularStrength = 1.0;\\n#endif\",specularmap_pars_fragment:\"#ifdef USE_SPECULARMAP\\n\\tuniform sampler2D specularMap;\\n#endif\",tonemapping_fragment:\"#if defined( TONE_MAPPING )\\n\\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\\n#endif\",tonemapping_pars_fragment:\"#ifndef saturate\\n#define saturate(a) clamp( a, 0.0, 1.0 )\\n#endif\\nuniform float toneMappingExposure;\\nvec3 LinearToneMapping( vec3 color ) {\\n\\treturn toneMappingExposure * color;\\n}\\nvec3 ReinhardToneMapping( vec3 color ) {\\n\\tcolor *= toneMappingExposure;\\n\\treturn saturate( color / ( vec3( 1.0 ) + color ) );\\n}\\nvec3 OptimizedCineonToneMapping( vec3 color ) {\\n\\tcolor *= toneMappingExposure;\\n\\tcolor = max( vec3( 0.0 ), color - 0.004 );\\n\\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\\n}\\nvec3 RRTAndODTFit( vec3 v ) {\\n\\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\\n\\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\\n\\treturn a / b;\\n}\\nvec3 ACESFilmicToneMapping( vec3 color ) {\\n\\tconst mat3 ACESInputMat = mat3(\\n\\t\\tvec3( 0.59719, 0.07600, 0.02840 ),\\t\\tvec3( 0.35458, 0.90834, 0.13383 ),\\n\\t\\tvec3( 0.04823, 0.01566, 0.83777 )\\n\\t);\\n\\tconst mat3 ACESOutputMat = mat3(\\n\\t\\tvec3(  1.60475, -0.10208, -0.00327 ),\\t\\tvec3( -0.53108,  1.10813, -0.07276 ),\\n\\t\\tvec3( -0.07367, -0.00605,  1.07602 )\\n\\t);\\n\\tcolor *= toneMappingExposure / 0.6;\\n\\tcolor = ACESInputMat * color;\\n\\tcolor = RRTAndODTFit( color );\\n\\tcolor = ACESOutputMat * color;\\n\\treturn saturate( color );\\n}\\nvec3 CustomToneMapping( vec3 color ) { return color; }\",transmission_fragment:\"#ifdef USE_TRANSMISSION\\n\\t#ifdef USE_TRANSMISSIONMAP\\n\\t\\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\\n\\t#endif\\n\\t#ifdef USE_THICKNESSNMAP\\n\\t\\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\\n\\t#endif\\n\\tvec3 pos = vWorldPosition.xyz / vWorldPosition.w;\\n\\tvec3 v = normalize( cameraPosition - pos );\\n\\tvec3 viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\\n\\tfloat ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );\\n\\tvec3 f0 = vec3( pow( ior - 1.0, 2.0 ) / pow( ior + 1.0, 2.0 ) );\\n\\tvec3 f90 = vec3( 1.0 );\\n\\tvec3 f_transmission = totalTransmission * getIBLVolumeRefraction(\\n\\t\\tnormal, v, viewDir, roughnessFactor, diffuseColor.rgb, f0, f90,\\n\\t\\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\\n\\t\\tattenuationColor, attenuationDistance);\\n\\tdiffuseColor.rgb = mix( diffuseColor.rgb, f_transmission, totalTransmission );\\n#endif\",transmission_pars_fragment:\"#ifdef USE_TRANSMISSION\\n\\t#ifdef USE_TRANSMISSIONMAP\\n\\t\\tuniform sampler2D transmissionMap;\\n\\t#endif\\n\\t#ifdef USE_THICKNESSMAP\\n\\t\\tuniform sampler2D thicknessMap;\\n\\t#endif\\n\\tuniform vec2 transmissionSamplerSize;\\n\\tuniform sampler2D transmissionSamplerMap;\\n\\tuniform mat4 modelMatrix;\\n\\tuniform mat4 projectionMatrix;\\n\\tvarying vec4 vWorldPosition;\\n\\tvec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {\\n\\t\\tvec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);\\n\\t\\tvec3 modelScale;\\n\\t\\tmodelScale.x = length(vec3(modelMatrix[0].xyz));\\n\\t\\tmodelScale.y = length(vec3(modelMatrix[1].xyz));\\n\\t\\tmodelScale.z = length(vec3(modelMatrix[2].xyz));\\n\\t\\treturn normalize(refractionVector) * thickness * modelScale;\\n\\t}\\n\\tfloat applyIorToRoughness(float roughness, float ior) {\\n\\t\\treturn roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);\\n\\t}\\n\\tvec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {\\n\\t\\tfloat framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);\\n\\t\\treturn texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;\\n\\t}\\n\\tvec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {\\n\\t\\tif (attenuationDistance == 0.0) {\\n\\t\\t\\treturn radiance;\\n\\t\\t} else {\\n\\t\\t\\tvec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;\\n\\t\\t\\tvec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);\\t\\t\\treturn transmittance * radiance;\\n\\t\\t}\\n\\t}\\n\\tvec3 getIBLVolumeRefraction(vec3 n, vec3 v, vec3 viewDir, float perceptualRoughness, vec3 baseColor, vec3 f0, vec3 f90,\\n\\t\\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec3 attenuationColor, float attenuationDistance) {\\n\\t\\tvec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);\\n\\t\\tvec3 refractedRayExit = position + transmissionRay;\\n\\t\\tvec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);\\n\\t\\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\\n\\t\\trefractionCoords += 1.0;\\n\\t\\trefractionCoords /= 2.0;\\n\\t\\tvec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);\\n\\t\\tvec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);\\n\\t\\tfloat NdotV = saturate(dot(n, viewDir));\\n\\t\\tvec2 brdf = integrateSpecularBRDF(NdotV, perceptualRoughness);\\n\\t\\tvec3 specularColor = f0 * brdf.x + f90 * brdf.y;\\n\\t\\treturn (1.0 - specularColor) * attenuatedColor * baseColor;\\n\\t}\\n#endif\",uv_pars_fragment:\"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\\n\\tvarying vec2 vUv;\\n#endif\",uv_pars_vertex:\"#ifdef USE_UV\\n\\t#ifdef UVS_VERTEX_ONLY\\n\\t\\tvec2 vUv;\\n\\t#else\\n\\t\\tvarying vec2 vUv;\\n\\t#endif\\n\\tuniform mat3 uvTransform;\\n#endif\",uv_vertex:\"#ifdef USE_UV\\n\\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\\n#endif\",uv2_pars_fragment:\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvarying vec2 vUv2;\\n#endif\",uv2_pars_vertex:\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tattribute vec2 uv2;\\n\\tvarying vec2 vUv2;\\n\\tuniform mat3 uv2Transform;\\n#endif\",uv2_vertex:\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\\n#endif\",worldpos_vertex:\"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\\n\\tvec4 worldPosition = vec4( transformed, 1.0 );\\n\\t#ifdef USE_INSTANCING\\n\\t\\tworldPosition = instanceMatrix * worldPosition;\\n\\t#endif\\n\\tworldPosition = modelMatrix * worldPosition;\\n#endif\",background_frag:\"uniform sampler2D t2D;\\nvarying vec2 vUv;\\nvoid main() {\\n\\tvec4 texColor = texture2D( t2D, vUv );\\n\\tgl_FragColor = mapTexelToLinear( texColor );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n}\",background_vert:\"varying vec2 vUv;\\nuniform mat3 uvTransform;\\nvoid main() {\\n\\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\\n\\tgl_Position = vec4( position.xy, 1.0, 1.0 );\\n}\",cube_frag:\"#include <envmap_common_pars_fragment>\\nuniform float opacity;\\nvarying vec3 vWorldDirection;\\n#include <cube_uv_reflection_fragment>\\nvoid main() {\\n\\tvec3 vReflect = vWorldDirection;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = envColor;\\n\\tgl_FragColor.a *= opacity;\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n}\",cube_vert:\"varying vec3 vWorldDirection;\\n#include <common>\\nvoid main() {\\n\\tvWorldDirection = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\tgl_Position.z = gl_Position.w;\\n}\",depth_frag:\"#if DEPTH_PACKING == 3200\\n\\tuniform float opacity;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvarying vec2 vHighPrecisionZW;\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tdiffuseColor.a = opacity;\\n\\t#endif\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <logdepthbuf_fragment>\\n\\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\\n\\t#elif DEPTH_PACKING == 3201\\n\\t\\tgl_FragColor = packDepthToRGBA( fragCoordZ );\\n\\t#endif\\n}\",depth_vert:\"#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvarying vec2 vHighPrecisionZW;\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_DISPLACEMENTMAP\\n\\t\\t#include <beginnormal_vertex>\\n\\t\\t#include <morphnormal_vertex>\\n\\t\\t#include <skinnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvHighPrecisionZW = gl_Position.zw;\\n}\",distanceRGBA_frag:\"#define DISTANCE\\nuniform vec3 referencePosition;\\nuniform float nearDistance;\\nuniform float farDistance;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main () {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\tfloat dist = length( vWorldPosition - referencePosition );\\n\\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\\n\\tdist = saturate( dist );\\n\\tgl_FragColor = packDepthToRGBA( dist );\\n}\",distanceRGBA_vert:\"#define DISTANCE\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_DISPLACEMENTMAP\\n\\t\\t#include <beginnormal_vertex>\\n\\t\\t#include <morphnormal_vertex>\\n\\t\\t#include <skinnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvWorldPosition = worldPosition.xyz;\\n}\",equirect_frag:\"uniform sampler2D tEquirect;\\nvarying vec3 vWorldDirection;\\n#include <common>\\nvoid main() {\\n\\tvec3 direction = normalize( vWorldDirection );\\n\\tvec2 sampleUV = equirectUv( direction );\\n\\tvec4 texColor = texture2D( tEquirect, sampleUV );\\n\\tgl_FragColor = mapTexelToLinear( texColor );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n}\",equirect_vert:\"varying vec3 vWorldDirection;\\n#include <common>\\nvoid main() {\\n\\tvWorldDirection = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n}\",linedashed_frag:\"uniform vec3 diffuse;\\nuniform float opacity;\\nuniform float dashSize;\\nuniform float totalSize;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\\n\\t\\tdiscard;\\n\\t}\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <color_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n}\",linedashed_vert:\"uniform float scale;\\nattribute float lineDistance;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\tvLineDistance = scale * lineDistance;\\n\\t#include <color_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n}\",meshbasic_frag:\"uniform vec3 diffuse;\\nuniform float opacity;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <envmap_common_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <cube_uv_reflection_fragment>\\n#include <fog_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\n\\t\\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\\n\\t\\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\\n\\t#else\\n\\t\\treflectedLight.indirectDiffuse += vec3( 1.0 );\\n\\t#endif\\n\\t#include <aomap_fragment>\\n\\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\\n\\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshbasic_vert:\"#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_ENVMAP\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <fog_vertex>\\n}\",meshlambert_frag:\"uniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float opacity;\\nvarying vec3 vLightFront;\\nvarying vec3 vIndirectFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n\\tvarying vec3 vIndirectBack;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_common_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <cube_uv_reflection_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <emissivemap_fragment>\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\\n\\t#else\\n\\t\\treflectedLight.indirectDiffuse += vIndirectFront;\\n\\t#endif\\n\\t#include <lightmap_fragment>\\n\\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\\n\\t#else\\n\\t\\treflectedLight.directDiffuse = vLightFront;\\n\\t#endif\\n\\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshlambert_vert:\"#define LAMBERT\\nvarying vec3 vLightFront;\\nvarying vec3 vIndirectFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n\\tvarying vec3 vIndirectBack;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <lights_lambert_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\",meshmatcap_frag:\"#define MATCAP\\nuniform vec3 diffuse;\\nuniform float opacity;\\nuniform sampler2D matcap;\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\tvec3 viewDir = normalize( vViewPosition );\\n\\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\\n\\tvec3 y = cross( viewDir, x );\\n\\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\\n\\t#ifdef USE_MATCAP\\n\\t\\tvec4 matcapColor = texture2D( matcap, uv );\\n\\t\\tmatcapColor = matcapTexelToLinear( matcapColor );\\n\\t#else\\n\\t\\tvec4 matcapColor = vec4( 1.0 );\\n\\t#endif\\n\\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshmatcap_vert:\"#define MATCAP\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <color_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#ifndef FLAT_SHADED\\n\\t\\tvNormal = normalize( transformedNormal );\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n}\",meshtoon_frag:\"#define TOON\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <gradientmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <lights_toon_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_toon_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshtoon_vert:\"#define TOON\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\",meshphong_frag:\"#define PHONG\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform vec3 specular;\\nuniform float shininess;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_common_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <cube_uv_reflection_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <lights_phong_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_phong_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshphong_vert:\"#define PHONG\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\",meshphysical_frag:\"#define STANDARD\\n#ifdef PHYSICAL\\n\\t#define REFLECTIVITY\\n\\t#define CLEARCOAT\\n#endif\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n#ifdef USE_TRANSMISSION\\n\\tuniform float transmission;\\n\\tuniform float thickness;\\n\\tuniform vec3 attenuationColor;\\n\\tuniform float attenuationDistance;\\n#endif\\n#ifdef REFLECTIVITY\\n\\tuniform float reflectivity;\\n#endif\\n#ifdef CLEARCOAT\\n\\tuniform float clearcoat;\\n\\tuniform float clearcoatRoughness;\\n#endif\\n#ifdef USE_SHEEN\\n\\tuniform vec3 sheen;\\n#endif\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n\\t#ifdef USE_TANGENT\\n\\t\\tvarying vec3 vTangent;\\n\\t\\tvarying vec3 vBitangent;\\n\\t#endif\\n#endif\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <bsdfs>\\n#include <transmission_pars_fragment>\\n#include <cube_uv_reflection_fragment>\\n#include <envmap_common_pars_fragment>\\n#include <envmap_physical_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <lights_pars_begin>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <clearcoat_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#ifdef USE_TRANSMISSION\\n\\t\\tfloat totalTransmission = transmission;\\n\\t\\tfloat thicknessFactor = thickness;\\n\\t#endif\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <clearcoat_normal_fragment_begin>\\n\\t#include <clearcoat_normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\tvec3 rawDiffuseColor = diffuseColor.rgb;\\n\\t#include <transmission_fragment>\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshphysical_vert:\"#define STANDARD\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n\\t#ifdef USE_TANGENT\\n\\t\\tvarying vec3 vTangent;\\n\\t\\tvarying vec3 vBitangent;\\n\\t#endif\\n#endif\\n#ifdef USE_TRANSMISSION\\n\\tvarying vec4 vWorldPosition;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n\\t#ifdef USE_TANGENT\\n\\t\\tvTangent = normalize( transformedTangent );\\n\\t\\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\\n\\t#endif\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n#ifdef USE_TRANSMISSION\\n\\tvWorldPosition = worldPosition;\\n#endif\\n}\",normal_frag:\"#define NORMAL\\nuniform float opacity;\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n\\t#ifdef USE_TANGENT\\n\\t\\tvarying vec3 vTangent;\\n\\t\\tvarying vec3 vBitangent;\\n\\t#endif\\n#endif\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\\n}\",normal_vert:\"#define NORMAL\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n\\t#ifdef USE_TANGENT\\n\\t\\tvarying vec3 vTangent;\\n\\t\\tvarying vec3 vBitangent;\\n\\t#endif\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n\\t#ifdef USE_TANGENT\\n\\t\\tvTangent = normalize( transformedTangent );\\n\\t\\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\\n\\t#endif\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\\n\\tvViewPosition = - mvPosition.xyz;\\n#endif\\n}\",points_frag:\"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <map_particle_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_particle_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n}\",points_vert:\"uniform float size;\\nuniform float scale;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <project_vertex>\\n\\tgl_PointSize = size;\\n\\t#ifdef USE_SIZEATTENUATION\\n\\t\\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\\n\\t\\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\\n\\t#endif\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <fog_vertex>\\n}\",shadow_frag:\"uniform vec3 color;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\nvoid main() {\\n\\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\",shadow_vert:\"#include <common>\\n#include <fog_pars_vertex>\\n#include <shadowmap_pars_vertex>\\nvoid main() {\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\",sprite_frag:\"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\",sprite_vert:\"uniform float rotation;\\nuniform vec2 center;\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\\n\\tvec2 scale;\\n\\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\\n\\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\\n\\t#ifndef USE_SIZEATTENUATION\\n\\t\\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\\n\\t\\tif ( isPerspective ) scale *= - mvPosition.z;\\n\\t#endif\\n\\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\\n\\tvec2 rotatedPosition;\\n\\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\\n\\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\\n\\tmvPosition.xy += rotatedPosition;\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n}\"},Ho={common:{diffuse:{value:new Ir(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Jn},uv2Transform:{value:new Jn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Zn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ir(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ir(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Jn}},sprite:{diffuse:{value:new Ir(16777215)},opacity:{value:1},center:{value:new Zn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Jn}}},jo={basic:{uniforms:Ao([Ho.common,Ho.specularmap,Ho.envmap,Ho.aomap,Ho.lightmap,Ho.fog]),vertexShader:Vo.meshbasic_vert,fragmentShader:Vo.meshbasic_frag},lambert:{uniforms:Ao([Ho.common,Ho.specularmap,Ho.envmap,Ho.aomap,Ho.lightmap,Ho.emissivemap,Ho.fog,Ho.lights,{emissive:{value:new Ir(0)}}]),vertexShader:Vo.meshlambert_vert,fragmentShader:Vo.meshlambert_frag},phong:{uniforms:Ao([Ho.common,Ho.specularmap,Ho.envmap,Ho.aomap,Ho.lightmap,Ho.emissivemap,Ho.bumpmap,Ho.normalmap,Ho.displacementmap,Ho.fog,Ho.lights,{emissive:{value:new Ir(0)},specular:{value:new Ir(1118481)},shininess:{value:30}}]),vertexShader:Vo.meshphong_vert,fragmentShader:Vo.meshphong_frag},standard:{uniforms:Ao([Ho.common,Ho.envmap,Ho.aomap,Ho.lightmap,Ho.emissivemap,Ho.bumpmap,Ho.normalmap,Ho.displacementmap,Ho.roughnessmap,Ho.metalnessmap,Ho.fog,Ho.lights,{emissive:{value:new Ir(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Vo.meshphysical_vert,fragmentShader:Vo.meshphysical_frag},toon:{uniforms:Ao([Ho.common,Ho.aomap,Ho.lightmap,Ho.emissivemap,Ho.bumpmap,Ho.normalmap,Ho.displacementmap,Ho.gradientmap,Ho.fog,Ho.lights,{emissive:{value:new Ir(0)}}]),vertexShader:Vo.meshtoon_vert,fragmentShader:Vo.meshtoon_frag},matcap:{uniforms:Ao([Ho.common,Ho.bumpmap,Ho.normalmap,Ho.displacementmap,Ho.fog,{matcap:{value:null}}]),vertexShader:Vo.meshmatcap_vert,fragmentShader:Vo.meshmatcap_frag},points:{uniforms:Ao([Ho.points,Ho.fog]),vertexShader:Vo.points_vert,fragmentShader:Vo.points_frag},dashed:{uniforms:Ao([Ho.common,Ho.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Vo.linedashed_vert,fragmentShader:Vo.linedashed_frag},depth:{uniforms:Ao([Ho.common,Ho.displacementmap]),vertexShader:Vo.depth_vert,fragmentShader:Vo.depth_frag},normal:{uniforms:Ao([Ho.common,Ho.bumpmap,Ho.normalmap,Ho.displacementmap,{opacity:{value:1}}]),vertexShader:Vo.normal_vert,fragmentShader:Vo.normal_frag},sprite:{uniforms:Ao([Ho.sprite,Ho.fog]),vertexShader:Vo.sprite_vert,fragmentShader:Vo.sprite_frag},background:{uniforms:{uvTransform:{value:new Jn},t2D:{value:null}},vertexShader:Vo.background_vert,fragmentShader:Vo.background_frag},cube:{uniforms:Ao([Ho.envmap,{opacity:{value:1}}]),vertexShader:Vo.cube_vert,fragmentShader:Vo.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Vo.equirect_vert,fragmentShader:Vo.equirect_frag},distanceRGBA:{uniforms:Ao([Ho.common,Ho.displacementmap,{referencePosition:{value:new ai},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Vo.distanceRGBA_vert,fragmentShader:Vo.distanceRGBA_frag},shadow:{uniforms:Ao([Ho.lights,Ho.fog,{color:{value:new Ir(0)},opacity:{value:1}}]),vertexShader:Vo.shadow_vert,fragmentShader:Vo.shadow_frag}};function Wo(e,t,n,i,r){const o=new Ir(0);let s,a,l=0,c=null,u=0,h=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),l=t,d(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,d(o,l)},render:function(n,r){let p=!1,g=!0===r.isScene?r.background:null;g&&g.isTexture&&(g=t.get(g));const v=e.xr,y=v.getSession&&v.getSession();y&&\"additive\"===y.environmentBlendMode&&(g=null),null===g?d(o,l):g&&g.isColor&&(d(g,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.mapping===ce)?(void 0===a&&(a=new Mo(new Eo(1,1,1),new Co({name:\"BackgroundCubeMaterial\",uniforms:To(jo.cube.uniforms),vertexShader:jo.cube.vertexShader,fragmentShader:jo.cube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute(\"normal\"),a.geometry.deleteAttribute(\"uv\"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,\"envMap\",{get:function(){return this.uniforms.envMap.value}}),i.update(a)),a.material.uniforms.envMap.value=g,a.material.uniforms.flipEnvMap.value=g.isCubeTexture&&g._needsFlipEnvMap?-1:1,c===g&&u===g.version&&h===e.toneMapping||(a.material.needsUpdate=!0,c=g,u=g.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):g&&g.isTexture&&(void 0===s&&(s=new Mo(new ko(2,2),new Co({name:\"BackgroundMaterial\",uniforms:To(jo.background.uniforms),vertexShader:jo.background.vertexShader,fragmentShader:jo.background.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute(\"normal\"),Object.defineProperty(s.material,\"map\",{get:function(){return this.uniforms.t2D.value}}),i.update(s)),s.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),s.material.uniforms.uvTransform.value.copy(g.matrix),c===g&&u===g.version&&h===e.toneMapping||(s.material.needsUpdate=!0,c=g,u=g.version,h=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null))}}}function qo(e,t,n,i){const r=e.getParameter(34921),o=i.isWebGL2?null:t.get(\"OES_vertex_array_object\"),s=i.isWebGL2||null!==o,a={},l=d(null);let c=l;function u(t){return i.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function h(t){return i.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function d(e){const t=[],n=[],i=[];for(let e=0;e<r;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function f(e){m(e,0)}function m(n,r){const o=c.newAttributes,s=c.enabledAttributes,a=c.attributeDivisors;o[n]=1,0===s[n]&&(e.enableVertexAttribArray(n),s[n]=1),a[n]!==r&&((i.isWebGL2?e:t.get(\"ANGLE_instanced_arrays\"))[i.isWebGL2?\"vertexAttribDivisor\":\"vertexAttribDivisorANGLE\"](n,r),a[n]=r)}function g(){const t=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function v(t,n,r,o,s,a){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,o,s,a):e.vertexAttribIPointer(t,n,r,s,a)}function y(){x(),c!==l&&(c=l,u(c.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,h,y,x){let _=!1;if(s){const t=function(t,n,r){const s=!0===r.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[s];return void 0===u&&(u=d(i.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),c[s]=u),u}(y,h,l);c!==t&&(c=t,u(c.object)),_=function(e,t){const n=c.attributes,i=e.attributes;let r=0;for(const e in i){const t=n[e],o=i[e];if(void 0===t)return!0;if(t.attribute!==o)return!0;if(t.data!==o.data)return!0;r++}return c.attributesNum!==r||c.index!==t}(y,x),_&&function(e,t){const n={},i=e.attributes;let r=0;for(const e in i){const t=i[e],o={};o.attribute=t,t.data&&(o.data=t.data),n[e]=o,r++}c.attributes=n,c.attributesNum=r,c.index=t}(y,x)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===e||(c.geometry=y.id,c.program=h.id,c.wireframe=e,_=!0)}!0===r.isInstancedMesh&&(_=!0),null!==x&&n.update(x,34963),_&&(function(r,o,s,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get(\"ANGLE_instanced_arrays\"))return;p();const l=a.attributes,c=s.getAttributes(),u=o.defaultAttributeValues;for(const t in c){const i=c[t];if(i>=0){const o=l[t];if(void 0!==o){const t=o.normalized,r=o.itemSize,s=n.get(o);if(void 0===s)continue;const l=s.buffer,c=s.type,u=s.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,s=n.stride,h=o.offset;n&&n.isInstancedInterleavedBuffer?(m(i,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):f(i),e.bindBuffer(34962,l),v(i,r,c,t,s*u,h*u)}else o.isInstancedBufferAttribute?(m(i,o.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)):f(i),e.bindBuffer(34962,l),v(i,r,c,t,0,0)}else if(\"instanceMatrix\"===t){const t=n.get(r.instanceMatrix);if(void 0===t)continue;const o=t.buffer,s=t.type;m(i+0,1),m(i+1,1),m(i+2,1),m(i+3,1),e.bindBuffer(34962,o),e.vertexAttribPointer(i+0,4,s,!1,64,0),e.vertexAttribPointer(i+1,4,s,!1,64,16),e.vertexAttribPointer(i+2,4,s,!1,64,32),e.vertexAttribPointer(i+3,4,s,!1,64,48)}else if(\"instanceColor\"===t){const t=n.get(r.instanceColor);if(void 0===t)continue;const o=t.buffer,s=t.type;m(i,1),e.bindBuffer(34962,o),e.vertexAttribPointer(i,3,s,!1,12,0)}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(i,n);break;case 3:e.vertexAttrib3fv(i,n);break;case 4:e.vertexAttrib4fv(i,n);break;default:e.vertexAttrib1fv(i,n)}}}}g()}(r,l,h,y),null!==x&&e.bindBuffer(34963,n.get(x).buffer))},reset:y,resetDefaultState:x,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)h(i[e].object),delete i[e];delete n[e.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function Xo(e,t,n,i){const r=i.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,i){e.drawArrays(o,t,i),n.update(i,o,1)},this.renderInstances=function(i,s,a){if(0===a)return;let l,c;if(r)l=e,c=\"drawArraysInstanced\";else if(l=t.get(\"ANGLE_instanced_arrays\"),c=\"drawArraysInstancedANGLE\",null===l)return void console.error(\"THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\");l[c](o,i,s,a),n.update(s,o,a)}}function Yo(e,t,n){let i;function r(t){if(\"highp\"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return\"highp\";t=\"mediump\"}return\"mediump\"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?\"mediump\":\"lowp\"}const o=\"undefined\"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||\"undefined\"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let s=void 0!==n.precision?n.precision:\"highp\";const a=r(s);a!==s&&(console.warn(\"THREE.WebGLRenderer:\",s,\"not supported, using\",a,\"instead.\"),s=a);const l=o||t.has(\"WEBGL_draw_buffers\"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),y=h>0,x=o||t.has(\"OES_texture_float\");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has(\"EXT_texture_filter_anisotropic\")){const n=t.get(\"EXT_texture_filter_anisotropic\");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:y&&x,maxSamples:o?e.getParameter(36183):0}}function Zo(e){const t=this;let n=null,i=0,r=!1,o=!1;const s=new pr,a=new Jn,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function u(e,n,i,r){const o=null!==e?e.length:0;let c=null;if(0!==o){if(c=l.value,!0!==r||null===c){const t=i+4*o,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=i;t!==o;++t,n+=4)s.copy(e[t]).applyMatrix4(r,a),s.normal.toArray(c,n),c[n+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const s=0!==e.length||t||0!==i||r;return r=t,n=u(e,o,0),i=e.length,s},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,c()},this.setState=function(t,s,a){const h=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(!r||null===h||0===h.length||o&&!p)o?u(null):c();else{const e=o?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=u(h,s,t,a);for(let e=0;e!==t;++e)r[e]=n[e];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function Jo(e){let t=new WeakMap;function n(e,t){return t===ae?e.mapping=oe:t===le&&(e.mapping=se),e}function i(e){const n=e.target;n.removeEventListener(\"dispose\",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const o=r.mapping;if(o===ae||o===le){if(t.has(r))return n(t.get(r).texture,r.mapping);{const o=r.image;if(o&&o.height>0){const s=e.getRenderTarget(),a=new Fo(o.height/2);return a.fromEquirectangularTexture(e,r),t.set(r,a),e.setRenderTarget(s),r.addEventListener(\"dispose\",i),n(a.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}function $o(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case\"WEBGL_depth_texture\":i=e.getExtension(\"WEBGL_depth_texture\")||e.getExtension(\"MOZ_WEBGL_depth_texture\")||e.getExtension(\"WEBKIT_WEBGL_depth_texture\");break;case\"EXT_texture_filter_anisotropic\":i=e.getExtension(\"EXT_texture_filter_anisotropic\")||e.getExtension(\"MOZ_EXT_texture_filter_anisotropic\")||e.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\");break;case\"WEBGL_compressed_texture_s3tc\":i=e.getExtension(\"WEBGL_compressed_texture_s3tc\")||e.getExtension(\"MOZ_WEBGL_compressed_texture_s3tc\")||e.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc\");break;case\"WEBGL_compressed_texture_pvrtc\":i=e.getExtension(\"WEBGL_compressed_texture_pvrtc\")||e.getExtension(\"WEBKIT_WEBGL_compressed_texture_pvrtc\");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n(\"EXT_color_buffer_float\"):(n(\"WEBGL_depth_texture\"),n(\"OES_texture_float\"),n(\"OES_texture_half_float\"),n(\"OES_texture_half_float_linear\"),n(\"OES_standard_derivatives\"),n(\"OES_element_index_uint\"),n(\"OES_vertex_array_object\"),n(\"ANGLE_instanced_arrays\")),n(\"OES_texture_float_linear\"),n(\"EXT_color_buffer_half_float\")},get:function(e){const t=n(e);return null===t&&console.warn(\"THREE.WebGLRenderer: \"+e+\" extension not supported.\"),t}}}function Ko(e,t,n,i){const r={},o=new WeakMap;function s(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener(\"dispose\",s),delete r[a.id];const l=o.get(a);l&&(t.remove(l),o.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],i=e.index,r=e.attributes.position;let s=0;if(null!==i){const e=i.array;s=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],o=e[t+2];n.push(i,r,r,o,o,i)}}else{const e=r.array;s=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}const a=new(Yr(n)>65535?jr:Vr)(n,1);a.version=s;const l=o.get(e);l&&t.remove(l),o.set(e,a)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener(\"dispose\",s),r[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const e in n)t.update(n[e],34962);const i=e.morphAttributes;for(const e in i){const n=i[e];for(let e=0,i=n.length;e<i;e++)t.update(n[e],34962)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return o.get(e)}}}function Qo(e,t,n,i){const r=i.isWebGL2;let o,s,a;this.setMode=function(e){o=e},this.setIndex=function(e){s=e.type,a=e.bytesPerElement},this.render=function(t,i){e.drawElements(o,i,s,t*a),n.update(i,o,1)},this.renderInstances=function(i,l,c){if(0===c)return;let u,h;if(r)u=e,h=\"drawElementsInstanced\";else if(u=t.get(\"ANGLE_instanced_arrays\"),h=\"drawElementsInstancedANGLE\",null===u)return void console.error(\"THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\");u[h](o,l,s,i*a,c),n.update(l,o,c)}}function es(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error(\"THREE.WebGLInfo: Unknown draw mode:\",n)}}}}function ts(e,t){return e[0]-t[0]}function ns(e,t){return Math.abs(t[1])-Math.abs(e[1])}function is(e){const t={},n=new Float32Array(8),i=[];for(let e=0;e<8;e++)i[e]=[e,0];return{update:function(r,o,s,a){const l=r.morphTargetInfluences,c=void 0===l?0:l.length;let u=t[o.id];if(void 0===u){u=[];for(let e=0;e<c;e++)u[e]=[e,0];t[o.id]=u}for(let e=0;e<c;e++){const t=u[e];t[0]=e,t[1]=l[e]}u.sort(ns);for(let e=0;e<8;e++)e<c&&u[e][1]?(i[e][0]=u[e][0],i[e][1]=u[e][1]):(i[e][0]=Number.MAX_SAFE_INTEGER,i[e][1]=0);i.sort(ts);const h=s.morphTargets&&o.morphAttributes.position,d=s.morphNormals&&o.morphAttributes.normal;let p=0;for(let e=0;e<8;e++){const t=i[e],r=t[0],s=t[1];r!==Number.MAX_SAFE_INTEGER&&s?(h&&o.getAttribute(\"morphTarget\"+e)!==h[r]&&o.setAttribute(\"morphTarget\"+e,h[r]),d&&o.getAttribute(\"morphNormal\"+e)!==d[r]&&o.setAttribute(\"morphNormal\"+e,d[r]),n[e]=s,p+=s):(h&&!0===o.hasAttribute(\"morphTarget\"+e)&&o.deleteAttribute(\"morphTarget\"+e),d&&!0===o.hasAttribute(\"morphNormal\"+e)&&o.deleteAttribute(\"morphNormal\"+e),n[e]=0)}const f=o.morphTargetsRelative?1:1-p;a.getUniforms().setValue(e,\"morphTargetBaseInfluence\",f),a.getUniforms().setValue(e,\"morphTargetInfluences\",n)}}}function rs(e,t,n,i){let r=new WeakMap;function o(e){const t=e.target;t.removeEventListener(\"dispose\",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const s=i.render.frame,a=e.geometry,l=t.get(e,a);return r.get(l)!==s&&(t.update(l),r.set(l,s)),e.isInstancedMesh&&(!1===e.hasEventListener(\"dispose\",o)&&e.addEventListener(\"dispose\",o),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}jo.physical={uniforms:Ao([jo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Zn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Ir(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Zn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ir(0)}}]),vertexShader:Vo.meshphysical_vert,fragmentShader:Vo.meshphysical_frag};class os extends ei{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=fe,this.minFilter=fe,this.wrapR=de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}os.prototype.isDataTexture2DArray=!0;class ss extends ei{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=fe,this.minFilter=fe,this.wrapR=de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ss.prototype.isDataTexture3D=!0;const as=new ei,ls=new os,cs=new ss,us=new Oo,hs=[],ds=[],ps=new Float32Array(16),fs=new Float32Array(9),ms=new Float32Array(4);function gs(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let o=hs[r];if(void 0===o&&(o=new Float32Array(r),hs[r]=o),0!==t){i.toArray(o,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(o,r)}return o}function vs(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function ys(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function xs(e,t){let n=ds[t];void 0===n&&(n=new Int32Array(t),ds[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function _s(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function bs(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(vs(n,t))return;e.uniform2fv(this.addr,t),ys(n,t)}}function ws(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(vs(n,t))return;e.uniform3fv(this.addr,t),ys(n,t)}}function Ms(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(vs(n,t))return;e.uniform4fv(this.addr,t),ys(n,t)}}function Ss(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(vs(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),ys(n,t)}else{if(vs(n,i))return;ms.set(i),e.uniformMatrix2fv(this.addr,!1,ms),ys(n,i)}}function Es(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(vs(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),ys(n,t)}else{if(vs(n,i))return;fs.set(i),e.uniformMatrix3fv(this.addr,!1,fs),ys(n,i)}}function Ts(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(vs(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),ys(n,t)}else{if(vs(n,i))return;ps.set(i),e.uniformMatrix4fv(this.addr,!1,ps),ys(n,i)}}function As(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Ls(e,t){const n=this.cache;vs(n,t)||(e.uniform2iv(this.addr,t),ys(n,t))}function Cs(e,t){const n=this.cache;vs(n,t)||(e.uniform3iv(this.addr,t),ys(n,t))}function Ps(e,t){const n=this.cache;vs(n,t)||(e.uniform4iv(this.addr,t),ys(n,t))}function Rs(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Ds(e,t){const n=this.cache;vs(n,t)||(e.uniform2uiv(this.addr,t),ys(n,t))}function Is(e,t){const n=this.cache;vs(n,t)||(e.uniform3uiv(this.addr,t),ys(n,t))}function Os(e,t){const n=this.cache;vs(n,t)||(e.uniform4uiv(this.addr,t),ys(n,t))}function Fs(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||as,r)}function Ns(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||cs,r)}function zs(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(t||us,r)}function Us(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||ls,r)}function Bs(e,t){e.uniform1fv(this.addr,t)}function Gs(e,t){const n=gs(t,this.size,2);e.uniform2fv(this.addr,n)}function ks(e,t){const n=gs(t,this.size,3);e.uniform3fv(this.addr,n)}function Vs(e,t){const n=gs(t,this.size,4);e.uniform4fv(this.addr,n)}function Hs(e,t){const n=gs(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function js(e,t){const n=gs(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Ws(e,t){const n=gs(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function qs(e,t){e.uniform1iv(this.addr,t)}function Xs(e,t){e.uniform2iv(this.addr,t)}function Ys(e,t){e.uniform3iv(this.addr,t)}function Zs(e,t){e.uniform4iv(this.addr,t)}function Js(e,t){e.uniform1uiv(this.addr,t)}function $s(e,t){e.uniform2uiv(this.addr,t)}function Ks(e,t){e.uniform3uiv(this.addr,t)}function Qs(e,t){e.uniform4uiv(this.addr,t)}function ea(e,t,n){const i=t.length,r=xs(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.safeSetTexture2D(t[e]||as,r[e])}function ta(e,t,n){const i=t.length,r=xs(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.safeSetTextureCube(t[e]||us,r[e])}function na(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return _s;case 35664:return bs;case 35665:return ws;case 35666:return Ms;case 35674:return Ss;case 35675:return Es;case 35676:return Ts;case 5124:case 35670:return As;case 35667:case 35671:return Ls;case 35668:case 35672:return Cs;case 35669:case 35673:return Ps;case 5125:return Rs;case 36294:return Ds;case 36295:return Is;case 36296:return Os;case 35678:case 36198:case 36298:case 36306:case 35682:return Fs;case 35679:case 36299:case 36307:return Ns;case 35680:case 36300:case 36308:case 36293:return zs;case 36289:case 36303:case 36311:case 36292:return Us}}(t.type)}function ia(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Bs;case 35664:return Gs;case 35665:return ks;case 35666:return Vs;case 35674:return Hs;case 35675:return js;case 35676:return Ws;case 5124:case 35670:return qs;case 35667:case 35671:return Xs;case 35668:case 35672:return Ys;case 35669:case 35673:return Zs;case 5125:return Js;case 36294:return $s;case 36295:return Ks;case 36296:return Qs;case 35678:case 36198:case 36298:case 36306:case 35682:return ea;case 35680:case 36300:case 36308:case 36293:return ta}}(t.type)}function ra(e){this.id=e,this.seq=[],this.map={}}ia.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),ys(t,e)},ra.prototype.setValue=function(e,t,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const o=i[r];o.setValue(e,t[o.id],n)}};const oa=/(\\w+)(\\])?(\\[|\\.)?/g;function sa(e,t){e.seq.push(t),e.map[t.id]=t}function aa(e,t,n){const i=e.name,r=i.length;for(oa.lastIndex=0;;){const o=oa.exec(i),s=oa.lastIndex;let a=o[1];const l=\"]\"===o[2],c=o[3];if(l&&(a|=0),void 0===c||\"[\"===c&&s+2===r){sa(n,void 0===c?new na(a,e,t):new ia(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new ra(a),sa(n,e)),n=e}}}function la(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);aa(n,e.getUniformLocation(t,n.name),this)}}function ca(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}la.prototype.setValue=function(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)},la.prototype.setOptional=function(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)},la.upload=function(e,t,n,i){for(let r=0,o=t.length;r!==o;++r){const o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}},la.seqWithValue=function(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n};let ua=0;function ha(e){switch(e){case Jt:return[\"Linear\",\"( value )\"];case $t:return[\"sRGB\",\"( value )\"];case Qt:return[\"RGBE\",\"( value )\"];case tn:return[\"RGBM\",\"( value, 7.0 )\"];case nn:return[\"RGBM\",\"( value, 16.0 )\"];case rn:return[\"RGBD\",\"( value, 256.0 )\"];case Kt:return[\"Gamma\",\"( value, float( GAMMA_FACTOR ) )\"];case en:return[\"LogLuv\",\"( value )\"];default:return console.warn(\"THREE.WebGLProgram: Unsupported encoding:\",e),[\"Linear\",\"( value )\"]}}function da(e,t,n){const i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return i&&\"\"===r?\"\":\"THREE.WebGLShader: gl.getShaderInfoLog() \"+n+\"\\n\"+r+function(e){const t=e.split(\"\\n\");for(let e=0;e<t.length;e++)t[e]=e+1+\": \"+t[e];return t.join(\"\\n\")}(e.getShaderSource(t))}function pa(e,t){const n=ha(t);return\"vec4 \"+e+\"( vec4 value ) { return \"+n[0]+\"ToLinear\"+n[1]+\"; }\"}function fa(e,t){const n=ha(t);return\"vec4 \"+e+\"( vec4 value ) { return LinearTo\"+n[0]+n[1]+\"; }\"}function ma(e,t){let n;switch(t){case Q:n=\"Linear\";break;case ee:n=\"Reinhard\";break;case te:n=\"OptimizedCineon\";break;case ne:n=\"ACESFilmic\";break;case ie:n=\"Custom\";break;default:console.warn(\"THREE.WebGLProgram: Unsupported toneMapping:\",t),n=\"Linear\"}return\"vec3 \"+e+\"( vec3 color ) { return \"+n+\"ToneMapping( color ); }\"}function ga(e){return\"\"!==e}function va(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ya(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const xa=/^[ \\t]*#include +<([\\w\\d./]+)>/gm;function _a(e){return e.replace(xa,ba)}function ba(e,t){const n=Vo[t];if(void 0===n)throw new Error(\"Can not resolve #include <\"+t+\">\");return _a(n)}const wa=/#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g,Ma=/#pragma unroll_loop_start\\s+for\\s*\\(\\s*int\\s+i\\s*=\\s*(\\d+)\\s*;\\s*i\\s*<\\s*(\\d+)\\s*;\\s*i\\s*\\+\\+\\s*\\)\\s*{([\\s\\S]+?)}\\s+#pragma unroll_loop_end/g;function Sa(e){return e.replace(Ma,Ta).replace(wa,Ea)}function Ea(e,t,n,i){return console.warn(\"WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead.\"),Ta(0,t,n,i)}function Ta(e,t,n,i){let r=\"\";for(let e=parseInt(t);e<parseInt(n);e++)r+=i.replace(/\\[\\s*i\\s*\\]/g,\"[ \"+e+\" ]\").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function Aa(e){let t=\"precision \"+e.precision+\" float;\\nprecision \"+e.precision+\" int;\";return\"highp\"===e.precision?t+=\"\\n#define HIGH_PRECISION\":\"mediump\"===e.precision?t+=\"\\n#define MEDIUM_PRECISION\":\"lowp\"===e.precision&&(t+=\"\\n#define LOW_PRECISION\"),t}function La(e,t,n,i){const r=e.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const l=function(e){let t=\"SHADOWMAP_TYPE_BASIC\";return e.shadowMapType===h?t=\"SHADOWMAP_TYPE_PCF\":e.shadowMapType===d?t=\"SHADOWMAP_TYPE_PCF_SOFT\":e.shadowMapType===p&&(t=\"SHADOWMAP_TYPE_VSM\"),t}(n),c=function(e){let t=\"ENVMAP_TYPE_CUBE\";if(e.envMap)switch(e.envMapMode){case oe:case se:t=\"ENVMAP_TYPE_CUBE\";break;case ce:case ue:t=\"ENVMAP_TYPE_CUBE_UV\"}return t}(n),u=function(e){let t=\"ENVMAP_MODE_REFLECTION\";if(e.envMap)switch(e.envMapMode){case se:case ue:t=\"ENVMAP_MODE_REFRACTION\"}return t}(n),f=function(e){let t=\"ENVMAP_BLENDING_NONE\";if(e.envMap)switch(e.combine){case Z:t=\"ENVMAP_BLENDING_MULTIPLY\";break;case J:t=\"ENVMAP_BLENDING_MIX\";break;case $:t=\"ENVMAP_BLENDING_ADD\"}return t}(n),m=e.gammaFactor>0?e.gammaFactor:1,g=n.isWebGL2?\"\":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||\"physical\"===e.shaderID?\"#extension GL_OES_standard_derivatives : enable\":\"\",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?\"#extension GL_EXT_frag_depth : enable\":\"\",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?\"#extension GL_EXT_draw_buffers : require\":\"\",(e.extensionShaderTextureLOD||e.envMap||e.transmission>0)&&e.rendererExtensionShaderTextureLod?\"#extension GL_EXT_shader_texture_lod : enable\":\"\"].filter(ga).join(\"\\n\")}(n),v=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push(\"#define \"+n+\" \"+i)}return t.join(\"\\n\")}(o),y=r.createProgram();let x,_,b=n.glslVersion?\"#version \"+n.glslVersion+\"\\n\":\"\";n.isRawShaderMaterial?(x=[v].filter(ga).join(\"\\n\"),x.length>0&&(x+=\"\\n\"),_=[g,v].filter(ga).join(\"\\n\"),_.length>0&&(_+=\"\\n\")):(x=[Aa(n),\"#define SHADER_NAME \"+n.shaderName,v,n.instancing?\"#define USE_INSTANCING\":\"\",n.instancingColor?\"#define USE_INSTANCING_COLOR\":\"\",n.supportsVertexTextures?\"#define VERTEX_TEXTURES\":\"\",\"#define GAMMA_FACTOR \"+m,\"#define MAX_BONES \"+n.maxBones,n.useFog&&n.fog?\"#define USE_FOG\":\"\",n.useFog&&n.fogExp2?\"#define FOG_EXP2\":\"\",n.map?\"#define USE_MAP\":\"\",n.envMap?\"#define USE_ENVMAP\":\"\",n.envMap?\"#define \"+u:\"\",n.lightMap?\"#define USE_LIGHTMAP\":\"\",n.aoMap?\"#define USE_AOMAP\":\"\",n.emissiveMap?\"#define USE_EMISSIVEMAP\":\"\",n.bumpMap?\"#define USE_BUMPMAP\":\"\",n.normalMap?\"#define USE_NORMALMAP\":\"\",n.normalMap&&n.objectSpaceNormalMap?\"#define OBJECTSPACE_NORMALMAP\":\"\",n.normalMap&&n.tangentSpaceNormalMap?\"#define TANGENTSPACE_NORMALMAP\":\"\",n.clearcoatMap?\"#define USE_CLEARCOATMAP\":\"\",n.clearcoatRoughnessMap?\"#define USE_CLEARCOAT_ROUGHNESSMAP\":\"\",n.clearcoatNormalMap?\"#define USE_CLEARCOAT_NORMALMAP\":\"\",n.displacementMap&&n.supportsVertexTextures?\"#define USE_DISPLACEMENTMAP\":\"\",n.specularMap?\"#define USE_SPECULARMAP\":\"\",n.roughnessMap?\"#define USE_ROUGHNESSMAP\":\"\",n.metalnessMap?\"#define USE_METALNESSMAP\":\"\",n.alphaMap?\"#define USE_ALPHAMAP\":\"\",n.transmission?\"#define USE_TRANSMISSION\":\"\",n.transmissionMap?\"#define USE_TRANSMISSIONMAP\":\"\",n.thicknessMap?\"#define USE_THICKNESSMAP\":\"\",n.vertexTangents?\"#define USE_TANGENT\":\"\",n.vertexColors?\"#define USE_COLOR\":\"\",n.vertexAlphas?\"#define USE_COLOR_ALPHA\":\"\",n.vertexUvs?\"#define USE_UV\":\"\",n.uvsVertexOnly?\"#define UVS_VERTEX_ONLY\":\"\",n.flatShading?\"#define FLAT_SHADED\":\"\",n.skinning?\"#define USE_SKINNING\":\"\",n.useVertexTexture?\"#define BONE_TEXTURE\":\"\",n.morphTargets?\"#define USE_MORPHTARGETS\":\"\",n.morphNormals&&!1===n.flatShading?\"#define USE_MORPHNORMALS\":\"\",n.doubleSided?\"#define DOUBLE_SIDED\":\"\",n.flipSided?\"#define FLIP_SIDED\":\"\",n.shadowMapEnabled?\"#define USE_SHADOWMAP\":\"\",n.shadowMapEnabled?\"#define \"+l:\"\",n.sizeAttenuation?\"#define USE_SIZEATTENUATION\":\"\",n.logarithmicDepthBuffer?\"#define USE_LOGDEPTHBUF\":\"\",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?\"#define USE_LOGDEPTHBUF_EXT\":\"\",\"uniform mat4 modelMatrix;\",\"uniform mat4 modelViewMatrix;\",\"uniform mat4 projectionMatrix;\",\"uniform mat4 viewMatrix;\",\"uniform mat3 normalMatrix;\",\"uniform vec3 cameraPosition;\",\"uniform bool isOrthographic;\",\"#ifdef USE_INSTANCING\",\"\\tattribute mat4 instanceMatrix;\",\"#endif\",\"#ifdef USE_INSTANCING_COLOR\",\"\\tattribute vec3 instanceColor;\",\"#endif\",\"attribute vec3 position;\",\"attribute vec3 normal;\",\"attribute vec2 uv;\",\"#ifdef USE_TANGENT\",\"\\tattribute vec4 tangent;\",\"#endif\",\"#if defined( USE_COLOR_ALPHA )\",\"\\tattribute vec4 color;\",\"#elif defined( USE_COLOR )\",\"\\tattribute vec3 color;\",\"#endif\",\"#ifdef USE_MORPHTARGETS\",\"\\tattribute vec3 morphTarget0;\",\"\\tattribute vec3 morphTarget1;\",\"\\tattribute vec3 morphTarget2;\",\"\\tattribute vec3 morphTarget3;\",\"\\t#ifdef USE_MORPHNORMALS\",\"\\t\\tattribute vec3 morphNormal0;\",\"\\t\\tattribute vec3 morphNormal1;\",\"\\t\\tattribute vec3 morphNormal2;\",\"\\t\\tattribute vec3 morphNormal3;\",\"\\t#else\",\"\\t\\tattribute vec3 morphTarget4;\",\"\\t\\tattribute vec3 morphTarget5;\",\"\\t\\tattribute vec3 morphTarget6;\",\"\\t\\tattribute vec3 morphTarget7;\",\"\\t#endif\",\"#endif\",\"#ifdef USE_SKINNING\",\"\\tattribute vec4 skinIndex;\",\"\\tattribute vec4 skinWeight;\",\"#endif\",\"\\n\"].filter(ga).join(\"\\n\"),_=[g,Aa(n),\"#define SHADER_NAME \"+n.shaderName,v,n.alphaTest?\"#define ALPHATEST \"+n.alphaTest+(n.alphaTest%1?\"\":\".0\"):\"\",\"#define GAMMA_FACTOR \"+m,n.useFog&&n.fog?\"#define USE_FOG\":\"\",n.useFog&&n.fogExp2?\"#define FOG_EXP2\":\"\",n.map?\"#define USE_MAP\":\"\",n.matcap?\"#define USE_MATCAP\":\"\",n.envMap?\"#define USE_ENVMAP\":\"\",n.envMap?\"#define \"+c:\"\",n.envMap?\"#define \"+u:\"\",n.envMap?\"#define \"+f:\"\",n.lightMap?\"#define USE_LIGHTMAP\":\"\",n.aoMap?\"#define USE_AOMAP\":\"\",n.emissiveMap?\"#define USE_EMISSIVEMAP\":\"\",n.bumpMap?\"#define USE_BUMPMAP\":\"\",n.normalMap?\"#define USE_NORMALMAP\":\"\",n.normalMap&&n.objectSpaceNormalMap?\"#define OBJECTSPACE_NORMALMAP\":\"\",n.normalMap&&n.tangentSpaceNormalMap?\"#define TANGENTSPACE_NORMALMAP\":\"\",n.clearcoatMap?\"#define USE_CLEARCOATMAP\":\"\",n.clearcoatRoughnessMap?\"#define USE_CLEARCOAT_ROUGHNESSMAP\":\"\",n.clearcoatNormalMap?\"#define USE_CLEARCOAT_NORMALMAP\":\"\",n.specularMap?\"#define USE_SPECULARMAP\":\"\",n.roughnessMap?\"#define USE_ROUGHNESSMAP\":\"\",n.metalnessMap?\"#define USE_METALNESSMAP\":\"\",n.alphaMap?\"#define USE_ALPHAMAP\":\"\",n.sheen?\"#define USE_SHEEN\":\"\",n.transmission?\"#define USE_TRANSMISSION\":\"\",n.transmissionMap?\"#define USE_TRANSMISSIONMAP\":\"\",n.thicknessMap?\"#define USE_THICKNESSMAP\":\"\",n.vertexTangents?\"#define USE_TANGENT\":\"\",n.vertexColors||n.instancingColor?\"#define USE_COLOR\":\"\",n.vertexAlphas?\"#define USE_COLOR_ALPHA\":\"\",n.vertexUvs?\"#define USE_UV\":\"\",n.uvsVertexOnly?\"#define UVS_VERTEX_ONLY\":\"\",n.gradientMap?\"#define USE_GRADIENTMAP\":\"\",n.flatShading?\"#define FLAT_SHADED\":\"\",n.doubleSided?\"#define DOUBLE_SIDED\":\"\",n.flipSided?\"#define FLIP_SIDED\":\"\",n.shadowMapEnabled?\"#define USE_SHADOWMAP\":\"\",n.shadowMapEnabled?\"#define \"+l:\"\",n.premultipliedAlpha?\"#define PREMULTIPLIED_ALPHA\":\"\",n.physicallyCorrectLights?\"#define PHYSICALLY_CORRECT_LIGHTS\":\"\",n.logarithmicDepthBuffer?\"#define USE_LOGDEPTHBUF\":\"\",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?\"#define USE_LOGDEPTHBUF_EXT\":\"\",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?\"#define TEXTURE_LOD_EXT\":\"\",\"uniform mat4 viewMatrix;\",\"uniform vec3 cameraPosition;\",\"uniform bool isOrthographic;\",n.toneMapping!==K?\"#define TONE_MAPPING\":\"\",n.toneMapping!==K?Vo.tonemapping_pars_fragment:\"\",n.toneMapping!==K?ma(\"toneMapping\",n.toneMapping):\"\",n.dithering?\"#define DITHERING\":\"\",Vo.encodings_pars_fragment,n.map?pa(\"mapTexelToLinear\",n.mapEncoding):\"\",n.matcap?pa(\"matcapTexelToLinear\",n.matcapEncoding):\"\",n.envMap?pa(\"envMapTexelToLinear\",n.envMapEncoding):\"\",n.emissiveMap?pa(\"emissiveMapTexelToLinear\",n.emissiveMapEncoding):\"\",n.lightMap?pa(\"lightMapTexelToLinear\",n.lightMapEncoding):\"\",fa(\"linearToOutputTexel\",n.outputEncoding),n.depthPacking?\"#define DEPTH_PACKING \"+n.depthPacking:\"\",\"\\n\"].filter(ga).join(\"\\n\")),s=_a(s),s=va(s,n),s=ya(s,n),a=_a(a),a=va(a,n),a=ya(a,n),s=Sa(s),a=Sa(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(b=\"#version 300 es\\n\",x=[\"#define attribute in\",\"#define varying out\",\"#define texture2D texture\"].join(\"\\n\")+\"\\n\"+x,_=[\"#define varying in\",n.glslVersion===Fn?\"\":\"out highp vec4 pc_fragColor;\",n.glslVersion===Fn?\"\":\"#define gl_FragColor pc_fragColor\",\"#define gl_FragDepthEXT gl_FragDepth\",\"#define texture2D texture\",\"#define textureCube texture\",\"#define texture2DProj textureProj\",\"#define texture2DLodEXT textureLod\",\"#define texture2DProjLodEXT textureProjLod\",\"#define textureCubeLodEXT textureLod\",\"#define texture2DGradEXT textureGrad\",\"#define texture2DProjGradEXT textureProjGrad\",\"#define textureCubeGradEXT textureGrad\"].join(\"\\n\")+\"\\n\"+_);const w=b+_+a,M=ca(r,35633,b+x+s),S=ca(r,35632,w);if(r.attachShader(y,M),r.attachShader(y,S),void 0!==n.index0AttributeName?r.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(y,0,\"position\"),r.linkProgram(y),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(y).trim(),t=r.getShaderInfoLog(M).trim(),n=r.getShaderInfoLog(S).trim();let i=!0,o=!0;if(!1===r.getProgramParameter(y,35714)){i=!1;const t=da(r,M,\"vertex\"),n=da(r,S,\"fragment\");console.error(\"THREE.WebGLProgram: shader error: \",r.getError(),\"35715\",r.getProgramParameter(y,35715),\"gl.getProgramInfoLog\",e,t,n)}else\"\"!==e?console.warn(\"THREE.WebGLProgram: gl.getProgramInfoLog()\",e):\"\"!==t&&\"\"!==n||(o=!1);o&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:x},fragmentShader:{log:n,prefix:_}})}let E,T;return r.deleteShader(M),r.deleteShader(S),this.getUniforms=function(){return void 0===E&&(E=new la(r,y)),E},this.getAttributes=function(){return void 0===T&&(T=function(e,t){const n={},i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r).name;n[i]=e.getAttribLocation(t,i)}return n}(r,y)),T},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=ua++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=M,this.fragmentShader=S,this}function Ca(e,t,n,i,r,o){const s=[],a=i.isWebGL2,l=i.logarithmicDepthBuffer,c=i.floatVertexTextures,u=i.maxVertexUniforms,h=i.vertexTextures;let d=i.precision;const p={MeshDepthMaterial:\"depth\",MeshDistanceMaterial:\"distanceRGBA\",MeshNormalMaterial:\"normal\",MeshBasicMaterial:\"basic\",MeshLambertMaterial:\"lambert\",MeshPhongMaterial:\"phong\",MeshToonMaterial:\"toon\",MeshStandardMaterial:\"physical\",MeshPhysicalMaterial:\"physical\",MeshMatcapMaterial:\"matcap\",LineBasicMaterial:\"basic\",LineDashedMaterial:\"dashed\",PointsMaterial:\"points\",ShadowMaterial:\"shadow\",SpriteMaterial:\"sprite\"},f=[\"precision\",\"isWebGL2\",\"supportsVertexTextures\",\"outputEncoding\",\"instancing\",\"instancingColor\",\"map\",\"mapEncoding\",\"matcap\",\"matcapEncoding\",\"envMap\",\"envMapMode\",\"envMapEncoding\",\"envMapCubeUV\",\"lightMap\",\"lightMapEncoding\",\"aoMap\",\"emissiveMap\",\"emissiveMapEncoding\",\"bumpMap\",\"normalMap\",\"objectSpaceNormalMap\",\"tangentSpaceNormalMap\",\"clearcoatMap\",\"clearcoatRoughnessMap\",\"clearcoatNormalMap\",\"displacementMap\",\"specularMap\",\"roughnessMap\",\"metalnessMap\",\"gradientMap\",\"alphaMap\",\"combine\",\"vertexColors\",\"vertexAlphas\",\"vertexTangents\",\"vertexUvs\",\"uvsVertexOnly\",\"fog\",\"useFog\",\"fogExp2\",\"flatShading\",\"sizeAttenuation\",\"logarithmicDepthBuffer\",\"skinning\",\"maxBones\",\"useVertexTexture\",\"morphTargets\",\"morphNormals\",\"premultipliedAlpha\",\"numDirLights\",\"numPointLights\",\"numSpotLights\",\"numHemiLights\",\"numRectAreaLights\",\"numDirLightShadows\",\"numPointLightShadows\",\"numSpotLightShadows\",\"shadowMapEnabled\",\"shadowMapType\",\"toneMapping\",\"physicallyCorrectLights\",\"alphaTest\",\"doubleSided\",\"flipSided\",\"numClippingPlanes\",\"numClipIntersection\",\"depthPacking\",\"dithering\",\"sheen\",\"transmission\",\"transmissionMap\",\"thicknessMap\"];function v(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn(\"THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.\"),t=e.texture.encoding):t=Jt,t}return{getParameters:function(r,s,f,y,x){const _=y.fog,b=r.isMeshStandardMaterial?y.environment:null,w=t.get(r.envMap||b),M=p[r.type],S=x.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(c)return 1024;{const e=u,n=Math.floor((e-20)/4),i=Math.min(n,t.length);return i<t.length?(console.warn(\"THREE.WebGLRenderer: Skeleton has \"+t.length+\" bones. This GPU supports \"+i+\".\"),0):i}}(x):0;let E,T;if(null!==r.precision&&(d=i.getMaxPrecision(r.precision),d!==r.precision&&console.warn(\"THREE.WebGLProgram.getParameters:\",r.precision,\"not supported, using\",d,\"instead.\")),M){const e=jo[M];E=e.vertexShader,T=e.fragmentShader}else E=r.vertexShader,T=r.fragmentShader;const A=e.getRenderTarget();return{isWebGL2:a,shaderID:M,shaderName:r.type,vertexShader:E,fragmentShader:T,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:d,instancing:!0===x.isInstancedMesh,instancingColor:!0===x.isInstancedMesh&&null!==x.instanceColor,supportsVertexTextures:h,outputEncoding:null!==A?v(A.texture):e.outputEncoding,map:!!r.map,mapEncoding:v(r.map),matcap:!!r.matcap,matcapEncoding:v(r.matcap),envMap:!!w,envMapMode:w&&w.mapping,envMapEncoding:v(w),envMapCubeUV:!!w&&(w.mapping===ce||w.mapping===ue),lightMap:!!r.lightMap,lightMapEncoding:v(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:v(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===ln,tangentSpaceNormalMap:r.normalMapType===an,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmission:!!r.transmission,transmissionMap:!!r.transmissionMap,thicknessMap:!!r.thicknessMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexAlphas:!0===r.vertexColors&&x.geometry&&x.geometry.attributes.color&&4===x.geometry.attributes.color.itemSize,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmission||r.transmissionMap||r.thicknessMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmission||r.transmissionMap||r.thicknessMap||!r.displacementMap),fog:!!_,useFog:r.fog,fogExp2:_&&_.isFogExp2,flatShading:!!r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:l,skinning:!0===x.isSkinnedMesh&&S>0,maxBones:S,useVertexTexture:c,morphTargets:r.morphTargets,morphNormals:r.morphNormals,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&f.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:K,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===g,flipSided:r.side===m,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||n.has(\"EXT_frag_depth\"),rendererExtensionDrawBuffers:a||n.has(\"WEBGL_draw_buffers\"),rendererExtensionShaderTextureLod:a||n.has(\"EXT_shader_texture_lod\"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<f.length;e++)n.push(t[f[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=jo[t];n=Lo.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,t=s.length;e<t;e++){const t=s[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new La(e,n,t,r),s.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},programs:s}}function Pa(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Ra(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Da(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ia(e){const t=[];let n=0;const i=[],r=[],o=[],s={id:-1};function a(i,r,o,a,l,c){let u=t[n];const h=e.get(o);return void 0===u?(u={id:i.id,object:i,geometry:r,material:o,program:h.program||s,groupOrder:a,renderOrder:i.renderOrder,z:l,group:c},t[n]=u):(u.id=i.id,u.object=i,u.geometry=r,u.material=o,u.program=h.program||s,u.groupOrder=a,u.renderOrder=i.renderOrder,u.z=l,u.group=c),n++,u}return{opaque:i,transmissive:r,transparent:o,init:function(){n=0,i.length=0,r.length=0,o.length=0},push:function(e,t,n,s,l,c){const u=a(e,t,n,s,l,c);n.transmission>0?r.push(u):!0===n.transparent?o.push(u):i.push(u)},unshift:function(e,t,n,s,l,c){const u=a(e,t,n,s,l,c);n.transmission>0?r.unshift(u):!0===n.transparent?o.unshift(u):i.unshift(u)},finish:function(){for(let e=n,i=t.length;e<i;e++){const n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){i.length>1&&i.sort(e||Ra),r.length>1&&r.sort(t||Da),o.length>1&&o.sort(t||Da)}}}function Oa(e){let t=new WeakMap;return{get:function(n,i){let r;return!1===t.has(n)?(r=new Ia(e),t.set(n,[r])):i>=t.get(n).length?(r=new Ia(e),t.get(n).push(r)):r=t.get(n)[i],r},dispose:function(){t=new WeakMap}}}function Fa(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case\"DirectionalLight\":n={direction:new ai,color:new Ir};break;case\"SpotLight\":n={position:new ai,direction:new ai,color:new Ir,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case\"PointLight\":n={position:new ai,color:new Ir,distance:0,decay:0};break;case\"HemisphereLight\":n={direction:new ai,skyColor:new Ir,groundColor:new Ir};break;case\"RectAreaLight\":n={color:new Ir,position:new ai,halfWidth:new ai,halfHeight:new ai}}return e[t.id]=n,n}}}let Na=0;function za(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Ua(e,t){const n=new Fa,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case\"DirectionalLight\":case\"SpotLight\":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zn};break;case\"PointLight\":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)r.probe.push(new ai);const o=new ai,s=new Ui,a=new Ui;return{setup:function(o){let s=0,a=0,l=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0;o.sort(za);for(let e=0,t=o.length;e<t;e++){const t=o[e],v=t.color,y=t.intensity,x=t.distance,_=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=v.r*y,a+=v.g*y,l+=v.b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[c]=n,r.directionalShadowMap[c]=_,r.directionalShadowMatrix[c]=t.shadow.matrix,f++}r.directional[c]=e,c++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(v).multiplyScalar(y),e.distance=x,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.spotShadow[h]=n,r.spotShadowMap[h]=_,r.spotShadowMatrix[h]=t.shadow.matrix,g++}r.spot[h]=e,h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(v).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[d]=e,d++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[u]=n,r.pointShadowMap[u]=_,r.pointShadowMatrix[u]=t.shadow.matrix,m++}r.point[u]=e,u++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(y),e.groundColor.copy(t.groundColor).multiplyScalar(y),r.hemi[p]=e,p++}}d>0&&(t.isWebGL2||!0===e.has(\"OES_texture_float_linear\")?(r.rectAreaLTC1=Ho.LTC_FLOAT_1,r.rectAreaLTC2=Ho.LTC_FLOAT_2):!0===e.has(\"OES_texture_half_float_linear\")?(r.rectAreaLTC1=Ho.LTC_HALF_1,r.rectAreaLTC2=Ho.LTC_HALF_2):console.error(\"THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.\")),r.ambient[0]=s,r.ambient[1]=a,r.ambient[2]=l;const v=r.hash;v.directionalLength===c&&v.pointLength===u&&v.spotLength===h&&v.rectAreaLength===d&&v.hemiLength===p&&v.numDirectionalShadows===f&&v.numPointShadows===m&&v.numSpotShadows===g||(r.directional.length=c,r.spot.length=h,r.rectArea.length=d,r.point.length=u,r.hemi.length=p,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=m,r.pointShadowMap.length=m,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=m,r.spotShadowMatrix.length=g,v.directionalLength=c,v.pointLength=u,v.spotLength=h,v.rectAreaLength=d,v.hemiLength=p,v.numDirectionalShadows=f,v.numPointShadows=m,v.numSpotShadows=g,r.version=Na++)},setupView:function(e,t){let n=0,i=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),a.identity(),s.copy(d.matrixWorld),s.premultiply(h),a.extractRotation(s),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const e=r.point[i];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),i++}else if(d.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),u++}}},state:r}}function Ba(e,t){const n=new Ua(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(){n.setup(i)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function Ga(e,t){let n=new WeakMap;return{get:function(i,r=0){let o;return!1===n.has(i)?(o=new Ba(e,t),n.set(i,[o])):r>=n.get(i).length?(o=new Ba(e,t),n.get(i).push(o)):o=n.get(i)[r],o},dispose:function(){n=new WeakMap}}}class ka extends Tr{constructor(e){super(),this.type=\"MeshDepthMaterial\",this.depthPacking=on,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}ka.prototype.isMeshDepthMaterial=!0;class Va extends Tr{constructor(e){super(),this.type=\"MeshDistanceMaterial\",this.referencePosition=new ai,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}Va.prototype.isMeshDistanceMaterial=!0;var Ha=\"uniform sampler2D shadow_pass;\\nuniform vec2 resolution;\\nuniform float radius;\\n#include <packing>\\nvoid main() {\\n\\tfloat mean = 0.0;\\n\\tfloat squared_mean = 0.0;\\n\\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\\n\\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\\n\\t\\t#ifdef HORIZONTAL_PASS\\n\\t\\t\\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\\n\\t\\t\\tmean += distribution.x;\\n\\t\\t\\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\\n\\t\\t#else\\n\\t\\t\\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\\n\\t\\t\\tmean += depth;\\n\\t\\t\\tsquared_mean += depth * depth;\\n\\t\\t#endif\\n\\t}\\n\\tmean = mean * HALF_SAMPLE_RATE;\\n\\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\\n\\tfloat std_dev = sqrt( squared_mean - mean * mean );\\n\\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\\n}\",ja=\"void main() {\\n\\tgl_Position = vec4( position, 1.0 );\\n}\";function Wa(e,t,n){let i=new Uo;const r=new Zn,o=new Zn,s=new ni,a=[],l=[],c={},u=n.maxTextureSize,d={0:m,1:f,2:g},v=new Co({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Zn},radius:{value:4}},vertexShader:ja,fragmentShader:Ha}),y=v.clone();y.defines.HORIZONTAL_PASS=1;const _=new ro;_.setAttribute(\"position\",new zr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new Mo(_,v),w=this;function M(n,i){const r=t.update(b);v.uniforms.shadow_pass.value=n.map.texture,v.uniforms.resolution.value=n.mapSize,v.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,v,b,null),y.uniforms.shadow_pass.value=n.mapPass.texture,y.uniforms.resolution.value=n.mapSize,y.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,y,b,null)}function S(e){const t=e<<0;let n=a[t];return void 0===n&&(n=new ka({depthPacking:sn,morphTargets:e}),a[t]=n),n}function E(e){const t=e<<0;let n=l[t];return void 0===n&&(n=new Va({morphTargets:e}),l[t]=n),n}function T(t,n,i,r,o,s,a){let l=null,u=S,h=t.customDepthMaterial;if(!0===r.isPointLight&&(u=E,h=t.customDistanceMaterial),void 0===h){let e=!1;!0===i.morphTargets&&(e=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0),l=u(e)}else l=h;if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){const e=l.uuid,t=i.uuid;let n=c[e];void 0===n&&(n={},c[e]=n);let r=n[t];void 0===r&&(r=l.clone(),n[t]=r),l=r}return l.visible=i.visible,l.wireframe=i.wireframe,l.side=a===p?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:d[i.side],l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=o,l.farDistance=s),l}function A(n,r,o,s,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===p)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const i=t.update(n),r=n.material;if(Array.isArray(r)){const t=i.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=r[c.materialIndex];if(u&&u.visible){const t=T(n,i,u,s,o.near,o.far,a);e.renderBufferDirect(o,null,i,t,n,c)}}}else if(r.visible){const t=T(n,i,r,s,o.near,o.far,a);e.renderBufferDirect(o,null,i,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)A(l[e],r,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h,this.render=function(t,n,a){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(x),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=t.length;l<c;l++){const c=t[l],h=c.shadow;if(void 0===h){console.warn(\"THREE.WebGLShadowMap:\",c,\"has no shadow.\");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;r.copy(h.mapSize);const f=h.getFrameExtents();if(r.multiply(f),o.copy(h.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(o.x=Math.floor(u/f.x),r.x=o.x*f.x,h.mapSize.x=o.x),r.y>u&&(o.y=Math.floor(u/f.y),r.y=o.y*f.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&this.type===p){const e={minFilter:xe,magFilter:xe,format:Ue};h.map=new ii(r.x,r.y,e),h.map.texture.name=c.name+\".shadowMap\",h.mapPass=new ii(r.x,r.y,e),h.camera.updateProjectionMatrix()}if(null===h.map){const e={minFilter:fe,magFilter:fe,format:Ue};h.map=new ii(r.x,r.y,e),h.map.texture.name=c.name+\".shadowMap\",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const m=h.getViewportCount();for(let e=0;e<m;e++){const t=h.getViewport(e);s.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),d.viewport(s),h.updateMatrices(c,e),i=h.getFrustum(),A(n,a,h.camera,c,this.type)}h.isPointLightShadow||this.type!==p||M(h,a),h.needsUpdate=!1}w.needsUpdate=!1,e.setRenderTarget(l,c,h)}}function qa(e,t,n){const i=n.isWebGL2,r=new function(){let t=!1;const n=new ni;let i=null;const r=new ni(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,o,s,a){!0===a&&(t*=s,i*=s,o*=s),n.set(t,i,o,s),!1===r.equals(n)&&(e.clearColor(t,i,o,s),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},o=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(e){e?ye(2929):xe(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case k:e.depthFunc(512);break;case V:e.depthFunc(519);break;case H:e.depthFunc(513);break;case j:e.depthFunc(515);break;case W:e.depthFunc(514);break;case q:e.depthFunc(518);break;case X:e.depthFunc(516);break;case Y:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},c=new function(){let t=!1,n=null,i=null,r=null,o=null,s=null,a=null,l=null,c=null;return{setTest:function(e){t||(e?ye(2960):xe(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,s){i===t&&r===n&&o===s||(e.stencilFunc(t,n,s),i=t,r=n,o=s)},setOp:function(t,n,i){s===t&&a===n&&l===i||(e.stencilOp(t,n,i),s=t,a=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,o=null,s=null,a=null,l=null,c=null}}};let u={},h=null,d={},p=null,f=!1,v=null,y=null,Z=null,J=null,$=null,K=null,Q=null,ee=!1,te=null,ne=null,ie=null,re=null,oe=null;const se=e.getParameter(35661);let ae=!1,le=0;const ce=e.getParameter(7938);-1!==ce.indexOf(\"WebGL\")?(le=parseFloat(/^WebGL (\\d)/.exec(ce)[1]),ae=le>=1):-1!==ce.indexOf(\"OpenGL ES\")&&(le=parseFloat(/^OpenGL ES (\\d)/.exec(ce)[1]),ae=le>=2);let ue=null,he={};const de=e.getParameter(3088),pe=e.getParameter(2978),fe=(new ni).fromArray(de),me=(new ni).fromArray(pe);function ge(t,n,i){const r=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<i;t++)e.texImage2D(n+t,0,6408,1,1,0,6408,5121,r);return o}const ve={};function ye(t){!0!==u[t]&&(e.enable(t),u[t]=!0)}function xe(t){!1!==u[t]&&(e.disable(t),u[t]=!1)}ve[3553]=ge(3553,3553,1),ve[34067]=ge(34067,34069,6),r.setClear(0,0,0,1),o.setClear(1),c.setClear(0),ye(2929),o.setFunc(j),Me(!1),Se(a),ye(2884),we(x);const _e={[E]:32774,[T]:32778,[A]:32779};if(i)_e[L]=32775,_e[C]=32776;else{const e=t.get(\"EXT_blend_minmax\");null!==e&&(_e[L]=e.MIN_EXT,_e[C]=e.MAX_EXT)}const be={[P]:0,[R]:1,[D]:768,[O]:770,[G]:776,[U]:774,[N]:772,[I]:769,[F]:771,[B]:775,[z]:773};function we(t,n,i,r,o,s,a,l){if(t!==x){if(!1===f&&(ye(3042),f=!0),t===S)o=o||n,s=s||i,a=a||r,n===y&&o===$||(e.blendEquationSeparate(_e[n],_e[o]),y=n,$=o),i===Z&&r===J&&s===K&&a===Q||(e.blendFuncSeparate(be[i],be[r],be[s],be[a]),Z=i,J=r,K=s,Q=a),v=t,ee=null;else if(t!==v||l!==ee){if(y===E&&$===E||(e.blendEquation(32774),y=E,$=E),l)switch(t){case _:e.blendFuncSeparate(1,771,1,771);break;case b:e.blendFunc(1,1);break;case w:e.blendFuncSeparate(0,0,769,771);break;case M:e.blendFuncSeparate(0,768,0,770);break;default:console.error(\"THREE.WebGLState: Invalid blending: \",t)}else switch(t){case _:e.blendFuncSeparate(770,771,1,771);break;case b:e.blendFunc(770,1);break;case w:e.blendFunc(0,769);break;case M:e.blendFunc(0,768);break;default:console.error(\"THREE.WebGLState: Invalid blending: \",t)}Z=null,J=null,K=null,Q=null,v=t,ee=l}}else!0===f&&(xe(3042),f=!1)}function Me(t){te!==t&&(t?e.frontFace(2304):e.frontFace(2305),te=t)}function Se(t){t!==s?(ye(2884),t!==ne&&(t===a?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):xe(2884),ne=t}function Ee(t,n,i){t?(ye(32823),re===n&&oe===i||(e.polygonOffset(n,i),re=n,oe=i)):xe(32823)}function Te(t){void 0===t&&(t=33984+se-1),ue!==t&&(e.activeTexture(t),ue=t)}return{buffers:{color:r,depth:o,stencil:c},enable:ye,disable:xe,bindFramebuffer:function(t,n){return null===n&&null!==h&&(n=h),d[t]!==n&&(e.bindFramebuffer(t,n),d[t]=n,i&&(36009===t&&(d[36160]=n),36160===t&&(d[36009]=n)),!0)},bindXRFramebuffer:function(t){t!==h&&(e.bindFramebuffer(36160,t),h=t)},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:we,setMaterial:function(e,t){e.side===g?xe(2884):ye(2884);let n=e.side===m;t&&(n=!n),Me(n),e.blending===_&&!1===e.transparent?we(x):we(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),r.setMask(e.colorWrite);const i=e.stencilWrite;c.setTest(i),i&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Ee(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?ye(32926):xe(32926)},setFlipSided:Me,setCullFace:Se,setLineWidth:function(t){t!==ie&&(ae&&e.lineWidth(t),ie=t)},setPolygonOffset:Ee,setScissorTest:function(e){e?ye(3089):xe(3089)},activeTexture:Te,bindTexture:function(t,n){null===ue&&Te();let i=he[ue];void 0===i&&(i={type:void 0,texture:void 0},he[ue]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||ve[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=he[ue];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error(\"THREE.WebGLState:\",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error(\"THREE.WebGLState:\",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error(\"THREE.WebGLState:\",e)}},scissor:function(t){!1===fe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),fe.copy(t))},viewport:function(t){!1===me.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),me.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),u={},ue=null,he={},h=null,d={},p=null,f=!1,v=null,y=null,Z=null,J=null,$=null,K=null,Q=null,ee=!1,te=null,ne=null,ie=null,re=null,oe=null,fe.set(0,0,e.canvas.width,e.canvas.height),me.set(0,0,e.canvas.width,e.canvas.height),r.reset(),o.reset(),c.reset()}}}function Xa(e,t,n,i,r,o,s){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,d=new WeakMap;let p,f=!1;try{f=\"undefined\"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext(\"2d\")}catch(e){}function m(e,t){return f?new OffscreenCanvas(e,t):document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\")}function g(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if(\"undefined\"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||\"undefined\"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||\"undefined\"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?Xn:Math.floor,o=i(r*e.width),s=i(r*e.height);void 0===p&&(p=m(o,s));const a=n?m(o,s):p;return a.width=o,a.height=s,a.getContext(\"2d\").drawImage(e,0,0,o,s),console.warn(\"THREE.WebGLRenderer: Texture has been resized from (\"+e.width+\"x\"+e.height+\") to (\"+o+\"x\"+s+\").\"),a}return\"data\"in e&&console.warn(\"THREE.WebGLRenderer: Image in DataTexture is too big (\"+e.width+\"x\"+e.height+\").\"),e}return e}function v(e){return Wn(e.width)&&Wn(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==fe&&e.minFilter!==xe}function x(t,n,r,o){e.generateMipmap(t),i.get(n).__maxMipLevel=Math.log2(Math.max(r,o))}function _(n,i,r){if(!1===a)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn(\"THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '\"+n+\"'\")}let o=i;return 6403===i&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===i&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===i&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get(\"EXT_color_buffer_float\"),o}function b(e){return e===fe||e===me||e===ve?9728:9729}function w(t){const n=t.target;n.removeEventListener(\"dispose\",w),function(t){const n=i.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),i.remove(t))}(n),n.isVideoTexture&&d.delete(n),s.memory.textures--}function M(t){const n=t.target;n.removeEventListener(\"dispose\",M),function(t){const n=t.texture,r=i.get(t),o=i.get(n);if(t){if(void 0!==o.__webglTexture&&(e.deleteTexture(o.__webglTexture),s.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&e.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),s.memory.textures--),i.remove(n[t])}i.remove(n),i.remove(t)}}(n)}let S=0;function E(e,t){const r=i.get(e);if(e.isVideoTexture&&function(e){const t=s.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(e),e.version>0&&r.__version!==e.version){const n=e.image;if(void 0===n)console.warn(\"THREE.WebGLRenderer: Texture marked for update but image is undefined\");else{if(!1!==n.complete)return void R(r,e,t);console.warn(\"THREE.WebGLRenderer: Texture marked for update but image is incomplete\")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}function T(t,r){const s=i.get(t);t.version>0&&s.__version!==t.version?function(t,i,r){if(6!==i.image.length)return;P(t,i),n.activeTexture(33984+r),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const s=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),l=i.image[0]&&i.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=s||l?l?i.image[e].image:i.image[e]:g(i.image[e],!1,!0,c);const h=u[0],d=v(h)||a,p=o.convert(i.format),f=o.convert(i.type),m=_(i.internalFormat,p,f);let b;if(C(34067,i,d),s){for(let e=0;e<6;e++){b=u[e].mipmaps;for(let t=0;t<b.length;t++){const r=b[t];i.format!==Ue&&i.format!==ze?null!==p?n.compressedTexImage2D(34069+e,t,m,r.width,r.height,0,r.data):console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()\"):n.texImage2D(34069+e,t,m,r.width,r.height,0,p,f,r.data)}}t.__maxMipLevel=b.length-1}else{b=i.mipmaps;for(let e=0;e<6;e++)if(l){n.texImage2D(34069+e,0,m,u[e].width,u[e].height,0,p,f,u[e].data);for(let t=0;t<b.length;t++){const i=b[t].image[e].image;n.texImage2D(34069+e,t+1,m,i.width,i.height,0,p,f,i.data)}}else{n.texImage2D(34069+e,0,m,p,f,u[e]);for(let t=0;t<b.length;t++){const i=b[t];n.texImage2D(34069+e,t+1,m,p,f,i.image[e])}}t.__maxMipLevel=b.length}y(i,d)&&x(34067,i,h.width,h.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}(s,t,r):(n.activeTexture(33984+r),n.bindTexture(34067,s.__webglTexture))}const A={[he]:10497,[de]:33071,[pe]:33648},L={[fe]:9728,[me]:9984,[ve]:9986,[xe]:9729,[_e]:9985,[we]:9987};function C(n,o,s){if(s?(e.texParameteri(n,10242,A[o.wrapS]),e.texParameteri(n,10243,A[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,A[o.wrapR]),e.texParameteri(n,10240,L[o.magFilter]),e.texParameteri(n,10241,L[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),o.wrapS===de&&o.wrapT===de||console.warn(\"THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.\"),e.texParameteri(n,10240,b(o.magFilter)),e.texParameteri(n,10241,b(o.minFilter)),o.minFilter!==fe&&o.minFilter!==xe&&console.warn(\"THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.\")),!0===t.has(\"EXT_texture_filter_anisotropic\")){const s=t.get(\"EXT_texture_filter_anisotropic\");if(o.type===Pe&&!1===t.has(\"OES_texture_float_linear\"))return;if(!1===a&&o.type===Re&&!1===t.has(\"OES_texture_half_float_linear\"))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function P(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener(\"dispose\",w),t.__webglTexture=e.createTexture(),s.memory.textures++)}function R(t,i,r){let s=3553;i.isDataTexture2DArray&&(s=35866),i.isDataTexture3D&&(s=32879),P(t,i),n.activeTexture(33984+r),n.bindTexture(s,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const l=function(e){return!a&&(e.wrapS!==de||e.wrapT!==de||e.minFilter!==fe&&e.minFilter!==xe)}(i)&&!1===v(i.image),c=g(i.image,l,!1,u),h=v(c)||a,d=o.convert(i.format);let p,f=o.convert(i.type),m=_(i.internalFormat,d,f);C(s,i,h);const b=i.mipmaps;if(i.isDepthTexture)m=6402,a?m=i.type===Pe?36012:i.type===Ce?33190:i.type===Fe?35056:33189:i.type===Pe&&console.error(\"WebGLRenderer: Floating point depth texture requires WebGL2.\"),i.format===Ve&&6402===m&&i.type!==Ae&&i.type!==Ce&&(console.warn(\"THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.\"),i.type=Ae,f=o.convert(i.type)),i.format===He&&6402===m&&(m=34041,i.type!==Fe&&(console.warn(\"THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.\"),i.type=Fe,f=o.convert(i.type))),n.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(i.isDataTexture)if(b.length>0&&h){for(let e=0,t=b.length;e<t;e++)p=b[e],n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);i.generateMipmaps=!1,t.__maxMipLevel=b.length-1}else n.texImage2D(3553,0,m,c.width,c.height,0,d,f,c.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(let e=0,t=b.length;e<t;e++)p=b[e],i.format!==Ue&&i.format!==ze?null!==d?n.compressedTexImage2D(3553,e,m,p.width,p.height,0,p.data):console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()\"):n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);t.__maxMipLevel=b.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(b.length>0&&h){for(let e=0,t=b.length;e<t;e++)p=b[e],n.texImage2D(3553,e,m,d,f,p);i.generateMipmaps=!1,t.__maxMipLevel=b.length-1}else n.texImage2D(3553,0,m,d,f,c),t.__maxMipLevel=0;y(i,h)&&x(s,i,c.width,c.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function D(t,r,s,a,l){const c=o.convert(s.format),u=o.convert(s.type),h=_(s.internalFormat,c,u);32879===l||35866===l?n.texImage3D(l,0,h,r.width,r.height,r.depth,0,c,u,null):n.texImage2D(l,0,h,r.width,r.height,0,c,u,null),n.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,l,i.get(s).__webglTexture,0),n.bindFramebuffer(36160,null)}function I(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===Pe?r=36012:t.type===Ce&&(r=33190));const i=O(n);e.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(i){const t=O(n);e.renderbufferStorageMultisample(36161,t,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,r=o.convert(t.format),s=o.convert(t.type),a=_(t.internalFormat,r,s);if(i){const t=O(n);e.renderbufferStorageMultisample(36161,t,a,n.width,n.height)}else e.renderbufferStorage(36161,a,n.width,n.height)}e.bindRenderbuffer(36161,null)}function O(e){return a&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}let F=!1,N=!1;this.allocateTextureUnit=function(){const e=S;return e>=l&&console.warn(\"THREE.WebGLTextures: Trying to use \"+e+\" texture units while this GPU supports only \"+l),S+=1,e},this.resetTextureUnits=function(){S=0},this.setTexture2D=E,this.setTexture2DArray=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?R(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?R(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=T,this.setupRenderTarget=function(t){const l=t.texture,c=i.get(t),u=i.get(l);t.addEventListener(\"dispose\",M),!0!==t.isWebGLMultipleRenderTargets&&(u.__webglTexture=e.createTexture(),u.__version=l.version,s.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=!0===t.isWebGLMultisampleRenderTarget,f=l.isDataTexture3D||l.isDataTexture2DArray,m=v(t)||a;if(!a||l.format!==ze||l.type!==Pe&&l.type!==Re||(l.format=Ue,console.warn(\"THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.\")),h){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else if(c.__webglFramebuffer=e.createFramebuffer(),d)if(r.drawBuffers){const n=t.texture;for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),s.memory.textures++)}}else console.warn(\"THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.\");else if(p)if(a){c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const i=o.convert(l.format),r=o.convert(l.type),s=_(l.internalFormat,i,r),a=O(t);e.renderbufferStorageMultisample(36161,a,s,t.width,t.height),n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),I(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}else console.warn(\"THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.\");if(h){n.bindTexture(34067,u.__webglTexture),C(34067,l,m);for(let e=0;e<6;e++)D(c.__webglFramebuffer[e],t,l,36064,34069+e);y(l,m)&&x(34067,l,t.width,t.height),n.bindTexture(34067,null)}else if(d){const e=t.texture;for(let r=0,o=e.length;r<o;r++){const o=e[r],s=i.get(o);n.bindTexture(3553,s.__webglTexture),C(3553,o,m),D(c.__webglFramebuffer,t,o,36064+r,3553),y(o,m)&&x(3553,o,t.width,t.height)}n.bindTexture(3553,null)}else{let e=3553;f&&(a?e=l.isDataTexture3D?32879:35866:console.warn(\"THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.\")),n.bindTexture(e,u.__webglTexture),C(e,l,m),D(c.__webglFramebuffer,t,l,36064,e),y(l,m)&&x(3553,l,t.width,t.height),n.bindTexture(3553,null)}t.depthBuffer&&function(t){const r=i.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(o)throw new Error(\"target.depthTexture not supported in Cube render targets\");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error(\"Depth Texture with cube render targets is not supported\");if(n.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error(\"renderTarget.depthTexture must be an instance of THREE.DepthTexture\");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),E(r.depthTexture,0);const o=i.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Ve)e.framebufferTexture2D(36160,36096,3553,o,0);else{if(r.depthTexture.format!==He)throw new Error(\"Unknown depthTexture format\");e.framebufferTexture2D(36160,33306,3553,o,0)}}(r.__webglFramebuffer,t)}else if(o){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),I(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),I(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}(t)},this.updateRenderTargetMipmap=function(e){const t=v(e)||a,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let o=0,s=r.length;o<s;o++){const s=r[o];if(y(s,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,r=i.get(s).__webglTexture;n.bindTexture(t,r),x(t,s,e.width,e.height),n.bindTexture(t,null)}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(a){const r=t.width,o=t.height;let s=16384;t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024);const a=i.get(t);n.bindFramebuffer(36008,a.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,a.__webglFramebuffer),e.blitFramebuffer(0,0,r,o,0,0,r,o,s,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,a.__webglMultisampledFramebuffer)}else console.warn(\"THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.\")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===F&&(console.warn(\"THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead.\"),F=!0),e=e.texture),E(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===N&&(console.warn(\"THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead.\"),N=!0),e=e.texture),T(e,t)}}function Ya(e,t,n){const i=n.isWebGL2;return{convert:function(e){let n;if(e===Se)return 5121;if(e===De)return 32819;if(e===Ie)return 32820;if(e===Oe)return 33635;if(e===Ee)return 5120;if(e===Te)return 5122;if(e===Ae)return 5123;if(e===Le)return 5124;if(e===Ce)return 5125;if(e===Pe)return 5126;if(e===Re)return i?5131:(n=t.get(\"OES_texture_half_float\"),null!==n?n.HALF_FLOAT_OES:null);if(e===Ne)return 6406;if(e===ze)return 6407;if(e===Ue)return 6408;if(e===Be)return 6409;if(e===Ge)return 6410;if(e===Ve)return 6402;if(e===He)return 34041;if(e===je)return 6403;if(e===We)return 36244;if(e===qe)return 33319;if(e===Xe)return 33320;if(e===Ye)return 36248;if(e===Ze)return 36249;if(e===Je||e===$e||e===Ke||e===Qe){if(n=t.get(\"WEBGL_compressed_texture_s3tc\"),null===n)return null;if(e===Je)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===$e)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Ke)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Qe)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===et||e===tt||e===nt||e===it){if(n=t.get(\"WEBGL_compressed_texture_pvrtc\"),null===n)return null;if(e===et)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===tt)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===nt)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===it)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===rt)return n=t.get(\"WEBGL_compressed_texture_etc1\"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===ot||e===st)&&(n=t.get(\"WEBGL_compressed_texture_etc\"),null!==n)){if(e===ot)return n.COMPRESSED_RGB8_ETC2;if(e===st)return n.COMPRESSED_RGBA8_ETC2_EAC}return e===at||e===lt||e===ct||e===ut||e===ht||e===dt||e===pt||e===ft||e===mt||e===gt||e===vt||e===yt||e===xt||e===_t||e===wt||e===Mt||e===St||e===Et||e===Tt||e===At||e===Lt||e===Ct||e===Pt||e===Rt||e===Dt||e===It||e===Ot||e===Ft?(n=t.get(\"WEBGL_compressed_texture_astc\"),null!==n?e:null):e===bt?(n=t.get(\"EXT_texture_compression_bptc\"),null!==n?e:null):e===Fe?i?34042:(n=t.get(\"WEBGL_depth_texture\"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Za extends Ro{constructor(e=[]){super(),this.cameras=e}}Za.prototype.isArrayCamera=!0;class Ja extends cr{constructor(){super(),this.type=\"Group\"}}Ja.prototype.isGroup=!0;const $a={type:\"move\"};class Ka{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Ja,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ja,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ai,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ai),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Ja,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ai,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ai),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:\"disconnected\",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,o=null;const s=this._targetRay,a=this._grip,l=this._hand;if(e&&\"visible-blurred\"!==t.session.visibilityState)if(null!==s&&(i=t.getPose(e.targetRaySpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent($a))),l&&e.hand){o=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n);if(void 0===l.joints[i.jointName]){const e=new Ja;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[i.jointName]=e,l.add(e)}const r=l.joints[i.jointName];null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const i=l.joints[\"index-finger-tip\"],r=l.joints[\"thumb-tip\"],s=i.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&s>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:\"pinchend\",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:\"pinchstart\",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));return null!==s&&(s.visible=null!==i),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==o),this}}class Qa extends Nn{constructor(e,t){super();const n=this,i=e.state;let r=null,o=1,s=null,a=\"local-floor\",l=null;const c=[],u=new Map,h=new Ro;h.layers.enable(1),h.viewport=new ni;const d=new Ro;d.layers.enable(2),d.viewport=new ni;const p=[h,d],f=new Za;f.layers.enable(1),f.layers.enable(2);let m=null,g=null;function v(e){const t=u.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function y(){u.forEach((function(e,t){e.disconnect(t)})),u.clear(),m=null,g=null,i.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),S.stop(),n.isPresenting=!1,n.dispatchEvent({type:\"sessionend\"})}function x(e){const t=r.inputSources;for(let e=0;e<c.length;e++)u.set(t[e],c[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=u.get(n);i&&(i.dispatchEvent({type:\"disconnected\",data:n}),u.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],i=u.get(n);i&&i.dispatchEvent({type:\"connected\",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=c[e];return void 0===t&&(t=new Ka,c[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=c[e];return void 0===t&&(t=new Ka,c[e]=t),t.getGripSpace()},this.getHand=function(e){let t=c[e];return void 0===t&&(t=new Ka,c[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){o=e,!0===n.isPresenting&&console.warn(\"THREE.WebXRManager: Cannot change framebuffer scale while presenting.\")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn(\"THREE.WebXRManager: Cannot change reference space type while presenting.\")},this.getReferenceSpace=function(){return s},this.getSession=function(){return r},this.setSession=async function(e){if(r=e,null!==r){r.addEventListener(\"select\",v),r.addEventListener(\"selectstart\",v),r.addEventListener(\"selectend\",v),r.addEventListener(\"squeeze\",v),r.addEventListener(\"squeezestart\",v),r.addEventListener(\"squeezeend\",v),r.addEventListener(\"end\",y),r.addEventListener(\"inputsourceschange\",x);const e=t.getContextAttributes();!0!==e.xrCompatible&&await t.makeXRCompatible();const i={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:o},l=new XRWebGLLayer(r,t,i);r.updateRenderState({baseLayer:l}),s=await r.requestReferenceSpace(a),S.setContext(r),S.start(),n.isPresenting=!0,n.dispatchEvent({type:\"sessionstart\"})}};const _=new ai,b=new ai;function w(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;f.near=d.near=h.near=e.near,f.far=d.far=h.far=e.far,m===f.near&&g===f.far||(r.updateRenderState({depthNear:f.near,depthFar:f.far}),m=f.near,g=f.far);const t=e.parent,n=f.cameras;w(f,t);for(let e=0;e<n.length;e++)w(n[e],t);e.matrixWorld.copy(f.matrixWorld),e.matrix.copy(f.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const i=e.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(!0);2===n.length?function(e,t,n){_.setFromMatrixPosition(t.matrixWorld),b.setFromMatrixPosition(n.matrixWorld);const i=_.distanceTo(b),r=t.projectionMatrix.elements,o=n.projectionMatrix.elements,s=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(o[8]+1)/o[0],d=s*u,p=s*h,f=i/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=s+f,v=a+f,y=d-m,x=p+(i-m),w=l*a/v*g,M=c*a/v*g;e.projectionMatrix.makePerspective(y,x,w,M,g,v)}(f,h,d):f.projectionMatrix.copy(h.projectionMatrix)},this.getCamera=function(){return f};let M=null;const S=new Bo;S.setAnimationLoop((function(e,t){if(l=t.getViewerPose(s),null!==l){const e=l.views,t=r.renderState.baseLayer;i.bindXRFramebuffer(t.framebuffer);let n=!1;e.length!==f.cameras.length&&(f.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i],o=t.getViewport(r),s=p[i];s.matrix.fromArray(r.transform.matrix),s.projectionMatrix.fromArray(r.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===i&&f.matrix.copy(s.matrix),!0===n&&f.cameras.push(s)}}const n=r.inputSources;for(let e=0;e<c.length;e++){const i=c[e],r=n[e];i.update(r,t,s)}M&&M(e,t)})),this.setAnimationLoop=function(e){M=e},this.dispose=function(){}}}function el(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);const i=e.get(n).envMap;if(i){t.envMap.value=i,t.flipEnvMap.value=i.isCubeTexture&&i._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;const r=e.get(i).__maxMipLevel;void 0!==r&&(t.maxMipLevel.value=r)}let r,o;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(r=n.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uv2Transform.value.copy(o.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===m&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===m&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,r,o,s){i.isMeshBasicMaterial?t(e,i):i.isMeshLambertMaterial?(t(e,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,i)):i.isMeshToonMaterial?(t(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshPhongMaterial?(t(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshStandardMaterial?(t(e,i),i.isMeshPhysicalMaterial?function(e,t,i){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===m&&e.clearcoatNormalScale.value.negate()),e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),t.transmission>0&&(e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)}(e,i,s):n(e,i)):i.isMeshMatcapMaterial?(t(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDepthMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDistanceMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?(t(e,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){let r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i,r,o):i.isSpriteMaterial?function(e,t){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function tl(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");return e.style.display=\"block\",e}(),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:\"default\",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,d=null;const p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Jt,this.physicallyCorrectLights=!1,this.toneMapping=K,this.toneMappingExposure=1;const m=this;let g=!1,v=0,y=0,x=null,_=-1,b=null;const w=new ni,M=new ni;let S=null,E=t.width,T=t.height,A=1,L=null,C=null;const P=new ni(0,0,E,T),R=new ni(0,0,E,T);let D=!1;const I=[],O=new Uo;let F=!1,N=!1,z=null;const U=new Ui,B=new ai,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function k(){return null===x?A:1}let V,H,j,W,q,X,Y,Z,J,$,Q,ee,te,ne,ie,re,oe,se,ae,le,ce,ue,he=n;function pe(e,n){for(let i=0;i<e.length;i++){const r=e[i],o=t.getContext(r,n);if(null!==o)return o}return null}try{const e={alpha:i,depth:r,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(t.addEventListener(\"webglcontextlost\",ve,!1),t.addEventListener(\"webglcontextrestored\",ye,!1),null===he){const t=[\"webgl2\",\"webgl\",\"experimental-webgl\"];if(!0===m.isWebGL1Renderer&&t.shift(),he=pe(t,e),null===he)throw pe(t)?new Error(\"Error creating WebGL context with your selected attributes.\"):new Error(\"Error creating WebGL context.\")}void 0===he.getShaderPrecisionFormat&&(he.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error(\"THREE.WebGLRenderer: \"+e.message),e}function me(){V=new $o(he),H=new Yo(he,V,e),V.init(H),ce=new Ya(he,V,H),j=new qa(he,V,H),I[0]=1029,W=new es(he),q=new Pa,X=new Xa(he,V,j,q,H,ce,W),Y=new Jo(m),Z=new Go(he,H),ue=new qo(he,V,Z,H),J=new Ko(he,Z,W,ue),$=new rs(he,J,Z,W),se=new is(he),ie=new Zo(q),Q=new Ca(m,Y,V,H,ue,ie),ee=new el(q),te=new Oa(q),ne=new Ga(V,H),oe=new Wo(m,Y,j,$,a),re=new Wa(m,$,H),ae=new Xo(he,V,W,H),le=new Qo(he,V,W,H),W.programs=Q.programs,m.capabilities=H,m.extensions=V,m.properties=q,m.renderLists=te,m.shadowMap=re,m.state=j,m.info=W}me();const ge=new Qa(m,he);function ve(e){e.preventDefault(),console.log(\"THREE.WebGLRenderer: Context Lost.\"),g=!0}function ye(){console.log(\"THREE.WebGLRenderer: Context Restored.\"),g=!1;const e=W.autoReset,t=re.enabled,n=re.autoUpdate,i=re.needsUpdate,r=re.type;me(),W.autoReset=e,re.enabled=t,re.autoUpdate=n,re.needsUpdate=i,re.type=r}function xe(e){const t=e.target;t.removeEventListener(\"dispose\",xe),function(e){(function(e){const t=q.get(e).programs;void 0!==t&&t.forEach((function(e){Q.releaseProgram(e)}))})(e),q.remove(e)}(t)}this.xr=ge,this.getContext=function(){return he},this.getContextAttributes=function(){return he.getContextAttributes()},this.forceContextLoss=function(){const e=V.get(\"WEBGL_lose_context\");e&&e.loseContext()},this.forceContextRestore=function(){const e=V.get(\"WEBGL_lose_context\");e&&e.restoreContext()},this.getPixelRatio=function(){return A},this.setPixelRatio=function(e){void 0!==e&&(A=e,this.setSize(E,T,!1))},this.getSize=function(e){return void 0===e&&(console.warn(\"WebGLRenderer: .getsize() now requires a Vector2 as an argument\"),e=new Zn),e.set(E,T)},this.setSize=function(e,n,i){ge.isPresenting?console.warn(\"THREE.WebGLRenderer: Can't change size while VR device is presenting.\"):(E=e,T=n,t.width=Math.floor(e*A),t.height=Math.floor(n*A),!1!==i&&(t.style.width=e+\"px\",t.style.height=n+\"px\"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn(\"WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument\"),e=new Zn),e.set(E*A,T*A).floor()},this.setDrawingBufferSize=function(e,n,i){E=e,T=n,A=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn(\"WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument\"),e=new ni),e.copy(w)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,n,i){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,n,i),j.viewport(w.copy(P).multiplyScalar(A).floor())},this.getScissor=function(e){return e.copy(R)},this.setScissor=function(e,t,n,i){e.isVector4?R.set(e.x,e.y,e.z,e.w):R.set(e,t,n,i),j.scissor(M.copy(R).multiplyScalar(A).floor())},this.getScissorTest=function(){return D},this.setScissorTest=function(e){j.setScissorTest(D=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){C=e},this.getClearColor=function(e){return void 0===e&&(console.warn(\"WebGLRenderer: .getClearColor() now requires a Color as an argument\"),e=new Ir),e.copy(oe.getClearColor())},this.setClearColor=function(){oe.setClearColor.apply(oe,arguments)},this.getClearAlpha=function(){return oe.getClearAlpha()},this.setClearAlpha=function(){oe.setClearAlpha.apply(oe,arguments)},this.clear=function(e,t,n){let i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),he.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener(\"webglcontextlost\",ve,!1),t.removeEventListener(\"webglcontextrestored\",ye,!1),te.dispose(),ne.dispose(),q.dispose(),Y.dispose(),$.dispose(),ue.dispose(),ge.dispose(),ge.removeEventListener(\"sessionstart\",be),ge.removeEventListener(\"sessionend\",Me),z&&(z.dispose(),z=null),Ee.stop()},this.renderBufferImmediate=function(e,t){ue.initAttributes();const n=q.get(e);e.hasPositions&&!n.position&&(n.position=he.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=he.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=he.createBuffer()),e.hasColors&&!n.color&&(n.color=he.createBuffer());const i=t.getAttributes();e.hasPositions&&(he.bindBuffer(34962,n.position),he.bufferData(34962,e.positionArray,35048),ue.enableAttribute(i.position),he.vertexAttribPointer(i.position,3,5126,!1,0,0)),e.hasNormals&&(he.bindBuffer(34962,n.normal),he.bufferData(34962,e.normalArray,35048),ue.enableAttribute(i.normal),he.vertexAttribPointer(i.normal,3,5126,!1,0,0)),e.hasUvs&&(he.bindBuffer(34962,n.uv),he.bufferData(34962,e.uvArray,35048),ue.enableAttribute(i.uv),he.vertexAttribPointer(i.uv,2,5126,!1,0,0)),e.hasColors&&(he.bindBuffer(34962,n.color),he.bufferData(34962,e.colorArray,35048),ue.enableAttribute(i.color),he.vertexAttribPointer(i.color,3,5126,!1,0,0)),ue.disableUnusedAttributes(),he.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,r,o){null===t&&(t=G);const s=r.isMesh&&r.matrixWorld.determinant()<0,a=Ie(e,t,i,r);j.setMaterial(i,s);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===i.wireframe&&(l=J.getWireframeAttribute(n),h=2),(i.morphTargets||i.morphNormals)&&se.update(r,n,i,a),ue.setup(r,i,a,n,l);let d=ae;null!==l&&(u=Z.get(l),d=le,d.setIndex(u));const p=null!==l?l.count:c.count,f=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==o?o.start*h:0,v=null!==o?o.count*h:1/0,y=Math.max(f,g),x=Math.min(p,f+m,g+v)-1,_=Math.max(0,x-y+1);if(0!==_){if(r.isMesh)!0===i.wireframe?(j.setLineWidth(i.wireframeLinewidth*k()),d.setMode(1)):d.setMode(4);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),j.setLineWidth(e*k()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(y,_,r.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(y,_,e)}else d.render(y,_)}},this.compile=function(e,t){d=ne.get(e),d.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++)Ce(n[i],e,t);else Ce(n,e,t)}))};let _e=null;function be(){Ee.stop()}function Me(){Ee.start()}const Ee=new Bo;function Te(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||O.intersectsSprite(e)){i&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);const t=$.update(e),r=e.material;r.visible&&h.push(e,t,r,n,B.z,null)}}else if(e.isImmediateRenderObject)i&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U),h.push(e,null,e.material,n,B.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==W.render.frame&&(e.skeleton.update(),e.skeleton.frame=W.render.frame),!e.frustumCulled||O.intersectsObject(e))){i&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);const t=$.update(e),r=e.material;if(Array.isArray(r)){const i=t.groups;for(let o=0,s=i.length;o<s;o++){const s=i[o],a=r[s.materialIndex];a&&a.visible&&h.push(e,t,a,n,B.z,s)}}else r.visible&&h.push(e,t,r,n,B.z,null)}const r=e.children;for(let e=0,o=r.length;e<o;e++)Te(r[e],t,n,i)}function Ae(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,o=e.length;r<o;r++){const o=e[r],s=o.object,a=o.geometry,l=null===i?o.material:i,c=o.group;if(n.isArrayCamera){const e=n.cameras;for(let n=0,i=e.length;n<i;n++){const i=e[n];s.layers.test(i.layers)&&(j.viewport(w.copy(i.viewport)),d.setupLightsView(i),Le(s,t,i,a,l,c))}}else Le(s,t,n,a,l,c)}}function Le(e,t,n,i,r,o){if(e.onBeforeRender(m,t,n,i,r,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const i=Ie(n,t,r,e);j.setMaterial(r),ue.reset(),function(e,t){e.render((function(e){m.renderBufferImmediate(e,t)}))}(e,i)}else m.renderBufferDirect(n,t,i,r,e,o);e.onAfterRender(m,t,n,i,r,o)}function Ce(e,t,n){!0!==t.isScene&&(t=G);const i=q.get(e),r=d.state.lights,o=d.state.shadowsArray,s=r.state.version,a=Q.getParameters(e,r.state,o,t,n),l=Q.getProgramCacheKey(a);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=Y.get(e.envMap||i.environment),void 0===c&&(e.addEventListener(\"dispose\",xe),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===s)return De(e,a),u}else a.uniforms=Q.getUniforms(e),e.onBuild(a,m),e.onBeforeCompile(a,m),u=Q.acquireProgram(a,l),c.set(l,u),i.uniforms=a.uniforms;const h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ie.uniform),De(e,a),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=s,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotShadowMatrix.value=r.state.spotShadowMatrix,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=u.getUniforms(),f=la.seqWithValue(p.seq,h);return i.currentProgram=u,i.uniformsList=f,u}function De(e,t){const n=q.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas}function Ie(e,t,n,i){!0!==t.isScene&&(t=G),X.resetTextureUnits();const r=t.fog,o=n.isMeshStandardMaterial?t.environment:null,s=null===x?m.outputEncoding:x.texture.encoding,a=Y.get(n.envMap||o),l=!0===n.vertexColors&&i.geometry&&i.geometry.attributes.color&&4===i.geometry.attributes.color.itemSize,c=q.get(n),u=d.state.lights;if(!0===F&&(!0===N||e!==b)){const t=e===b&&n.id===_;ie.setState(n,e,t)}let h=!1;n.version===c.__version?c.needsLights&&c.lightsStateVersion!==u.state.version||c.outputEncoding!==s||i.isInstancedMesh&&!1===c.instancing?h=!0:i.isInstancedMesh||!0!==c.instancing?i.isSkinnedMesh&&!1===c.skinning?h=!0:i.isSkinnedMesh||!0!==c.skinning?c.envMap!==a||n.fog&&c.fog!==r?h=!0:void 0===c.numClippingPlanes||c.numClippingPlanes===ie.numPlanes&&c.numIntersection===ie.numIntersection?c.vertexAlphas!==l&&(h=!0):h=!0:h=!0:h=!0:(h=!0,c.__version=n.version);let p=c.currentProgram;!0===h&&(p=Ce(n,t,i));let f=!1,g=!1,v=!1;const y=p.getUniforms(),w=c.uniforms;if(j.useProgram(p.program)&&(f=!0,g=!0,v=!0),n.id!==_&&(_=n.id,g=!0),f||b!==e){if(y.setValue(he,\"projectionMatrix\",e.projectionMatrix),H.logarithmicDepthBuffer&&y.setValue(he,\"logDepthBufFC\",2/(Math.log(e.far+1)/Math.LN2)),b!==e&&(b=e,g=!0,v=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=y.map.cameraPosition;void 0!==t&&t.setValue(he,B.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&y.setValue(he,\"isOrthographic\",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||i.isSkinnedMesh)&&y.setValue(he,\"viewMatrix\",e.matrixWorldInverse)}if(i.isSkinnedMesh){y.setOptional(he,i,\"bindMatrix\"),y.setOptional(he,i,\"bindMatrixInverse\");const e=i.skeleton;e&&(H.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),y.setValue(he,\"boneTexture\",e.boneTexture,X),y.setValue(he,\"boneTextureSize\",e.boneTextureSize)):y.setOptional(he,e,\"boneMatrices\"))}var M,S;return(g||c.receiveShadow!==i.receiveShadow)&&(c.receiveShadow=i.receiveShadow,y.setValue(he,\"receiveShadow\",i.receiveShadow)),g&&(y.setValue(he,\"toneMappingExposure\",m.toneMappingExposure),c.needsLights&&(S=v,(M=w).ambientLightColor.needsUpdate=S,M.lightProbe.needsUpdate=S,M.directionalLights.needsUpdate=S,M.directionalLightShadows.needsUpdate=S,M.pointLights.needsUpdate=S,M.pointLightShadows.needsUpdate=S,M.spotLights.needsUpdate=S,M.spotLightShadows.needsUpdate=S,M.rectAreaLights.needsUpdate=S,M.hemisphereLights.needsUpdate=S),r&&n.fog&&ee.refreshFogUniforms(w,r),ee.refreshMaterialUniforms(w,n,A,T,z),la.upload(he,c.uniformsList,w,X)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(la.upload(he,c.uniformsList,w,X),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&y.setValue(he,\"center\",i.center),y.setValue(he,\"modelViewMatrix\",i.modelViewMatrix),y.setValue(he,\"normalMatrix\",i.normalMatrix),y.setValue(he,\"modelMatrix\",i.matrixWorld),p}Ee.setAnimationLoop((function(e){_e&&_e(e)})),\"undefined\"!=typeof window&&Ee.setContext(window),this.setAnimationLoop=function(e){_e=e,ge.setAnimationLoop(e),null===e?Ee.stop():Ee.start()},ge.addEventListener(\"sessionstart\",be),ge.addEventListener(\"sessionend\",Me),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error(\"THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.\");if(!0===g)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===ge.enabled&&!0===ge.isPresenting&&(!0===ge.cameraAutoUpdate&&ge.updateCamera(t),t=ge.getCamera()),!0===e.isScene&&e.onBeforeRender(m,e,t,x),d=ne.get(e,f.length),d.init(),f.push(d),U.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),O.setFromProjectionMatrix(U),N=this.localClippingEnabled,F=ie.init(this.clippingPlanes,N,t),h=te.get(e,p.length),h.init(),p.push(h),Te(e,t,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(L,C),!0===F&&ie.beginShadows();const n=d.state.shadowsArray;re.render(n,e,t),d.setupLights(),d.setupLightsView(t),!0===F&&ie.endShadows(),!0===this.info.autoReset&&this.info.reset(),oe.render(h,e);const i=h.opaque,r=h.transmissive,o=h.transparent;i.length>0&&Ae(i,e,t),r.length>0&&function(e,t,n,i){null===z&&(z=new ii(1024,1024,{generateMipmaps:!0,minFilter:we,magFilter:fe,wrapS:de,wrapT:de}));const r=m.getRenderTarget();m.setRenderTarget(z),m.clear(),Ae(e,n,i),X.updateRenderTargetMipmap(z),m.setRenderTarget(r),Ae(t,n,i)}(i,r,e,t),o.length>0&&Ae(o,e,t),null!==x&&(X.updateRenderTargetMipmap(x),X.updateMultisampleRenderTarget(x)),!0===e.isScene&&e.onAfterRender(m,e,t),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),ue.resetDefaultState(),_=-1,b=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),h=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTarget=function(e,t=0,n=0){x=e,v=t,y=n,e&&void 0===q.get(e).__webglFramebuffer&&X.setupRenderTarget(e);let i=null,r=!1,o=!1;if(e){const n=e.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(o=!0);const s=q.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=s[t],r=!0):i=e.isWebGLMultisampleRenderTarget?q.get(e).__webglMultisampledFramebuffer:s,w.copy(e.viewport),M.copy(e.scissor),S=e.scissorTest}else w.copy(P).multiplyScalar(A).floor(),M.copy(R).multiplyScalar(A).floor(),S=D;if(j.bindFramebuffer(36160,i)&&H.drawBuffers){let t=!1;if(e)if(e.isWebGLMultipleRenderTargets){const n=e.texture;if(I.length!==n.length||36064!==I[0]){for(let e=0,t=n.length;e<t;e++)I[e]=36064+e;I.length=n.length,t=!0}}else 1===I.length&&36064===I[0]||(I[0]=36064,I.length=1,t=!0);else 1===I.length&&1029===I[0]||(I[0]=1029,I.length=1,t=!0);t&&(H.isWebGL2?he.drawBuffers(I):V.get(\"WEBGL_draw_buffers\").drawBuffersWEBGL(I))}if(j.viewport(w),j.scissor(M),j.setScissorTest(S),r){const i=q.get(e.texture);he.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,n)}else if(o){const i=q.get(e.texture),r=t||0;he.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}},this.readRenderTargetPixels=function(e,t,n,i,r,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.\");let a=q.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){j.bindFramebuffer(36160,a);try{const s=e.texture,a=s.format,l=s.type;if(a!==Ue&&ce.convert(a)!==he.getParameter(35739))return void console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.\");const c=l===Re&&(V.has(\"EXT_color_buffer_half_float\")||H.isWebGL2&&V.has(\"EXT_color_buffer_float\"));if(!(l===Se||ce.convert(l)===he.getParameter(35738)||l===Pe&&(H.isWebGL2||V.has(\"OES_texture_float\")||V.has(\"WEBGL_color_buffer_float\"))||c))return void console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.\");36053===he.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&he.readPixels(t,n,i,r,ce.convert(a),ce.convert(l),o):console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.\")}finally{const e=null!==x?q.get(x).__webglFramebuffer:null;j.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),o=Math.floor(t.image.height*i);let s=ce.convert(t.format);H.isWebGL2&&(6407===s&&(s=32849),6408===s&&(s=32856)),X.setTexture2D(t,0),he.copyTexImage2D(3553,n,s,e.x,e.y,r,o,0),j.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const r=t.image.width,o=t.image.height,s=ce.convert(n.format),a=ce.convert(n.type);X.setTexture2D(n,0),he.pixelStorei(37440,n.flipY),he.pixelStorei(37441,n.premultiplyAlpha),he.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?he.texSubImage2D(3553,i,e.x,e.y,r,o,s,a,t.image.data):t.isCompressedTexture?he.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):he.texSubImage2D(3553,i,e.x,e.y,s,a,t.image),0===i&&n.generateMipmaps&&he.generateMipmap(3553),j.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,r=0){if(m.isWebGL1Renderer)return void console.warn(\"THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.\");const{width:o,height:s,data:a}=n.image,l=ce.convert(i.format),c=ce.convert(i.type);let u;if(i.isDataTexture3D)X.setTexture3D(i,0),u=32879;else{if(!i.isDataTexture2DArray)return void console.warn(\"THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.\");X.setTexture2DArray(i,0),u=35866}he.pixelStorei(37440,i.flipY),he.pixelStorei(37441,i.premultiplyAlpha),he.pixelStorei(3317,i.unpackAlignment);const h=he.getParameter(3314),d=he.getParameter(32878),p=he.getParameter(3316),f=he.getParameter(3315),g=he.getParameter(32877);he.pixelStorei(3314,o),he.pixelStorei(32878,s),he.pixelStorei(3316,e.min.x),he.pixelStorei(3315,e.min.y),he.pixelStorei(32877,e.min.z),he.texSubImage3D(u,r,t.x,t.y,t.z,e.max.x-e.min.x+1,e.max.y-e.min.y+1,e.max.z-e.min.z+1,l,c,a),he.pixelStorei(3314,h),he.pixelStorei(32878,d),he.pixelStorei(3316,p),he.pixelStorei(3315,f),he.pixelStorei(32877,g),0===r&&i.generateMipmaps&&he.generateMipmap(u),j.unbindTexture()},this.initTexture=function(e){X.setTexture2D(e,0),j.unbindTexture()},this.resetState=function(){v=0,y=0,x=null,j.reset(),ue.reset()},\"undefined\"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent(\"observe\",{detail:this}))}class nl extends tl{}nl.prototype.isWebGL1Renderer=!0;class il{constructor(e,t=25e-5){this.name=\"\",this.color=new Ir(e),this.density=t}clone(){return new il(this.color,this.density)}toJSON(){return{type:\"FogExp2\",color:this.color.getHex(),density:this.density}}}il.prototype.isFogExp2=!0;class rl{constructor(e,t=1,n=1e3){this.name=\"\",this.color=new Ir(e),this.near=t,this.far=n}clone(){return new rl(this.color,this.near,this.far)}toJSON(){return{type:\"Fog\",color:this.color.getHex(),near:this.near,far:this.far}}}rl.prototype.isFog=!0;class ol extends cr{constructor(){super(),this.type=\"Scene\",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,\"undefined\"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent(\"observe\",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}ol.prototype.isScene=!0;class sl{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=En,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=kn()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=kn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=kn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}sl.prototype.isInterleavedBuffer=!0;const al=new ai;class ll{constructor(e,t,n,i){this.name=\"\",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)al.x=this.getX(t),al.y=this.getY(t),al.z=this.getZ(t),al.applyMatrix4(e),this.setXYZ(t,al.x,al.y,al.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)al.x=this.getX(t),al.y=this.getY(t),al.z=this.getZ(t),al.applyNormalMatrix(e),this.setXYZ(t,al.x,al.y,al.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)al.x=this.getX(t),al.y=this.getY(t),al.z=this.getZ(t),al.transformDirection(e),this.setXYZ(t,al.x,al.y,al.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log(\"THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.\");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new zr(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ll(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log(\"THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.\");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}ll.prototype.isInterleavedBufferAttribute=!0;class cl extends Tr{constructor(e){super(),this.type=\"SpriteMaterial\",this.color=new Ir(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let ul;cl.prototype.isSpriteMaterial=!0;const hl=new ai,dl=new ai,pl=new ai,fl=new Zn,ml=new Zn,gl=new Ui,vl=new ai,yl=new ai,xl=new ai,_l=new Zn,bl=new Zn,wl=new Zn;class Ml extends cr{constructor(e){if(super(),this.type=\"Sprite\",void 0===ul){ul=new ro;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new sl(e,5);ul.setIndex([0,1,2,0,2,3]),ul.setAttribute(\"position\",new ll(t,3,0,!1)),ul.setAttribute(\"uv\",new ll(t,2,3,!1))}this.geometry=ul,this.material=void 0!==e?e:new cl,this.center=new Zn(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: \"Raycaster.camera\" needs to be set in order to raycast against sprites.'),dl.setFromMatrixScale(this.matrixWorld),gl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),pl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&dl.multiplyScalar(-pl.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;Sl(vl.set(-.5,-.5,0),pl,o,dl,i,r),Sl(yl.set(.5,-.5,0),pl,o,dl,i,r),Sl(xl.set(.5,.5,0),pl,o,dl,i,r),_l.set(0,0),bl.set(1,0),wl.set(1,1);let s=e.ray.intersectTriangle(vl,yl,xl,!1,hl);if(null===s&&(Sl(yl.set(-.5,.5,0),pl,o,dl,i,r),bl.set(0,1),s=e.ray.intersectTriangle(vl,xl,yl,!1,hl),null===s))return;const a=e.ray.origin.distanceTo(hl);a<e.near||a>e.far||t.push({distance:a,point:hl.clone(),uv:Sr.getUV(hl,vl,yl,xl,_l,bl,wl,new Zn),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Sl(e,t,n,i,r,o){fl.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(ml.x=o*fl.x-r*fl.y,ml.y=r*fl.x+o*fl.y):ml.copy(fl),e.copy(t),e.x+=ml.x,e.y+=ml.y,e.applyMatrix4(gl)}Ml.prototype.isSprite=!0;const El=new ai,Tl=new ai;class Al extends cr{constructor(){super(),this._currentLevel=0,this.type=\"LOD\",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){El.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(El);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){El.setFromMatrixPosition(e.matrixWorld),Tl.setFromMatrixPosition(this.matrixWorld);const n=El.distanceTo(Tl)/e.zoom;let i,r;for(t[0].object.visible=!0,i=1,r=t.length;i<r&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,i=n.length;e<i;e++){const i=n[e];t.object.levels.push({object:i.object.uuid,distance:i.distance})}return t}}const Ll=new ai,Cl=new ni,Pl=new ni,Rl=new ai,Dl=new Ui;class Il extends Mo{constructor(e,t){super(e,t),this.type=\"SkinnedMesh\",this.bindMode=\"attached\",this.bindMatrix=new Ui,this.bindMatrixInverse=new Ui}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new ni,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),\"attached\"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():\"detached\"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn(\"THREE.SkinnedMesh: Unrecognized bindMode: \"+this.bindMode)}boneTransform(e,t){const n=this.skeleton,i=this.geometry;Cl.fromBufferAttribute(i.attributes.skinIndex,e),Pl.fromBufferAttribute(i.attributes.skinWeight,e),Ll.fromBufferAttribute(i.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const i=Pl.getComponent(e);if(0!==i){const r=Cl.getComponent(e);Dl.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(Rl.copy(Ll).applyMatrix4(Dl),i)}}return t.applyMatrix4(this.bindMatrixInverse)}}Il.prototype.isSkinnedMesh=!0;class Ol extends cr{constructor(){super(),this.type=\"Bone\"}}Ol.prototype.isBone=!0;class Fl extends ei{constructor(e,t,n,i,r,o,s,a,l,c,u,h){super(null,o,s,a,l,c,i,r,u,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:fe,this.minFilter=void 0!==c?c:fe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Fl.prototype.isDataTexture=!0;const Nl=new Ui,zl=new Ui;class Ul{constructor(e=[],t=[]){this.uuid=kn(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn(\"THREE.Skeleton: Number of inverse bone matrices does not match amount of bones.\"),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Ui)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Ui;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=e.length;i<r;i++){const r=e[i]?e[i].matrixWorld:zl;Nl.multiplyMatrices(r,t[i]),Nl.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new Ul(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=qn(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Fl(t,e,e,Ue,Pe);return this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(console.warn(\"THREE.Skeleton: No bone found with UUID:\",i),r=new Ol),this.bones.push(r),this.boneInverses.push((new Ui).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:\"Skeleton\",generator:\"Skeleton.toJSON\"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const o=n[i];e.boneInverses.push(o.toArray())}return e}}const Bl=new Ui,Gl=new Ui,kl=[],Vl=new Mo;class Hl extends Mo{constructor(e,t,n){super(e,t),this.instanceMatrix=new zr(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(Vl.geometry=this.geometry,Vl.material=this.material,void 0!==Vl.material)for(let r=0;r<i;r++){this.getMatrixAt(r,Bl),Gl.multiplyMatrices(n,Bl),Vl.matrixWorld=Gl,Vl.raycast(e,kl);for(let e=0,n=kl.length;e<n;e++){const n=kl[e];n.instanceId=r,n.object=this,t.push(n)}kl.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new zr(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:\"dispose\"})}}Hl.prototype.isInstancedMesh=!0;class jl extends Tr{constructor(e){super(),this.type=\"LineBasicMaterial\",this.color=new Ir(16777215),this.linewidth=1,this.linecap=\"round\",this.linejoin=\"round\",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}jl.prototype.isLineBasicMaterial=!0;const Wl=new ai,ql=new ai,Xl=new Ui,Yl=new zi,Zl=new Ci;class Jl extends cr{constructor(e=new ro,t=new jl){super(),this.type=\"Line\",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)Wl.fromBufferAttribute(t,e-1),ql.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Wl.distanceTo(ql);e.setAttribute(\"lineDistance\",new qr(n,1))}else console.warn(\"THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.\");else e.isGeometry&&console.error(\"THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Zl.copy(n.boundingSphere),Zl.applyMatrix4(i),Zl.radius+=r,!1===e.ray.intersectsSphere(Zl))return;Xl.copy(i).invert(),Yl.copy(e.ray).applyMatrix4(Xl);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=new ai,c=new ai,u=new ai,h=new ai,d=this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,r=n.attributes.position;if(null!==i)for(let n=Math.max(0,o.start),s=Math.min(i.count,o.start+o.count)-1;n<s;n+=d){const o=i.getX(n),s=i.getX(n+1);if(l.fromBufferAttribute(r,o),c.fromBufferAttribute(r,s),Yl.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(h);d<e.near||d>e.far||t.push({distance:d,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,o.start),i=Math.min(r.count,o.start+o.count)-1;n<i;n+=d){if(l.fromBufferAttribute(r,n),c.fromBufferAttribute(r,n+1),Yl.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(h);i<e.near||i>e.far||t.push({distance:i,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error(\"THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error(\"THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.\")}}}Jl.prototype.isLine=!0;const $l=new ai,Kl=new ai;class Ql extends Jl{constructor(e,t){super(e,t),this.type=\"LineSegments\"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)$l.fromBufferAttribute(t,e),Kl.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+$l.distanceTo(Kl);e.setAttribute(\"lineDistance\",new qr(n,1))}else console.warn(\"THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.\");else e.isGeometry&&console.error(\"THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\");return this}}Ql.prototype.isLineSegments=!0;class ec extends Jl{constructor(e,t){super(e,t),this.type=\"LineLoop\"}}ec.prototype.isLineLoop=!0;class tc extends Tr{constructor(e){super(),this.type=\"PointsMaterial\",this.color=new Ir(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}tc.prototype.isPointsMaterial=!0;const nc=new Ui,ic=new zi,rc=new Ci,oc=new ai;class sc extends cr{constructor(e=new ro,t=new tc){super(),this.type=\"Points\",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),rc.copy(n.boundingSphere),rc.applyMatrix4(i),rc.radius+=r,!1===e.ray.intersectsSphere(rc))return;nc.copy(i).invert(),ic.copy(e.ray).applyMatrix4(nc);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s;if(n.isBufferGeometry){const r=n.index,s=n.attributes.position;if(null!==r)for(let n=Math.max(0,o.start),l=Math.min(r.count,o.start+o.count);n<l;n++){const o=r.getX(n);oc.fromBufferAttribute(s,o),ac(oc,o,a,i,e,t,this)}else for(let n=Math.max(0,o.start),r=Math.min(s.count,o.start+o.count);n<r;n++)oc.fromBufferAttribute(s,n),ac(oc,n,a,i,e,t,this)}else console.error(\"THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error(\"THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.\")}}}function ac(e,t,n,i,r,o,s){const a=ic.distanceSqToPoint(e);if(a<n){const n=new ai;ic.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;o.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:s})}}sc.prototype.isPoints=!0;class lc extends ei{constructor(e,t,n,i,r,o,s,a,l){super(e,t,n,i,r,o,s,a,l),this.format=void 0!==s?s:ze,this.minFilter=void 0!==o?o:xe,this.magFilter=void 0!==r?r:xe,this.generateMipmaps=!1;const c=this;\"requestVideoFrameCallback\"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==\"requestVideoFrameCallback\"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}lc.prototype.isVideoTexture=!0;class cc extends ei{constructor(e,t,n,i,r,o,s,a,l,c,u,h){super(null,o,s,a,l,c,i,r,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}cc.prototype.isCompressedTexture=!0;class uc extends ei{constructor(e,t,n,i,r,o,s,a,l){super(e,t,n,i,r,o,s,a,l),this.needsUpdate=!0}}uc.prototype.isCanvasTexture=!0;class hc extends ei{constructor(e,t,n,i,r,o,s,a,l,c){if((c=void 0!==c?c:Ve)!==Ve&&c!==He)throw new Error(\"DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat\");void 0===n&&c===Ve&&(n=Ae),void 0===n&&c===He&&(n=Fe),super(null,i,r,o,s,a,c,n,l),this.image={width:e,height:t},this.magFilter=void 0!==s?s:fe,this.minFilter=void 0!==a?a:fe,this.flipY=!1,this.generateMipmaps=!1}}hc.prototype.isDepthTexture=!0;class dc extends ro{constructor(e=1,t=8,n=0,i=2*Math.PI){super(),this.type=\"CircleGeometry\",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],o=[],s=[],a=[],l=new ai,c=new Zn;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let r=0,u=3;r<=t;r++,u+=3){const h=n+r/t*i;l.x=e*Math.cos(h),l.y=e*Math.sin(h),o.push(l.x,l.y,l.z),s.push(0,0,1),c.x=(o[u]/e+1)/2,c.y=(o[u+1]/e+1)/2,a.push(c.x,c.y)}for(let e=1;e<=t;e++)r.push(e,e+1,0);this.setIndex(r),this.setAttribute(\"position\",new qr(o,3)),this.setAttribute(\"normal\",new qr(s,3)),this.setAttribute(\"uv\",new qr(a,2))}}class pc extends ro{constructor(e=1,t=1,n=1,i=8,r=1,o=!1,s=0,a=2*Math.PI){super(),this.type=\"CylinderGeometry\",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const r=p,o=new Zn,f=new ai;let v=0;const y=!0===n?e:t,x=!0===n?1:-1;for(let e=1;e<=i;e++)u.push(0,m*x,0),h.push(0,x,0),d.push(.5,.5),p++;const _=p;for(let e=0;e<=i;e++){const t=e/i*a+s,n=Math.cos(t),r=Math.sin(t);f.x=y*r,f.y=m*x,f.z=y*n,u.push(f.x,f.y,f.z),h.push(0,x,0),o.x=.5*n+.5,o.y=.5*r*x+.5,d.push(o.x,o.y),p++}for(let e=0;e<i;e++){const t=r+e,i=_+e;!0===n?c.push(i,i+1,t):c.push(i+1,i,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const o=new ai,v=new ai;let y=0;const x=(t-e)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,y=g*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,r=t*a+s,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*n+m,v.z=y*f,u.push(v.x,v.y,v.z),o.set(l,x,f).normalize(),h.push(o.x,o.y,o.z),d.push(t,1-g),c.push(p++)}f.push(c)}for(let e=0;e<i;e++)for(let t=0;t<r;t++){const n=f[t][e],i=f[t+1][e],r=f[t+1][e+1],o=f[t][e+1];c.push(n,i,o),c.push(i,r,o),y+=6}l.addGroup(g,y,0),g+=y}(),!1===o&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute(\"position\",new qr(u,3)),this.setAttribute(\"normal\",new qr(h,3)),this.setAttribute(\"uv\",new qr(d,2))}}class fc extends pc{constructor(e=1,t=1,n=8,i=1,r=!1,o=0,s=2*Math.PI){super(0,e,t,n,i,r,o,s),this.type=\"ConeGeometry\",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:s}}}class mc extends ro{constructor(e,t,n=1,i=0){super(),this.type=\"PolyhedronGeometry\",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],o=[];function s(e,t,n,i){const r=i+1,o=[];for(let i=0;i<=r;i++){o[i]=[];const s=e.clone().lerp(n,i/r),a=t.clone().lerp(n,i/r),l=r-i;for(let e=0;e<=l;e++)o[i][e]=0===e&&i===r?s:s.clone().lerp(a,e/l)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){const n=Math.floor(t/2);t%2==0?(a(o[e][n+1]),a(o[e+1][n]),a(o[e][n])):(a(o[e][n+1]),a(o[e+1][n+1]),a(o[e+1][n]))}}function a(e){r.push(e.x,e.y,e.z)}function l(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function c(e,t,n,i){i<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=i/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new ai,i=new ai,r=new ai;for(let o=0;o<t.length;o+=3)l(t[o+0],n),l(t[o+1],i),l(t[o+2],r),s(n,i,r,e)}(i),function(e){const t=new ai;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){const e=new ai;for(let n=0;n<r.length;n+=3){e.x=r[n+0],e.y=r[n+1],e.z=r[n+2];const i=u(e)/2/Math.PI+.5,s=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);o.push(i,1-s)}var t;(function(){const e=new ai,t=new ai,n=new ai,i=new ai,s=new Zn,a=new Zn,l=new Zn;for(let h=0,d=0;h<r.length;h+=9,d+=6){e.set(r[h+0],r[h+1],r[h+2]),t.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),s.set(o[d+0],o[d+1]),a.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),i.copy(e).add(t).add(n).divideScalar(3);const p=u(i);c(s,d+0,e,p),c(a,d+2,t,p),c(l,d+4,n,p)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],n=o[e+2],i=o[e+4],r=Math.max(t,n,i),s=Math.min(t,n,i);r>.9&&s<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),i<.2&&(o[e+4]+=1))}}()}(),this.setAttribute(\"position\",new qr(r,3)),this.setAttribute(\"normal\",new qr(r.slice(),3)),this.setAttribute(\"uv\",new qr(o,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}}class gc extends mc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type=\"DodecahedronGeometry\",this.parameters={radius:e,detail:t}}}const vc=new ai,yc=new ai,xc=new ai,_c=new Sr;class bc extends ro{constructor(e,t){if(super(),this.type=\"EdgesGeometry\",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,!0===e.isGeometry)return void console.error(\"THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\");const n=Math.pow(10,4),i=Math.cos(Bn*t),r=e.getIndex(),o=e.getAttribute(\"position\"),s=r?r.count:o.count,a=[0,0,0],l=[\"a\",\"b\",\"c\"],c=new Array(3),u={},h=[];for(let e=0;e<s;e+=3){r?(a[0]=r.getX(e),a[1]=r.getX(e+1),a[2]=r.getX(e+2)):(a[0]=e,a[1]=e+1,a[2]=e+2);const{a:t,b:s,c:d}=_c;if(t.fromBufferAttribute(o,a[0]),s.fromBufferAttribute(o,a[1]),d.fromBufferAttribute(o,a[2]),_c.getNormal(xc),c[0]=`${Math.round(t.x*n)},${Math.round(t.y*n)},${Math.round(t.z*n)}`,c[1]=`${Math.round(s.x*n)},${Math.round(s.y*n)},${Math.round(s.z*n)}`,c[2]=`${Math.round(d.x*n)},${Math.round(d.y*n)},${Math.round(d.z*n)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=c[e],r=c[t],o=_c[l[e]],s=_c[l[t]],d=`${n}_${r}`,p=`${r}_${n}`;p in u&&u[p]?(xc.dot(u[p].normal)<=i&&(h.push(o.x,o.y,o.z),h.push(s.x,s.y,s.z)),u[p]=null):d in u||(u[d]={index0:a[e],index1:a[t],normal:xc.clone()})}}for(const e in u)if(u[e]){const{index0:t,index1:n}=u[e];vc.fromBufferAttribute(o,t),yc.fromBufferAttribute(o,n),h.push(vc.x,vc.y,vc.z),h.push(yc.x,yc.y,yc.z)}this.setAttribute(\"position\",new qr(h,3))}}function wc(e,t,n,i,r){let o,s;if(r===function(e,t,n,i){let r=0;for(let o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}(e,t,n,i)>0)for(o=t;o<n;o+=i)s=Hc(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=Hc(o,e[o],e[o+1],s);return s&&zc(s,s.next)&&(jc(s),s=s.next),s}function Mc(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!zc(i,i.next)&&0!==Nc(i.prev,i,i.next))i=i.next;else{if(jc(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function Sc(e,t,n,i,r,o,s){if(!e)return;!s&&o&&function(e,t,n,i){let r=e;do{null===r.z&&(r.z=Dc(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ,i);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(e,i,r,o);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,o?Tc(e,i,r,o):Ec(e))t.push(a.i/n),t.push(e.i/n),t.push(l.i/n),jc(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?Sc(e=Ac(Mc(e),t,n),t,n,i,r,o,2):2===s&&Lc(e,t,n,i,r,o):Sc(Mc(e),t,n,i,r,o,1);break}}function Ec(e){const t=e.prev,n=e,i=e.next;if(Nc(t,n,i)>=0)return!1;let r=e.next.next;for(;r!==e.prev;){if(Oc(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Nc(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Tc(e,t,n,i){const r=e.prev,o=e,s=e.next;if(Nc(r,o,s)>=0)return!1;const a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,l=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,c=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,u=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,h=Dc(a,l,t,n,i),d=Dc(c,u,t,n,i);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&Oc(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Nc(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&Oc(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Nc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&Oc(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Nc(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&Oc(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Nc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Ac(e,t,n){let i=e;do{const r=i.prev,o=i.next.next;!zc(r,o)&&Uc(r,i,i.next,o)&&kc(r,o)&&kc(o,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(o.i/n),jc(i),jc(i.next),i=e=o),i=i.next}while(i!==e);return Mc(i)}function Lc(e,t,n,i,r,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Fc(s,e)){let a=Vc(s,e);return s=Mc(s,s.next),a=Mc(a,a.next),Sc(s,t,n,i,r,o),void Sc(a,t,n,i,r,o)}e=e.next}s=s.next}while(s!==e)}function Cc(e,t){return e.x-t.x}function Pc(e,t){if(t=function(e,t){let n=t;const i=e.x,r=e.y;let o,s=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const e=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>s){if(s=e,e===i){if(r===n.y)return n;if(r===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!o)return null;if(i===s)return o;const a=o,l=o.x,c=o.y;let u,h=1/0;n=o;do{i>=n.x&&n.x>=l&&i!==n.x&&Oc(r<c?i:s,r,l,c,r<c?s:i,r,n.x,n.y)&&(u=Math.abs(r-n.y)/(i-n.x),kc(n,e)&&(u<h||u===h&&(n.x>o.x||n.x===o.x&&Rc(o,n)))&&(o=n,h=u)),n=n.next}while(n!==a);return o}(e,t),t){const n=Vc(t,e);Mc(t,t.next),Mc(n,n.next)}}function Rc(e,t){return Nc(e.prev,e,t.prev)<0&&Nc(t.next,e,e.next)<0}function Dc(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ic(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Oc(e,t,n,i,r,o,s,a){return(r-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(i-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(r-s)*(i-a)>=0}function Fc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Uc(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(kc(e,t)&&kc(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Nc(e.prev,e,t.prev)||Nc(e,t.prev,t))||zc(e,t)&&Nc(e.prev,e,e.next)>0&&Nc(t.prev,t,t.next)>0)}function Nc(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function zc(e,t){return e.x===t.x&&e.y===t.y}function Uc(e,t,n,i){const r=Gc(Nc(e,t,n)),o=Gc(Nc(e,t,i)),s=Gc(Nc(n,i,e)),a=Gc(Nc(n,i,t));return r!==o&&s!==a||!(0!==r||!Bc(e,n,t))||!(0!==o||!Bc(e,i,t))||!(0!==s||!Bc(n,e,i))||!(0!==a||!Bc(n,t,i))}function Bc(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Gc(e){return e>0?1:e<0?-1:0}function kc(e,t){return Nc(e.prev,e,e.next)<0?Nc(e,t,e.next)>=0&&Nc(e,e.prev,t)>=0:Nc(e,t,e.prev)<0||Nc(e,e.next,t)<0}function Vc(e,t){const n=new Wc(e.i,e.x,e.y),i=new Wc(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function Hc(e,t,n,i){const r=new Wc(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function jc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Wc(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class qc{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return qc.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];Xc(e),Yc(n,e);let o=e.length;t.forEach(Xc);for(let e=0;e<t.length;e++)i.push(o),o+=t[e].length,Yc(n,t[e]);const s=function(e,t,n){n=n||2;const i=t&&t.length,r=i?t[0]*n:e.length;let o=wc(e,0,r,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c,u,h,d,p;if(i&&(o=function(e,t,n,i){const r=[];let o,s,a,l,c;for(o=0,s=t.length;o<s;o++)a=t[o]*i,l=o<s-1?t[o+1]*i:e.length,c=wc(e,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(Ic(c));for(r.sort(Cc),o=0;o<r.length;o++)Pc(r[o],n),n=Mc(n,n.next);return n}(e,t,o,n)),e.length>80*n){a=c=e[0],l=u=e[1];for(let t=n;t<r;t+=n)h=e[t],d=e[t+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-a,u-l),p=0!==p?1/p:0}return Sc(o,s,n,a,l,p),s}(n,i);for(let e=0;e<s.length;e+=3)r.push(s.slice(e,e+3));return r}}function Xc(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Yc(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Zc extends ro{constructor(e,t){super(),this.type=\"ExtrudeGeometry\",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let t=0,n=e.length;t<n;t++)o(e[t]);function o(e){const o=[],s=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:u-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Jc;void 0!==t.amount&&(console.warn(\"THREE.ExtrudeBufferGeometry: amount has been renamed to depth.\"),l=t.amount);let g,v,y,x,_,b=!1;f&&(g=f.getSpacedPoints(a),b=!0,c=!1,v=f.computeFrenetFrames(a,!1),y=new ai,x=new ai,_=new ai),c||(p=0,u=0,h=0,d=0);const w=e.extractPoints(s);let M=w.shape;const S=w.holes;if(!qc.isClockWise(M)){M=M.reverse();for(let e=0,t=S.length;e<t;e++){const t=S[e];qc.isClockWise(t)&&(S[e]=t.reverse())}}const E=qc.triangulateShape(M,S),T=M;for(let e=0,t=S.length;e<t;e++){const t=S[e];M=M.concat(t)}function A(e,t,n){return t||console.error(\"THREE.ExtrudeGeometry: vec does not exist\"),t.clone().multiplyScalar(n).add(e)}const L=M.length,C=E.length;function P(e,t,n){let i,r,o;const s=e.x-t.x,a=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=s*s+a*a,h=s*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=t.x-a/h,f=t.y+s/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(s*c-a*l);i=p+s*m-e.x,r=f+a*m-e.y;const g=i*i+r*r;if(g<=2)return new Zn(i,r);o=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(i=-a,r=s,o=Math.sqrt(u)):(i=s,r=a,o=Math.sqrt(u/2))}return new Zn(i/o,r/o)}const R=[];for(let e=0,t=T.length,n=t-1,i=e+1;e<t;e++,n++,i++)n===t&&(n=0),i===t&&(i=0),R[e]=P(T[e],T[n],T[i]);const D=[];let I,O=R.concat();for(let e=0,t=S.length;e<t;e++){const t=S[e];I=[];for(let e=0,n=t.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),I[e]=P(t[e],t[i],t[r]);D.push(I),O=O.concat(I)}for(let e=0;e<p;e++){const t=e/p,n=u*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=T.length;e<t;e++){const t=A(T[e],R[e],i);z(t.x,t.y,-n)}for(let e=0,t=S.length;e<t;e++){const t=S[e];I=D[e];for(let e=0,r=t.length;e<r;e++){const r=A(t[e],I[e],i);z(r.x,r.y,-n)}}}const F=h+d;for(let e=0;e<L;e++){const t=c?A(M[e],O[e],F):M[e];b?(x.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),_.copy(g[0]).add(x).add(y),z(_.x,_.y,_.z)):z(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<L;t++){const n=c?A(M[t],O[t],F):M[t];b?(x.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),_.copy(g[e]).add(x).add(y),z(_.x,_.y,_.z)):z(n.x,n.y,l/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=u*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=T.length;e<t;e++){const t=A(T[e],R[e],i);z(t.x,t.y,l+n)}for(let e=0,t=S.length;e<t;e++){const t=S[e];I=D[e];for(let e=0,r=t.length;e<r;e++){const r=A(t[e],I[e],i);b?z(r.x,r.y+g[a-1].y,g[a-1].x+n):z(r.x,r.y,l+n)}}}function N(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=a+2*p;e<n;e++){const n=L*e,o=L*(e+1);B(t+i+n,t+r+n,t+r+o,t+i+o)}}}function z(e,t,n){o.push(e),o.push(t),o.push(n)}function U(e,t,r){G(e),G(t),G(r);const o=i.length/3,s=m.generateTopUV(n,i,o-3,o-2,o-1);k(s[0]),k(s[1]),k(s[2])}function B(e,t,r,o){G(e),G(t),G(o),G(t),G(r),G(o);const s=i.length/3,a=m.generateSideWallUV(n,i,s-6,s-3,s-2,s-1);k(a[0]),k(a[1]),k(a[3]),k(a[1]),k(a[2]),k(a[3])}function G(e){i.push(o[3*e+0]),i.push(o[3*e+1]),i.push(o[3*e+2])}function k(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(c){let e=0,t=L*e;for(let e=0;e<C;e++){const n=E[e];U(n[2]+t,n[1]+t,n[0]+t)}e=a+2*p,t=L*e;for(let e=0;e<C;e++){const n=E[e];U(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<C;e++){const t=E[e];U(t[2],t[1],t[0])}for(let e=0;e<C;e++){const t=E[e];U(t[0]+L*a,t[1]+L*a,t[2]+L*a)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;N(T,t),t+=T.length;for(let e=0,n=S.length;e<n;e++){const n=S[e];N(n,t),t+=n.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute(\"position\",new qr(i,3)),this.setAttribute(\"uv\",new qr(r,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,i=e.length;t<i;t++){const i=e[t];n.shapes.push(i.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}}const Jc={generateTopUV:function(e,t,n,i,r){const o=t[3*n],s=t[3*n+1],a=t[3*i],l=t[3*i+1],c=t[3*r],u=t[3*r+1];return[new Zn(o,s),new Zn(a,l),new Zn(c,u)]},generateSideWallUV:function(e,t,n,i,r,o){const s=t[3*n],a=t[3*n+1],l=t[3*n+2],c=t[3*i],u=t[3*i+1],h=t[3*i+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(a-u)<Math.abs(s-c)?[new Zn(s,1-l),new Zn(c,1-h),new Zn(d,1-f),new Zn(m,1-v)]:[new Zn(a,1-l),new Zn(u,1-h),new Zn(p,1-f),new Zn(g,1-v)]}};class $c extends mc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type=\"IcosahedronGeometry\",this.parameters={radius:e,detail:t}}}class Kc extends ro{constructor(e,t=12,n=0,i=2*Math.PI){super(),this.type=\"LatheGeometry\",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=Vn(i,0,2*Math.PI);const r=[],o=[],s=[],a=1/t,l=new ai,c=new Zn;for(let r=0;r<=t;r++){const u=n+r*a*i,h=Math.sin(u),d=Math.cos(u);for(let n=0;n<=e.length-1;n++)l.x=e[n].x*h,l.y=e[n].y,l.z=e[n].x*d,o.push(l.x,l.y,l.z),c.x=r/t,c.y=n/(e.length-1),s.push(c.x,c.y)}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const i=t+n*e.length,o=i,s=i+e.length,a=i+e.length+1,l=i+1;r.push(o,s,l),r.push(s,a,l)}if(this.setIndex(r),this.setAttribute(\"position\",new qr(o,3)),this.setAttribute(\"uv\",new qr(s,2)),this.computeVertexNormals(),i===2*Math.PI){const n=this.attributes.normal.array,i=new ai,r=new ai,o=new ai,s=t*e.length*3;for(let t=0,a=0;t<e.length;t++,a+=3)i.x=n[a+0],i.y=n[a+1],i.z=n[a+2],r.x=n[s+a+0],r.y=n[s+a+1],r.z=n[s+a+2],o.addVectors(i,r).normalize(),n[a+0]=n[s+a+0]=o.x,n[a+1]=n[s+a+1]=o.y,n[a+2]=n[s+a+2]=o.z}}}class Qc extends mc{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type=\"OctahedronGeometry\",this.parameters={radius:e,detail:t}}}class eu extends ro{constructor(e,t,n){super(),this.type=\"ParametricGeometry\",this.parameters={func:e,slices:t,stacks:n};const i=[],r=[],o=[],s=[],a=1e-5,l=new ai,c=new ai,u=new ai,h=new ai,d=new ai;e.length<3&&console.error(\"THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.\");const p=t+1;for(let i=0;i<=n;i++){const p=i/n;for(let n=0;n<=t;n++){const i=n/t;e(i,p,c),r.push(c.x,c.y,c.z),i-a>=0?(e(i-a,p,u),h.subVectors(c,u)):(e(i+a,p,u),h.subVectors(u,c)),p-a>=0?(e(i,p-a,u),d.subVectors(c,u)):(e(i,p+a,u),d.subVectors(u,c)),l.crossVectors(h,d).normalize(),o.push(l.x,l.y,l.z),s.push(i,p)}}for(let e=0;e<n;e++)for(let n=0;n<t;n++){const t=e*p+n,r=e*p+n+1,o=(e+1)*p+n+1,s=(e+1)*p+n;i.push(t,r,s),i.push(r,o,s)}this.setIndex(i),this.setAttribute(\"position\",new qr(r,3)),this.setAttribute(\"normal\",new qr(o,3)),this.setAttribute(\"uv\",new qr(s,2))}}class tu extends ro{constructor(e=.5,t=1,n=8,i=1,r=0,o=2*Math.PI){super(),this.type=\"RingGeometry\",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},n=Math.max(3,n);const s=[],a=[],l=[],c=[];let u=e;const h=(t-e)/(i=Math.max(1,i)),d=new ai,p=new Zn;for(let e=0;e<=i;e++){for(let e=0;e<=n;e++){const i=r+e/n*o;d.x=u*Math.cos(i),d.y=u*Math.sin(i),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}u+=h}for(let e=0;e<i;e++){const t=e*(n+1);for(let e=0;e<n;e++){const i=e+t,r=i,o=i+n+1,a=i+n+2,l=i+1;s.push(r,o,l),s.push(o,a,l)}}this.setIndex(s),this.setAttribute(\"position\",new qr(a,3)),this.setAttribute(\"normal\",new qr(l,3)),this.setAttribute(\"uv\",new qr(c,2))}}class nu extends ro{constructor(e,t=12){super(),this.type=\"ShapeGeometry\",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],o=[];let s=0,a=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(s,a,t),s+=a,a=0;function l(e){const s=i.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===qc.isClockWise(c)&&(c=c.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===qc.isClockWise(t)&&(u[e]=t.reverse())}const h=qc.triangulateShape(c,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];i.push(t.x,t.y,0),r.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],i=t[0]+s,r=t[1]+s,o=t[2]+s;n.push(i,r,o),a+=3}}this.setIndex(n),this.setAttribute(\"position\",new qr(i,3)),this.setAttribute(\"normal\",new qr(r,3)),this.setAttribute(\"uv\",new qr(o,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class iu extends ro{constructor(e=1,t=8,n=6,i=0,r=2*Math.PI,o=0,s=Math.PI){super(),this.type=\"SphereGeometry\",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const a=Math.min(o+s,Math.PI);let l=0;const c=[],u=new ai,h=new ai,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let y=0;0==d&&0==o?y=.5/t:d==n&&a==Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const a=n/t;u.x=-e*Math.cos(i+a*r)*Math.sin(o+v*s),u.y=e*Math.cos(o+v*s),u.z=e*Math.sin(i+a*r)*Math.sin(o+v*s),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+y,1-v),g.push(l++)}c.push(g)}for(let e=0;e<n;e++)for(let i=0;i<t;i++){const t=c[e][i+1],r=c[e][i],s=c[e+1][i],l=c[e+1][i+1];(0!==e||o>0)&&d.push(t,r,l),(e!==n-1||a<Math.PI)&&d.push(r,s,l)}this.setIndex(d),this.setAttribute(\"position\",new qr(p,3)),this.setAttribute(\"normal\",new qr(f,3)),this.setAttribute(\"uv\",new qr(m,2))}}class ru extends mc{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type=\"TetrahedronGeometry\",this.parameters={radius:e,detail:t}}}class ou extends Zc{constructor(e,t={}){const n=t.font;if(!n||!n.isFont)return console.error(\"THREE.TextGeometry: font parameter is not an instance of THREE.Font.\"),new ro;const i=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(i,t),this.type=\"TextGeometry\"}}class su extends ro{constructor(e=1,t=.4,n=8,i=6,r=2*Math.PI){super(),this.type=\"TorusGeometry\",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const o=[],s=[],a=[],l=[],c=new ai,u=new ai,h=new ai;for(let o=0;o<=n;o++)for(let d=0;d<=i;d++){const p=d/i*r,f=o/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),s.push(u.x,u.y,u.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(d/i),l.push(o/n)}for(let e=1;e<=n;e++)for(let t=1;t<=i;t++){const n=(i+1)*e+t-1,r=(i+1)*(e-1)+t-1,s=(i+1)*(e-1)+t,a=(i+1)*e+t;o.push(n,r,a),o.push(r,s,a)}this.setIndex(o),this.setAttribute(\"position\",new qr(s,3)),this.setAttribute(\"normal\",new qr(a,3)),this.setAttribute(\"uv\",new qr(l,2))}}class au extends ro{constructor(e=1,t=.4,n=64,i=8,r=2,o=3){super(),this.type=\"TorusKnotGeometry\",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:o},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],l=[],c=[],u=new ai,h=new ai,d=new ai,p=new ai,f=new ai,m=new ai,g=new ai;for(let s=0;s<=n;++s){const y=s/n*r*Math.PI*2;v(y,r,o,e,d),v(y+.01,r,o,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=i;++e){const r=e/i*Math.PI*2,o=-t*Math.cos(r),p=t*Math.sin(r);u.x=d.x+(o*g.x+p*f.x),u.y=d.y+(o*g.y+p*f.y),u.z=d.z+(o*g.z+p*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(s/n),c.push(e/i)}}for(let e=1;e<=n;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),o=(i+1)*e+t,a=(i+1)*(e-1)+t;s.push(n,r,a),s.push(r,o,a)}function v(e,t,n,i,r){const o=Math.cos(e),s=Math.sin(e),a=n/t*e,l=Math.cos(a);r.x=i*(2+l)*.5*o,r.y=i*(2+l)*s*.5,r.z=i*Math.sin(a)*.5}this.setIndex(s),this.setAttribute(\"position\",new qr(a,3)),this.setAttribute(\"normal\",new qr(l,3)),this.setAttribute(\"uv\",new qr(c,2))}}class lu extends ro{constructor(e,t=64,n=1,i=8,r=!1){super(),this.type=\"TubeGeometry\",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new ai,a=new ai,l=new Zn;let c=new ai;const u=[],h=[],d=[],p=[];function f(r){c=e.getPointAt(r/t,c);const l=o.normals[r],d=o.binormals[r];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,r=Math.sin(t),o=-Math.cos(t);a.x=o*l.x+r*d.x,a.y=o*l.y+r*d.y,a.z=o*l.z+r*d.z,a.normalize(),h.push(a.x,a.y,a.z),s.x=c.x+n*a.x,s.y=c.y+n*a.y,s.z=c.z+n*a.z,u.push(s.x,s.y,s.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)l.x=e/t,l.y=n/i,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),o=(i+1)*e+t,s=(i+1)*(e-1)+t;p.push(n,r,s),p.push(r,o,s)}}()}(),this.setIndex(p),this.setAttribute(\"position\",new qr(u,3)),this.setAttribute(\"normal\",new qr(h,3)),this.setAttribute(\"uv\",new qr(d,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}}class cu extends ro{constructor(e){if(super(),this.type=\"WireframeGeometry\",!0===e.isGeometry)return void console.error(\"THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\");const t=[],n=[0,0],i={},r=new ai;if(null!==e.index){const o=e.attributes.position,s=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,t=a.length;e<t;++e){const t=a[e],r=t.start;for(let e=r,o=r+t.count;e<o;e+=3)for(let t=0;t<3;t++){const r=s.getX(e+t),o=s.getX(e+(t+1)%3);n[0]=Math.min(r,o),n[1]=Math.max(r,o);const a=n[0]+\",\"+n[1];void 0===i[a]&&(i[a]={index1:n[0],index2:n[1]})}}for(const e in i){const n=i[e];r.fromBufferAttribute(o,n.index1),t.push(r.x,r.y,r.z),r.fromBufferAttribute(o,n.index2),t.push(r.x,r.y,r.z)}}else{const n=e.attributes.position;for(let e=0,i=n.count/3;e<i;e++)for(let i=0;i<3;i++){const o=3*e+i;r.fromBufferAttribute(n,o),t.push(r.x,r.y,r.z);const s=3*e+(i+1)%3;r.fromBufferAttribute(n,s),t.push(r.x,r.y,r.z)}}this.setAttribute(\"position\",new qr(t,3))}}var uu=Object.freeze({__proto__:null,BoxGeometry:Eo,BoxBufferGeometry:Eo,CircleGeometry:dc,CircleBufferGeometry:dc,ConeGeometry:fc,ConeBufferGeometry:fc,CylinderGeometry:pc,CylinderBufferGeometry:pc,DodecahedronGeometry:gc,DodecahedronBufferGeometry:gc,EdgesGeometry:bc,ExtrudeGeometry:Zc,ExtrudeBufferGeometry:Zc,IcosahedronGeometry:$c,IcosahedronBufferGeometry:$c,LatheGeometry:Kc,LatheBufferGeometry:Kc,OctahedronGeometry:Qc,OctahedronBufferGeometry:Qc,ParametricGeometry:eu,ParametricBufferGeometry:eu,PlaneGeometry:ko,PlaneBufferGeometry:ko,PolyhedronGeometry:mc,PolyhedronBufferGeometry:mc,RingGeometry:tu,RingBufferGeometry:tu,ShapeGeometry:nu,ShapeBufferGeometry:nu,SphereGeometry:iu,SphereBufferGeometry:iu,TetrahedronGeometry:ru,TetrahedronBufferGeometry:ru,TextGeometry:ou,TextBufferGeometry:ou,TorusGeometry:su,TorusBufferGeometry:su,TorusKnotGeometry:au,TorusKnotBufferGeometry:au,TubeGeometry:lu,TubeBufferGeometry:lu,WireframeGeometry:cu});class hu extends Tr{constructor(e){super(),this.type=\"ShadowMaterial\",this.color=new Ir(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}hu.prototype.isShadowMaterial=!0;class du extends Co{constructor(e){super(e),this.type=\"RawShaderMaterial\"}}du.prototype.isRawShaderMaterial=!0;class pu extends Tr{constructor(e){super(),this.defines={STANDARD:\"\"},this.type=\"MeshStandardMaterial\",this.color=new Ir(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ir(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:\"\"},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}}pu.prototype.isMeshStandardMaterial=!0;class fu extends pu{constructor(e){super(),this.defines={STANDARD:\"\",PHYSICAL:\"\"},this.type=\"MeshPhysicalMaterial\",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Zn(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,\"ior\",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Vn(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Ir(1,1,1),this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:\"\",PHYSICAL:\"\"},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Ir).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this}}fu.prototype.isMeshPhysicalMaterial=!0;class mu extends Tr{constructor(e){super(),this.type=\"MeshPhongMaterial\",this.color=new Ir(16777215),this.specular=new Ir(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ir(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}mu.prototype.isMeshPhongMaterial=!0;class gu extends Tr{constructor(e){super(),this.defines={TOON:\"\"},this.type=\"MeshToonMaterial\",this.color=new Ir(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ir(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}gu.prototype.isMeshToonMaterial=!0;class vu extends Tr{constructor(e){super(),this.type=\"MeshNormalMaterial\",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}vu.prototype.isMeshNormalMaterial=!0;class yu extends Tr{constructor(e){super(),this.type=\"MeshLambertMaterial\",this.color=new Ir(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ir(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap=\"round\",this.wireframeLinejoin=\"round\",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}yu.prototype.isMeshLambertMaterial=!0;class xu extends Tr{constructor(e){super(),this.defines={MATCAP:\"\"},this.type=\"MeshMatcapMaterial\",this.color=new Ir(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=an,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:\"\"},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}xu.prototype.isMeshMatcapMaterial=!0;class _u extends jl{constructor(e){super(),this.type=\"LineDashedMaterial\",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}_u.prototype.isLineDashedMaterial=!0;var bu=Object.freeze({__proto__:null,ShadowMaterial:hu,SpriteMaterial:cl,RawShaderMaterial:du,ShaderMaterial:Co,PointsMaterial:tc,MeshPhysicalMaterial:fu,MeshStandardMaterial:pu,MeshPhongMaterial:mu,MeshToonMaterial:gu,MeshNormalMaterial:vu,MeshLambertMaterial:yu,MeshDepthMaterial:ka,MeshDistanceMaterial:Va,MeshBasicMaterial:Or,MeshMatcapMaterial:xu,LineDashedMaterial:_u,LineBasicMaterial:jl,Material:Tr});const wu={arraySlice:function(e,t,n){return wu.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:\"number\"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const i=e.length,r=new e.constructor(i);for(let o=0,s=0;s!==i;++o){const i=n[o]*t;for(let n=0;n!==t;++n)r[s++]=e[i+n]}return r},flattenJSON:function(e,t,n,i){let r=1,o=e[0];for(;void 0!==o&&void 0===o[i];)o=e[r++];if(void 0===o)return;let s=o[i];if(void 0!==s)if(Array.isArray(s))do{s=o[i],void 0!==s&&(t.push(o.time),n.push.apply(n,s)),o=e[r++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[i],void 0!==s&&(t.push(o.time),s.toArray(n,n.length)),o=e[r++]}while(void 0!==o);else do{s=o[i],void 0!==s&&(t.push(o.time),n.push(s)),o=e[r++]}while(void 0!==o)},subclip:function(e,t,n,i,r=30){const o=e.clone();o.name=t;const s=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],a=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*r;if(!(o<n||o>=i)){l.push(t.times[e]);for(let n=0;n<a;++n)c.push(t.values[e*a+n])}}0!==l.length&&(t.times=wu.convertArray(l,t.times.constructor),t.values=wu.convertArray(c,t.values.constructor),s.push(t))}o.tracks=s;let a=1/0;for(let e=0;e<o.tracks.length;++e)a>o.tracks[e].times[0]&&(a=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,n=e,i=30){i<=0&&(i=30);const r=n.tracks.length,o=t/i;for(let t=0;t<r;++t){const i=n.tracks[t],r=i.ValueTypeName;if(\"bool\"===r||\"string\"===r)continue;const s=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===r}));if(void 0===s)continue;let a=0;const l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=i.times.length-1;let d;if(o<=i.times[0]){const e=a,t=l-a;d=wu.arraySlice(i.values,e,t)}else if(o>=i.times[h]){const e=h*l+a,t=e+l-a;d=wu.arraySlice(i.values,e,t)}else{const e=i.createInterpolant(),t=a,n=l-a;e.evaluate(o),d=wu.arraySlice(e.resultBuffer,t,n)}\"quaternion\"===r&&(new si).fromArray(d).normalize().conjugate().toArray(d);const p=s.times.length;for(let e=0;e<p;++e){const t=e*u+c;if(\"quaternion\"===r)si.multiplyQuaternionsFlat(s.values,t,d,0,s.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)s.values[t+n]-=d[n]}}}return e.blendMode=qt,e}};class Mu{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(e>=r)break e;{const s=t[1];e<s&&(n=2,r=s);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===o)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0}}for(;n<o;){const i=n+o>>>1;e<t[i]?o=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let e=0;e!==i;++e)t[e]=n[r+e];return t}interpolate_(){throw new Error(\"call to abstract method\")}intervalChanged_(){}}Mu.prototype.beforeStart_=Mu.prototype.copySampleValue_,Mu.prototype.afterEnd_=Mu.prototype.copySampleValue_;class Su extends Mu{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Vt,endingEnd:Vt}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,o=e+1,s=i[r],a=i[o];if(void 0===s)switch(this.getSettings_().endingStart){case Ht:r=e,s=2*t-n;break;case jt:r=i.length-2,s=t+i[r]-i[r+1];break;default:r=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Ht:o=e,a=2*n-t;break;case jt:o=1,a=n+i[1]-i[0];break;default:o=e-1,a=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-n),this._offsetPrev=r*c,this._offsetNext=o*c}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let e=0;e!==s;++e)r[e]=g*o[c+e]+v*o[l+e]+y*o[a+e]+x*o[u+e];return r}}class Eu extends Mu{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=(n-t)/(i-t),u=1-c;for(let e=0;e!==s;++e)r[e]=o[l+e]*u+o[a+e]*c;return r}}class Tu extends Mu{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Au{constructor(e,t,n,i){if(void 0===e)throw new Error(\"THREE.KeyframeTrack: track name is undefined\");if(void 0===t||0===t.length)throw new Error(\"THREE.KeyframeTrack: no keyframes in track named \"+e);this.name=e,this.times=wu.convertArray(t,this.TimeBufferType),this.values=wu.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:wu.convertArray(e.times,Array),values:wu.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Tu(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Eu(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Su(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Bt:t=this.InterpolantFactoryMethodDiscrete;break;case Gt:t=this.InterpolantFactoryMethodLinear;break;case kt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t=\"unsupported interpolation for \"+this.ValueTypeName+\" keyframe track named \"+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn(\"THREE.KeyframeTrack:\",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Bt;case this.InterpolantFactoryMethodLinear:return Gt;case this.InterpolantFactoryMethodSmooth:return kt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==r||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const e=this.getValueSize();this.times=wu.arraySlice(n,r,o),this.values=wu.arraySlice(this.values,r*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error(\"THREE.KeyframeTrack: Invalid value size in track.\",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error(\"THREE.KeyframeTrack: Track is empty.\",this),e=!1);let o=null;for(let t=0;t!==r;t++){const i=n[t];if(\"number\"==typeof i&&isNaN(i)){console.error(\"THREE.KeyframeTrack: Time is not a valid number.\",this,t,i),e=!1;break}if(null!==o&&o>i){console.error(\"THREE.KeyframeTrack: Out of order keys.\",this,t,i,o),e=!1;break}o=i}if(void 0!==i&&wu.isTypedArray(i))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error(\"THREE.KeyframeTrack: Value is not a valid number.\",this,t,n),e=!1;break}}return e}optimize(){const e=wu.arraySlice(this.times),t=wu.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===kt,r=e.length-1;let o=1;for(let s=1;s<r;++s){let r=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==e[0]))if(i)r=!0;else{const e=s*n,i=e-n,o=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[i+s]||n!==t[o+s]){r=!0;break}}}if(r){if(s!==o){e[o]=e[s];const i=s*n,r=o*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++o}}if(r>0){e[o]=e[r];for(let e=r*n,i=o*n,s=0;s!==n;++s)t[i+s]=t[e+s];++o}return o!==e.length?(this.times=wu.arraySlice(e,0,o),this.values=wu.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=wu.arraySlice(this.times,0),t=wu.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Au.prototype.TimeBufferType=Float32Array,Au.prototype.ValueBufferType=Float32Array,Au.prototype.DefaultInterpolation=Gt;class Lu extends Au{}Lu.prototype.ValueTypeName=\"bool\",Lu.prototype.ValueBufferType=Array,Lu.prototype.DefaultInterpolation=Bt,Lu.prototype.InterpolantFactoryMethodLinear=void 0,Lu.prototype.InterpolantFactoryMethodSmooth=void 0;class Cu extends Au{}Cu.prototype.ValueTypeName=\"color\";class Pu extends Au{}Pu.prototype.ValueTypeName=\"number\";class Ru extends Mu{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(i-t);let l=e*s;for(let e=l+s;l!==e;l+=4)si.slerpFlat(r,0,o,l-s,o,l,a);return r}}class Du extends Au{InterpolantFactoryMethodLinear(e){return new Ru(this.times,this.values,this.getValueSize(),e)}}Du.prototype.ValueTypeName=\"quaternion\",Du.prototype.DefaultInterpolation=Gt,Du.prototype.InterpolantFactoryMethodSmooth=void 0;class Iu extends Au{}Iu.prototype.ValueTypeName=\"string\",Iu.prototype.ValueBufferType=Array,Iu.prototype.DefaultInterpolation=Bt,Iu.prototype.InterpolantFactoryMethodLinear=void 0,Iu.prototype.InterpolantFactoryMethodSmooth=void 0;class Ou extends Au{}Ou.prototype.ValueTypeName=\"vector\";class Fu{constructor(e,t=-1,n,i=Wt){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=kn(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let e=0,r=n.length;e!==r;++e)t.push(Nu(n[e]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,i=n.length;e!==i;++e)t.push(Au.toJSON(n[e]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,o=[];for(let e=0;e<r;e++){let s=[],a=[];s.push((e+r-1)%r,e,(e+1)%r),a.push(0,1,0);const l=wu.getKeyframeOrder(s);s=wu.sortedArray(s,1,l),a=wu.sortedArray(a,1,l),i||0!==s[0]||(s.push(r),a.push(a[0])),o.push(new Pu(\".morphTargetInfluences[\"+t[e].name+\"]\",s,a).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\\w-]*?)([\\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n.name.match(r);if(o&&o.length>1){const e=o[1];let t=i[e];t||(i[e]=t=[]),t.push(n)}}const o=[];for(const e in i)o.push(this.CreateFromMorphTargetSequence(e,i[e],t,n));return o}static parseAnimation(e,t){if(!e)return console.error(\"THREE.AnimationClip: No animation in JSONLoader data.\"),null;const n=function(e,t,n,i,r){if(0!==n.length){const o=[],s=[];wu.flattenJSON(n,o,s,i),0!==o.length&&r.push(new e(t,o,s))}},i=[],r=e.name||\"default\",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const r=l[e].keys;if(r&&0!==r.length)if(r[0].morphTargets){const e={};let t;for(t=0;t<r.length;t++)if(r[t].morphTargets)for(let n=0;n<r[t].morphTargets.length;n++)e[r[t].morphTargets[n]]=-1;for(const n in e){const e=[],o=[];for(let i=0;i!==r[t].morphTargets.length;++i){const i=r[t];e.push(i.time),o.push(i.morphTarget===n?1:0)}i.push(new Pu(\".morphTargetInfluence[\"+n+\"]\",e,o))}a=e.length*(o||1)}else{const o=\".bones[\"+t[e].name+\"]\";n(Ou,o+\".position\",r,\"pos\",i),n(Du,o+\".quaternion\",r,\"rot\",i),n(Ou,o+\".scale\",r,\"scl\",i)}}return 0===i.length?null:new this(r,a,i,s)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Nu(e){if(void 0===e.type)throw new Error(\"THREE.KeyframeTrack: track type undefined, can not parse\");const t=function(e){switch(e.toLowerCase()){case\"scalar\":case\"double\":case\"float\":case\"number\":case\"integer\":return Pu;case\"vector\":case\"vector2\":case\"vector3\":case\"vector4\":return Ou;case\"color\":return Cu;case\"quaternion\":return Du;case\"bool\":case\"boolean\":return Lu;case\"string\":return Iu}throw new Error(\"THREE.KeyframeTrack: Unsupported typeName: \"+e)}(e.type);if(void 0===e.times){const t=[],n=[];wu.flattenJSON(e.keys,t,n,\"value\"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const zu={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Uu{constructor(e,t,n){const i=this;let r,o=!1,s=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===o&&void 0!==i.onStart&&i.onStart(e,s,a),o=!0},this.itemEnd=function(e){s++,void 0!==i.onProgress&&i.onProgress(e,s,a),s===a&&(o=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const Bu=new Uu;class Gu{constructor(e){this.manager=void 0!==e?e:Bu,this.crossOrigin=\"anonymous\",this.withCredentials=!1,this.path=\"\",this.resourcePath=\"\",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const ku={};class Vu extends Gu{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=\"\"),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=zu.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;if(void 0!==ku[e])return void ku[e].push({onLoad:t,onProgress:n,onError:i});const s=e.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(s){const n=s[1],o=!!s[2];let a=s[3];a=decodeURIComponent(a),o&&(a=atob(a));try{let i;const o=(this.responseType||\"\").toLowerCase();switch(o){case\"arraybuffer\":case\"blob\":const e=new Uint8Array(a.length);for(let t=0;t<a.length;t++)e[t]=a.charCodeAt(t);i=\"blob\"===o?new Blob([e.buffer],{type:n}):e.buffer;break;case\"document\":const t=new DOMParser;i=t.parseFromString(a,n);break;case\"json\":i=JSON.parse(a);break;default:i=a}setTimeout((function(){t&&t(i),r.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}),0)}}else{ku[e]=[],ku[e].push({onLoad:t,onProgress:n,onError:i}),a=new XMLHttpRequest,a.open(\"GET\",e,!0),a.addEventListener(\"load\",(function(t){const n=this.response,i=ku[e];if(delete ku[e],200===this.status||0===this.status){0===this.status&&console.warn(\"THREE.FileLoader: HTTP Status 0 received.\"),zu.add(e,n);for(let e=0,t=i.length;e<t;e++){const t=i[e];t.onLoad&&t.onLoad(n)}r.manager.itemEnd(e)}else{for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}}),!1),a.addEventListener(\"progress\",(function(t){const n=ku[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onProgress&&i.onProgress(t)}}),!1),a.addEventListener(\"error\",(function(t){const n=ku[e];delete ku[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),a.addEventListener(\"abort\",(function(t){const n=ku[e];delete ku[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:\"text/plain\");for(const e in this.requestHeader)a.setRequestHeader(e,this.requestHeader[e]);a.send(null)}return r.manager.itemStart(e),a}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Hu extends Gu{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new Vu(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=Fu.parse(e[n]);t.push(i)}return t}}class ju extends Gu{constructor(e){super(e)}load(e,t,n,i){const r=this,o=[],s=new cc,a=new Vu(this.manager);a.setPath(this.path),a.setResponseType(\"arraybuffer\"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let l=0;function c(c){a.load(e[c],(function(e){const n=r.parse(e,!0);o[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(s.minFilter=xe),s.image=o,s.format=n.format,s.needsUpdate=!0,t&&t(s))}),n,i)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)c(t);else a.load(e,(function(e){const n=r.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)o[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),o[t].format=n.format,o[t].width=n.width,o[t].height=n.height}s.image=o}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=xe),s.format=n.format,s.needsUpdate=!0,t&&t(s)}),n,i);return s}}class Wu extends Gu{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=zu.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;const s=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"img\");function a(){s.removeEventListener(\"load\",a,!1),s.removeEventListener(\"error\",l,!1),zu.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){s.removeEventListener(\"load\",a,!1),s.removeEventListener(\"error\",l,!1),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}return s.addEventListener(\"load\",a,!1),s.addEventListener(\"error\",l,!1),\"data:\"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}}class qu extends Gu{constructor(e){super(e)}load(e,t,n,i){const r=new Oo,o=new Wu(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(e[n],(function(e){r.images[n]=e,s++,6===s&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(let t=0;t<e.length;++t)a(t);return r}}class Xu extends Gu{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new Fl,s=new Vu(this.manager);return s.setResponseType(\"arraybuffer\"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(r.withCredentials),s.load(e,(function(e){const n=r.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:de,o.wrapT=void 0!==n.wrapT?n.wrapT:de,o.magFilter=void 0!==n.magFilter?n.magFilter:xe,o.minFilter=void 0!==n.minFilter?n.minFilter:xe,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(o.encoding=n.encoding),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=we),1===n.mipmapCount&&(o.minFilter=xe),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,t&&t(o,n))}),n,i),o}}class Yu extends Gu{constructor(e){super(e)}load(e,t,n,i){const r=new ei,o=new Wu(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){r.image=n;const i=e.search(/\\.jpe?g($|\\?)/i)>0||0===e.search(/^data\\:image\\/jpeg/);r.format=i?ze:Ue,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}class Zu{constructor(){this.type=\"Curve\",this.arcLengthDivisions=200}getPoint(){return console.warn(\"THREE.Curve: .getPoint() not implemented.\"),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let o;o=t||e*n[r-1];let s,a=0,l=r-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),s=n[i]-o,s<0)a=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(i=l,n[i]===o)return i/(r-1);const c=n[i];return(i+(o-c)/(n[i+1]-c))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),s=this.getPoint(r),a=t||(o.isVector2?new Zn:new ai);return a.copy(s).sub(o).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new ai,i=[],r=[],o=[],s=new ai,a=new Ui;for(let t=0;t<=e;t++){const n=t/e;i[t]=this.getTangentAt(n,new ai),i[t].normalize()}r[0]=new ai,o[0]=new ai;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),s.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],s),o[0].crossVectors(i[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),o[t]=o[t-1].clone(),s.crossVectors(i[t-1],i[t]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(Vn(i[t-1].dot(i[t]),-1,1));r[t].applyMatrix4(a.makeRotationAxis(s,e))}o[t].crossVectors(i[t],r[t])}if(!0===t){let t=Math.acos(Vn(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(s.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],t*n)),o[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:\"Curve\",generator:\"Curve.toJSON\"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Ju extends Zu{constructor(e=0,t=0,n=1,i=1,r=0,o=2*Math.PI,s=!1,a=0){super(),this.type=\"EllipseCurve\",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a}getPoint(e,t){const n=t||new Zn,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=o?0:i),!0!==this.aClockwise||o||(r===i?r=-i:r-=i);const s=this.aStartAngle+e*r;let a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,i=l-this.aY;a=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Ju.prototype.isEllipseCurve=!0;class $u extends Ju{constructor(e,t,n,i,r,o){super(e,t,n,n,i,r,o),this.type=\"ArcCurve\"}}function Ku(){let e=0,t=0,n=0,i=0;function r(r,o,s,a){e=r,t=s,n=-3*r+3*o-2*s-a,i=2*r-2*o+s+a}return{initCatmullRom:function(e,t,n,i,o){r(t,n,o*(n-e),o*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,o,s,a){let l=(t-e)/o-(n-e)/(o+s)+(n-t)/s,c=(n-t)/s-(i-t)/(s+a)+(i-n)/a;l*=s,c*=s,r(t,n,l,c)},calc:function(r){const o=r*r;return e+t*r+n*o+i*(o*r)}}}$u.prototype.isArcCurve=!0;const Qu=new ai,eh=new Ku,th=new Ku,nh=new Ku;class ih extends Zu{constructor(e=[],t=!1,n=\"centripetal\",i=.5){super(),this.type=\"CatmullRomCurve3\",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new ai){const n=t,i=this.points,r=i.length,o=(r-(this.closed?0:1))*e;let s,a,l=Math.floor(o),c=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?s=i[(l-1)%r]:(Qu.subVectors(i[0],i[1]).add(i[0]),s=Qu);const u=i[l%r],h=i[(l+1)%r];if(this.closed||l+2<r?a=i[(l+2)%r]:(Qu.subVectors(i[r-1],i[r-2]).add(i[r-1]),a=Qu),\"centripetal\"===this.curveType||\"chordal\"===this.curveType){const e=\"chordal\"===this.curveType?.5:.25;let t=Math.pow(s.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(a),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),eh.initNonuniformCatmullRom(s.x,u.x,h.x,a.x,t,n,i),th.initNonuniformCatmullRom(s.y,u.y,h.y,a.y,t,n,i),nh.initNonuniformCatmullRom(s.z,u.z,h.z,a.z,t,n,i)}else\"catmullrom\"===this.curveType&&(eh.initCatmullRom(s.x,u.x,h.x,a.x,this.tension),th.initCatmullRom(s.y,u.y,h.y,a.y,this.tension),nh.initCatmullRom(s.z,u.z,h.z,a.z,this.tension));return n.set(eh.calc(c),th.calc(c),nh.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new ai).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function rh(e,t,n,i,r){const o=.5*(i-t),s=.5*(r-n),a=e*e;return(2*n-2*i+o+s)*(e*a)+(-3*n+3*i-2*o-s)*a+o*e+n}function oh(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function sh(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}ih.prototype.isCatmullRomCurve3=!0;class ah extends Zu{constructor(e=new Zn,t=new Zn,n=new Zn,i=new Zn){super(),this.type=\"CubicBezierCurve\",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Zn){const n=t,i=this.v0,r=this.v1,o=this.v2,s=this.v3;return n.set(sh(e,i.x,r.x,o.x,s.x),sh(e,i.y,r.y,o.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}ah.prototype.isCubicBezierCurve=!0;class lh extends Zu{constructor(e=new ai,t=new ai,n=new ai,i=new ai){super(),this.type=\"CubicBezierCurve3\",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new ai){const n=t,i=this.v0,r=this.v1,o=this.v2,s=this.v3;return n.set(sh(e,i.x,r.x,o.x,s.x),sh(e,i.y,r.y,o.y,s.y),sh(e,i.z,r.z,o.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}lh.prototype.isCubicBezierCurve3=!0;class ch extends Zu{constructor(e=new Zn,t=new Zn){super(),this.type=\"LineCurve\",this.v1=e,this.v2=t}getPoint(e,t=new Zn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Zn;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}ch.prototype.isLineCurve=!0;class uh extends Zu{constructor(e=new ai,t=new ai){super(),this.type=\"LineCurve3\",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new ai){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class hh extends Zu{constructor(e=new Zn,t=new Zn,n=new Zn){super(),this.type=\"QuadraticBezierCurve\",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Zn){const n=t,i=this.v0,r=this.v1,o=this.v2;return n.set(oh(e,i.x,r.x,o.x),oh(e,i.y,r.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}hh.prototype.isQuadraticBezierCurve=!0;class dh extends Zu{constructor(e=new ai,t=new ai,n=new ai){super(),this.type=\"QuadraticBezierCurve3\",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ai){const n=t,i=this.v0,r=this.v1,o=this.v2;return n.set(oh(e,i.x,r.x,o.x),oh(e,i.y,r.y,o.y),oh(e,i.z,r.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}dh.prototype.isQuadraticBezierCurve3=!0;class ph extends Zu{constructor(e=[]){super(),this.type=\"SplineCurve\",this.points=e}getPoint(e,t=new Zn){const n=t,i=this.points,r=(i.length-1)*e,o=Math.floor(r),s=r-o,a=i[0===o?o:o-1],l=i[o],c=i[o>i.length-2?i.length-1:o+1],u=i[o>i.length-3?i.length-1:o+2];return n.set(rh(s,a.x,l.x,c.x,u.x),rh(s,a.y,l.y,c.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Zn).fromArray(n))}return this}}ph.prototype.isSplineCurve=!0;var fh=Object.freeze({__proto__:null,ArcCurve:$u,CatmullRomCurve3:ih,CubicBezierCurve:ah,CubicBezierCurve3:lh,EllipseCurve:Ju,LineCurve:ch,LineCurve3:uh,QuadraticBezierCurve:hh,QuadraticBezierCurve3:dh,SplineCurve:ph});class mh extends Zu{constructor(){super(),this.type=\"CurvePath\",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new ch(t,e))}getPoint(e){const t=e*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=t){const e=n[i]-t,r=this.curves[i],o=r.getLength(),s=0===o?0:1-e/o;return r.getPointAt(s)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],s=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const i=a[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new fh[n.type]).fromJSON(n))}return this}}class gh extends mh{constructor(e){super(),this.type=\"Path\",this.currentPoint=new Zn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new ch(this.currentPoint.clone(),new Zn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new hh(this.currentPoint.clone(),new Zn(e,t),new Zn(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,o){const s=new ah(this.currentPoint.clone(),new Zn(e,t),new Zn(n,i),new Zn(r,o));return this.curves.push(s),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new ph(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,n,i,r,o),this}absarc(e,t,n,i,r,o){return this.absellipse(e,t,n,n,i,r,o),this}ellipse(e,t,n,i,r,o,s,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,r,o,s,a),this}absellipse(e,t,n,i,r,o,s,a){const l=new Ju(e,t,n,i,r,o,s,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class vh extends gh{constructor(e){super(e),this.uuid=kn(),this.type=\"Shape\",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new gh).fromJSON(n))}return this}}class yh extends cr{constructor(e,t=1){super(),this.type=\"Light\",this.color=new Ir(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}yh.prototype.isLight=!0;class xh extends yh{constructor(e,t,n){super(e,n),this.type=\"HemisphereLight\",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.groundColor=new Ir(t)}copy(e){return yh.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}xh.prototype.isHemisphereLight=!0;const _h=new Ui,bh=new ai,wh=new ai;class Mh{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Zn(512,512),this.map=null,this.mapPass=null,this.matrix=new Ui,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Uo,this._frameExtents=new Zn(1,1),this._viewportCount=1,this._viewports=[new ni(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;bh.setFromMatrixPosition(e.matrixWorld),t.position.copy(bh),wh.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(wh),t.updateMatrixWorld(),_h.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_h),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Sh extends Mh{constructor(){super(new Ro(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*Gn*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Sh.prototype.isSpotLightShadow=!0;class Eh extends yh{constructor(e,t,n=0,i=Math.PI/3,r=0,o=1){super(e,t),this.type=\"SpotLight\",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.target=new cr,this.distance=n,this.angle=i,this.penumbra=r,this.decay=o,this.shadow=new Sh}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Eh.prototype.isSpotLight=!0;const Th=new Ui,Ah=new ai,Lh=new ai;class Ch extends Mh{constructor(){super(new Ro(90,1,.5,500)),this._frameExtents=new Zn(4,2),this._viewportCount=6,this._viewports=[new ni(2,1,1,1),new ni(0,1,1,1),new ni(3,1,1,1),new ni(1,1,1,1),new ni(3,0,1,1),new ni(1,0,1,1)],this._cubeDirections=[new ai(1,0,0),new ai(-1,0,0),new ai(0,0,1),new ai(0,0,-1),new ai(0,1,0),new ai(0,-1,0)],this._cubeUps=[new ai(0,1,0),new ai(0,1,0),new ai(0,1,0),new ai(0,1,0),new ai(0,0,1),new ai(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Ah.setFromMatrixPosition(e.matrixWorld),n.position.copy(Ah),Lh.copy(n.position),Lh.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Lh),n.updateMatrixWorld(),i.makeTranslation(-Ah.x,-Ah.y,-Ah.z),Th.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Th)}}Ch.prototype.isPointLightShadow=!0;class Ph extends yh{constructor(e,t,n=0,i=1){super(e,t),this.type=\"PointLight\",this.distance=n,this.decay=i,this.shadow=new Ch}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}Ph.prototype.isPointLight=!0;class Rh extends Po{constructor(e=-1,t=1,n=1,i=-1,r=.1,o=2e3){super(),this.type=\"OrthographicCamera\",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,s=i+t,a=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,o=r+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}Rh.prototype.isOrthographicCamera=!0;class Dh extends Mh{constructor(){super(new Rh(-5,5,5,-5,.5,500))}}Dh.prototype.isDirectionalLightShadow=!0;class Ih extends yh{constructor(e,t){super(e,t),this.type=\"DirectionalLight\",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.target=new cr,this.shadow=new Dh}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Ih.prototype.isDirectionalLight=!0;class Oh extends yh{constructor(e,t){super(e,t),this.type=\"AmbientLight\"}}Oh.prototype.isAmbientLight=!0;class Fh extends yh{constructor(e,t,n=10,i=10){super(e,t),this.type=\"RectAreaLight\",this.width=n,this.height=i}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}Fh.prototype.isRectAreaLight=!0;class Nh{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ai)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*i*1.092548),t.addScaledVector(o[5],i*r*1.092548),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],n*r*1.092548),t.addScaledVector(o[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*i),t.addScaledVector(o[2],1.023328*r),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*i),t.addScaledVector(o[5],.858086*i*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],.858086*n*r),t.addScaledVector(o[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}Nh.prototype.isSphericalHarmonics3=!0;class zh extends yh{constructor(e=new Nh,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}zh.prototype.isLightProbe=!0;class Uh extends Gu{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,o=new Vu(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn(\"THREE.MaterialLoader: Undefined texture\",e),t[e]}const i=new bu[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=(new Ir).setHex(e.sheen)),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.morphTargets&&(i.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(i.morphNormals=e.morphNormals),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.vertexTangents&&(i.vertexTangents=e.vertexTangents),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&(\"number\"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const r=e.uniforms[t];switch(i.uniforms[t]={},r.type){case\"t\":i.uniforms[t].value=n(r.value);break;case\"c\":i.uniforms[t].value=(new Ir).setHex(r.value);break;case\"v2\":i.uniforms[t].value=(new Zn).fromArray(r.value);break;case\"v3\":i.uniforms[t].value=(new ai).fromArray(r.value);break;case\"v4\":i.uniforms[t].value=(new ni).fromArray(r.value);break;case\"m3\":i.uniforms[t].value=(new Jn).fromArray(r.value);break;case\"m4\":i.uniforms[t].value=(new Ui).fromArray(r.value);break;default:i.uniforms[t].value=r.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)i.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new Zn).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Zn).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),i}setTextures(e){return this.textures=e,this}}class Bh{static decodeText(e){if(\"undefined\"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t=\"\";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf(\"/\");return-1===t?\"./\":e.substr(0,t+1)}}class Gh extends ro{constructor(){super(),this.type=\"InstancedBufferGeometry\",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}Gh.prototype.isInstancedBufferGeometry=!0;class kh extends zr{constructor(e,t,n,i){\"number\"==typeof n&&(i=n,n=!1,console.error(\"THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.\")),super(e,t,n),this.meshPerAttribute=i||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}kh.prototype.isInstancedBufferAttribute=!0;class Vh extends Gu{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new Vu(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t={},n={};function i(e,i){if(void 0!==t[i])return t[i];const r=e.interleavedBuffers[i],o=function(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers[t],r=new Uint32Array(i).buffer;return n[t]=r,r}(e,r.buffer),s=Jr(r.type,o),a=new sl(s,r.stride);return a.uuid=r.uuid,t[i]=a,a}const r=e.isInstancedBufferGeometry?new Gh:new ro,o=e.data.index;if(void 0!==o){const e=Jr(o.type,o.array);r.setIndex(new zr(e,1))}const s=e.data.attributes;for(const t in s){const n=s[t];let o;if(n.isInterleavedBufferAttribute){const t=i(e.data,n.data);o=new ll(t,n.itemSize,n.offset,n.normalized)}else{const e=Jr(n.type,n.array);o=new(n.isInstancedBufferAttribute?kh:zr)(e,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),void 0!==n.usage&&o.setUsage(n.usage),void 0!==n.updateRange&&(o.updateRange.offset=n.updateRange.offset,o.updateRange.count=n.updateRange.count),r.setAttribute(t,o)}const a=e.data.morphAttributes;if(a)for(const t in a){const n=a[t],o=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];let s;if(r.isInterleavedBufferAttribute){const t=i(e.data,r.data);s=new ll(t,r.itemSize,r.offset,r.normalized)}else{const e=Jr(r.type,r.array);s=new zr(e,r.itemSize,r.normalized)}void 0!==r.name&&(s.name=r.name),o.push(s)}r.morphAttributes[t]=o}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];r.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new ai;void 0!==c.center&&e.fromArray(c.center),r.boundingSphere=new Ci(e,c.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class Hh extends Gu{constructor(e){super(e)}load(e,t,n,i){const r=this,o=\"\"===this.path?Bh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const s=new Vu(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){let o=null;try{o=JSON.parse(n)}catch(t){return void 0!==i&&i(t),void console.error(\"THREE:ObjectLoader: Can't parse \"+e+\".\",t.message)}const s=o.metadata;void 0!==s&&void 0!==s.type&&\"geometry\"!==s.type.toLowerCase()?r.parse(o,t):console.error(\"THREE.ObjectLoader: Can't load \"+e)}),n,i)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),o=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),s=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,r,a,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in o)if(o[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new vh).fromJSON(e[n]);t[i.uuid]=i}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(let t=0,r=e.length;t<r;t++){const r=(new Ul).fromJSON(e[t],i);n[r.uuid]=r}return n}parseGeometries(e,t){const n={};let i;if(void 0!==e){const r=new Vh;for(let o=0,s=e.length;o<s;o++){let s;const a=e[o];switch(a.type){case\"PlaneGeometry\":case\"PlaneBufferGeometry\":s=new uu[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case\"BoxGeometry\":case\"BoxBufferGeometry\":s=new uu[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case\"CircleGeometry\":case\"CircleBufferGeometry\":s=new uu[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case\"CylinderGeometry\":case\"CylinderBufferGeometry\":s=new uu[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case\"ConeGeometry\":case\"ConeBufferGeometry\":s=new uu[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case\"SphereGeometry\":case\"SphereBufferGeometry\":s=new uu[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case\"DodecahedronGeometry\":case\"DodecahedronBufferGeometry\":case\"IcosahedronGeometry\":case\"IcosahedronBufferGeometry\":case\"OctahedronGeometry\":case\"OctahedronBufferGeometry\":case\"TetrahedronGeometry\":case\"TetrahedronBufferGeometry\":s=new uu[a.type](a.radius,a.detail);break;case\"RingGeometry\":case\"RingBufferGeometry\":s=new uu[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case\"TorusGeometry\":case\"TorusBufferGeometry\":s=new uu[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case\"TorusKnotGeometry\":case\"TorusKnotBufferGeometry\":s=new uu[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case\"TubeGeometry\":case\"TubeBufferGeometry\":s=new uu[a.type]((new fh[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case\"LatheGeometry\":case\"LatheBufferGeometry\":s=new uu[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case\"PolyhedronGeometry\":case\"PolyhedronBufferGeometry\":s=new uu[a.type](a.vertices,a.indices,a.radius,a.details);break;case\"ShapeGeometry\":case\"ShapeBufferGeometry\":i=[];for(let e=0,n=a.shapes.length;e<n;e++){const n=t[a.shapes[e]];i.push(n)}s=new uu[a.type](i,a.curveSegments);break;case\"ExtrudeGeometry\":case\"ExtrudeBufferGeometry\":i=[];for(let e=0,n=a.shapes.length;e<n;e++){const n=t[a.shapes[e]];i.push(n)}const e=a.options.extrudePath;void 0!==e&&(a.options.extrudePath=(new fh[e.type]).fromJSON(e)),s=new uu[a.type](i,a.options);break;case\"BufferGeometry\":case\"InstancedBufferGeometry\":s=r.parse(a);break;case\"Geometry\":console.error('THREE.ObjectLoader: Loading \"Geometry\" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type \"'+a.type+'\"');continue}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const r=new Uh;r.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];if(\"MultiMaterial\"===o.type){const e=[];for(let t=0;t<o.materials.length;t++){const i=o.materials[t];void 0===n[i.uuid]&&(n[i.uuid]=r.parse(i)),e.push(n[i.uuid])}i[o.uuid]=e}else void 0===n[o.uuid]&&(n[o.uuid]=r.parse(o)),i[o.uuid]=n[o.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const i=e[n],r=Fu.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function o(e){if(\"string\"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),r.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:Jr(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new Uu(t);r=new Wu(n),r.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],r=n.url;if(Array.isArray(r)){i[n.uuid]=[];for(let e=0,t=r.length;e<t;e++){const t=o(r[e]);null!==t&&(t instanceof HTMLImageElement?i[n.uuid].push(t):i[n.uuid].push(new Fl(t.data,t.width,t.height)))}}else{const e=o(n.url);null!==e&&(i[n.uuid]=e)}}}return i}parseTextures(e,t){function n(e,t){return\"number\"==typeof e?e:(console.warn(\"THREE.ObjectLoader.parseTexture: Constant should be in numeric form.\",e),t[e])}const i={};if(void 0!==e)for(let r=0,o=e.length;r<o;r++){const o=e[r];let s;void 0===o.image&&console.warn('THREE.ObjectLoader: No \"image\" specified for',o.uuid),void 0===t[o.image]&&console.warn(\"THREE.ObjectLoader: Undefined image\",o.image);const a=t[o.image];Array.isArray(a)?(s=new Oo(a),6===a.length&&(s.needsUpdate=!0)):(s=a&&a.data?new Fl(a.data,a.width,a.height):new ei(a),a&&(s.needsUpdate=!0)),s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.mapping&&(s.mapping=n(o.mapping,jh)),void 0!==o.offset&&s.offset.fromArray(o.offset),void 0!==o.repeat&&s.repeat.fromArray(o.repeat),void 0!==o.center&&s.center.fromArray(o.center),void 0!==o.rotation&&(s.rotation=o.rotation),void 0!==o.wrap&&(s.wrapS=n(o.wrap[0],Wh),s.wrapT=n(o.wrap[1],Wh)),void 0!==o.format&&(s.format=o.format),void 0!==o.type&&(s.type=o.type),void 0!==o.encoding&&(s.encoding=o.encoding),void 0!==o.minFilter&&(s.minFilter=n(o.minFilter,qh)),void 0!==o.magFilter&&(s.magFilter=n(o.magFilter,qh)),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),void 0!==o.flipY&&(s.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(s.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(s.unpackAlignment=o.unpackAlignment),i[o.uuid]=s}return i}parseObject(e,t,n,i){let r,o,s;function a(e){return void 0===t[e]&&console.warn(\"THREE.ObjectLoader: Undefined geometry\",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];void 0===n[r]&&console.warn(\"THREE.ObjectLoader: Undefined material\",r),t.push(n[r])}return t}return void 0===n[e]&&console.warn(\"THREE.ObjectLoader: Undefined material\",e),n[e]}}switch(e.type){case\"Scene\":r=new ol,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new Ir(e.background)),void 0!==e.fog&&(\"Fog\"===e.fog.type?r.fog=new rl(e.fog.color,e.fog.near,e.fog.far):\"FogExp2\"===e.fog.type&&(r.fog=new il(e.fog.color,e.fog.density)));break;case\"PerspectiveCamera\":r=new Ro(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case\"OrthographicCamera\":r=new Rh(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case\"AmbientLight\":r=new Oh(e.color,e.intensity);break;case\"DirectionalLight\":r=new Ih(e.color,e.intensity);break;case\"PointLight\":r=new Ph(e.color,e.intensity,e.distance,e.decay);break;case\"RectAreaLight\":r=new Fh(e.color,e.intensity,e.width,e.height);break;case\"SpotLight\":r=new Eh(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case\"HemisphereLight\":r=new xh(e.color,e.groundColor,e.intensity);break;case\"LightProbe\":r=(new zh).fromJSON(e);break;case\"SkinnedMesh\":o=a(e.geometry),s=l(e.material),r=new Il(o,s),void 0!==e.bindMode&&(r.bindMode=e.bindMode),void 0!==e.bindMatrix&&r.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(r.skeleton=e.skeleton);break;case\"Mesh\":o=a(e.geometry),s=l(e.material),r=new Mo(o,s);break;case\"InstancedMesh\":o=a(e.geometry),s=l(e.material);const t=e.count,n=e.instanceMatrix,i=e.instanceColor;r=new Hl(o,s,t),r.instanceMatrix=new zr(new Float32Array(n.array),16),void 0!==i&&(r.instanceColor=new zr(new Float32Array(i.array),i.itemSize));break;case\"LOD\":r=new Al;break;case\"Line\":r=new Jl(a(e.geometry),l(e.material));break;case\"LineLoop\":r=new ec(a(e.geometry),l(e.material));break;case\"LineSegments\":r=new Ql(a(e.geometry),l(e.material));break;case\"PointCloud\":case\"Points\":r=new sc(a(e.geometry),l(e.material));break;case\"Sprite\":r=new Ml(l(e.material));break;case\"Group\":r=new Ja;break;case\"Bone\":r=new Ol;break;default:r=new cr}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(r.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children){const o=e.children;for(let e=0;e<o.length;e++)r.add(this.parseObject(o[e],t,n,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];r.animations.push(i[n])}}if(\"LOD\"===e.type){void 0!==e.autoUpdate&&(r.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],i=r.getObjectByProperty(\"uuid\",n.object);void 0!==i&&r.addLevel(i,n.distance)}}return r}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn(\"THREE.ObjectLoader: No skeleton found with UUID:\",e.skeleton):e.bind(n,e.bindMatrix)}}))}setTexturePath(e){return console.warn(\"THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath().\"),this.setResourcePath(e)}}const jh={UVMapping:re,CubeReflectionMapping:oe,CubeRefractionMapping:se,EquirectangularReflectionMapping:ae,EquirectangularRefractionMapping:le,CubeUVReflectionMapping:ce,CubeUVRefractionMapping:ue},Wh={RepeatWrapping:he,ClampToEdgeWrapping:de,MirroredRepeatWrapping:pe},qh={NearestFilter:fe,NearestMipmapNearestFilter:me,NearestMipmapLinearFilter:ve,LinearFilter:xe,LinearMipmapNearestFilter:_e,LinearMipmapLinearFilter:we};class Xh extends Gu{constructor(e){super(e),\"undefined\"==typeof createImageBitmap&&console.warn(\"THREE.ImageBitmapLoader: createImageBitmap() not supported.\"),\"undefined\"==typeof fetch&&console.warn(\"THREE.ImageBitmapLoader: fetch() not supported.\"),this.options={premultiplyAlpha:\"none\"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=\"\"),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=zu.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;const s={};s.credentials=\"anonymous\"===this.crossOrigin?\"same-origin\":\"include\",s.headers=this.requestHeader,fetch(e,s).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:\"none\"}))})).then((function(n){zu.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}Xh.prototype.isImageBitmapLoader=!0;class Yh{constructor(){this.type=\"ShapePath\",this.color=new Ir,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new gh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,o){return this.currentPath.bezierCurveTo(e,t,n,i,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],r=new vh;r.curves=i.curves,t.push(r)}return t}function i(e,t){const n=t.length;let i=!1;for(let r=n-1,o=0;o<n;r=o++){let n=t[r],s=t[o],a=s.x-n.x,l=s.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[o],a=-a,s=t[r],l=-l),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-a*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return i}const r=qc.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);let s,a,l;const c=[];if(1===o.length)return a=o[0],l=new vh,l.curves=a.curves,c.push(l),c;let u=!r(o[0].getPoints());u=e?!u:u;const h=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let t=0,n=o.length;t<n;t++)a=o[t],p=a.getPoints(),s=r(p),s=e?!s:s,s?(!u&&d[g]&&g++,d[g]={s:new vh,p},d[g].s.curves=a.curves,u&&g++,m[g]=[]):m[g].push({h:a,p:p[0]});if(!d[0])return n(o);if(d.length>1){let e=!1;const t=[];for(let e=0,t=d.length;e<t;e++)h[e]=[];for(let n=0,r=d.length;n<r;n++){const r=m[n];for(let o=0;o<r.length;o++){const s=r[o];let a=!0;for(let r=0;r<d.length;r++)i(s.p,d[r].p)&&(n!==r&&t.push({froms:n,tos:r,hole:o}),a?(a=!1,h[r].push(s)):e=!0);a&&h[n].push(s)}}t.length>0&&(e||(m=h))}for(let e=0,t=d.length;e<t;e++){l=d[e].s,c.push(l),f=m[e];for(let e=0,t=f.length;e<t;e++)l.holes.push(f[e].h)}return c}}class Zh{constructor(e){this.type=\"Font\",this.data=e}generateShapes(e,t=100){const n=[],i=function(e,t,n){const i=Array.from(e),r=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,s=[];let a=0,l=0;for(let e=0;e<i.length;e++){const t=i[e];if(\"\\n\"===t)a=0,l-=o;else{const e=Jh(t,r,a,l,n);a+=e.offsetX,s.push(e.path)}}return s}(e,t,this.data);for(let e=0,t=i.length;e<t;e++)Array.prototype.push.apply(n,i[e].toShapes());return n}}function Jh(e,t,n,i,r){const o=r.glyphs[e]||r.glyphs[\"?\"];if(!o)return void console.error('THREE.Font: character \"'+e+'\" does not exists in font family '+r.familyName+\".\");const s=new Yh;let a,l,c,u,h,d,p,f;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(\" \"));for(let r=0,o=e.length;r<o;)switch(e[r++]){case\"m\":a=e[r++]*t+n,l=e[r++]*t+i,s.moveTo(a,l);break;case\"l\":a=e[r++]*t+n,l=e[r++]*t+i,s.lineTo(a,l);break;case\"q\":c=e[r++]*t+n,u=e[r++]*t+i,h=e[r++]*t+n,d=e[r++]*t+i,s.quadraticCurveTo(h,d,c,u);break;case\"b\":c=e[r++]*t+n,u=e[r++]*t+i,h=e[r++]*t+n,d=e[r++]*t+i,p=e[r++]*t+n,f=e[r++]*t+i,s.bezierCurveTo(h,d,p,f,c,u)}}return{offsetX:o.ha*t,path:s}}Zh.prototype.isFont=!0;class $h extends Gu{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new Vu(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,(function(e){let n;try{n=JSON.parse(e)}catch(t){console.warn(\"THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead.\"),n=JSON.parse(e.substring(65,e.length-2))}const i=r.parse(n);t&&t(i)}),n,i)}parse(e){return new Zh(e)}}let Kh;const Qh={getContext:function(){return void 0===Kh&&(Kh=new(window.AudioContext||window.webkitAudioContext)),Kh},setContext:function(e){Kh=e}};class ed extends Gu{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new Vu(this.manager);o.setResponseType(\"arraybuffer\"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{const e=n.slice(0);Qh.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}}class td extends zh{constructor(e,t,n=1){super(void 0,n);const i=(new Ir).set(e),r=(new Ir).set(t),o=new ai(i.r,i.g,i.b),s=new ai(r.r,r.g,r.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(l)}}td.prototype.isHemisphereLightProbe=!0;class nd extends zh{constructor(e,t=1){super(void 0,t);const n=(new Ir).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}nd.prototype.isAmbientLightProbe=!0;const id=new Ui,rd=new Ui;class od{constructor(){this.type=\"StereoCamera\",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ro,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ro,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),i=t.eyeSep/2,r=i*t.near/t.focus,o=t.near*Math.tan(Bn*t.fov*.5)/t.zoom;let s,a;rd.elements[12]=-i,id.elements[12]=i,s=-o*t.aspect+r,a=o*t.aspect+r,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(n),s=-o*t.aspect-r,a=o*t.aspect-r,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(rd),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(id)}}class sd{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=ad(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=ad();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function ad(){return(\"undefined\"==typeof performance?Date:performance).now()}const ld=new ai,cd=new si,ud=new ai,hd=new ai;class dd extends cr{constructor(){super(),this.type=\"AudioListener\",this.context=Qh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new sd}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ld,cd,ud),hd.set(0,0,-1).applyQuaternion(cd),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(ld.x,e),t.positionY.linearRampToValueAtTime(ld.y,e),t.positionZ.linearRampToValueAtTime(ld.z,e),t.forwardX.linearRampToValueAtTime(hd.x,e),t.forwardY.linearRampToValueAtTime(hd.y,e),t.forwardZ.linearRampToValueAtTime(hd.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(ld.x,ld.y,ld.z),t.setOrientation(hd.x,hd.y,hd.z,n.x,n.y,n.z)}}class pd extends cr{constructor(e){super(),this.type=\"Audio\",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType=\"empty\",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType=\"audioNode\",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType=\"mediaNode\",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType=\"mediaStreamNode\",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType=\"buffer\",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn(\"THREE.Audio: Audio is already playing.\");if(!1===this.hasPlaybackControl)return void console.warn(\"THREE.Audio: this Audio has no playback control.\");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn(\"THREE.Audio: this Audio has no playback control.\")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn(\"THREE.Audio: this Audio has no playback control.\")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn(\"THREE.Audio: this Audio has no playback control.\")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn(\"THREE.Audio: this Audio has no playback control.\"),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn(\"THREE.Audio: this Audio has no playback control.\")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const fd=new ai,md=new si,gd=new ai,vd=new ai;class yd extends pd{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel=\"HRTF\",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(fd,md,gd),vd.set(0,0,1).applyQuaternion(md);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(fd.x,e),t.positionY.linearRampToValueAtTime(fd.y,e),t.positionZ.linearRampToValueAtTime(fd.z,e),t.orientationX.linearRampToValueAtTime(vd.x,e),t.orientationY.linearRampToValueAtTime(vd.y,e),t.orientationZ.linearRampToValueAtTime(vd.z,e)}else t.setPosition(fd.x,fd.y,fd.z),t.setOrientation(vd.x,vd.y,vd.z)}}class xd{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class _d{constructor(e,t,n){let i,r,o;switch(this.binding=e,this.valueSize=n,t){case\"quaternion\":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case\"string\":case\"bool\":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==i;++e)n[r+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let e=t,r=t+t;e!==r;++e)if(n[e]!==n[e+t]){s.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let e=n,r=i;e!==r;++e)t[e]=t[i+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)e[t+i]=e[n+i]}_slerp(e,t,n,i){si.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const o=this._workIndex*r;si.multiplyQuaternionsFlat(e,o,e,t,e,n),si.slerpFlat(e,t,e,t,e,o,i)}_lerp(e,t,n,i,r){const o=1-i;for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]*o+e[n+s]*i}}_lerpAdditive(e,t,n,i,r){for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]+e[n+o]*i}}}const bd=\"\\\\[\\\\]\\\\.:\\\\/\",wd=new RegExp(\"[\"+bd+\"]\",\"g\"),Md=\"[^\"+bd+\"]\",Sd=\"[^\"+bd.replace(\"\\\\.\",\"\")+\"]\",Ed=/((?:WC+[\\/:])*)/.source.replace(\"WC\",Md),Td=/(WCOD+)?/.source.replace(\"WCOD\",Sd),Ad=/(?:\\.(WC+)(?:\\[(.+)\\])?)?/.source.replace(\"WC\",Md),Ld=/\\.(WC+)(?:\\[(.+)\\])?/.source.replace(\"WC\",Md),Cd=new RegExp(\"^\"+Ed+Td+Ad+Ld+\"$\"),Pd=[\"material\",\"materials\",\"bones\"];class Rd{constructor(e,t,n){this.path=t,this.parsedPath=n||Rd.parseTrackName(t),this.node=Rd.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Rd.Composite(e,t,n):new Rd(e,t,n)}static sanitizeNodeName(e){return e.replace(/\\s/g,\"_\").replace(wd,\"\")}static parseTrackName(e){const t=Cd.exec(e);if(!t)throw new Error(\"PropertyBinding: Cannot parse trackName: \"+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(\".\");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==Pd.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error(\"PropertyBinding: can not parse propertyName from trackName: \"+e);return n}static findNode(e,t){if(!t||\"\"===t||\".\"===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const o=n(r.children);if(o)return o}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=Rd.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error(\"THREE.PropertyBinding: Trying to update node for track: \"+this.path+\" but it wasn't found.\");if(n){let i=t.objectIndex;switch(n){case\"materials\":if(!e.material)return void console.error(\"THREE.PropertyBinding: Can not bind to material as node does not have a material.\",this);if(!e.material.materials)return void console.error(\"THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.\",this);e=e.material.materials;break;case\"bones\":if(!e.skeleton)return void console.error(\"THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.\",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;default:if(void 0===e[n])return void console.error(\"THREE.PropertyBinding: Can not bind to objectName of node undefined.\",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error(\"THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.\",this,e);e=e[i]}}const o=e[i];if(void 0===o){const n=t.nodeName;return void console.error(\"THREE.PropertyBinding: Trying to update property for track: \"+n+\".\"+i+\" but it wasn't found.\",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if(\"morphTargetInfluences\"===i){if(!e.geometry)return void console.error(\"THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.\",this);if(!e.geometry.isBufferGeometry)return void console.error(\"THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.\",this);if(!e.geometry.morphAttributes)return void console.error(\"THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.\",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Rd.Composite=class{constructor(e,t,n){const i=n||Rd.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Rd.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Rd.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Rd.prototype.GetterByBindingType=[Rd.prototype._getValue_direct,Rd.prototype._getValue_array,Rd.prototype._getValue_arrayElement,Rd.prototype._getValue_toArray],Rd.prototype.SetterByBindingTypeAndVersioning=[[Rd.prototype._setValue_direct,Rd.prototype._setValue_direct_setNeedsUpdate,Rd.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Rd.prototype._setValue_array,Rd.prototype._setValue_array_setNeedsUpdate,Rd.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Rd.prototype._setValue_arrayElement,Rd.prototype._setValue_arrayElement_setNeedsUpdate,Rd.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Rd.prototype._setValue_fromArray,Rd.prototype._setValue_fromArray_setNeedsUpdate,Rd.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Dd{constructor(){this.uuid=kn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length;let s,a=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=t[h];if(void 0===d){d=a++,t[h]=d,e.push(u);for(let e=0,t=o;e!==t;++e)r[e].push(new Rd(u,n[e],i[e]))}else if(d<l){s=e[d];const a=--l,c=e[a];t[c.uuid]=d,e[d]=c,t[h]=a,e[a]=u;for(let e=0,t=o;e!==t;++e){const t=r[e],o=t[a];let s=t[d];t[d]=o,void 0===s&&(s=new Rd(u,n[e],i[e])),t[a]=s}}else e[d]!==s&&console.error(\"THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.\")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,l=t[a];if(void 0!==l&&l>=r){const o=r++,c=e[o];t[c.uuid]=l,e[l]=c,t[a]=o,e[o]=s;for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[o],r=t[l];t[l]=i,t[o]=r}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,o=e.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<r){const s=--r,a=e[s],c=--o,u=e[c];t[a.uuid]=l,e[l]=a,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[s],r=t[c];t[l]=i,t[s]=r,t.pop()}}else{const r=--o,s=e[r];r>0&&(t[s.uuid]=l),e[l]=s,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[l]=t[r],t.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const r=this._bindings;if(void 0!==i)return r[i];const o=this._paths,s=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);i=r.length,n[e]=i,o.push(e),s.push(t),r.push(u);for(let n=c,i=a.length;n!==i;++n){const i=a[n];u[n]=new Rd(i,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,r=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=n,o[n]=a,o.pop(),r[n]=r[s],r.pop(),i[n]=i[s],i.pop()}}}Dd.prototype.isAnimationObjectGroup=!0;class Id{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,o=r.length,s=new Array(o),a={endingStart:Vt,endingEnd:Vt};for(let e=0;e!==o;++e){const t=r[e].createInterpolant(null);s[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=zt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,r=i/n,o=n/i;e.warp(1,r,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=i._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,l=s.sampleValues;return a[0]=r,a[1]=r+n,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;if(i<0||0===n)return;this._startTime=null,t=n*i}t*=this._updateTimeScale(e);const o=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===qt)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulateAdditive(s);else for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulate(i,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const o=n===Ut;if(0===e)return-1===r?i:o&&1==(1&r)?t-i:i;if(n===Nt){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:\"finished\",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:\"finished\",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:\"loop\",action:this,loopDelta:n})}}else this.time=i;if(o&&1==(1&r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=Ht,i.endingEnd=Ht):(i.endingStart=e?this.zeroSlopeAtStart?Ht:Vt:jt,i.endingEnd=t?this.zeroSlopeAtEnd?Ht:Vt:jt)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=r,a[0]=t,s[1]=r+e,a[1]=n,this}}class Od extends Nn{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,o=e._propertyBindings,s=e._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let e=0;e!==r;++e){const r=i[e],l=r.name;let u=c[l];if(void 0!==u)o[e]=u;else{if(u=o[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,l));continue}const i=t&&t._propertyBindings[e].binding.parsedPath;u=new _d(Rd.create(n,l,i),r.ValueTypeName,r.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,l),o[e]=u}s[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let o=r[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,s=o[r],a=s.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[t];void 0===o&&(o={},i[t]=o),o[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,s=o[i],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete s[r],0===Object.keys(s).length&&delete o[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Eu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let o=\"string\"==typeof e?Fu.findByName(i,e):e;const s=null!==o?o.uuid:e,a=this._actionsByClip[s];let l=null;if(void 0===n&&(n=null!==o?o.blendMode:Wt),void 0!==a){const e=a.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=a.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const c=new Id(this,o,t,n);return this._bindAction(c,l),this._addInactiveAction(c,s,r),c}existingAction(e,t){const n=t||this._root,i=n.uuid,r=\"string\"==typeof e?Fu.findByName(n,e):e,o=r?r.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let s=0;s!==n;++s)t[s]._update(i,e,r,o);const s=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)s[e].apply(o);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,o=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,o._cacheIndex=r,t[r]=o,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const i=n[e].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const e in i){const t=i[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}Od.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Fd{constructor(e){\"string\"==typeof e&&(console.warn(\"THREE.Uniform: Type parameter is no longer needed.\"),e=arguments[1]),this.value=e}clone(){return new Fd(void 0===this.value.clone?this.value:this.value.clone())}}class Nd extends sl{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}Nd.prototype.isInstancedInterleavedBuffer=!0;class zd{constructor(e,t,n,i,r){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}zd.prototype.isGLBufferAttribute=!0;class Ud{constructor(e,t,n=0,i=1/0){this.ray=new zi(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new Zi,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error(\"THREE.Raycaster: Unsupported camera type: \"+t.type)}intersectObject(e,t=!1,n=[]){return Gd(e,this,n,t),n.sort(Bd),n}intersectObjects(e,t=!1,n=[]){for(let i=0,r=e.length;i<r;i++)Gd(e[i],this,n,t);return n.sort(Bd),n}}function Bd(e,t){return e.distance-t.distance}function Gd(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){const i=e.children;for(let e=0,r=i.length;e<r;e++)Gd(i[e],t,n,!0)}}class kd{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Vn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Vd{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const Hd=new Zn;class jd{constructor(e=new Zn(1/0,1/0),t=new Zn(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Hd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn(\"THREE.Box2: .getCenter() target is now required\"),e=new Zn),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn(\"THREE.Box2: .getSize() target is now required\"),e=new Zn),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn(\"THREE.Box2: .getParameter() target is now required\"),t=new Zn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn(\"THREE.Box2: .clampPoint() target is now required\"),t=new Zn),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Hd.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}jd.prototype.isBox2=!0;const Wd=new ai,qd=new ai;class Xd{constructor(e=new ai,t=new ai){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return void 0===e&&(console.warn(\"THREE.Line3: .getCenter() target is now required\"),e=new ai),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return void 0===e&&(console.warn(\"THREE.Line3: .delta() target is now required\"),e=new ai),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return void 0===t&&(console.warn(\"THREE.Line3: .at() target is now required\"),t=new ai),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Wd.subVectors(e,this.start),qd.subVectors(this.end,this.start);const n=qd.dot(qd);let i=qd.dot(Wd)/n;return t&&(i=Vn(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn(\"THREE.Line3: .closestPointToPoint() target is now required\"),n=new ai),this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class Yd extends cr{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}Yd.prototype.isImmediateRenderObject=!0;const Zd=new ai;class Jd extends cr{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new ro,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const r=e/n*Math.PI*2,o=t/n*Math.PI*2;i.push(Math.cos(r),Math.sin(r),1,Math.cos(o),Math.sin(o),1)}n.setAttribute(\"position\",new qr(i,3));const r=new jl({fog:!1,toneMapped:!1});this.cone=new Ql(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Zd.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Zd),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const $d=new ai,Kd=new Ui,Qd=new Ui;class ep extends Ql{constructor(e){const t=tp(e),n=new ro,i=[],r=[],o=new Ir(0,0,1),s=new Ir(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(s.r,s.g,s.b))}n.setAttribute(\"position\",new qr(i,3)),n.setAttribute(\"color\",new qr(r,3)),super(n,new jl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type=\"SkeletonHelper\",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute(\"position\");Qd.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const r=t[e];r.parent&&r.parent.isBone&&(Kd.multiplyMatrices(Qd,r.matrixWorld),$d.setFromMatrixPosition(Kd),i.setXYZ(n,$d.x,$d.y,$d.z),Kd.multiplyMatrices(Qd,r.parent.matrixWorld),$d.setFromMatrixPosition(Kd),i.setXYZ(n+1,$d.x,$d.y,$d.z),n+=2)}n.getAttribute(\"position\").needsUpdate=!0,super.updateMatrixWorld(e)}}function tp(e){const t=[];e&&e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,tp(e.children[n]));return t}class np extends Mo{constructor(e,t,n){super(new iu(t,4,2),new Or({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type=\"PointLightHelper\",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const ip=new ai,rp=new Ir,op=new Ir;class sp extends cr{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new Qc(t);i.rotateY(.5*Math.PI),this.material=new Or({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute(\"position\"),o=new Float32Array(3*r.count);i.setAttribute(\"color\",new zr(o,3)),this.add(new Mo(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute(\"color\");rp.copy(this.light.color),op.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const i=e<n/2?rp:op;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(ip.setFromMatrixPosition(this.light.matrixWorld).negate())}}class ap extends Ql{constructor(e=10,t=10,n=4473924,i=8947848){n=new Ir(n),i=new Ir(i);const r=t/2,o=e/t,s=e/2,a=[],l=[];for(let e=0,c=0,u=-s;e<=t;e++,u+=o){a.push(-s,0,u,s,0,u),a.push(u,0,-s,u,0,s);const t=e===r?n:i;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new ro;c.setAttribute(\"position\",new qr(a,3)),c.setAttribute(\"color\",new qr(l,3)),super(c,new jl({vertexColors:!0,toneMapped:!1})),this.type=\"GridHelper\"}}class lp extends Ql{constructor(e=10,t=16,n=8,i=64,r=4473924,o=8947848){r=new Ir(r),o=new Ir(o);const s=[],a=[];for(let n=0;n<=t;n++){const i=n/t*(2*Math.PI),l=Math.sin(i)*e,c=Math.cos(i)*e;s.push(0,0,0),s.push(l,0,c);const u=1&n?r:o;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let t=0;t<=n;t++){const l=1&t?r:o,c=e-e/n*t;for(let e=0;e<i;e++){let t=e/i*(2*Math.PI),n=Math.sin(t)*c,r=Math.cos(t)*c;s.push(n,0,r),a.push(l.r,l.g,l.b),t=(e+1)/i*(2*Math.PI),n=Math.sin(t)*c,r=Math.cos(t)*c,s.push(n,0,r),a.push(l.r,l.g,l.b)}}const l=new ro;l.setAttribute(\"position\",new qr(s,3)),l.setAttribute(\"color\",new qr(a,3)),super(l,new jl({vertexColors:!0,toneMapped:!1})),this.type=\"PolarGridHelper\"}}const cp=new ai,up=new ai,hp=new ai;class dp extends cr{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let i=new ro;i.setAttribute(\"position\",new qr([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new jl({fog:!1,toneMapped:!1});this.lightPlane=new Jl(i,r),this.add(this.lightPlane),i=new ro,i.setAttribute(\"position\",new qr([0,0,0,0,0,1],3)),this.targetLine=new Jl(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){cp.setFromMatrixPosition(this.light.matrixWorld),up.setFromMatrixPosition(this.light.target.matrixWorld),hp.subVectors(up,cp),this.lightPlane.lookAt(up),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(up),this.targetLine.scale.z=hp.length()}}const pp=new ai,fp=new Po;class mp extends Ql{constructor(e){const t=new ro,n=new jl({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={},s=new Ir(16755200),a=new Ir(16711680),l=new Ir(43775),c=new Ir(16777215),u=new Ir(3355443);function h(e,t,n){d(e,n),d(t,n)}function d(e,t){i.push(0,0,0),r.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(i.length/3-1)}h(\"n1\",\"n2\",s),h(\"n2\",\"n4\",s),h(\"n4\",\"n3\",s),h(\"n3\",\"n1\",s),h(\"f1\",\"f2\",s),h(\"f2\",\"f4\",s),h(\"f4\",\"f3\",s),h(\"f3\",\"f1\",s),h(\"n1\",\"f1\",s),h(\"n2\",\"f2\",s),h(\"n3\",\"f3\",s),h(\"n4\",\"f4\",s),h(\"p\",\"n1\",a),h(\"p\",\"n2\",a),h(\"p\",\"n3\",a),h(\"p\",\"n4\",a),h(\"u1\",\"u2\",l),h(\"u2\",\"u3\",l),h(\"u3\",\"u1\",l),h(\"c\",\"t\",c),h(\"p\",\"c\",u),h(\"cn1\",\"cn2\",u),h(\"cn3\",\"cn4\",u),h(\"cf1\",\"cf2\",u),h(\"cf3\",\"cf4\",u),t.setAttribute(\"position\",new qr(i,3)),t.setAttribute(\"color\",new qr(r,3)),super(t,n),this.type=\"CameraHelper\",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const e=this.geometry,t=this.pointMap;fp.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),gp(\"c\",t,e,fp,0,0,-1),gp(\"t\",t,e,fp,0,0,1),gp(\"n1\",t,e,fp,-1,-1,-1),gp(\"n2\",t,e,fp,1,-1,-1),gp(\"n3\",t,e,fp,-1,1,-1),gp(\"n4\",t,e,fp,1,1,-1),gp(\"f1\",t,e,fp,-1,-1,1),gp(\"f2\",t,e,fp,1,-1,1),gp(\"f3\",t,e,fp,-1,1,1),gp(\"f4\",t,e,fp,1,1,1),gp(\"u1\",t,e,fp,.7,1.1,-1),gp(\"u2\",t,e,fp,-.7,1.1,-1),gp(\"u3\",t,e,fp,0,2,-1),gp(\"cf1\",t,e,fp,-1,0,1),gp(\"cf2\",t,e,fp,1,0,1),gp(\"cf3\",t,e,fp,0,-1,1),gp(\"cf4\",t,e,fp,0,1,1),gp(\"cn1\",t,e,fp,-1,0,-1),gp(\"cn2\",t,e,fp,1,0,-1),gp(\"cn3\",t,e,fp,0,-1,-1),gp(\"cn4\",t,e,fp,0,1,-1),e.getAttribute(\"position\").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function gp(e,t,n,i,r,o,s){pp.set(r,o,s).unproject(i);const a=t[e];if(void 0!==a){const e=n.getAttribute(\"position\");for(let t=0,n=a.length;t<n;t++)e.setXYZ(a[t],pp.x,pp.y,pp.z)}}const vp=new ui;class yp extends Ql{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new ro;r.setIndex(new zr(n,1)),r.setAttribute(\"position\",new zr(i,3)),super(r,new jl({color:t,toneMapped:!1})),this.object=e,this.type=\"BoxHelper\",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn(\"THREE.BoxHelper: .update() has no longer arguments.\"),void 0!==this.object&&vp.setFromObject(this.object),vp.isEmpty())return;const t=vp.min,n=vp.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Ql.prototype.copy.call(this,e),this.object=e.object,this}}class xp extends Ql{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new ro;i.setIndex(new zr(n,1)),i.setAttribute(\"position\",new qr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new jl({color:t,toneMapped:!1})),this.box=e,this.type=\"Box3Helper\",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class _p extends Jl{constructor(e,t=1,n=16776960){const i=n,r=new ro;r.setAttribute(\"position\",new qr([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new jl({color:i,toneMapped:!1})),this.type=\"PlaneHelper\",this.plane=e,this.size=t;const o=new ro;o.setAttribute(\"position\",new qr([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Mo(o,new Or({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?m:f,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const bp=new ai;let wp,Mp;class Sp extends cr{constructor(e=new ai(0,0,1),t=new ai(0,0,0),n=1,i=16776960,r=.2*n,o=.2*r){super(),this.type=\"ArrowHelper\",void 0===wp&&(wp=new ro,wp.setAttribute(\"position\",new qr([0,0,0,0,1,0],3)),Mp=new pc(0,.5,1,5,1),Mp.translate(0,-.5,0)),this.position.copy(t),this.line=new Jl(wp,new jl({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mo(Mp,new Or({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{bp.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(bp,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class Ep extends Ql{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new ro;n.setAttribute(\"position\",new qr(t,3)),n.setAttribute(\"color\",new qr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new jl({vertexColors:!0,toneMapped:!1})),this.type=\"AxesHelper\"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Tp=new Float32Array(1),Ap=new Int32Array(Tp.buffer);class Lp{static toHalfFloat(e){Tp[0]=e;const t=Ap[0];let n=t>>16&32768,i=t>>12&2047;const r=t>>23&255;return r<103?n:r>142?(n|=31744,n|=(255==r?0:1)&&8388607&t,n):r<113?(i|=2048,n|=(i>>114-r)+(i>>113-r&1),n):(n|=r-112<<10|i>>1,n+=1&i,n)}}const Cp=Math.pow(2,8),Pp=[.125,.215,.35,.446,.526,.582],Rp=5+Pp.length,Dp={[Jt]:0,[$t]:1,[Qt]:2,[tn]:3,[nn]:4,[rn]:5,[Kt]:6},Ip=new Or({side:m,depthWrite:!1,depthTest:!1}),Op=new Mo(new Eo,Ip),Fp=new Rh,{_lodPlanes:Np,_sizeLods:zp,_sigmas:Up}=Xp(),Bp=new Ir;let Gp=null;const kp=(1+Math.sqrt(5))/2,Vp=1/kp,Hp=[new ai(1,1,1),new ai(-1,1,1),new ai(1,1,-1),new ai(-1,1,-1),new ai(0,kp,Vp),new ai(0,kp,-Vp),new ai(Vp,0,kp),new ai(-Vp,0,kp),new ai(kp,Vp,0),new ai(-kp,Vp,0)];function jp(e){const t=Math.max(e.r,e.g,e.b),n=Math.min(Math.max(Math.ceil(Math.log2(t)),-128),127);return e.multiplyScalar(Math.pow(2,-n)),(n+128)/255}class Wp{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(20),n=new ai(0,1,0);return new du({name:\"SphericalGaussianBlur\",defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:Dp[Jt]},outputEncoding:{value:Dp[Jt]}},vertexShader:\"\\n\\n\\t\\tprecision mediump float;\\n\\t\\tprecision mediump int;\\n\\n\\t\\tattribute vec3 position;\\n\\t\\tattribute vec2 uv;\\n\\t\\tattribute float faceIndex;\\n\\n\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t// RH coordinate system; PMREM face-indexing convention\\n\\t\\tvec3 getDirection( vec2 uv, float face ) {\\n\\n\\t\\t\\tuv = 2.0 * uv - 1.0;\\n\\n\\t\\t\\tvec3 direction = vec3( uv, 1.0 );\\n\\n\\t\\t\\tif ( face == 0.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.zyx; // ( 1, v, u ) pos x\\n\\n\\t\\t\\t} else if ( face == 1.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.xzy;\\n\\t\\t\\t\\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\\n\\n\\t\\t\\t} else if ( face == 2.0 ) {\\n\\n\\t\\t\\t\\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\\n\\n\\t\\t\\t} else if ( face == 3.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.zyx;\\n\\t\\t\\t\\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\\n\\n\\t\\t\\t} else if ( face == 4.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.xzy;\\n\\t\\t\\t\\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\\n\\n\\t\\t\\t} else if ( face == 5.0 ) {\\n\\n\\t\\t\\t\\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\\n\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn direction;\\n\\n\\t\\t}\\n\\n\\t\\tvoid main() {\\n\\n\\t\\t\\tvOutputDirection = getDirection( uv, faceIndex );\\n\\t\\t\\tgl_Position = vec4( position, 1.0 );\\n\\n\\t\\t}\\n\\t\",fragmentShader:\"\\n\\n\\t\\t\\tprecision mediump float;\\n\\t\\t\\tprecision mediump int;\\n\\n\\t\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t\\tuniform sampler2D envMap;\\n\\t\\t\\tuniform int samples;\\n\\t\\t\\tuniform float weights[ n ];\\n\\t\\t\\tuniform bool latitudinal;\\n\\t\\t\\tuniform float dTheta;\\n\\t\\t\\tuniform float mipInt;\\n\\t\\t\\tuniform vec3 poleAxis;\\n\\n\\t\\t\\t\\n\\n\\t\\tuniform int inputEncoding;\\n\\t\\tuniform int outputEncoding;\\n\\n\\t\\t#include <encodings_pars_fragment>\\n\\n\\t\\tvec4 inputTexelToLinear( vec4 value ) {\\n\\n\\t\\t\\tif ( inputEncoding == 0 ) {\\n\\n\\t\\t\\t\\treturn value;\\n\\n\\t\\t\\t} else if ( inputEncoding == 1 ) {\\n\\n\\t\\t\\t\\treturn sRGBToLinear( value );\\n\\n\\t\\t\\t} else if ( inputEncoding == 2 ) {\\n\\n\\t\\t\\t\\treturn RGBEToLinear( value );\\n\\n\\t\\t\\t} else if ( inputEncoding == 3 ) {\\n\\n\\t\\t\\t\\treturn RGBMToLinear( value, 7.0 );\\n\\n\\t\\t\\t} else if ( inputEncoding == 4 ) {\\n\\n\\t\\t\\t\\treturn RGBMToLinear( value, 16.0 );\\n\\n\\t\\t\\t} else if ( inputEncoding == 5 ) {\\n\\n\\t\\t\\t\\treturn RGBDToLinear( value, 256.0 );\\n\\n\\t\\t\\t} else {\\n\\n\\t\\t\\t\\treturn GammaToLinear( value, 2.2 );\\n\\n\\t\\t\\t}\\n\\n\\t\\t}\\n\\n\\t\\tvec4 linearToOutputTexel( vec4 value ) {\\n\\n\\t\\t\\tif ( outputEncoding == 0 ) {\\n\\n\\t\\t\\t\\treturn value;\\n\\n\\t\\t\\t} else if ( outputEncoding == 1 ) {\\n\\n\\t\\t\\t\\treturn LinearTosRGB( value );\\n\\n\\t\\t\\t} else if ( outputEncoding == 2 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBE( value );\\n\\n\\t\\t\\t} else if ( outputEncoding == 3 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBM( value, 7.0 );\\n\\n\\t\\t\\t} else if ( outputEncoding == 4 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBM( value, 16.0 );\\n\\n\\t\\t\\t} else if ( outputEncoding == 5 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBD( value, 256.0 );\\n\\n\\t\\t\\t} else {\\n\\n\\t\\t\\t\\treturn LinearToGamma( value, 2.2 );\\n\\n\\t\\t\\t}\\n\\n\\t\\t}\\n\\n\\t\\tvec4 envMapTexelToLinear( vec4 color ) {\\n\\n\\t\\t\\treturn inputTexelToLinear( color );\\n\\n\\t\\t}\\n\\t\\n\\n\\t\\t\\t#define ENVMAP_TYPE_CUBE_UV\\n\\t\\t\\t#include <cube_uv_reflection_fragment>\\n\\n\\t\\t\\tvec3 getSample( float theta, vec3 axis ) {\\n\\n\\t\\t\\t\\tfloat cosTheta = cos( theta );\\n\\t\\t\\t\\t// Rodrigues' axis-angle rotation\\n\\t\\t\\t\\tvec3 sampleDirection = vOutputDirection * cosTheta\\n\\t\\t\\t\\t\\t+ cross( axis, vOutputDirection ) * sin( theta )\\n\\t\\t\\t\\t\\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\\n\\n\\t\\t\\t\\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\\n\\n\\t\\t\\t}\\n\\n\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\\n\\n\\t\\t\\t\\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\\n\\n\\t\\t\\t\\t\\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\\n\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\taxis = normalize( axis );\\n\\n\\t\\t\\t\\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\\n\\t\\t\\t\\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\\n\\n\\t\\t\\t\\tfor ( int i = 1; i < n; i++ ) {\\n\\n\\t\\t\\t\\t\\tif ( i >= samples ) {\\n\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tfloat theta = dTheta * float( i );\\n\\t\\t\\t\\t\\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\\n\\t\\t\\t\\t\\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\\n\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tgl_FragColor = linearToOutputTexel( gl_FragColor );\\n\\n\\t\\t\\t}\\n\\t\\t\",blending:x,depthTest:!1,depthWrite:!1})}(),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Gp=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=$p(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Jp(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<Np.length;e++)Np[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Gp),e.scissorTest=!1,Zp(e,0,0,e.width,e.height)}_fromTexture(e){Gp=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:fe,minFilter:fe,generateMipmaps:!1,type:Se,format:ke,encoding:qp(e)?e.encoding:Qt,depthBuffer:!1},n=Yp(t);return n.depthBuffer=!e,this._pingPongRenderTarget=Yp(t),n}_compileMaterial(e){const t=new Mo(Np[0],e);this._renderer.compile(t,Fp)}_sceneToCubeUV(e,t,n,i){const r=new Ro(90,1,t,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.outputEncoding,u=a.toneMapping;a.getClearColor(Bp),a.toneMapping=K,a.outputEncoding=Jt,a.autoClear=!1;let h=!1;const d=e.background;if(d){if(d.isColor){Ip.color.copy(d).convertSRGBToLinear(),e.background=null;const t=jp(Ip.color);Ip.opacity=t,h=!0}}else{Ip.color.copy(Bp).convertSRGBToLinear();const e=jp(Ip.color);Ip.opacity=e,h=!0}for(let t=0;t<6;t++){const n=t%3;0==n?(r.up.set(0,o[t],0),r.lookAt(s[t],0,0)):1==n?(r.up.set(0,0,o[t]),r.lookAt(0,s[t],0)):(r.up.set(0,o[t],0),r.lookAt(0,0,s[t])),Zp(i,n*Cp,t>2?Cp:0,Cp,Cp),a.setRenderTarget(i),h&&a.render(Op,r),a.render(e,r)}a.toneMapping=u,a.outputEncoding=c,a.autoClear=l}_textureToCubeUV(e,t){const n=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=$p()):null==this._equirectShader&&(this._equirectShader=Jp());const i=e.isCubeTexture?this._cubemapShader:this._equirectShader,r=new Mo(Np[0],i),o=i.uniforms;o.envMap.value=e,e.isCubeTexture||o.texelSize.value.set(1/e.image.width,1/e.image.height),o.inputEncoding.value=Dp[e.encoding],o.outputEncoding.value=Dp[t.texture.encoding],Zp(t,0,0,3*Cp,2*Cp),n.setRenderTarget(t),n.render(r,Fp)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<Rp;t++){const n=Math.sqrt(Up[t]*Up[t]-Up[t-1]*Up[t-1]),i=Hp[(t-1)%Hp.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,\"latitudinal\",r),this._halfBlur(o,e,n,n,i,\"longitudinal\",r)}_halfBlur(e,t,n,i,r,o,s){const a=this._renderer,l=this._blurMaterial;\"latitudinal\"!==o&&\"longitudinal\"!==o&&console.error(\"blur direction must be either latitudinal or longitudinal!\");const c=new Mo(Np[i],l),u=l.uniforms,h=zp[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0==e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value=\"latitudinal\"===o,s&&(u.poleAxis.value=s),u.dTheta.value=d,u.mipInt.value=8-n,u.inputEncoding.value=Dp[e.texture.encoding],u.outputEncoding.value=Dp[e.texture.encoding];const v=zp[i];Zp(t,3*Math.max(0,Cp-2*v),(0===i?0:2*Cp)+2*v*(i>4?i-8+4:0),3*v,2*v),a.setRenderTarget(t),a.render(c,Fp)}}function qp(e){return void 0!==e&&e.type===Se&&(e.encoding===Jt||e.encoding===$t||e.encoding===Kt)}function Xp(){const e=[],t=[],n=[];let i=8;for(let r=0;r<Rp;r++){const o=Math.pow(2,i);t.push(o);let s=1/o;r>4?s=Pp[r-8+4-1]:0==r&&(s=0),n.push(s);const a=1/(o-1),l=-a/2,c=1+a/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*h),v=new Float32Array(f*d*h),y=new Float32Array(m*d*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];g.set(i,p*d*e),v.set(u,f*d*e);const r=[e,e,e,e,e,e];y.set(r,m*d*e)}const x=new ro;x.setAttribute(\"position\",new zr(g,p)),x.setAttribute(\"uv\",new zr(v,f)),x.setAttribute(\"faceIndex\",new zr(y,m)),e.push(x),i>4&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function Yp(e){const t=new ii(3*Cp,3*Cp,e);return t.texture.mapping=ce,t.texture.name=\"PMREM.cubeUv\",t.scissorTest=!0,t}function Zp(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function Jp(){const e=new Zn(1,1);return new du({name:\"EquirectangularToCubeUV\",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Dp[Jt]},outputEncoding:{value:Dp[Jt]}},vertexShader:\"\\n\\n\\t\\tprecision mediump float;\\n\\t\\tprecision mediump int;\\n\\n\\t\\tattribute vec3 position;\\n\\t\\tattribute vec2 uv;\\n\\t\\tattribute float faceIndex;\\n\\n\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t// RH coordinate system; PMREM face-indexing convention\\n\\t\\tvec3 getDirection( vec2 uv, float face ) {\\n\\n\\t\\t\\tuv = 2.0 * uv - 1.0;\\n\\n\\t\\t\\tvec3 direction = vec3( uv, 1.0 );\\n\\n\\t\\t\\tif ( face == 0.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.zyx; // ( 1, v, u ) pos x\\n\\n\\t\\t\\t} else if ( face == 1.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.xzy;\\n\\t\\t\\t\\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\\n\\n\\t\\t\\t} else if ( face == 2.0 ) {\\n\\n\\t\\t\\t\\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\\n\\n\\t\\t\\t} else if ( face == 3.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.zyx;\\n\\t\\t\\t\\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\\n\\n\\t\\t\\t} else if ( face == 4.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.xzy;\\n\\t\\t\\t\\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\\n\\n\\t\\t\\t} else if ( face == 5.0 ) {\\n\\n\\t\\t\\t\\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\\n\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn direction;\\n\\n\\t\\t}\\n\\n\\t\\tvoid main() {\\n\\n\\t\\t\\tvOutputDirection = getDirection( uv, faceIndex );\\n\\t\\t\\tgl_Position = vec4( position, 1.0 );\\n\\n\\t\\t}\\n\\t\",fragmentShader:\"\\n\\n\\t\\t\\tprecision mediump float;\\n\\t\\t\\tprecision mediump int;\\n\\n\\t\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t\\tuniform sampler2D envMap;\\n\\t\\t\\tuniform vec2 texelSize;\\n\\n\\t\\t\\t\\n\\n\\t\\tuniform int inputEncoding;\\n\\t\\tuniform int outputEncoding;\\n\\n\\t\\t#include <encodings_pars_fragment>\\n\\n\\t\\tvec4 inputTexelToLinear( vec4 value ) {\\n\\n\\t\\t\\tif ( inputEncoding == 0 ) {\\n\\n\\t\\t\\t\\treturn value;\\n\\n\\t\\t\\t} else if ( inputEncoding == 1 ) {\\n\\n\\t\\t\\t\\treturn sRGBToLinear( value );\\n\\n\\t\\t\\t} else if ( inputEncoding == 2 ) {\\n\\n\\t\\t\\t\\treturn RGBEToLinear( value );\\n\\n\\t\\t\\t} else if ( inputEncoding == 3 ) {\\n\\n\\t\\t\\t\\treturn RGBMToLinear( value, 7.0 );\\n\\n\\t\\t\\t} else if ( inputEncoding == 4 ) {\\n\\n\\t\\t\\t\\treturn RGBMToLinear( value, 16.0 );\\n\\n\\t\\t\\t} else if ( inputEncoding == 5 ) {\\n\\n\\t\\t\\t\\treturn RGBDToLinear( value, 256.0 );\\n\\n\\t\\t\\t} else {\\n\\n\\t\\t\\t\\treturn GammaToLinear( value, 2.2 );\\n\\n\\t\\t\\t}\\n\\n\\t\\t}\\n\\n\\t\\tvec4 linearToOutputTexel( vec4 value ) {\\n\\n\\t\\t\\tif ( outputEncoding == 0 ) {\\n\\n\\t\\t\\t\\treturn value;\\n\\n\\t\\t\\t} else if ( outputEncoding == 1 ) {\\n\\n\\t\\t\\t\\treturn LinearTosRGB( value );\\n\\n\\t\\t\\t} else if ( outputEncoding == 2 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBE( value );\\n\\n\\t\\t\\t} else if ( outputEncoding == 3 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBM( value, 7.0 );\\n\\n\\t\\t\\t} else if ( outputEncoding == 4 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBM( value, 16.0 );\\n\\n\\t\\t\\t} else if ( outputEncoding == 5 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBD( value, 256.0 );\\n\\n\\t\\t\\t} else {\\n\\n\\t\\t\\t\\treturn LinearToGamma( value, 2.2 );\\n\\n\\t\\t\\t}\\n\\n\\t\\t}\\n\\n\\t\\tvec4 envMapTexelToLinear( vec4 color ) {\\n\\n\\t\\t\\treturn inputTexelToLinear( color );\\n\\n\\t\\t}\\n\\t\\n\\n\\t\\t\\t#include <common>\\n\\n\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\\n\\n\\t\\t\\t\\tvec3 outputDirection = normalize( vOutputDirection );\\n\\t\\t\\t\\tvec2 uv = equirectUv( outputDirection );\\n\\n\\t\\t\\t\\tvec2 f = fract( uv / texelSize - 0.5 );\\n\\t\\t\\t\\tuv -= f * texelSize;\\n\\t\\t\\t\\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\\n\\t\\t\\t\\tuv.x += texelSize.x;\\n\\t\\t\\t\\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\\n\\t\\t\\t\\tuv.y += texelSize.y;\\n\\t\\t\\t\\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\\n\\t\\t\\t\\tuv.x -= texelSize.x;\\n\\t\\t\\t\\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\\n\\n\\t\\t\\t\\tvec3 tm = mix( tl, tr, f.x );\\n\\t\\t\\t\\tvec3 bm = mix( bl, br, f.x );\\n\\t\\t\\t\\tgl_FragColor.rgb = mix( tm, bm, f.y );\\n\\n\\t\\t\\t\\tgl_FragColor = linearToOutputTexel( gl_FragColor );\\n\\n\\t\\t\\t}\\n\\t\\t\",blending:x,depthTest:!1,depthWrite:!1})}function $p(){return new du({name:\"CubemapToCubeUV\",uniforms:{envMap:{value:null},inputEncoding:{value:Dp[Jt]},outputEncoding:{value:Dp[Jt]}},vertexShader:\"\\n\\n\\t\\tprecision mediump float;\\n\\t\\tprecision mediump int;\\n\\n\\t\\tattribute vec3 position;\\n\\t\\tattribute vec2 uv;\\n\\t\\tattribute float faceIndex;\\n\\n\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t// RH coordinate system; PMREM face-indexing convention\\n\\t\\tvec3 getDirection( vec2 uv, float face ) {\\n\\n\\t\\t\\tuv = 2.0 * uv - 1.0;\\n\\n\\t\\t\\tvec3 direction = vec3( uv, 1.0 );\\n\\n\\t\\t\\tif ( face == 0.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.zyx; // ( 1, v, u ) pos x\\n\\n\\t\\t\\t} else if ( face == 1.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.xzy;\\n\\t\\t\\t\\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\\n\\n\\t\\t\\t} else if ( face == 2.0 ) {\\n\\n\\t\\t\\t\\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\\n\\n\\t\\t\\t} else if ( face == 3.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.zyx;\\n\\t\\t\\t\\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\\n\\n\\t\\t\\t} else if ( face == 4.0 ) {\\n\\n\\t\\t\\t\\tdirection = direction.xzy;\\n\\t\\t\\t\\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\\n\\n\\t\\t\\t} else if ( face == 5.0 ) {\\n\\n\\t\\t\\t\\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\\n\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn direction;\\n\\n\\t\\t}\\n\\n\\t\\tvoid main() {\\n\\n\\t\\t\\tvOutputDirection = getDirection( uv, faceIndex );\\n\\t\\t\\tgl_Position = vec4( position, 1.0 );\\n\\n\\t\\t}\\n\\t\",fragmentShader:\"\\n\\n\\t\\t\\tprecision mediump float;\\n\\t\\t\\tprecision mediump int;\\n\\n\\t\\t\\tvarying vec3 vOutputDirection;\\n\\n\\t\\t\\tuniform samplerCube envMap;\\n\\n\\t\\t\\t\\n\\n\\t\\tuniform int inputEncoding;\\n\\t\\tuniform int outputEncoding;\\n\\n\\t\\t#include <encodings_pars_fragment>\\n\\n\\t\\tvec4 inputTexelToLinear( vec4 value ) {\\n\\n\\t\\t\\tif ( inputEncoding == 0 ) {\\n\\n\\t\\t\\t\\treturn value;\\n\\n\\t\\t\\t} else if ( inputEncoding == 1 ) {\\n\\n\\t\\t\\t\\treturn sRGBToLinear( value );\\n\\n\\t\\t\\t} else if ( inputEncoding == 2 ) {\\n\\n\\t\\t\\t\\treturn RGBEToLinear( value );\\n\\n\\t\\t\\t} else if ( inputEncoding == 3 ) {\\n\\n\\t\\t\\t\\treturn RGBMToLinear( value, 7.0 );\\n\\n\\t\\t\\t} else if ( inputEncoding == 4 ) {\\n\\n\\t\\t\\t\\treturn RGBMToLinear( value, 16.0 );\\n\\n\\t\\t\\t} else if ( inputEncoding == 5 ) {\\n\\n\\t\\t\\t\\treturn RGBDToLinear( value, 256.0 );\\n\\n\\t\\t\\t} else {\\n\\n\\t\\t\\t\\treturn GammaToLinear( value, 2.2 );\\n\\n\\t\\t\\t}\\n\\n\\t\\t}\\n\\n\\t\\tvec4 linearToOutputTexel( vec4 value ) {\\n\\n\\t\\t\\tif ( outputEncoding == 0 ) {\\n\\n\\t\\t\\t\\treturn value;\\n\\n\\t\\t\\t} else if ( outputEncoding == 1 ) {\\n\\n\\t\\t\\t\\treturn LinearTosRGB( value );\\n\\n\\t\\t\\t} else if ( outputEncoding == 2 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBE( value );\\n\\n\\t\\t\\t} else if ( outputEncoding == 3 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBM( value, 7.0 );\\n\\n\\t\\t\\t} else if ( outputEncoding == 4 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBM( value, 16.0 );\\n\\n\\t\\t\\t} else if ( outputEncoding == 5 ) {\\n\\n\\t\\t\\t\\treturn LinearToRGBD( value, 256.0 );\\n\\n\\t\\t\\t} else {\\n\\n\\t\\t\\t\\treturn LinearToGamma( value, 2.2 );\\n\\n\\t\\t\\t}\\n\\n\\t\\t}\\n\\n\\t\\tvec4 envMapTexelToLinear( vec4 color ) {\\n\\n\\t\\t\\treturn inputTexelToLinear( color );\\n\\n\\t\\t}\\n\\t\\n\\n\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\\n\\t\\t\\t\\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\\n\\t\\t\\t\\tgl_FragColor = linearToOutputTexel( gl_FragColor );\\n\\n\\t\\t\\t}\\n\\t\\t\",blending:x,depthTest:!1,depthWrite:!1})}const Kp=0,Qp=1,ef=0,tf=1,nf=2;function rf(e){return console.warn(\"THREE.MeshFaceMaterial has been removed. Use an Array instead.\"),e}function of(e=[]){return console.warn(\"THREE.MultiMaterial has been removed. Use an Array instead.\"),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function sf(e,t){return console.warn(\"THREE.PointCloud has been renamed to THREE.Points.\"),new sc(e,t)}function af(e){return console.warn(\"THREE.Particle has been renamed to THREE.Sprite.\"),new Ml(e)}function lf(e,t){return console.warn(\"THREE.ParticleSystem has been renamed to THREE.Points.\"),new sc(e,t)}function cf(e){return console.warn(\"THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.\"),new tc(e)}function uf(e){return console.warn(\"THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.\"),new tc(e)}function hf(e){return console.warn(\"THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.\"),new tc(e)}function df(e,t,n){return console.warn(\"THREE.Vertex has been removed. Use THREE.Vector3 instead.\"),new ai(e,t,n)}function pf(e,t){return console.warn(\"THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead.\"),new zr(e,t).setUsage(Tn)}function ff(e,t){return console.warn(\"THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.\"),new Ur(e,t)}function mf(e,t){return console.warn(\"THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.\"),new Br(e,t)}function gf(e,t){return console.warn(\"THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.\"),new Gr(e,t)}function vf(e,t){return console.warn(\"THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.\"),new kr(e,t)}function yf(e,t){return console.warn(\"THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.\"),new Vr(e,t)}function xf(e,t){return console.warn(\"THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.\"),new Hr(e,t)}function _f(e,t){return console.warn(\"THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.\"),new jr(e,t)}function bf(e,t){return console.warn(\"THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.\"),new qr(e,t)}function wf(e,t){return console.warn(\"THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.\"),new Xr(e,t)}function Mf(e){return console.warn(\"THREE.AxisHelper has been renamed to THREE.AxesHelper.\"),new Ep(e)}function Sf(e,t){return console.warn(\"THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.\"),new yp(e,t)}function Ef(e,t){return console.warn(\"THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.\"),new Ql(new bc(e.geometry),new jl({color:void 0!==t?t:16777215}))}function Tf(e,t){return console.warn(\"THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.\"),new Ql(new cu(e.geometry),new jl({color:void 0!==t?t:16777215}))}function Af(e){return console.warn(\"THREE.XHRLoader has been renamed to THREE.FileLoader.\"),new Vu(e)}function Lf(e){return console.warn(\"THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.\"),new Xu(e)}function Cf(e,t,n){return console.warn(\"THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options ).\"),new Fo(e,n)}function Pf(){console.error(\"THREE.CanvasRenderer has been removed\")}function Rf(){console.error(\"THREE.JSONLoader has been removed.\")}Zu.create=function(e,t){return console.log(\"THREE.Curve.create() has been deprecated\"),e.prototype=Object.create(Zu.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},gh.prototype.fromPoints=function(e){return console.warn(\"THREE.Path: .fromPoints() has been renamed to .setFromPoints().\"),this.setFromPoints(e)},ap.prototype.setColors=function(){console.error(\"THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.\")},ep.prototype.update=function(){console.error(\"THREE.SkeletonHelper: update() no longer needs to be called.\")},Gu.prototype.extractUrlBase=function(e){return console.warn(\"THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.\"),Bh.extractUrlBase(e)},Gu.Handlers={add:function(){console.error(\"THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.\")},get:function(){console.error(\"THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.\")}},jd.prototype.center=function(e){return console.warn(\"THREE.Box2: .center() has been renamed to .getCenter().\"),this.getCenter(e)},jd.prototype.empty=function(){return console.warn(\"THREE.Box2: .empty() has been renamed to .isEmpty().\"),this.isEmpty()},jd.prototype.isIntersectionBox=function(e){return console.warn(\"THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().\"),this.intersectsBox(e)},jd.prototype.size=function(e){return console.warn(\"THREE.Box2: .size() has been renamed to .getSize().\"),this.getSize(e)},ui.prototype.center=function(e){return console.warn(\"THREE.Box3: .center() has been renamed to .getCenter().\"),this.getCenter(e)},ui.prototype.empty=function(){return console.warn(\"THREE.Box3: .empty() has been renamed to .isEmpty().\"),this.isEmpty()},ui.prototype.isIntersectionBox=function(e){return console.warn(\"THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().\"),this.intersectsBox(e)},ui.prototype.isIntersectionSphere=function(e){return console.warn(\"THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().\"),this.intersectsSphere(e)},ui.prototype.size=function(e){return console.warn(\"THREE.Box3: .size() has been renamed to .getSize().\"),this.getSize(e)},Ci.prototype.empty=function(){return console.warn(\"THREE.Sphere: .empty() has been renamed to .isEmpty().\"),this.isEmpty()},Uo.prototype.setFromMatrix=function(e){return console.warn(\"THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix().\"),this.setFromProjectionMatrix(e)},Xd.prototype.center=function(e){return console.warn(\"THREE.Line3: .center() has been renamed to .getCenter().\"),this.getCenter(e)},Jn.prototype.flattenToArrayOffset=function(e,t){return console.warn(\"THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.\"),this.toArray(e,t)},Jn.prototype.multiplyVector3=function(e){return console.warn(\"THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.\"),e.applyMatrix3(this)},Jn.prototype.multiplyVector3Array=function(){console.error(\"THREE.Matrix3: .multiplyVector3Array() has been removed.\")},Jn.prototype.applyToBufferAttribute=function(e){return console.warn(\"THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead.\"),e.applyMatrix3(this)},Jn.prototype.applyToVector3Array=function(){console.error(\"THREE.Matrix3: .applyToVector3Array() has been removed.\")},Jn.prototype.getInverse=function(e){return console.warn(\"THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead.\"),this.copy(e).invert()},Ui.prototype.extractPosition=function(e){return console.warn(\"THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().\"),this.copyPosition(e)},Ui.prototype.flattenToArrayOffset=function(e,t){return console.warn(\"THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.\"),this.toArray(e,t)},Ui.prototype.getPosition=function(){return console.warn(\"THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.\"),(new ai).setFromMatrixColumn(this,3)},Ui.prototype.setRotationFromQuaternion=function(e){return console.warn(\"THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().\"),this.makeRotationFromQuaternion(e)},Ui.prototype.multiplyToArray=function(){console.warn(\"THREE.Matrix4: .multiplyToArray() has been removed.\")},Ui.prototype.multiplyVector3=function(e){return console.warn(\"THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.\"),e.applyMatrix4(this)},Ui.prototype.multiplyVector4=function(e){return console.warn(\"THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.\"),e.applyMatrix4(this)},Ui.prototype.multiplyVector3Array=function(){console.error(\"THREE.Matrix4: .multiplyVector3Array() has been removed.\")},Ui.prototype.rotateAxis=function(e){console.warn(\"THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.\"),e.transformDirection(this)},Ui.prototype.crossVector=function(e){return console.warn(\"THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.\"),e.applyMatrix4(this)},Ui.prototype.translate=function(){console.error(\"THREE.Matrix4: .translate() has been removed.\")},Ui.prototype.rotateX=function(){console.error(\"THREE.Matrix4: .rotateX() has been removed.\")},Ui.prototype.rotateY=function(){console.error(\"THREE.Matrix4: .rotateY() has been removed.\")},Ui.prototype.rotateZ=function(){console.error(\"THREE.Matrix4: .rotateZ() has been removed.\")},Ui.prototype.rotateByAxis=function(){console.error(\"THREE.Matrix4: .rotateByAxis() has been removed.\")},Ui.prototype.applyToBufferAttribute=function(e){return console.warn(\"THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead.\"),e.applyMatrix4(this)},Ui.prototype.applyToVector3Array=function(){console.error(\"THREE.Matrix4: .applyToVector3Array() has been removed.\")},Ui.prototype.makeFrustum=function(e,t,n,i,r,o){return console.warn(\"THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.\"),this.makePerspective(e,t,i,n,r,o)},Ui.prototype.getInverse=function(e){return console.warn(\"THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead.\"),this.copy(e).invert()},pr.prototype.isIntersectionLine=function(e){return console.warn(\"THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().\"),this.intersectsLine(e)},si.prototype.multiplyVector3=function(e){return console.warn(\"THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.\"),e.applyQuaternion(this)},si.prototype.inverse=function(){return console.warn(\"THREE.Quaternion: .inverse() has been renamed to invert().\"),this.invert()},zi.prototype.isIntersectionBox=function(e){return console.warn(\"THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().\"),this.intersectsBox(e)},zi.prototype.isIntersectionPlane=function(e){return console.warn(\"THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().\"),this.intersectsPlane(e)},zi.prototype.isIntersectionSphere=function(e){return console.warn(\"THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().\"),this.intersectsSphere(e)},Sr.prototype.area=function(){return console.warn(\"THREE.Triangle: .area() has been renamed to .getArea().\"),this.getArea()},Sr.prototype.barycoordFromPoint=function(e,t){return console.warn(\"THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().\"),this.getBarycoord(e,t)},Sr.prototype.midpoint=function(e){return console.warn(\"THREE.Triangle: .midpoint() has been renamed to .getMidpoint().\"),this.getMidpoint(e)},Sr.prototypenormal=function(e){return console.warn(\"THREE.Triangle: .normal() has been renamed to .getNormal().\"),this.getNormal(e)},Sr.prototype.plane=function(e){return console.warn(\"THREE.Triangle: .plane() has been renamed to .getPlane().\"),this.getPlane(e)},Sr.barycoordFromPoint=function(e,t,n,i,r){return console.warn(\"THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().\"),Sr.getBarycoord(e,t,n,i,r)},Sr.normal=function(e,t,n,i){return console.warn(\"THREE.Triangle: .normal() has been renamed to .getNormal().\"),Sr.getNormal(e,t,n,i)},vh.prototype.extractAllPoints=function(e){return console.warn(\"THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.\"),this.extractPoints(e)},vh.prototype.extrude=function(e){return console.warn(\"THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.\"),new Zc(this,e)},vh.prototype.makeGeometry=function(e){return console.warn(\"THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.\"),new nu(this,e)},Zn.prototype.fromAttribute=function(e,t,n){return console.warn(\"THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().\"),this.fromBufferAttribute(e,t,n)},Zn.prototype.distanceToManhattan=function(e){return console.warn(\"THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().\"),this.manhattanDistanceTo(e)},Zn.prototype.lengthManhattan=function(){return console.warn(\"THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().\"),this.manhattanLength()},ai.prototype.setEulerFromRotationMatrix=function(){console.error(\"THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.\")},ai.prototype.setEulerFromQuaternion=function(){console.error(\"THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.\")},ai.prototype.getPositionFromMatrix=function(e){return console.warn(\"THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().\"),this.setFromMatrixPosition(e)},ai.prototype.getScaleFromMatrix=function(e){return console.warn(\"THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().\"),this.setFromMatrixScale(e)},ai.prototype.getColumnFromMatrix=function(e,t){return console.warn(\"THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().\"),this.setFromMatrixColumn(t,e)},ai.prototype.applyProjection=function(e){return console.warn(\"THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.\"),this.applyMatrix4(e)},ai.prototype.fromAttribute=function(e,t,n){return console.warn(\"THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().\"),this.fromBufferAttribute(e,t,n)},ai.prototype.distanceToManhattan=function(e){return console.warn(\"THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().\"),this.manhattanDistanceTo(e)},ai.prototype.lengthManhattan=function(){return console.warn(\"THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().\"),this.manhattanLength()},ni.prototype.fromAttribute=function(e,t,n){return console.warn(\"THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().\"),this.fromBufferAttribute(e,t,n)},ni.prototype.lengthManhattan=function(){return console.warn(\"THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().\"),this.manhattanLength()},cr.prototype.getChildByName=function(e){return console.warn(\"THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().\"),this.getObjectByName(e)},cr.prototype.renderDepth=function(){console.warn(\"THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.\")},cr.prototype.translate=function(e,t){return console.warn(\"THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.\"),this.translateOnAxis(t,e)},cr.prototype.getWorldRotation=function(){console.error(\"THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.\")},cr.prototype.applyMatrix=function(e){return console.warn(\"THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4().\"),this.applyMatrix4(e)},Object.defineProperties(cr.prototype,{eulerOrder:{get:function(){return console.warn(\"THREE.Object3D: .eulerOrder is now .rotation.order.\"),this.rotation.order},set:function(e){console.warn(\"THREE.Object3D: .eulerOrder is now .rotation.order.\"),this.rotation.order=e}},useQuaternion:{get:function(){console.warn(\"THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.\")},set:function(){console.warn(\"THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.\")}}}),Mo.prototype.setDrawMode=function(){console.error(\"THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.\")},Object.defineProperties(Mo.prototype,{drawMode:{get:function(){return console.error(\"THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode.\"),Xt},set:function(){console.error(\"THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.\")}}}),Il.prototype.initBones=function(){console.error(\"THREE.SkinnedMesh: initBones() has been removed.\")},Ro.prototype.setLens=function(e,t){console.warn(\"THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.\"),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(yh.prototype,{onlyShadow:{set:function(){console.warn(\"THREE.Light: .onlyShadow has been removed.\")}},shadowCameraFov:{set:function(e){console.warn(\"THREE.Light: .shadowCameraFov is now .shadow.camera.fov.\"),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn(\"THREE.Light: .shadowCameraLeft is now .shadow.camera.left.\"),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn(\"THREE.Light: .shadowCameraRight is now .shadow.camera.right.\"),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn(\"THREE.Light: .shadowCameraTop is now .shadow.camera.top.\"),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn(\"THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.\"),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn(\"THREE.Light: .shadowCameraNear is now .shadow.camera.near.\"),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn(\"THREE.Light: .shadowCameraFar is now .shadow.camera.far.\"),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn(\"THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.\")}},shadowBias:{set:function(e){console.warn(\"THREE.Light: .shadowBias is now .shadow.bias.\"),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn(\"THREE.Light: .shadowDarkness has been removed.\")}},shadowMapWidth:{set:function(e){console.warn(\"THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.\"),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn(\"THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.\"),this.shadow.mapSize.height=e}}}),Object.defineProperties(zr.prototype,{length:{get:function(){return console.warn(\"THREE.BufferAttribute: .length has been deprecated. Use .count instead.\"),this.array.length}},dynamic:{get:function(){return console.warn(\"THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.\"),this.usage===Tn},set:function(){console.warn(\"THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.\"),this.setUsage(Tn)}}}),zr.prototype.setDynamic=function(e){return console.warn(\"THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead.\"),this.setUsage(!0===e?Tn:En),this},zr.prototype.copyIndicesArray=function(){console.error(\"THREE.BufferAttribute: .copyIndicesArray() has been removed.\")},zr.prototype.setArray=function(){console.error(\"THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers\")},ro.prototype.addIndex=function(e){console.warn(\"THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().\"),this.setIndex(e)},ro.prototype.addAttribute=function(e,t){return console.warn(\"THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute().\"),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?\"index\"===e?(console.warn(\"THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.\"),this.setIndex(t),this):this.setAttribute(e,t):(console.warn(\"THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).\"),this.setAttribute(e,new zr(arguments[1],arguments[2])))},ro.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn(\"THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.\"),console.warn(\"THREE.BufferGeometry: .addDrawCall() is now .addGroup().\"),this.addGroup(e,t)},ro.prototype.clearDrawCalls=function(){console.warn(\"THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().\"),this.clearGroups()},ro.prototype.computeOffsets=function(){console.warn(\"THREE.BufferGeometry: .computeOffsets() has been removed.\")},ro.prototype.removeAttribute=function(e){return console.warn(\"THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute().\"),this.deleteAttribute(e)},ro.prototype.applyMatrix=function(e){return console.warn(\"THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4().\"),this.applyMatrix4(e)},Object.defineProperties(ro.prototype,{drawcalls:{get:function(){return console.error(\"THREE.BufferGeometry: .drawcalls has been renamed to .groups.\"),this.groups}},offsets:{get:function(){return console.warn(\"THREE.BufferGeometry: .offsets has been renamed to .groups.\"),this.groups}}}),sl.prototype.setDynamic=function(e){return console.warn(\"THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead.\"),this.setUsage(!0===e?Tn:En),this},sl.prototype.setArray=function(){console.error(\"THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers\")},Zc.prototype.getArrays=function(){console.error(\"THREE.ExtrudeGeometry: .getArrays() has been removed.\")},Zc.prototype.addShapeList=function(){console.error(\"THREE.ExtrudeGeometry: .addShapeList() has been removed.\")},Zc.prototype.addShape=function(){console.error(\"THREE.ExtrudeGeometry: .addShape() has been removed.\")},ol.prototype.dispose=function(){console.error(\"THREE.Scene: .dispose() has been removed.\")},Fd.prototype.onUpdate=function(){return console.warn(\"THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.\"),this},Object.defineProperties(Tr.prototype,{wrapAround:{get:function(){console.warn(\"THREE.Material: .wrapAround has been removed.\")},set:function(){console.warn(\"THREE.Material: .wrapAround has been removed.\")}},overdraw:{get:function(){console.warn(\"THREE.Material: .overdraw has been removed.\")},set:function(){console.warn(\"THREE.Material: .overdraw has been removed.\")}},wrapRGB:{get:function(){return console.warn(\"THREE.Material: .wrapRGB has been removed.\"),new Ir}},shading:{get:function(){console.error(\"THREE.\"+this.type+\": .shading has been removed. Use the boolean .flatShading instead.\")},set:function(e){console.warn(\"THREE.\"+this.type+\": .shading has been removed. Use the boolean .flatShading instead.\"),this.flatShading=e===v}},stencilMask:{get:function(){return console.warn(\"THREE.\"+this.type+\": .stencilMask has been removed. Use .stencilFuncMask instead.\"),this.stencilFuncMask},set:function(e){console.warn(\"THREE.\"+this.type+\": .stencilMask has been removed. Use .stencilFuncMask instead.\"),this.stencilFuncMask=e}}}),Object.defineProperties(Co.prototype,{derivatives:{get:function(){return console.warn(\"THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.\"),this.extensions.derivatives},set:function(e){console.warn(\"THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.\"),this.extensions.derivatives=e}}}),tl.prototype.clearTarget=function(e,t,n,i){console.warn(\"THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead.\"),this.setRenderTarget(e),this.clear(t,n,i)},tl.prototype.animate=function(e){console.warn(\"THREE.WebGLRenderer: .animate() is now .setAnimationLoop().\"),this.setAnimationLoop(e)},tl.prototype.getCurrentRenderTarget=function(){return console.warn(\"THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().\"),this.getRenderTarget()},tl.prototype.getMaxAnisotropy=function(){return console.warn(\"THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().\"),this.capabilities.getMaxAnisotropy()},tl.prototype.getPrecision=function(){return console.warn(\"THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.\"),this.capabilities.precision},tl.prototype.resetGLState=function(){return console.warn(\"THREE.WebGLRenderer: .resetGLState() is now .state.reset().\"),this.state.reset()},tl.prototype.supportsFloatTextures=function(){return console.warn(\"THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).\"),this.extensions.get(\"OES_texture_float\")},tl.prototype.supportsHalfFloatTextures=function(){return console.warn(\"THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).\"),this.extensions.get(\"OES_texture_half_float\")},tl.prototype.supportsStandardDerivatives=function(){return console.warn(\"THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).\"),this.extensions.get(\"OES_standard_derivatives\")},tl.prototype.supportsCompressedTextureS3TC=function(){return console.warn(\"THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).\"),this.extensions.get(\"WEBGL_compressed_texture_s3tc\")},tl.prototype.supportsCompressedTexturePVRTC=function(){return console.warn(\"THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).\"),this.extensions.get(\"WEBGL_compressed_texture_pvrtc\")},tl.prototype.supportsBlendMinMax=function(){return console.warn(\"THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).\"),this.extensions.get(\"EXT_blend_minmax\")},tl.prototype.supportsVertexTextures=function(){return console.warn(\"THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.\"),this.capabilities.vertexTextures},tl.prototype.supportsInstancedArrays=function(){return console.warn(\"THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).\"),this.extensions.get(\"ANGLE_instanced_arrays\")},tl.prototype.enableScissorTest=function(e){console.warn(\"THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().\"),this.setScissorTest(e)},tl.prototype.initMaterial=function(){console.warn(\"THREE.WebGLRenderer: .initMaterial() has been removed.\")},tl.prototype.addPrePlugin=function(){console.warn(\"THREE.WebGLRenderer: .addPrePlugin() has been removed.\")},tl.prototype.addPostPlugin=function(){console.warn(\"THREE.WebGLRenderer: .addPostPlugin() has been removed.\")},tl.prototype.updateShadowMap=function(){console.warn(\"THREE.WebGLRenderer: .updateShadowMap() has been removed.\")},tl.prototype.setFaceCulling=function(){console.warn(\"THREE.WebGLRenderer: .setFaceCulling() has been removed.\")},tl.prototype.allocTextureUnit=function(){console.warn(\"THREE.WebGLRenderer: .allocTextureUnit() has been removed.\")},tl.prototype.setTexture=function(){console.warn(\"THREE.WebGLRenderer: .setTexture() has been removed.\")},tl.prototype.setTexture2D=function(){console.warn(\"THREE.WebGLRenderer: .setTexture2D() has been removed.\")},tl.prototype.setTextureCube=function(){console.warn(\"THREE.WebGLRenderer: .setTextureCube() has been removed.\")},tl.prototype.getActiveMipMapLevel=function(){return console.warn(\"THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel().\"),this.getActiveMipmapLevel()},Object.defineProperties(tl.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn(\"THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.\"),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn(\"THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.\"),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn(\"THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.\")},set:function(){console.warn(\"THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.\")}},context:{get:function(){return console.warn(\"THREE.WebGLRenderer: .context has been removed. Use .getContext() instead.\"),this.getContext()}},vr:{get:function(){return console.warn(\"THREE.WebGLRenderer: .vr has been renamed to .xr\"),this.xr}},gammaInput:{get:function(){return console.warn(\"THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.\"),!1},set:function(){console.warn(\"THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.\")}},gammaOutput:{get:function(){return console.warn(\"THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.\"),!1},set:function(e){console.warn(\"THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.\"),this.outputEncoding=!0===e?$t:Jt}},toneMappingWhitePoint:{get:function(){return console.warn(\"THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.\"),1},set:function(){console.warn(\"THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.\")}}}),Object.defineProperties(Wa.prototype,{cullFace:{get:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.\")},set:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.\")}},renderReverseSided:{get:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.\")},set:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.\")}},renderSingleSided:{get:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.\")},set:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.\")}}}),Object.defineProperties(ii.prototype,{wrapS:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.\"),this.texture.wrapS},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.\"),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.\"),this.texture.wrapT},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.\"),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.\"),this.texture.magFilter},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.\"),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.\"),this.texture.minFilter},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.\"),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.\"),this.texture.anisotropy},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.\"),this.texture.anisotropy=e}},offset:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .offset is now .texture.offset.\"),this.texture.offset},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .offset is now .texture.offset.\"),this.texture.offset=e}},repeat:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .repeat is now .texture.repeat.\"),this.texture.repeat},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .repeat is now .texture.repeat.\"),this.texture.repeat=e}},format:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .format is now .texture.format.\"),this.texture.format},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .format is now .texture.format.\"),this.texture.format=e}},type:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .type is now .texture.type.\"),this.texture.type},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .type is now .texture.type.\"),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.\"),this.texture.generateMipmaps},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.\"),this.texture.generateMipmaps=e}}}),pd.prototype.load=function(e){console.warn(\"THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.\");const t=this;return(new ed).load(e,(function(e){t.setBuffer(e)})),this},xd.prototype.getData=function(){return console.warn(\"THREE.AudioAnalyser: .getData() is now .getFrequencyData().\"),this.getFrequencyData()},Io.prototype.updateCubeMap=function(e,t){return console.warn(\"THREE.CubeCamera: .updateCubeMap() is now .update().\"),this.update(e,t)},Io.prototype.clear=function(e,t,n,i){return console.warn(\"THREE.CubeCamera: .clear() is now .renderTarget.clear().\"),this.renderTarget.clear(e,t,n,i)},Kn.crossOrigin=void 0,Kn.loadTexture=function(e,t,n,i){console.warn(\"THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.\");const r=new Yu;r.setCrossOrigin(this.crossOrigin);const o=r.load(e,n,void 0,i);return t&&(o.mapping=t),o},Kn.loadTextureCube=function(e,t,n,i){console.warn(\"THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.\");const r=new qu;r.setCrossOrigin(this.crossOrigin);const o=r.load(e,n,void 0,i);return t&&(o.mapping=t),o},Kn.loadCompressedTexture=function(){console.error(\"THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.\")},Kn.loadCompressedTextureCube=function(){console.error(\"THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.\")};const Df={createMultiMaterialObject:function(){console.error(\"THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js\")},detach:function(){console.error(\"THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js\")},attach:function(){console.error(\"THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js\")}};function If(){console.error(\"THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js\")}\"undefined\"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent(\"register\",{detail:{revision:i}})),\"undefined\"!=typeof window&&(window.__THREE__?console.warn(\"WARNING: Multiple instances of Three.js being imported.\"):window.__THREE__=i)},7769:function(e,t,n){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!(\"get\"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),r(n(5185),t),r(n(6406),t),r(n(6114),t),r(n(8934),t),r(n(1072),t),r(n(7259),t),r(n(8284),t),r(n(1017),t),r(n(1370),t),r(n(1216),t),r(n(8131),t)},8152:function(e,t,n){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!(\"get\"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),r(n(7395),t),r(n(8920),t),r(n(4835),t),r(n(9421),t),r(n(9362),t),r(n(7980),t),r(n(2286),t),r(n(3253),t),r(n(8770),t),r(n(1072),t)},3253:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.scaleHeight=t.getFeatureText=t.getFeatureName=t.getFeatureId=t.getProjectionName=t.getProjection=t.GeometryType=t.getArrayConstructor=void 0;const i=n(2616),r=n(1984),o=n(3561);function s(e,t,n,i,r){var o;let s;if(void 0===t&&(t=\"name\"),n){const n=e.lookup(`${t}:short`);if(\"string\"==typeof n&&n.length>0)return n}if(i){const t=e.lookup(\"iso_code\");if(\"string\"==typeof t&&t.length>0)return t}if(void 0!==r)for(const n of r)if(s=null!==(o=e.lookup(`${t}:${n}`))&&void 0!==o?o:e.lookup(`${t}_${n}`),\"string\"==typeof s&&s.length>0)return s;if(s=e.lookup(t),\"string\"==typeof s)return s}var a;t.getArrayConstructor=function(e){switch(e){case\"float\":return Float32Array;case\"uint8\":return Uint8Array;case\"uint16\":return Uint16Array;case\"uint32\":return Uint32Array;case\"int8\":return Int8Array;case\"int16\":return Int16Array;case\"int32\":return Int32Array}},(a=t.GeometryType||(t.GeometryType={}))[a.Unspecified=0]=\"Unspecified\",a[a.Point=1]=\"Point\",a[a.Line=2]=\"Line\",a[a.SolidLine=3]=\"SolidLine\",a[a.Text=4]=\"Text\",a[a.TextPath=5]=\"TextPath\",a[a.ExtrudedLine=6]=\"ExtrudedLine\",a[a.Polygon=7]=\"Polygon\",a[a.ExtrudedPolygon=8]=\"ExtrudedPolygon\",a[a.Object3D=9]=\"Object3D\",a[a.Other=1e3]=\"Other\",t.getProjection=function(e){switch(e){case\"mercator\":return i.mercatorProjection;case\"webMercator\":return i.webMercatorProjection;case\"sphere\":return i.sphereProjection;case\"normalizedEquirectangular\":return i.normalizedEquirectangularProjection;case\"equirectangular\":return i.equirectangularProjection;default:throw new Error(`Unknown projection ${e}`)}},t.getProjectionName=function(e){if(e===i.mercatorProjection)return\"mercator\";if(e===i.webMercatorProjection)return\"webMercator\";if(e===i.sphereProjection)return\"sphere\";if(e===i.normalizedEquirectangularProjection)return\"normalizedEquirectangular\";if(e===i.equirectangularProjection)return\"equirectangular\";throw new Error(\"Unknown projection\")},t.getFeatureId=function(e){if(void 0===e)return 0;if(\"string\"==typeof e||\"number\"==typeof e)return e;if(e.hasOwnProperty(\"$id\")){const t=e.$id;if(\"string\"==typeof t||\"number\"==typeof t)return t}return 0},t.getFeatureName=s,t.getFeatureText=function(e,t,n){let i,a;const l=e instanceof r.Env?e:e.env;let c=\"name\";if((0,r.isTextTechnique)(t)||(0,r.isIconTextTechnique)(t)||(0,r.isLineMarkerTechnique)(t)){if(void 0!==t.text)return(0,o.evaluateTechniqueAttr)(e,t.text);if(void 0!==t.label&&(c=(0,o.evaluateTechniqueAttr)(e,t.label),\"string\"!=typeof c))return;i=t.useAbbreviation,a=t.useIsoCode}return s(l,c,i,a,n)},t.scaleHeight=function(e,t,n){return!(0,o.evaluateTechniqueAttr)(e,t.constantHeight,n<12)}},1072:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isFeatureGeometry=void 0,t.isFeatureGeometry=function(e){const t=e.type;return\"Point\"===t||\"MultiPoint\"===t||\"LineString\"===t||\"MultiLineString\"===t||\"Polygon\"===t||\"MultiPolygon\"===t}},6406:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},7980:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},2286:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},6114:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.addPolygonEdges=void 0;const i=n(82),r=new i.Vector2,o=new i.Vector2,s=new i.Vector2,a=new i.Vector2;t.addPolygonEdges=function(e,t,n,i,l,c,u,h){for(let d=0;d<l.length;++d)if(l[d])if(!0===c){const c=t+2*d,p=c+1,f=t+(d+1)%l.length*2,m=f+1;!0===u&&e.push(c,f),e.push(p,m);const g=(0===d?l.length:d)-1;if(l[g])if(void 0!==h){const t=i[d*n],u=i[d*n+1],f=i[(d+1)%l.length*n],m=i[(d+1)%l.length*n+1];r.set(t,u),o.set(f,m),s.set(i[g*n],i[g*n+1]),a.set(r.x,r.y),a.sub(s).normalize().dot(o.sub(r).normalize())<=h&&e.push(c,p)}else e.push(c,p)}else{const n=t+d,i=t+(d+1)%l.length;e.push(n,i)}}},7395:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},8920:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.getPropertyValue=void 0;const i=n(1984),r=n(4342).LoggerManager.instance.create(\"PropertyValue\");t.getPropertyValue=function(e,t,n){try{return(0,i.getPropertyValue)(e,t,n)}catch(t){return r.error(\"failed to evaluate expression\",JSON.stringify(e),\"error\",String(t)),null}}},5185:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.makeDecodedTechnique=t.StyleSetEvaluator=void 0;const i=n(1984),r=n(8023),o=n(8797),s=n(8628),a=n(4342),l=n(5535),c=a.LoggerManager.instance.create(\"StyleSetEvaluator\"),u=l.AttrScope.TechniqueGeometry;class h{classify(e){if(e._whenExpr){const t=this.switchStyle(e);e._whenExpr=e._whenExpr.accept(this,void 0),this._style=t}}visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){return e}visitHasAttributeExpr(e,t){return e}visitMatchExpr(e,t){return e}visitCaseExpr(e,t){return e}visitCallExpr(e,t){if(\"all\"===e.op){const t=e.args.map((t=>t.accept(this,e))).filter((e=>void 0!==e));return new r.CallExpr(e.op,t)}if(t){const t=this.matchVarStringComparison(e);if(t){if(void 0===this._style.layer&&\"$layer\"===t.name)return void(this._style.layer=t.value);if(void 0===this._style._geometryType&&\"$geometryType\"===t.name)return void(this._style._geometryType=t.value)}}return e}visitLookupExpr(e,t){return this.visitCallExpr(e,t)}visitStepExpr(e,t){return e}visitInterpolateExpr(e,t){return e}matchVarStringComparison(e){if(\"==\"===e.op){const t=e.args[0],n=e.args[1];if(t instanceof r.VarExpr&&n instanceof r.StringLiteralExpr)return{name:t.name,value:n.value};if(n instanceof r.VarExpr&&t instanceof r.StringLiteralExpr)return{name:n.name,value:t.value}}}switchStyle(e){const t=this._style;return this._style=e,t}}class d{constructor(e,t){this.key=\"\",this.set(e,t)}set(e,t,n){let i=!1;if(void 0===e){const t=void 0!==n?n.lookup(\"$layer\"):void 0;e=\"string\"==typeof t?t:void 0}if(this.layer!==e&&(this.layer=e,i=!0),void 0===t){const e=void 0!==n?n.lookup(\"$geometryType\"):void 0;t=\"string\"==typeof e?e:void 0}return this.geometryType!==t&&(this.geometryType=t,i=!0),i&&this.updateKey(),this}updateKey(){void 0!==this.layer?void 0!==this.geometryType?this.key=`${this.layer}:${this.geometryType}`:this.key=`${this.layer}:`:void 0!==this.geometryType?this.key=`:${this.geometryType}`:this.key=\"all\",this.cachedStyleSet=void 0}}function p(e){const t={};for(const n in e){if(!e.hasOwnProperty(n))continue;let i=e[n];\"object\"==typeof i&&(i.isVector2||i.isVector3||i.isVector4)&&(i=r.LiteralExpr.fromValue(i)),r.Expr.isExpr(i)&&(i=i.toJSON()),t[n]=i}return t}t.StyleSetEvaluator=class{constructor(e){this.m_options=e,this.styleSet=[],this.m_techniques=[],this.m_exprPool=new o.ExprPool,this.m_cachedResults=new Map,this.m_styleConditionClassifier=new h,this.m_subStyleSetCache=new Map,this.m_areCurrentDefinitionsOverridden=!0,this.m_definitionsContainVerbose=!1,this.m_disabledStyles={byId:new Set,byLayer:new Set},this.m_definitionExprCache=new Map,this.m_tmpOptimizedSubSetKey=new d,this.m_emptyEnv=new i.Env,this.m_featureDependencies=[\"$layer\",\"$geometryType\",\"$zoom\"],this.m_nextArrayBufferId=0,this.m_definitions=this.m_options.definitions;for(const e in this.m_definitions)this.m_definitionsContainVerbose||(this.m_definitionsContainVerbose=(0,i.isVerboseDefinition)(this.m_definitions[e]));this.styleSet=this.m_options.styleSet.map((e=>Object.assign(Object.assign({},e),{_forceCompile:!0}))),function(e){let t=0,n=0;for(const i of e)i._styleSetIndex=n++,void 0!==i.technique&&void 0===i.renderOrder&&(i.renderOrder=t++)}(this.styleSet),this.m_features=this.validateFeatures(this.m_options.features);const t=[];for(const e in this.m_features)this.m_features[e].modes.forEach((e=>{e.extendedDefinitions&&Array.prototype.push.apply(t,Object.keys(e.extendedDefinitions))}));this.m_modesDefinitions=new Set(t),this.setEnabledFeatures(e.enabledFeatures)}setEnabledFeatures(e){this.applyFeaturesAndModes(null!=e?e:this.getFeaturesEnabledByDefault())}getFeaturesEnabledByDefault(){var e;const t=[];if(this.m_features)for(const n in this.m_features){const i=this.m_features[n];i.enabledByDefault&&t.push({feature:n,mode:null===(e=i.modes[0])||void 0===e?void 0:e.name})}return t}applyFeaturesAndModes(e){if(this.m_disabledStyles.byId.clear(),this.m_disabledStyles.byLayer.clear(),this.resetTechniques(),this.m_areCurrentDefinitionsOverridden&&(this.m_definitionsContainVerbose?this.m_currentDefinitions=JSON.parse(JSON.stringify(this.m_definitions)):this.m_currentDefinitions=Object.assign({},this.m_definitions),this.m_areCurrentDefinitionsOverridden=!1),this.m_features)for(const t in this.m_features){const n=this.m_features[t];let i;const r=e.find((e=>e.feature===t));r?(i=n.modes.find((e=>e.name===r.mode)),i||(i=n.modes[0])):i=n.disabledMode,i.disabledLayers&&i.disabledLayers.forEach((e=>{this.m_disabledStyles.byLayer.add(e)})),i.disabledStyleRules&&i.disabledStyleRules.forEach((e=>{this.m_disabledStyles.byId.add(e)})),this.m_currentDefinitions&&(null==i?void 0:i.extendedDefinitions)&&(this.m_areCurrentDefinitionsOverridden=!0,Object.assign(this.m_currentDefinitions,null==i?void 0:i.extendedDefinitions))}this.m_definitionExprCache.clear(),this.m_cachedResults.clear(),this.m_subStyleSetCache.clear(),this.compileStyleSet()}validateFeatures(e){const t={};for(const n in e){const i=e[n];Array.isArray(i.modes)&&0!==i.modes.length&&void 0!==i.disabledMode?t[n]=i:c.error(`The style configuration is invalid. The feature \"${n}\" must be an array, have at least one mode and specify a value for disabledMode property`)}if(Object.keys(t).length>0)return t}isStyleDisabled(e){if(void 0!==this.m_disabledStyles){if(void 0!==e.styleSet&&this.m_disabledStyles.byLayer.has(e.styleSet))return!0;if(void 0!==e.id&&this.m_disabledStyles.byId.has(e.id))return!0}return!1}getMatchingTechniques(e,t,n){if(this.m_previousResult&&this.m_previousEnv&&this.m_featureDependencies.every((t=>{var n;return(null===(n=this.m_previousEnv)||void 0===n?void 0:n.lookup(t))===e.lookup(t)})))return this.m_previousResult;const i=[];this.m_cachedResults.clear();const r=this.m_tmpOptimizedSubSetKey;r.set(t,n,e),this.m_layer=r.layer,this.m_geometryType=r.geometryType,this.m_zoomLevel=e.lookup(\"$zoom\");const o=this.getOptimizedStyleSet(r);for(const t of o)if(this.processStyle(e,t,i))break;return this.m_previousResult=i,this.m_previousEnv=e,i}wantsLayer(e){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,void 0)).length>0}wantsFeature(e,t){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,t)).length>0}resetTechniques(){for(const e of this.m_techniques)e._index=void 0;this.m_techniques.length=0,this.m_previousResult=void 0,this.m_previousEnv=void 0}get techniques(){return this.m_techniques}get decodedTechniques(){return this.m_techniques.map(p)}getOptimizedStyleSet(e){if(void 0!==e.cachedStyleSet)return e.cachedStyleSet;let t=this.m_subStyleSetCache.get(e.key);return void 0!==t?(e.cachedStyleSet=t,t):(t=this.createPreFilteredStyleSet(e),this.m_subStyleSetCache.set(e.key,t),e.cachedStyleSet=t,t)}createPreFilteredStyleSet(e){const{layer:t,geometryType:n}=e;return this.styleSet.filter((e=>!(void 0!==t&&void 0!==e.layer&&e.layer!==t||void 0!==n&&void 0!==e._geometryType&&e._geometryType!==n)))}compileStyleSet(){this.styleSet.forEach((e=>this.compileStyle(e))),this.styleSet.forEach((e=>{this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e.layer,e._geometryType))}))}compileStyle(e){if(this.compileStyleAttributes(e),void 0!==e.when)try{e._whenExpr=Array.isArray(e.when)?r.Expr.fromJSON(e.when,this.m_currentDefinitions,this.m_definitionExprCache):r.Expr.parse(e.when),this.m_styleConditionClassifier.classify(e),void 0!==e._whenExpr&&(e._whenExpr=e._whenExpr.intern(this.m_exprPool));const t=e._whenExpr.dependencies();null==t||t.properties.forEach((e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)})),(0,i.isJsonExpr)(e.minZoomLevel)&&(e._minZoomLevelExpr=r.Expr.fromJSON(e.minZoomLevel,this.m_currentDefinitions,void 0).intern(this.m_exprPool)),(0,i.isJsonExpr)(e.maxZoomLevel)&&(e._maxZoomLevelExpr=r.Expr.fromJSON(e.maxZoomLevel,this.m_currentDefinitions,void 0).intern(this.m_exprPool))}catch(t){c.log(\"failed to evaluate expression\",JSON.stringify(e.when),\"error\",String(t))}}processStyle(e,t,n){if(!this.checkZoomLevel(e,t))return!1;if(this.isStyleDisabled(t))return!1;if(void 0!==this.m_layer&&void 0!==t.layer&&t.layer!==this.m_layer)return!1;if(void 0!==this.m_geometryType&&void 0!==t._geometryType&&t._geometryType!==this.m_geometryType)return!1;if(t._whenExpr)try{if(!t._whenExpr.evaluate(e,r.ExprScope.Condition,this.m_cachedResults))return!1}catch(e){return c.error(`failed to evaluate expression '${JSON.stringify(t.when)}': ${e}`),!1}return void 0!==t.technique&&(\"none\"!==t.technique&&n.push(this.getTechniqueForStyleMatch(e,t)),!0===t.final)}checkZoomLevel(e,t){var n,i;if(void 0===t.minZoomLevel&&void 0===t.maxZoomLevel)return!0;const o=this.m_zoomLevel;if(void 0===o)return!0;if(void 0!==t.minZoomLevel){let i=t.minZoomLevel;if(!1===(null===(n=t._minZoomLevelExpr)||void 0===n?void 0:n.isDynamic()))try{i=t._minZoomLevelExpr.evaluate(e,r.ExprScope.Condition,this.m_cachedResults)}catch(e){c.error(`failed to evaluate expression '${JSON.stringify(t._minZoomLevelExpr)}': ${e}`)}if(\"number\"==typeof i&&o<i)return!1}if(void 0!==t.maxZoomLevel){let n=t.maxZoomLevel;if(!1===(null===(i=t._maxZoomLevelExpr)||void 0===i?void 0:i.isDynamic()))try{n=t._maxZoomLevelExpr.evaluate(e,r.ExprScope.Condition,this.m_cachedResults)}catch(e){c.error(`failed to evaluate expression '${JSON.stringify(t._maxZoomLevelExpr)}': ${e}`)}if(\"number\"==typeof n&&o>=n)return!1}return!0}getTechniqueForStyleMatch(e,t){let n;if(void 0!==t._dynamicTechniques){const i=this.evaluateTechniqueProperties(t,e),r=this.getDynamicTechniqueKey(t,i);n=t._dynamicTechniques.get(r),void 0===n&&(n=this.createTechnique(t,i),t._dynamicTechniques.set(r,n))}else n=t._staticTechnique,void 0===n&&(t._staticTechnique=n=this.createTechnique(t,[]));return void 0===n._index&&(n._index=this.m_techniques.length,this.m_techniques.push(n)),n}getDynamicTechniqueKey(e,t){const n=t.map((([e,t])=>void 0===t?\"U\":\"object\"==typeof t?JSON.stringify(t,((e,t)=>{if(t instanceof ArrayBuffer){let e=t.id;return void 0===e&&(e=t.id=this.m_nextArrayBufferId++),e}return t})):JSON.stringify(t))).join(\":\");return`${e._styleSetIndex}:${n}`}compileStyleAttributes(e){var t;if(!e._forceCompile&&(void 0!==e._dynamicTechniqueAttributes||\"none\"===e.technique))return;e._dynamicTechniqueAttributes=[],e._dynamicFeatureAttributes=[],e._dynamicForwardedAttributes=[],e._staticAttributes=[],e._staticTechnique=void 0,e._dynamicTechniques=void 0;const n=e._dynamicFeatureAttributes,o=e._dynamicTechniqueAttributes,a=e._dynamicForwardedAttributes,h=e._staticAttributes,d=(t,d)=>{if(void 0===d)return;const p=new Set;if((0,i.isJsonExpr)(d)?d=r.Expr.fromJSON(d,this.m_currentDefinitions,this.m_definitionExprCache,p).intern(this.m_exprPool):(0,s.isInterpolatedPropertyDefinition)(d)&&(d=r.Expr.fromJSON((0,s.interpolatedPropertyDefinitionToJsonExpr)(d)).intern(this.m_exprPool)),r.Expr.isExpr(d)){const n=d.dependencies();n.featureState&&(\"enabled\"!==t?c.log(\"feature-state is not supported in this context\"):e._usesFeatureState=!0),0!==n.properties.size||d.isDynamic()||(d=d.evaluate(this.m_emptyEnv))}if(r.Expr.isExpr(d)){const i=function(e,t){var n,i;return\"extruded-polygon\"===e.technique&&\"color\"===t&&!1!==e.vertexColors?u:null!==(i=null===(n=(0,l.getTechniqueAttributeDescriptor)(e.technique,t))||void 0===n?void 0:n.scope)&&void 0!==i?i:u}(e,t),r=d.dependencies();switch(r.properties.forEach((e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)})),i){case l.AttrScope.FeatureGeometry:n.push([t,d]);break;case l.AttrScope.TechniqueGeometry:o.push([t,d]);break;case l.AttrScope.TechniqueRendering:0===r.properties.size?a.push([t,d]):o.push([t,d])}}else null!=d&&h.push([t,d]);for(const t of p.values())if(this.m_modesDefinitions.has(t)){e._forceCompile=!0;break}},p=new Map([[\"category\",\"_category\"]]);e._forceCompile=!1;for(const n in e)e.hasOwnProperty(n)&&(n.startsWith(\"_\")||[\"when\",\"technique\",\"layer\",\"attr\",\"description\"].includes(n)||d(null!==(t=p.get(n))&&void 0!==t?t:n,e[n]));if(void 0!==e.attr)for(const t in e.attr)e.attr.hasOwnProperty(t)&&d(t,e.attr[t]);o.length>0&&(e._dynamicTechniques=new Map)}evaluateTechniqueProperties(e,t){return void 0===e._dynamicTechniqueAttributes?[]:e._dynamicTechniqueAttributes.map((([e,n])=>{try{return[e,n.evaluate(t,r.ExprScope.Value,this.m_cachedResults)]}catch(t){return c.error(`failed to evaluate expression '${n.toJSON()}': ${t}`),[e,null]}}))}createTechnique(e,t){var n,r;const o={};if(o.name=e.technique,void 0!==e._staticAttributes)for(const[t,n]of e._staticAttributes)null!==n&&(o[t]=n);for(const[e,n]of t)null!==n&&(o[e]=n);if(void 0!==e._dynamicFeatureAttributes)for(const[t,n]of e._dynamicFeatureAttributes)o[t]=n;if(void 0!==e._dynamicForwardedAttributes)for(const[t,n]of e._dynamicForwardedAttributes)o[t]=n;return o._index=this.m_techniques.length,o._styleSetIndex=e._styleSetIndex,void 0!==e.styleSet&&(o._styleSet=e.styleSet),void 0!==e._usesFeatureState&&(o._usesFeatureState=e._usesFeatureState),(0,i.setTechniqueRenderOrderOrPriority)(o,null!==(n=this.m_options.priorities)&&void 0!==n?n:[],null!==(r=this.m_options.labelPriorities)&&void 0!==r?r:[]),this.m_techniques.push(o),o}},t.makeDecodedTechnique=p},3561:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.evaluateTechniqueAttr=void 0;const i=n(1984),r=n(8920);t.evaluateTechniqueAttr=function(e,t,n){if(void 0===t)return n;const o=i.Env.isEnv(e)?(0,r.getPropertyValue)(t,e):(0,r.getPropertyValue)(t,e.env,e.cachedExprResults);return null!=o?o:n}},5535:(e,t)=>{\"use strict\";var n;function i(...e){const t={attrDescriptors:{}};for(const n of e)void 0!==n.attrTransparencyColor&&(t.attrTransparencyColor=n.attrTransparencyColor),void 0!==n.attrDescriptors&&(t.attrDescriptors=Object.assign(Object.assign({},t.attrDescriptors),n.attrDescriptors));return t}Object.defineProperty(t,\"__esModule\",{value:!0}),t.getTechniqueAutomaticAttrs=t.getTechniqueAttributeDescriptor=t.getTechniqueDescriptor=t.AttrScope=void 0,function(e){e[e.FeatureGeometry=0]=\"FeatureGeometry\",e[e.TechniqueGeometry=1]=\"TechniqueGeometry\",e[e.TechniqueRendering=2]=\"TechniqueRendering\"}(n=t.AttrScope||(t.AttrScope={}));const r={attrTransparencyColor:\"color\",attrDescriptors:{constantHeight:n.FeatureGeometry,enabled:n.FeatureGeometry,fadeFar:n.TechniqueRendering,fadeNear:n.TechniqueRendering,transparent:{scope:n.TechniqueRendering,automatic:!0},side:{scope:n.TechniqueRendering,automatic:!0}}},o=i(r,{attrDescriptors:{color:{scope:n.TechniqueRendering,automatic:!0},size:{scope:n.TechniqueRendering,automatic:!0},opacity:{scope:n.TechniqueRendering,automatic:!0}}}),s=i(r,o),a=i(r,o),l=i(r,{attrDescriptors:{text:n.FeatureGeometry,label:n.FeatureGeometry,useAbbreviation:n.FeatureGeometry,useIsoCode:n.FeatureGeometry,imageTexture:n.FeatureGeometry,iconColor:n.TechniqueRendering,iconBrightness:n.TechniqueRendering,backgroundColor:n.TechniqueRendering,backgroundSize:n.TechniqueRendering,backgroundOpacity:n.TechniqueRendering,color:n.TechniqueRendering,opacity:n.TechniqueRendering,size:n.TechniqueRendering,priority:n.TechniqueRendering,zOrder:n.TechniqueRendering,margin:n.TechniqueRendering,\"check-margin\":n.TechniqueRendering,\"anchor-point-density\":n.TechniqueRendering}}),c={attrDescriptors:{polygonOffset:{scope:n.TechniqueRendering,automatic:!0},polygonOffsetFactor:{scope:n.TechniqueRendering,automatic:!0},polygonOffsetUnits:{scope:n.TechniqueRendering,automatic:!0},depthTest:{scope:n.TechniqueRendering,automatic:!0},transparent:{scope:n.TechniqueRendering,automatic:!0},opacity:{scope:n.TechniqueRendering,automatic:!0},color:{scope:n.TechniqueRendering,automatic:!0},lineColor:n.TechniqueRendering,lineFadeFar:n.TechniqueRendering,lineFadeNear:n.TechniqueRendering}},u=i(r,c,{attrDescriptors:{lineWidth:n.TechniqueRendering,dashSize:n.TechniqueRendering,gapSize:n.TechniqueRendering,caps:{scope:n.TechniqueRendering,automatic:!0},drawRangeStart:{scope:n.TechniqueRendering,automatic:!0},drawRangeEnd:{scope:n.TechniqueRendering,automatic:!0},dashes:{scope:n.TechniqueRendering,automatic:!0},dashColor:{scope:n.TechniqueRendering,automatic:!0},\"dash-image\":{scope:n.TechniqueRendering,automatic:!0}}}),h=i(r,{attrDescriptors:{color:{scope:n.TechniqueRendering,automatic:!0},opacity:{scope:n.TechniqueRendering,automatic:!0},lineWidth:n.FeatureGeometry}}),d=i(r,c,{attrDescriptors:{wireframe:{scope:n.TechniqueRendering,automatic:!0},color:{scope:n.TechniqueRendering,automatic:!0},opacity:{scope:n.TechniqueRendering,automatic:!0},transparent:{scope:n.TechniqueRendering,automatic:!0},lineWidth:n.TechniqueRendering,map:{scope:n.TechniqueRendering,automatic:!0}}}),p=i(r,{attrDescriptors:{color:{scope:n.TechniqueRendering,automatic:!0},vertexColors:{scope:n.TechniqueRendering,automatic:!0},wireframe:{scope:n.TechniqueRendering,automatic:!0},roughness:{scope:n.TechniqueRendering,automatic:!0},metalness:{scope:n.TechniqueRendering,automatic:!0},alphaTest:{scope:n.TechniqueRendering,automatic:!0},depthTest:{scope:n.TechniqueRendering,automatic:!0},transparent:{scope:n.TechniqueRendering,automatic:!0},opacity:{scope:n.TechniqueRendering,automatic:!0},emissive:{scope:n.TechniqueRendering,automatic:!0},emissiveIntensity:{scope:n.TechniqueRendering,automatic:!0},refractionRatio:{scope:n.TechniqueRendering,automatic:!0},normalMapType:{scope:n.TechniqueRendering,automatic:!0},map:{scope:n.TechniqueRendering,automatic:!0},normalMap:{scope:n.TechniqueRendering,automatic:!0},displacementMap:{scope:n.TechniqueRendering,automatic:!0},roughnessMap:{scope:n.TechniqueRendering,automatic:!0},emissiveMap:{scope:n.TechniqueRendering,automatic:!0},bumpMap:{scope:n.TechniqueRendering,automatic:!0},metalnessMap:{scope:n.TechniqueRendering,automatic:!0},alphaMap:{scope:n.TechniqueRendering,automatic:!0}}}),f={\"extruded-polygon\":i(r,{attrDescriptors:{depthTest:{scope:n.TechniqueRendering,automatic:!0},vertexColors:{scope:n.TechniqueRendering,automatic:!0},opacity:{scope:n.TechniqueRendering,automatic:!0},color:{scope:n.TechniqueRendering,automatic:!0},colorIntensity:{scope:n.TechniqueRendering,automatic:!0},specular:{scope:n.TechniqueRendering,automatic:!0},emissive:{scope:n.TechniqueRendering,automatic:!0},emissiveIntensity:{scope:n.TechniqueRendering,automatic:!0},shininess:{scope:n.TechniqueRendering,automatic:!0},displacementMap:{scope:n.TechniqueRendering,automatic:!0},height:n.FeatureGeometry,floorHeight:n.FeatureGeometry,defaultColor:n.FeatureGeometry,defaultHeight:n.FeatureGeometry,boundaryWalls:n.FeatureGeometry,footprint:n.FeatureGeometry,maxSlope:n.FeatureGeometry,animateExtrusion:n.TechniqueRendering,lineWidth:n.TechniqueRendering,lineFadeNear:n.TechniqueRendering,lineFadeFar:n.TechniqueRendering,lineColor:n.TechniqueRendering}}),\"line-marker\":l,\"labeled-icon\":l,\"solid-line\":u,\"dashed-line\":u,terrain:p,standard:p,squares:s,circles:a,line:h,segments:h,fill:d,text:i(r,{attrDescriptors:{text:n.FeatureGeometry,label:n.FeatureGeometry,useAbbreviation:n.FeatureGeometry,useIsoCode:n.FeatureGeometry,backgroundColor:n.TechniqueRendering,backgroundSize:n.TechniqueRendering,backgroundOpacity:n.TechniqueRendering,color:n.TechniqueRendering,opacity:n.TechniqueRendering,size:n.TechniqueRendering,priority:n.TechniqueRendering,zOrder:n.TechniqueRendering}}),raster:i(r,{attrDescriptors:{brightness:{scope:n.TechniqueRendering,automatic:!0},gamma:{scope:n.TechniqueRendering,automatic:!0}}})};function m(e){return\"string\"!=typeof e&&(e=e.name),f[e]}t.getTechniqueDescriptor=m,t.getTechniqueAttributeDescriptor=function(e,t){const n=m(e),i=null==n?void 0:n.attrDescriptors,r=null==i?void 0:i[t];if(void 0!==typeof r)return\"object\"==typeof r?r:{scope:r}};const g=new Map;t.getTechniqueAutomaticAttrs=function(e){var t;if(\"string\"!=typeof e&&(e=e.name),g.has(e))return g.get(e);const n=[],i=null===(t=m(e))||void 0===t?void 0:t.attrDescriptors;if(void 0===i)return n;for(const e in i){if(!i.hasOwnProperty(e))continue;const t=i[e];void 0!==t&&\"number\"!=typeof t&&!0===t.automatic&&n.push(e)}return g.set(e,n),n}},8934:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ThreeBufferUtils=void 0;const i=n(3253);!function(e){function t(e){if(e instanceof Int8Array)return\"int8\";if(e instanceof Uint8Array)return\"uint8\";if(e instanceof Int16Array)return\"int16\";if(e instanceof Uint16Array)return\"uint16\";if(e instanceof Int32Array)return\"int32\";if(e instanceof Uint32Array)return\"uint32\";if(e instanceof Float32Array)return\"float\";throw new Error(`Unsupported buffer type ${name}`)}function n(e){const n=e.array;return{name:e.name,buffer:n.buffer,type:t(n),itemCount:e.itemSize,normalized:e.normalized}}e.getBufferElementType=t,e.fromThreeBufferAttribute=n,e.fromThreeInterleavedBufferAttribute=function(e){throw new Error(\"Not implemented yet\")},e.fromThreeBufferGeometry=function(e,t){const r=[],o=Object.getOwnPropertyNames(e.attributes);for(const t of o){const i=n(e.attributes[t]);i.name=t,r.push(i)}const s=null!==e.index?n(e.index):void 0;let a=0;if(void 0!==s)a=null===e.index?0:e.index.count;else{const t=e.attributes.position;if(void 0===t)throw new Error(\"Missing position attibute to deduce item count\");a=t.count}return{type:i.GeometryType.Unspecified,vertexAttributes:r,index:s,groups:[{start:0,count:a,technique:t}]}}}(t.ThreeBufferUtils||(t.ThreeBufferUtils={}))},8770:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},9362:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WorkerDecoderProtocol=t.RequestController=void 0,t.RequestController=class{constructor(e=0,t=new AbortController){this.priority=e,this.abortController=t}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}},function(e){let t,n;!function(e){e.Configuration=\"configuration\"}(t=e.DecoderMessageName||(e.DecoderMessageName={})),e.isConfigurationMessage=function(e){return e&&\"string\"==typeof e.service&&\"string\"==typeof e.type&&e.type===t.Configuration},function(e){e.DecodeTileRequest=\"decode-tile-request\",e.TileInfoRequest=\"tile-info-request\"}(n=e.Requests||(e.Requests={})),e.isDecodeTileRequest=function(e){return e&&\"string\"==typeof e.type&&e.type===n.DecodeTileRequest},e.isTileInfoRequest=function(e){return e&&\"string\"==typeof e.type&&e.type===n.TileInfoRequest}}(t.WorkerDecoderProtocol||(t.WorkerDecoderProtocol={}))},4835:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WorkerServiceProtocol=void 0,function(e){let t,n;e.WORKER_SERVICE_MANAGER_SERVICE_ID=\"worker-service-manager\",function(e){e.Initialized=\"initialized\",e.Request=\"request\",e.Response=\"response\"}(t=e.ServiceMessageName||(e.ServiceMessageName={})),e.isInitializedMessage=function(e){return e&&\"string\"==typeof e.service&&\"string\"==typeof e.type&&e.type===t.Initialized},function(e){e.CreateService=\"create-service\",e.DestroyService=\"destroy-service\"}(n=e.Requests||(e.Requests={})),e.isUnknownServiceError=function(e){return e.message.includes(\"unknown targetServiceType requested: \")},e.isRequestMessage=function(e){return e&&\"string\"==typeof e.service&&\"string\"==typeof e.type&&e.type===t.Request},e.isResponseMessage=function(e){return e&&\"string\"==typeof e.service&&\"string\"==typeof e.type&&e.type===t.Response}}(t.WorkerServiceProtocol||(t.WorkerServiceProtocol={}))},9421:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WorkerTilerProtocol=void 0,function(e){let t;!function(e){e.RegisterIndex=\"register-index\",e.UpdateIndex=\"update-index\",e.TileRequest=\"tile-request\"}(t=e.Requests||(e.Requests={})),e.isRegisterIndexRequest=function(e){return e&&\"string\"==typeof e.type&&e.type===t.RegisterIndex},e.isUpdateIndexRequest=function(e){return e&&\"string\"==typeof e.type&&e.type===t.UpdateIndex},e.isTileRequest=function(e){return e&&\"string\"==typeof e.type&&e.type===t.TileRequest}}(t.WorkerTilerProtocol||(t.WorkerTilerProtocol={}))},6112:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.wrapLineString=t.clipLineString=void 0;const i=n(82),r=n(2616),o=n(4342);class s{constructor(e,t,n,r,o){this.isInside=o,this.p0=new i.Vector2(e,t),this.p1=new i.Vector2(n,r)}inside(e){return this.isInside(e)}computeIntersection(e,t){const n=new i.Vector2;return o.Math2D.intersectLines(e.x,e.y,t.x,t.y,this.p0.x,this.p0.y,this.p1.x,this.p1.y,n),n}clipLine(e){const t=e,n=[];e=[],n.push(e);const i=t=>{0!==e.length&&e[e.length-1].equals(t)||e.push(t)};for(let r=0;r<t.length;++r){const o=t[r],s=r>0?t[r-1]:void 0;this.inside(o)?(void 0===s||this.inside(s)||(e.length>0&&(e=[],n.push(e)),i(this.computeIntersection(s,o))),i(o)):void 0!==s&&this.inside(s)&&i(this.computeIntersection(s,o))}return 0===n[n.length-1].length&&(n.length=n.length-1),n}clipLines(e){const t=[];return e.forEach((e=>{this.clipLine(e).forEach((e=>{t.push(e)}))})),t}}function a(e,t,n){for(const n of t)e=n.clipLines(e);const o=new i.Vector3,s=[];return e.forEach((e=>{if(0===e.length)return;const t=e.map((({x:e,y:t})=>{o.set(e,t,0);const i=r.webMercatorProjection.unprojectPoint(o);return i.longitude+=n,i}));s.push(t)})),s.length>0?s:void 0}t.clipLineString=function(e,t,n,i,r){const o=new s(t,n,t,r,(e=>e.x>t)),a=new s(t,r,i,r,(e=>e.y<r)),l=new s(i,r,i,n,(e=>e.x<i)),c=new s(i,n,t,n,(e=>e.y>n));let u=o.clipLine(e);return u=a.clipLines(u),u=l.clipLines(u),u=c.clipLines(u),u},t.wrapLineString=function(e){const t=new i.Vector3,n=[e.map((e=>{const{x:n,y:o}=r.webMercatorProjection.projectPoint(e,t);return new i.Vector2(n,o)}))];return{left:a(n,u,360),middle:a(n,c,0),right:a(n,h,-360)}};const l=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE,c=[new s(0,l,0,0,(e=>e.x>0)),new s(l+0,0,l+0,l,(e=>e.x<l+0))],u=[new s(-l-0,l,-l-0,0,(e=>e.x>-l-0)),new s(0,0,0,l,(e=>e.x<0))],h=[new s(l-0,l,l-0,0,(e=>e.x>l-0)),new s(2*l+0,0,2*l+0,l,(e=>e.x<2*l+0))]},2982:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.clipPolygon=t.ClippingEdge=void 0;const i=n(82);class r{clipPolygon(e,t){const n=e;e=[];const i=t=>{const n=e[e.length-1];(!(null==n?void 0:n.equals(t))||!0===t.isClipped&&!(null==n?void 0:n.isClipped)||!t.isClipped&&!0===(null==n?void 0:n.isClipped))&&e.push(t)};for(let e=0;e<n.length;++e){const r=n[e],o=n[(e+n.length-1)%n.length];if(this.inside(r,t)){if(!this.inside(o,t)){const e=this.computeIntersection(o,r,t);e.isClipped=!0,i(e)}i(r)}else if(this.inside(o,t)){const e=this.computeIntersection(o,r,t);e.isClipped=!0,i(e)}}return e}}t.ClippingEdge=r;const o=[new class extends r{inside(e){return e.y>=0}computeIntersection(e,t){const{x:n,y:r}=e,{x:o,y:s}=t;return new i.Vector2((n*s-r*o)/-(r-s),0).round()}},new class extends r{inside(e,t){return e.x<=t}computeIntersection(e,t,n){const{x:r,y:o}=e,{x:s,y:a}=t;return new i.Vector2(n,(r*a-o*s-(o-a)*-n)/(r-s)).round()}},new class extends r{inside(e,t){return e.y<=t}computeIntersection(e,t,n){const{x:r,y:o}=e,{x:s,y:a}=t;return new i.Vector2((r*a-o*s-(r-s)*n)/-(o-a),n).round()}},new class extends r{inside(e){return e.x>=0}computeIntersection(e,t){const{x:n,y:r}=e,{x:o,y:s}=t;return new i.Vector2(0,(n*s-r*o)/(n-o)).round()}}];t.clipPolygon=function(e,t){if(0===e.length)return e;e[0].equals(e[e.length-1])||(e=[...e,e[0]]);for(const n of o)e=n.clipPolygon(e,t);return e.length<3?[]:e}},6525:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.EdgeLengthGeometrySubdivisionModifier=t.SubdivisionMode=void 0;const i=n(82),r=n(2616),o=n(4342),s=n(3386),a=[new i.Vector3,new i.Vector3];var l;!function(e){e[e.All=0]=\"All\",e[e.NoDiagonals=1]=\"NoDiagonals\"}(l=t.SubdivisionMode||(t.SubdivisionMode={}));class c extends s.SubdivisionModifier{constructor(e,t,n=l.All,i){super(),this.subdivision=e,this.geoBox=t,this.subdivisionMode=n,this.projection=i,(0,o.assert)(i.type===r.ProjectionType.Planar,\"EdgeLengthGeometrySubdivisionModifier only supports planar projections\");const s=i.projectPoint(t.northEast,a[0]),c=i.projectPoint(t.southWest,a[1]);this.m_projectedBox={min:{x:Math.min(s.x,c.x),y:Math.min(s.y,c.y),z:Math.min(s.z,c.z)},max:{x:Math.max(s.x,c.x),y:Math.max(s.y,c.y),z:Math.max(s.z,c.z)}},this.m_maxLengthX=(this.m_projectedBox.max.x-this.m_projectedBox.min.x)/e,this.m_maxLengthY=(this.m_projectedBox.max.y-this.m_projectedBox.min.y)/e,this.subdivisionMode===l.All&&(this.m_maxLengthX*=1.1,this.m_maxLengthY*=1.1),this.m_maxLength=Math.sqrt(this.m_maxLengthX*this.m_maxLengthX+this.m_maxLengthY*this.m_maxLengthY)}get maxLength(){return this.m_maxLength}get maxLengthX(){return this.m_maxLengthX}get maxLengthY(){return this.m_maxLengthY}shouldSplitTriangle(e,t,n){const i=this.shouldSplitEdge(e,t),r=this.shouldSplitEdge(t,n),o=this.shouldSplitEdge(n,e);if(!(i||r||o))return;const s=e.distanceTo(t),a=t.distanceTo(n),l=n.distanceTo(e),c=Math.max(i?s:0,r?a:0,o?l:0);if(s===c)return 0;if(a===c)return 1;if(l===c)return 2;throw new Error(\"Could not split triangle.\")}shouldSplitEdge(e,t){switch(this.subdivisionMode){case l.All:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY||e.distanceTo(t)>this.m_maxLength;case l.NoDiagonals:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY}}}t.EdgeLengthGeometrySubdivisionModifier=c},6189:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.SphericalGeometrySubdivisionModifier=void 0;const i=n(82),r=n(2616),o=n(3386),s=[new i.Vector3,new i.Vector3,new i.Vector3];class a extends o.SubdivisionModifier{constructor(e,t=r.sphereProjection){super(),this.angle=e,this.projection=t}shouldSplitTriangle(e,t,n){const i=r.sphereProjection.reprojectPoint(this.projection,e,s[0]),o=r.sphereProjection.reprojectPoint(this.projection,t,s[1]),a=r.sphereProjection.reprojectPoint(this.projection,n,s[2]),l=i.angleTo(o),c=o.angleTo(a),u=a.angleTo(i),h=Math.max(l,Math.max(c,u));if(!(h<this.angle)){if(h===l)return 0;if(h===c)return 1;if(h===u)return 2;throw new Error(\"failed to split triangle\")}}}t.SphericalGeometrySubdivisionModifier=a},3386:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.SubdivisionModifier=void 0;const i=n(82),r=new i.Vector3,o=new i.Vector3,s=new i.Vector3;t.SubdivisionModifier=class{constructor(){}modify(e){const t=e.getAttribute(\"position\"),n=Array.from(t.array),i=e.getAttribute(\"uv\"),a=void 0!==i?Array.from(i.array):void 0,l=e.getAttribute(\"edge\"),c=void 0!==l?Array.from(l.array):void 0,u=e.getAttribute(\"wall\"),h=void 0!==u?Array.from(u.array):void 0,d=e.getIndex(),p=Array.from(d.array),f=new Map;function m(e,t){const i=`${Math.min(e,t)}_${Math.max(e,t)}`,l=f.get(i);if(void 0!==l)return l;r.set(n[3*e],n[3*e+1],n[3*e+2]),o.set(n[3*t],n[3*t+1],n[3*t+2]),s.lerpVectors(r,o,.5);const u=n.length/3;return n.push(...s.toArray()),f.set(i,u),void 0!==a&&(r.set(a[2*e],a[2*e+1],0),o.set(a[2*t],a[2*t+1],0),s.lerpVectors(r,o,.5),a.push(s.x,s.y)),void 0!==c&&(c[e]===t?(c.push(t),c[e]=u):c[t]===e?(c.push(e),c[t]=u):c.push(-1)),void 0!==h&&(h[e]===t?(h.push(t),h[e]=u):h[t]===e?(h.push(e),h[t]=u):h.push(-1)),u}const g=[];for(;p.length>=3;){const e=p.shift(),t=p.shift(),i=p.shift();switch(r.set(n[3*e],n[3*e+1],n[3*e+2]),o.set(n[3*t],n[3*t+1],n[3*t+2]),s.set(n[3*i],n[3*i+1],n[3*i+2]),this.shouldSplitTriangle(r,o,s)){case 0:{const n=m(e,t);p.push(e,n,i,n,t,i);break}case 1:{const n=m(t,i);p.push(e,t,n,e,n,i);break}case 2:{const n=m(i,e);p.push(e,t,n,n,t,i);break}case void 0:g.push(e,t,i);break;default:throw new Error(\"failed to subdivide the given geometry\")}}return t.array=t.array instanceof Float32Array?new Float32Array(n):new Float64Array(n),t.count=n.length/t.itemSize,t.needsUpdate=!0,e.setIndex(g),void 0!==a&&(i.array=new Float32Array(a),i.count=a.length/i.itemSize,i.needsUpdate=!0),void 0!==c&&(l.array=new Float32Array(c),l.count=c.length/l.itemSize,l.needsUpdate=!0),e}}},2616:function(e,t,n){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!(\"get\"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),r(n(3068),t),r(n(5999),t),r(n(6306),t),r(n(4860),t),r(n(8248),t),r(n(9019),t),r(n(6482),t),r(n(7870),t),r(n(5610),t),r(n(1515),t),r(n(9686),t),r(n(5234),t),r(n(9885),t),r(n(7289),t),r(n(6322),t),r(n(9861),t),r(n(435),t),r(n(9447),t),r(n(7171),t),r(n(3424),t),r(n(4948),t),r(n(6541),t),r(n(7841),t),r(n(2801),t),r(n(6557),t),r(n(4490),t),r(n(2224),t),r(n(1635),t),r(n(1871),t),r(n(2953),t),r(n(1383),t),r(n(9264),t),r(n(58),t),r(n(7523),t),r(n(2683),t),r(n(2334),t)},3068:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoBox=void 0;const i=n(82),r=n(4860);class o{static fromCoordinates(e,t){return new o(e,t)}static fromCenterAndExtents(e,t){return new o(new r.GeoCoordinates(e.latitude-t.latitudeSpan/2,e.longitude-t.longitudeSpan/2),new r.GeoCoordinates(e.latitude+t.latitudeSpan/2,e.longitude+t.longitudeSpan/2))}constructor(e,t){this.southWest=e,this.northEast=t,this.west>this.east&&(this.northEast.longitude+=360)}get minAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)}get maxAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)}get south(){return this.southWest.latitude}get north(){return this.northEast.latitude}get west(){return this.southWest.longitude}get east(){return this.northEast.longitude}get center(){const e=.5*(this.south+this.north),{west:t,east:n}=this,{minAltitude:i,altitudeSpan:o}=this;let s;if(void 0!==i&&void 0!==o&&(s=i+.5*o),t<=n)return new r.GeoCoordinates(e,.5*(t+n),s);let a=.5*(360+n+t);return a>360&&(a-=360),new r.GeoCoordinates(e,a,s)}get latitudeSpanInRadians(){return i.MathUtils.degToRad(this.latitudeSpan)}get longitudeSpanInRadians(){return i.MathUtils.degToRad(this.longitudeSpan)}get latitudeSpan(){return this.north-this.south}get altitudeSpan(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude}get longitudeSpan(){let e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e}get latitudeSpanInDegrees(){return this.latitudeSpan}get longitudeSpanInDegrees(){return this.longitudeSpan}contains(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);const t=this.minAltitude===this.maxAltitude,n=this.minAltitude===e.altitude,i=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!!(t?n:i)&&this.containsHelper(e)}clone(){return new o(this.southWest.clone(),this.northEast.clone())}growToContain(e){this.southWest.latitude=Math.min(this.southWest.latitude,e.latitude),this.southWest.longitude=Math.min(this.southWest.longitude,e.longitude),this.southWest.altitude=void 0!==this.southWest.altitude&&void 0!==e.altitude?Math.min(this.southWest.altitude,e.altitude):void 0!==this.southWest.altitude?this.southWest.altitude:void 0!==e.altitude?e.altitude:void 0,this.northEast.latitude=Math.max(this.northEast.latitude,e.latitude),this.northEast.longitude=Math.max(this.northEast.longitude,e.longitude),this.northEast.altitude=void 0!==this.northEast.altitude&&void 0!==e.altitude?Math.max(this.northEast.altitude,e.altitude):void 0!==this.northEast.altitude?this.northEast.altitude:void 0!==e.altitude?e.altitude:void 0}containsHelper(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;const{west:t,east:n}=this;let i=e.longitude;if(n>r.MAX_LONGITUDE)for(;i<t;)i+=360;if(i>n)for(;i>t+360;)i-=360;return i>=t&&i<n}}t.GeoBox=o},5999:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isGeoBoxExtentLike=void 0,t.isGeoBoxExtentLike=function(e){return e&&\"object\"==typeof e&&\"number\"==typeof e.latitudeSpan&&\"number\"==typeof e.longitudeSpan}},680:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isGeoCoordLike=t.geoCoordLikeToGeoPointLike=t.geoCoordLikeToGeoCoordinatesLike=void 0;const i=n(6306),r=n(8248),o=n(7870);t.geoCoordLikeToGeoCoordinatesLike=function(e){return(0,i.isGeoCoordinatesLike)(e)?e:(0,o.isLatLngLike)(e)?{latitude:e.lat,longitude:e.lng}:{latitude:e[1],longitude:e[0]}},t.geoCoordLikeToGeoPointLike=function(e){return(0,r.isGeoPointLike)(e)?e:(0,o.isLatLngLike)(e)?[e.lng,e.lat]:[e.longitude,e.latitude]},t.isGeoCoordLike=function(e){return(0,i.isGeoCoordinatesLike)(e)||(0,o.isLatLngLike)(e)||!(0,r.isGeoPointLike)(e)}},4860:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoCoordinates=t.MIN_LONGITUDE=t.MAX_LONGITUDE=t.MIN_LATITUDE=t.MAX_LATITUDE=void 0;const i=n(82),r=n(6306),o=n(8248),s=n(7870);t.MAX_LATITUDE=90,t.MIN_LATITUDE=-90,t.MAX_LONGITUDE=180,t.MIN_LONGITUDE=-180;const a=new i.Vector3,l=new i.Vector3;class c{static fromDegrees(e,t,n){return new c(e,t,n)}static fromRadians(e,t,n){return new c(i.MathUtils.radToDeg(e),i.MathUtils.radToDeg(t),n)}static fromLatLng(e){return new c(e.lat,e.lng)}static fromGeoPoint(e){return new c(e[1],e[0],e[2])}static fromObject(e){if((0,o.isGeoPointLike)(e))return c.fromGeoPoint(e);if((0,r.isGeoCoordinatesLike)(e))return c.fromDegrees(e.latitude,e.longitude,e.altitude);if((0,s.isLatLngLike)(e))return c.fromDegrees(e.lat,e.lng);throw new Error(\"Invalid input coordinate format.\")}static lerp(e,t,n,i=!1,r=!1){var o,s;if(i){if(e.lng<t.lng){const i=e.clone();return i.longitude+=360,this.lerp(t,i,1-n)}{const i=t.clone();return i.longitude+=360,this.lerp(e,i,n)}}const u=a.set(e.lat,e.lng,null!==(o=e.altitude)&&void 0!==o?o:0),h=l.set(t.lat,t.lng,null!==(s=t.altitude)&&void 0!==s?s:0);u.lerp(h,n);const d=new c(u.x,u.y,u.z);return r?d.normalized():d}constructor(e,t,n){this.latitude=e,this.longitude=t,this.altitude=n}get latitudeInRadians(){return i.MathUtils.degToRad(this.latitude)}get longitudeInRadians(){return i.MathUtils.degToRad(this.longitude)}get latitudeInDegrees(){return this.latitude}get longitudeInDegrees(){return this.longitude}get lat(){return this.latitude}get lng(){return this.longitude}isValid(){return!isNaN(this.latitude)&&!isNaN(this.longitude)}normalized(){let{latitude:e,longitude:t}=this;return isNaN(e)||isNaN(t)?this:((t<-180||t>180)&&(t=function(e,t){const n=e%360;return n<0==0?n:n+360}(t+180)-180),e=i.MathUtils.clamp(e,-90,90),new c(e,t,this.altitude))}equals(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude}copy(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this}clone(){return new c(this.latitude,this.longitude,this.altitude)}toLatLng(){return{lat:this.latitude,lng:this.longitude}}toGeoPoint(){return void 0!==this.altitude?[this.longitude,this.latitude,this.altitude]:[this.longitude,this.latitude]}minLongitudeSpanTo(e){const t=Math.min(this.longitude,e.longitude),n=Math.max(this.longitude,e.longitude);return Math.min(n-t,360+t-n)}}t.GeoCoordinates=c},6306:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isGeoCoordinatesLike=void 0,t.isGeoCoordinatesLike=function(e){return e&&\"number\"==typeof e.latitude&&\"number\"==typeof e.longitude&&(\"number\"==typeof e.altitude||void 0===e.altitude)}},8248:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isGeoPointLike=void 0,t.isGeoPointLike=function(e){if(Array.isArray(e)){const[t,n,i]=e;return\"number\"==typeof t&&\"number\"==typeof n&&(void 0===i||\"number\"==typeof i)}return!1}},6482:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoPolygon=t.isAntimeridianCrossing=void 0;const i=n(82),r=n(3068),o=n(4860),s=n(680);function a(e,t){return Math.max(e,t)-Math.min(e,t)}function l(e,t){return e>0&&t<0&&a(e,t)>180}t.isAntimeridianCrossing=function(e,t){return Math.sign(e)===-Math.sign(t)&&a(e,t)>180},t.GeoPolygon=class{constructor(e,t=!1,n=!1){this.m_coordinates=e.map((e=>(0,s.geoCoordLikeToGeoCoordinatesLike)(e))),t&&this.sortCCW(),n&&this.wrapCoordinatesAround()}get coordinates(){return this.m_coordinates}getGeoBoundingBox(){const e=this.getCentroid();if(void 0===e)return r.GeoBox.fromCoordinates(this.coordinates[0],this.coordinates[0]);const{east:t,west:n}=this.getEastAndWest(e),{north:i,south:s}=this.getNorthAndSouth();return r.GeoBox.fromCoordinates(new o.GeoCoordinates(s,n),new o.GeoCoordinates(i,t))}getCentroid(){const e=this.getArea();if(0===e)return;let t,n=0,i=0,r=this.m_coordinates.length-1;return this.m_coordinates.forEach(((e,o)=>{const s=this.m_coordinates[r];t=e.latitude*s.longitude-s.latitude*e.longitude,n+=(e.latitude+s.latitude)*t,i+=(e.longitude+s.longitude)*t,r=o})),t=6*e,new o.GeoCoordinates(n/t,e<0?i/t-180:i/t)}sortCCW(){const e=this.getPolyAverageCenter();e&&this.m_coordinates.sort(((t,n)=>{const r=new i.Vector2(t.latitude-e.latitude,t.longitude-e.longitude).normalize();return new i.Vector2(n.latitude-e.latitude,n.longitude-e.longitude).normalize().angle()-r.angle()}))}wrapCoordinatesAround(){const e=this.m_coordinates.findIndex(((e,t)=>{const n=0===t?this.m_coordinates.length-1:t-1;return l(this.m_coordinates[n].longitude,e.longitude)}));if(e<0)return;let t=!0;for(let n=0;n<this.m_coordinates.length;n++){const i=(e+n)%this.m_coordinates.length,r=this.m_coordinates[i].longitude,o=this.m_coordinates[(i+1)%this.m_coordinates.length].longitude;t&&(this.m_coordinates[i].longitude+=360),l(o,r)?t=!1:l(r,o)&&(t=!0)}}getPolyAverageCenter(){const e=this.m_coordinates.reduce(((e,t)=>new o.GeoCoordinates(e.latitude+t.latitude,e.longitude+t.longitude)));return new o.GeoCoordinates(e.latitude/this.m_coordinates.length,e.longitude/this.m_coordinates.length)}getArea(){let e=0,t=this.m_coordinates.length-1;return this.m_coordinates.forEach(((n,i)=>{const r=this.m_coordinates[t];e+=n.latitude*r.longitude,e-=n.longitude*r.latitude,t=i})),e/=2}getEastAndWest(e){let t=e.longitude,n=e.longitude,r=this.m_coordinates.length-1;return this.m_coordinates.forEach(((o,s)=>{const a=this.m_coordinates[r];r=s;const l=new i.Vector2(o.latitude-e.latitude,o.longitude-e.longitude).normalize(),c=new i.Vector2(a.latitude-e.latitude,a.longitude-e.longitude).normalize();let u=1===Math.sign(c.angle()-l.angle());c.y>=0&&l.y<0&&(u=!0);const h=o.longitude;h<e.longitude?u?t=Math.min(t,h):n=Math.min(n,h):u?n=Math.max(n,h):t=Math.max(t,h)})),{east:n,west:t}}getNorthAndSouth(){let e=o.MIN_LATITUDE,t=o.MAX_LATITUDE;return this.m_coordinates.forEach(((n,i)=>{e=Math.max(e,n.latitude),t=Math.min(t,n.latitude)})),{north:e,south:t}}}},9019:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isGeoPolygonLike=void 0;const i=n(680);t.isGeoPolygonLike=function(e){if(!e||!Array.isArray(e.coordinates)&&e.coordinates.length>2)return!1;let t=!0;return e.coordinates.forEach((n=>{(0,i.isGeoCoordLike)(e)||(t=!1)})),t}},7870:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isLatLngLike=void 0,t.isLatLngLike=function(e){return e&&\"number\"==typeof e.lat&&\"number\"==typeof e.lng}},9264:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isBox3Like=void 0,t.isBox3Like=function(e){const t=e;return void 0!==t.min&&void 0!==t.max}},7523:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MathUtils=void 0;const i=n(82);!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function n(e,n){const i=(e=t(e))-(n=t(n));return i>180?i-360:i<=-180?i+360:i}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.newVector3=function(e,t,n,i){return void 0===i?{x:e,y:t,z:n}:(i.x=e,i.y=t,i.z=n,i)},e.copyVector3=function(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t},e.degToRad=i.MathUtils.degToRad,e.radToDeg=i.MathUtils.radToDeg,e.clamp=i.MathUtils.clamp,e.normalizeAngleDeg=t,e.normalizeLongitudeDeg=function(e){return(e=t(e))>180&&(e-=360),e},e.angleDistanceDeg=n,e.interpolateAnglesDeg=function(e,t,i){return(e+n(t,e)*i)%360}}(t.MathUtils||(t.MathUtils={}))},2334:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.OrientedBox3=void 0;const i=n(82);function r(e,t,n,i,r){const o=n.dot(t),s=n.dot(e);if(Math.abs(s)<1e-20)return Math.abs(o)<=i;const a=1/s,l=(o+i)*a,c=(o-i)*a;return l>c?(c>r.min&&(r.min=c),l<r.max&&(r.max=l)):(l>r.min&&(r.min=l),c<r.max&&(r.max=c)),r.min<=r.max&&r.max>=0}const o=new i.Vector3,s={min:-1/0,max:1/0};class a{constructor(e,t,n){this.position=new i.Vector3,this.xAxis=new i.Vector3(1,0,0),this.yAxis=new i.Vector3(0,1,0),this.zAxis=new i.Vector3(0,0,1),this.extents=new i.Vector3,void 0!==e&&this.position.copy(e),void 0!==t&&t.extractBasis(this.xAxis,this.yAxis,this.zAxis),void 0!==n&&this.extents.copy(n)}clone(){const e=new a;return e.copy(this),e}copy(e){this.position.copy(e.position),this.xAxis.copy(e.xAxis),this.yAxis.copy(e.yAxis),this.zAxis.copy(e.zAxis),this.extents.copy(e.extents)}getCenter(e=new i.Vector3){return e.copy(this.position)}getSize(e=new i.Vector3){return e.copy(this.extents).multiplyScalar(2)}getRotationMatrix(e=new i.Matrix4){return e.makeBasis(this.xAxis,this.yAxis,this.zAxis)}intersects(e){const t=Array.isArray(e)?e:e.planes;for(const e of t){const t=Math.abs(e.normal.dot(this.xAxis)*this.extents.x)+Math.abs(e.normal.dot(this.yAxis)*this.extents.y)+Math.abs(e.normal.dot(this.zAxis)*this.extents.z);if(e.distanceToPoint(this.position)+t<0)return!1}return!0}intersectsRay(e){if(s.min=-1/0,s.max=1/0,o.copy(this.position).sub(e.origin),r(e.direction,o,this.xAxis,this.extents.x,s)&&r(e.direction,o,this.yAxis,this.extents.y,s)&&r(e.direction,o,this.zAxis,this.extents.z,s))return s.min>0?s.min:s.max}contains(e){const t=e.x-this.position.x,n=e.y-this.position.y,i=e.z-this.position.z,r=Math.abs(t*this.xAxis.x+n*this.xAxis.y+i*this.xAxis.z),o=Math.abs(t*this.yAxis.x+n*this.yAxis.y+i*this.yAxis.z),s=Math.abs(t*this.zAxis.x+n*this.zAxis.y+i*this.zAxis.z);return!(r>this.extents.x||o>this.extents.y||s>this.extents.z)}distanceToPoint(e){return Math.sqrt(this.distanceToPointSquared(e))}distanceToPointSquared(e){const t=new i.Vector3;t.subVectors(e,this.position);const n=[t.dot(this.xAxis),t.dot(this.yAxis),t.dot(this.zAxis)];let r=0;for(let e=0;e<3;++e){const t=n[e],i=this.extents.getComponent(e);if(t<-i){const e=i+t;r+=e*e}else if(t>i){const e=t-i;r+=e*e}}return r}}t.OrientedBox3=a},58:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isOrientedBox3Like=void 0,t.isOrientedBox3Like=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis&&void 0!==t.extents}},2683:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isTransformLike=void 0,t.isTransformLike=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis}},2953:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isVector2Like=void 0,t.isVector2Like=function(e){return e&&\"number\"==typeof e.x&&\"number\"==typeof e.y}},1383:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isVector3Like=void 0,t.isVector3Like=function(e){return e&&\"number\"==typeof e.x&&\"number\"==typeof e.y&&\"number\"==typeof e.z}},5610:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.EarthConstants=void 0;class n{}t.EarthConstants=n,n.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,n.EQUATORIAL_RADIUS=6378137,n.MIN_ELEVATION=-433,n.MAX_ELEVATION=8848,n.MAX_BUILDING_HEIGHT=828},1515:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.equirectangularProjection=t.normalizedEquirectangularProjection=void 0;const i=n(82),r=n(3068),o=n(4860),s=n(9264),a=n(7523),l=n(58),c=n(5610),u=n(5234);class h extends u.Projection{constructor(){super(...arguments),this.type=u.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,n){return n||(n=new i.Box3),n.min.x=0,n.min.y=0,n.min.z=e,n.max.x=this.unitScale,n.max.y=this.unitScale/2,n.max.z=t,n}projectPoint(e,t){var n;return void 0===t&&(t={x:0,y:0,z:0}),t.x=(i.MathUtils.degToRad(e.longitude)+Math.PI)*h.geoToWorldScale*this.unitScale,t.y=(i.MathUtils.degToRad(e.latitude)+.5*Math.PI)*h.geoToWorldScale*this.unitScale,t.z=null!==(n=e.altitude)&&void 0!==n?n:0,t}unprojectPoint(e){return o.GeoCoordinates.fromRadians(e.y*h.worldToGeoScale/this.unitScale-.5*Math.PI,e.x*h.worldToGeoScale/this.unitScale-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){const n=this.projectPoint(new o.GeoCoordinates(e.center.latitude,e.center.longitude,0)),{latitudeSpanInRadians:r,longitudeSpanInRadians:c,altitudeSpan:u}=e,d=c*h.geoToWorldScale,p=r*h.geoToWorldScale;return t||(t=new i.Box3),(0,s.isBox3Like)(t)?(t.min.x=n.x-.5*d*this.unitScale,t.min.y=n.y-.5*p*this.unitScale,t.max.x=n.x+.5*d*this.unitScale,t.max.y=n.y+.5*p*this.unitScale,void 0!==u?(t.min.z=n.z-.5*u,t.max.z=n.z+.5*u):(t.min.z=0,t.max.z=0)):(0,l.isOrientedBox3Like)(t)&&(a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=n.x,t.position.y=n.y,t.position.z=n.z,t.extents.x=.5*d*this.unitScale,t.extents.y=.5*p*this.unitScale,t.extents.z=Math.max(Number.EPSILON,.5*(null!=u?u:0))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,n)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}h.geoToWorldScale=1/(2*Math.PI),h.worldToGeoScale=2*Math.PI/1,t.normalizedEquirectangularProjection=new h(1),t.equirectangularProjection=new h(c.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},9686:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.identityProjection=void 0;const i=n(82),r=n(3068),o=n(4860),s=n(9264),a=n(7523),l=n(58),c=n(5234);class u extends c.Projection{constructor(){super(...arguments),this.type=c.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,n){return n||(n=new i.Box3),n.min.x=-Math.PI,n.min.y=.5*-Math.PI,n.min.z=e,n.max.x=Math.PI,n.max.y=.5*Math.PI,n.max.z=t,n}projectPoint(e,t){var n;return t||(t={x:0,y:0,z:0}),t.x=i.MathUtils.degToRad(e.longitude),t.y=i.MathUtils.degToRad(e.latitude),t.z=null!==(n=e.altitude)&&void 0!==n?n:0,t}unprojectPoint(e){return o.GeoCoordinates.fromRadians(e.y,e.x,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){t||(t=new i.Box3);const n=this.projectPoint(new o.GeoCoordinates(e.south,e.west,e.minAltitude)),r=this.projectPoint(new o.GeoCoordinates(e.north,e.east,e.maxAltitude));return(0,s.isBox3Like)(t)?(t.min.x=n.x,t.min.y=n.y,t.min.z=n.z,t.max.x=r.x,t.max.y=r.y,t.max.z=r.z):(0,l.isOrientedBox3Like)(t)&&(a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(n.x+r.x),t.position.y=.5*(n.y+r.y),t.position.z=.5*(n.z+r.z),t.extents.x=.5*(r.x-n.x),t.extents.y=.5*(r.y-n.y),t.extents.z=Math.max(Number.EPSILON,.5*(r.z-n.z))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,n)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}t.identityProjection=new u(1)},9885:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.webMercatorProjection=t.mercatorProjection=t.MercatorConstants=void 0;const i=n(82),r=n(3068),o=n(4860),s=n(6306),a=n(9264),l=n(7523),c=n(58),u=n(5610),h=n(5234);class d extends h.Projection{constructor(){super(...arguments),this.type=h.ProjectionType.Planar}static clamp(e,t,n){return Math.min(Math.max(t,e),n)}static latitudeClamp(e){return d.clamp(e,-p.MAXIMUM_LATITUDE,p.MAXIMUM_LATITUDE)}static latitudeProject(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI}static latitudeClampProject(e){return d.latitudeProject(d.latitudeClamp(e))}static unprojectLatitude(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI}getScaleFactor(e){return Math.cosh(2*Math.PI*(e.y/this.unitScale-.5))}worldExtent(e,t,n){return n||(n=new i.Box3),n.min.x=0,n.min.y=0,n.min.z=e,n.max.x=this.unitScale,n.max.y=this.unitScale,n.max.z=t,n}projectPoint(e,t){var n;let i;return i=e instanceof o.GeoCoordinates?e:new o.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(i.longitude+180)/360*this.unitScale,t.y=(.5*d.latitudeClampProject(i.latitudeInRadians)+.5)*this.unitScale,t.z=null!==(n=i.altitude)&&void 0!==n?n:0,t}unprojectPoint(e){return o.GeoCoordinates.fromRadians(d.unprojectLatitude(2*(e.y/this.unitScale-.5)),e.x/this.unitScale*2*Math.PI-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){var n;const r=this.projectPoint(e.center),o=(.5*d.latitudeClampProject(e.northEast.latitudeInRadians)+.5)*this.unitScale,s=(.5*d.latitudeClampProject(e.southWest.latitudeInRadians)+.5)*this.unitScale,u=.5*(o+s);r.y=u;const h=o-s,p=e.longitudeSpan/360*this.unitScale;if(t||(t=new i.Box3),(0,a.isBox3Like)(t)){t.min.x=r.x-.5*p,t.min.y=r.y-.5*h,t.max.x=r.x+.5*p,t.max.y=r.y+.5*h;const n=e.altitudeSpan;void 0!==n?(t.min.z=r.z-.5*n,t.max.z=r.z+.5*n):(t.min.z=0,t.max.z=0)}else{if(!(0,c.isOrientedBox3Like)(t))throw new Error(\"invalid bounding box\");l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,1,0,t.yAxis),l.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=r.x,t.position.y=r.y,t.position.z=r.z,t.extents.x=.5*p,t.extents.y=.5*h,t.extents.z=Math.max(Number.EPSILON,.5*(null!==(n=e.altitudeSpan)&&void 0!==n?n:0))}return t}unprojectBox(e){const t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,n)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}reprojectPoint(e,n,i){return e===this||e!==t.webMercatorProjection&&e!==t.mercatorProjection?super.reprojectPoint(e,n,i):(void 0===i&&(i={}),i.x=n.x,i.y=this.unitScale-n.y,i.z=n.z,i)}}class p{}t.MercatorConstants=p,p.MAXIMUM_LATITUDE=1.4844222297453322,t.mercatorProjection=new d(u.EarthConstants.EQUATORIAL_CIRCUMFERENCE),t.webMercatorProjection=new class extends d{projectPoint(e,t){var n;let i;i=e instanceof o.GeoCoordinates?e:new o.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(i.longitude+180)/360*this.unitScale;const r=Math.sin(d.latitudeClamp(i.latitudeInRadians));return t.y=(.5-Math.log((1+r)/(1-r))/(4*Math.PI))*this.unitScale,t.z=null!==(n=i.altitude)&&void 0!==n?n:0,t}unprojectPoint(e){const t=e.x/this.unitScale-.5,n=.5-e.y/this.unitScale,i=360*t,r=90-360*Math.atan(Math.exp(2*-n*Math.PI))/Math.PI;return new o.GeoCoordinates(r,i,e.z)}projectBox(e,t){const n=super.projectBox(e,t);if((0,a.isBox3Like)(n)){const e=n.max.y;n.max.y=this.unitScale-n.min.y,n.min.y=this.unitScale-e}else(0,c.isOrientedBox3Like)(n)&&(l.MathUtils.newVector3(1,0,0,n.xAxis),l.MathUtils.newVector3(0,-1,0,n.yAxis),l.MathUtils.newVector3(0,0,-1,n.zAxis),n.position.y=this.unitScale-n.position.y);return n}unprojectBox(e){const t=this.unprojectPoint(e.min),n=this.unprojectPoint(e.max);return new r.GeoBox(new o.GeoCoordinates(n.latitude,t.longitude,t.altitude),new o.GeoCoordinates(t.latitude,n.longitude,n.altitude))}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}localTangentSpace(e,t){return(0,s.isGeoCoordinatesLike)(e)?this.projectPoint(e,t.position):l.MathUtils.copyVector3(e,t.position),l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,-1,0,t.yAxis),l.MathUtils.newVector3(0,0,-1,t.zAxis),t}}(u.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},5234:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.Projection=t.ProjectionType=void 0;const i=n(6306),r=n(7523);var o;(o=t.ProjectionType||(t.ProjectionType={}))[o.Planar=0]=\"Planar\",o[o.Spherical=1]=\"Spherical\",t.Projection=class{constructor(e){this.unitScale=e}localTangentSpace(e,t){return(0,i.isGeoCoordinatesLike)(e)?this.projectPoint(e,t.position):r.MathUtils.copyVector3(e,t.position),r.MathUtils.newVector3(1,0,0,t.xAxis),r.MathUtils.newVector3(0,1,0,t.yAxis),r.MathUtils.newVector3(0,0,1,t.zAxis),t}reprojectPoint(e,t,n){return e===this?void 0===n?{x:t.x,y:t.y,z:t.z}:(n.x=t.x,n.y=t.y,n.z=t.z,n):this.projectPoint(e.unprojectPoint(t),n)}}},6322:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.sphereProjection=void 0;const i=n(82),r=n(4860),o=n(6306),s=n(9264),a=n(7523),l=n(58),c=n(5610),u=n(9885),h=n(5234);function d(e){const t=1/Math.PI,n=Math.floor(2*(e*t+1));return i.MathUtils.clamp(n,0,4)}function p(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}function f(e,t,n){var r;const o=.5*(n+(null!==(r=e.maxAltitude)&&void 0!==r?r:0)),s=i.MathUtils.degToRad(e.west),a=i.MathUtils.degToRad(e.east),l=d(s),c=d(a);let u=Math.cos(s),h=u,p=Math.sin(s),f=p;for(let e=l+1;e<=c;e++){const t=(e+1&1)*((2&e)-1);u=Math.min(t,u),h=Math.max(t,h);const n=(1&e)*((2&e)-1);p=Math.min(n,p),f=Math.max(n,f)}const m=Math.cos(a);u=Math.min(m,u),h=Math.max(m,h);const g=Math.sin(a);p=Math.min(g,p),f=Math.max(g,f);const v=(h+u)*o,y=(h-u)*o,x=(f+p)*o,_=(f-p)*o,b=i.MathUtils.degToRad(e.south),w=i.MathUtils.degToRad(e.north),M=Math.sin(w),S=Math.sin(b),E=(M+S)*o,T=(M-S)*o;return t.min.x=v-y,t.min.y=x-_,t.min.z=E-T,t.max.x=v+y,t.max.y=x+_,t.max.z=E+T,t}class m extends h.Projection{constructor(){super(...arguments),this.type=h.ProjectionType.Spherical}worldExtent(e,t,n=new i.Box3){const r=this.unitScale+t;return n.min.x=-r,n.min.y=-r,n.min.z=-r,n.max.x=r,n.max.y=r,n.max.z=r,n}projectPoint(e,t=a.MathUtils.newVector3(0,0,0)){return function(e,t,n){var r;const o=n+(null!==(r=e.altitude)&&void 0!==r?r:0),s=i.MathUtils.degToRad(e.latitude),a=i.MathUtils.degToRad(e.longitude),l=Math.cos(s);return t.x=o*l*Math.cos(a),t.y=o*l*Math.sin(a),t.z=o*Math.sin(s),t}(e,t,this.unitScale)}unprojectPoint(e){const t=e.x*e.x+e.y*e.y,n=Math.sqrt(t),i=e.z/n;if(isNaN(i))return r.GeoCoordinates.fromRadians(0,0,-this.unitScale);const o=Math.sqrt(t+e.z*e.z);return r.GeoCoordinates.fromRadians(Math.atan(i),Math.atan2(e.y,e.x),o-this.unitScale)}unprojectAltitude(e){const t=e.x*e.x+e.y*e.y+e.z*e.z;return Math.sqrt(t)-c.EarthConstants.EQUATORIAL_RADIUS}projectBox(e,t=new i.Box3){var n,r;if((0,s.isBox3Like)(t))return f(e,t,this.unitScale);if((0,l.isOrientedBox3Like)(t)){if(e.longitudeSpan>=90){const n=f(e,new i.Box3,this.unitScale);return a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(n.max.x+n.min.x),t.position.y=.5*(n.max.y+n.min.y),t.position.z=.5*(n.max.z+n.min.z),t.extents.x=.5*(n.max.x-n.min.x),t.extents.y=.5*(n.max.y-n.min.y),t.extents.z=.5*(n.max.z-n.min.z),t}const{south:o,west:s,north:l,east:c,center:u}=e,h=u.longitude,d=u.latitude,p=Math.cos(i.MathUtils.degToRad(o)),m=Math.sin(i.MathUtils.degToRad(o)),g=Math.cos(i.MathUtils.degToRad(s)),v=Math.sin(i.MathUtils.degToRad(s)),y=Math.cos(i.MathUtils.degToRad(l)),x=Math.sin(i.MathUtils.degToRad(l)),_=Math.cos(i.MathUtils.degToRad(c)),b=Math.sin(i.MathUtils.degToRad(c)),w=Math.cos(i.MathUtils.degToRad(h)),M=Math.sin(i.MathUtils.degToRad(h)),S=Math.cos(i.MathUtils.degToRad(d)),E=Math.sin(i.MathUtils.degToRad(d));let T,A,L;a.MathUtils.newVector3(w*S,M*S,E,t.zAxis),a.MathUtils.newVector3(-M,w,0,t.xAxis),a.MathUtils.newVector3(-w*E,-M*E,S,t.yAxis),o>=0?(T=Math.abs(p*(w*(v-b)+M*(_-g))),A=S*m-E*p,L=S*x-E*y*(w*_+M*b)):(l<=0?(T=Math.abs(y*(w*(v-b)+M*(_-g))),L=S*x-E*y):(T=Math.abs(w*(v-b)+M*(_-g)),L=S*x-E*y*(M*b+w*_)),A=S*m-E*p*(w*_+M*b));const C=.5*(this.unitScale+(null!==(n=e.maxAltitude)&&void 0!==n?n:0)),P=.5*(this.unitScale+(null!==(r=e.minAltitude)&&void 0!==r?r:0)),R=S*(w*_+M*b),D=Math.min(y*R+x*E,p*R+m*E);return a.MathUtils.newVector3(T*C,(L-A)*C,C-D*P,t.extents),a.MathUtils.newVector3(0,(A+L)*C,C+C,t.position),function(e,t,n,i){const r=e.x*i.x+t.x*i.y+n.x*i.z,o=e.y*i.x+t.y*i.y+n.y*i.z,s=e.z*i.x+t.z*i.y+n.z*i.z;i.x=r,i.y=o,i.z=s}(t.xAxis,t.yAxis,t.zAxis,t.position),t.position.x=t.position.x-t.zAxis.x*t.extents.z,t.position.y=t.position.y-t.zAxis.y*t.extents.z,t.position.z=t.position.z-t.zAxis.z*t.extents.z,t}throw new Error(\"Invalid bounding box\")}unprojectBox(e){throw new Error(\"Method not implemented.\")}getScaleFactor(e){return 1}groundDistance(e){return p(e)-this.unitScale}scalePointToSurface(e){const t=this.unitScale/(p(e)||1);return e.x*=t,e.y*=t,e.z*=t,e}surfaceNormal(e,t){void 0===t&&(t={x:0,y:0,z:0});const n=1/(p(e)||1);return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t}reprojectPoint(e,t,n){if(e===u.mercatorProjection||e===u.webMercatorProjection){const{x:i,y:r,z:o}=t,s=this.unitScale,a=i/s-Math.PI,l=r/s-Math.PI,c=Math.exp(l),h=c*c,d=2*c/(h+1),p=(h-1)/(h+1),f=s+o;return void 0===n&&(n={}),n.x=Math.cos(a)*d*f,n.y=Math.sin(a)*d*f,n.z=p*f,e===u.webMercatorProjection&&(n.z=-n.z),n}return super.reprojectPoint(e,t,n)}localTangentSpace(e,t){let n;(0,o.isGeoCoordinatesLike)(e)?(this.projectPoint(e,t.position),n=e):(a.MathUtils.copyVector3(e,t.position),n=this.unprojectPoint(e));const r=i.MathUtils.degToRad(n.latitude),s=i.MathUtils.degToRad(n.longitude),l=Math.cos(s),c=Math.sin(s),u=Math.cos(r),h=Math.sin(r);return a.MathUtils.newVector3(l*u,c*u,h,t.zAxis),a.MathUtils.newVector3(-c,l,0,t.xAxis),a.MathUtils.newVector3(-l*h,-c*h,u,t.yAxis),t}}t.sphereProjection=new m(c.EarthConstants.EQUATORIAL_RADIUS)},7289:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.transverseMercatorProjection=t.TransverseMercatorUtils=void 0;const i=n(82),r=n(3068),o=n(4860),s=n(9264),a=n(7523),l=n(58),c=n(5610),u=n(5234);class h extends u.Projection{static clampGeoPoint(e,t){const n=e.latitude,i=e.longitude,r=d.POLE_RADIUS,s=d.POLE_RADIUS_SQ,a=Math.round(i/90),l=90*a-i;if(a%2==0||Math.abs(l)>r)return e;const c=n-0,u=l*l+c*c;if(u<s){const e=Math.sqrt(u),t=(r-e)/e,s=0===l&&0===c?1*r:l;return new o.GeoCoordinates(n+c*t,i+s*t)}return e}constructor(e){super(e),this.unitScale=e,this.type=u.ProjectionType.Planar,this.m_phi0=0,this.m_lambda0=0}getScaleFactor(e){return Math.cosh(2*(e.x/this.unitScale-.5)*Math.PI)}worldExtent(e,t,n){return n||(n=new i.Box3),n.min.x=0,n.min.y=0,n.min.z=e,n.max.x=this.unitScale,n.max.y=this.unitScale,n.max.z=t,n}projectPoint(e,t){var n;t||(t={x:0,y:0,z:0});const r=h.clampGeoPoint(e,this.unitScale),o=r.longitude/360+.5,s=1===o?0:Math.floor(o),a=i.MathUtils.degToRad(r.latitude),l=i.MathUtils.degToRad(r.longitude-360*s)-this.m_lambda0,c=Math.cos(a)*Math.sin(l);t.x=Math.atanh(c),t.y=Math.atan2(Math.tan(a),Math.cos(l))-this.m_phi0;const u=.5/Math.PI;return t.x=this.unitScale*(i.MathUtils.clamp(t.x*u+.5,0,1)+s),t.y=this.unitScale*i.MathUtils.clamp(t.y*u+.5,0,1),t.z=null!==(n=e.altitude)&&void 0!==n?n:0,t}unprojectPoint(e){const t=2*Math.PI,n=e.x/this.unitScale,i=e.y/this.unitScale,r=1===n?0:Math.floor(n),s=t*(n-.5-r),a=t*(i-.5),l=e.z||0,c=a+this.m_phi0,u=Math.asin(Math.sin(c)/Math.cosh(s)),h=this.m_lambda0+Math.atan2(Math.sinh(s),Math.cos(c))+r*t;return o.GeoCoordinates.fromRadians(u,h,l)}projectBox(e,t){const{north:n,south:r,east:c,west:u}=e,h=[e.center,e.northEast,e.southWest,new o.GeoCoordinates(r,c),new o.GeoCoordinates(n,u)],p=d.POLE_EDGE_DEG,f=u<90&&c>90,m=u<0&&c>0,g=u<p&&c>-p&&n>0&&r<0;u<-90&&c>-90&&(h.push(new o.GeoCoordinates(n,-90)),h.push(new o.GeoCoordinates(r,-90))),f&&(h.push(new o.GeoCoordinates(n,90)),h.push(new o.GeoCoordinates(r,90))),m&&(h.push(new o.GeoCoordinates(n,0)),h.push(new o.GeoCoordinates(r,0))),g&&(h.push(new o.GeoCoordinates(0,u)),h.push(new o.GeoCoordinates(0,c))),d.alignLatitude(h,h[0]);const v=h.map((e=>this.projectPoint(e))),y=v.map((e=>e.x)),x=v.map((e=>e.y)),_=v.map((e=>e.z)),b=Math.min(...y),w=Math.min(...x),M=Math.min(..._),S=Math.max(...y),E=Math.max(...x),T=Math.max(..._);if(t||(t=new i.Box3),(0,s.isBox3Like)(t))t.min.x=b,t.min.y=w,t.min.z=M,t.max.x=S,t.max.y=E,t.max.z=T;else{if(!(0,l.isOrientedBox3Like)(t))throw new Error(\"invalid bounding box\");a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=(b+S)/2,t.position.y=(w+E)/2,t.position.z=(M+T)/2,t.extents.x=(S-b)/2,t.extents.y=(E-w)/2,t.extents.z=(T-M)/2}return t}unprojectBox(e){const t=this.unitScale,n=e.min,i=e.max,s=[{x:(n.x+i.x)/2,y:(n.y+i.y)/2,z:0},n,i,{x:n.x,y:i.y,z:0},{x:i.x,y:n.y,z:0}],a=.5*t,l=.25*t,c=.75*t,u=n.x<a&&i.x>a,h=n.y<a&&i.y>a,p=n.y<l&&i.y>l,f=n.y<c&&i.y>c;h&&(s.push({x:n.x,y:a,z:0}),s.push({x:i.x,y:a,z:0}),u&&s.push({x:a,y:a,z:0})),p&&(s.push({x:n.x,y:l,z:0}),s.push({x:i.x,y:l,z:0}),u&&s.push({x:a,y:l,z:0})),f&&(s.push({x:n.x,y:c,z:0}),s.push({x:i.x,y:c,z:0}),u&&s.push({x:a,y:c,z:0}));const m=s.map((e=>this.unprojectPoint(e)));d.alignLongitude(m,m[0]);const g=m.map((e=>e.latitude)),v=m.filter((e=>Math.abs(e.latitude)<90)).map((e=>e.longitude)),y=m.map((e=>{var t;return null!==(t=e.altitude)&&void 0!==t?t:0})),x=new o.GeoCoordinates(Math.min(...g),Math.min(...v),Math.min(...y)),_=new o.GeoCoordinates(Math.max(...g),Math.max(...v),Math.max(...y));return r.GeoBox.fromCoordinates(x,_)}unprojectAltitude(e){return e.z}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}}class d{static alignLatitude(e,t){for(const n of e)0===n.latitude&&(n.latitude=1e-9*t.latitude)}static alignLongitude(e,t){const n=t.longitude<0?180:-180,i=t.longitude<0?-180:180;for(const t of e)t.longitude===n&&(t.longitude=i)}}t.TransverseMercatorUtils=d,d.POLE_EDGE=1.4844222297453322,d.POLE_EDGE_DEG=i.MathUtils.radToDeg(d.POLE_EDGE),d.POLE_RADIUS=90-d.POLE_EDGE_DEG,d.POLE_RADIUS_SQ=Math.pow(d.POLE_RADIUS,2),t.transverseMercatorProjection=new h(c.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},9861:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.FlatTileBoundingBoxGenerator=void 0;const i=n(82);t.FlatTileBoundingBoxGenerator=class{constructor(e,t=0,n=0){this.tilingScheme=e,this.minElevation=t,this.maxElevation=n,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,n);const{min:i,max:r}=this.m_worldBox;this.m_worldDimensions={x:r.x-i.x,y:r.y-i.y,z:r.z-i.z}}get projection(){return this.m_tilingScheme.projection}get subdivisionScheme(){return this.m_tilingScheme.subdivisionScheme}getWorldBox(e,t){const n=e.level,r=this.subdivisionScheme.getLevelDimensionX(n),o=this.subdivisionScheme.getLevelDimensionY(n),s=this.m_worldDimensions.x/r,a=this.m_worldDimensions.y/o,l=this.m_worldBox.min.x+s*e.column,c=this.m_worldBox.min.y+a*e.row;return t||(t=new i.Box3),t.min.x=l,t.min.y=c,t.min.z=this.m_worldBox.min.z,t.max.x=l+s,t.max.y=c+a,t.max.z=this.m_worldBox.max.z,t}getGeoBox(e){const t=this.getWorldBox(e);return this.projection.unprojectBox(t)}}},435:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.halfQuadTreeSubdivisionScheme=void 0,t.halfQuadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(e){return 0===e?1:2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 0!==e?1<<e-1:1}}},4490:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.hereTilingScheme=void 0;const i=n(1515),r=n(435),o=n(6557);t.hereTilingScheme=new o.TilingScheme(r.halfQuadTreeSubdivisionScheme,i.normalizedEquirectangularProjection)},1635:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.mercatorTilingScheme=void 0;const i=n(9885),r=n(9447),o=n(6557);t.mercatorTilingScheme=new o.TilingScheme(r.quadTreeSubdivisionScheme,i.mercatorProjection)},1871:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.polarTilingScheme=void 0;const i=n(7289),r=n(9447),o=n(6557);t.polarTilingScheme=new o.TilingScheme(r.quadTreeSubdivisionScheme,i.transverseMercatorProjection)},7171:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.QuadTree=void 0;const i=n(6541);t.QuadTree=class{constructor(e){this.tilingScheme=e}visit(e){this.visitTileKey(i.TileKey.fromRowColumnLevel(0,0,0),e)}visitTileKey(e,t){if(t(e,this.tilingScheme.getGeoBox(e)))for(const n of this.tilingScheme.getSubTileKeys(e))this.visitTileKey(n,t)}}},9447:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.quadTreeSubdivisionScheme=void 0,t.quadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(){return 2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 1<<e}}},3424:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.SubTiles=void 0;const i=n(6541);class r{constructor(e,t,n){this.tileKey=e,this.sizeX=t,this.sizeY=n}[Symbol.iterator](){return 2===this.sizeX&&2===this.sizeY?r.ZCurveIterator(this.tileKey):r.RowColumnIterator(this.tileKey,this.sizeX,this.sizeY)}}t.SubTiles=r,function(e){e.RowColumnIterator=function*(e,t,n){for(let r=0;r<n;r++)for(let o=0;o<t;o++)yield i.TileKey.fromRowColumnLevel(e.row*n+r,e.column*t+o,e.level+1)},e.ZCurveIterator=function*(e){for(let t=0;t<4;t++)yield i.TileKey.fromRowColumnLevel(e.row<<1|t>>1,e.column<<1|1&t,e.level+1)}}(r=t.SubTiles||(t.SubTiles={}))},4948:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},6541:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TileKey=void 0;const n=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];class i{static fromRowColumnLevel(e,t,n){return new i(e,t,n)}static fromQuadKey(e){const t=e.length;let n=0,r=0;for(let i=0;i<e.length;++i){const o=1<<i,s=parseInt(e.charAt(t-i-1),10);1&s&&(r|=o),2&s&&(n|=o)}return i.fromRowColumnLevel(n,r,t)}static fromMortonCode(e){let t=0,n=0,r=0,o=e;for(;o>1;){const e=1<<t;1&o&&(r|=e),2&o&&(n|=e),t++,o=(o-(3&o))/4}const s=i.fromRowColumnLevel(n,r,t);return s.m_mortonCode=e,s}static fromHereTile(e){const t=i.fromMortonCode(parseInt(e,10));return t.m_hereTile=e,t}static columnsAtLevel(e){return Math.pow(2,e)}static rowsAtLevel(e){return Math.pow(2,e)}static atCoords(e,t,n,r,o){return i.fromRowColumnLevel(Math.floor(n/(o/i.rowsAtLevel(e))),Math.floor(t/(r/i.columnsAtLevel(e))),e)}static parentMortonCode(e){return Math.floor(e/4)}constructor(e,t,n){this.row=e,this.column=t,this.level=n}parent(){if(0===this.level)throw new Error(\"Cannot get the parent of the root tile key\");return i.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)}changedLevelBy(e){const t=Math.max(0,this.level+e);let n=this.row,r=this.column;return e>=0?(n<<=e,r<<=e):(n>>>=-e,r>>>=-e),i.fromRowColumnLevel(n,r,t)}changedLevelTo(e){return this.changedLevelBy(e-this.level)}mortonCode(){if(void 0===this.m_mortonCode){let e=this.column,t=this.row,i=n[this.level<<1];for(let r=0;r<this.level;++r)1&e&&(i+=n[2*r]),1&t&&(i+=n[2*r+1]),e>>>=1,t>>>=1;this.m_mortonCode=i}return this.m_mortonCode}toHereTile(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile}toQuadKey(){let e=\"\";for(let t=this.level;t>0;--t){const n=1<<t-1,i=0!=(this.column&n),r=0!=(this.row&n);e+=i&&r?\"3\":r?\"2\":i?\"1\":\"0\"}return e}equals(e){return this.row===e.row&&this.column===e.column&&this.level===e.level}addedSubKey(e){const t=i.fromQuadKey(0===e.length?\"-\":e),n=this.changedLevelBy(t.level);return i.fromRowColumnLevel(n.row+t.row,n.column+t.column,n.level)}addedSubHereTile(e){const t=i.fromHereTile(e),n=this.changedLevelBy(t.level);return i.fromRowColumnLevel(n.row+t.row,n.column+t.column,n.level)}getSubHereTile(e){const t=1<<2*e;return(this.mortonCode()&t-1|t).toString()}rowCount(){return i.rowsAtLevel(this.level)}columnCount(){return i.columnsAtLevel(this.level)}}t.TileKey=i},7841:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TileKeyUtils=t.powerOfTwo=void 0;const i=n(4860),r=n(6541);t.powerOfTwo=(()=>{let e=.5;return new Array(53).fill(0).map((()=>e*=2))})(),function(e){function n(e,t,n){const i=e.projection,o=e.subdivisionScheme,s=o.getLevelDimensionX(n),a=o.getLevelDimensionY(n),{min:l,max:c}=i.worldExtent(0,0),u=c.x-l.x,h=c.y-l.y;if(t.x<l.x||t.x>c.x)return null;if(t.y<l.y||t.y>c.y)return null;const d=Math.min(s-1,Math.floor(s*(t.x-l.x)/u)),p=Math.min(a-1,Math.floor(a*(t.y-l.y)/h));return r.TileKey.fromRowColumnLevel(p,d,n)}function o(e,n,i=4){const r=function(e,n=4){let i=0;const r=t.powerOfTwo[n];for(e+=r/2;e<0;)e+=r;for(;e>=r;)e-=r;for(let r=0;r<n&&e>0;r++)1&e&&(i+=t.powerOfTwo[53-n+r]),e>>>=1;return i}(n,i);return e.mortonCode()+r}function s(e,n=4){let i=0,r=e,o=0;for(;o<n;o++){const e=t.powerOfTwo[52-o];r>=e&&(r-=e,i+=t.powerOfTwo[n-1-o])}return i-=t.powerOfTwo[n-1],{offset:i,mortonCode:r}}e.geoCoordinatesToTileKey=function(e,t,i){return n(e,e.projection.projectPoint(t),i)},e.worldCoordinatesToTileKey=n,e.geoRectangleToTileKeys=function(t,n,o){const s=(e,t,n)=>e<t?n-(t-e)%(n-t):t+(e-t)%(n-t),a=(e,t,n)=>Math.min(Math.max(e,t),n),l=s(n.southWest.longitudeInRadians,-Math.PI,Math.PI),c=a(n.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),u=s(n.northEast.longitudeInRadians,-Math.PI,Math.PI),h=a(n.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),d=e.geoCoordinatesToTileKey(t,i.GeoCoordinates.fromRadians(c,l),o),p=e.geoCoordinatesToTileKey(t,i.GeoCoordinates.fromRadians(h,u),o),f=t.subdivisionScheme.getLevelDimensionX(o);if(!d||!p)throw new Error(\"Invalid coordinates\");const m=d.column;let g=p.column;l>u&&(g+=g!==m?f:f-1);const v=Math.min(d.row,p.row),y=Math.max(d.row,p.row),x=new Array;for(let e=v;e<=y;++e)for(let t=m;t<=g;++t)x.push(r.TileKey.fromRowColumnLevel(e,t%f,o));return x},e.getKeyForTileKeyAndOffset=o,e.extractOffsetAndMortonKeyFromKey=s,e.getParentKeyFromKey=function(e,t=4){const{offset:n,mortonCode:i}=s(e,t);return o(r.TileKey.fromMortonCode(r.TileKey.parentMortonCode(i)),n,t)}}(t.TileKeyUtils||(t.TileKeyUtils={}))},2801:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TileTreeTraverse=void 0;const i=n(3424);t.TileTreeTraverse=class{constructor(e){this.m_subdivisionScheme=e}subTiles(e){const t=this.m_subdivisionScheme.getSubdivisionX(e.level),n=this.m_subdivisionScheme.getSubdivisionY(e.level);return new i.SubTiles(e,t,n)}}},6557:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TilingScheme=void 0;const i=n(9861),r=n(7841),o=n(2801);t.TilingScheme=class{constructor(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new i.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new o.TileTreeTraverse(e)}getSubTileKeys(e){return this.tileTreeTraverse.subTiles(e)}getTileKey(e,t){return r.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)}getTileKeys(e,t){return r.TileKeyUtils.geoRectangleToTileKeys(this,e,t)}getGeoBox(e){return this.boundingBoxGenerator.getGeoBox(e)}getWorldBox(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)}}},2224:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.webMercatorTilingScheme=void 0;const i=n(9885),r=n(9447),o=n(6557);t.webMercatorTilingScheme=new o.TilingScheme(r.quadTreeSubdivisionScheme,i.webMercatorProjection)},4388:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.LineGroup=t.createSimpleLineGeometry=t.createLineGeometry=t.LineGeometry=void 0;const i=n(82),r=n(4342),o=new i.Vector3,s=new i.Vector3,a=new i.Vector3,l=new i.Vector3,c=new i.Vector3,u={attributes:[{name:\"extrusionCoord\",itemSize:3,offset:0},{name:\"position\",itemSize:3,offset:3},{name:\"tangent\",itemSize:3,offset:6},{name:\"biTangent\",itemSize:4,offset:9}],stride:13},h={attributes:[{name:\"uv\",itemSize:2,offset:u.stride},{name:\"normal\",itemSize:3,offset:u.stride+2}],stride:5},d={attributes:[...u.attributes,...h.attributes],stride:u.stride+h.stride},p={attributes:[{name:\"extrusionCoord\",itemSize:2,offset:0},{name:\"position\",itemSize:3,offset:2},{name:\"positionLow\",itemSize:3,offset:5},{name:\"tangent\",itemSize:3,offset:8},{name:\"biTangent\",itemSize:4,offset:11}],stride:15},f={attributes:[...p.attributes,...h.attributes],stride:p.stride+h.stride};class m{constructor(){this.vertices=[],this.vertexColors=[],this.indices=[]}}function g(e,t){return t?e?f:p:e?d:u}function v(e,t,n,i,u,h,d=new m,p=!1){if(0===t.length)return d;const f=g(void 0!==u,p).stride,v=t.length/3,y=new Array(v),x=new Array(t.length-3),_=d.vertices.length/f,b=void 0!==i&&i.length>0,w=void 0!==u&&u.length>0,M=void 0!==h&&h.length&&t.length;(0,r.assert)(!b||i.length===v),(0,r.assert)(!w||u.length/2===v),(0,r.assert)(!M||h.length===t.length);let S=.1;y[0]=S;for(let e=0;e<v-1;++e){let n=0;for(let i=0;i<3;++i){const r=t[3*(e+1)+i]-t[3*e+i];x[3*e+i]=r,n+=r*r}S+=Math.sqrt(n),y[e+1]=S}const E=b?Math.abs(i[i.length-1]-i[0]):1,T=y[y.length-1]/E;if(b)for(let e=0;e<v;++e)y[e]=i[e]*T+.1;let A=!0;for(let e=0;e<3;++e)A=A&&t[e]===t[t.length-3+e];const L=[],C=(i,r,f,m,g)=>{L.length=0,d.vertices.push(m,-1*g,T),L.push(m,1*g,T);for(let e=0;e<3;++e){if(p){const n=Math.fround(t[3*i+e]),r=t[3*i+e]-n;d.vertices.push(n,r),L.push(n,r)}else d.vertices.push(t[3*i+e]),L.push(t[3*i+e]);s.setComponent(e,t[3*i+e])}for(let e=0;e<3;++e)a.setComponent(e,x[r+e]),l.setComponent(e,x[f+e]);a.normalize(),d.vertices.push(a.x,a.y,a.z),L.push(a.x,a.y,a.z),s.add(e),n.surfaceNormal(s,s);const v=function(e,t,n,i){let r=0;return t.equals(n)||(r=Math.acos(t.dot(n))*Math.sign(e.dot(o.copy(t).cross(n))),Number.isNaN(r)&&(r=0)),i.copy(t).add(n).normalize().cross(e).normalize(),r}(s,a,l.normalize(),c);d.vertices.push(c.x,c.y,c.z,v),L.push(c.x,c.y,c.z,v),w&&(d.vertices.push(u[2*i],u[2*i+1]),L.push(u[2*i],u[2*i+1]),d.vertices.push(s.x,s.y,s.z),L.push(s.x,s.y,s.z)),d.vertices.push(...L),M&&(d.vertexColors.push(h[3*i],h[3*i+1],h[3*i+2]),d.vertexColors.push(h[3*i],h[3*i+1],h[3*i+2]))};for(let e=0;e<v;++e){const t=A&&0===e?x.length-3:3*Math.max(0,e-1),n=A&&e===v-1?0:Math.min(3*e,x.length-3);e>0&&C(e,t,n,y[e-1],y[e]),e+1<v&&C(e,t,n,-1*y[Math.min(e,y.length-1)],y[Math.min(e+1,y.length-1)])}for(let e=0;e<v-1;++e){const t=_+4*e;d.indices.push(t,t+1,t+2,t+2,t+1,t+3)}return d}function y(e,t,n=new m){if(0===e.length)return n;const i=e.length/3;let r=n.vertices.length/3;const o=void 0!==t&&t.length&&e.length;for(let s=0;s<i;++s,r++){s>0&&n.indices.push(r),s<i-1&&n.indices.push(r);for(let i=0;i<3;++i)n.vertices.push(e[3*s+i]),o&&n.vertexColors.push(t[3*s+i])}return n}t.LineGeometry=m,t.createLineGeometry=v,t.createSimpleLineGeometry=y;class x{static createGeometry(e,t,n,r,o=!1,s=!1,a=!1){if(a)return r.setAttribute(\"position\",new i.BufferAttribute(new Float32Array(e),3)),t.length===e.length&&r.setAttribute(\"color\",new i.BufferAttribute(new Float32Array(t),3)),r.setIndex(new i.BufferAttribute(new Uint32Array(n),1)),r;{const a=g(o,s),l=new i.InterleavedBuffer(new Float32Array(e),a.stride);return a.attributes.forEach((e=>{const t=new i.InterleavedBufferAttribute(l,e.itemSize,e.offset,!1);r.setAttribute(e.name,t)})),t.length===e.length&&r.setAttribute(\"color\",new i.BufferAttribute(new Float32Array(t),3)),r.setIndex(new i.BufferAttribute(new Uint32Array(n),1)),r}}constructor(e=!1,t=!1,n=!1){this.hasNormalsAndUvs=e,this.highPrecision=t,this.isSimple=n,this.m_geometry=new m}clear(){this.m_geometry.vertices=[],this.m_geometry.vertexColors=[],this.m_geometry.indices=[]}add(e,t,n,i,o,s){return this.isSimple?y(t,s,this.m_geometry):((0,r.assert)(!this.hasNormalsAndUvs||void 0!==o),v(e,t,n,i,o,s,this.m_geometry,this.highPrecision)),this}get vertices(){return this.m_geometry.vertices}get vertexColors(){return this.m_geometry.vertexColors}get indices(){return this.m_geometry.indices}get vertexAttributes(){return g(this.hasNormalsAndUvs,this.highPrecision).attributes}get stride(){return g(this.hasNormalsAndUvs,this.highPrecision).stride}createGeometry(e){return void 0===e&&(e=new i.BufferGeometry),x.createGeometry(this.m_geometry.vertices,this.m_geometry.vertexColors,this.m_geometry.indices,e,this.hasNormalsAndUvs,this.highPrecision)}}t.LineGroup=x},3711:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.reconstructLineWidth=t.reconstructLine=t.triangulateLine=t.numCirclePoints=void 0;const i=n(82),r=new i.Vector3(0,0,1),o=[0,1,2,1,3,2],s=[0,1,3,3,1,2,0,3,4,5,4,3],a=Math.PI/8;function l(e,t,n,i,r,o){const s=r.length/3;r.push(e,t,0);for(let l=0;l<9;++l){const c=a*l+Math.PI/2+n;r.push(e+i*Math.cos(c),t+i*Math.sin(c),0),o.push(s,s+l+1,s+(l+1)%9+1)}}t.numCirclePoints=function(e){return 9},t.triangulateLine=function(e,t,n,a,c=!0,u=c){if(e.length<3)return;const h=new i.Vector2;if(c){const i=3!==e.length?h.set(e[3]-e[0],e[4]-e[1]).angle():0;l(e[0],e[1],i,t,n,a)}const d=n.length/3,p=new i.Vector3,f=new i.Vector3,m=new i.Vector3,g=new i.Vector3,v=new i.Vector3,y=new i.Vector3,x=new i.Vector3,_=new i.Vector3,b=new i.Vector3,w=e.length/3;let M=0;for(let i=0;i<w;++i){let l=!1;if(f.set(e[3*i],e[3*i+1],e[3*i+2]),i+1<w){if(m.set(e[3*(i+1)],e[3*(i+1)+1],e[3*(i+1)+2]),g.copy(m).sub(f).normalize().cross(r),v.copy(g),i>0&&(v.add(p).multiplyScalar(1-.5*g.dot(p)),l=p.angleTo(g)>Math.PI/2,l)){const e=t/Math.cos(g.angleTo(p)/2);y.copy(g).add(p).normalize().multiplyScalar(-e).add(f),x.copy(p).multiplyScalar(t).add(f),_.copy(g).add(p).normalize().multiplyScalar(e).add(f),b.copy(g).multiplyScalar(t).add(f)}l?n.push(y.x,y.y,y.z,x.x,x.y,x.z,_.x,_.y,_.z,b.x,b.y,b.z):(y.copy(v).multiplyScalar(-t).add(f),x.copy(v).multiplyScalar(t).add(f),n.push(y.x,y.y,y.z,x.x,x.y,x.z)),p.copy(g)}else y.copy(p).multiplyScalar(-t).add(f),x.copy(p).multiplyScalar(t).add(f),n.push(y.x,y.y,y.z,x.x,x.y,x.z);i!==w-1&&((l?s:o).forEach((e=>a.push(d+M+e))),M+=l?4:2)}if(u){const i=2!==e.length?h.set(e[3*(w-3)]-e[3*(w-2)],e[3*(w-3)+1]-e[3*(w-2)+1]).angle():Math.PI;l(e[3*(w-2)],e[3*(w-2)+1],i,t,n,a)}},t.reconstructLine=function(e,t){const n=new Float32Array(e.length/2);for(let i=3*t,r=2*i;i<n.length;i+=3,r+=6)n[i]=e[r]+.5*(e[r+3]-e[r]),n[i+1]=e[r+1]+.5*(e[r+3+1]-e[r+1]),n[i+2]=e[r+2]+.5*(e[r+3+2]-e[r+2]);return n},t.reconstructLineWidth=function(e,t){const n=e[2*t+3]-e[2*t],i=e[2*t+3+1]-e[2*t+1],r=e[2*t+3+2]-e[2*t+2];return.5*Math.sqrt(n*n+i*i+r*r)}},2626:function(e,t,n){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!(\"get\"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),r(n(1153),t),r(n(6802),t),r(n(4773),t),r(n(2369),t),r(n(5199),t),r(n(1781),t)},1781:(e,t,n)=>{\"use strict\";var i;Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoJsonTiler=void 0;const r=n(242),o=n(8152),s=null!==(i=r.default)&&void 0!==i?i:r,a=-(-2&-Math.ceil(204.8));t.GeoJsonTiler=class{constructor(){this.indexes=new Map}dispose(){}async connect(){return await Promise.resolve()}async registerIndex(e,t){if(!this.indexes.has(e))return await this.updateIndex(e,t)}async updateIndex(e,t){if(t instanceof URL){const e=await fetch(t.href);if(!e.ok)throw new Error(`GeoJsonTiler: Unable to fetch ${t.href}: ${e.statusText}`);t=await e.json()}const n=(0,o.isFeatureGeometry)(t)||\"GeometryCollection\"===t.type||\"Feature\"===t.type&&void 0===t.id||\"FeatureCollection\"===t.type&&t.features.length>0&&void 0===t.features[0].id,i=s(t,{maxZoom:20,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:a,lineMetrics:!1,promoteId:null,generateId:n,debug:0});i.geojson=t,this.indexes.set(e,i)}async getTile(e,t){const n=this.indexes.get(e);if(void 0===n)throw new Error(\"Tile not found\");const i=n.getTile(t.level,t.column,t.row);return null!==i&&(i.layer=e),i||{}}}},1153:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ThemedTileDecoder=void 0;const i=n(7769),r=n(4342).LoggerManager.instance.create(\"ThemedTileDecoder\");t.ThemedTileDecoder=class{constructor(){this.m_storageLevelOffset=0}dispose(){}decodeTile(e,t,n){return void 0===this.m_styleSetEvaluator?(r.info(\"cannot decode tile, as there is not style available\"),Promise.resolve(void 0)):this.decodeThemedTile(e,t,this.m_styleSetEvaluator,n)}getTileInfo(e,t,n){return Promise.resolve(void 0)}configure(e,t){void 0!==(null==e?void 0:e.styleSet)&&(this.m_styleSetEvaluator=new i.StyleSetEvaluator(e)),this.m_styleSetEvaluator&&this.m_styleSetEvaluator.setEnabledFeatures(null==e?void 0:e.enabledFeatures),void 0!==(null==e?void 0:e.languages)&&(this.languages=e.languages),void 0!==t&&void 0!==t.storageLevelOffset&&(this.m_storageLevelOffset=t.storageLevelOffset)}}},6802:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TileDecoderService=void 0;const i=n(8152),r=n(2616),o=n(1984),s=n(4342),a=n(2369),l=s.LoggerManager.instance.create(\"TileDecoderService\");class c extends a.WorkerService{static start(e,t){return new c(e,t)}constructor(e,t){super(e),this.serviceId=e,this.m_decoder=t,this.m_decoder.connect()}handleRequest(e){return i.WorkerDecoderProtocol.isDecodeTileRequest(e)?this.handleDecodeTileRequest(e):i.WorkerDecoderProtocol.isTileInfoRequest(e)?this.handleTileInfoRequest(e):super.handleRequest(e)}handleMessage(e){i.WorkerDecoderProtocol.isConfigurationMessage(e)?this.handleConfigurationMessage(e):l.error(`[${this.serviceId}]: invalid message ${e.type}`)}async handleDecodeTileRequest(e){const t=r.TileKey.fromMortonCode(e.tileKey),n=(0,i.getProjection)(e.projection),s=await this.m_decoder.decodeTile(e.data,t,n),a=[],l=e=>{void 0!==e&&e.buffer.byteLength>0&&!a.includes(e.buffer)&&a.push(e.buffer)};return null==s||s.geometries.forEach((e=>{var t,n,i;if(null===(t=e.vertexAttributes)||void 0===t||t.forEach((e=>l(e))),null===(n=e.interleavedVertexAttributes)||void 0===n||n.forEach((e=>l(e))),l(e.index),l(e.edgeIndex),Array.isArray(e.objInfos)&&1===e.objInfos.length&&\"object\"==typeof e.objInfos[0]&&(null===(i=e.objInfos[0])||void 0===i?void 0:i.hasOwnProperty(\"displacementMap\"))){const t=e.objInfos[0];l(t.displacementMap)}Array.isArray(e.attachments)&&e.attachments.forEach((e=>{l(e.index),l(e.edgeIndex)}))})),null==s||s.techniques.forEach((e=>{(0,o.addBuffersToTransferList)(e,a)})),{response:s,transferList:a}}handleTileInfoRequest(e){const t=r.TileKey.fromMortonCode(e.tileKey),n=(0,i.getProjection)(e.projection);return this.m_decoder.getTileInfo(e.data,t,n).then((e=>({response:e,transferList:void 0!==e&&void 0!==e.transferList?e.transferList:[]})))}handleConfigurationMessage(e){this.m_decoder.configure(e,e.options)}}t.TileDecoderService=c},4773:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TilerService=void 0;const i=n(8152),r=n(2616),o=n(1781),s=n(2369);class a extends s.WorkerService{static start(e){return new a(e)}constructor(e){super(e),this.serviceId=e,this.tiler=new o.GeoJsonTiler}handleRequest(e){return i.WorkerTilerProtocol.isRegisterIndexRequest(e)?this.handleRegisterIndexRequest(e):i.WorkerTilerProtocol.isUpdateIndexRequest(e)?this.handleUpdateIndexRequest(e):i.WorkerTilerProtocol.isTileRequest(e)?this.handleTileRequest(e):super.handleRequest(e)}async handleTileRequest(e){const t=r.TileKey.fromMortonCode(e.tileKey);return{response:await this.tiler.getTile(e.index,t)||{}}}async handleRegisterIndexRequest(e){const t=\"string\"==typeof e.input?new URL(e.input):e.input;return await this.tiler.registerIndex(e.id,t),{response:{}}}async handleUpdateIndexRequest(e){const t=\"string\"==typeof e.input?new URL(e.input):e.input;return this.tiler.updateIndex(e.id,t),{response:{}}}}t.TilerService=a},2369:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WorkerService=void 0;const i=n(8152),r=n(4342).LoggerManager.instance.create(\"WorkerService\",{enabled:!0});t.WorkerService=class{constructor(e){this.serviceId=e,this.m_pendingRequests=new Map,this.onMessage=e=>{if(\"string\"==typeof e.data.service&&e.data.service===this.serviceId)try{if(i.WorkerServiceProtocol.isRequestMessage(e.data)){const t=e.data,n={service:t.service,messageId:t.messageId,responseSent:!1};this.m_pendingRequests.set(t.messageId,n),this.tryHandleRequest(t.request).then((e=>{this.doSendResponse(n,{service:this.serviceId,type:i.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,response:e.response},e.transferList)})).catch((e=>{this.doSendResponse(n,{service:this.serviceId,type:i.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,errorMessage:e.toString(),errorStack:e.stack})}))}else this.tryHandleMessage(e.data)}catch(t){r.error(`[${this.serviceId}]: Unhandled exception when handling ${e.type}`)}},self.addEventListener(\"message\",this.onMessage);const t={service:e,type:i.WorkerServiceProtocol.ServiceMessageName.Initialized};self.postMessage(t)}destroy(){this.cancelAllPendingRequests(),self.removeEventListener(\"message\",this.onMessage)}handleMessage(e){r.error(`[${this.serviceId}]: Invalid message ${e.type}`)}handleRequest(e){throw new Error(`ServiceAdapter[${this.serviceId}]: Invalid request '${e.type}'`)}tryHandleMessage(e){try{this.handleMessage(e)}catch(t){r.error(`[${this.serviceId}]: Failed, handling message ${e.type}`)}}tryHandleRequest(e){try{return this.handleRequest(e)}catch(e){return r.error(`[${this.serviceId}]: Failure`,e),Promise.reject(e)}}doSendResponse(e,t,n){e.responseSent||(void 0!==n?self.postMessage(t,n):self.postMessage(t),e.responseSent=!0,this.m_pendingRequests.delete(e.messageId))}cancelAllPendingRequests(){this.m_pendingRequests.forEach((e=>{this.doSendResponse(e,{service:this.serviceId,type:i.WorkerServiceProtocol.ServiceMessageName.Response,messageId:e.messageId,errorMessage:\"cancelled\"})}))}}},5199:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WorkerServiceManager=void 0;const i=n(8152),r=n(2369);class o extends r.WorkerService{static getInstance(){return void 0===this.m_service&&(this.m_service=new o(i.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID)),this.m_service}constructor(e=i.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID){super(e),this.m_factories=new Map,this.m_services=new Map}register(e){this.m_factories.set(e.serviceType,e.factory)}handleRequest(e){if(e.type===i.WorkerServiceProtocol.Requests.CreateService){if(void 0!==this.m_services.get(e.targetServiceId))throw Error(`error - service with targetServiceId='${e.targetServiceId}' already running, ignoring CreateService request`);const t=this.m_factories.get(e.targetServiceType);if(void 0===t)throw Error(`unknown targetServiceType requested: '${e.targetServiceType}'`);const n=t(e.targetServiceId);this.m_services.set(e.targetServiceId,n)}if(e.type===i.WorkerServiceProtocol.Requests.DestroyService){const t=this.m_services.get(e.targetServiceId);if(void 0===t)throw Error(`unknown targetServiceId '${e.targetServiceId}'`);t.destroy(),this.m_services.delete(e.targetServiceId)}return Promise.resolve({response:{}})}}t.WorkerServiceManager=o},4250:function(e,t,n){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!(\"get\"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),r(n(8583),t),r(n(8014),t),r(n(8955),t),r(n(8177),t),r(n(8878),t),r(n(5997),t),r(n(674),t),r(n(4744),t),r(n(4258),t),r(n(398),t),r(n(4919),t),r(n(5551),t),r(n(4821),t),r(n(4877),t),r(n(8484),t),r(n(460),t),r(n(4121),t),r(n(1549),t),r(n(2462),t),r(n(182),t),r(n(872),t),r(n(9489),t),r(n(4067),t),r(n(71),t),r(n(3224),t),r(n(2141),t),r(n(3298),t),r(n(9528),t),r(n(8578),t)},460:function(e,t,n){\"use strict\";var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&\"function\"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(t,\"__esModule\",{value:!0}),t.CirclePointsMaterial=void 0;const r=n(82),o=n(2141),s=n(8578);class a extends o.RawShaderMaterial{constructor(e){const t=new r.Color;let n,o,l,c;if(e){const{size:s,color:u,opacity:h}=e,d=i(e,[\"size\",\"color\",\"opacity\"]);n=s,o=u,l=h,d.name=\"CirclePointsMaterial\",d.vertexShader=\"\\nuniform float size;\\nuniform mat4 modelViewMatrix;\\nuniform mat4 projectionMatrix;\\n\\nattribute vec3 position;\\n\\nvoid main() {\\n    vec3 transformed = vec3(position);\\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\\n\\n    gl_Position = projectionMatrix * mvPosition;\\n    gl_PointSize = size;\\n}\\n\",d.fragmentShader=\"\\nprecision highp float;\\nprecision highp int;\\n\\nuniform vec3 diffuseColor;\\nuniform float opacity;\\n\\nvoid main() {\\n    float alpha = opacity;\\n\\n    float radius = 0.5;\\n    vec2 coords = gl_PointCoord.xy - vec2(0.5);\\n    float len = length(coords);\\n    float falloff = fwidth(len);\\n    float threshold = 1.0 - smoothstep(radius - falloff, radius, len);\\n    alpha *= threshold;\\n\\n    gl_FragColor = vec4(diffuseColor, alpha);\\n}\",d.uniforms=r.UniformsUtils.merge([{size:new r.Uniform(a.DEFAULT_CIRCLE_SIZE),diffuseColor:new r.Uniform(t),opacity:new r.Uniform(1)},r.UniformsLib.fog]),d.depthTest=!1,d.extensions=Object.assign(Object.assign({},d.extensions),{derivatives:!0}),c=d}super(c),(0,s.enforceBlending)(this),this.type=\"CirclePointsMaterial\",this.setOpacity(1),void 0!==n&&(this.size=n),void 0!==o&&(this.color=o),void 0!==l&&this.setOpacity(l)}get size(){return this.uniforms.size.value}set size(e){this.uniforms.size.value=e}get color(){return this.uniforms.diffuseColor.value}set color(e){this.uniforms.diffuseColor.value.copy(e)}}t.CirclePointsMaterial=a,a.DEFAULT_CIRCLE_SIZE=1},4121:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.CopyMaterial=t.CopyShader=void 0;const i=n(82);t.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:\"\\n    varying vec2 vUv;\\n    void main() {\\n        vUv = uv;\\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n    }\",fragmentShader:\"\\n    uniform float opacity;\\n    uniform sampler2D tDiffuse;\\n    varying vec2 vUv;\\n    void main() {\\n        vec4 texel = texture2D( tDiffuse, vUv );\\n        gl_FragColor = opacity * texel;\\n    }\"};class r extends i.ShaderMaterial{constructor(e){super({name:\"CopyMaterial\",uniforms:e,vertexShader:t.CopyShader.vertexShader,fragmentShader:t.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!1,blending:i.NoBlending,depthTest:!1,depthWrite:!1})}}t.CopyMaterial=r},1549:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.EdgeMaterial=void 0;const i=n(82),r=n(8014),o=n(8955),s=n(8177),a=n(2141),l=n(8578);class c extends a.RawShaderMaterial{constructor(e){var t;let n;if(e){const r={},a=void 0!==e.extrusionRatio&&e.extrusionRatio>=o.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN&&e.extrusionRatio<o.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX;e.displacementMap&&(0,l.setShaderDefine)(r,\"USE_DISPLACEMENTMAP\",!0),a&&(0,l.setShaderDefine)(r,\"USE_EXTRUSION\",!0),!0===e.vertexColors&&(0,l.setShaderDefine)(r,\"USE_COLOR\",!0),n={name:\"EdgeMaterial\",vertexShader:\"\\n#define EDGE_DEPTH_OFFSET 0.0001\\n\\n#ifdef USE_COLOR\\nattribute vec4 color;\\n#else\\nuniform vec3 color;\\n#endif\\n\\n// SHADER_NAME may be defined by THREE.JS own shaders in which case these attributes & uniforms are\\n// already defined\\n#ifndef SHADER_NAME\\nattribute vec3 position;\\nuniform mat4 modelViewMatrix;\\nuniform mat4 projectionMatrix;\\nuniform mat3 normalMatrix;\\n#endif\\n\\nuniform vec3 edgeColor;\\nuniform float edgeColorMix;\\n\\n#ifdef USE_DISPLACEMENTMAP\\nattribute vec3 normal;\\nattribute vec2 uv;\\nuniform sampler2D displacementMap;\\n#endif\\n\\nvarying vec3 vColor;\\n\\n#ifdef USE_EXTRUSION\\n#include <extrusion_pars_vertex>\\n#endif\\n\\n#ifdef USE_FADING\\n#include <fading_pars_vertex>\\n#endif\\n\\nvoid main() {\\n\\n    vColor = mix(edgeColor.rgb, color.rgb, edgeColorMix);\\n\\n    vec3 transformed = vec3( position );\\n\\n    #ifdef USE_EXTRUSION\\n    #include <extrusion_vertex>\\n    #endif\\n\\n    #ifdef USE_DISPLACEMENTMAP\\n    transformed += normalize( normal ) * texture2D( displacementMap, uv ).x;\\n    #endif\\n\\n    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\\n\\n    gl_Position = projectionMatrix * mvPosition;\\n    // After projection gl_Position contains clip space coordinates of each vertex\\n    // before perspective division (1 / w), thus only vertexes with -w < z < w should\\n    // be displayed and offset. We offset only those edges which z coordinate in NDC\\n    // space is between: -inf < z < 1\\n    float depthOffset = step(-1.0, -gl_Position.z / gl_Position.w) * EDGE_DEPTH_OFFSET;\\n    gl_Position.z -= depthOffset;\\n\\n    #ifdef USE_FADING\\n    #include <fading_vertex>\\n    #endif\\n}\",fragmentShader:\"\\nprecision highp float;\\nprecision highp int;\\n\\nvarying vec3 vColor;\\n\\n#ifdef USE_EXTRUSION\\n#include <extrusion_pars_fragment>\\n#endif\\n\\n#ifdef USE_FADING\\n#include <fading_pars_fragment>\\n#endif\\n\\nvoid main() {\\n    float alphaValue = 1.0;\\n    gl_FragColor = vec4(vColor, alphaValue);\\n\\n    #ifdef USE_EXTRUSION\\n    #include <extrusion_fragment>\\n    #endif\\n\\n    #ifdef USE_FADING\\n    #include <fading_fragment>\\n    #endif\\n}\",uniforms:{color:new i.Uniform(new i.Color(c.DEFAULT_COLOR)),edgeColor:new i.Uniform(new i.Color(c.DEFAULT_COLOR)),edgeColorMix:new i.Uniform(c.DEFAULT_COLOR_MIX),fadeNear:new i.Uniform(s.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new i.Uniform(s.FadingFeature.DEFAULT_FADE_FAR),extrusionRatio:new i.Uniform(o.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX),displacementMap:new i.Uniform(null!==(t=e.displacementMap)&&void 0!==t?t:new i.Texture)},depthWrite:!1,defines:r,rendererCapabilities:e.rendererCapabilities}}super(n),(0,l.enforceBlending)(this),s.FadingFeature.patchGlobalShaderChunks(),r.ExtrusionFeature.patchGlobalShaderChunks(),void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.colorMix&&(this.colorMix=e.colorMix),void 0!==e.fadeNear&&(this.fadeNear=e.fadeNear),void 0!==e.fadeFar&&(this.fadeFar=e.fadeFar),void 0!==e.displacementMap&&(this.displacementMap=e.displacementMap),void 0!==e.extrusionRatio&&(this.extrusionRatio=e.extrusionRatio))}get objectColor(){return this.uniforms.color.value}set objectColor(e){this.uniforms.color.value.copy(e)}get color(){return this.uniforms.edgeColor.value}set color(e){this.uniforms.edgeColor.value.copy(e)}get lineWidth(){return this.linewidth}set lineWidth(e){this.linewidth=e,this.linewidth<=0?this.visible=!1:this.visible=!0}get colorMix(){return this.uniforms.edgeColorMix.value}set colorMix(e){this.uniforms.edgeColorMix.value!==e&&(this.uniforms.edgeColorMix.value=e)}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){this.uniforms.fadeFar.value!==e&&(this.uniforms.fadeFar.value=e,(0,l.setShaderMaterialDefine)(this,\"USE_FADING\",e>0))}get extrusionRatio(){return this.uniforms.extrusionRatio.value}set extrusionRatio(e){if(this.uniforms.extrusionRatio.value===e)return;this.uniforms.extrusionRatio.value=e;const t=e>=o.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN;(0,l.setShaderMaterialDefine)(this,\"USE_EXTRUSION\",t)}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){if(this.uniforms.displacementMap.value===e)return;this.uniforms.displacementMap.value=e;const t=null!==e;t&&(this.uniforms.displacementMap.value.needsUpdate=!0),(0,l.setShaderMaterialDefine)(this,\"USE_DISPLACEMENTMAP\",t)}}t.EdgeMaterial=c,c.DEFAULT_COLOR=0,c.DEFAULT_COLOR_MIX=0},2462:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GroundAtmosphereMaterial=t.GroundAtmosphereShader=void 0;const i=n(82),r=n(2141),o=n(1870),s=n(8578);t.GroundAtmosphereShader={uniforms:{u_eyePositionWorld:new i.Uniform(new i.Vector3),u_lightDirectionWorld:new i.Uniform(new i.Vector3(0,1,0)),u_modelViewProjection:new i.Uniform(new i.Matrix4),u_atmosphereEnv:new i.Uniform(new i.Vector3(6384515.136999999,6537590.425,0)),u_hsvCorrection:new i.Uniform(new i.Vector3(0,0,0)),topColor:new i.Uniform(new i.Color(30719)),bottomColor:new i.Uniform(new i.Color(16777215)),offset:new i.Uniform(33),exponent:new i.Uniform(.6),fogColor:new i.Uniform(new i.Color(30719)),fogNear:new i.Uniform(new i.Color(30719)),fogFar:new i.Uniform(new i.Color(16777215))},vertexShader:`\\n\\n    #define IMPROVE_INTERSECT_PRECISION 1\\n    #define IMPROVE_DOT_PRECISION 1\\n\\n    precision highp float;\\n    precision highp int;\\n\\n    attribute vec4 position;\\n\\n    // Base mandatory uniforms\\n    uniform mat4 u_modelViewProjection;\\n    uniform vec3 u_eyePositionWorld;\\n    uniform vec3 u_lightDirectionWorld;\\n\\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\\n    uniform vec3 u_hsvCorrection;\\n\\n    const float Pi = 3.141592653589793;\\n    const float Kr = 0.0025;\\n    const float Km = 0.0015;\\n    const float Kr4PI = Kr * 4.0 * Pi;\\n    const float Km4PI = Km * 4.0 * Pi;\\n    const float ESun = 25.0; // should be 15.0\\n    const float KmESun = Km * ESun;\\n    const float KrESun = Kr * ESun;\\n    const vec3 InvWavelength = vec3(\\n        1.0 / pow(0.650, 4.0), // Red\\n        1.0 / pow(0.570, 4.0), // Green\\n        1.0 / pow(0.475, 4.0)); // Blue\\n\\n    const int nSamples = 2;\\n    const float fSamples = 2.0;\\n\\n    varying vec3 v_rayleighColor;\\n    varying vec3 v_mieColor;\\n    varying vec3 v_vertToCamera;\\n    varying vec3 v_vertToOrigin;\\n\\n    ${o.default.atmosphere_vertex_utils}\\n\\n    //\\n    // Computes rayleight and mia atmosphere factors for ground.\\n    //\\n    // Code based on GPU Gems article.\\n    //\\n    // Author: Sean O'Neil\\n    //\\n    // Copyright (c) 2004 Sean O'Neil\\n    //\\n    // https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering\\n    //\\n    // Further modifications by HERE.\\n    //\\n    AtmosphereColor computeGroundAtmosphere(vec3 v3Pos, vec3 vLightDir)\\n    {\\n        // Retrieve environment variables\\n        float fInnerRadius = u_atmosphereEnv.x;\\n        float fOuterRadius = u_atmosphereEnv.y;\\n        float fCameraHeight = u_atmosphereEnv.z;\\n\\n        // All that may be moved to const or define(s) at further optimizations:\\n        float fScale = 1.0 / (fOuterRadius - fInnerRadius);\\n        float fScaleOverScaleDepth = fScale / RayleighScaleDepth;\\n        float fCameraHeight2 = fCameraHeight * fCameraHeight;\\n        float fOuterRadius2 = fOuterRadius * fOuterRadius;\\n\\n        // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\\n        vec3 v3Ray = v3Pos - u_eyePositionWorld;\\n        float fFar = length(v3Ray);\\n        v3Ray /= fFar;\\n\\n#if !defined(IMPROVE_DOT_PRECISION)\\n        vec3 v3Dir = normalize(v3Pos);\\n#endif\\n\\n#ifdef CAMERA_IN_SPACE\\n\\n        // Calculate first point of camera ray and sphere intersection.\\n        float fNear = getNearSphereIntersect(u_eyePositionWorld, v3Ray, fCameraHeight2, fOuterRadius2);\\n        // Make far relative to first atmosphere intersection, setting it to\\n        // the length of ray passed through atmosphere\\n        fFar -= fNear;\\n\\n        // Compute the ray's starting position within the atmosphere, then\\n        // calculate its scattering offset\\n        vec3 v3Start = u_eyePositionWorld + v3Ray * fNear;\\n        float fDepth = exp((fInnerRadius - fOuterRadius) / RayleighScaleDepth);\\n\\n#else // CAMERA_IN_ATMOSPHERE\\n\\n        // The ray starts already in atmosphere\\n        vec3 v3Start = u_eyePositionWorld;\\n        // Virtually fNear is just at eye position, so ray passing through atmosphere does not shorten\\n        // fFar -= 0.0;\\n        float fDepth = exp((fInnerRadius - fCameraHeight) / RayleighScaleDepth);\\n#endif\\n\\n#if defined(IMPROVE_DOT_PRECISION)\\n        float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\\n#else\\n        float fCameraAngle = dot(-v3Ray, v3Dir);\\n#endif\\n        float fCameraScale = scale(fCameraAngle);\\n\\n#ifdef DYNAMIC_LIGHT\\n        // When we want the atmosphere to be uniform over the globe so it is set to 1.0.\\n        #if defined(IMPROVE_DOT_PRECISION)\\n            // The light angle for given light source may be calculated as:\\n            // angle = dot(vLightDir, v3Dir) / length(v3Dir);\\n            // where v3Dir holds normalized vertex position, but for precision issues we v3Pos (un-normalized)\\n            float fLightAngle = dot(vLightDir, v3Pos) / length(v3Pos);\\n        #else\\n            float fLightAngle = dot(vLightDir, v3Dir);\\n        #endif\\n#else\\n        float fLightAngle = 1.0;\\n#endif\\n        float fLightScale = scale(fLightAngle);\\n\\n        float fCameraOffset = fDepth * fCameraScale;\\n        float fTemp = (fLightScale + fCameraScale);\\n\\n        // Initialize the scattering loop variables\\n        float fSampleLength = fFar / fSamples;\\n        float fScaledLength = fSampleLength * fScale;\\n        vec3 v3SampleRay = v3Ray * fSampleLength;\\n        vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\\n\\n        // Now loop through the sample rays\\n        vec3 v3BaseColor = vec3(0.0);\\n        vec3 v3Attenuate = vec3(0.0);\\n        for(int i = 0; i < nSamples; i++)\\n        {\\n            float fHeight = length(v3SamplePoint);\\n            float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\\n            float fScatter = fDepth * fTemp - fCameraOffset;\\n            // Compute color factors\\n            v3Attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\\n            v3BaseColor += v3Attenuate * (fDepth * fScaledLength);\\n            // Move to the next point\\n            v3SamplePoint += v3SampleRay;\\n        }\\n\\n        AtmosphereColor color;\\n        color.mie = v3BaseColor * (InvWavelength * KrESun + KmESun);\\n        // Calculate the attenuation factor for the ground\\n        color.rayleigh = v3Attenuate;\\n\\n        return color;\\n    }\\n\\n    void main(void)\\n    {\\n        #ifdef DYNAMIC_LIGHT\\n            vec3 vLightDir = u_lightDirectionWorld;\\n        #else\\n            vec3 vLightDir = u_eyePositionWorld;\\n        #endif\\n        vLightDir = normalize(vLightDir);\\n\\n        AtmosphereColor atmColor = computeGroundAtmosphere(position.xyz, vLightDir);\\n        v_mieColor = atmColor.mie;\\n        v_rayleighColor = atmColor.rayleigh;\\n        v_vertToCamera = u_eyePositionWorld - position.xyz;\\n        v_vertToOrigin = normalize(position.xyz);\\n\\n        gl_Position = u_modelViewProjection * position;\\n    }\\n    `,fragmentShader:`\\n\\n    // Exposure correction gives more subtle gradients on the ground.\\n    #define CORRECT_EXPOSURE 1\\n    #define FADE_DEPTH 1\\n    #define NIGHT_LOCAL 1\\n\\n    precision highp float;\\n    precision highp int;\\n\\n    #ifdef CORRECT_COLOR\\n    uniform vec3 u_hsvCorrection; // Hue, saturation, brightness\\n    #endif\\n\\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\\n    uniform vec3 u_eyePositionWorld;\\n    uniform vec3 u_lightDirectionWorld;\\n\\n    const float g = -0.95;\\n    const float g2 = g * g;\\n\\n    varying vec3 v_rayleighColor;\\n    varying vec3 v_mieColor;\\n    varying vec3 v_vertToCamera;\\n    varying vec3 v_vertToOrigin;\\n\\n    ${o.default.atmosphere_fragment_utils}\\n\\n    void main(void)\\n    {\\n        float fInnerRadius = u_atmosphereEnv.x;\\n        float fOuterRadius = u_atmosphereEnv.y;\\n        float fCameraHeight = u_atmosphereEnv.z;\\n\\n        #ifdef DYNAMIC_LIGHT\\n            vec3 vLightDir = u_lightDirectionWorld;\\n        #else\\n            vec3 vLightDir = u_eyePositionWorld;\\n        #endif\\n        vLightDir = normalize(vLightDir);\\n\\n        // GPU gems mix of ground solution, with custom alpha settings\\n        vec3 cRgb = v_mieColor + 0.25 * v_rayleighColor;\\n\\n        // Not needed for HDR frame buffer\\n    #if !defined(HDR_FRAME_BUFFER) && defined(CORRECT_EXPOSURE)\\n        // Interesting results with exposure factor: 2.0, 3.5, 4.0\\n        cRgb = correctExposure(cRgb, 3.0);\\n    #endif\\n\\n    #ifdef CORRECT_COLOR\\n        cRgb = correctColor(cRgb, u_hsvCorrection);\\n    #endif\\n\\n        // Base atmosphere opacity\\n        float fAtmosphereAlpha = 1.0;\\n\\n        // Factor based on the distance of camera atmosphere and ground, results are:\\n        // 0.0 = camera on the ground surface,\\n        // 1.0 = at the outer edge of the atmosphere.\\n        float fDepthFactor = clamp((fCameraHeight - fInnerRadius) /\\n            (fOuterRadius - fInnerRadius), 0.0, 1.0);\\n    #ifdef FADE_DEPTH\\n        // Fade alpha based on the distance of camera between atmosphere layers\\n        #ifdef FADE_DEPTH_LINEAR\\n            fAtmosphereAlpha *= fDepthFactor;\\n        #else\\n            fAtmosphereAlpha *= pow(fDepthFactor, 1.5);\\n        #endif\\n    #endif\\n\\n#if defined(FADE_NIGHT) || defined(DARKEN_NIGHT)\\n    #ifdef DYNAMIC_LIGHT\\n        // Adjust factor based on time of day, results are:\\n        // 0.0 = night,\\n        // 1.0 = day.\\n        #ifdef NIGHT_GLOBAL\\n            // Global night fade based on camera and light orientation\\n            float fNightFactor = clamp(dot(normalize(u_eyePositionWorld), vLightDir), 0.0, 1.0);\\n            fNightFactor = pow(fNightFactor, 0.5);\\n        #else // NIGHT_LOCAL\\n            float fNightFactor =\\n                clamp(dot(v_vertToOrigin, vLightDir) / length(v_vertToOrigin), 0.0, 1.0);\\n            fNightFactor = pow(fNightFactor, 0.8);\\n        #endif\\n    #else\\n        float fNightFactor = 1.0;\\n    #endif\\n#endif\\n\\n    #ifdef FADE_NIGHT\\n        // Adjust alpha for night side of the globe\\n        fAtmosphereAlpha *= fNightFactor;\\n    #endif\\n\\n    #ifdef DARKEN_NIGHT\\n        // Change the brightness depending on night / day side.\\n        // NOTE: Darkening should be rather applied in HSV space, without loss on saturation,\\n        // but it is much more GPU consuming.\\n        const float minBrightness = 0.5;\\n        float fDarkenFactor = clamp(fNightFactor, minBrightness, 1.0);\\n        cRgb *= fDarkenFactor;\\n    #endif\\n\\n    #ifdef EXPOSURE_DEPTH\\n        // Control exposure depending from ground distance\\n        float exposureBoost = 3.0 - fDepthFactor;\\n        cRgb = correctExposure(cRgb, exposureBoost);\\n    #endif\\n\\n        // Experimental fading out of focus point - similar to fresnel effect in top view.\\n        // This fade is handy to better expose cartographic/map features in screen center.\\n        float fFocusFactor = 1.0 - clamp(dot(normalize(v_vertToCamera), v_vertToOrigin), 0.0, 1.0) + 0.1;\\n        fFocusFactor = pow(fFocusFactor, 2.5);\\n        fAtmosphereAlpha *= fFocusFactor;\\n\\n        // Integrate all features\\n        gl_FragColor = vec4(cRgb, fAtmosphereAlpha);\\n    }\\n    `};class a extends r.RawShaderMaterial{constructor(e){let n;e&&(n={name:\"GroundAtmosphereMaterial\",vertexShader:t.GroundAtmosphereShader.vertexShader,fragmentShader:t.GroundAtmosphereShader.fragmentShader,uniforms:t.GroundAtmosphereShader.uniforms,transparent:!0,depthTest:!1,depthWrite:!1,side:i.FrontSide,blending:i.NormalBlending,fog:!1,rendererCapabilities:e.rendererCapabilities}),super(n)}setDynamicLighting(e){(0,s.setShaderMaterialDefine)(this,\"DYNAMIC_LIGHT\",e)}set outerRadius(e){this.uniforms.u_atmosphereEnv.value.y=e}get outerRadius(){return this.uniforms.u_atmosphereEnv.value.y}set innerRadius(e){this.uniforms.u_atmosphereEnv.value.x=e}get innerRadius(){return this.uniforms.u_atmosphereEnv.value.x}updateUniforms(e,t,n,i){const r=this.getCameraInfo(t,n);if(void 0===e||!e.isMaterial)throw Error(\"Wrong object used, only Material objects are supported\");if(!(e.uniforms&&e.uniforms.u_atmosphereEnv&&e.uniforms.u_hsvCorrection&&e.uniforms.u_eyePositionWorld&&e.uniforms.u_modelViewProjection&&e.uniforms.u_lightDirectionWorld))throw Error(\"Atmosphere material has missing uniforms\");{const t=r.eyePos,n=r.modelViewProjection,o=r.eyeHeight;e.uniforms.u_eyePositionWorld.value.copy(t),e.uniforms.u_modelViewProjection.value.copy(n),e.uniforms.u_atmosphereEnv.value.z=o,e.uniforms.u_lightDirectionWorld.value=i.clone();const a=o>this.outerRadius,l=(0,s.setShaderDefine)(e.defines,\"CAMERA_IN_SPACE\",a),c=(0,s.setShaderDefine)(e.defines,\"CAMERA_IN_ATMOSPHERE\",!a);e.needsUpdate=e.needsUpdate||l||c}}getCameraInfo(e,t,n=!1){if(n){const n=(new i.Matrix4).identity(),r=(new i.Matrix4).copy(e.matrixWorld).invert().transpose(),o=t.projectionMatrix,s=new i.Matrix4;s.multiplyMatrices(r,n),s.multiplyMatrices(o,s);const a=new i.Vector3;e.getWorldPosition(a);const l=new i.Vector3;return t.getWorldPosition(l),{modelViewProjection:s,eyePos:a,eyeHeight:l.distanceTo(a)}}{const n=e.matrixWorld,r=t.matrixWorldInverse,o=t.projectionMatrix,s=new i.Matrix4;s.multiplyMatrices(r,n),s.multiplyMatrices(o,s);const a=new i.Vector3;t.getWorldPosition(a);const l=new i.Vector3;e.getWorldPosition(l);const c=l.distanceTo(a);return a.sub(l),{modelViewProjection:s,eyePos:a,eyeHeight:c}}}}t.GroundAtmosphereMaterial=a},182:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isHighPrecisionLineMaterial=t.HighPrecisionLineMaterial=void 0;const i=n(82),r=n(2141),o=n(7133);class s extends r.RawShaderMaterial{constructor(e){Object.assign(i.ShaderChunk,o.default);const t=e?{name:\"HighPrecisionLineMaterial\",vertexShader:\"\\n#ifdef USE_COLOR\\nattribute vec4 color;\\nvarying vec3 vColor;\\n#endif\\n\\n// uniforms to implement double-precision\\nuniform mat4 u_mvp;             // combined modelView and projection matrix\\nuniform vec3 u_eyepos;          // eye position major\\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\\n\\n// vertex attributes\\nattribute vec3 position;        // high part\\nattribute vec3 positionLow;     // low part\\n\\n#include <high_precision_vert_func>\\n\\nvoid main() {\\n    #ifdef USE_COLOR\\n    vColor = color.rgb;\\n    #endif\\n\\n    vec3 pos = subtractDblEyePos(position);\\n    gl_Position = u_mvp * vec4(pos, 1.0);\\n}\",fragmentShader:\"\\nprecision highp float;\\nprecision highp int;\\n\\nuniform vec3 diffuseColor;\\nuniform float opacity;\\n\\n#ifdef USE_COLOR\\nvarying vec3 color;\\n#endif\\n\\nvoid main() {\\n    #ifdef USE_COLOR\\n    gl_FragColor = vec4( diffuseColor * vColor, opacity );\\n    #else\\n    gl_FragColor = vec4( diffuseColor, opacity );\\n    #endif\\n}\",uniforms:{diffuseColor:new i.Uniform(new i.Color(s.DEFAULT_COLOR)),opacity:new i.Uniform(s.DEFAULT_OPACITY),u_mvp:new i.Uniform(new i.Matrix4),u_eyepos:new i.Uniform(new i.Vector3),u_eyepos_lowpart:new i.Uniform(new i.Vector3)},rendererCapabilities:e.rendererCapabilities}:void 0;t&&Object.assign(t,e),super(t),this.type=\"HighPrecisionLineMaterial\",this.isHighPrecisionLineMaterial=!0,e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.opacity&&(this.opacity=e.opacity)),this.updateTransparencyFeature()}get color(){return this.uniforms.diffuseColor.value}set color(e){this.uniforms.diffuseColor.value.copy(e)}updateTransparencyFeature(){this.transparent=this.opacity<1}}t.HighPrecisionLineMaterial=s,s.DEFAULT_COLOR=80,s.DEFAULT_OPACITY=1,t.isHighPrecisionLineMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionLineMaterial}},872:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isHighPrecisionPointMaterial=t.HighPrecisionPointMaterial=void 0;const i=n(82),r=n(7133);class o extends i.PointsMaterial{constructor(e){Object.assign(i.ShaderChunk,r.default),super(e),this.type=\"HighPrecisionPointMaterial\",this.vertexShader=\"\\n#ifdef USE_COLOR\\nvarying vec3 vColor;\\n#endif\\n\\nuniform float size;\\n\\n// uniforms to implement double-precision\\nuniform mat4 u_mvp;             // combined modelView and projection matrix\\nuniform vec3 u_eyepos;          // eye position major\\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\\n\\n// vertex attributes\\nattribute vec3 positionLow;     // low part\\n\\n#include <high_precision_vert_func>\\n\\nvoid main() {\\n    #ifdef USE_COLOR\\n    vColor = color.rgb;\\n    #endif\\n\\n    vec3 pos = subtractDblEyePos(position);\\n    gl_Position = u_mvp * vec4(pos, 1.0);\\n\\n    // ignore sizeAttenuation for now!\\n    gl_PointSize = size;\\n}\",this.fragmentShader=i.ShaderChunk.points_frag,this.fog=!1,this.uniforms={diffuseColor:new i.Uniform(new i.Color(o.DEFAULT_COLOR)),opacity:new i.Uniform(o.DEFAULT_OPACITY),size:new i.Uniform(o.DEFAULT_SIZE),scale:new i.Uniform(o.DEFAULT_SCALE),map:new i.Uniform(new i.Texture),uvTransform:new i.Uniform(new i.Matrix3),u_mvp:new i.Uniform(new i.Matrix4),u_eyepos:new i.Uniform(new i.Vector3),u_eyepos_lowpart:new i.Uniform(new i.Vector3)},this.isHighPrecisionPointMaterial=!0,void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.opacity&&(this.opacity=e.opacity),void 0!==e.size&&(this.size=e.size),void 0!==e.scale&&(this.scale=e.scale),void 0!==e.uvTransform&&(this.uvTransform=e.uvTransform),void 0!==e.map&&(this.map=e.map))}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}get uvTransform(){return this.uniforms.uvTransform.value}set uvTransform(e){this.uniforms.uvTransform.value=e}}t.HighPrecisionPointMaterial=o,o.DEFAULT_COLOR=80,o.DEFAULT_OPACITY=1,o.DEFAULT_SIZE=1,o.DEFAULT_SCALE=1,t.isHighPrecisionPointMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionPointMaterial}},9489:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.IconMaterial=void 0;const i=n(82),r=n(2141);class o extends r.RawShaderMaterial{constructor(e){super(e?{name:\"IconMaterial\",vertexShader:\"\\nattribute vec4 position;\\nattribute vec4 color;\\nattribute vec2 uv;\\n\\nuniform mat4 modelViewMatrix;\\nuniform mat4 projectionMatrix;\\n\\nvarying vec4 vColor;\\nvarying vec2 vUv;\\n\\nvoid main() {\\n    vUv = uv;\\n    vColor = color;\\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\\n}\",fragmentShader:\"\\nprecision highp float;\\nprecision highp int;\\n\\nuniform sampler2D map;\\n\\nvarying vec4 vColor;\\nvarying vec2 vUv;\\n\\nvoid main() {\\n\\n    vec4 color = texture2D(map, vUv.xy);\\n    color *= vColor;\\n    if (color.a < 0.05) {\\n        discard;\\n    }\\n    gl_FragColor = color;\\n}\",uniforms:{map:new i.Uniform(e.map)},depthTest:!1,depthWrite:!1,transparent:!0,vertexColors:!0,premultipliedAlpha:!0,rendererCapabilities:e.rendererCapabilities}:void 0)}get map(){return this.uniforms.map.value}}t.IconMaterial=o},3224:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MSAAMaterial=void 0;const i=n(82),r=n(4121);class o extends i.ShaderMaterial{constructor(e){super({uniforms:e,vertexShader:r.CopyShader.vertexShader,fragmentShader:r.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:i.AdditiveBlending,depthTest:!1,depthWrite:!1})}}t.MSAAMaterial=o},4821:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MapMeshBasicMaterial=void 0;const i=n(82),r=n(4342),o=n(4744),s=n(8014),a=n(8955),l=n(8177),c=n(4258),u=n(8878),h=n(5997),d=n(674);class p extends i.MeshBasicMaterial{constructor(e){super(e),l.FadingFeature.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),s.ExtrusionFeature.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),this.addDisplacementProperties(),this.applyDisplacementParameters(e),o.ColorCorrectionFeature.patchGlobalShaderChunks(),this.addColorCorrectionProperties(),this.applyColorCorrectionParameters(e)}clone(){return(new p).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this.copyDisplacementParameters(e),this.copyColorCorrectionParameters(e),this}get fadeNear(){return l.FadingFeature.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return l.FadingFeature.DEFAULT_FADE_FAR}set fadeFar(e){}set brightness(e){}get brightness(){return o.ColorCorrectionFeature.DEFAULT_BRIGHTNESS}set gamma(e){}get gamma(){return o.ColorCorrectionFeature.DEFAULT_GAMMA}get extrusionRatio(){return a.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}get displacementMap(){return null}set displacementMap(e){}setDisplacementMap(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}addDisplacementProperties(){}copyColorCorrectionParameters(e){}applyDisplacementParameters(e){}copyDisplacementParameters(e){}addColorCorrectionProperties(){}applyColorCorrectionParameters(e){}}t.MapMeshBasicMaterial=p,(0,r.applyMixinsWithoutProperties)(p,[d.FadingFeatureMixin]),(0,r.applyMixinsWithoutProperties)(p,[h.ExtrusionFeatureMixin]),(0,r.applyMixinsWithoutProperties)(p,[u.DisplacementFeatureMixin]),(0,r.applyMixinsWithoutProperties)(p,[c.ColorCorrectionFeatureMixin])},8484:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MapMeshDepthMaterial=void 0;const i=n(82),r=n(4342),o=n(8014),s=n(8955),a=n(5997);class l extends i.MeshDepthMaterial{constructor(e){super(e),o.ExtrusionFeature.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!1}))}get extrusionRatio(){return s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshDepthMaterial=l,(0,r.applyMixinsWithoutProperties)(l,[a.ExtrusionFeatureMixin])},4877:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MapMeshPhongMaterial=void 0;const i=n(82),r=n(4342),o=n(8014),s=n(8955),a=n(8177),l=n(71),c=n(5997),u=n(674),h=n(5089);class d extends i.MeshPhongMaterial{constructor(e){var t;super(e),a.FadingFeature.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),o.ExtrusionFeature.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),this.m_colorIntensity=null!==(t=null==e?void 0:e.colorIntensity)&&void 0!==t?t:1,this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{(0,l.linkMixinWithShader)(this,e),e.fragmentShader=e.fragmentShader.replace(\"#include <lights_phong_pars_fragment>\",`#include <lights_phong_pars_fragment>\\n                ${h.blinnPhongNoSpecular}\\n                `)})),(0,l.linkMixinWithMaterial)(this,this),(0,r.assert)(void 0!==this.shaderDefines),(0,r.assert)(void 0!==this.shaderUniforms),this.shaderUniforms.colorIntensity=new i.Uniform(this.colorIntensity)}clone(){return(new d).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this.colorIntensity=e.colorIntensity,this}get colorIntensity(){return this.m_colorIntensity}set colorIntensity(e){this.m_colorIntensity=e,this.shaderUniforms.colorIntensity.value=e}get fadeNear(){return a.FadingFeature.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return a.FadingFeature.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshPhongMaterial=d,(0,r.applyMixinsWithoutProperties)(d,[u.FadingFeatureMixin]),(0,r.applyMixinsWithoutProperties)(d,[c.ExtrusionFeatureMixin])},4067:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MapMeshStandardMaterial=void 0;const i=n(82),r=n(4342),o=n(8014),s=n(8955),a=n(8177),l=n(5997),c=n(674),u=n(759);class h extends i.MeshStandardMaterial{constructor(e){super(e),a.FadingFeature.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),o.ExtrusionFeature.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),!0===(null==e?void 0:e.removeDiffuseLight)&&(this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{e.fragmentShader=i.ShaderChunk.meshphysical_frag.replace(\"#include <lights_physical_pars_fragment>\",u.simpleLightingShadowChunk)})))}clone(){return(new h).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this}get fadeNear(){return a.FadingFeature.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return a.FadingFeature.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}get removeDiffuseLight(){return!1}set removeDiffuseLight(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshStandardMaterial=h,(0,r.applyMixinsWithoutProperties)(h,[c.FadingFeatureMixin]),(0,r.applyMixinsWithoutProperties)(h,[l.ExtrusionFeatureMixin])},71:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.linkMixinWithShader=t.linkMixinWithMaterial=t.cameraToWorldDistance=void 0,t.cameraToWorldDistance=function(e,t){return e*t.maximum},t.linkMixinWithMaterial=function(e,t){void 0===t.defines&&(t.defines={}),e.shaderDefines=t.defines,void 0===e.shaderUniforms&&(e.shaderUniforms={})},t.linkMixinWithShader=function(e,t){Object.assign(t.uniforms,e.shaderUniforms),e.shaderUniforms=t.uniforms}},2141:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.RawShaderMaterial=void 0;const i=n(82),r=n(4342),o=n(8578);class s extends i.RawShaderMaterial{constructor(e){const t=!0===(null==e?void 0:e.rendererCapabilities.isWebGL2),n=e?Object.assign(Object.assign({},e),{glslVersion:t?i.GLSL3:i.GLSL1,vertexShader:t&&e.vertexShader?(0,r.convertVertexShaderToWebGL2)(e.vertexShader):e.vertexShader,fragmentShader:t&&e.fragmentShader?(0,r.convertFragmentShaderToWebGL2)(e.fragmentShader):e.fragmentShader}):void 0;n&&delete n.rendererCapabilities,super(n),this.invalidateFog(),this.setOpacity(null==n?void 0:n.opacity)}invalidateFog(){void 0!==this.defines&&this.fog!==(0,o.getShaderMaterialDefine)(this,\"USE_FOG\")&&(0,o.setShaderMaterialDefine)(this,\"USE_FOG\",this.fog)}setOpacity(e){var t;void 0!==e&&(this.opacity=e,(null===(t=this.uniforms)||void 0===t?void 0:t.opacity)&&(this.uniforms.opacity.value=e))}}t.RawShaderMaterial=s},3298:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.SkyAtmosphereMaterial=t.SkyAtmosphereShader=void 0;const i=n(82),r=n(2141),o=n(1870),s=n(8578);t.SkyAtmosphereShader={uniforms:{u_eyePositionWorld:new i.Uniform(new i.Vector3),u_lightDirectionWorld:new i.Uniform(new i.Vector3(0,1,0)),u_modelViewProjection:new i.Uniform(new i.Matrix4),u_atmosphereEnv:new i.Uniform(new i.Vector3(6378137,6537590.425,0)),u_hsvCorrection:new i.Uniform(new i.Vector3(0,0,0)),topColor:new i.Uniform(new i.Color(30719)),bottomColor:new i.Uniform(new i.Color(16777215)),offset:new i.Uniform(33),exponent:new i.Uniform(.6),fogColor:new i.Uniform(new i.Color(30719)),fogNear:new i.Uniform(new i.Color(30719)),fogFar:new i.Uniform(new i.Color(16777215))},vertexShader:`\\n    precision highp float;\\n    precision highp int;\\n\\n    attribute vec4 position;\\n\\n    uniform mat4 u_modelViewProjection;\\n    uniform vec3 u_eyePositionWorld;\\n    uniform vec3 u_lightDirectionWorld;\\n\\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\\n    uniform vec3 u_hsvCorrection;\\n\\n    const float Pi = 3.141592653589793;\\n    const float Kr = 0.0025;\\n    const float Kr4PI = Kr * 4.0 * Pi;\\n    const float Km = 0.0015;\\n    const float Km4PI = Km * 4.0 * Pi;\\n    const float ESun = 15.0; // should be 15.0\\n    const float KmESun = Km * ESun;\\n    const float KrESun = Kr * ESun;\\n    const vec3 InvWavelength = vec3(\\n        5.60204474633241,  // Red = 1.0 / Math.pow(0.650, 4.0)\\n        9.473284437923038, // Green = 1.0 / Math.pow(0.570, 4.0)\\n        19.643802610477206); // Blue = 1.0 / Math.pow(0.475, 4.0)\\n\\n    const int nSamples = 2;\\n    const float fSamples = 2.0;\\n\\n    varying vec3 v_rayleighColor;\\n    varying vec3 v_mieColor;\\n    varying vec3 v_vertToCamera;\\n\\n    ${o.default.atmosphere_vertex_utils}\\n\\n    //\\n    // Computes rayleight and mia atmosphere factors for sky.\\n    //\\n    // Code based on GPU Gems article.\\n    //\\n    // Author: Sean O'Neil\\n    //\\n    // Copyright (c) 2004 Sean O'Neil\\n    //\\n    // https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering\\n    //\\n    // Further modifications by HERE\\n    //\\n    AtmosphereColor computeSkyAtmosphere(vec3 v3Pos, vec3 vLightDir)\\n    {\\n        // Unpack attributes\\n        float fInnerRadius = u_atmosphereEnv.x;\\n        float fOuterRadius = u_atmosphereEnv.y;\\n        float fCameraHeight = u_atmosphereEnv.z;\\n\\n        // All that may be const or define(s) at further optimization:\\n        float fScale = 1.0 / (fOuterRadius - fInnerRadius);\\n        float fScaleOverScaleDepth = (fScale / RayleighScaleDepth);\\n        float fCameraHeight2 = fCameraHeight * fCameraHeight;\\n        float fOuterRadius2 = fOuterRadius * fOuterRadius;\\n\\n        // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\\n        vec3 v3Ray = v3Pos - u_eyePositionWorld;\\n        float fFar = length(v3Ray);\\n        v3Ray /= fFar;\\n\\n    #ifdef CAMERA_IN_SPACE\\n\\n        // Calculate the closest intersection of the ray with the outer\\n        // atmosphere, this is the first point of the ray passing through the atmosphere dome.\\n        float fNear = getNearSphereIntersect(u_eyePositionWorld, v3Ray, fCameraHeight2, fOuterRadius2);\\n        // Make far relative to first atmosphere intersection\\n        fFar -= fNear;\\n\\n        // Compute the ray's starting position within the atmosphere, then\\n        // calculate its scattering offset\\n        vec3 v3Start = u_eyePositionWorld + v3Ray * fNear;\\n\\n        float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\\n        float fStartDepth = exp(-1.0 / RayleighScaleDepth );\\n        float fStartOffset = fStartDepth * scale(fStartAngle);\\n\\n    #else // CAMERA_IN_ATMOSPHERE\\n\\n        // The ray starts already in atmosphere\\n        vec3 v3Start = u_eyePositionWorld;\\n        float height = length(v3Start);\\n        float depth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\\n        float fStartAngle = dot(v3Ray, v3Start) / height;\\n        float fStartOffset = depth * scale(fStartAngle);\\n\\n    #endif\\n\\n        // Initialize the scattering loop variables\\n        float fSampleLength = fFar / fSamples;\\n        float fScaledLength = fSampleLength * fScale;\\n        vec3 v3SampleRay = v3Ray * fSampleLength;\\n        vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\\n\\n        // Now loop through the sample rays\\n        vec3 v3BaseColor = vec3(0.0);\\n        vec3 v3Attenuate = vec3(0.0);\\n        for(int i=0; i < nSamples; i++)\\n        {\\n            float height = length(v3SamplePoint);\\n            float depth = exp(fScaleOverScaleDepth * (fInnerRadius - height));\\n            float fLightAngle = dot(vLightDir, v3SamplePoint) / height;\\n            float fCameraAngle = dot(v3Ray, v3SamplePoint) / height;\\n            float fScatter = (fStartOffset + depth * (scale(fLightAngle) - scale(fCameraAngle)));\\n            v3Attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\\n            v3BaseColor += v3Attenuate * (depth * fScaledLength);\\n            v3SamplePoint += v3SampleRay;\\n        }\\n\\n        // Scale the Mie and Rayleigh colors and set up output of the function\\n        AtmosphereColor color;\\n        color.mie = v3BaseColor * KmESun;\\n        color.rayleigh = v3BaseColor * (InvWavelength * KrESun);\\n        return color;\\n    }\\n\\n    void main(void)\\n    {\\n        #ifdef DYNAMIC_LIGHT\\n            vec3 vLightDir = u_lightDirectionWorld;\\n        #else\\n            vec3 vLightDir = u_eyePositionWorld;\\n        #endif\\n        vLightDir = normalize(vLightDir);\\n\\n        AtmosphereColor atmColor = computeSkyAtmosphere(position.xyz, vLightDir);\\n        v_mieColor = atmColor.mie;\\n        v_rayleighColor = atmColor.rayleigh;\\n        v_vertToCamera = u_eyePositionWorld - position.xyz;\\n\\n        gl_Position = u_modelViewProjection * position;\\n    }\\n    `,fragmentShader:`\\n    // Because of harsh light distribution the exposure correction is always enabled for the sky.\\n    #define CORRECT_EXPOSURE 1\\n\\n    precision highp float;\\n    precision highp int;\\n\\n    #ifdef CORRECT_COLOR\\n    uniform vec3 u_hsvCorrection; // Hue, saturation, brightness\\n    #endif\\n\\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\\n    uniform vec3 u_eyePositionWorld;\\n    uniform vec3 u_lightDirectionWorld;\\n\\n    const float g = -0.95;\\n    const float g2 = g * g;\\n\\n    varying vec3 v_rayleighColor;\\n    varying vec3 v_mieColor;\\n    varying vec3 v_vertToCamera;\\n\\n    ${o.default.atmosphere_fragment_utils}\\n\\n    void main(void)\\n    {\\n        float fInnerRadius = u_atmosphereEnv.x;\\n        float fOuterRadius = u_atmosphereEnv.y;\\n        float fCameraHeight = u_atmosphereEnv.z;\\n\\n        #ifdef DYNAMIC_LIGHT\\n            vec3 vLightDir = u_lightDirectionWorld;\\n            // Alter alpha based on time of day (0.0 = night , 1.0 = day)\\n            float fNightAlpha = clamp(dot(normalize(u_eyePositionWorld), vLightDir), 0.0, 1.0);\\n        #else\\n            vec3 vLightDir = u_eyePositionWorld;\\n            float fNightAlpha = 1.0;\\n        #endif\\n        vLightDir = normalize(vLightDir);\\n\\n        // NOTE:\\n        // For better precision normalization may be added on fragment (for mobile devices)\\n        // while in vertex shader may be left un-normalized\\n        // dot(vLightDir, normalize(v_vertToCamera)) / length(v_vertToCamera);\\n        float fCosAngle = dot(vLightDir, v_vertToCamera) / length(v_vertToCamera);\\n        float fRayleighPhase = 0.75 * (1.0 + fCosAngle * fCosAngle);\\n        float fMiePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCosAngle * fCosAngle) / pow(1.0 + g2 - 2.0 * g * fCosAngle, 1.5);\\n\\n        vec3 cRgb = fRayleighPhase * v_rayleighColor + fMiePhase * v_mieColor;\\n\\n        // Sky produces very harsh lighting effect so exposure correction is always enabled.\\n    #if !defined(HDR_FRAME_BUFFER) && defined(CORRECT_EXPOSURE)\\n        // Exposure factor may be exposed to uniform variable.\\n        cRgb = correctExposure(cRgb, 2.0);\\n    #endif\\n\\n    #ifdef CORRECT_COLOR\\n        cRgb = correctColor(cRgb, u_hsvCorrection);\\n    #endif\\n\\n        // Alter alpha based on how close the viewer is to the ground (1.0 = on ground, 0.0 = at edge of atmosphere)\\n        float fAtmosphereAlpha = clamp((fOuterRadius - fCameraHeight) /\\n            (fOuterRadius - fInnerRadius), 0.0, 1.0);\\n        fAtmosphereAlpha *= pow(fNightAlpha, 0.5);\\n\\n        gl_FragColor = vec4(cRgb, mix(cRgb.b, 1.0, fAtmosphereAlpha));\\n    }\\n    `};class a extends r.RawShaderMaterial{constructor(e){let n;e&&(n={name:\"SkyAtmosphereMaterial\",vertexShader:t.SkyAtmosphereShader.vertexShader,fragmentShader:t.SkyAtmosphereShader.fragmentShader,uniforms:t.SkyAtmosphereShader.uniforms,transparent:!0,depthTest:!0,depthWrite:!1,side:i.BackSide,blending:i.NormalBlending,fog:!1,rendererCapabilities:e.rendererCapabilities}),super(n)}setDynamicLighting(e){(0,s.setShaderMaterialDefine)(this,\"DYNAMIC_LIGHT\",e)}set outerRadius(e){this.uniforms.u_atmosphereEnv.value.y=e}get outerRadius(){return this.uniforms.u_atmosphereEnv.value.y}set innerRadius(e){this.uniforms.u_atmosphereEnv.value.x=e}get innerRadius(){return this.uniforms.u_atmosphereEnv.value.x}updateUniforms(e,t,n,i){const r=this.getCameraInfo(t,n);if(void 0===e||!e.isMaterial)throw Error(\"Wrong object used, only Material objects are supported\");if(!(e.uniforms&&e.uniforms.u_atmosphereEnv&&e.uniforms.u_hsvCorrection&&e.uniforms.u_eyePositionWorld&&e.uniforms.u_modelViewProjection&&e.uniforms.u_lightDirectionWorld))throw Error(\"Atmosphere material has missing uniforms\");{const t=r.eyePos,n=r.modelViewProjection,o=r.eyeHeight;e.uniforms.u_eyePositionWorld.value.copy(t),e.uniforms.u_modelViewProjection.value.copy(n),e.uniforms.u_atmosphereEnv.value.z=o,e.uniforms.u_lightDirectionWorld.value=i.clone();const a=o>this.outerRadius,l=(0,s.setShaderDefine)(e.defines,\"CAMERA_IN_SPACE\",a),c=(0,s.setShaderDefine)(e.defines,\"CAMERA_IN_ATMOSPHERE\",!a);e.needsUpdate=e.needsUpdate||l||c}}getCameraInfo(e,t,n=!1){if(n){const n=(new i.Matrix4).identity(),r=(new i.Matrix4).copy(e.matrixWorld).invert().transpose(),o=t.projectionMatrix,s=new i.Matrix4;s.multiplyMatrices(r,n),s.multiplyMatrices(o,s);const a=new i.Vector3;e.getWorldPosition(a);const l=new i.Vector3;return t.getWorldPosition(l),{modelViewProjection:s,eyePos:a,eyeHeight:l.distanceTo(a)}}{const n=e.matrixWorld,r=t.matrixWorldInverse,o=t.projectionMatrix,s=new i.Matrix4;s.multiplyMatrices(r,n),s.multiplyMatrices(o,s);const a=new i.Vector3;t.getWorldPosition(a);const l=new i.Vector3;e.getWorldPosition(l);const c=l.distanceTo(a);return a.sub(l),{modelViewProjection:s,eyePos:a,eyeHeight:c}}}}t.SkyAtmosphereMaterial=a},9528:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.SolidLineMaterial=t.LineDashesModes=t.LineCapsModes=void 0;const i=n(82),r=n(1667),o=n(7610),s=n(8177),a=n(2141),l=n(8578);var c;!function(e){e[e.CAPS_NONE=0]=\"CAPS_NONE\",e[e.CAPS_SQUARE=1]=\"CAPS_SQUARE\",e[e.CAPS_ROUND=2]=\"CAPS_ROUND\",e[e.CAPS_TRIANGLE_IN=3]=\"CAPS_TRIANGLE_IN\",e[e.CAPS_TRIANGLE_OUT=4]=\"CAPS_TRIANGLE_OUT\"}(c=t.LineCapsModes||(t.LineCapsModes={}));const u={None:c.CAPS_NONE,Square:c.CAPS_SQUARE,Round:c.CAPS_ROUND,TriangleIn:c.CAPS_TRIANGLE_IN,TriangleOut:c.CAPS_TRIANGLE_OUT},h=Object.keys(u).reduce(((e,t)=>{const n=t;return e[u[n]]=n,e}),{});var d;!function(e){e[e.DASHES_SQUARE=0]=\"DASHES_SQUARE\",e[e.DASHES_ROUND=1]=\"DASHES_ROUND\",e[e.DASHES_DIAMOND=2]=\"DASHES_DIAMOND\"}(d=t.LineDashesModes||(t.LineDashesModes={}));const p={Square:d.DASHES_SQUARE,Round:d.DASHES_ROUND,Diamond:d.DASHES_DIAMOND},f=Object.keys(p).reduce(((e,t)=>{const n=t;return e[p[n]]=n,e}),{}),m=`\\nprecision highp float;\\nprecision highp int;\\n\\nuniform vec4 diffuseColor;\\nuniform float opacity;\\nuniform float extrusionWidth;\\nuniform vec2 tileSize;\\nuniform vec2 drawRange;\\n\\n#ifdef USE_DASH_IMAGE\\n    uniform sampler2D dashImage;\\n#endif\\n\\n#ifdef USE_DASHED_LINE\\n    uniform float dashSize;\\n    uniform float gapSize;\\n    uniform vec4 dashColor;\\n\\n    #define DASHES_SQUARE ${d.DASHES_SQUARE}\\n    #define DASHES_ROUND ${d.DASHES_ROUND}\\n    #define DASHES_DIAMOND ${d.DASHES_DIAMOND}\\n#endif\\n\\n#ifdef USE_TILE_CLIP\\n    varying vec3 vPosition;\\n#endif\\n\\nvarying vec3 vRange;\\nvarying vec4 vCoords;\\nvarying vec2 vAAGradient;\\nvarying vec3 vExtrusionNormal;\\n\\n#ifdef USE_COLOR\\n    varying vec3 vColor;\\n#endif\\n\\n#define CAPS_NONE ${c.CAPS_NONE}\\n#define CAPS_SQUARE ${c.CAPS_SQUARE}\\n#define CAPS_ROUND ${c.CAPS_ROUND}\\n#define CAPS_TRIANGLE_IN ${c.CAPS_TRIANGLE_IN}\\n#define CAPS_TRIANGLE_OUT ${c.CAPS_TRIANGLE_OUT}\\n\\nfloat roundEdgesAndAddCaps(in vec4 coords, in vec3 range) {\\n    // Compute the line's width to length ratio.\\n    float widthRatio = range.y / range.x;\\n\\n    // Compute the inner segment distance (same for all cap mode).\\n    float dist = abs(coords.y);\\n    float segmentBeginMask = clamp(ceil(coords.z - coords.x), 0.0, 1.0);\\n    float segmentEndMask = clamp(ceil(coords.x - coords.w), 0.0, 1.0);\\n    dist = max(dist, segmentBeginMask * length(vec2((coords.x - coords.z) / widthRatio, coords.y)));\\n    dist = max(dist, segmentEndMask * length(vec2((coords.x - coords.w) / widthRatio, coords.y)));\\n\\n    #if CAPS_MODE != CAPS_ROUND\\n    // Compute the caps mask.\\n    float capRangeMask = clamp(1.0 - ceil(range.z - drawRange.y), 0.0, 1.0);\\n    float beginCapMask = clamp(ceil(drawRange.x - coords.x), 0.0, 1.0);\\n    float endCapMask = clamp(ceil(coords.x - drawRange.y), 0.0, 1.0);\\n    float capMask = capRangeMask * max(beginCapMask, endCapMask);\\n\\n    // Compute the outer segment distance (specific for each cap mode).\\n    float capDist = max(coords.x - drawRange.y, drawRange.x - coords.x) / widthRatio;\\n    #if CAPS_MODE == CAPS_NONE\\n    dist = mix(dist, max(abs(coords.y), (capDist + 0.1) / 0.1), capMask);\\n    #elif CAPS_MODE == CAPS_SQUARE\\n    dist = mix(dist, max(abs(coords.y), capDist), capMask);\\n    #elif CAPS_MODE == CAPS_TRIANGLE_OUT\\n    dist = mix(dist, abs(coords.y) + capDist, capMask);\\n    #elif CAPS_MODE == CAPS_TRIANGLE_IN\\n    dist = mix(dist, max(abs(coords.y), (capDist - abs(coords.y)) + capDist), capMask);\\n    #endif\\n    #endif // CAPS_MODE != CAPS_ROUND\\n\\n    return dist;\\n}\\n\\n#ifdef USE_TILE_CLIP\\n    void tileClip(vec2 tilePos, vec2 tileSize) {\\n        if (tileSize.x > 0.0 && (tilePos.x < -tileSize.x / 2.0 || tilePos.x > tileSize.x / 2.0))\\n            discard;\\n        if (tileSize.y > 0.0 && (tilePos.y < -tileSize.y / 2.0 || tilePos.y > tileSize.y / 2.0))\\n            discard;\\n    }\\n#endif\\n\\n#ifdef USE_FADING\\n    #include <fading_pars_fragment>\\n#endif\\n\\n#include <fog_pars_fragment>\\n\\n#ifdef USE_DASHED_LINE\\nvec4 computeDashedLineColor(float distToCenter) {\\n    vec4 outputColor;\\n\\n    // Compute the distance to the dash origin (0.0: dashOrigin, 1.0: dashEnd, (d+g)/d: gapEnd).\\n    float d = dashSize / vRange.x;\\n    float g = gapSize / vRange.x;\\n    float dashOrigDist = mod(vCoords.x, d + g) / d;\\n    // The resulting function is discontinuous at the start of a dash (dashOrigDist = 0), which causes a spike in the result\\n    // of fwidth and artifacts in the interpolation. Transform it so that it reaches its maximum at the middle of a gap and\\n    // goes down to 1.0 at the gap end.\\n    float gapCenter = 1.0 + 0.5 * g / d;\\n    dashOrigDist = gapCenter - abs(dashOrigDist - gapCenter);\\n\\n    // Compute distance to dash edge (0.5: dashCenter, 0.0: dashEdge).\\n    float dashEdgeDist = 0.5 - abs(dashOrigDist - 0.5);\\n\\n    #if DASHES_MODE == DASHES_ROUND\\n        dashEdgeDist = 0.5 - distance(vec2(distToCenter * 0.5, dashEdgeDist), vec2(0.0, 0.5));\\n    #elif DASHES_MODE == DASHES_DIAMOND\\n        dashEdgeDist -= distToCenter * 0.5;\\n    #endif\\n\\n    // Blend dash and gap colors using hermitian interpolation (smoothstep) on the interval\\n    // [-dashWidth, dashWidth], with 'dashWidth' being the sum of the slope of dashEdgeDist on x and y (fwidth).\\n    // That means 'dashWidth' is the dashEdgeDist function delta across 1 pixel, and hence the interpolation interval\\n    // is 2 pixels wide and centered on 0 (dash start).\\n    float dashWidth = fwidth(dashEdgeDist);\\n    float dashBlendFactor = smoothstep(-dashWidth, dashWidth, dashEdgeDist);\\n\\n    #ifdef USE_DASH_IMAGE\\n        // Dash texture is mapped to the full dash size. Use dashOrigDist as u coordinate (parallel to line segment).\\n        // For v coordinate (perpendicular to line), transform vCoords.y (0.0 at line center, +/-1 at edges) to make them 0\\n        // at one edge, 1 at the other and 0.5 at the line center.\\n        vec2 texCoords = vec2(dashOrigDist, 0.5 + vCoords.y / 2.0);\\n        float textureAlpha = texture2D(dashImage, texCoords).a;\\n\\n        // For a dash image, dash color's alpha is used as interpolation factor. For a transparent dash color, the dash\\n        // becomes invisible, and the base (diffuse) color is drawn instead.\\n        outputColor = mix(diffuseColor, vec4(dashColor.rgb,1.0), textureAlpha * dashColor.a * dashBlendFactor);\\n    #else\\n        // When a dash texture is not used, dash color's alpha is blended as the other channels with the base color. The base color\\n        // won't be visible through transparent dashes. Instead, the resulting color depends on the material's blending configuration.\\n        // (typically, materials drawn underneath will be visible).\\n\\n        // First alpha is interpolated.\\n        outputColor.a = mix(diffuseColor.a, dashColor.a, dashBlendFactor);\\n\\n        // Then color channels are premultiplied with the alpha channels, interpolated and finally divided by the interpolated alpha.\\n        // This keeps colors with low opacity from bleeding into the other color as the opacity increases.\\n        outputColor.rgb = mix(diffuseColor.rgb * diffuseColor.a, dashColor.rgb * dashColor.a, dashBlendFactor) / outputColor.a;\\n    #endif\\n\\n    return outputColor;\\n}\\n#endif\\n\\nvoid main() {\\n    float alpha = opacity * diffuseColor.a;\\n    vec4 outputDiffuse = diffuseColor;\\n\\n    #ifdef USE_TILE_CLIP\\n        tileClip(vPosition.xy, tileSize);\\n    #endif\\n\\n    // Calculate distance to center (0.0: lineCenter, 1.0: lineEdge).\\n    float distToCenter = roundEdgesAndAddCaps(vCoords, vRange);\\n\\n    float s = 0.0;\\n    if (vAAGradient.x < vAAGradient.y) {\\n        s = smoothstep(vAAGradient.x, vAAGradient.y, distToCenter);\\n    }\\n\\n    // Drop the fully transparent pixel. It prevents writing to the stencil buffer.\\n    // Without this discard we will see line cap overlaps on semi-transparent roads.\\n    if (s == 1.0) {\\n        discard;\\n    }\\n\\n    // Alpha channel in diffuseColor is applied later once it's interpolated with dash color's alpha.\\n    alpha = opacity * (1.0 - s);\\n\\n    #ifdef USE_DASHED_LINE\\n        outputDiffuse = computeDashedLineColor(distToCenter);\\n    #endif\\n\\n    #ifdef USE_COLOR\\n        outputDiffuse.rgb *= vColor;\\n    #endif\\n\\n    gl_FragColor = vec4( outputDiffuse.rgb, outputDiffuse.a * alpha );\\n\\n    #include <fog_fragment>\\n\\n    #ifdef USE_FADING\\n        #include <fading_fragment>\\n    #endif\\n}`;class g extends a.RawShaderMaterial{constructor(e){var t,n,a,u;s.FadingFeature.patchGlobalShaderChunks();const h={CAPS_MODE:c.CAPS_ROUND,DASHES_MODE:d.DASHES_SQUARE};let p,f,v=!0,y=1;e&&(v=!0===e.fog,v&&(0,l.setShaderDefine)(h,\"USE_FOG\",!0),y=void 0!==e.opacity?e.opacity:y,p=e.displacementMap,void 0!==p&&(0,l.setShaderDefine)(h,\"USE_DISPLACEMENTMAP\",!0),e[\"dash-image\"]&&(0,l.setShaderDefine)(h,\"USE_DASH_IMAGE\",!0),f={name:\"SolidLineMaterial\",vertexShader:'\\n#define SEGMENT_OFFSET 0.1\\n// The minimum pixel distance prevents huge overscale values. This avoids very blurry lines in\\n// extreme perspectives when multiplied with other variables and interpolated across a long line\\n// segment that intersects the near plane. Clamping to this minimum distance also allows to always\\n// apply the overscale and thus avoid sudden line width \"jumps\". See HARP-13527 for details.\\n#define MIN_DISTANCE 0.1\\n\\n// over-extrusion width on each side (twice in total).\\n#define OVER_EXTRUSION_WIDTH_PIXELS 1.0\\n\\nattribute vec3 extrusionCoord;\\nattribute vec3 position;\\nattribute vec4 biTangent;\\nattribute vec3 tangent;\\nattribute vec2 uv;\\nattribute vec3 normal;\\n\\nuniform mat4 modelViewMatrix;\\nuniform mat4 projectionMatrix;\\nuniform float extrusionWidth;\\nuniform float offset;\\nuniform vec2 drawRange;\\nuniform vec2 canvasSize;\\n\\n#ifdef USE_DISPLACEMENTMAP\\n    uniform sampler2D displacementMap;\\n#endif\\n\\n#ifdef USE_TILE_CLIP\\n    varying vec3 vPosition;\\n#endif\\n\\nvarying vec3 vRange;\\nvarying vec4 vCoords;\\nvarying vec2 vAAGradient;\\n\\n#ifdef USE_COLOR\\n    attribute vec3 color;\\n    varying vec3 vColor;\\n#endif\\n\\n#ifdef USE_FADING\\n    #include <fading_pars_vertex>\\n#endif\\n\\n#include <fog_pars_vertex>\\n\\nvec3 computeExtrusionDirWorld(in float extrusionWidth, in vec2 extrusionSign, in vec4 bitangent, in vec3 tangent) {\\n    // Angle between this segment and the previous one.\\n    float angle = bitangent.w;\\n    vec3 bitangentComponent = extrusionSign.y * extrusionWidth * bitangent.xyz / cos(angle / 2.0);\\n    // Extrusion component on the tangent direction to cover line caps.\\n    vec3 tangentComponent = extrusionSign.x * extrusionWidth * tangent;\\n\\n    // Add tangent component only if angle with previous segment is 0, which happens with vertices at line ends (where caps are needed)\\n    // or in straight segments (where caps won\\'t be visible).\\n    return bitangentComponent + (1.0 - abs(sign(angle))) * tangentComponent;\\n}\\n\\nvec2 computeExtrudedPosLocal(in float linePosition, in float extrusionWidth, in vec2 extrusionSign, in float tanHalfAngle) {\\n    // For straight segments and line ends (angle and tanHalfAngle are 0), extrude position forwards (extrusionSign.x positive, for\\n    // end caps) or backwards (extrusionSign.x negative, for start caps) by the extrusion width.\\n    // For segments at an angle, position must be extruded further by a factor of extrusionSign.y*tanHalfAngle.\\n    return vec2(linePosition + extrusionSign.x * extrusionWidth * (1.0 + abs(sign(tanHalfAngle)) * (extrusionSign.y * tanHalfAngle - 1.0)),\\n                extrusionSign.y * extrusionWidth);\\n}\\n\\nvec3 transformToScreen(vec3 worldPosition) {\\n    vec4 clip = projectionMatrix * modelViewMatrix * vec4(worldPosition,1.0);\\n    vec3 ndc = clip.xyz / clip.w;\\n    vec3 screen = ndc * 0.5 + 0.5;\\n    screen.xy *= canvasSize;\\n    return screen;\\n}\\n\\nvoid main() {\\n    // Calculate the segment.\\n    vec2 segment = abs(extrusionCoord.xy) - SEGMENT_OFFSET;\\n    float segmentPos = sign(extrusionCoord.x) / 2.0 + 0.5;\\n\\n    // Calculate the vertex position inside the line (segment).\\n    float linePos = mix(segment.x, segment.y, segmentPos);\\n    vec2 extrusionSign = sign(extrusionCoord.xy);\\n    // Precompute to avoid computing multiple times\\n    float tanHalfAngle = tan(biTangent.w / 2.0);\\n    float extrusionFactor = extrusionSign.y * tanHalfAngle;\\n\\n    vec3 extrusionDirWorld = computeExtrusionDirWorld(extrusionWidth, extrusionSign, biTangent, tangent);\\n\\n    vec3 extrudedPosWorld = position + extrusionDirWorld;\\n    vec3 centerPosScreen = transformToScreen(position);\\n    vec3 extrudedPosScreen = transformToScreen(extrudedPosWorld);\\n    float distanceScreen = max(MIN_DISTANCE, distance(extrudedPosScreen.xy, centerPosScreen.xy));\\n\\n    float overscale = (distanceScreen + OVER_EXTRUSION_WIDTH_PIXELS) / distanceScreen;\\n    extrusionDirWorld *= overscale;\\n    extrudedPosWorld = position + extrusionDirWorld;\\n\\n\\n    float totalExtrusionWidth = extrusionWidth*overscale;\\n    float aaGradientHalfWidth = totalExtrusionWidth - extrusionWidth;\\n    vAAGradient.x = max(0.0, (extrusionWidth - aaGradientHalfWidth)/ totalExtrusionWidth);\\n    vAAGradient.y = 1.0;\\n    vec2 extrudedPosLocal = computeExtrudedPosLocal(linePos, totalExtrusionWidth, extrusionSign, tanHalfAngle);\\n\\n    // Store the normalized extrusion coordinates in vCoords (with their ranges in vRange).\\n    vRange = vec3(extrusionCoord.z, totalExtrusionWidth, extrusionFactor);\\n    vCoords = vec4(extrudedPosLocal / vRange.xy, segment / vRange.x);\\n\\n    // Adjust the segment to fit the drawRange.\\n    float capDist = totalExtrusionWidth / extrusionCoord.z;\\n    if ((vCoords.w + capDist) < drawRange.x || (vCoords.z - capDist) > drawRange.y) {\\n        vCoords.zw += 1.0;\\n    }\\n    if (vCoords.z < drawRange.x) {\\n        vCoords.zw += vec2(drawRange.x - vCoords.z, 0.0);\\n    }\\n    if (vCoords.w > drawRange.y) {\\n        vCoords.zw -= vec2(0.0, vCoords.w - drawRange.y);\\n    }\\n\\n    // Transform position.\\n    #ifdef USE_DISPLACEMENTMAP\\n        extrudedPosWorld += normalize( normal ) * texture2D( displacementMap, uv ).x;\\n    #endif\\n\\n    // Shift the line based on the offset, where the bitangent is the cross product of the average\\n    // of the two direction vectors (the previous and next segment directions) and the normal of\\n    // the line (facing into the sky). The w component is the angle between the two segments.\\n    // Note, we need to take the angle into consideration, so we use trigonometry to calculate how\\n    // much we need to extend the offset. Note, orthough this looks complicated we are doing this\\n    // in the vertex shader, so it should not cause a performance issue.\\n    extrudedPosWorld += biTangent.xyz * offset * sqrt(1.0 + pow(abs(tanHalfAngle), 2.0));\\n\\n    vec4 mvPosition = modelViewMatrix * vec4(extrudedPosWorld, 1.0);\\n    gl_Position = projectionMatrix * mvPosition;\\n\\n    // Pass extruded position to fragment shader.\\n    #ifdef USE_TILE_CLIP\\n        vPosition = extrudedPosWorld;\\n    #endif\\n\\n    #ifdef USE_COLOR\\n        // Pass vertex color to fragment shader.\\n        vColor = color;\\n    #endif\\n\\n    #ifdef USE_FADING\\n        #include <fading_vertex>\\n    #endif\\n\\n    #include <fog_vertex>\\n}',fragmentShader:m,uniforms:i.UniformsUtils.merge([{diffuseColor:new i.Uniform(g.DEFAULT_COLOR.clone()),dashColor:new i.Uniform(g.DEFAULT_DASH_COLOR.clone()),extrusionWidth:new i.Uniform(g.DEFAULT_WIDTH),offset:new i.Uniform(g.DEFAULT_OFFSET),opacity:new i.Uniform(g.DEFAULT_OPACITY),tileSize:new i.Uniform(new i.Vector2),fadeNear:new i.Uniform(s.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new i.Uniform(s.FadingFeature.DEFAULT_FADE_FAR),displacementMap:new i.Uniform(void 0!==p?p:new i.Texture),drawRange:new i.Uniform(new i.Vector2(g.DEFAULT_DRAW_RANGE_START,g.DEFAULT_DRAW_RANGE_END)),dashSize:new i.Uniform(g.DEFAULT_DASH_SIZE),gapSize:new i.Uniform(g.DEFAULT_GAP_SIZE),dashImage:new i.Uniform(null!==(t=e[\"dash-image\"])&&void 0!==t?t:new i.Texture),canvasSize:new i.Uniform(new i.Vector2)},i.UniformsLib.fog]),defines:h,fog:v,opacity:y,rendererCapabilities:e.rendererCapabilities}),super(f),this.m_color=(new o.RGBA).fromVector(g.DEFAULT_COLOR),this.m_dashColor=(new o.RGBA).fromVector(g.DEFAULT_DASH_COLOR),this.fog=v,this.setOpacity(y),this.stencilFunc=i.NotEqualStencilFunc,this.stencilZPass=i.ReplaceStencilOp,this.stencilRef=1,this.stencilWrite=!1,(0,l.enforceBlending)(this),this.extensions.derivatives=!0,e&&(void 0!==e.color&&(this.color=\"number\"==typeof e.color?r.ColorUtils.getRgbaFromHex(e.color):null!==(n=o.RGBA.parse(e.color))&&void 0!==n?n:this.m_color),void 0!==e.lineWidth&&(this.lineWidth=e.lineWidth),void 0!==e.opacity&&this.setOpacity(e.opacity),void 0!==e.depthTest&&(this.depthTest=e.depthTest),void 0!==e.depthWrite&&(this.depthWrite=e.depthWrite),void 0!==e.fadeNear&&(this.fadeNear=e.fadeNear),void 0!==e.fadeFar&&(this.fadeFar=e.fadeFar),void 0!==e.displacementMap&&(this.displacementMap=e.displacementMap),void 0!==e.caps&&(this.caps=e.caps),void 0!==e.drawRangeStart&&(this.drawRangeStart=e.drawRangeStart),void 0!==e.drawRangeEnd&&(this.drawRangeEnd=e.drawRangeEnd),void 0!==e.dashes&&(this.dashes=e.dashes),void 0!==e.dashColor&&(this.dashColor=\"number\"==typeof e.dashColor?r.ColorUtils.getRgbaFromHex(e.dashColor):null!==(a=o.RGBA.parse(e.dashColor))&&void 0!==a?a:this.m_dashColor),void 0!==e.dashSize&&(this.dashSize=e.dashSize),void 0!==e.gapSize&&(this.gapSize=e.gapSize),void 0!==e.fog&&(this.fog=e.fog,this.invalidateFog()),this.offset=null!==(u=e.offset)&&void 0!==u?u:0)}set offset(e){this.uniforms.offset.value=e}get offset(){return this.uniforms.offset.value}setOpacity(e){super.setOpacity(e),void 0!==e&&this.updateStencil()}get color(){return this.m_color}set color(e){this.m_color.copy(e).toVector(this.uniforms.diffuseColor.value),this.updateStencil()}get dashColor(){return this.m_dashColor}set dashColor(e){this.m_dashColor.copy(e).toVector(this.uniforms.dashColor.value)}get lineWidth(){return 2*this.uniforms.extrusionWidth.value}set lineWidth(e){this.uniforms.extrusionWidth.value=e/2}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get\"dash-image\"(){return this.uniforms.dashImage.value}set\"dash-image\"(e){this.uniforms.dashImage.value=e,(0,l.setShaderMaterialDefine)(this,\"USE_DASH_IMAGE\",!0)}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){var t,n;this.uniforms.gapSize.value=e,(0,l.setShaderMaterialDefine)(this,\"USE_DASHED_LINE\",e>0),0===(null===(n=null===(t=this.uniforms)||void 0===t?void 0:t.gapSize)||void 0===n?void 0:n.value)&&this.updateStencil()}get caps(){let e=\"Round\";const t=(0,l.getShaderMaterialDefine)(this,\"CAPS_MODE\");return\"number\"==typeof t&&h.hasOwnProperty(t)&&(e=h[t]),e}set caps(e){u.hasOwnProperty(e)&&(0,l.setShaderMaterialDefine)(this,\"CAPS_MODE\",u[e])}get dashes(){let e=\"Square\";const t=(0,l.getShaderMaterialDefine)(this,\"DASHES_MODE\");return\"number\"==typeof t&&f.hasOwnProperty(t)&&(e=f[t]),e}set dashes(e){p.hasOwnProperty(e)&&(0,l.setShaderMaterialDefine)(this,\"DASHES_MODE\",p[e])}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){this.uniforms.fadeFar.value=e,(0,l.setShaderMaterialDefine)(this,\"USE_FADING\",e>0)}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){if(this.uniforms.displacementMap.value===e)return;this.uniforms.displacementMap.value=e;const t=null!==e;t&&(this.uniforms.displacementMap.value.needsUpdate=!0),(0,l.setShaderMaterialDefine)(this,\"USE_DISPLACEMENTMAP\",t)}get drawRangeStart(){return this.uniforms.drawRange.value.x}set drawRangeStart(e){this.uniforms.drawRange.value.x=e}get drawRangeEnd(){return this.uniforms.drawRange.value.y}set drawRangeEnd(e){this.uniforms.drawRange.value.y=e}set clipTileSize(e){this.uniforms.tileSize.value.copy(e);const t=e.x>0&&e.y>0;(0,l.setShaderMaterialDefine)(this,\"USE_TILE_CLIP\",t)}get clipTileSize(){return this.uniforms.tileSize.value}set canvasSize(e){this.uniforms.canvasSize.value.copy(e)}get canvasSize(){return this.uniforms.canvasSize.value}copy(e){return super.copy(e),this.invalidateFog(),this.setOpacity(e.opacity),this}updateStencil(){var e,t;this.stencilWrite=this.opacity*(null!==(t=null===(e=this.color)||void 0===e?void 0:e.a)&&void 0!==t?t:1)<.98}}t.SolidLineMaterial=g,g.DEFAULT_COLOR=new i.Vector4(1,0,0,1),g.DEFAULT_DASH_COLOR=new i.Vector4(1,0,0,0),g.DEFAULT_WIDTH=1,g.DEFAULT_OPACITY=1,g.DEFAULT_DRAW_RANGE_START=0,g.DEFAULT_DRAW_RANGE_END=1,g.DEFAULT_DASH_SIZE=1,g.DEFAULT_GAP_SIZE=1,g.DEFAULT_OFFSET=0},8578:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.getShaderDefine=t.setShaderDefine=t.getShaderMaterialDefine=t.setShaderMaterialDefine=t.disableBlending=t.enableBlending=t.enforceBlending=t.insertShaderInclude=t.DEFINE_BOOL_FALSE=t.DEFINE_BOOL_TRUE=void 0;const i=n(82),r=n(4342);function o(e){!0!==e.transparent&&!0!==e.forcedBlending&&(e.blending=i.CustomBlending,!0===e.premultipliedAlpha?(e.blendSrc=i.OneFactor,e.blendDst=i.OneMinusSrcAlphaFactor,e.blendSrcAlpha=i.OneFactor,e.blendDstAlpha=i.OneMinusSrcAlphaFactor):(e.blendSrc=i.SrcAlphaFactor,e.blendDst=i.OneMinusSrcAlphaFactor,e.blendSrcAlpha=i.OneFactor,e.blendDstAlpha=i.OneMinusSrcAlphaFactor))}function s(e,t,n=!1){return void 0===e.defines?n:l(e.defines,t)}function a(e,n,i){let r=!1;return\"number\"==typeof i?(r=e[n]!==i,e[n]=i):!0===i?(r=e[n]!==t.DEFINE_BOOL_TRUE,e[n]=t.DEFINE_BOOL_TRUE):!1===i&&void 0!==e[n]&&(delete e[n],r=!0),r}function l(e,n){const i=e[n];return i!==t.DEFINE_BOOL_FALSE&&(i===t.DEFINE_BOOL_TRUE||i)}t.DEFINE_BOOL_TRUE=\"\",t.DEFINE_BOOL_FALSE=void 0,t.insertShaderInclude=function(e,t,n,i){const r=!0===i?\"\\t\":\"\";return e.replace(`#include <${t}>`,`#include <${t}>\\n${r}#include <${n}>`)},t.enforceBlending=function(e){e.transparent||(o(e),e.forcedBlending=!0)},t.enableBlending=o,t.disableBlending=function(e){!0!==e.transparent&&!0!==e.forcedBlending&&(e.blending=i.NormalBlending)},t.setShaderMaterialDefine=function(e,t,n){(0,r.assert)(void 0!==e.defines,\"Do not use this function in ShaderMaterial derived c-tor.\");const i=n!==s(e,t);return!!i&&(a(e.defines,t,n),e.needsUpdate=i,!0)},t.getShaderMaterialDefine=s,t.setShaderDefine=a,t.getShaderDefine=l},4744:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.hasColorCorrectionFeature=t.ColorCorrectionFeature=void 0;const i=n(4342),r=n(71),o=n(4030),s=n(8578),a=n(82);!function(e){function t(e){return void 0!==e.gamma||void 0!==e.brightness}e.DEFAULT_GAMMA=1,e.DEFAULT_BRIGHTNESS=1,e.isEnabled=t,e.patchGlobalShaderChunks=function(){void 0===a.ShaderChunk.color_correction_parts_fragment&&Object.assign(a.ShaderChunk,o.default)},e.updateColorCorrectionFeature=function(n){(0,i.assert)(void 0!==n.shaderDefines),(0,i.assert)(void 0!==n.shaderUniforms);const r=t(n),o=(0,s.setShaderDefine)(n.shaderDefines,\"USE_COLOR_CORRECTION\",r);n.needsUpdate=o,(0,i.assert)(void 0!==n.shaderUniforms.u_gamma),(0,i.assert)(void 0!==n.shaderUniforms.u_brightness),r?(n.shaderUniforms.u_gamma.value=n.gamma>0?n.gamma:0,n.shaderUniforms.u_brightness.value=a.MathUtils.clamp(n.brightness,0,1)):o&&(n.shaderUniforms.u_gamma.value=e.DEFAULT_GAMMA,n.shaderUniforms.u_brightness.value=e.DEFAULT_BRIGHTNESS)},e.onBeforeCompile=function(e,n){t(e)&&((0,i.assert)(void 0!==e.shaderUniforms),(0,r.linkMixinWithShader)(e,n),n.fragmentShader=(0,s.insertShaderInclude)(n.fragmentShader,\"common\",\"color_correction_parts_fragment\"),n.fragmentShader=(0,s.insertShaderInclude)(n.fragmentShader,\"color_fragment\",\"color_correction_fragment\",!0))}}(t.ColorCorrectionFeature||(t.ColorCorrectionFeature={})),t.hasColorCorrectionFeature=function(e){return\"brightness\"in e&&\"gamma\"in e}},8583:(e,t)=>{\"use strict\";function n(e){return\"displacementMap\"in e}Object.defineProperty(t,\"__esModule\",{value:!0}),t.setDisplacementMapToMaterial=t.hasDisplacementFeature=void 0,t.hasDisplacementFeature=n,t.setDisplacementMapToMaterial=function(e,t){n(t)&&t.displacementMap!==e&&(t.displacementMap=e,t.needsUpdate=!0,null!==t.displacementMap&&(t.displacementMap.needsUpdate=!0))}},8014:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ExtrusionFeature=t.hasExtrusionFeature=void 0;const i=n(82),r=n(4342),o=n(71),s=n(4305),a=n(8578),l=n(8955);t.hasExtrusionFeature=function(e){return\"extrusionRatio\"in e},function(e){function t(e){return void 0!==e.extrusionRatio&&e.extrusionRatio>=l.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN}e.isEnabled=t,e.patchGlobalShaderChunks=function(){void 0===i.ShaderChunk.extrusion_pars_vertex&&Object.assign(i.ShaderChunk,s.default)},e.updateExtrusionFeature=function(e){(0,r.assert)(void 0!==e.shaderDefines),(0,r.assert)(void 0!==e.shaderUniforms);const n=t(e),i=(0,a.setShaderDefine)(e.shaderDefines,\"EXTRUSION_MATERIAL\",n);e.needsUpdate=i,n?e.shaderUniforms.extrusionRatio.value=e.extrusionRatio:i&&(e.shaderUniforms.extrusionRatio.value=l.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX)},e.onBeforeCompile=function(e,n){t(e)&&((0,r.assert)(void 0!==e.shaderUniforms),(0,o.linkMixinWithShader)(e,n),n.vertexShader=(0,a.insertShaderInclude)(n.vertexShader,\"common\",\"extrusion_pars_vertex\"),n.vertexShader=(0,a.insertShaderInclude)(n.vertexShader,\"begin_vertex\",\"extrusion_vertex\",!0),n.fragmentShader=(0,a.insertShaderInclude)(n.fragmentShader,\"fog_pars_fragment\",\"extrusion_pars_fragment\"),n.fragmentShader=n.fragmentShader.replace(\"#include <normal_fragment_begin>\",\"#include <extrusion_normal_fragment_begin>\"),n.fragmentShader=(0,a.insertShaderInclude)(n.fragmentShader,\"fog_fragment\",\"extrusion_fragment\",!0))}}(t.ExtrusionFeature||(t.ExtrusionFeature={}))},8955:(e,t)=>{\"use strict\";var n;Object.defineProperty(t,\"__esModule\",{value:!0}),t.ExtrusionFeatureDefs=void 0,(n=t.ExtrusionFeatureDefs||(t.ExtrusionFeatureDefs={})).DEFAULT_RATIO_MIN=0,n.DEFAULT_RATIO_MAX=1,n.MIN_BUILDING_HEIGHT=.1},8177:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.FadingFeature=void 0;const i=n(82),r=n(4342),o=n(71),s=n(3739),a=n(8578);!function(e){function t(e){return void 0!==e.fadeNear&&void 0!==e.fadeFar&&e.fadeFar>0}e.DEFAULT_FADE_NEAR=-1,e.DEFAULT_FADE_FAR=-1,e.isEnabled=t,e.isDefined=function(e){return void 0!==e.fadeNear&&void 0!==e.fadeFar},e.patchGlobalShaderChunks=function(){void 0===i.ShaderChunk.fading_pars_vertex&&Object.assign(i.ShaderChunk,s.default)},e.updateFadingFeature=function(n){(0,r.assert)(void 0!==n.shaderDefines),(0,r.assert)(void 0!==n.shaderUniforms);const i=t(n),o=(0,a.setShaderDefine)(n.shaderDefines,\"FADING_MATERIAL\",i);n.needsUpdate=o,(0,r.assert)(void 0!==n.shaderUniforms.fadeNear&&void 0!==n.shaderUniforms.fadeFar),i?(n.shaderUniforms.fadeNear.value=n.fadeNear,n.shaderUniforms.fadeFar.value=n.fadeFar,o&&(0,a.enableBlending)(n)):o&&(n.shaderUniforms.fadeNear.value=e.DEFAULT_FADE_NEAR,n.shaderUniforms.fadeFar.value=e.DEFAULT_FADE_FAR,(0,a.disableBlending)(n))},e.onBeforeCompile=function(e,n){t(e)&&((0,r.assert)(void 0!==e.shaderUniforms),(0,o.linkMixinWithShader)(e,n),n.vertexShader=(0,a.insertShaderInclude)(n.vertexShader,\"fog_pars_vertex\",\"fading_pars_vertex\"),n.vertexShader=(0,a.insertShaderInclude)(n.vertexShader,\"fog_vertex\",\"fading_vertex\",!0),n.fragmentShader=(0,a.insertShaderInclude)(n.fragmentShader,\"fog_pars_fragment\",\"fading_pars_fragment\"),n.fragmentShader=(0,a.insertShaderInclude)(n.fragmentShader,\"fog_fragment\",\"fading_fragment\",!0))},e.addRenderHelper=function(t,n,i,s,a,l){t.onBeforeRender=(0,r.chainCallbacks)(t.onBeforeRender,((t,r,a,c,u,h)=>{const d=u;d.fadeNear=void 0===i||i===e.DEFAULT_FADE_NEAR?e.DEFAULT_FADE_NEAR:(0,o.cameraToWorldDistance)(i,n),d.fadeFar=void 0===s||s===e.DEFAULT_FADE_FAR?e.DEFAULT_FADE_FAR:(0,o.cameraToWorldDistance)(s,n),void 0!==l&&l(t,u)}))}}(t.FadingFeature||(t.FadingFeature={}))},4258:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ColorCorrectionFeatureMixin=void 0;const i=n(4342),r=n(9276),o=n(71),s=n(82),a=n(4744);t.ColorCorrectionFeatureMixin=class{constructor(){this.m_brightness=a.ColorCorrectionFeature.DEFAULT_BRIGHTNESS,this.m_gamma=a.ColorCorrectionFeature.DEFAULT_GAMMA}getBrightness(){return this.m_brightness}setBrightness(e){e!==this.m_brightness&&(this.m_brightness=e,a.ColorCorrectionFeature.updateColorCorrectionFeature(this))}getGamma(){return this.m_gamma}setGamma(e){e!==this.m_gamma&&(this.m_gamma=e,a.ColorCorrectionFeature.updateColorCorrectionFeature(this))}addColorCorrectionProperties(){Object.defineProperty(this,\"brightness\",{get:()=>this.getBrightness(),set:e=>{this.setBrightness(e)}}),Object.defineProperty(this,\"gamma\",{get:()=>this.getGamma(),set:e=>{this.setGamma(e)}})}applyColorCorrectionParameters(e){(0,o.linkMixinWithMaterial)(this,this),(0,i.assert)(void 0!==this.shaderDefines),(0,i.assert)(void 0!==this.shaderUniforms),this.shaderUniforms.u_gamma=new s.Uniform(a.ColorCorrectionFeature.DEFAULT_GAMMA),this.shaderUniforms.u_brightness=new s.Uniform(a.ColorCorrectionFeature.DEFAULT_BRIGHTNESS),void 0!==e&&(void 0!==e.brightness&&this.setBrightness(e.brightness),void 0!==e.gamma&&this.setGamma(e.gamma)),this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{a.ColorCorrectionFeature.onBeforeCompile(this,e)})),this.needsUpdate=a.ColorCorrectionFeature.isEnabled(this)}copyColorCorrectionParameters(e){return this.setBrightness(void 0===e.brightness?a.ColorCorrectionFeature.DEFAULT_BRIGHTNESS:e.brightness),this.setGamma(void 0===e.gamma?a.ColorCorrectionFeature.DEFAULT_GAMMA:e.gamma),this}}},8878:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.DisplacementFeatureMixin=void 0;const i=n(82),r=n(4342),o=n(71),s=n(8578),a=new i.Texture;var l;!function(e){function t(e){return null!==e.displacementMap}e.isEnabled=t,e.updateDisplacementFeature=function(e){(0,r.assert)(void 0!==e.shaderDefines),(0,r.assert)(void 0!==e.shaderUniforms);const n=t(e),i=(0,s.setShaderDefine)(e.shaderDefines,\"USE_DISPLACEMENTMAP\",n);if(e.needsUpdate=i,n){const t=e.displacementMap;t.needsUpdate=!0,e.shaderUniforms.displacementMap.value=t}else i&&(e.shaderUniforms.displacementMap.value=a)},e.onBeforeCompile=function(e,n){t(e)&&((0,r.assert)(void 0!==e.shaderUniforms),(0,o.linkMixinWithShader)(e,n),n.vertexShader=n.vertexShader.replace(\"#include <skinbase_vertex>\",\"#include <skinbase_vertex>\\n#ifndef USE_ENVMAP\\n    vec3 objectNormal = vec3( normal );\\n#endif\"),n.vertexShader=(0,s.insertShaderInclude)(n.vertexShader,\"uv2_pars_vertex\",\"displacementmap_pars_vertex\"),n.vertexShader=(0,s.insertShaderInclude)(n.vertexShader,\"skinning_vertex\",\"displacementmap_vertex\",!0))}}(l||(l={})),t.DisplacementFeatureMixin=class{constructor(){this.m_displacementMap=null}get displacementMap(){return this.m_displacementMap}set displacementMap(e){this.setDisplacementMap(e)}getDisplacementMap(){return this.m_displacementMap}setDisplacementMap(e){e!==this.m_displacementMap&&(this.m_displacementMap=e,l.updateDisplacementFeature(this))}addDisplacementProperties(){Object.defineProperty(this,\"displacementMap\",{get:()=>this.getDisplacementMap(),set:e=>{this.setDisplacementMap(e)}})}applyDisplacementParameters(e){(0,o.linkMixinWithMaterial)(this,this),(0,r.assert)(void 0!==this.shaderDefines),(0,r.assert)(void 0!==this.shaderUniforms);const t=this.shaderUniforms;t.displacementMap=new i.Uniform(a),t.displacementScale=new i.Uniform(1),t.displacementBias=new i.Uniform(0),void 0!==e&&void 0!==e.displacementMap&&this.setDisplacementMap(e.displacementMap),this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{l.onBeforeCompile(this,e)})),this.needsUpdate=l.isEnabled(this)}copyDisplacementParameters(e){return this.setDisplacementMap(e.displacementMap),this}}},5997:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ExtrusionFeatureMixin=void 0;const i=n(82),r=n(4342),o=n(8014),s=n(8955),a=n(71);t.ExtrusionFeatureMixin=class{constructor(){this.m_extrusion=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}getExtrusionRatio(){return this.m_extrusion}setExtrusionRatio(e){e!==this.m_extrusion&&(this.m_extrusion=e,o.ExtrusionFeature.updateExtrusionFeature(this))}addExtrusionProperties(){Object.defineProperty(this,\"extrusionRatio\",{get:()=>this.getExtrusionRatio(),set:e=>{this.setExtrusionRatio(e)}})}applyExtrusionParameters(e){(0,a.linkMixinWithMaterial)(this,this),(0,r.assert)(void 0!==this.shaderDefines),(0,r.assert)(void 0!==this.shaderUniforms),e&&!0===e.zFightingWorkaround&&(this.shaderDefines.ZFIGHTING_WORKAROUND=\"\"),this.shaderUniforms.extrusionRatio=new i.Uniform(s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX),void 0!==e&&void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{o.ExtrusionFeature.onBeforeCompile(this,e)})),this.needsUpdate=o.ExtrusionFeature.isEnabled(this)}copyExtrusionParameters(e){return void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this}}},674:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.FadingFeatureMixin=void 0;const i=n(82),r=n(4342),o=n(8177),s=n(71);t.FadingFeatureMixin=class{constructor(){this.m_fadeNear=o.FadingFeature.DEFAULT_FADE_NEAR,this.m_fadeFar=o.FadingFeature.DEFAULT_FADE_FAR}getFadeNear(){return this.m_fadeNear}setFadeNear(e){e!==this.m_fadeNear&&(this.m_fadeNear=e,o.FadingFeature.updateFadingFeature(this))}getFadeFar(){return this.m_fadeFar}setFadeFar(e){e!==this.m_fadeFar&&(this.m_fadeFar=e,o.FadingFeature.updateFadingFeature(this))}addFadingProperties(){Object.defineProperty(this,\"fadeNear\",{get:()=>this.getFadeNear(),set:e=>{this.setFadeNear(e)}}),Object.defineProperty(this,\"fadeFar\",{get:()=>this.getFadeFar(),set:e=>{this.setFadeFar(e)}})}applyFadingParameters(e){(0,s.linkMixinWithMaterial)(this,this),(0,r.assert)(void 0!==this.shaderDefines),(0,r.assert)(void 0!==this.shaderUniforms),this.shaderUniforms.fadeNear=new i.Uniform(o.FadingFeature.DEFAULT_FADE_NEAR),this.shaderUniforms.fadeFar=new i.Uniform(o.FadingFeature.DEFAULT_FADE_FAR),void 0!==e&&(void 0!==e.fadeNear&&this.setFadeNear(e.fadeNear),void 0!==e.fadeFar&&this.setFadeFar(e.fadeFar)),this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{o.FadingFeature.onBeforeCompile(this,e)})),this.needsUpdate=o.FadingFeature.isEnabled(this)}copyFadingParameters(e){return this.setFadeNear(void 0===e.fadeNear?o.FadingFeature.DEFAULT_FADE_NEAR:e.fadeNear),this.setFadeFar(void 0===e.fadeFar?o.FadingFeature.DEFAULT_FADE_FAR:e.fadeFar),this}}},1870:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default={atmosphere_vertex_utils:\"\\n\\n    const float RayleighScaleDepth = 0.25;\\n\\n    struct AtmosphereColor\\n    {\\n        vec3 mie;\\n        vec3 rayleigh;\\n    };\\n\\n    float scale(float cosAngle)\\n    {\\n        float x = 1.0 - cosAngle;\\n        return RayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\\n    }\\n\\n    float getNearSphereIntersect(vec3 v3Pos, vec3 v3Ray, float fCameraHeight2, float fOuterRadius2) {\\n        // Solve simple square equation for the x0 (first point of intersection).\\n#if defined(IMPROVE_INTERSECT_PRECISION)\\n        // To improve precision instead of simple projection: b = 2.0 * dot(vPos, v3Ray),\\n        // we change the equation that gives better results especially around the poles.\\n        float fB = 2.0 * length(v3Pos) * dot(normalize(v3Pos), v3Ray);\\n#else\\n        float fB = 2.0 * dot(v3Pos, v3Ray);\\n#endif\\n        float fC = fCameraHeight2 - fOuterRadius2;\\n        // det = b^2 - 4*a*c, where a = 1\\n        float fDet = max(0.0, fB * fB - 4.0 * fC);\\n        // Intersection points distances are defined as follows:\\n        // x0 = (-b - sqrt(det)) / 2*a ^ x1 = (-b + sqrt(det)) / 2*a\\n        // we search for x0:\\n        return 0.5 * (-fB - sqrt(fDet));\\n    }\\n\\n    float getFarSphereIntersect(vec3 v3Pos, vec3 v3Ray, float fCameraHeight2, float fOuterRadius2) {\\n        // Solve simple square equation for the x1 (second point of intersection).\\n#if defined(IMPROVE_INTERSECT_PRECISION)\\n        float fB = 2.0 * length(v3Pos) * dot(normalize(v3Pos), v3Ray);\\n#else\\n        float fB = 2.0 * dot(v3Pos, v3Ray);\\n#endif\\n        float fC = fCameraHeight2 - fOuterRadius2;\\n        // det = b^2 - 4*a*c, where a = 1\\n        float fDet = max(0.0, fB * fB - 4.0 * fC);\\n        // Compute second intersection distance:\\n        // x1 = (-b + sqrt(det)) / 2*a\\n        return 0.5 * (-fB + sqrt(fDet));\\n    }\\n    \",atmosphere_fragment_utils:\"\\n\\n    // Branch free RGB to HSV conversion.\\n    // Based on article:\\n    // http://lolengine.net/blog/2013/01/13/fast-rgb-to-hsv\\n    // and optimized OpenGL SL algorithm\\n    // http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-glsl\\n    vec3 rgb2Hsv(vec3 c)\\n    {\\n        const vec4 RGB_HSV_CONV = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\\n        // Ternary operator may be used explicitly if compiler can use fast conditional move.\\n        // vec4 p = c.g < c.b ? vec4(c.bg, RGB_HSV_CONV.wz) : vec4(c.gb, RGB_HSV_CONV.xy);\\n        vec4 p = mix(vec4(c.bg, RGB_HSV_CONV.wz), vec4(c.gb, RGB_HSV_CONV.xy), step(c.b, c.g));\\n        // vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\\n        vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\\n\\n        float d = q.x - min(q.w, q.y);\\n        float e = 1.0e-10;\\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\\n    }\\n\\n    // Branch free HSV to RGB conversion\\n    vec3 hsv2Rgb(vec3 c)\\n    {\\n        const vec4 HSV_RGB_CONV = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\\n        vec3 p = abs(fract(c.xxx + HSV_RGB_CONV.xyz) * 6.0 - HSV_RGB_CONV.www);\\n        return c.z * mix(HSV_RGB_CONV.xxx, clamp(p - HSV_RGB_CONV.xxx, 0.0, 1.0), c.y);\\n    }\\n\\n    vec3 correctExposure(vec3 rgb, float exposure)\\n    {\\n        const vec3 fullColor = vec3(1.0);\\n        return fullColor - exp(-exposure * rgb);\\n    }\\n\\n    vec3 correctColor(vec3 rgb, vec3 hsvShift)\\n    {\\n        const float e = 0.0000001;\\n        // Convert rgb color to hsv\\n        vec3 hsv = rgb2Hsv(rgb);\\n        // Shift hue value with angle wrapping\\n        hsv.x = mod(hsv.x + hsvShift.x, 1.0);\\n        // Shift and clamp saturation\\n        hsv.y = clamp(hsv.y + hsvShift.y, 0.0, 1.0);\\n        // Change value if it is significant (greater then epsilon)\\n        hsv.z = hsv.z > e ? clamp(hsv.z + hsvShift.z, 0.0, 1.0) : 0.0;\\n        // Convert shifted hsv back to rgb\\n        return hsv2Rgb(hsv);\\n    }\\n    \"}},5089:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.blinnPhongNoSpecular=void 0,t.blinnPhongNoSpecular=\"\\nuniform float colorIntensity;\\nvoid RE_Direct_BlinnPhong_NoSpecular( const in IncidentLight directLight,\\n    const in GeometricContext geometry,\\n    const in BlinnPhongMaterial material,\\n    inout ReflectedLight reflectedLight ) {\\n\\n    float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n    vec3 irradiance = dotNL * directLight.color;\\n\\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\n        irradiance *= PI; // punctual light\\n\\n    #endif\\n\\n    reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor * colorIntensity);\\n}\\n#undef RE_Direct\\n#define RE_Direct RE_Direct_BlinnPhong_NoSpecular\\n\"},4030:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default={color_correction_parts_fragment:\"\\n        #ifdef USE_COLOR_CORRECTION\\n            uniform float u_gamma;\\n            uniform float u_brightness;\\n        #endif\\n    \",color_correction_fragment:\"\\n        #ifdef USE_COLOR_CORRECTION\\n            diffuseColor = vec4( pow( diffuseColor.rgb, vec3( u_gamma ) ) * u_brightness, diffuseColor.a);\\n        #endif\\n    \"}},4305:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});const i=n(8955),r=i.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT*i.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT;t.default={extrusion_pars_vertex:\"\\n// Add define so we can check for it in the outline effect (see Outline.ts).\\n#define HAS_EXTRUSION_PARS_VERTEX\\n// Extrusion axis (xyz: vector, w: factor).\\nattribute vec4 extrusionAxis;\\nuniform float extrusionRatio;\\n#ifdef FLAT_SHADED\\nvarying vec4 vExtrusionAxis;\\n#endif\\n#ifdef ZFIGHTING_WORKAROUND\\nvarying float vExtrusionRatio;\\n#endif\\n\",extrusion_vertex:`\\n#define HAS_EXTRUSION_VERTEX\\n#ifdef ZFIGHTING_WORKAROUND\\n// Cancel extrusionRatio (meaning, force to 1) if extrusionAxisLen < MIN_BUILDING_HEIGHT.\\nconst float MIN_BUILDING_HEIGHT_SQUARED = ${r};\\nfloat extrusionAxisLenSquared = dot(extrusionAxis.xyz, extrusionAxis.xyz);\\nvExtrusionRatio = (extrusionAxisLenSquared < MIN_BUILDING_HEIGHT_SQUARED) ? 1.0 : extrusionRatio;\\n#else\\nfloat vExtrusionRatio = extrusionRatio;\\n#endif\\ntransformed = transformed + extrusionAxis.xyz * (vExtrusionRatio - 1.0);\\n#ifdef FLAT_SHADED\\nvExtrusionAxis = vec4(normalMatrix * extrusionAxis.xyz, extrusionAxis.w);\\n#endif\\n`,extrusion_normal_fragment_begin:\"\\n#ifdef FLAT_SHADED\\n    // Flattened this divergent path to prevent undefined behaviour in the following derivatives\\n    // functions. For more info:\\n    // http://www.aclockworkberry.com/shader-derivative-functions/#Derivatives_and_branches\\n\\n    // Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\\n    vec3 fdx = vec3(dFdx(vViewPosition.x), dFdx(vViewPosition.y), dFdx(vViewPosition.z));\\n    vec3 fdy = vec3(dFdy(vViewPosition.x), dFdy(vViewPosition.y), dFdy(vViewPosition.z));\\n    vec3 normal = cross( fdx, fdy );\\n    if (vExtrusionAxis.w > 0.999999) {\\n        normal = vExtrusionAxis.xyz;\\n    }\\n    normal = normalize(normal);\\n#else\\n\\tvec3 normal = normalize( vNormal );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\\n\\t#endif\\n\\t#ifdef USE_TANGENT\\n\\t\\tvec3 tangent = normalize( vTangent );\\n\\t\\tvec3 bitangent = normalize( vBitangent );\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\ttangent = tangent * (float(gl_FrontFacing) * 2.0 - 1.0);\\n\\t\\t\\tbitangent = bitangent * (float(gl_FrontFacing) * 2.0 - 1.0);\\n\\t\\t#endif\\n\\t#endif\\n#endif\\n// non perturbed normal for clearcoat among others\\nvec3 geometryNormal = normal;\\n\",extrusion_pars_fragment:\"\\n#ifdef ZFIGHTING_WORKAROUND\\nvarying float vExtrusionRatio;\\n#else\\nuniform float extrusionRatio;\\n#endif\\nvarying vec4 vExtrusionAxis;\\n\",extrusion_fragment:\"\\n#ifndef ZFIGHTING_WORKAROUND\\nfloat vExtrusionRatio = extrusionRatio;\\n#endif\\ngl_FragColor.a *= smoothstep( 0.0, 0.25, vExtrusionRatio );\\n\"}},3739:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default={fading_pars_vertex:\"\\nvarying float fadingDepth;\\n\",fading_vertex:\"\\nfadingDepth = -mvPosition.z;\\n\",fading_pars_fragment:\"\\nvarying float fadingDepth;\\nuniform float fadeNear;\\nuniform float fadeFar;\\n\",fading_fragment:'\\n\\n// lerp with \"hard\" edges\\n//float fadingFactor = 1.0 - clamp((fadingDepth - fadeNear) / (fadeFar - fadeNear), 0.0, 1.0);\\n\\n// smooth transitions\\nfloat fadingFactor = smoothstep( fadeNear, fadeFar, fadingDepth );\\n\\ngl_FragColor.a *= 1.0 - fadingFactor;\\n\\n// debugging color:\\n// gl_FragColor = vec4(1., fadingFactor, fadingFactor, 1.0);\\n'}},7133:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default={high_precision_vert_func:\"\\nvec3 subtractDblEyePos( const in vec3 pos ) {\\n    vec3 t1 = positionLow - u_eyepos_lowpart;\\n    vec3 e = t1 - positionLow;\\n    vec3 t2 = ((-u_eyepos_lowpart - e) + (positionLow - (t1 - e))) + pos - u_eyepos;\\n    vec3 high_delta = t1 + t2;\\n    vec3 low_delta = t2 - (high_delta - t1);\\n    return (high_delta + low_delta);\\n}\\n\"}},759:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.simpleLightingShadowChunk=void 0,t.simpleLightingShadowChunk=\"\\n    struct PhysicalMaterial {\\n        vec3\\tdiffuseColor;\\n        float\\tspecularRoughness;\\n        vec3\\tspecularColor;\\n    };\\n\\n    #define DEFAULT_SPECULAR_COEFFICIENT 0.04\\n\\n    void RE_Direct_Physical( const in IncidentLight directLight,\\n        const in GeometricContext geometry,\\n        const in PhysicalMaterial material,\\n        inout ReflectedLight reflectedLight ) {\\n        // directLight.color is the light color * shadow, internally three.js uses a step function, so\\n        // this value is either the light color or black. in order to lighten up the shadows, we\\n        // take add 50% of the color to grey (to give us either pure white or grey) and multiply this to\\n        // the material's diffuse color.\\n        #if defined(USE_SHADOWMAP)\\n            reflectedLight.directDiffuse = (0.5 * directLight.color +\\n                vec3(0.5,0.5,0.5)) * material.diffuseColor;\\n        #else\\n            reflectedLight.directDiffuse = material.diffuseColor;\\n        #endif\\n    }\\n\\n    void RE_IndirectDiffuse_Physical( const in vec3 irradiance,\\n        const in GeometricContext geometry,\\n        const in PhysicalMaterial material,\\n        inout ReflectedLight reflectedLight ) {\\n            // Disable influence of indirect light (it is handled in the RE_Direct_Physical function)\\n    }\\n\\n    void RE_IndirectSpecular_Physical( const in vec3 radiance,\\n        const in vec3 irradiance,\\n        const in vec3 clearcoatRadiance,\\n        const in GeometricContext geometry,\\n        const in PhysicalMaterial material,\\n        inout ReflectedLight reflectedLight) {\\n            // Disable specular reflection of light.\\n    }\\n\\n    #define RE_Direct               RE_Direct_Physical\\n    #define RE_IndirectDiffuse      RE_IndirectDiffuse_Physical\\n    #define RE_IndirectSpecular     RE_IndirectSpecular_Physical\\n\"},398:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.LuminosityHighPassShader=void 0;const i=n(82);t.LuminosityHighPassShader={uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new i.Color(0)},defaultOpacity:{value:0}},vertexShader:\"\\n    varying vec2 vUv;\\n    void main() {\\n        vUv = uv;\\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n    }\",fragmentShader:\"\\n    uniform sampler2D tDiffuse;\\n    uniform vec3 defaultColor;\\n    uniform float defaultOpacity;\\n    uniform float luminosityThreshold;\\n    uniform float smoothWidth;\\n    varying vec2 vUv;\\n    void main() {\\n        vec4 texel = texture2D( tDiffuse, vUv );\\n        vec3 luma = vec3( 0.299, 0.587, 0.114 );\\n        float v = dot( texel.xyz, luma );\\n        vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\\n        float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\\n        gl_FragColor = mix( outputColor, texel, alpha );\\n    }\"}},4919:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.SepiaShader=void 0,t.SepiaShader={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:\"\\n        varying vec2 vUv;\\n        void main() {\\n            vUv = uv;\\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\\n        }\",fragmentShader:\"\\n        uniform float amount;\\n        uniform sampler2D tDiffuse;\\n        varying vec2 vUv;\\n        void main() {\\n            vec4 color = texture2D( tDiffuse, vUv );\\n            vec3 c = color.rgb;\\n            color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\\n            color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\\n            color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\\n            gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\\n        }\"}},5551:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.VignetteShader=void 0,t.VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:\"\\n        varying vec2 vUv;\\n        void main() {\\n            vUv = uv;\\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\\n        }\",fragmentShader:\"\\n        uniform float offset;\\n        uniform float darkness;\\n        uniform sampler2D tDiffuse;\\n        varying vec2 vUv;\\n        void main() {\\n            vec4 texel = texture2D( tDiffuse, vUv );\\n            vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\\n            gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\\n        }\"}},1509:function(e,t,n){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!(\"get\"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),t.OmvTilerService=t.OmvTileDecoder=t.OmvTileDecoderService=t.OmvDecoder=void 0,r(n(952),t);var o=n(952);Object.defineProperty(t,\"OmvDecoder\",{enumerable:!0,get:function(){return o.VectorTileDataProcessor}}),Object.defineProperty(t,\"OmvTileDecoderService\",{enumerable:!0,get:function(){return o.VectorTileDecoderService}}),Object.defineProperty(t,\"OmvTileDecoder\",{enumerable:!0,get:function(){return o.VectorTileDecoder}}),Object.defineProperty(t,\"OmvTilerService\",{enumerable:!0,get:function(){return o.GeoJsonTilerService}})},1984:function(e,t,n){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!(\"get\"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),r(n(7259),t),r(n(8284),t),r(n(1017),t),r(n(1370),t),r(n(1216),t),r(n(5771),t),r(n(8131),t),r(n(6304),t)},1667:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ColorUtils=void 0;const i=n(82),r=n(797),o=n(7610),s=255,a=new i.Color;var l;(l=t.ColorUtils||(t.ColorUtils={})).getHexFromRgba=function(e,t,n,i){return(0,r.assert)(i>=0&&i<=1),s-Math.floor(i*s)<<24^e*s<<16^t*s<<8^n*s<<0},l.getHexFromRgb=function(e,t,n){return(0,r.assert)(e>=0&&e<=1),(0,r.assert)(t>=0&&t<=1),(0,r.assert)(n>=0&&n<=1),e*s<<16^t*s<<8^n*s<<0},l.getHexFromHsl=function(e,t,n){return(0,r.assert)(e>=0&&e<=1),(0,r.assert)(t>=0&&t<=1),(0,r.assert)(n>=0&&n<=1),a.setHSL(e,t,n).getHex()},l.getRgbaFromHex=function(e,t=new o.RGBA){return(0,r.assert)(0==(0&e),\"Wrong hex format\"),t.r=(e>>16&s)/s,t.g=(e>>8&s)/s,t.b=(e>>0&s)/s,t.a=(s-(e>>24&s))/s,t},l.hasAlphaInHex=function(e){return(0,r.assert)(0==(0&e),\"Wrong hex format\"),e>>24!=0},l.getAlphaFromHex=function(e){return(0,r.assert)(0==(0&e),\"Wrong hex format\"),(s-(e>>24)&s)/s},l.removeAlphaFromHex=function(e){return(0,r.assert)(0==(0&e),\"Wrong hex format\"),16777215&e}},7259:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MapEnv=t.Env=void 0;class n{static isEnv(e){return e instanceof n}lookup(e){}unmap(){return{}}}t.Env=n,t.MapEnv=class extends n{constructor(e,t){super(),this.entries=e,this.parent=t}lookup(e){if(this.entries.hasOwnProperty(e)){const t=this.entries[e];if(void 0!==t)return t}return this.parent?this.parent.lookup(e):void 0}unmap(){const e=this.parent?this.parent.unmap():{};for(const t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e}}},8284:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.evaluateJsonExpr=void 0;const i=n(7259),r=n(8023);t.evaluateJsonExpr=function(e,t,n){return r.Expr.fromJSON(e,n).evaluate(new i.MapEnv(t),r.ExprScope.Value)}},8023:function(e,t,n){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!(\"get\"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),t.InterpolateExpr=t.StepExpr=t.CaseExpr=t.MatchExpr=t.LookupExpr=t.CallExpr=t.HasAttributeExpr=t.ObjectLiteralExpr=t.StringLiteralExpr=t.NumberLiteralExpr=t.BooleanLiteralExpr=t.NullLiteralExpr=t.LiteralExpr=t.VarExpr=t.Expr=t.ExprScope=t.ExprDependencies=void 0;const o=n(82),s=n(2302),a=n(908),l=n(8845),c=n(8628),u=n(1017),h=n(1324),d=n(7610),p=n(5771);r(n(7259),t);const f=new s.ExprEvaluator,m=new a.ExprInstantiator;class g{constructor(){this.properties=new Set}}t.ExprDependencies=g;class v{static of(e){const t=new g;return e.accept(this.instance,t),t}visitNullLiteralExpr(e,t){}visitBooleanLiteralExpr(e,t){}visitNumberLiteralExpr(e,t){}visitStringLiteralExpr(e,t){}visitObjectLiteralExpr(e,t){}visitVarExpr(e,t){t.properties.add(e.name)}visitHasAttributeExpr(e,t){t.properties.add(e.name)}visitCallExpr(e,t){switch(e.args.forEach((e=>e.accept(this,t))),e.op){case\"dynamic-properties\":t.volatile=!0;break;case\"feature-state\":t.featureState=!0,t.properties.add(\"$state\"),t.properties.add(\"$id\");break;case\"id\":t.properties.add(\"$id\");break;case\"zoom\":case\"world-ppi-scale\":case\"world-discrete-ppi-scale\":t.properties.add(\"$zoom\");break;case\"pixel-world-scale\":t.properties.add(\"$pixelToMeters\");break;case\"geometry-type\":t.properties.add(\"$geometryType\")}}visitLookupExpr(e,t){return this.visitCallExpr(e,t)}visitMatchExpr(e,t){e.value.accept(this,t),e.branches.forEach((([e,n])=>n.accept(this,t))),e.fallback.accept(this,t)}visitCaseExpr(e,t){e.branches.forEach((([e,n])=>{e.accept(this,t),n.accept(this,t)})),e.fallback.accept(this,t)}visitStepExpr(e,t){e.input.accept(this,t),e.defaultValue.accept(this,t),e.stops.forEach((([e,n])=>n.accept(this,t)))}visitInterpolateExpr(e,t){e.input.accept(this,t),e.stops.forEach((([e,n])=>n.accept(this,t)))}}var y;v.instance=new v,function(e){e[e.Value=0]=\"Value\",e[e.Condition=1]=\"Condition\",e[e.Dynamic=2]=\"Dynamic\"}(y=t.ExprScope||(t.ExprScope={}));class x{static isExpr(e){return e instanceof x}static parse(e){return new l.ExprParser(e).parse()}static fromJSON(e,t,n,i){return F(e,void 0!==t?{definitions:t,lockedNames:new Set,cache:null!=n?n:new Map,referencedDefinitions:null!=i?i:new Set}:void 0)}evaluate(e,t=y.Value,n){return this.accept(f,new s.ExprEvaluatorContext(f,e,t,n))}instantiate(e){return this.accept(m,e)}dependencies(){return this.m_dependencies||(this.m_dependencies=v.of(this)),this.m_dependencies}intern(e){return e.add(this)}toJSON(){return(new O).serialize(this)}isDynamic(){return void 0===this.m_isDynamic&&(this.m_isDynamic=this.exprIsDynamic()),this.m_isDynamic}}t.Expr=x;class _ extends x{constructor(e){super(),this.name=e}accept(e,t){return e.visitVarExpr(this,t)}exprIsDynamic(){return!1}}t.VarExpr=_;class b extends x{static fromValue(e){switch(typeof e){case\"boolean\":return new M(e);case\"number\":return new S(e);case\"string\":return new E(e);case\"object\":return null===e?w.instance:new T(e);default:throw new Error(`failed to create a literal from '${e}'`)}}exprIsDynamic(){return!1}}t.LiteralExpr=b;class w extends b{constructor(){super(),this.value=null}accept(e,t){return e.visitNullLiteralExpr(this,t)}exprIsDynamic(){return!1}}t.NullLiteralExpr=w,w.instance=new w;class M extends b{constructor(e){super(),this.value=e}accept(e,t){return e.visitBooleanLiteralExpr(this,t)}}t.BooleanLiteralExpr=M;class S extends b{constructor(e){super(),this.value=e}accept(e,t){return e.visitNumberLiteralExpr(this,t)}}t.NumberLiteralExpr=S;class E extends b{constructor(e){super(),this.value=e}get promotedValue(){var e,t,n;return void 0===this.m_promotedValue&&(this.m_promotedValue=null!==(t=null!==(e=d.RGBA.parse(this.value))&&void 0!==e?e:h.Pixels.parse(this.value))&&void 0!==t?t:null),null!==(n=this.m_promotedValue)&&void 0!==n?n:void 0}accept(e,t){return e.visitStringLiteralExpr(this,t)}}t.StringLiteralExpr=E;class T extends b{constructor(e){super(),this.value=e}get isArrayLiteral(){return Array.isArray(this.value)}accept(e,t){return e.visitObjectLiteralExpr(this,t)}}t.ObjectLiteralExpr=T;class A extends x{constructor(e){super(),this.name=e}accept(e,t){return e.visitHasAttributeExpr(this,t)}exprIsDynamic(){return!1}}t.HasAttributeExpr=A;class L extends x{constructor(e,t){super(),this.op=e,this.args=t}get children(){return this.args}accept(e,t){return e.visitCallExpr(this,t)}exprIsDynamic(){var e;const t=null!==(e=this.descriptor)&&void 0!==e?e:s.ExprEvaluator.getOperator(this.op);return!!(t&&t.isDynamicOperator&&t.isDynamicOperator(this))||this.args.some((e=>e.isDynamic()))}}t.CallExpr=L;class C extends L{static parseArray(e,t){const n=e[1];if(void 0===n)throw new Error(\"missing lookup table in 'lookup' expression\");const i=F(n,t);if(!(Array.isArray(n)&&i instanceof T))throw new Error(\"Invalid lookup table expression for operator 'lookup'. It must be a literal or a ref to one.\");const r=i.value;if(!(Array.isArray(r)||r instanceof Map))throw new Error(`Invalid lookup table type (${typeof r}) for operator 'lookup'`);const o=e.slice(2).map((e=>F(e,t)));return o.unshift(i),new C(o)}constructor(e){super(\"lookup\",e),this.args=e}accept(e,t){return e.visitLookupExpr(this,t)}}t.LookupExpr=C;class P extends x{static isValidMatchLabel(e){switch(typeof e){case\"number\":case\"string\":return!0;case\"object\":if(!Array.isArray(e)||0===e.length)return!1;const t=typeof e[0];return(\"number\"===t||\"string\"===t)&&e.every((e=>typeof e===t));default:return!1}}constructor(e,t,n){super(),this.value=e,this.branches=t,this.fallback=n}accept(e,t){return e.visitMatchExpr(this,t)}exprIsDynamic(){return this.value.isDynamic()||this.branches.some((([e,t])=>t.isDynamic()))||this.fallback.isDynamic()}}t.MatchExpr=P;class R extends x{constructor(e,t){super(),this.branches=e,this.fallback=t}accept(e,t){return e.visitCaseExpr(this,t)}exprIsDynamic(){return this.branches.some((([e,t])=>e.isDynamic()||t.isDynamic()))||this.fallback.isDynamic()}}t.CaseExpr=R;class D extends x{constructor(e,t,n){super(),this.input=e,this.defaultValue=t,this.stops=n}accept(e,t){return e.visitStepExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.defaultValue.isDynamic()||this.stops.some((([e,t])=>t.isDynamic()))}}t.StepExpr=D;class I extends x{constructor(e,t,n){super(),this.mode=e,this.input=t,this.stops=n}accept(e,t){return e.visitInterpolateExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.stops.some((([e,t])=>t.isDynamic()))}}t.InterpolateExpr=I;class O{serialize(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value instanceof o.Vector2?[\"make-vector\",e.value.x,e.value.y]:e.value instanceof o.Vector3?[\"make-vector\",e.value.x,e.value.y,e.value.z]:e.value instanceof o.Vector4?[\"make-vector\",e.value.x,e.value.y,e.value.z,e.value.w]:[\"literal\",e.value]}visitVarExpr(e,t){return[\"get\",e.name]}visitHasAttributeExpr(e,t){return[\"has\",e.name]}visitCallExpr(e,t){return[e.op,...e.args.map((e=>this.serialize(e)))]}visitLookupExpr(e,t){return this.visitCallExpr(e,t)}visitMatchExpr(e,t){const n=[];for(const[t,i]of e.branches)n.push(t,this.serialize(i));return[\"match\",this.serialize(e.value),...n,this.serialize(e.fallback)]}visitCaseExpr(e,t){const n=[];for(const[t,i]of e.branches)n.push(this.serialize(t),this.serialize(i));return[\"case\",...n,this.serialize(e.fallback)]}visitStepExpr(e,t){const n=[\"step\"];return n.push(this.serialize(e.input)),n.push(this.serialize(e.defaultValue)),e.stops.forEach((([e,t])=>{n.push(e),n.push(this.serialize(t))})),n}visitInterpolateExpr(e,t){const n=[\"interpolate\",e.mode];return n.push(this.serialize(e.input)),e.stops.forEach((([e,t])=>{n.push(e),n.push(this.serialize(t))})),n}}function F(e,t){if(Array.isArray(e))return N(e,t);if(null===e)return w.instance;if(\"boolean\"==typeof e)return new M(e);if(\"number\"==typeof e)return new S(e);if(\"string\"==typeof e)return new E(e);throw new Error(`failed to create expression from: ${JSON.stringify(e)}`)}function N(e,t){const n=e[0];if(\"string\"!=typeof n)throw new Error(\"expected a builtin function name\");switch(n){case\"!has\":case\"!in\":return new L(\"!\",[N([n.slice(1),...e.slice(1)])]);case\"ref\":return function(e,t){if(\"string\"!=typeof e[1])throw new Error(\"expected the name of an attribute\");if(void 0===t)throw new Error(\"ref used with no definitions\");const n=e[1];if(t.lockedNames.has(n))throw new Error(`circular referene to '${n}'`);if(!(n in t.definitions))throw new Error(`definition '${n}' not found`);t.referencedDefinitions.add(n);const i=t.cache.get(n);if(void 0!==i)return i;let r,o=t.definitions[n];const s=(0,p.getDefinitionValue)(o);if((0,c.isInterpolatedPropertyDefinition)(s))return x.fromJSON((0,c.interpolatedPropertyDefinitionToJsonExpr)(o));if(!(0,u.isJsonExpr)(s))return x.fromJSON(s);if(o=s,!(0,u.isJsonExpr)(o))throw new Error(`unsupported definition ${n}`);t.lockedNames.add(n);try{r=F(o,t)}finally{t.lockedNames.delete(n)}return t.cache.set(n,r),r}(e,t);case\"get\":return function(e,t){if(void 0!==e[2])return z(\"get\",e,t);const n=e[1];if(\"string\"!=typeof n)throw new Error(\"expected the name of an attribute\");return new _(n)}(e,t);case\"has\":return function(e,t){if(void 0!==e[2])return z(\"has\",e,t);const n=e[1];if(\"string\"!=typeof n)throw new Error(\"expected the name of an attribute\");return new A(n)}(e,t);case\"literal\":return function(e){const t=e[1];if(null===t||\"object\"!=typeof t)throw new Error(\"expected an object or array literal\");return new T(t)}(e);case\"match\":return function(e,t){if(e.length<4)throw new Error(\"not enough arguments\");if(!(e.length%2))throw new Error(\"fallback is missing in 'match' expression\");const n=F(e[1],t),i=[];for(let n=2;n<e.length-1;n+=2){const r=e[n];if(!P.isValidMatchLabel(r))throw new Error(`'${JSON.stringify(r)}' is not a valid label for 'match'`);const o=F(e[n+1],t);i.push([r,o])}const r=F(e[e.length-1],t);return new P(n,i,r)}(e,t);case\"case\":return function(e,t){if(e.length<3)throw new Error(\"not enough arguments\");if(e.length%2)throw new Error(\"fallback is missing in 'case' expression\");const n=[];for(let i=1;i<e.length-1;i+=2){const r=F(e[i],t),o=F(e[i+1],t);n.push([r,o])}const i=F(e[e.length-1],t);return new R(n,i)}(e,t);case\"interpolate\":return function(e,t){const n=e[1];if(!function(e){if(!Array.isArray(e))return!1;switch(e[0]){case\"discrete\":case\"linear\":case\"cubic\":case\"exponential\":return!0;default:return!1}}(n))throw new Error(\"expected an interpolation type\");if(\"exponential\"===n[0]&&\"number\"!=typeof n[1])throw new Error(\"expected the base of the exponential interpolation\");const i=void 0!==e[2]?F(e[2],t):void 0;if(!x.isExpr(i))throw new Error(\"expected the input of the interpolation\");if(3===e.length||!(e.length%2))throw new Error(\"invalid number of samples\");const r=[];for(let n=3;n<e.length-1;n+=2){const i=e[n],o=F(e[n+1],t);r.push([i,o])}return new I(n,i,r)}(e,t);case\"step\":return function(e,t){if(e.length<2)throw new Error(\"expected the input of the 'step' operator\");if(e.length<3||!(e.length%2))throw new Error(\"not enough arguments\");const n=F(e[1],t),i=F(e[2],t),r=[];for(let n=3;n<e.length;n+=2){const i=e[n],o=F(e[n+1],t);r.push([i,o])}return new D(n,i,r)}(e,t);case\"lookup\":return C.parseArray(e,t);default:return z(n,e,t)}}function z(e,t,n){return new L(e,t.slice(1).map((e=>F(e,n))))}},2302:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ExprEvaluator=t.ExprEvaluatorContext=void 0;const i=n(82),r=n(8023),o=n(6073),s=n(7290),a=n(4672),l=n(8998),c=n(1954),u=n(2181),h=n(202),d=n(4054),p=n(9764),f=n(7029),m=n(3501),g=n(5113),v=n(545),y=n(1324),x=n(7610),_=new Map;function b(e,t){var n,i,o;if(t instanceof r.StringLiteralExpr)return null!==(n=t.promotedValue)&&void 0!==n?n:t.value;const s=e.evaluate(t);return\"string\"==typeof s&&null!==(o=null!==(i=x.RGBA.parse(s))&&void 0!==i?i:y.Pixels.parse(s))&&void 0!==o?o:s}t.ExprEvaluatorContext=class{constructor(e,t,n,i){this.evaluator=e,this.env=t,this.scope=n,this.cache=i}evaluate(e){var t,n;if(void 0===e)throw new Error(\"Failed to evaluate expression\");const i=null===(t=this.cache)||void 0===t?void 0:t.get(e);if(void 0!==i)return i;const r=e.accept(this.evaluator,this);return null===(n=this.cache)||void 0===n||n.set(e,r),r}wrapValue(e){return r.Expr.isExpr(e)?e:r.LiteralExpr.fromValue(e)}};class w{static defineOperator(e,t){_.set(e,t)}static defineOperators(e){Object.getOwnPropertyNames(e).forEach((t=>{this.defineOperator(t,e[t])}))}static getOperator(e){return _.get(e)}visitVarExpr(e,t){const n=t.env.lookup(e.name);return void 0!==n?n:null}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value}visitHasAttributeExpr(e,t){return void 0!==t.env.lookup(e.name)}visitMatchExpr(e,t){const n=t.evaluate(e.value);for(const[i,r]of e.branches){if(Array.isArray(i)&&i.includes(n))return t.evaluate(r);if(i===n)return t.evaluate(r)}return t.evaluate(e.fallback)}visitCaseExpr(e,t){if(t.scope===r.ExprScope.Value){const n=e.branches.findIndex((([e,t])=>e.isDynamic()));if(-1!==n){let i;for(let o=0;o<e.branches.length;++o){const[s,a]=e.branches[o],l=t.evaluate(s),c=t.evaluate(a);if(o<n&&Boolean(l))return c;if((r.Expr.isExpr(l)||Boolean(l))&&(void 0===i&&(i=[]),null==i||i.push([t.wrapValue(l),t.wrapValue(c)]),!r.Expr.isExpr(l)&&Boolean(l)))return new r.CaseExpr(i,r.LiteralExpr.fromValue(null))}const o=t.evaluate(e.fallback);return void 0===i?o:new r.CaseExpr(i,t.wrapValue(o))}}for(const[n,i]of e.branches)if(t.evaluate(n))return t.evaluate(i);return t.evaluate(e.fallback)}visitCallExpr(e,t){var n;const i=null!==(n=e.descriptor)&&void 0!==n?n:_.get(e.op);if(i){let n;if(e.descriptor=i,t.scope===r.ExprScope.Value&&e.isDynamic()){if(e.descriptor.partialEvaluate)return e.descriptor.partialEvaluate(t,e);const i=e.args.map((e=>t.wrapValue(t.evaluate(e))));if(i.every(((t,n)=>t===e.args[n])))return e;n=new r.CallExpr(e.op,i)}else n=i.call(t,e);return n}throw new Error(`undefined operator '${e.op}'`)}visitLookupExpr(e,t){return this.visitCallExpr(e,t)}visitStepExpr(e,t){if(t.scope===r.ExprScope.Value){const n=t.evaluate(e.input),i=t.evaluate(e.defaultValue);return new r.StepExpr(t.wrapValue(n),t.wrapValue(i),e.stops.map((([e,n])=>{const i=t.evaluate(n);return[e,t.wrapValue(i)]})))}{const n=t.evaluate(e.input);if(\"number\"!=typeof n)throw new Error(`input '${n}' must be a number`);if(n<e.stops[0][0])return t.evaluate(e.defaultValue);let i=e.stops.findIndex((e=>e[0]>n));return-1===i&&(i=e.stops.length),t.evaluate(e.stops[i-1][1])}}visitInterpolateExpr(e,t){if(t.scope===r.ExprScope.Value){const n=t.evaluate(e.input);return new r.InterpolateExpr(e.mode,t.wrapValue(n),e.stops.map((([e,n])=>{const i=t.evaluate(n);return[e,t.wrapValue(i)]})))}{const n=t.evaluate(e.input);if(\"number\"!=typeof n)throw new Error(\"input must be a number\");if(\"cubic\"===e.mode[0])return function(e,t,n){if(n<t.stops[0][0])return b(e,t.stops[0][1]);if(n>=t.stops[t.stops.length-1][0])return b(e,t.stops[t.stops.length-1][1]);const r=t.stops.findIndex((e=>e[0]>n)),o=Math.max(0,r-1),s=0===o?r:o-1,a=r<t.stops.length-1?r+1:r-1,l=t.stops[s][0],c=t.stops[o][0],u=t.stops[r][0],h=.5*(u-c),d=h/(c-l),p=h/(t.stops[a][0]-u),f=(n-c)/(u-c),m=f*f,g=m*f,v=-d*g+2*d*m-d*f,_=(1+d)*g+(-1.5-2*d)*m+(-.5+d)*f+1,w=(-1-p)*g+(1.5+p)*m+.5*f,M=p*g-p*m,S=b(e,t.stops[s][1]),E=b(e,t.stops[o][1]),T=b(e,t.stops[r][1]),A=b(e,t.stops[a][1]);if(\"number\"==typeof S&&\"number\"==typeof E&&\"number\"==typeof T&&\"number\"==typeof A)return v*S+_*E+w*T+M*A;if(S instanceof x.RGBA&&E instanceof x.RGBA&&T instanceof x.RGBA&&A instanceof x.RGBA)return new x.RGBA(i.MathUtils.clamp(v*S.r+_*E.r+w*T.r+M*A.r,0,1),i.MathUtils.clamp(v*S.g+_*E.g+w*T.g+M*A.g,0,1),i.MathUtils.clamp(v*S.b+_*E.b+w*T.b+M*A.b,0,1),i.MathUtils.clamp(v*S.a+_*E.a+w*T.a+M*A.a,0,1));if(S instanceof y.Pixels&&E instanceof y.Pixels&&T instanceof y.Pixels&&A instanceof y.Pixels)return new y.Pixels(v*S.value+_*E.value+w*T.value+M*A.value);if(S instanceof i.Color&&E instanceof i.Color&&T instanceof i.Color&&A instanceof i.Color)return new i.Color(v*S.r+_*E.r+w*T.r+M*A.r,v*S.g+_*E.g+w*T.g+M*A.g,v*S.b+_*E.b+w*T.b+M*A.b);if(S instanceof i.Vector2&&E instanceof i.Vector2&&T instanceof i.Vector2&&A instanceof i.Vector2)return new i.Vector2(v*S.x+_*E.x+w*T.x+M*A.x,v*S.y+_*E.y+w*T.y+M*A.y);if(S instanceof i.Vector3&&E instanceof i.Vector3&&T instanceof i.Vector3&&A instanceof i.Vector3)return new i.Vector3(v*S.x+_*E.x+w*T.x+M*A.x,v*S.y+_*E.y+w*T.y+M*A.y,v*S.z+_*E.z+w*T.z+M*A.z);if(S instanceof i.Vector4&&E instanceof i.Vector4&&T instanceof i.Vector4&&A instanceof i.Vector4)return new i.Vector4(v*S.x+_*E.x+w*T.x+M*A.x,v*S.y+_*E.y+w*T.y+M*A.y,v*S.z+_*E.z+w*T.z+M*A.z,v*S.w+_*E.w+w*T.w+M*A.w);if(Array.isArray(S)&&Array.isArray(E)&&Array.isArray(T)&&Array.isArray(A)){const e=S.length,t=[];for(let n=0;n<e;++n)t[n]=v*S[n]+_*E[n]+w*T[n]+M*A[n];return t}throw new Error(\"failed to interpolate values\")}(t,e,n);const r=e.stops.findIndex((e=>e[0]>n));if(-1===r)return t.evaluate(e.stops[e.stops.length-1][1]);if(0===r)return t.evaluate(e.stops[0][1]);const[o,s]=e.stops[r],[a,l]=e.stops[r-1],c=b(t,l);let u=0;switch(e.mode[0]){case\"discrete\":return c;case\"linear\":u=(n-a)/(o-a);break;case\"exponential\":{const t=e.mode[1];u=1===t?(n-a)/(o-a):(Math.pow(t,n-a)-1)/(Math.pow(t,o-a)-1);break}default:throw new Error(`interpolation mode ${JSON.stringify(e.mode)} is not supported`)}const h=b(t,s);if(\"number\"==typeof c&&\"number\"==typeof h)return i.MathUtils.lerp(c,h,u);if(c instanceof x.RGBA&&h instanceof x.RGBA)return c.clone().lerp(h,u);if(c instanceof y.Pixels&&h instanceof y.Pixels)return new y.Pixels(i.MathUtils.lerp(c.value,h.value,u));if(c instanceof i.Color&&h instanceof i.Color)return c.clone().lerp(h,u);if(c instanceof i.Vector2&&h instanceof i.Vector2)return c.clone().lerp(h,u);if(c instanceof i.Vector3&&h instanceof i.Vector3)return c.clone().lerp(h,u);if(c instanceof i.Vector4&&h instanceof i.Vector4)return c.clone().lerp(h,u);if(Array.isArray(c)&&Array.isArray(h)&&c.length===h.length)return c.map(((e,t)=>i.MathUtils.lerp(e,h[t],u)));throw new Error(`todo: mix(${JSON.stringify(c)}, ${JSON.stringify(h)}, ${u})`)}}}t.ExprEvaluator=w,w.defineOperators(s.CastOperators),w.defineOperators(l.ComparisonOperators),w.defineOperators(d.MathOperators),w.defineOperators(m.StringOperators),w.defineOperators(a.ColorOperators),w.defineOperators(g.TypeOperators),w.defineOperators(p.MiscOperators),w.defineOperators(u.FlowOperators),w.defineOperators(o.ArrayOperators),w.defineOperators(f.ObjectOperators),w.defineOperators(c.FeatureOperators),w.defineOperators(h.MapOperators),w.defineOperators(v.VectorOperators)},908:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ExprInstantiator=void 0;const i=n(7259),r=n(8023),o=new i.Env;t.ExprInstantiator=class{visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const n=t.env.lookup(e.name);return r.LiteralExpr.fromValue(void 0!==n?n:null)}visitHasAttributeExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const n=void 0!==t.env.lookup(e.name);return r.LiteralExpr.fromValue(n)}visitCallExprImpl(e,t,n){const i=e.args.map((e=>e.accept(this,t)));return i.some(((t,n)=>t!==e.args[n]))?n(e.op,i):e}visitCallExpr(e,t){return this.visitCallExprImpl(e,t,((e,t)=>new r.CallExpr(e,t)))}visitLookupExpr(e,t){return this.visitCallExprImpl(e,t,((e,t)=>new r.LookupExpr(t)))}visitMatchExpr(e,t){const n=e.value.accept(this,t);if(n instanceof r.LiteralExpr){const i=n.value;for(const[n,r]of e.branches){if(Array.isArray(n)&&n.includes(i))return r.accept(this,t);if(n===i)return r.accept(this,t)}return e.fallback.accept(this,t)}let i=e.value!==n;const o=e.branches.map((([e,n])=>{const r=n.accept(this,t);return r!==n&&(i=!0),[e,r]})),s=e.fallback.accept(this,t);return s!==e.fallback&&(i=!0),i?new r.MatchExpr(n,o,s):e}visitCaseExpr(e,t){const n=[];let i=!1;for(const[s,a]of e.branches){const e=s.accept(this,t),l=e.dependencies();if(s.isDynamic()||0!==l.properties.size)e!==s&&(i=!0),n.push([e,a]);else if(Boolean(e.evaluate(o,r.ExprScope.Condition)))return a.accept(this,t)}if(0===n.length)return e.fallback.accept(this,t);n.length!==e.branches.length&&(i=!0),n.forEach((e=>{const n=e[1].accept(this,t);n!==e[1]&&(i=!0),e[1]=n}));const s=e.fallback.accept(this,t);return s!==e.fallback&&(i=!0),i?new r.CaseExpr(n,s):e}visitStepExpr(e,t){const n=e.input.accept(this,t),i=e.defaultValue.accept(this,t),o=e.stops.map((([e,n])=>[e,n.accept(this,t)]));return new r.StepExpr(n,i,o)}visitInterpolateExpr(e,t){const n=e.input.accept(this,t),i=e.stops.map((([e,n])=>[e,n.accept(this,t)]));return new r.InterpolateExpr(e.mode,n,i)}}},8845:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ExprParser=void 0;const i=n(8023);var r,o;function s(e){switch(e){case r.Tab:case r.Lf:case r.Cr:case r.Space:return!0;default:return!1}}function a(e){return e>=r._0&&e<=r._9}function l(e){return e>=r.a&&e<=r.z||e>=r.A&&e<=r.Z}function c(e){return function(e){return l(e)||a(e)}(e)||e===r._||e===r.Dollar||e===r.Dot||e===r.LBracket||e===r.RBracket}function u(e){switch(e){case o.Eof:return\"eof\";case o.Error:return\"error\";case o.Identifier:return\"identifier\";case o.Number:return\"number\";case o.String:return\"string\";case o.Comma:return\",\";case o.LParen:return\"(\";case o.RParen:return\")\";case o.LBracket:return\"[\";case o.RBracket:return\"]\";case o.Exclaim:return\"!\";case o.TildeEqual:return\"~=\";case o.CaretEqual:return\"^=\";case o.DollarEqual:return\"$=\";case o.EqualEqual:return\"==\";case o.ExclaimEqual:return\"!=\";case o.Less:return\"<\";case o.Greater:return\">\";case o.LessEqual:return\"<=\";case o.GreaterEqual:return\">=\";case o.BarBar:return\"||\";case o.AmpAmp:return\"&&\";default:throw new Error(`invalid token ${e}`)}}!function(e){e[e.Tab=9]=\"Tab\",e[e.Lf=10]=\"Lf\",e[e.Cr=13]=\"Cr\",e[e.Space=32]=\"Space\",e[e.LParen=40]=\"LParen\",e[e.RParen=41]=\"RParen\",e[e.Comma=44]=\"Comma\",e[e.Dot=46]=\"Dot\",e[e.LBracket=91]=\"LBracket\",e[e.Backslash=92]=\"Backslash\",e[e.RBracket=93]=\"RBracket\",e[e._0=48]=\"_0\",e[e._9=57]=\"_9\",e[e._=95]=\"_\",e[e.A=64]=\"A\",e[e.Z=90]=\"Z\",e[e.a=97]=\"a\",e[e.z=122]=\"z\",e[e.DoubleQuote=34]=\"DoubleQuote\",e[e.SingleQuote=39]=\"SingleQuote\",e[e.Exclaim=33]=\"Exclaim\",e[e.Equal=61]=\"Equal\",e[e.Caret=94]=\"Caret\",e[e.Tilde=126]=\"Tilde\",e[e.Dollar=36]=\"Dollar\",e[e.Less=60]=\"Less\",e[e.Greater=62]=\"Greater\",e[e.Bar=124]=\"Bar\",e[e.Amp=38]=\"Amp\"}(r||(r={})),function(e){e[e.Eof=0]=\"Eof\",e[e.Error=1]=\"Error\",e[e.Identifier=2]=\"Identifier\",e[e.Number=3]=\"Number\",e[e.String=4]=\"String\",e[e.Comma=5]=\"Comma\",e[e.LParen=6]=\"LParen\",e[e.RParen=7]=\"RParen\",e[e.LBracket=8]=\"LBracket\",e[e.RBracket=9]=\"RBracket\",e[e.Exclaim=10]=\"Exclaim\",e[e.TildeEqual=11]=\"TildeEqual\",e[e.CaretEqual=12]=\"CaretEqual\",e[e.DollarEqual=13]=\"DollarEqual\",e[e.EqualEqual=14]=\"EqualEqual\",e[e.ExclaimEqual=15]=\"ExclaimEqual\",e[e.Less=16]=\"Less\",e[e.Greater=17]=\"Greater\",e[e.LessEqual=18]=\"LessEqual\",e[e.GreaterEqual=19]=\"GreaterEqual\",e[e.BarBar=20]=\"BarBar\",e[e.AmpAmp=21]=\"AmpAmp\"}(o||(o={}));class h{constructor(e){this.code=e,this.m_token=o.Error,this.m_index=0,this.m_char=r.Lf}token(){return this.m_token}text(){var e;return null!==(e=this.m_text)&&void 0!==e?e:\"\"}next(){if(this.m_token=this.yylex(),this.m_token===o.Error)throw new Error(`unexpected character ${this.m_char}`);return this.m_token}yyinp(){var e;this.m_char=null!==(e=this.code.codePointAt(this.m_index++))&&void 0!==e?e:0}yylex(){for(this.m_text=void 0;s(this.m_char);)this.yyinp();if(0===this.m_char)return o.Eof;const e=this.m_char;switch(this.yyinp(),e){case r.LParen:return o.LParen;case r.RParen:return o.RParen;case r.LBracket:return o.LBracket;case r.RBracket:return o.RBracket;case r.Comma:return o.Comma;case r.SingleQuote:case r.DoubleQuote:{const t=this.m_index-1;for(;this.m_char&&this.m_char!==e;)this.yyinp();if(this.m_char!==e)throw new Error(\"Unfinished string literal\");return this.yyinp(),this.m_text=this.code.substring(t,this.m_index-2),o.String}case r.Exclaim:return this.m_char===r.Equal?(this.yyinp(),o.ExclaimEqual):o.Exclaim;case r.Caret:return this.m_char===r.Equal?(this.yyinp(),o.CaretEqual):o.Error;case r.Tilde:return this.m_char===r.Equal?(this.yyinp(),o.TildeEqual):o.Error;case r.Equal:return this.m_char===r.Equal?(this.yyinp(),o.EqualEqual):o.Error;case r.Less:return this.m_char===r.Equal?(this.yyinp(),o.LessEqual):o.Less;case r.Greater:return this.m_char===r.Equal?(this.yyinp(),o.GreaterEqual):o.Greater;case r.Bar:return this.m_char===r.Bar?(this.yyinp(),o.BarBar):o.Error;case r.Amp:return this.m_char===r.Amp?(this.yyinp(),o.AmpAmp):o.Error;default:{const t=this.m_index-2;if(l(e)||e===r._||e===r.Dollar&&c(this.m_char)){for(;c(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),o.Identifier}if(a(e)){for(;a(this.m_char);)this.yyinp();if(this.m_char===r.Dot)for(this.yyinp();a(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),o.Number}if(e===r.Dollar)return this.m_char===r.Equal?(this.yyinp(),o.DollarEqual):o.Error}}return o.Error}}function d(e){switch(e){case o.TildeEqual:return\"~=\";case o.CaretEqual:return\"^=\";case o.DollarEqual:return\"$=\";case o.EqualEqual:return\"==\";case o.ExclaimEqual:return\"!=\";default:return}}function p(e){switch(e){case o.Less:return\"<\";case o.Greater:return\">\";case o.LessEqual:return\"<=\";case o.GreaterEqual:return\">=\";default:return}}t.ExprParser=class{constructor(e){this.lex=new h(e),this.lex.next()}parse(){return this.parseLogicalOr()}yyexpect(e){if(this.lex.token()!==e)throw new Error(`Syntax error: Expected token '${u(e)}' but found '${u(this.lex.token())}'`);this.lex.next()}parsePrimary(){switch(this.lex.token()){case o.Identifier:{const e=this.lex.text();switch(e){case\"has\":this.lex.next(),this.yyexpect(o.LParen);const t=this.lex.text();return this.yyexpect(o.Identifier),this.yyexpect(o.RParen),new i.HasAttributeExpr(t);case\"length\":this.lex.next(),this.yyexpect(o.LParen);const n=this.parseLogicalOr();return this.yyexpect(o.RParen),new i.CallExpr(\"length\",[n]);default:const r=new i.VarExpr(e);return this.lex.next(),r}}case o.LParen:{this.lex.next();const e=this.parseLogicalOr();return this.yyexpect(o.RParen),e}default:return this.parseLiteral()}}parseLiteral(){switch(this.lex.token()){case o.Number:{const e=new i.NumberLiteralExpr(parseFloat(this.lex.text()));return this.lex.next(),e}case o.String:{const e=new i.StringLiteralExpr(this.lex.text());return this.lex.next(),e}default:throw new Error(\"Syntax error\")}}parseUnary(){return this.lex.token()===o.Exclaim?(this.lex.next(),new i.CallExpr(\"!\",[this.parseUnary()])):this.parsePrimary()}parseRelational(){let e=this.parseUnary();for(;;)if(this.lex.token()===o.Identifier&&\"in\"===this.lex.text()){this.lex.next(),this.yyexpect(o.LBracket);const t=[this.parseLiteral()];for(;this.lex.token()===o.Comma;)this.lex.next(),t.push(this.parseLiteral());this.yyexpect(o.RBracket),e=new i.CallExpr(\"in\",[e,i.LiteralExpr.fromValue(t.map((({value:e})=>e)))])}else{const t=p(this.lex.token());if(void 0===t)break;this.lex.next();const n=this.parseUnary();e=new i.CallExpr(t,[e,n])}return e}parseEquality(){let e=this.parseRelational();for(;;){let t=d(this.lex.token());if(void 0===t)break;\"~=\"===t&&(t=\"in\"),this.lex.next();const n=this.parseRelational();e=new i.CallExpr(t,[e,n])}return e}parseLogicalAnd(){const e=this.parseEquality();if(this.lex.token()!==o.AmpAmp)return e;const t=[e];do{this.lex.next(),t.push(this.parseEquality())}while(this.lex.token()===o.AmpAmp);return new i.CallExpr(\"all\",t)}parseLogicalOr(){const e=this.parseLogicalAnd();if(this.lex.token()!==o.BarBar)return e;const t=[e];do{this.lex.next(),t.push(this.parseLogicalAnd())}while(this.lex.token()===o.BarBar);return new i.CallExpr(\"any\",t)}}},8797:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ExprPool=void 0;const i=n(8023);t.ExprPool=class{constructor(){this.m_booleanLiterals=new Map,this.m_numberLiterals=new Map,this.m_stringLiterals=new Map,this.m_objectLiterals=new Map,this.m_arrayLiterals=[],this.m_varExprs=new Map,this.m_hasAttributeExprs=new Map,this.m_matchExprs=[],this.m_caseExprs=[],this.m_interpolateExprs=[],this.m_stepExprs=[],this.m_callExprs=new Map}add(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return i.NullLiteralExpr.instance}visitBooleanLiteralExpr(e,t){return this.m_booleanLiterals.get(e.value)||(this.m_booleanLiterals.set(e.value,e),e)}visitNumberLiteralExpr(e,t){return this.m_numberLiterals.get(e.value)||(this.m_numberLiterals.set(e.value,e),e)}visitStringLiteralExpr(e,t){return this.m_stringLiterals.get(e.value)||(this.m_stringLiterals.set(e.value,e),e)}visitObjectLiteralExpr(e,t){const n=this.m_objectLiterals.get(e.value);if(n)return n;if(Array.isArray(e.value)){const t=e.value,n=this.m_arrayLiterals.find((e=>{const n=e.value;return n.length===t.length&&t.every(((e,t)=>e===n[t]))}));if(void 0!==n)return n;this.m_arrayLiterals.push(e)}return this.m_objectLiterals.set(e.value,e),e}visitVarExpr(e,t){return this.m_varExprs.get(e.name)||(this.m_varExprs.set(e.name,e),e)}visitHasAttributeExpr(e,t){return this.m_hasAttributeExprs.get(e.name)||(this.m_hasAttributeExprs.set(e.name,e),e)}visitMatchExpr(e,t){const n=e.value.accept(this,t),r=e.branches.map((([e,n])=>[e,n.accept(this,t)])),o=e.fallback.accept(this,t);for(const e of this.m_matchExprs){if(e.value!==n)continue;if(e.fallback!==o)continue;if(e.branches.length!==r.length)continue;let t=!0;for(let n=0;n<r.length;n++)if(r[n][0]!==e.branches[n][0]||r[n][1]!==e.branches[n][1]){t=!1;break}if(t)return e}const s=new i.MatchExpr(n,r,o);return this.m_matchExprs.push(s),s}visitCaseExpr(e,t){const n=e.branches.map((([e,n])=>[e.accept(this,t),n.accept(this,t)])),r=e.fallback.accept(this,t);for(const e of this.m_caseExprs){if(e.fallback!==r)continue;if(e.branches.length!==n.length)continue;let t=!0;for(let i=0;i<n.length;i++)if(n[i][0]!==e.branches[i][0]||n[i][1]!==e.branches[i][1]){t=!1;break}if(t)return e}const o=new i.CaseExpr(n,r);return this.m_caseExprs.push(o),o}visitCallExprImpl(e,t,n){const i=e.args.map((e=>e.accept(this,t)));this.m_callExprs.has(e.op)||this.m_callExprs.set(e.op,[]);const r=this.m_callExprs.get(e.op);for(const e of r){if(e.args.length!==i.length)continue;let t=0;for(;t<e.args.length&&e.args[t]===i[t];++t);if(t===e.args.length)return e}const o=n(e.op,i);return o.descriptor=e.descriptor,r.push(o),o}visitCallExpr(e,t){return this.visitCallExprImpl(e,t,((e,t)=>new i.CallExpr(e,t)))}visitLookupExpr(e,t){return this.visitCallExprImpl(e,t,((e,t)=>new i.LookupExpr(t)))}visitStepExpr(e,t){if(this.m_stepExprs.includes(e))return e;const n=e.input.accept(this,t),r=e.defaultValue.accept(this,t),o=e.stops.map((e=>{const n=e[0],i=e[1].accept(this,t);return i===e[1]?e:[n,i]}));for(const e of this.m_stepExprs)if(e.input===n&&e.defaultValue===r&&o.length===e.stops.length&&o.every((([t,n],i)=>t===e.stops[i][0]&&n===e.stops[i][1])))return e;const s=new i.StepExpr(n,r,o);return this.m_stepExprs.push(s),s}visitInterpolateExpr(e,t){if(this.m_interpolateExprs.includes(e))return e;const n=e.input.accept(this,t),r=e.stops.map((e=>{const n=e[0],i=e[1].accept(this,t);return i===e[1]?e:[n,i]}));for(const t of this.m_interpolateExprs)if(t.input===n&&t.mode[0]===e.mode[0]&&t.mode[1]===e.mode[1]&&r.length===t.stops.length&&r.every((([e,n],i)=>e===t.stops[i][0]&&n===t.stops[i][1])))return t;const o=new i.InterpolateExpr(e.mode,n,r);return this.m_interpolateExprs.push(o),o}}},8628:(e,t)=>{\"use strict\";var n;Object.defineProperty(t,\"__esModule\",{value:!0}),t.interpolatedPropertyDefinitionToJsonExpr=t.isInterpolatedPropertyDefinition=t.InterpolationMode=void 0,(n=t.InterpolationMode||(t.InterpolationMode={}))[n.Discrete=0]=\"Discrete\",n[n.Linear=1]=\"Linear\",n[n.Cubic=2]=\"Cubic\",n[n.Exponential=3]=\"Exponential\",t.isInterpolatedPropertyDefinition=function(e){return!!(e&&void 0===e.interpolationMode&&Array.isArray(e.values)&&e.values.length>0&&void 0!==e.values[0]&&Array.isArray(e.zoomLevels)&&e.zoomLevels.length>0&&void 0!==e.zoomLevels[0]&&e.values.length===e.zoomLevels.length)},t.interpolatedPropertyDefinitionToJsonExpr=function(e){if(void 0===e.interpolation||\"Discrete\"===e.interpolation){const t=[\"step\",[\"zoom\"],e.values[0]];for(let n=1;n<e.zoomLevels.length;++n)t.push(e.zoomLevels[n],e.values[n]);return t}const t=[\"interpolate\"];switch(e.interpolation){case\"Linear\":t.push([\"linear\"]);break;case\"Cubic\":t.push([\"cubic\"]);break;case\"Exponential\":t.push([\"exponential\",void 0!==e.exponent?e.exponent:2]);break;default:throw new Error(`interpolation mode '${e.interpolation}' is not supported`)}t.push([\"zoom\"]);for(let n=0;n<e.zoomLevels.length;++n)t.push(e.zoomLevels[n],e.values[n]);return t}},1017:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isJsonExpr=void 0,t.isJsonExpr=function(e){return Array.isArray(e)&&e.length>0&&\"string\"==typeof e[0]}},1324:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.Pixels=void 0;const n=/^((?=\\.\\d|\\d)(?:\\d+)?(?:\\.?\\d*))px$/;class i{static parse(e){const t=n.exec(e);if(null!==t)return new i(Number(t[1]))}constructor(e){this.value=e}toJSON(){return`${this.value}px`}}t.Pixels=i},7610:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.RGBA=void 0;const i=n(82),r=n(1667),o=n(6331);class s{static parse(e){const t=(0,o.parseStringEncodedColor)(e);if(void 0!==t)return r.ColorUtils.getRgbaFromHex(t)}constructor(e=1,t=1,n=1,i=1){this.r=e,this.g=t,this.b=n,this.a=i}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}clone(){return new s(this.r,this.g,this.b,this.a)}fromVector(e){return this.r=e.x,this.g=e.y,this.b=e.z,this.a=e.w,this}toVector(e){return e||(e=new i.Vector4),e.set(this.r,this.g,this.b,this.a),e}fromHex(e){return r.ColorUtils.getRgbaFromHex(e,this),this}getHex(){return r.ColorUtils.getHexFromRgba(this.r,this.g,this.b,this.a)}lerp(e,t){return this.r=i.MathUtils.lerp(this.r,e.r,t),this.g=i.MathUtils.lerp(this.g,e.g,t),this.b=i.MathUtils.lerp(this.b,e.b,t),this.a=i.MathUtils.lerp(this.a,e.a,t),this}toJSON(){return`rgba(${255*this.r<<0}, ${255*this.g<<0}, ${255*this.b<<0}, ${this.a})`}}t.RGBA=s},6331:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.parseStringEncodedColor=t.parseStringEncodedNumeral=t.StringEncodedNumeralFormatMaxSize=t.StringEncodedNumeralFormats=t.StringEncodedColorFormats=t.StringEncodedMetricFormats=t.StringEncodedNumeralType=void 0;const i=n(6925),r=n(797),o=n(1667);var s;!function(e){e[e.Meters=0]=\"Meters\",e[e.Pixels=1]=\"Pixels\",e[e.Hex=2]=\"Hex\"}(s=t.StringEncodedNumeralType||(t.StringEncodedNumeralType={}));const a={type:s.Meters,size:1,regExp:/^((?=\\.\\d|\\d)(?:\\d+)?(?:\\.?\\d*))m$/,decoder:(e,t)=>{const n=a.regExp.exec(e);return!!n&&void 0!==(t[0]=Number(n[1]))}},l={type:s.Pixels,size:1,mask:1,regExp:/^((?=\\.\\d|\\d)(?:\\d+)?(?:\\.?\\d*))px$/,decoder:(e,t)=>{const n=l.regExp.exec(e);return null!==n&&(t[0]=Number(n[1]),!0)}},c={type:s.Hex,size:4,regExp:/^\\#((?:[0-9A-Fa-f][0-9A-Fa-f]){4}|[0-9A-Fa-f]{4})$/,decoder:(e,t)=>{const n=c.regExp.exec(e);if(null===n)return!1;const i=n[1],o=i.length;return(0,r.assert)(4===o||8===o,\"Matched incorrect hex color format\"),4===o?(t[0]=parseInt(i.charAt(0)+i.charAt(0),16)/255,t[1]=parseInt(i.charAt(1)+i.charAt(1),16)/255,t[2]=parseInt(i.charAt(2)+i.charAt(2),16)/255,t[3]=4===o?parseInt(i.charAt(3)+i.charAt(3),16)/255:1):8===o&&(t[0]=parseInt(i.charAt(0)+i.charAt(1),16)/255,t[1]=parseInt(i.charAt(2)+i.charAt(3),16)/255,t[2]=parseInt(i.charAt(4)+i.charAt(5),16)/255,t[3]=8===o?parseInt(i.charAt(6)+i.charAt(7),16)/255:1),!0}};t.StringEncodedMetricFormats=[a,l];const u=t.StringEncodedMetricFormats.reduce(((e,t)=>Math.max(e,t.size)),0);t.StringEncodedColorFormats=[c];const h=t.StringEncodedColorFormats.reduce(((e,t)=>Math.max(e,t.size)),0);t.StringEncodedNumeralFormats=[...t.StringEncodedMetricFormats,...t.StringEncodedColorFormats],t.StringEncodedNumeralFormatMaxSize=Math.max(h,u);const d=new Array(t.StringEncodedNumeralFormatMaxSize);function p(e,t,n=1){const r=t.find((t=>!!t.decoder(e,d)));if(void 0===r){const t=(0,i.parseCSSColor)(e);return Array.isArray(t)&&!t.some((e=>isNaN(e)))?o.ColorUtils.getHexFromRgba(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}switch(null==r?void 0:r.type){case s.Pixels:return d[0]*n;case s.Hex:return o.ColorUtils.getHexFromRgba(d[0],d[1],d[2],d[3]);default:return d[0]}}t.parseStringEncodedNumeral=function(e,n=1){return p(e,t.StringEncodedNumeralFormats,n)},t.parseStringEncodedColor=function(e){return p(e,t.StringEncodedColorFormats)}},1370:(e,t)=>{\"use strict\";var n,i,r;Object.defineProperty(t,\"__esModule\",{value:!0}),t.isTextureBuffer=t.PlacementToken=t.transientToPickability=t.Pickability=t.TextureCoordinateType=void 0,(r=t.TextureCoordinateType||(t.TextureCoordinateType={})).TileSpace=\"tile-space\",r.EquirectangularSpace=\"equirectangular-space\",r.FeatureSpace=\"feature-space\",function(e){e.onlyVisible=\"only-visible\",e.transient=\"transient\",e.all=\"all\"}(n=t.Pickability||(t.Pickability={})),t.transientToPickability=function(e){let t=n.onlyVisible;return null!=e&&(t=\"string\"==typeof e?e:!0===e?n.transient:n.onlyVisible),t},(i=t.PlacementToken||(t.PlacementToken={})).TopLeft=\"TL\",i.Top=\"T\",i.TopRight=\"TR\",i.Right=\"R\",i.BottomRight=\"BR\",i.Bottom=\"B\",i.BottomLeft=\"BL\",i.Left=\"L\",i.Center=\"C\",i.NorthWest=\"NW\",i.North=\"N\",i.NorthEast=\"NE\",i.East=\"E\",i.SouthEast=\"SE\",i.South=\"S\",i.SouthWest=\"SW\",i.West=\"W\",t.isTextureBuffer=function(e){return e&&e.buffer&&\"string\"==typeof e.type}},1216:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.setTechniqueRenderOrderOrPriority=t.addBuffersToTransferList=t.textureCoordinateType=t.supportsTextures=t.needsVertexNormals=t.isLabelRejectionLineTechnique=t.isTextTechnique=t.isTerrainTechnique=t.isStandardTechnique=t.isExtrudedPolygonTechnique=t.isFillTechnique=t.isStandardExtrudedLineTechnique=t.isBasicExtrudedLineTechnique=t.isExtrudedLineTechnique=t.isSegmentsTechnique=t.isSpecialDashesLineTechnique=t.isRasterTechnique=t.isSolidLineTechnique=t.isLineTechnique=t.isLineMarkerTechnique=t.isIconTextTechnique=t.isSquaresTechnique=t.isCirclesTechnique=t.TRANSPARENCY_PROPERTY_KEYS=t.TEXTURE_PROPERTY_KEYS=void 0;const i=n(1370);function r(e){return\"labeled-icon\"===e.name}function o(e){return\"line-marker\"===e.name}function s(e){return\"solid-line\"===e.name||\"dashed-line\"===e.name}function a(e){return\"extruded-line\"===e.name}function l(e){return a(e)&&\"standard\"===e.shading}function c(e){return\"fill\"===e.name}function u(e){return\"extruded-polygon\"===e.name}function h(e){return\"standard\"===e.name}function d(e){return\"terrain\"===e.name}function p(e){return\"text\"===e.name}function f(e){return c(e)||h(e)||u(e)||d(e)||s(e)}t.TEXTURE_PROPERTY_KEYS=[\"map\",\"normalMap\",\"displacementMap\",\"roughnessMap\",\"emissiveMap\",\"alphaMap\",\"metalnessMap\",\"bumpMap\",\"dash-image\"],t.TRANSPARENCY_PROPERTY_KEYS=[\"opacity\",\"transparent\"],t.isCirclesTechnique=function(e){return\"circles\"===e.name},t.isSquaresTechnique=function(e){return\"squares\"===e.name},t.isIconTextTechnique=r,t.isLineMarkerTechnique=o,t.isLineTechnique=function(e){return\"line\"===e.name},t.isSolidLineTechnique=s,t.isRasterTechnique=function(e){return\"raster\"===e.name},t.isSpecialDashesLineTechnique=function(e){return(\"solid-line\"===e.name||\"dashed-line\"===e.name)&&void 0!==e.dashes&&\"Square\"!==e.dashes},t.isSegmentsTechnique=function(e){return\"segments\"===e.name},t.isExtrudedLineTechnique=a,t.isBasicExtrudedLineTechnique=function(e){return a(e)&&\"basic\"===e.shading},t.isStandardExtrudedLineTechnique=l,t.isFillTechnique=c,t.isExtrudedPolygonTechnique=u,t.isStandardTechnique=h,t.isTerrainTechnique=d,t.isTextTechnique=p,t.isLabelRejectionLineTechnique=function(e){return\"label-rejection-line\"===e.name},t.needsVertexNormals=function(e){return u(e)||c(e)||h(e)||d(e)||l(e)},t.supportsTextures=f,t.textureCoordinateType=function(e){return f(e)?e.textureCoordinateType:void 0},t.addBuffersToTransferList=function(e,n){if(h(e)||u(e)||d(e))for(const r of t.TEXTURE_PROPERTY_KEYS){const t=e[r];(0,i.isTextureBuffer)(t)&&t.buffer instanceof ArrayBuffer&&n.push(t.buffer)}},t.setTechniqueRenderOrderOrPriority=function(e,t,n){if(p(e)||r(e)||o(e)){if(n&&\"string\"==typeof e._category){const t=n.indexOf(e._category);-1!==t&&(e.priority=n.length-t)}}else if(t&&void 0!==e._styleSet){const n=n=>{const i=null==t?void 0:t.findIndex((t=>t.group===e._styleSet&&t.category===n));return void 0!==i&&-1!==i?10*(i+1):void 0};if(\"string\"==typeof e._category){const t=n(e._category);void 0!==t&&(e.renderOrder=t)}}}},5771:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.isConditionalExtendsEntry=t.isDirectionalLight=t.isAmbientLight=t.getStyles=t.isStylesDictionary=t.isJsonExprReference=t.getDefinitionValue=t.isVerboseDefinition=void 0;const i=n(1017);function r(e){return void 0!==(null==e?void 0:e.value)}function o(e){return void 0!==e&&!Array.isArray(e)}t.isVerboseDefinition=r,t.getDefinitionValue=function(e){return r(e)?e.value:e},t.isJsonExprReference=function(e){return Array.isArray(e)&&2===e.length&&\"ref\"===e[0]&&\"string\"==typeof e[1]},t.isStylesDictionary=o,t.getStyles=function(e){return void 0===e?[]:o(e)?function(e){const t=[];for(const n in e)e[n].forEach((e=>{void 0===e.styleSet&&(e.styleSet=n),t.push(e)}));return t}(e):e},t.isAmbientLight=function(e){return\"ambient\"===e.type},t.isDirectionalLight=function(e){return\"directional\"===e.type},t.isConditionalExtendsEntry=function(e){return void 0!==e&&(0,i.isJsonExpr)(e.when)&&/^(object|string)$/.test(typeof e.value)}},8131:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ThemeVisitor=void 0;const i=n(1017),r=n(5771);t.ThemeVisitor=class{constructor(e){this.theme=e}visitStyles(e){const t=t=>!(0,i.isJsonExpr)(t)&&!!e(t);if(void 0!==this.theme.styles)for(const e of(0,r.getStyles)(this.theme.styles))if(t(e))return!0;return!1}}},797:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.assert=void 0,t.assert=function(e,t){}},6304:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.getPropertyValue=void 0;const i=n(8023),r=n(1324),o=n(7610),s=n(6331);t.getPropertyValue=function(e,t,n){var a,l,c;if(i.Expr.isExpr(e)){let s=e.evaluate(t,i.ExprScope.Dynamic,n);return\"string\"==typeof s&&(s=null!==(l=null!==(a=o.RGBA.parse(s))&&void 0!==a?a:r.Pixels.parse(s))&&void 0!==l?l:s),s instanceof o.RGBA?s.getHex():s instanceof r.Pixels?s.value*(null!==(c=Number(t.lookup(\"$pixelToMeters\")))&&void 0!==c?c:1):s}if(null==e)return null;if(\"string\"!=typeof e)return e;{const n=t.lookup(\"$pixelToMeters\")||1,i=(0,s.parseStringEncodedNumeral)(e,n);return void 0!==i?i:e}}},6073:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ArrayOperators=void 0;const i=n(8023),r=[\"boolean\",\"number\",\"string\"];function o(e,t){if(!(e instanceof i.StringLiteralExpr&&r.includes(e.value)))throw new Error(`expected \"boolean\", \"number\" or \"string\" instead of '${JSON.stringify(e)}'`);const n=e.value;t.forEach(((e,t)=>{if(typeof e!==n)throw new Error(`expected array element at index ${t} to have type '${n}'`)}))}function s(e,t){const n=e.evaluate(t);if(!Array.isArray(n))throw new Error(`'${n}' is not an array`);return n}const a={array:{call:(e,t)=>{switch(t.args.length){case 0:throw new Error(\"not enough arguments\");case 1:return s(e,t.args[0]);case 2:{const n=s(e,t.args[1]);return o(t.args[0],n),n}case 3:{const n=s(e,t.args[2]);return function(e,t){if(!(e instanceof i.NumberLiteralExpr))throw new Error(\"missing expected number of elements\");const n=e.value;if(t.length!==n)throw new Error(`the array must have ${n} element(s)`)}(t.args[1],n),o(t.args[0],n),n}default:throw new Error(\"too many arguments\")}}},\"make-array\":{call:(e,t)=>{if(0===t.args.length)throw new Error(\"not enough arguments\");return[...t.args.map((t=>e.evaluate(t)))]}},at:{call:(e,t)=>{const n=t.args,i=e.evaluate(n[0]);if(\"number\"!=typeof i)throw new Error(\"expected the index of the element to retrieve\");const r=e.evaluate(n[1]);if(!Array.isArray(r))throw new Error(\"expected an array\");return i>=0&&i<r.length?r[i]:null}},slice:{call:(e,t)=>{if(t.args.length<2)throw new Error(\"not enough arguments\");const n=e.evaluate(t.args[0]);if(\"string\"!=typeof n&&!Array.isArray(n))throw new Error(\"input must be a string or an array\");const i=e.evaluate(t.args[1]);if(\"number\"!=typeof i)throw new Error(\"expected an index\");let r;if(t.args.length>2&&(r=e.evaluate(t.args[2]),\"number\"!=typeof r))throw new Error(\"expected an index\");return n.slice(i,r)}}};t.ArrayOperators=a},7290:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.CastOperators=void 0;const n={\"to-boolean\":{call:(e,t)=>Boolean(e.evaluate(t.args[0]))},\"to-string\":{call:(e,t)=>String(e.evaluate(t.args[0]))},\"to-number\":{call:(e,t)=>{for(const n of t.args){const t=Number(e.evaluate(n));if(!isNaN(t))return t}throw new Error(\"cannot convert the value to a number\")}}};t.CastOperators=n},4672:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ColorOperators=void 0;const i=n(82),r=n(1667),o=n(6331),s={alpha:{call:(e,t)=>{let n=e.evaluate(t.args[0]);return\"string\"==typeof n&&(n=(0,o.parseStringEncodedColor)(n)),\"number\"==typeof n?r.ColorUtils.getAlphaFromHex(n):1}},rgba:{call:(e,t)=>{const n=e.evaluate(t.args[0]),o=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]),a=e.evaluate(t.args[3]);if(\"number\"==typeof n&&\"number\"==typeof o&&\"number\"==typeof s&&\"number\"==typeof a&&n>=0&&o>=0&&s>=0&&a>=0&&a<=1)return function(e,t,n,o){return r.ColorUtils.getHexFromRgba(i.MathUtils.clamp(e,0,255)/255,i.MathUtils.clamp(t,0,255)/255,i.MathUtils.clamp(n,0,255)/255,i.MathUtils.clamp(o,0,1))}(n,o,s,a);throw new Error(`unknown color 'rgba(${n},${o},${s},${a})'`)}},rgb:{call:(e,t)=>{const n=e.evaluate(t.args[0]),o=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if(\"number\"==typeof n&&\"number\"==typeof o&&\"number\"==typeof s&&n>=0&&o>=0&&s>=0)return function(e,t,n){return r.ColorUtils.getHexFromRgb(i.MathUtils.clamp(e,0,255)/255,i.MathUtils.clamp(t,0,255)/255,i.MathUtils.clamp(n,0,255)/255)}(n,o,s);throw new Error(`unknown color 'rgb(${n},${o},${s})'`)}},hsl:{call:(e,t)=>{const n=e.evaluate(t.args[0]),o=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if(\"number\"==typeof n&&\"number\"==typeof o&&\"number\"==typeof s&&n>=0&&o>=0&&s>=0)return function(e,t,n){return r.ColorUtils.getHexFromHsl(i.MathUtils.euclideanModulo(e,360)/360,i.MathUtils.clamp(t,0,100)/100,i.MathUtils.clamp(n,0,100)/100)}(n,o,s);throw new Error(`unknown color 'hsl(${n},${o}%,${s}%)'`)}}};t.ColorOperators=s},8998:(e,t)=>{\"use strict\";function n(e,t,n=!1){const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if(!(\"number\"==typeof i&&\"number\"==typeof r||\"string\"==typeof i&&\"string\"==typeof r)&&n)throw new Error(`invalid operands '${i}' and '${r}' for operator '${t.op}'`);switch(t.op){case\"<\":return i<r;case\">\":return i>r;case\"<=\":return i<=r;case\">=\":return i>=r;default:throw new Error(`invalid comparison operator '${t.op}'`)}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.ComparisonOperators=void 0;const i={\"!\":{call:(e,t)=>!e.evaluate(t.args[0])},\"==\":{call:(e,t)=>e.evaluate(t.args[0])===e.evaluate(t.args[1])},\"!=\":{call:(e,t)=>e.evaluate(t.args[0])!==e.evaluate(t.args[1])},\"<\":{call:(e,t)=>n(e,t)},\">\":{call:(e,t)=>n(e,t)},\"<=\":{call:(e,t)=>n(e,t)},\">=\":{call:(e,t)=>n(e,t)}};t.ComparisonOperators=i},1954:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.FeatureOperators=void 0;const i=n(7259),r=n(8023),o={\"geometry-type\":{call:(e,t)=>{switch(e.env.lookup(\"$geometryType\")){case\"point\":return\"Point\";case\"line\":return\"LineString\";case\"polygon\":return\"Polygon\";default:return null}}},\"feature-state\":{isDynamicOperator:()=>!0,call:(e,t)=>{var n,o;if(e.scope!==r.ExprScope.Dynamic)throw new Error(\"feature-state cannot be used in this context\");const s=e.evaluate(t.args[0]);if(\"string\"!=typeof s)throw new Error(\"expected the name of the property of the feature state\");const a=e.env.lookup(\"$state\");return i.Env.isEnv(a)?null!==(n=a.lookup(s))&&void 0!==n?n:null:a instanceof Map&&null!==(o=a.get(s))&&void 0!==o?o:null}},id:{call:(e,t)=>{var n;return null!==(n=e.env.lookup(\"$id\"))&&void 0!==n?n:null}}};t.FeatureOperators=o},2181:(e,t)=>{\"use strict\";function n(e,t,n){switch(t){case\"boolean\":case\"number\":case\"string\":for(const i of n){const n=e.evaluate(i);if(typeof n===t)return n}throw new Error(`expected a '${t}'`);default:throw new Error(`invalid type '${t}'`)}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.FlowOperators=void 0;const i={all:{call:(e,t)=>{for(const n of t.args)if(!e.evaluate(n))return!1;return!0}},any:{call:(e,t)=>{for(const n of t.args)if(e.evaluate(n))return!0;return!1}},none:{call:(e,t)=>{for(const n of t.args)if(e.evaluate(n))return!1;return!0}},boolean:{call:(e,t)=>n(e,\"boolean\",t.args)},number:{call:(e,t)=>n(e,\"number\",t.args)},string:{call:(e,t)=>n(e,\"string\",t.args)}};t.FlowOperators=i},202:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MapOperators=void 0;const i=n(8023),r={\"ppi-scale\":{call:(e,t)=>e.evaluate(t.args[0])*(t.args[1]?e.evaluate(t.args[1]):1)},\"world-ppi-scale\":{isDynamicOperator:()=>!0,call:(e,t)=>{const n=e.evaluate(t.args[0]),i=t.args[1]?e.evaluate(t.args[1]):1,r=e.env.lookup(\"$zoom\");return n*(Math.pow(2,17)/Math.pow(2,r))*i}},\"world-discrete-ppi-scale\":{isDynamicOperator:()=>!0,call:(e,t)=>{const n=e.evaluate(t.args[0]),i=e.env.lookup(\"$zoom\");return n*(40075016.68557849/(256*Math.pow(2,Math.floor(i))))}},\"pixel-world-scale\":{isDynamicOperator:()=>!0,call:(e,t)=>e.evaluate(t.args[0])*(e.env.lookup(\"$pixelToMeters\")||1)},ppi:{call:e=>{const t=e.env.lookup(\"$ppi\");return\"number\"==typeof t?t:72}},zoom:{isDynamicOperator:()=>!0,call:(e,t)=>{var n;return e.scope===i.ExprScope.Value?t:null!==(n=e.env.lookup(\"$zoom\"))&&void 0!==n?n:null}}};t.MapOperators=r},4054:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MathOperators=void 0;const i=n(82),r={\"^\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);if(\"number\"!=typeof n||\"number\"!=typeof i)throw new Error(`invalid operands '${typeof n}' and '${typeof i}' for operator '^'`);return Math.pow(n,i)}},\"-\":{call:(e,t)=>{if(1===t.args.length){const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`ìnvalid operand '${typeof n} for operator '-'`);return-n}const n=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);if(\"number\"!=typeof n||\"number\"!=typeof i)throw new Error(`invalid operands '${typeof n}' and '${typeof i}' for operator '-'`);return n-i}},\"/\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);if(\"number\"!=typeof n||\"number\"!=typeof i)throw new Error(`invalid operands '${typeof n}' and '${typeof i}' for operator '/'`);return n/i}},\"%\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);if(\"number\"!=typeof n||\"number\"!=typeof i)throw new Error(`invalid operands '${typeof n}' and '${typeof i}' for operator '%'`);return n%i}},\"+\":{call:(e,t)=>t.args.reduce(((t,n)=>Number(t)+Number(e.evaluate(n))),0)},\"*\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]),o=\"number\"==typeof n,s=\"number\"==typeof r;let a;if(o&&s)a=n*r;else if(s&&(n instanceof i.Vector2||n instanceof i.Vector3||n instanceof i.Vector4))a=n.clone().multiplyScalar(r);else{if(!o||!(r instanceof i.Vector2||r instanceof i.Vector3||r instanceof i.Vector4))throw new Error(`invalid operands '${typeof n}' and '${typeof r}' for operator '*'`);a=r.clone().multiplyScalar(n)}return a}},abs:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'abs'`);return Math.abs(n)}},acos:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'acos'`);return Math.acos(n)}},asin:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'asin'`);return Math.asin(n)}},atan:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'atan'`);return Math.atan(n)}},ceil:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'ceil'`);return Math.ceil(n)}},cos:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'cos'`);return Math.cos(n)}},e:{call:()=>Math.E},floor:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'floor'`);return Math.floor(n)}},ln:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'ln'`);return Math.log(n)}},ln2:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'ln2'`);return Math.log2(n)}},log10:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'log10'`);return Math.log10(n)}},max:{call:(e,t)=>Math.max(...t.args.map((t=>Number(e.evaluate(t)))))},min:{call:(e,t)=>Math.min(...t.args.map((t=>Number(e.evaluate(t)))))},clamp:{call:(e,t)=>{const n=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if(\"number\"!=typeof n||\"number\"!=typeof r||\"number\"!=typeof o)throw new Error(`invalid operands '${n}', ${r}, ${o} for operator 'clamp'`);return i.MathUtils.clamp(n,r,o)}},pi:{call:()=>Math.PI},round:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'round'`);return Math.round(n)}},sin:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'sin'`);return Math.sin(n)}},sqrt:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'sqrt'`);return Math.sqrt(n)}},tan:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(\"number\"!=typeof n)throw new Error(`invalid operand '${n}' for operator 'tan'`);return Math.tan(n)}}};t.MathOperators=r},9764:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MiscOperators=void 0;const i=n(797),r=n(8023);function o(e){return e.join(\"&\")}function s(e,t){return e+\"=\"+JSON.stringify(t)}function a(e,t=0){if(t>=e.length)return[];const n=a(e,t+1),i=n.length;for(let r=0;r<i;r+=1)n.push([...n[r],e[t]]);return n.push([e[t]]),n}function l(e,t){const n=e.args.slice(1),i=[];for(let e=0;e<n.length;e+=2){const r=t.evaluate(n[e+1]);if(null===r)continue;const o=t.evaluate(n[e]);i.push(s(o,r))}return i.sort().reverse(),function(e){e.sort(((e,t)=>t.length-e.length));const t=e.map((e=>o(e)));return t.push(\"\"),t}(a(i))}const c={length:{call:(e,t)=>{const n=e.evaluate(t.args[0]);if(Array.isArray(n)||\"string\"==typeof n)return n.length;throw new Error(`invalid operand '${n}' for operator 'length'`)}},coalesce:{call:(e,t)=>{for(const n of t.args){const t=e.evaluate(n);if(null!==t)return t}return null}},lookup:{call:(e,t)=>{(0,i.assert)(t.args.length>0,\"missing lookup table\");const n=l(t,e);let a=e.evaluate(t.args[0]);if((0,i.assert)(Array.isArray(a)||a instanceof Map,\"wrong lookup table type\"),Array.isArray(a)){a=function(e){const t=new Map;for(const n of e){if(\"object\"!=typeof n)throw new Error(`Invalid lookup table entry type (${typeof n})`);if(!n.keys)throw new Error(\"Lookup table entry has no 'keys' property.\");if(!n.attributes)throw new Error(\"Lookup table entry has no 'attributes' property.\");const e=o(Object.getOwnPropertyNames(n.keys).sort().map((e=>s(e,n.keys[e]))));t.set(e,n.attributes)}return t}(a);const e=new r.ObjectLiteralExpr(a);t.args[0]=e}return function(e,t){for(const n of e){const e=t.get(n);if(e)return e}return null}(n,a)}},trace:{call:(e,t)=>{const n=[];for(const i of t.args)n.push(e.evaluate(i));return console.error(\"trace: \",...n),n[0]}}};t.MiscOperators=c},7029:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ObjectOperators=void 0;const i=n(7259),r=n(8023),o=Object.prototype.hasOwnProperty;var s;function a(e,t,n){var r;const a=e.evaluate(t[0]);if(\"string\"!=typeof a)throw new Error(\"expected the name of an attribute\");const l=e.evaluate(t[1]);if(l&&\"object\"==typeof l){if(i.Env.isEnv(l)){const e=null!==(r=l.lookup(a))&&void 0!==r?r:null;return n===s.get?e:null!==e}if(o.call(l,a))return n!==s.get||l[a]}return n===s.get&&null}!function(e){e[e.get=0]=\"get\",e[e.has=1]=\"has\"}(s||(s={}));const l={in:{call:(e,t)=>{const n=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);return(\"string\"==typeof n&&\"string\"==typeof i||!!Array.isArray(i))&&i.includes(n)}},get:{call:(e,t)=>a(e,t.args,s.get)},has:{call:(e,t)=>a(e,t.args,s.has)},\"dynamic-properties\":{isDynamicOperator:()=>!0,call:(e,t)=>e.scope===r.ExprScope.Dynamic?e.env:t}};t.ObjectOperators=l},3501:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.StringOperators=void 0;const n={concat:{call:(e,t)=>\"\".concat(...t.args.map((t=>String(e.evaluate(t)))))},downcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleLowerCase()},upcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleUpperCase()},\"regex-replace\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]),r=e.evaluate(t.args[2]);return\"string\"==typeof n&&\"string\"==typeof i&&\"string\"==typeof r?n.replace(new RegExp(i,\"g\"),r):n}},\"~=\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);return\"string\"==typeof n&&\"string\"==typeof i&&n.includes(i)}},\"^=\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);return\"string\"==typeof n&&\"string\"==typeof i&&n.startsWith(i)}},\"$=\":{call:(e,t)=>{const n=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);return\"string\"==typeof n&&\"string\"==typeof i&&n.endsWith(i)}},split:{call:(e,t)=>{const n=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);if(\"string\"==typeof n&&\"string\"==typeof i)return n.split(i);throw new Error(`expected '${n}' and '${i}' to be a string`)}}};t.StringOperators=n},5113:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TypeOperators=void 0,t.TypeOperators={typeof:{call:(e,t)=>typeof e.evaluate(t.args[0])}}},545:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.VectorOperators=void 0;const i=n(82),r=n(8023);function o(e,t,n){let r;switch(n){case\"vector2\":r=i.Vector2;break;case\"vector3\":r=i.Vector3;break;case\"vector4\":r=i.Vector4}for(const n of t.args){const t=e.evaluate(n);if(t instanceof r)return t}throw new Error(`expected a \"${n}\"`)}function s(e,t,n){let r,o;switch(n){case\"vector2\":r=i.Vector2,o=2;break;case\"vector3\":r=i.Vector3,o=3;break;case\"vector4\":r=i.Vector4,o=4}for(const n of t.args){const t=e.evaluate(n);if(t instanceof r)return t;if(Array.isArray(t)&&t.length===o&&t.every((e=>\"number\"==typeof e)))return(new r).fromArray(t)}throw new Error(`expected a \"${n}\"`)}const a={\"make-vector\":{call:(e,t)=>{if(void 0!==t._value)return t._value;if(t.args.length<2)throw new Error(\"not enough arguments\");if(t.args.length>4)throw new Error(\"too many arguments\");const n=t.args.map((t=>e.evaluate(t)));let o;switch(n.forEach(((e,t)=>{if(\"number\"!=typeof e)throw new Error(`expected vector component at index ${t} to have type \"number\"`)})),n.length){case 2:o=(new i.Vector2).fromArray(n);break;case 3:o=(new i.Vector3).fromArray(n);break;case 4:o=(new i.Vector4).fromArray(n);break;default:throw new Error(\"too many arguments\")}return t.args.every((e=>e instanceof r.NumberLiteralExpr))&&(t._value=o),o}},vector2:{call:(e,t)=>o(e,t,\"vector2\")},vector3:{call:(e,t)=>o(e,t,\"vector3\")},vector4:{call:(e,t)=>o(e,t,\"vector4\")},\"to-vector2\":{call:(e,t)=>s(e,t,\"vector2\")},\"to-vector3\":{call:(e,t)=>s(e,t,\"vector3\")},\"to-vector4\":{call:(e,t)=>s(e,t,\"vector4\")}};t.VectorOperators=a},6463:function(e,t,n){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!(\"get\"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),r(n(4992),t),r(n(5337),t),r(n(197),t),r(n(9172),t),r(n(5200),t),r(n(8154),t),r(n(9246),t),r(n(5681),t),r(n(7314),t),r(n(4954),t),r(n(173),t),r(n(34),t),r(n(7250),t),r(n(5177),t),r(n(4713),t),r(n(9276),t),r(n(5704),t),r(n(7427),t),r(n(9206),t)},4342:function(e,t,n){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!(\"get\"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),r(n(6463),t),r(n(5323),t)},7427:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},5681:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},7314:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ContextLogger=void 0,t.ContextLogger=class{constructor(e,t){this.m_logger=e,this.headerMessage=t,this.context=[],this.m_headerLogged=!1,this.warn=this.createLogMethod(\"warn\"),this.info=this.createLogMethod(\"info\"),this.error=this.createLogMethod(\"error\")}pushAttr(e){this.context.push(`${this.context.length>0?\".\":\"\"}${e}`)}pushIndex(e){this.context.push(`[${e}]`)}pop(){this.context.pop()}createLogMethod(e){return(t,...n)=>{this.m_headerLogged||(this.m_logger.info(this.headerMessage),this.m_headerLogged=!0),this.m_logger[e](`${this.context.join(\"\")}: ${t}`,...n)}}}},4992:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.DOMUtils=void 0,function(e){function t(e){return e.substring(0,2)}e.getBrowserLanguages=function(){if(void 0!==navigator.languages&&navigator.languages.length>0){const e=[];for(const n of navigator.languages)e.push(t(n));return e}if(void 0!==navigator.language)return[t(navigator.language)]}}(t.DOMUtils||(t.DOMUtils={}))},9276:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.chainCallbacks=void 0,t.chainCallbacks=function(e,t){return function(...n){return e&&e.apply(this,n),t.apply(this,n)}}},9206:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.convertFragmentShaderToWebGL2=t.convertVertexShaderToWebGL2=void 0,t.convertVertexShaderToWebGL2=function(e){return[\"#define attribute in\",\"#define varying out\",\"#define texture2D texture\"].join(\"\\n\")+\"\\n\"+e},t.convertFragmentShaderToWebGL2=function(e){return[\"#define varying in\",\"out highp vec4 pc_fragColor;\",\"#define gl_FragColor pc_fragColor\",\"#define gl_FragDepthEXT gl_FragDepth\",\"#define texture2D texture\",\"#define textureCube texture\",\"#define texture2DProj textureProj\",\"#define texture2DLodEXT textureLod\",\"#define texture2DProjLodEXT textureProjLod\",\"#define textureCubeLodEXT textureLod\",\"#define texture2DGradEXT textureGrad\",\"#define texture2DProjGradEXT textureProjGrad\",\"#define textureCubeGradEXT textureGrad\"].join(\"\\n\")+\"\\n\"+e}},5337:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GroupedPriorityList=t.PriorityListGroup=void 0;class n{constructor(e,t,n=new Array){this.priority=e,this.zOrder=t,this.elements=n}}t.PriorityListGroup=n,t.GroupedPriorityList=class{constructor(){this.groups=new Map}getGroupKey(e){return`${e.priority}_${e.zOrder}`}add(e){this.getGroup(e).elements.push(e)}clear(){this.groups.clear()}forEachElement(e){this.forEachGroup((t=>{t.elements.forEach(e)}))}forEachGroup(e){for(const[,t]of this.groups)e(t)}count(){let e=0;for(const[,t]of this.groups)e+=t.elements.length;return e}findGroup(e){return this.groups.get(e)}getGroup(e){const t=this.getGroupKey(e);let i=this.findGroup(t);return void 0===i&&(i=new n(e.priority,e.zOrder),this.groups.set(t,i)),i}}},4015:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.ConsoleChannel=void 0,t.ConsoleChannel=class{error(e,...t){console.error(e,...t)}debug(e,...t){console.debug(e,...t)}info(e,...t){console.info(e,...t)}log(e,...t){console.log(e,...t)}trace(e,...t){console.trace(e,...t)}warn(e,...t){console.warn(e,...t)}}},3140:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},6781:(e,t)=>{\"use strict\";var n;Object.defineProperty(t,\"__esModule\",{value:!0}),t.LoggerOptions=t.LogLevel=void 0,(n=t.LogLevel||(t.LogLevel={}))[n.Trace=0]=\"Trace\",n[n.Debug=1]=\"Debug\",n[n.Log=2]=\"Log\",n[n.Info=3]=\"Info\",n[n.Warn=4]=\"Warn\",n[n.Error=5]=\"Error\",n[n.None=6]=\"None\",t.LoggerOptions=class{}},8648:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.Logger=void 0;const i=n(6781);t.Logger=class{constructor(e,t,n){this.name=e,this.m_channel=t,this.enabled=!0,this.level=i.LogLevel.Trace,void 0!==n&&this.update(n)}error(e,...t){this.enabled&&this.level<=i.LogLevel.Error&&this.m_channel.error(this.prefix,e,...t)}debug(e,...t){this.enabled&&this.level<=i.LogLevel.Debug&&this.m_channel.debug(this.prefix,e,...t)}info(e,...t){this.enabled&&this.level<=i.LogLevel.Info&&this.m_channel.info(this.prefix,e,...t)}log(e,...t){this.enabled&&this.level<=i.LogLevel.Log&&this.m_channel.log(this.prefix,e,...t)}trace(e,...t){this.enabled&&this.level<=i.LogLevel.Trace&&this.m_channel.trace(this.prefix,e,...t)}warn(e,...t){this.enabled&&this.level<=i.LogLevel.Warn&&this.m_channel.warn(this.prefix,e,...t)}update(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level}get prefix(){return this.name+\":\"}}},6562:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.LoggerManager=void 0;const i=n(2531);t.LoggerManager=class{static get instance(){return this.m_instance||(this.m_instance=new i.LoggerManagerImpl)}}},2531:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.LoggerManagerImpl=void 0;const i=n(4015),r=n(8648),o=n(7698);t.LoggerManagerImpl=class{constructor(){this.m_loggers=[],this.channel=\"undefined\"==typeof self||void 0!==self.document?new i.ConsoleChannel:new o.WorkerChannel}getLoggerNames(){return this.m_loggers.map((e=>e.name))}getLogger(e){return this.m_loggers.find((t=>t.name===e))}create(e,t={}){void 0!==this.m_levelSetForAll&&(void 0===t.level||t.level<this.m_levelSetForAll)&&(t.level=this.m_levelSetForAll);const n=new r.Logger(e,this.channel,t);return this.m_loggers.push(n),n}dispose(e){const t=this.m_loggers.indexOf(e);if(t<0)throw new Error(`Cannot unregister \"${e}\" : no such logger registered.`);this.m_loggers.splice(t,1)}updateAll(e){for(const t of this.m_loggers)t.update(e)}update(e,t){for(const n of this.m_loggers)n.name===e&&n.update(t)}enableAll(e){for(const t of this.m_loggers)t.enabled=e}enable(e,t){this.update(e,{enabled:t})}setLogLevelForAll(e){this.m_levelSetForAll=e;for(const t of this.m_loggers)t.level=e}setLogLevel(e,t){this.update(e,{level:t})}setChannel(e){this.channel=e}}},3069:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MultiChannel=void 0,t.MultiChannel=class{constructor(...e){this.channels=[],this.channels=e}error(e,...t){for(const n of this.channels)n.error(e,...t)}debug(e,...t){for(const n of this.channels)n.debug(e,...t)}info(e,...t){for(const n of this.channels)n.info(e,...t)}log(e,...t){for(const n of this.channels)n.log(e,...t)}trace(e,...t){for(const n of this.channels)n.trace(e,...t)}warn(e,...t){for(const n of this.channels)n.warn(e,...t)}}},7698:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WorkerChannel=t.WORKERCHANNEL_MSG_TYPE=void 0;const i=n(6781);t.WORKERCHANNEL_MSG_TYPE=\"worker-channel-message\",t.WorkerChannel=class{error(e,...n){const r={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Error};self.postMessage(r)}debug(e,...n){const r={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Debug};self.postMessage(r)}info(e,...n){const r={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Info};self.postMessage(r)}log(e,...n){const r={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Log};self.postMessage(r)}trace(e,...n){const r={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Trace};self.postMessage(r)}warn(e,...n){const r={message:[e,...n],type:t.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Warn};self.postMessage(r)}}},197:function(e,t,n){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!(\"get\"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),r(n(4015),t),r(n(3140),t),r(n(6781),t),r(n(8648),t),r(n(6562),t),r(n(3069),t),r(n(7698),t)},9172:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.Math2D=void 0,function(e){function t(e,t,n,i){return(e-n)*(e-n)+(t-i)*(t-i)}e.Box=class{constructor(e=0,t=0,n=0,i=0){this.x=e,this.y=t,this.w=n,this.h=i}set(e,t,n,i){this.x=e,this.y=t,this.w=n,this.h=i}copy(e){this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h}contains(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t}containsBox(e){const t=e.x+e.w,n=e.y+e.h;return this.contains(e.x,e.y)&&this.contains(t,e.y)&&this.contains(e.x,n)&&this.contains(t,n)}intersects(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y}},e.distSquared=t,e.computeSquaredLineLength=function(e){let t=0;const n=e.length-4;for(let i=0;i<n;i+=3){const n=e[i+3]-e[i],r=e[i+4]-e[i+1];t+=n*n+r*r}return t},e.distToSegmentSquared=function(e,n,i,r,o,s){const a=t(i,r,o,s);if(0===a)return t(e,n,i,r);let l=((e-i)*(o-i)+(n-r)*(s-r))/a;return l=Math.max(0,Math.min(1,l)),t(e,n,i+l*(o-i),r+l*(s-r))},e.intersectLineAndCircle=function(e,t,n,i,r,o=0,s=0){const a=n-e,l=i-t,c=a*a+l*l,u=e*i-n*t-l*o+a*s,h=r*r*c-u*u;if(h<-1e-10)return;const d=u*l,p=-u*a;if(h<1e-10)return{x1:o+d/c,y1:s+p/c};const f=Math.sqrt(h),m=(l<0?-1:1)*a*f,g=Math.abs(l)*f;return{x1:o+(d+m)/c,y1:s+(p+g)/c,x2:o+(d-m)/c,y2:s+(p-g)/c}},e.intersectLines=function(e,t,n,i,r,o,s,a,l={x:0,y:0}){const c=(e-n)*(o-a)-(t-i)*(r-s);if(0===c)return;const u=((e*i-t*n)*(r-s)-(e-n)*(r*a-o*s))/c,h=((e*i-t*n)*(o-a)-(t-i)*(r*a-o*s))/c;return l.x=u,l.y=h,l}}(t.Math2D||(t.Math2D={}))},5200:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.MathUtils=void 0,function(e){function t(e,t,n){return e<t?t:e>n?n:e}e.clamp=t,e.smoothStep=function(e,n,i){return(i=t((i-e)/(n-e),0,1))*i*(3-2*i)},e.smootherStep=function(e,n,i){return(i=t((i-e)/(n-e),0,1))*i*i*(i*(6*i-15)+10)},e.map=function(e,t,n,i,r){return(e-t)*(r-i)/(n-t)+i},e.min2=function(e,t){let n;return void 0!==e&&(n=e),void 0!==t&&(n=void 0===n?t:Math.min(n,t)),n},e.max2=function(e,t){let n;return void 0!==e&&(n=e),void 0!==t&&(n=void 0===n?t:Math.max(n,t)),n},e.isWithinBounds=function(e,t,n){return!(void 0!==t&&e<t||void 0!==n&&e>n)},e.easeInOutCubic=function(e,t,n){return e+(t-e)*(n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1)}}(t.MathUtils||(t.MathUtils={}))},8154:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.applyMixinsWithoutProperties=t.applyMixins=void 0,t.applyMixins=function(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((n=>{e.prototype[n]=t.prototype[n]}))}))},t.applyMixinsWithoutProperties=function(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((n=>{const i=Object.getOwnPropertyDescriptor(t.prototype,n);void 0!==i&&void 0===i.get&&\"constructor\"!==n&&(e.prototype[n]=t.prototype[n])}))}))}},173:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.pick=t.cloneDeep=void 0,t.cloneDeep=function(e){const t=new Map,n=function e(n){if(null===n)return null;if(\"object\"==typeof n){const i=t.get(n);if(void 0!==i)return i;if(Array.isArray(n)){const i=[];t.set(n,i),i.length=n.length;for(let t=0;t<i.length;++t)i[t]=e(n[t]);return i}if(n instanceof Date){const e=new Date(n.getTime());return t.set(n,e),e}if(n instanceof RegExp){const e=new RegExp(n.source,n.flags);return t.set(n,e),e}if(n.constructor!==Object)throw new Error(\"cloneDeep doesn't support objects with custom prototypes\");{const i={};t.set(n,i);for(const t in n)n.hasOwnProperty(t)&&(i[t]=e(n[t]));return i}}return n}(e);return t.clear(),n},t.pick=function(e,t){const n={};for(const i of t)e.hasOwnProperty(i)&&(n[i]=e[i]);return n}},34:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.getOptionValue=void 0,t.getOptionValue=function(...e){for(const t of e)if(null!=t)return t}},4954:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.PerformanceTimer=void 0;class n{static now(){return n.nowFunc()}static getNowFunc(){return\"undefined\"!=typeof performance&&void 0!==performance.now?()=>performance.now():()=>(new Date).getTime()}}t.PerformanceTimer=n,n.instance=new n,n.nowFunc=n.getNowFunc()},5704:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.sampleBilinear=void 0,t.sampleBilinear=function(e,t,n,i,r){const o=t-1,s=n-1,a=i*o,l=Math.floor(a),c=r*s,u=Math.floor(c),h=u*t+l,d=l<o?h+1:h,p=u<s?h+t:h,f=l<o?p+1:p,m=e[h],g=e[d],v=e[p],y=e[f],x=Number.isInteger(a)?0:a-l,_=1-x,b=Number.isInteger(c)?0:c-u,w=1-b;return m*_*w+g*x*w+v*_*b+y*x*b}},7250:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.TaskQueue=void 0,t.TaskQueue=class{constructor(e){var t;this.m_options=e,this.m_taskLists=new Map,null===(t=this.m_options.groups)||void 0===t||t.forEach((e=>{this.m_taskLists.set(e,[])})),this.m_options.prioSortFn&&(this.sort=this.m_options.prioSortFn)}update(e){if(void 0===e)this.m_taskLists.forEach((e=>{this.updateTaskList(e)}));else{const t=this.getTaskList(e);t&&this.updateTaskList(t)}}add(e){var t;if(this.m_taskLists.has(e.group)){const n=this.m_taskLists.get(e.group);if(!(null==n?void 0:n.includes(e)))return null===(t=this.m_taskLists.get(e.group))||void 0===t||t.push(e),!0}return!1}remove(e){var t,n;if(this.m_taskLists.has(e.group)){const i=null===(t=this.m_taskLists.get(e.group))||void 0===t?void 0:t.indexOf(e);if(-1!==i)return null===(n=this.m_taskLists.get(e.group))||void 0===n||n.splice(i,1),!0}return!1}numItemsLeft(e){var t,n;let i=0;return void 0===e?this.m_taskLists.forEach((e=>{i+=e.length})):i+=null!==(n=null===(t=this.getTaskList(e))||void 0===t?void 0:t.length)&&void 0!==n?n:0,i}processNext(e,t,n=1){if(!this.getTaskList(e)||this.numItemsLeft(e)<=0)return!1;for(let i=0;i<n&&this.numItemsLeft(e)>0;i++){const n=this.pull(e,!0);void 0!==n&&(!t||(null==t?void 0:t(n))?n.execute():this.add(n))}return!0}clear(){this.m_taskLists.clear()}pull(e,t=!1){var n,i;let r;return this.getTaskList(e)&&(r=null===(n=this.getTaskList(e))||void 0===n?void 0:n.pop(),t&&r&&(null===(i=r.isExpired)||void 0===i?void 0:i.call(r)))?this.pull(e,t):r}sort(e,t){return t.getPriority()-e.getPriority()}getTaskList(e){return this.m_taskLists.get(e)}updateTaskList(e){var t;for(let n=0;n<e.length;n++){const i=e[n];(null===(t=null==i?void 0:i.isExpired)||void 0===t?void 0:t.call(i))&&(e.splice(n,1),n--)}e.sort(this.sort)}}},5177:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},5323:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.getAppBaseUrl=void 0;const i=n(4713);t.getAppBaseUrl=function(){return\"undefined\"==typeof window?`file://${process.cwd()}/`:(0,i.baseUrl)(window.location.href)}},4713:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.getUrlHostAndProtocol=t.getUrlOrigin=t.baseUrl=t.resolveReferenceUri=void 0,t.resolveReferenceUri=function(e,t){return n.test(t)?t:t.startsWith(\"/\")?r(e)+t:(t.startsWith(\"./\")&&(t=t.substr(2)),i(e)+t)};const n=new RegExp(\"^(((?:[a-z]+:)?//)|(file:/)|(data:))\",\"i\");function i(e){if(void 0===e)return\"./\";let t=e.indexOf(\"#\");return-1!==t&&(e=e.slice(0,t)),t=e.indexOf(\"?\"),-1!==t&&(e=e.slice(0,t)),t=e.lastIndexOf(\"/\"),-1===t?\"./\":e.substring(0,t+1)}function r(e){if(void 0===e)return\"\";const t=o(e);return\"file:\"===t.protocol?\"file://\":t.host&&t.protocol?t.protocol+\"//\"+t.host:t.host?\"//\"+t.host:t.protocol?t.protocol+\"//\":\"\"}function o(e){const t=new RegExp(/^(?:([a-z]+:))?\\/\\/([^\\/]*)/,\"i\"),n=e.match(t);if(!n)throw new Error(`getUrlHostAndProtocol: unable to parse URL '${e}'`);return{protocol:n[1],host:n[2]}}t.baseUrl=i,t.getUrlOrigin=r,t.getUrlHostAndProtocol=o},9246:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.assertExists=t.assert=void 0,t.assert=function(e,t){},t.assertExists=function(e,t){return e}},952:function(e,t,n){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!(\"get\"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)\"default\"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,\"__esModule\",{value:!0}),r(n(1503),t),r(n(6133),t),r(n(9959),t),r(n(5863),t)},9287:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.computeLineAnchorPoints=t.MAX_SEARCH_DEPTH=void 0;const i=n(82),r=new i.Vector3,o=new i.Vector3;t.MAX_SEARCH_DEPTH=3,t.computeLineAnchorPoints=function(e,n){if(e.count<2)return(new Float64Array).buffer;const i=function(e){const t=[];let n=0;for(let i=0;i<e.count-1;++i)n+=r.fromBufferAttribute(e,i).distanceTo(o.fromBufferAttribute(e,i+1)),t.push(n);return t}(e);if(i[i.length-1]<=Number.EPSILON)return(new Float64Array).buffer;const s=function(e,n,i){const s=[],a=e[e.length-1],l=Math.min(t.MAX_SEARCH_DEPTH+1,Math.floor(Math.log2(a/n))),c=l>0?Math.pow(2,l):0,u=c+1,h=a/c;let d=0;for(let t=0;t<u;t++){const n=1===u?a/2:t*h;let l=e.length-1;for(;l!==d;){const t=Math.floor((l+d)/2);n>=e[t]?d=t+1:l=t}const c=e[d],p=1-(c-n)/(c-(0===d?0:e[d-1])),f=r.fromBufferAttribute(i,d).lerp(o.fromBufferAttribute(i,d+1),p);s.push(...f.toArray())}return s}(i,n,e);return new Float64Array(s).buffer}},5863:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0})},9252:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.DecodeInfo=void 0;const i=n(82),r=n(2616);t.DecodeInfo=class{constructor(e,t,n=0){this.targetProjection=e,this.tileKey=t,this.storageLevelOffset=n,this.projectedBoundingBox=new r.OrientedBox3,this.tileBounds=new i.Box3,this.tileSize=new i.Vector3,this.center=new i.Vector3,this.geoBox=this.tilingScheme.getGeoBox(t),this.targetProjection.projectBox(this.geoBox,this.projectedBoundingBox),this.projectedBoundingBox.getCenter(this.center),this.tilingScheme.getWorldBox(t,this.tileBounds),this.tileBounds.getSize(this.tileSize),this.tileSizeOnScreen=256*Math.pow(2,-this.storageLevelOffset),this.columnCount=r.webMercatorTilingScheme.subdivisionScheme.getLevelDimensionX(this.tileKey.level),this.rowCount=r.webMercatorTilingScheme.subdivisionScheme.getLevelDimensionY(this.tileKey.level)}get tilingScheme(){return r.webMercatorTilingScheme}get sourceProjection(){return this.tilingScheme.projection}}},6133:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoJsonTilerService=void 0;const i=n(2626),r=n(9959);t.GeoJsonTilerService=class{static start(){i.WorkerServiceManager.getInstance().register({serviceType:r.GEOJSON_TILER_SERVICE_TYPE,factory:e=>i.TilerService.start(e)})}}},9959:(e,t)=>{\"use strict\";var n;Object.defineProperty(t,\"__esModule\",{value:!0}),t.GEOJSON_TILER_SERVICE_TYPE=t.VECTOR_TILE_DECODER_SERVICE_TYPE=t.OmvGeometryType=void 0,(n=t.OmvGeometryType||(t.OmvGeometryType={}))[n.UNKNOWN=0]=\"UNKNOWN\",n[n.POINT=1]=\"POINT\",n[n.LINESTRING=2]=\"LINESTRING\",n[n.POLYGON=3]=\"POLYGON\",t.VECTOR_TILE_DECODER_SERVICE_TYPE=\"vector-tile-decoder\",t.GEOJSON_TILER_SERVICE_TYPE=\"geojson-tiler\"},7305:(e,t)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.OmvPoliticalViewFeatureModifier=void 0,t.OmvPoliticalViewFeatureModifier=class{constructor(e){this.m_countryCode=e}doProcessPointFeature(e,t,n){return this.processFeature(e,t)}doProcessLineFeature(e,t,n){return this.processFeature(e,t)}doProcessPolygonFeature(e,t,n){return!0}rewriteEnvironment(e,t){this.isPoliticalViewLayer(e)&&this.updateEnvironment(t,this.m_countryCode,\"kind\")}updateEnvironment(e,t,n){const i=this.getAlternativePov(e,t,n);void 0!==i&&(e.entries[n]=i)}getAlternativePov(e,t,n){const i=t,r=e.lookup(`${n}:${i}`);return\"string\"==typeof r&&r.length>0?r:void 0}isPoliticalViewLayer(e){return\"boundaries\"===e||\"places\"===e}processFeature(e,t){let n=!1;if(this.isPoliticalViewLayer(e)){const i=Object.keys(t.unmap()).filter((e=>e.includes(\"kind:\"))).length>0,r=!!t.lookup(`kind:${this.m_countryCode}`),o=!!t.lookup(\"kind\"),s=Boolean(this.m_countryCode);n=!s&&!o&&i||s&&(!o&&i&&!r||o&&r),!n&&s&&r&&this.rewriteEnvironment(e,t)}return!n}}},6441:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.webMercatorTile2TargetTile=t.webMercatorTile2TargetWorld=t.world2tile=t.tile2world=t.createWorldTileTransformationCookie=t.tile2lat=t.lat2tile=t.isArrayBufferLike=void 0;const i=n(82),r=n(2616);function o(e,t){return Math.round((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}function s(e,t){const{north:n,west:i}=t.geoBox,r=Math.log2(e),s=Math.pow(2,t.tileKey.level+r);return{extents:e,scale:s,top:o(n,t.tileKey.level+r),left:Math.round((i+180)/360*s)}}function a(e,t,n,i=!1,o){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=s(e,t));const{top:a,left:l,scale:c}=t.worldTileProjectionCookie,u=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return o.x=(l+n.x)/c*u,o.y=(a+(i?-n.y:n.y))/c*u,o.z=(0,r.isVector3Like)(n)?n.z:0,o}function l(e,t,n,o,s,l=!1){a(e,t,n,l,o),t.targetProjection.reprojectPoint(r.webMercatorProjection,o,o),n instanceof i.Vector3&&s&&(o.z*=t.targetProjection.getScaleFactor(o))}t.isArrayBufferLike=function(e){return\"undefined\"!=typeof SharedArrayBuffer?e instanceof ArrayBuffer||e instanceof SharedArrayBuffer:e instanceof ArrayBuffer},t.lat2tile=o,t.tile2lat=function(e,t){const n=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))},t.createWorldTileTransformationCookie=s,t.tile2world=a,t.world2tile=function(e,t,n,i=!1,o){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=s(e,t));const{top:a,left:l,scale:c}=t.worldTileProjectionCookie,u=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return o.x=Math.round(n.x/u*c-l),o.y=Math.round((i?-1:1)*(n.y/u*c-a)),(0,r.isVector3Like)(o)&&(o.z=n.z),o},t.webMercatorTile2TargetWorld=l,t.webMercatorTile2TargetTile=function(e,t,n,i,r,o=!1){l(e,t,n,i,r,o),i.sub(t.center)}},627:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.Ring=void 0;const i=n(82);t.Ring=class{constructor(e,t,n=4096,r=!1){if(this.points=e,this.textureCoords=t,this.extents=n,this.hasClipInfo=r,void 0!==t&&t.length!==e.length)throw new Error(\"the array of texture coordinates must have the same number of elements of the array of points\");this.vertexStride=2,void 0!==t&&(this.vertexStride=this.vertexStride+2),this.area=i.ShapeUtils.area(this.points),this.winding=this.area<0}toArray(e=[],t=0){var n;return this.points.forEach(((n,i)=>n.toArray(e,t+this.vertexStride*i))),null===(n=this.textureCoords)||void 0===n||n.forEach(((n,i)=>n.toArray(e,t+this.vertexStride*i+2))),e}isProperEdge(e){const t=this.extents,n=(e+1)%this.points.length,i=this.points[e],r=this.points[n];if(this.hasClipInfo){if(i.x!==r.x&&i.y!==r.y)return!0;if(i.x%this.extents!=0&&i.y%this.extents!=0)return!0;if(r.x%this.extents!=0&&r.y%this.extents!=0)return!0;const e=!0===i.isClipped,t=!0===r.isClipped;return!e&&!t}return!(i.x<=0&&r.x<=0||i.x>=t&&r.x>=t||i.y<=0&&r.y<=0||i.y>=t&&r.y>=t)}}},1140:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.VectorTileDataEmitter=void 0;const i=n(1874),r=n(82),o=n(8152),s=n(3561),a=n(2982),l=n(6525),c=n(6189),u=n(2616),h=n(4388),d=n(3711),p=n(4250),f=n(1984),m=n(4342),g=n(9287),v=n(6441),y=n(627),x=m.LoggerManager.instance.create(\"OmvDecodedTileEmitter\"),_=new r.Vector3,b=new r.Vector3,w=new r.Vector3,M=new r.Vector3,S=new r.Vector2,E=new r.Vector2,T=new r.Vector3,A=new r.Vector3,L=new r.Vector3,C=new r.Vector2,P=new r.Vector2,R=new r.Vector2,D=new r.Vector3,I=new r.Vector3,O=new r.Vector3,F=new r.Vector3,N=new r.Vector3,z=new r.Line3,U=Math.PI/8;function B(e,t,n=\"index\"){const i=t>65535?\"uint32\":\"uint16\";return{itemCount:1,name:n,buffer:(\"uint32\"===i?new Uint32Array(e):new Uint16Array(e)).buffer,type:i}}class G{constructor(e){this.type=e,this.positions=[],this.normals=[],this.textureCoordinates=[],this.colors=[],this.extrusionAxis=[],this.indices=[],this.edgeIndices=[],this.groups=[],this.texts=[],this.pathLengths=[],this.stringCatalog=[],this.imageTextures=[],this.textBackgroundImageTextures=[],this.featureStarts=[],this.edgeFeatureStarts=[],this.objInfos=[],this.offsetDirections=[]}addText(e){let t=this.stringCatalog.indexOf(e);return t<0&&(t=this.stringCatalog.length,this.stringCatalog.push(e)),t}}var k;!function(e){e[e.Simple=0]=\"Simple\",e[e.Complex=1]=\"Complex\"}(k||(k={}));const V=new r.Color;t.VectorTileDataEmitter=class{constructor(e,t,n={}){var i,r,o;this.m_decodeInfo=e,this.m_styleSetEvaluator=t,this.m_options=n,this.m_meshBuffers=new Map,this.m_geometries=[],this.m_textGeometries=[],this.m_textPathGeometries=[],this.m_pathGeometries=[],this.m_iconTextGeometries=[],this.m_simpleLines=[],this.m_solidLines=[],this.m_sources=[],this.m_maxGeometryHeight=0,this.m_minGeometryHeight=0,this.m_options.gatherFeatureAttributes=null!==(i=n.gatherFeatureAttributes)&&void 0!==i&&i,this.m_options.skipShortLabels=null===(r=n.skipShortLabels)||void 0===r||r,this.m_options.enableElevationOverlay=null!==(o=n.enableElevationOverlay)&&void 0!==o&&o}get projection(){return this.m_decodeInfo.targetProjection}get center(){return this.m_decodeInfo.center}processPointFeature(e,t,n,i,r){var a;const l=i.env;this.processFeatureCommon(l);const{tileKey:c,columnCount:h,rowCount:d}=this.m_decodeInfo,p=c.column+1<h?t-1:t,m=c.row+1<d?t-1:t,g=n.filter((e=>e.x>=0&&e.x<=p&&e.y>=0&&e.y<=m));if(0!==g.length)for(const e of r){if(void 0===e)continue;const n=e._index,r=this.findOrCreateMeshBuffers(n,o.GeometryType.Point);if(void 0===r)continue;const{positions:c,texts:h,imageTextures:d,textBackgroundImageTextures:p,objInfos:m,offsetDirections:y}=r,x=(0,f.isTextTechnique)(e)||(0,f.isIconTextTechnique)(e);let _,b;const w=(0,f.isIconTextTechnique)(e);if(w){const t=e;_=(0,s.evaluateTechniqueAttr)(i,t.imageTexture),void 0!==t[\"background-image\"]&&(b=(0,s.evaluateTechniqueAttr)(i,t[\"background-image\"]))}const M=(0,o.scaleHeight)(i,e,this.m_decodeInfo.tileKey.level),S=(0,o.getFeatureId)(l.entries);for(const n of g){if(x){const t=e,n=(0,o.getFeatureText)(i,t,this.m_options.languages);void 0!==n&&n.length>0?h.push(r.addText(n)):h.push(-1)}x?(0,v.webMercatorTile2TargetWorld)(t,this.m_decodeInfo,n,T,M):(0,v.webMercatorTile2TargetTile)(t,this.m_decodeInfo,n,T,M);const s=this.projection.type===u.ProjectionType.Planar?T.z:n.z;s>this.m_maxGeometryHeight?this.m_maxGeometryHeight=s:s<this.m_minGeometryHeight&&(this.m_minGeometryHeight=s),c.push(T.x,T.y,T.z),m.push(this.m_options.gatherFeatureAttributes?l.entries:S),y.push(null!==(a=l.lookup(\"offset_direction\"))&&void 0!==a?a:0),w&&(void 0===_?d.push(-1):d.push(r.addText(_)),void 0===b?p.push(-1):p.push(r.addText(b)))}}}processLineFeature(e,t,n,i,a){var l;const c=i.env;this.processFeatureCommon(c);const u=[],h=[],p=[],y=[],_=this.m_decodeInfo.projectedBoundingBox;let b;const w=2*_.extents.x,M=2*_.extents.y,S=Math.max(w,M);let E,C;const P=void 0!==n[0].untiledPositions,R=!1;let D=!1,I=!1;for(const e of a)if(void 0!==e){if(E){const t=this.getTextureCoordinateType(e);(0,m.assert)(void 0===t||C===t)}else E=this.getComputeTexCoordsFunc(e),C=this.getTextureCoordinateType(e);D=D||(0,f.isSpecialDashesLineTechnique)(e),I=I||!D}for(const e of n){const n=[];let i=0;if(P&&(this.m_decodeInfo.targetProjection.projectPoint(e.untiledPositions[0],A),e.untiledPositions.forEach((e=>{this.m_decodeInfo.targetProjection.projectPoint(e,T),i+=T.distanceTo(A),A.copy(T),this.m_decodeInfo.targetProjection.projectPoint(e.normalized(),T),n.push(T.x,T.y,T.z,i)}))),D){b=[];let r=0;const o=e.positions.length;if(o>1){let s=0;for(let a=0;a<o-1;a++){const o=[],l=[],c=[],u=[],d=e.positions[a],f=e.positions[a+1];if((0,v.webMercatorTile2TargetWorld)(t,this.m_decodeInfo,d,T,R),l.push(T.x,T.y,T.z),(0,v.webMercatorTile2TargetWorld)(t,this.m_decodeInfo,f,L,R),l.push(L.x,L.y,L.z),E&&(E(d,t).toArray(c,c.length),E(f,t).toArray(c,c.length)),P){let e=this.findRelativePositionInLine(T,n)/i;u.push(e),e=this.findRelativePositionInLine(L,n)/i,u.push(e)}else{u.push(s);const e=T.distanceTo(L);r+=e,s+=e,u.push(s)}T.sub(this.m_decodeInfo.center),o.push(T.x,T.y,T.z),L.sub(this.m_decodeInfo.center),o.push(L.x,L.y,L.z),b.push(o),h.push(l),p.push(c),y.push(u)}}if(!P&&r>0)for(const e of y)e.forEach(((t,n)=>{e[n]=t/r}))}if(I){const r=[],o=[],s=[],a=[];e.positions.forEach((e=>{if((0,v.webMercatorTile2TargetWorld)(t,this.m_decodeInfo,e,T,R),o.push(T.x,T.y,T.z),E&&E(e,t).toArray(s,s.length),P){const e=this.findRelativePositionInLine(T,n)/i;a.push(e)}T.sub(this.m_decodeInfo.center),r.push(T.x,T.y,T.z)})),u.push(r),h.push(o),p.push(s),y.push(a)}}const O=this.m_decodeInfo.tileKey.level>=11;for(const e of a){if(void 0===e)continue;const t=e._index,n=e.name;if((0,f.isLineTechnique)(e)||(0,f.isSolidLineTechnique)(e)){const n=(0,f.isLineTechnique)(e)?this.m_simpleLines:this.m_solidLines,r=(0,f.isLineTechnique)(e)?k.Simple:k.Complex;D&&((0,m.assert)(void 0!==b,\"OmvDecodedTileEmitter#processLineFeature: Internal error - No localLineSegments\"),this.applyLineTechnique(n,e,t,r,c.entries,b,i,this.getTextureCoordinateType(e)?p:void 0,y)),u.length>0&&this.applyLineTechnique(n,e,t,r,c.entries,u,i,this.getTextureCoordinateType(e)?p:void 0,P?y:void 0)}else if((0,f.isTextTechnique)(e)||(0,f.isIconTextTechnique)(e)||(0,f.isLineMarkerTechnique)(e)){const n=e,a=(0,o.getFeatureText)(i,n,this.m_options.languages);if(void 0===a||0===a.length)continue;if((0,f.isTextTechnique)(e)){let e=[];if(this.m_options.skipShortLabels){const t=S/this.m_decodeInfo.tileSizeOnScreen,n=5*a.length*t*.5,i=n*n;e=this.splitJaggyLines(h,i,U)}else e=h;if(0===e.length)continue;for(const n of e){const e=m.Math2D.computeSquaredLineLength(n);this.m_textPathGeometries.push({technique:t,path:n,pathLengthSqr:e,text:String(a),objInfos:this.m_options.gatherFeatureAttributes?c.entries:(0,o.getFeatureId)(c.entries)})}}else{const n=e,u=(0,s.evaluateTechniqueAttr)(i,n.imageTexture),d=Math.max(Number.EPSILON,null!==(l=(0,s.evaluateTechniqueAttr)(i,n[\"anchor-point-density\"]))&&void 0!==l?l:20),p=this.m_decodeInfo.projectedBoundingBox.extents,f=2*Math.min(p.x,p.y)/d,m=new r.BufferAttribute(new Float64Array,3);for(const e of h)m.array=e,m.count=e.length/m.itemSize,this.m_iconTextGeometries.push({technique:t,positions:{name:\"position\",type:\"float\",buffer:(0,g.computeLineAnchorPoints)(m,f),itemCount:m.itemSize},texts:[0],stringCatalog:[a,u],imageTextures:[1],objInfos:this.m_options.gatherFeatureAttributes?[c.entries]:[(0,o.getFeatureId)(c.entries)]})}}else if((0,f.isLabelRejectionLineTechnique)(e))for(const e of h){const t=[];for(let n=0;n<e.length;n+=3)t.push((new r.Vector3).fromArray(e,n));this.m_pathGeometries.push({path:t})}else if((0,f.isExtrudedLineTechnique)(e)){const n=this.findOrCreateMeshBuffers(t,o.GeometryType.ExtrudedLine);if(void 0===n)continue;const{positions:r,indices:a,groups:l,featureStarts:h,objInfos:p}=n,f=a.length,m=(0,s.evaluateTechniqueAttr)(i,e.lineWidth);if(void 0===m)continue;const g=(0,s.evaluateTechniqueAttr)(i,e.caps,\"Circle\"),v=O&&\"Circle\"===g;u.forEach((e=>{(0,d.triangulateLine)(e,m,r,a,v),h.push(f),p.push(this.m_options.gatherFeatureAttributes?c.entries:(0,o.getFeatureId)(c.entries))}));const y=a.length-f;l.push({start:f,count:y,technique:t})}else x.warn(`OmvDecodedTileEmitter#processLineFeature: Invalid line technique\\n                     ${n} for layer: ${c.entries.$layer} `)}}processPolygonFeature(e,t,n,i,o){const s=i.env;this.processFeatureCommon(s);const l=!1;o.forEach((e=>{if(void 0===e)return;const o=e._index;if(void 0===o)throw new Error(\"OmvDecodedTileEmitter#processPolygonFeature: Internal error - No technique index\");let c;const h=s.lookup(\"bbox\");if(Array.isArray(h)){const[e,t,n,i]=h,o=new u.GeoBox(new u.GeoCoordinates(t,e),new u.GeoCoordinates(i,n));c=new r.Box3,u.webMercatorProjection.projectBox(o,c)}const d=[],p=(0,f.isExtrudedPolygonTechnique)(e),m=(0,f.isFillTechnique)(e),g=(0,f.isStandardTechnique)(e),x=p||m||g,_=this.getComputeTexCoordsFunc(e,c),b=x&&!p;for(const e of n){const n=[];for(let i=0;i<e.rings.length;i++){const o=0===i;let s=e.rings[i];b&&s.some((e=>e.x<0||e.x>t||e.y<0||e.y>t))&&(s=(0,a.clipPolygon)(s,t));const l=r.ShapeUtils.area(s);if(o&&0===l)break;if(0!==l){let e;void 0!==_&&(e=s.map((e=>_(e,t)))),n.push(new y.Ring(s,e,t,b))}}n.length>0&&d.push(n)}const w=(0,f.isSolidLineTechnique)(e)||(0,f.isLineTechnique)(e);if(x)this.applyPolygonTechnique(d,e,o,i,t);else if(w){const n=\"line\"===e.name?this.m_simpleLines:this.m_solidLines,r=\"line\"===e.name?k.Simple:k.Complex,a=(0,f.isSpecialDashesLineTechnique)(e);d.forEach((c=>{const u=[],h=a?[]:void 0;c.forEach((e=>{const n=e.points.length;let i=[],r=0,o=0,s=a?[]:void 0;for(let c=0;c<n;++c){a&&i.length>0&&(i=[],s=[]);const d=(c+1)%n,p=e.points[c],f=e.points[d],m=e.isProperEdge(c);if(m||0===i.length){if(m&&0===i.length&&((0,v.webMercatorTile2TargetTile)(t,this.m_decodeInfo,S.copy(p),T,l),i.push(T.x,T.y,T.z),a)){(0,v.webMercatorTile2TargetTile)(t,this.m_decodeInfo,S.copy(f),L,l),i.push(L.x,L.y,L.z),s.push(o);const e=T.distanceTo(L);r+=e,o+=e,s.push(o)}}else u.push(i),i=[];m&&!a&&((0,v.webMercatorTile2TargetTile)(t,this.m_decodeInfo,S.copy(f),T,l),i.push(T.x,T.y,T.z)),a&&i.length>0&&r>0&&(s.forEach(((e,t)=>{s[t]=e/r})),u.push(i),h.push(s))}!a&&i.length>0&&u.push(i)})),0!==u.length&&this.applyLineTechnique(n,e,o,r,s.entries,u,i,void 0,h)}))}}))}getDecodedTile(){this.createGeometries(),this.processSimpleLines(this.m_simpleLines),this.processLines(this.m_solidLines);const e={techniques:this.m_styleSetEvaluator.decodedTechniques,geometries:this.m_geometries,decodeTime:void 0};return this.m_textGeometries.length>0&&(e.textGeometries=this.m_textGeometries),this.m_iconTextGeometries.length>0&&(e.iconTextGeometries=this.m_iconTextGeometries),this.m_textPathGeometries.length>0&&(e.textPathGeometries=this.m_textPathGeometries),this.m_pathGeometries.length>0&&(e.pathGeometries=this.m_pathGeometries),0!==this.m_sources.length&&(e.copyrightHolderIds=this.m_sources),e.maxGeometryHeight=this.m_maxGeometryHeight,e.minGeometryHeight=this.m_minGeometryHeight,e}splitJaggyLines(e,t,n){const i=[],r=(e,t,n)=>{let i=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(let a=t;a<n;a+=3){const t=e[a],n=e[a+1];t<i&&(i=t),t>r&&(r=t),n<o&&(o=n),n>s&&(s=n)}return(r-i)*(r-i)+(s-o)*(s-o)},o=e.slice();for(;o.length>0;){const e=o.pop();if(void 0===e||e.length<6)continue;let s=-1;for(let t=0;t<e.length-3;t+=3){C.set(e[t],e[t+1]),P.set(e[t+3],e[t+4]);const i=P.sub(C).normalize();if(t>0){const e=Math.atan2(R.x*i.y-i.x*R.y,i.dot(R));if(Math.abs(e)>n){s=t;break}}R.set(i.x,i.y)}if(s>0){const n=r(e,0,s+3),a=r(e,s,e.length);n>t&&i.push(e.slice(0,s+3)),a>t&&o.push(e.slice(s))}else r(e,0,e.length)>t&&i.push(e)}return i}getTextureCoordinateType(e){return((0,f.isFillTechnique)(e)||(0,f.isSolidLineTechnique)(e)||(0,f.isExtrudedPolygonTechnique)(e))&&this.m_options.enableElevationOverlay?f.TextureCoordinateType.TileSpace:(0,f.textureCoordinateType)(e)}getComputeTexCoordsFunc(e,t){switch(this.getTextureCoordinateType(e)){case f.TextureCoordinateType.TileSpace:return(e,t)=>{const n=e.clone().divideScalar(t);return n.y=1-n.y,n};case f.TextureCoordinateType.EquirectangularSpace:return(e,t)=>{const n=(0,v.tile2world)(t,this.m_decodeInfo,e,!1,A),i=u.normalizedEquirectangularProjection.reprojectPoint(u.webMercatorProjection,n);return new r.Vector2(i.x,i.y)};case f.TextureCoordinateType.FeatureSpace:if(!t)return;return(e,n)=>{const i=(0,v.tile2world)(n,this.m_decodeInfo,e,!1,A),o=new r.Vector2(i.x,i.y);return t&&(o.x-=t.min.x,o.y-=t.min.y,o.x/=t.max.x-t.min.x,o.y/=t.max.y-t.min.y),o.y=1-o.y,o};default:return}}applyLineTechnique(e,t,n,i=k.Complex,r,s,a,l,c){let u;const d=e.find((e=>e.technique===n)),p=void 0!==l;if(void 0===d){u=new h.LineGroup(p,void 0,i===k.Simple);const t={type:i===k.Complex?o.GeometryType.SolidLine:o.GeometryType.Line,technique:n,lines:u};this.m_options.gatherFeatureAttributes&&(t.objInfos=[r],t.featureStarts=[0]),e.push(t)}else u=d.lines,this.m_options.gatherFeatureAttributes&&d.objInfos&&d.featureStarts&&(d.objInfos.push(r),d.featureStarts.push(u.indices.length));let f=0;s.forEach((e=>{u.add(this.m_decodeInfo.center,e,this.projection,c?c[f]:void 0,l?l[f]:void 0),f++}))}applyPolygonTechnique(e,t,n,a,h){var d,g;if(0===e.length)return;const y=(0,f.isExtrudedPolygonTechnique)(t),L=y?o.GeometryType.ExtrudedPolygon:o.GeometryType.Polygon,C=this.findOrCreateMeshBuffers(n,L);if(void 0===C)return;const P=t,R=t,D=!0===P.boundaryWalls,I=(0,f.isFillTechnique)(t),O=this.getTextureCoordinateType(t);let F=(0,s.evaluateTechniqueAttr)(a,P.height),N=(0,s.evaluateTechniqueAttr)(a,P.floorHeight);if(void 0===F){const e=a.env.lookup(\"height\"),t=(0,s.evaluateTechniqueAttr)(a,P.defaultHeight);F=void 0!==e?e:void 0!==t?t:0}if(void 0===N){const e=a.env.lookup(\"min_height\");N=void 0===e||I?0:e}F=Math.max(N+p.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT,F);const z=this.m_decodeInfo.tileKey.level,U=y&&(0,o.scaleHeight)(a,P,z);this.m_decodeInfo.tileBounds.getCenter(_);const{positions:G,normals:k,textureCoordinates:H,colors:j,extrusionAxis:W,indices:q,edgeIndices:X,groups:Y}=C,Z=this.m_decodeInfo.targetProjection.type===u.ProjectionType.Spherical,J=y?null!==(d=P.lineWidth)&&void 0!==d?d:0:I&&null!==(g=R.lineWidth)&&void 0!==g?g:0,$=\"number\"!=typeof J||J>0;let K;if((0,f.isExtrudedPolygonTechnique)(t)&&(0,m.getOptionValue)(t.vertexColors,!1)){let e=(0,s.evaluateTechniqueAttr)(a,t.color);if(void 0===e){const t=a.env.lookup(\"color\");this.isColorStringValid(t)&&(e=String(t))}void 0===e&&(e=(0,s.evaluateTechniqueAttr)(a,t.defaultColor,0)),void 0===e&&(e=0),V.set(e),K=V}for(const t of e){const e=q.length,o=X.length,s=[],d=G.length/3,p=t[0],f=p.vertexStride,m=f+2;for(let e=0;e<p.points.length;++e){const t=p.points[e];s.push(t.x,-t.y),void 0!==p.textureCoords&&s.push(p.textureCoords[e].x,p.textureCoords[e].y);const n=(e+1)%p.points.length,i=p.isProperEdge(e);s.push(i?n:-1,D||i?n:-1)}const g=[];let _=1;for(;_<t.length;){const e=s.length/m;g.push(e);const n=t[_++];for(let t=0;t<n.points.length;++t){const i=(t+1)%n.points.length,r=n.points[t];s.push(r.x,-r.y),void 0!==n.textureCoords&&s.push(n.textureCoords[t].x,n.textureCoords[t].y);const o=n.isProperEdge(t);s.push(o?e+i:-1,D||o?e+i:-1)}}try{const e=(0,i.default)(s,g,m),t=s.length/m;if(Z){const t=new r.BufferGeometry,n=[],i=[],o=[],a=[];for(let e=0;e<s.length;e+=m){const t=(0,v.tile2world)(h,this.m_decodeInfo,S.set(s[e],s[e+1]),!0,A);n.push(t.x,t.y,0),void 0!==O&&i.push(s[e+2],s[e+3]),o.push(s[e+f]),a.push(s[e+f+1])}const d=new r.BufferAttribute(new Float32Array(n),3);let p;t.setAttribute(\"position\",d),void 0!==O&&(p=new r.BufferAttribute(new Float32Array(i),2),t.setAttribute(\"uv\",p));const g=new r.BufferAttribute(new Float32Array(o),1);t.setAttribute(\"edge\",g);const y=new r.BufferAttribute(new Float32Array(a),1);t.setAttribute(\"wall\",g);const x=B(e,d.count-1),_=\"uint32\"===x.type?new r.Uint32BufferAttribute(x.buffer,1):new r.Uint16BufferAttribute(x.buffer,1);t.setIndex(_);const b=this.m_decodeInfo.tileKey.level;if(b>=3&&b<9){const e=Math.pow(2,9-b),{geoBox:n}=this.m_decodeInfo;new l.EdgeLengthGeometrySubdivisionModifier(e,n,l.SubdivisionMode.NoDiagonals,u.webMercatorProjection).modify(t)}new c.SphericalGeometrySubdivisionModifier(r.MathUtils.degToRad(10),u.webMercatorProjection).modify(t),s.length=0,e.length=0;for(let e=0;e<d.array.length;e+=3){const t=(0,v.world2tile)(h,this.m_decodeInfo,T.set(d.array[e],d.array[e+1],0),!0,E);s.push(t.x,t.y),void 0!==O&&(s.push(p.array[e/3*2]),s.push(p.array[e/3*2+1])),s.push(g.array[e/3]),s.push(y.array[e/3])}const w=t.getIndex();null!==w&&e.push(...w.array)}b.set(0,0,1);for(let e=0;e<s.length;e+=m){(0,v.webMercatorTile2TargetWorld)(h,this.m_decodeInfo,S.set(s[e],s[e+1]),T,!1,!0);const t=U?this.m_decodeInfo.targetProjection.getScaleFactor(T):1;this.m_maxGeometryHeight=Math.max(this.m_maxGeometryHeight,t*F),this.m_minGeometryHeight=Math.min(this.m_minGeometryHeight,t*F),Z&&b.set(T.x,T.y,T.z).normalize(),T.sub(this.center),w.copy(b).multiplyScalar(N*t),G.push(T.x+w.x,T.y+w.y,T.z+w.z),void 0!==O&&H.push(s[e+2],s[e+3]),this.m_options.enableElevationOverlay&&k.push(...b.toArray()),y&&(M.copy(b).multiplyScalar(F*t),G.push(T.x+M.x,T.y+M.y,T.z+M.z),W.push(0,0,0,0,M.x-w.x,M.y-w.y,M.z-w.z,1),void 0!==O&&H.push(s[e+2],s[e+3]),this.m_options.enableElevationOverlay&&k.push(...b.toArray()),void 0!==K&&j.push(K.r,K.g,K.b,K.r,K.g,K.b))}for(let t=0;t<e.length;t+=3)if(y){const n=d+2*e[t+0]+1,i=d+2*e[t+1]+1,r=d+2*e[t+2]+1;q.push(n,i,r)}else{const n=d+e[t+0],i=d+e[t+1],r=d+e[t+2];q.push(n,i,r)}$&&this.addEdges(d,t,m,f,G,s,X,y,P.footprint,P.maxSlope),y&&this.addWalls(d,t,m,f,s,q)}catch(e){x.error(\"cannot triangulate geometry\",e)}this.m_options.gatherFeatureAttributes&&(C.objInfos.push(a.env.entries),C.featureStarts.push(e),C.edgeFeatureStarts.push(o));const L=q.length-e;L>0&&Y.push({start:e,count:L,technique:n})}}createGeometries(){this.m_meshBuffers.forEach(((e,t)=>{if(0===e.positions.length)return;if(!this.m_styleSetEvaluator.techniques||this.m_styleSetEvaluator.techniques.length<=t)throw new Error(\"Invalid technique index\");const n=this.m_styleSetEvaluator.techniques[t];if(void 0===n)return;if(e.texts.length>0){const i={positions:{name:\"position\",type:\"float\",buffer:new Float64Array(e.positions).buffer,itemCount:3},texts:e.texts,technique:t,stringCatalog:e.stringCatalog,objInfos:e.objInfos};if((0,f.isTextTechnique)(n))this.m_textGeometries.push(i);else{(0,m.assert)((0,f.isIconTextTechnique)(n));const t=i;t.imageTextures=e.imageTextures,t.textBackgroundImageTextures=e.textBackgroundImageTextures,t.offsetDirections=e.offsetDirections,this.m_iconTextGeometries.push(t)}return}const i=new Float32Array(e.positions);0===e.groups.length&&e.groups.push({start:0,count:i.length/3,technique:t});const r=[{name:\"position\",buffer:i.buffer,itemCount:3,type:\"float\"}],o={type:e.type,vertexAttributes:r,groups:e.groups};if(e.normals.length>0){const t=new Float32Array(e.normals);(0,m.assert)(t.length===i.length,\"length of normals buffer is different than the length of the position buffer\"),r.push({name:\"normal\",buffer:t.buffer,itemCount:3,type:\"float\"})}if(e.colors.length>0){const t=new Float32Array(e.colors);(0,m.assert)(t.length===i.length,\"length of colors buffer is different than the length of the position buffer\"),r.push({name:\"color\",buffer:t.buffer,itemCount:3,type:\"float\"})}const s=e.positions.length/3;if(e.textureCoordinates.length>0){const t=e.textureCoordinates.length/2;(0,m.assert)(t===s,\"length of textureCoordinates buffer is different than the length of theposition buffer\");const n=new Float32Array(e.textureCoordinates);r.push({name:\"uv\",buffer:n.buffer,itemCount:2,type:\"float\"})}if(e.extrusionAxis.length>0){const t=new Float32Array(e.extrusionAxis);(0,m.assert)(t.length/4==i.length/3,\"length of extrusionAxis buffer is different than the length of the position buffer\"),r.push({name:\"extrusionAxis\",buffer:t.buffer,itemCount:4,type:\"float\"})}e.indices.length>0&&(o.index=B(e.indices,s-1)),e.edgeIndices.length>0&&(o.edgeIndex=B(e.edgeIndices,s-1,\"edgeIndex\")),o.featureStarts=e.featureStarts,o.edgeFeatureStarts=e.edgeFeatureStarts,o.objInfos=e.objInfos,this.m_geometries.push(o)}))}processLines(e){e.forEach((e=>{const{vertices:t,indices:n}=e.lines,i=e.technique,r=new Float32Array(t).buffer,s=B(n,t.length/e.lines.stride-1),a={type:\"float\",stride:e.lines.stride,buffer:r,attributes:e.lines.vertexAttributes},l={type:o.GeometryType.SolidLine,index:s,interleavedVertexAttributes:[a],groups:[{start:0,count:n.length,technique:i}],vertexAttributes:[],featureStarts:e.featureStarts,objInfos:e.objInfos};this.m_geometries.push(l)}))}processSimpleLines(e){e.forEach((e=>{const{vertices:t,indices:n}=e.lines,i=e.technique,r={buffer:new Float32Array(t).buffer,itemCount:3,type:\"float\",name:\"position\"},s={type:o.GeometryType.Line,index:B(n,t.length/r.itemCount-1),vertexAttributes:[r],groups:[{start:0,count:n.length,technique:i}],featureStarts:e.featureStarts,objInfos:e.objInfos};this.m_geometries.push(s)}))}findOrCreateMeshBuffers(e,t){let n=this.m_meshBuffers.get(e);return void 0!==n?n.type!==t?void x.error(`MeshBuffer has been created with wrong type \"${o.GeometryType[t]}\"\\n                instead of \"${o.GeometryType[n.type]}\"`):n:(n=new G(t),this.m_meshBuffers.set(e,n),n)}processFeatureCommon(e){const t=e.lookup(\"source\");\"string\"==typeof t&&\"\"!==t&&(this.m_sources.includes(t)||this.m_sources.push(t))}isColorStringValid(e){return\"string\"==typeof e&&e.length>0}addEdges(e,t,n,i,o,s,a,l,c,u){const h=new r.Vector3,d=new r.Vector3;let p,f,m=0,g=0;for(;m<t;){for(;m!==p;){void 0===p&&(p=m),m<t&&(g=Math.max(g,m));const r=s[m*n+i];if(r<0)break;if(l)if(!0===c&&a.push(e+2*m,e+2*r),a.push(e+2*m+1,e+2*r+1),void 0!==u){if(void 0!==f){const t=3*(e+2*f),n=3*(e+2*m),i=3*(e+2*r);h.set(o[n]-o[t],o[n+1]-o[t+1],o[n+2]-o[t+2]).normalize(),d.set(o[i]-o[n],o[i+1]-o[n+1],o[i+2]-o[n+2]).normalize(),h.dot(d)<=u&&a.push(e+2*m,e+2*m+1)}}else a.push(e+2*m,e+2*m+1);else a.push(e+m,e+r);f=m,m=r}m=g+1,p=void 0,f=void 0}}addWalls(e,t,n,i,r,o){let s,a=0,l=0;for(;a<t;){for(;a!==s;){void 0===s&&(s=a),a<t&&(l=Math.max(l,a));const c=r[a*n+i+1];if(c<0)break;o.push(e+2*a,e+2*a+1,e+2*c+1,e+2*c+1,e+2*c,e+2*a),a=c}a=l+1,s=void 0}}findRelativePositionInLine(e,t){let n=1/0,i=0;for(let r=0;r<t.length;r+=4){z.set(D.set(t[r],t[r+1],t[r+2]),I.set(t[r+4],t[r+5],t[r+6])),z.closestPointToPoint(e,!0,O);const o=O.distanceTo(e);o<n&&(F.copy(O),N.copy(D),n=o,i=t[r+3])}return i+F.distanceTo(N)}}},1503:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.VectorTileDecoderService=t.VectorTileDecoder=t.VectorTileDataProcessor=void 0;const i=n(7769),r=n(2626),o=n(4342),s=n(5156),a=n(2926),l=n(4585),c=n(9252),u=n(9959),h=n(1140),d=o.LoggerManager.instance.create(\"VectorTileDecoder\",{enabled:!1});class p{constructor(e,t,n,i,r={}){var o,s;this.m_tileKey=e,this.m_projection=t,this.m_styleSetEvaluator=n,this.m_dataAdapter=i,this.m_options=r,r.storageLevelOffset=null!==(o=r.storageLevelOffset)&&void 0!==o?o:0,r.showMissingTechniques=null!==(s=r.showMissingTechniques)&&void 0!==s&&s}getDecodedTile(e){this.m_styleSetEvaluator.resetTechniques();const t=new c.DecodeInfo(this.m_projection,this.m_tileKey,this.m_options.storageLevelOffset);return this.m_decodedTileEmitter=new h.VectorTileDataEmitter(t,this.m_styleSetEvaluator,this.m_options),this.m_dataAdapter.process(e,t,this),this.m_decodedTileEmitter.getDecodedTile()}processPointFeature(e,t,n,i,r){(0,o.assert)(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,n,\"point\",i,r,this.m_decodedTileEmitter.processPointFeature)}processLineFeature(e,t,n,i,r){(0,o.assert)(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,n,\"line\",i,r,this.m_decodedTileEmitter.processLineFeature)}processPolygonFeature(e,t,n,i,r){(0,o.assert)(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,n,\"polygon\",i,r,this.m_decodedTileEmitter.processPolygonFeature)}processFeature(e,t,n,i,r,o,s){const a=this.createMapEnv(r,o,e,i),l=this.m_styleSetEvaluator.getMatchingTechniques(a,e,i);if(0===l.length)return void(this.m_options.showMissingTechniques&&d.log(\"VectorTileDataProcessor#processFeature: no techniques for object:\",JSON.stringify(a.unmap())));const c={env:a,cachedExprResults:new Map};this.m_decodedTileEmitter&&s.apply(this.m_decodedTileEmitter,[e,t,n,c,l])}createMapEnv(e,t,n,r){const o=this.m_tileKey.level;return new i.MapEnv(Object.assign({$layer:n,$id:null!=t?t:null,$level:o,$zoom:Math.max(0,o-this.m_options.storageLevelOffset),$geometryType:r},e))}}t.VectorTileDataProcessor=p;class f extends r.ThemedTileDecoder{constructor(e){super(),this.m_dataAdapter=e,this.m_options={map:{},changed:!1},this.m_defaultDataAdapters=[],this.m_defaultDataAdapters.push(new l.OmvDataAdapter,new a.GeoJsonVtDataAdapter,new s.GeoJsonDataAdapter)}connect(){return Promise.resolve()}decodeThemedTile(e,t,n,i){const r=o.PerformanceTimer.now();if(!this.m_dataAdapter&&(this.m_dataAdapter=this.findDefaultDataAdapter(e),!this.m_dataAdapter))return Promise.reject(new Error(\"Unsupported data format.\"));const s=this.m_dataAdapter;if((0,o.assert)(s.canProcess(e)),this.m_options.changed){if(s instanceof l.OmvDataAdapter){const e=this.m_options.map;s.configure(e)}this.m_options.changed=!1}const a=new p(t,i,n,s,this.m_options.map).getDecodedTile(e);return a.decodeTime=o.PerformanceTimer.now()-r,Promise.resolve(a)}configure(e,t){super.configure(e,t),this.m_options.map=Object.assign(Object.assign(Object.assign({},this.m_options.map),e),t),this.m_options.changed=!0}findDefaultDataAdapter(e){for(const t of this.m_defaultDataAdapters)if(t.canProcess(e))return t}}t.VectorTileDecoder=f,t.VectorTileDecoderService=class{static start(){r.WorkerServiceManager.getInstance().register({serviceType:u.VECTOR_TILE_DECODER_SERVICE_TYPE,factory:e=>r.TileDecoderService.start(e,new f)})}}},2926:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoJsonVtDataAdapter=void 0;const i=n(82),r=n(2616),o=n(6441),s=4096;var a;!function(e){e[e.Unknown=0]=\"Unknown\",e[e.Point=1]=\"Point\",e[e.LineString=2]=\"LineString\",e[e.Polygon=3]=\"Polygon\"}(a||(a={}));const l=new i.Vector3;t.GeoJsonVtDataAdapter=class{canProcess(e){if((0,o.isArrayBufferLike)(e))return!1;const t=e;return void 0!==t.features&&void 0!==t.source&&void 0!==t.x&&void 0!==t.y&&void 0!==t.z}process(e,t,n){for(const c of e.features)switch(c.type){case a.Point:for(const t of c.geometry){const r=t[0],o=t[1],a=new i.Vector3(r,o,0);n.processPointFeature(e.layer,s,[a],c.tags,c.id)}break;case a.LineString:{const a=c.geometry;let u;const h=[];a.forEach((e=>{const t=null==u?void 0:u.positions[u.positions.length-1],[n,r]=e[0];if((null==t?void 0:t.x)===n&&(null==t?void 0:t.y)===r)for(let t=1;t<e.length;++t){const[n,r]=e[t];null==u||u.positions.push(new i.Vector2(n,r))}else{const t=e.map((([e,t])=>new i.Vector2(e,t)));h.push({positions:t}),u=h[h.length-1]}})),h.forEach((e=>{e.untiledPositions=e.positions.map((e=>((0,o.tile2world)(s,t,e,!1,l),r.webMercatorProjection.unprojectPoint(l))))})),n.processLineFeature(e.layer,s,h,c.tags,c.id);break}case a.Polygon:{const t=[];let r;for(const e of c.geometry){const n=[];for(const[t,r]of e){const e=new i.Vector2(t,r);n.push(e)}i.ShapeUtils.area(n)>0&&(r={rings:[]},t.push(r)),null==r||r.rings.push(n)}n.processPolygonFeature(e.layer,s,t,c.tags,c.id);break}case a.Unknown:}}}},5156:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeoJsonDataAdapter=void 0;const i=n(82),r=n(6112),o=n(2616),s=n(6441),a=4096,l=new i.Vector3;function c(e,t,n){return o.webMercatorProjection.projectPoint(o.GeoCoordinates.fromGeoPoint(e),l),(0,s.world2tile)(a,t,l,!1,n)}function u(e,t){return{untiledPositions:e.map((e=>o.GeoCoordinates.fromGeoPoint(e))),positions:e.map((e=>c(e,t,new i.Vector2)))}}function h(e,t){return\"LineString\"===e.type?[u(e.coordinates,t)]:e.coordinates.map((e=>u(e,t)))}function d(e,t){return{rings:e.map(((e,n)=>{const r=0===n,{positions:o}=u(e,t),s=i.ShapeUtils.area(o)>0;return(r&&!s||!r&&s)&&o.reverse(),o}))}}function p(e,t){return\"Polygon\"===e.type?[d(e.coordinates,t)]:e.coordinates.map((e=>d(e,t)))}function f(e,t){return\"Point\"===e.type?[c(e.coordinates,t,new i.Vector3)]:e.coordinates.map((e=>c(e,t,new i.Vector3)))}t.GeoJsonDataAdapter=class{canProcess(e){return e&&\"FeatureCollection\"===e.type&&Array.isArray(e.features)}process(e,t,n,i=\"geojson\"){if(Array.isArray(e.features)&&0!==e.features.length)for(const o of e.features)switch(o.geometry.type){case\"LineString\":case\"MultiLineString\":{let e=h(o.geometry,t);const s=[],l=100;e.forEach((e=>{(0,r.clipLineString)(e.positions,-l,-l,a+l,a+l).forEach((e=>{s.push({positions:e})}))})),e=s,e.length>0&&n.processLineFeature(i,a,s,o.properties,o.id);break}case\"Polygon\":case\"MultiPolygon\":{const e=p(o.geometry,t);n.processPolygonFeature(i,a,e,o.properties,o.id);break}case\"Point\":case\"MultiPoint\":{const e=f(o.geometry,t);n.processPointFeature(i,a,e,o.properties,o.id);break}}}}},9607:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.GeometryCommands=t.FeatureAttributes=t.visitOmvLayer=t.visitOmv=t.isClosePathCommand=t.isLineToCommand=t.isMoveToCommand=t.CommandKind=void 0;const i=n(82),r=n(3577);var o;function s(e,t){if((!t.visitLayer||t.visitLayer(e))&&e.features)for(const n of e.features)switch(n.type){case r.com.mapbox.pb.Tile.GeomType.UNKNOWN:break;case r.com.mapbox.pb.Tile.GeomType.POINT:t.visitPointFeature&&t.visitPointFeature(n);break;case r.com.mapbox.pb.Tile.GeomType.LINESTRING:t.visitLineFeature&&t.visitLineFeature(n);break;case r.com.mapbox.pb.Tile.GeomType.POLYGON:t.visitPolygonFeature&&t.visitPolygonFeature(n)}t.endVisitLayer&&t.endVisitLayer(e)}!function(e){e[e.MoveTo=1]=\"MoveTo\",e[e.LineTo=2]=\"LineTo\",e[e.ClosePath=7]=\"ClosePath\"}(o=t.CommandKind||(t.CommandKind={})),t.isMoveToCommand=function(e){return e.kind===o.MoveTo},t.isLineToCommand=function(e){return e.kind===o.LineTo},t.isClosePathCommand=function(e){return e.kind===o.ClosePath},t.visitOmv=function(e,t){if(e.layers)for(const n of e.layers)t.visitLayer&&!t.visitLayer(n)||s(n,t),t.endVisitLayer&&t.endVisitLayer(n)},t.visitOmvLayer=s,t.FeatureAttributes=class{accept(e,t,n){const{keys:i,values:r}=e,o=t.tags;if(o&&i&&r)for(let e=0;e<o.length;e+=2){const t=i[o[e]],s=r[o[e+1]];if(!n.visitAttribute(t,s))break}}},t.GeometryCommands=class{accept(e,t){if(!e)return;const n=e.length;let r=0,s=0;const a=[],l=[],c=[];for(let u=0;u<n;){const n=7&e[u],h=e[u]>>3;if(++u,n===o.MoveTo||n===o.LineTo)for(let o=0;o<h;++o){const o=e[u++],h=e[u++];r+=o>>1^-(1&o),s+=h>>1^-(1&h),\"Polygon\"===t.type&&(a.push(r),l.push(s));const d=new i.Vector2(r,s);c.push({kind:n,position:d})}else{for(const e of c)t.visitCommand(e);t.visitCommand({kind:n}),a.length=0,l.length=0,c.length=0}}if(c.length>0)for(const e of c)t.visitCommand(e)}}},4585:(e,t,n)=>{\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.OmvDataAdapter=t.asGeometryType=void 0;const i=n(5133),r=n(82),o=n(7769),s=n(4342),a=n(9959),l=n(7305),c=n(6441),u=n(9607),h=n(3577),d=[\"stringValue\",\"floatValue\",\"doubleValue\",\"intValue\",\"uintValue\",\"sintValue\",\"boolValue\"],p=s.LoggerManager.instance.create(\"OmvDataAdapter\",{enabled:!1}),f=i.fromNumber(Number.MAX_SAFE_INTEGER,!0),m=i.fromNumber(Number.MIN_SAFE_INTEGER,!1);function g(e,t,n){if(void 0!==t.id&&null!==t.id)return t.id;if(e.hasOwnProperty(\"id\")){const t=e.id;if(\"number\"==typeof t)return t;if(t)return void 0!==n&&t.greaterThan(Number.MAX_SAFE_INTEGER)&&n.error(\"Invalid ID: Larger than largest available Number in feature: \",e),t.toNumber()}}function v(e){if(void 0===e)return a.OmvGeometryType.UNKNOWN;switch(e.type){case h.com.mapbox.pb.Tile.GeomType.UNKNOWN:return a.OmvGeometryType.UNKNOWN;case h.com.mapbox.pb.Tile.GeomType.POINT:return a.OmvGeometryType.POINT;case h.com.mapbox.pb.Tile.GeomType.LINESTRING:return a.OmvGeometryType.LINESTRING;case h.com.mapbox.pb.Tile.GeomType.POLYGON:return a.OmvGeometryType.POLYGON;default:return a.OmvGeometryType.UNKNOWN}}function y(e,t){e.forEach((e=>{e.x===t-1&&(e.x=t)}))}t.asGeometryType=v,t.OmvDataAdapter=class{constructor(){this.m_geometryCommands=new u.GeometryCommands,this.m_roundUpCoordinatesIfNeeded=!1}configure(e){var t;const n=e.politicalView;this.m_dataFilter=void 0,this.m_featureModifiers=[new l.OmvPoliticalViewFeatureModifier(null!=n?n:\"\")],this.m_roundUpCoordinatesIfNeeded=null!==(t=e.roundUpCoordinatesIfNeeded)&&void 0!==t&&t}canProcess(e){return(0,c.isArrayBufferLike)(e)}process(e,t,n){const{tileKey:i}=t,r=new Uint8Array(e),o=h.com.mapbox.pb.Tile.decode(r);this.m_tileKey=i,this.m_processor=n,(0,u.visitOmv)(o,this)}visitLayer(e){this.m_layer=e;const t=this.m_tileKey.level,n=e.name;return!(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsLayer(n,t))}visitPointFeature(e){var t;if(void 0===e.geometry)return;const n=this.filterAndModifyFeature(e,\"doProcessPointFeature\",\"wantsPointFeature\");if(!n)return;const i=this.m_layer.name,o=null!==(t=this.m_layer.extent)&&void 0!==t?t:4096,s=[];this.m_geometryCommands.accept(e.geometry,{type:\"Point\",visitCommand:e=>{(0,u.isMoveToCommand)(e)&&s.push(new r.Vector3(e.position.x,e.position.y,0))}}),0!==s.length&&this.m_processor.processPointFeature(i,o,s,n,g(e,n,p))}visitLineFeature(e){var t;if(void 0===e.geometry)return;const n=this.filterAndModifyFeature(e,\"doProcessLineFeature\",\"wantsLineFeature\");if(!n)return;const i=this.m_layer.name,r=null!==(t=this.m_layer.extent)&&void 0!==t?t:4096,o=[];let s;this.m_geometryCommands.accept(e.geometry,{type:\"Line\",visitCommand:e=>{(0,u.isMoveToCommand)(e)?(s=[e.position],o.push({positions:s})):(0,u.isLineToCommand)(e)&&s.push(e.position)}}),0!==o.length&&(this.mustRoundUpCoordinates&&function(e,t){e.forEach((e=>y(e.positions,t)))}(o,r),this.m_processor.processLineFeature(i,r,o,n,g(e,n,p)))}visitPolygonFeature(e){var t;if(void 0===e.geometry)return;const n=this.filterAndModifyFeature(e,\"doProcessPolygonFeature\",\"wantsPolygonFeature\");if(!n)return;const i=this.m_layer.name,o=null!==(t=this.m_layer.extent)&&void 0!==t?t:4096,s=[];let a,l,c;this.m_geometryCommands.accept(e.geometry,{type:\"Polygon\",visitCommand:e=>{if((0,u.isMoveToCommand)(e))l=[e.position];else if((0,u.isLineToCommand)(e))l.push(e.position);else if((0,u.isClosePathCommand)(e)&&void 0!==l&&l.length>0){const e=Math.sign(r.ShapeUtils.area(l));void 0===c&&(c=e),e===c&&(a={rings:[]},s.push(a)),l.push(l[0].clone()),null==a||a.rings.push(l)}}}),0!==s.length&&(this.mustRoundUpCoordinates&&function(e,t){e.forEach((e=>e.rings.forEach((e=>y(e,t)))))}(s,o),function(e){const t=e[0];if(void 0!==t&&0!==t.rings.length&&!(r.ShapeUtils.area(t.rings[0])>0))for(const t of e)for(const e of t.rings)e.reverse()}(s),this.m_processor.processPolygonFeature(i,o,s,n,g(e,n,p)))}filterAndModifyFeature(e,t,n){const r=this.m_tileKey.level,s=this.m_layer.name,a=v(e);if(this.m_dataFilter&&!1===this.m_dataFilter[n](s,a,r))return;const l=function(e,t){const n=new u.FeatureAttributes,r={};return n.accept(e,t,{visitAttribute:(e,t)=>(r[e]=function(e){const t=Object.prototype.hasOwnProperty;for(const n of d)if(t.call(e,n)){const t=e[n];if(void 0===t)throw new Error(\"unpexted undefined value\");return i.isLong(t)?t.comp(f)>0||t.comp(m)<0?t.toString():t.toNumber():t}throw new Error(\"not happening\")}(t),!0)}),r}(this.m_layer,e),c=new o.MapEnv(l);return this.m_featureModifiers&&this.m_featureModifiers.find((e=>!e[t](s,c,this.m_tileKey.level)))?void 0:l}get mustRoundUpCoordinates(){return this.m_roundUpCoordinatesIfNeeded&&this.m_tileKey.level<5&&this.m_tileKey.column===this.m_tileKey.columnCount()-1}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.g=function(){if(\"object\"==typeof globalThis)return globalThis;try{return this||new Function(\"return this\")()}catch(e){if(\"object\"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})};var __webpack_exports__={};(()=>{\"use strict\";const e=__webpack_require__(1509);e.OmvTileDecoderService.start(),e.OmvTilerService.start()})()})();";
/*! For license information please see mapsjs-harp.js.LICENSE.txt */
(()=>{var __webpack_modules__={3577:(e,t,i)=>{"use strict";const n=i(5133);var r=i(5218),s=i(6918);s.util.Long=n,s.configure(),e.exports=r},5218:(e,t,i)=>{"use strict";var n,r,s,o=i(6918),a=o.Reader,l=o.util,c=o.roots.default||(o.roots.default={});c.com=((s={}).mapbox=((r={}).pb=((n={}).Tile=function(){function e(e){if(this.layers=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}var t,i;return e.prototype.layers=l.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new c.com.mapbox.pb.Tile;e.pos<i;){var r=e.uint32();r>>>3==3?(n.layers&&n.layers.length||(n.layers=[]),n.layers.push(c.com.mapbox.pb.Tile.Layer.decode(e,e.uint32()))):e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile)return e;var t=new c.com.mapbox.pb.Tile;if(e.layers){if(!Array.isArray(e.layers))throw TypeError(".com.mapbox.pb.Tile.layers: array expected");t.layers=[];for(var i=0;i<e.layers.length;++i){if("object"!=typeof e.layers[i])throw TypeError(".com.mapbox.pb.Tile.layers: object expected");t.layers[i]=c.com.mapbox.pb.Tile.Layer.fromObject(e.layers[i])}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.layers=[]),e.layers&&e.layers.length){i.layers=[];for(var n=0;n<e.layers.length;++n)i.layers[n]=c.com.mapbox.pb.Tile.Layer.toObject(e.layers[n],t)}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.GeomType=(t={},(i=Object.create(t))[t[0]="UNKNOWN"]=0,i[t[1]="POINT"]=1,i[t[2]="LINESTRING"]=2,i[t[3]="POLYGON"]=3,i),e.Value=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.stringValue="",e.prototype.floatValue=0,e.prototype.doubleValue=0,e.prototype.intValue=l.Long?l.Long.fromBits(0,0,!1):0,e.prototype.uintValue=l.Long?l.Long.fromBits(0,0,!0):0,e.prototype.sintValue=l.Long?l.Long.fromBits(0,0,!1):0,e.prototype.boolValue=!1,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new c.com.mapbox.pb.Tile.Value;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.stringValue=e.string();break;case 2:n.floatValue=e.float();break;case 3:n.doubleValue=e.double();break;case 4:n.intValue=e.int64();break;case 5:n.uintValue=e.uint64();break;case 6:n.sintValue=e.sint64();break;case 7:n.boolValue=e.bool();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Value)return e;var t=new c.com.mapbox.pb.Tile.Value;return null!=e.stringValue&&(t.stringValue=String(e.stringValue)),null!=e.floatValue&&(t.floatValue=Number(e.floatValue)),null!=e.doubleValue&&(t.doubleValue=Number(e.doubleValue)),null!=e.intValue&&(l.Long?(t.intValue=l.Long.fromValue(e.intValue)).unsigned=!1:"string"==typeof e.intValue?t.intValue=parseInt(e.intValue,10):"number"==typeof e.intValue?t.intValue=e.intValue:"object"==typeof e.intValue&&(t.intValue=new l.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber())),null!=e.uintValue&&(l.Long?(t.uintValue=l.Long.fromValue(e.uintValue)).unsigned=!0:"string"==typeof e.uintValue?t.uintValue=parseInt(e.uintValue,10):"number"==typeof e.uintValue?t.uintValue=e.uintValue:"object"==typeof e.uintValue&&(t.uintValue=new l.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0))),null!=e.sintValue&&(l.Long?(t.sintValue=l.Long.fromValue(e.sintValue)).unsigned=!1:"string"==typeof e.sintValue?t.sintValue=parseInt(e.sintValue,10):"number"==typeof e.sintValue?t.sintValue=e.sintValue:"object"==typeof e.sintValue&&(t.sintValue=new l.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber())),null!=e.boolValue&&(t.boolValue=Boolean(e.boolValue)),t},e.toObject=function(e,t){t||(t={});var i={};if(t.defaults){if(i.stringValue="",i.floatValue=0,i.doubleValue=0,l.Long){var n=new l.Long(0,0,!1);i.intValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.intValue=t.longs===String?"0":0;l.Long?(n=new l.Long(0,0,!0),i.uintValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n):i.uintValue=t.longs===String?"0":0,l.Long?(n=new l.Long(0,0,!1),i.sintValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n):i.sintValue=t.longs===String?"0":0,i.boolValue=!1}return null!=e.stringValue&&e.hasOwnProperty("stringValue")&&(i.stringValue=e.stringValue),null!=e.floatValue&&e.hasOwnProperty("floatValue")&&(i.floatValue=t.json&&!isFinite(e.floatValue)?String(e.floatValue):e.floatValue),null!=e.doubleValue&&e.hasOwnProperty("doubleValue")&&(i.doubleValue=t.json&&!isFinite(e.doubleValue)?String(e.doubleValue):e.doubleValue),null!=e.intValue&&e.hasOwnProperty("intValue")&&("number"==typeof e.intValue?i.intValue=t.longs===String?String(e.intValue):e.intValue:i.intValue=t.longs===String?l.Long.prototype.toString.call(e.intValue):t.longs===Number?new l.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber():e.intValue),null!=e.uintValue&&e.hasOwnProperty("uintValue")&&("number"==typeof e.uintValue?i.uintValue=t.longs===String?String(e.uintValue):e.uintValue:i.uintValue=t.longs===String?l.Long.prototype.toString.call(e.uintValue):t.longs===Number?new l.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0):e.uintValue),null!=e.sintValue&&e.hasOwnProperty("sintValue")&&("number"==typeof e.sintValue?i.sintValue=t.longs===String?String(e.sintValue):e.sintValue:i.sintValue=t.longs===String?l.Long.prototype.toString.call(e.sintValue):t.longs===Number?new l.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber():e.sintValue),null!=e.boolValue&&e.hasOwnProperty("boolValue")&&(i.boolValue=e.boolValue),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.Feature=function(){function e(e){if(this.tags=[],this.geometry=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.id=l.Long?l.Long.fromBits(0,0,!0):0,e.prototype.tags=l.emptyArray,e.prototype.type=0,e.prototype.geometry=l.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new c.com.mapbox.pb.Tile.Feature;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.id=e.uint64();break;case 2:if(n.tags&&n.tags.length||(n.tags=[]),2==(7&r))for(var s=e.uint32()+e.pos;e.pos<s;)n.tags.push(e.uint32());else n.tags.push(e.uint32());break;case 3:n.type=e.int32();break;case 4:if(n.geometry&&n.geometry.length||(n.geometry=[]),2==(7&r))for(s=e.uint32()+e.pos;e.pos<s;)n.geometry.push(e.uint32());else n.geometry.push(e.uint32());break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Feature)return e;var t=new c.com.mapbox.pb.Tile.Feature;if(null!=e.id&&(l.Long?(t.id=l.Long.fromValue(e.id)).unsigned=!0:"string"==typeof e.id?t.id=parseInt(e.id,10):"number"==typeof e.id?t.id=e.id:"object"==typeof e.id&&(t.id=new l.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0))),e.tags){if(!Array.isArray(e.tags))throw TypeError(".com.mapbox.pb.Tile.Feature.tags: array expected");t.tags=[];for(var i=0;i<e.tags.length;++i)t.tags[i]=e.tags[i]>>>0}switch(e.type){case"UNKNOWN":case 0:t.type=0;break;case"POINT":case 1:t.type=1;break;case"LINESTRING":case 2:t.type=2;break;case"POLYGON":case 3:t.type=3}if(e.geometry){if(!Array.isArray(e.geometry))throw TypeError(".com.mapbox.pb.Tile.Feature.geometry: array expected");for(t.geometry=[],i=0;i<e.geometry.length;++i)t.geometry[i]=e.geometry[i]>>>0}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.tags=[],i.geometry=[]),t.defaults){if(l.Long){var n=new l.Long(0,0,!0);i.id=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.id=t.longs===String?"0":0;i.type=t.enums===String?"UNKNOWN":0}if(null!=e.id&&e.hasOwnProperty("id")&&("number"==typeof e.id?i.id=t.longs===String?String(e.id):e.id:i.id=t.longs===String?l.Long.prototype.toString.call(e.id):t.longs===Number?new l.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0):e.id),e.tags&&e.tags.length){i.tags=[];for(var r=0;r<e.tags.length;++r)i.tags[r]=e.tags[r]}if(null!=e.type&&e.hasOwnProperty("type")&&(i.type=t.enums===String?c.com.mapbox.pb.Tile.GeomType[e.type]:e.type),e.geometry&&e.geometry.length)for(i.geometry=[],r=0;r<e.geometry.length;++r)i.geometry[r]=e.geometry[r];return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.Layer=function(){function e(e){if(this.features=[],this.keys=[],this.values=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.version=1,e.prototype.name="",e.prototype.features=l.emptyArray,e.prototype.keys=l.emptyArray,e.prototype.values=l.emptyArray,e.prototype.extent=4096,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new c.com.mapbox.pb.Tile.Layer;e.pos<i;){var r=e.uint32();switch(r>>>3){case 15:n.version=e.uint32();break;case 1:n.name=e.string();break;case 2:n.features&&n.features.length||(n.features=[]),n.features.push(c.com.mapbox.pb.Tile.Feature.decode(e,e.uint32()));break;case 3:n.keys&&n.keys.length||(n.keys=[]),n.keys.push(e.string());break;case 4:n.values&&n.values.length||(n.values=[]),n.values.push(c.com.mapbox.pb.Tile.Value.decode(e,e.uint32()));break;case 5:n.extent=e.uint32();break;default:e.skipType(7&r)}}if(!n.hasOwnProperty("version"))throw l.ProtocolError("missing required 'version'",{instance:n});if(!n.hasOwnProperty("name"))throw l.ProtocolError("missing required 'name'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Layer)return e;var t=new c.com.mapbox.pb.Tile.Layer;if(null!=e.version&&(t.version=e.version>>>0),null!=e.name&&(t.name=String(e.name)),e.features){if(!Array.isArray(e.features))throw TypeError(".com.mapbox.pb.Tile.Layer.features: array expected");t.features=[];for(var i=0;i<e.features.length;++i){if("object"!=typeof e.features[i])throw TypeError(".com.mapbox.pb.Tile.Layer.features: object expected");t.features[i]=c.com.mapbox.pb.Tile.Feature.fromObject(e.features[i])}}if(e.keys){if(!Array.isArray(e.keys))throw TypeError(".com.mapbox.pb.Tile.Layer.keys: array expected");for(t.keys=[],i=0;i<e.keys.length;++i)t.keys[i]=String(e.keys[i])}if(e.values){if(!Array.isArray(e.values))throw TypeError(".com.mapbox.pb.Tile.Layer.values: array expected");for(t.values=[],i=0;i<e.values.length;++i){if("object"!=typeof e.values[i])throw TypeError(".com.mapbox.pb.Tile.Layer.values: object expected");t.values[i]=c.com.mapbox.pb.Tile.Value.fromObject(e.values[i])}}return null!=e.extent&&(t.extent=e.extent>>>0),t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.features=[],i.keys=[],i.values=[]),t.defaults&&(i.name="",i.extent=4096,i.version=1),null!=e.name&&e.hasOwnProperty("name")&&(i.name=e.name),e.features&&e.features.length){i.features=[];for(var n=0;n<e.features.length;++n)i.features[n]=c.com.mapbox.pb.Tile.Feature.toObject(e.features[n],t)}if(e.keys&&e.keys.length)for(i.keys=[],n=0;n<e.keys.length;++n)i.keys[n]=e.keys[n];if(e.values&&e.values.length)for(i.values=[],n=0;n<e.values.length;++n)i.values[n]=c.com.mapbox.pb.Tile.Value.toObject(e.values[n],t);return null!=e.extent&&e.hasOwnProperty("extent")&&(i.extent=e.extent),null!=e.version&&e.hasOwnProperty("version")&&(i.version=e.version),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e}(),n),r),s),e.exports=c},7018:e=>{"use strict";e.exports=function(e,t){for(var i=new Array(arguments.length-1),n=0,r=2,s=!0;r<arguments.length;)i[n++]=arguments[r++];return new Promise((function(r,o){i[n]=function(e){if(s)if(s=!1,e)o(e);else{for(var t=new Array(arguments.length-1),i=0;i<t.length;)t[i++]=arguments[i];r.apply(null,t)}};try{e.apply(t||null,i)}catch(e){s&&(s=!1,o(e))}}))}},2647:(e,t)=>{"use strict";var i=t;i.length=function(e){var t=e.length;if(!t)return 0;for(var i=0;--t%4>1&&"="===e.charAt(t);)++i;return Math.ceil(3*e.length)/4-i};for(var n=new Array(64),r=new Array(123),s=0;s<64;)r[n[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;i.encode=function(e,t,i){for(var r,s=null,o=[],a=0,l=0;t<i;){var c=e[t++];switch(l){case 0:o[a++]=n[c>>2],r=(3&c)<<4,l=1;break;case 1:o[a++]=n[r|c>>4],r=(15&c)<<2,l=2;break;case 2:o[a++]=n[r|c>>6],o[a++]=n[63&c],l=0}a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return l&&(o[a++]=n[r],o[a++]=61,1===l&&(o[a++]=61)),s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var o="invalid encoding";i.decode=function(e,t,i){for(var n,s=i,a=0,l=0;l<e.length;){var c=e.charCodeAt(l++);if(61===c&&a>1)break;if(void 0===(c=r[c]))throw Error(o);switch(a){case 0:n=c,a=1;break;case 1:t[i++]=n<<2|(48&c)>>4,n=c,a=2;break;case 2:t[i++]=(15&n)<<4|(60&c)>>2,n=c,a=3;break;case 3:t[i++]=(3&n)<<6|c,a=0}}if(1===a)throw Error(o);return i-s},i.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},2922:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:i||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var i=this._listeners[e],n=0;n<i.length;)i[n].fn===t?i.splice(n,1):++n;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var i=[],n=1;n<arguments.length;)i.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,i)}return this}},7955:e=>{"use strict";function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),i=new Uint8Array(t.buffer),n=128===i[3];function r(e,n,r){t[0]=e,n[r]=i[0],n[r+1]=i[1],n[r+2]=i[2],n[r+3]=i[3]}function s(e,n,r){t[0]=e,n[r]=i[3],n[r+1]=i[2],n[r+2]=i[1],n[r+3]=i[0]}function o(e,n){return i[0]=e[n],i[1]=e[n+1],i[2]=e[n+2],i[3]=e[n+3],t[0]}function a(e,n){return i[3]=e[n],i[2]=e[n+1],i[1]=e[n+2],i[0]=e[n+3],t[0]}e.writeFloatLE=n?r:s,e.writeFloatBE=n?s:r,e.readFloatLE=n?o:a,e.readFloatBE=n?a:o}():function(){function t(e,t,i,n){var r=t<0?1:0;if(r&&(t=-t),0===t)e(1/t>0?0:2147483648,i,n);else if(isNaN(t))e(2143289344,i,n);else if(t>34028234663852886e22)e((r<<31|2139095040)>>>0,i,n);else if(t<11754943508222875e-54)e((r<<31|Math.round(t/1401298464324817e-60))>>>0,i,n);else{var s=Math.floor(Math.log(t)/Math.LN2);e((r<<31|s+127<<23|8388607&Math.round(t*Math.pow(2,-s)*8388608))>>>0,i,n)}}function o(e,t,i){var n=e(t,i),r=2*(n>>31)+1,s=n>>>23&255,o=8388607&n;return 255===s?o?NaN:r*(1/0):0===s?1401298464324817e-60*r*o:r*Math.pow(2,s-150)*(o+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,n),e.readFloatLE=o.bind(null,r),e.readFloatBE=o.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),i=new Uint8Array(t.buffer),n=128===i[7];function r(e,n,r){t[0]=e,n[r]=i[0],n[r+1]=i[1],n[r+2]=i[2],n[r+3]=i[3],n[r+4]=i[4],n[r+5]=i[5],n[r+6]=i[6],n[r+7]=i[7]}function s(e,n,r){t[0]=e,n[r]=i[7],n[r+1]=i[6],n[r+2]=i[5],n[r+3]=i[4],n[r+4]=i[3],n[r+5]=i[2],n[r+6]=i[1],n[r+7]=i[0]}function o(e,n){return i[0]=e[n],i[1]=e[n+1],i[2]=e[n+2],i[3]=e[n+3],i[4]=e[n+4],i[5]=e[n+5],i[6]=e[n+6],i[7]=e[n+7],t[0]}function a(e,n){return i[7]=e[n],i[6]=e[n+1],i[5]=e[n+2],i[4]=e[n+3],i[3]=e[n+4],i[2]=e[n+5],i[1]=e[n+6],i[0]=e[n+7],t[0]}e.writeDoubleLE=n?r:s,e.writeDoubleBE=n?s:r,e.readDoubleLE=n?o:a,e.readDoubleBE=n?a:o}():function(){function t(e,t,i,n,r,s){var o=n<0?1:0;if(o&&(n=-n),0===n)e(0,r,s+t),e(1/n>0?0:2147483648,r,s+i);else if(isNaN(n))e(0,r,s+t),e(2146959360,r,s+i);else if(n>17976931348623157e292)e(0,r,s+t),e((o<<31|2146435072)>>>0,r,s+i);else{var a;if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,r,s+t),e((o<<31|a/4294967296)>>>0,r,s+i);else{var l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(a=n*Math.pow(2,-l))>>>0,r,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,r,s+i)}}}function o(e,t,i,n,r){var s=e(n,r+t),o=e(n,r+i),a=2*(o>>31)+1,l=o>>>20&2047,c=4294967296*(1048575&o)+s;return 2047===l?c?NaN:a*(1/0):0===l?5e-324*a*c:a*Math.pow(2,l-1075)*(c+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,n,4,0),e.readDoubleLE=o.bind(null,r,0,4),e.readDoubleBE=o.bind(null,s,4,0)}(),e}function i(e,t,i){t[i]=255&e,t[i+1]=e>>>8&255,t[i+2]=e>>>16&255,t[i+3]=e>>>24}function n(e,t,i){t[i]=e>>>24,t[i+1]=e>>>16&255,t[i+2]=e>>>8&255,t[i+3]=255&e}function r(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},8446:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},5374:e=>{"use strict";e.exports=function(e,t,i){var n=i||8192,r=n>>>1,s=null,o=n;return function(i){if(i<1||i>r)return e(i);o+i>n&&(s=e(n),o=0);var a=t.call(s,o,o+=i);return 7&o&&(o=1+(7|o)),a}}},5226:(e,t)=>{"use strict";var i=t;i.length=function(e){for(var t=0,i=0,n=0;n<e.length;++n)(i=e.charCodeAt(n))<128?t+=1:i<2048?t+=2:55296==(64512&i)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},i.read=function(e,t,i){if(i-t<1)return"";for(var n,r=null,s=[],o=0;t<i;)(n=e[t++])<128?s[o++]=n:n>191&&n<224?s[o++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(n>>10),s[o++]=56320+(1023&n)):s[o++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,s)),o=0);return r?(o&&r.push(String.fromCharCode.apply(String,s.slice(0,o))),r.join("")):String.fromCharCode.apply(String,s.slice(0,o))},i.write=function(e,t,i){for(var n,r,s=i,o=0;o<e.length;++o)(n=e.charCodeAt(o))<128?t[i++]=n:n<2048?(t[i++]=n>>6|192,t[i++]=63&n|128):55296==(64512&n)&&56320==(64512&(r=e.charCodeAt(o+1)))?(n=65536+((1023&n)<<10)+(1023&r),++o,t[i++]=n>>18|240,t[i++]=n>>12&63|128,t[i++]=n>>6&63|128,t[i++]=63&n|128):(t[i++]=n>>12|224,t[i++]=n>>6&63|128,t[i++]=63&n|128);return i-s}},9761:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Easing:()=>r,Group:()=>o,Interpolation:()=>a,Sequence:()=>l,Tween:()=>h,VERSION:()=>u,add:()=>g,default:()=>_,getAll:()=>p,nextId:()=>d,now:()=>s,remove:()=>v,removeAll:()=>f,update:()=>y});var n,r={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-r.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*r.Bounce.In(2*e):.5*r.Bounce.Out(2*e-1)+.5}}},s="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},o=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map((function(t){return e._tweens[t]}))},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},e.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},e.prototype.update=function(e,t){void 0===e&&(e=s()),void 0===t&&(t=!1);var i=Object.keys(this._tweens);if(0===i.length)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<i.length;n++){var r=this._tweens[i[n]],o=!t;r&&!1===r.update(e,o)&&!t&&delete this._tweens[i[n]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),a={Linear:function(e,t){var i=e.length-1,n=i*t,r=Math.floor(n),s=a.Utils.Linear;return t<0?s(e[0],e[1],n):t>1?s(e[i],e[i-1],i-n):s(e[r],e[r+1>i?i:r+1],n-r)},Bezier:function(e,t){for(var i=0,n=e.length-1,r=Math.pow,s=a.Utils.Bernstein,o=0;o<=n;o++)i+=r(1-t,n-o)*r(t,o)*e[o]*s(n,o);return i},CatmullRom:function(e,t){var i=e.length-1,n=i*t,r=Math.floor(n),s=a.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(r=Math.floor(n=i*(1+t))),s(e[(r-1+i)%i],e[r],e[(r+1)%i],e[(r+2)%i],n-r)):t<0?e[0]-(s(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[i]-(s(e[i],e[i],e[i-1],e[i-1],n-i)-e[i]):s(e[r?r-1:0],e[r],e[i<r+1?i:r+1],e[i<r+2?i:r+2],n-r)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=a.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:(n=[1],function(e){var t=1;if(n[e])return n[e];for(var i=e;i>1;i--)t*=i;return n[e]=t,t}),CatmullRom:function(e,t,i,n,r){var s=.5*(i-e),o=.5*(n-t),a=r*r;return(2*t-2*i+s+o)*(r*a)+(-3*t+3*i-2*s-o)*a+s*r+t}}},l=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),c=new o,h=function(){function e(e,t){void 0===t&&(t=c),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=r.Linear.None,this._interpolationFunction=a.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=l.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},e.prototype.duration=function(e){return this._duration=e,this},e.prototype.start=function(e){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var t in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==e?"string"==typeof e?s()+parseFloat(e):e:s(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},e.prototype._setupProperties=function(e,t,i,n){for(var r in i){var s=e[r],o=Array.isArray(s),a=o?"array":typeof s,l=!o&&Array.isArray(i[r]);if("undefined"!==a&&"function"!==a){if(l){var c=i[r];if(0===c.length)continue;c=c.map(this._handleRelativeValue.bind(this,s)),i[r]=[s].concat(c)}if("object"!==a&&!o||!s||l)void 0===t[r]&&(t[r]=s),o||(t[r]*=1),n[r]=l?i[r].slice().reverse():t[r]||0;else{for(var h in t[r]=o?[]:{},s)t[r][h]=s[h];n[r]=o?[]:{},this._setupProperties(s,t[r],i[r],n[r])}}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(e){return void 0===e&&(e=s()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this)),this},e.prototype.resume=function(e){return void 0===e&&(e=s()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return this._group=e,this},e.prototype.delay=function(e){return this._delayTime=e,this},e.prototype.repeat=function(e){return this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return this._yoyo=e,this},e.prototype.easing=function(e){return this._easingFunction=e,this},e.prototype.interpolation=function(e){return this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(e,t){if(void 0===e&&(e=s()),void 0===t&&(t=!0),this._isPaused)return!0;var i,n,r=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>r)return!1;t&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(e-this._startTime)/this._duration,n=0===this._duration||n>1?1:n;var o=this._easingFunction(n);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,n),1===n){if(this._repeat>0){for(i in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,l=this._chainedTweens.length;a<l;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(e,t,i,n){for(var r in i)if(void 0!==t[r]){var s=t[r]||0,o=i[r],a=Array.isArray(e[r]),l=Array.isArray(o);!a&&l?e[r]=this._interpolationFunction(o,n):"object"==typeof o&&o?this._updateProperties(e[r],s,o,n):"number"==typeof(o=this._handleRelativeValue(s,o))&&(e[r]=s+(o-s)*n)}},e.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],i=this._valuesEnd[e];this._valuesStartRepeat[e]="string"==typeof i?this._valuesStartRepeat[e]+parseFloat(i):this._valuesEnd[e],this._valuesEnd[e]=t},e}(),u="18.6.4",d=l.nextId,m=c,p=m.getAll.bind(m),f=m.removeAll.bind(m),g=m.add.bind(m),v=m.remove.bind(m),y=m.update.bind(m);const _={Easing:r,Group:o,Interpolation:a,now:s,Sequence:l,nextId:d,Tween:h,VERSION:u,getAll:p,removeAll:f,add:g,remove:v,update:y}},6925:(e,t)=>{var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(e){return(e=Math.round(e))<0?0:e>255?255:e}function r(e){return e<0?0:e>1?1:e}function s(e){return"%"===e[e.length-1]?n(parseFloat(e)/100*255):n(parseInt(e))}function o(e){return"%"===e[e.length-1]?r(parseFloat(e)/100):r(parseFloat(e))}function a(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,r=e.replace(/ /g,"").toLowerCase();if(r in i)return i[r].slice();if("#"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=r.indexOf("("),c=r.indexOf(")");if(-1!==l&&c+1===r.length){var h=r.substr(0,l),u=r.substr(l+1,c-(l+1)).split(","),d=1;switch(h){case"rgba":if(4!==u.length)return null;d=o(u.pop());case"rgb":return 3!==u.length?null:[s(u[0]),s(u[1]),s(u[2]),d];case"hsla":if(4!==u.length)return null;d=o(u.pop());case"hsl":if(3!==u.length)return null;var m=(parseFloat(u[0])%360+360)%360/360,p=o(u[1]),f=o(u[2]),g=f<=.5?f*(p+1):f+p-f*p,v=2*f-g;return[n(255*a(v,g,m+1/3)),n(255*a(v,g,m)),n(255*a(v,g,m-1/3)),d];default:return null}}return null}}catch(e){}},1874:e=>{"use strict";function t(e,t,s){s=s||2;var o,a,l,u,d,p,f,g=t&&t.length,v=g?t[0]*s:e.length,y=i(e,0,v,s,!0),_=[];if(!y||y.next===y.prev)return _;if(g&&(y=function(e,t,r,s){var o,a,l,u=[];for(o=0,a=t.length;o<a;o++)(l=i(e,t[o]*s,o<a-1?t[o+1]*s:e.length,s,!1))===l.next&&(l.steiner=!0),u.push(m(l));for(u.sort(c),o=0;o<u.length;o++)h(u[o],r),r=n(r,r.next);return r}(e,t,y,s)),e.length>80*s){o=l=e[0],a=u=e[1];for(var x=s;x<v;x+=s)(d=e[x])<o&&(o=d),(p=e[x+1])<a&&(a=p),d>l&&(l=d),p>u&&(u=p);f=0!==(f=Math.max(l-o,u-a))?1/f:0}return r(y,_,s,o,a,f),_}function i(e,t,i,n,r){var s,o;if(r===E(e,t,i,n)>0)for(s=t;s<i;s+=n)o=T(s,e[s],e[s+1],o);else for(s=i-n;s>=t;s-=n)o=T(s,e[s],e[s+1],o);return o&&v(o,o.next)&&(M(o),o=o.next),o}function n(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!v(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{if(M(n),(n=t=n.prev)===n.next)break;i=!0}}while(i||n!==t);return t}function r(e,t,i,c,h,u,m){if(e){!m&&u&&function(e,t,i,n){var r=e;do{null===r.z&&(r.z=d(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,n,r,s,o,a,l,c=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1)}(r)}(e,c,h,u);for(var p,f,g=e;e.prev!==e.next;)if(p=e.prev,f=e.next,u?o(e,c,h,u):s(e))t.push(p.i/i),t.push(e.i/i),t.push(f.i/i),M(e),e=f.next,g=f.next;else if((e=f)===g){m?1===m?r(e=a(n(e),t,i),t,i,c,h,u,2):2===m&&l(e,t,i,c,h,u):r(n(e),t,i,c,h,u,1);break}}}function s(e){var t=e.prev,i=e,n=e.next;if(g(t,i,n)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(p(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&g(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function o(e,t,i,n){var r=e.prev,s=e,o=e.next;if(g(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,h=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,u=d(a,l,t,i,n),m=d(c,h,t,i,n),f=e.prevZ,v=e.nextZ;f&&f.z>=u&&v&&v.z<=m;){if(f!==e.prev&&f!==e.next&&p(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,v!==e.prev&&v!==e.next&&p(r.x,r.y,s.x,s.y,o.x,o.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;f&&f.z>=u;){if(f!==e.prev&&f!==e.next&&p(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;v&&v.z<=m;){if(v!==e.prev&&v!==e.next&&p(r.x,r.y,s.x,s.y,o.x,o.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function a(e,t,i){var r=e;do{var s=r.prev,o=r.next.next;!v(s,o)&&y(s,r,r.next,o)&&w(s,o)&&w(o,s)&&(t.push(s.i/i),t.push(r.i/i),t.push(o.i/i),M(r),M(r.next),r=e=o),r=r.next}while(r!==e);return n(r)}function l(e,t,i,s,o,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&f(l,c)){var h=b(l,c);return l=n(l,l.next),h=n(h,h.next),r(l,t,i,s,o,a),void r(h,t,i,s,o,a)}c=c.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function h(e,t){if(t=function(e,t){var i,n=t,r=e.x,s=e.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o){if(o=a,a===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(r===o)return i;var l,c=i,h=i.x,d=i.y,m=1/0;n=i;do{r>=n.x&&n.x>=h&&r!==n.x&&p(s<d?r:o,s,h,d,s<d?o:r,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(r-n.x),w(n,e)&&(l<m||l===m&&(n.x>i.x||n.x===i.x&&u(i,n)))&&(i=n,m=l)),n=n.next}while(n!==c);return i}(e,t),t){var i=b(t,e);n(t,t.next),n(i,i.next)}}function u(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function d(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function m(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function p(e,t,i,n,r,s,o,a){return(r-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(n-a)-(i-o)*(t-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function f(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&y(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(w(e,t)&&w(t,e)&&function(e,t){var i=e,n=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||v(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,i,n){var r=x(g(e,t,i)),s=x(g(e,t,n)),o=x(g(i,n,e)),a=x(g(i,n,t));return r!==s&&o!==a||!(0!==r||!_(e,i,t))||!(0!==s||!_(e,n,t))||!(0!==o||!_(i,e,n))||!(0!==a||!_(i,t,n))}function _(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function x(e){return e>0?1:e<0?-1:0}function w(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function b(e,t){var i=new S(e.i,e.x,e.y),n=new S(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function T(e,t,i,n){var r=new S(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(e,t,i,n){for(var r=0,s=t,o=i-n;s<i;s+=n)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}e.exports=t,e.exports.default=t,t.deviation=function(e,t,i,n){var r=t&&t.length,s=r?t[0]*i:e.length,o=Math.abs(E(e,0,s,i));if(r)for(var a=0,l=t.length;a<l;a++){var c=t[a]*i,h=a<l-1?t[a+1]*i:e.length;o-=Math.abs(E(e,c,h,i))}var u=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,m=n[a+1]*i,p=n[a+2]*i;u+=Math.abs((e[d]-e[p])*(e[m+1]-e[d+1])-(e[d]-e[m])*(e[p+1]-e[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},t.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var s=0;s<e[r].length;s++)for(var o=0;o<t;o++)i.vertices.push(e[r][s][o]);r>0&&(n+=e[r-1].length,i.holes.push(n))}return i}},242:(e,t,i)=>{"use strict";function n(e,t,i,s){for(var o,a=s,l=i-t>>1,c=i-t,h=e[t],u=e[t+1],d=e[i],m=e[i+1],p=t+3;p<i;p+=3){var f=r(e[p],e[p+1],h,u,d,m);if(f>a)o=p,a=f;else if(f===a){var g=Math.abs(p-l);g<c&&(o=p,c=g)}}a>s&&(o-t>3&&n(e,t,o,s),e[o+2]=a,i-o>3&&n(e,o,i,s))}function r(e,t,i,n,r,s){var o=r-i,a=s-n;if(0!==o||0!==a){var l=((e-i)*o+(t-n)*a)/(o*o+a*a);l>1?(i=r,n=s):l>0&&(i+=o*l,n+=a*l)}return(o=e-i)*o+(a=t-n)*a}function s(e,t,i,n){var r={id:void 0===e?null:e,type:t,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)o(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<t.length;n++)o(e,t[n]);else if("MultiPolygon"===i)for(n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)o(e,t[n][r])}(r),r}function o(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function a(e,t,i,n){if(t.geometry){var r=t.geometry.coordinates,o=t.geometry.type,u=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),d=[],m=t.id;if(i.promoteId?m=t.properties[i.promoteId]:i.generateId&&(m=n||0),"Point"===o)l(r,d);else if("MultiPoint"===o)for(var p=0;p<r.length;p++)l(r[p],d);else if("LineString"===o)c(r,d,u,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(p=0;p<r.length;p++)d=[],c(r[p],d,u,!1),e.push(s(m,"LineString",d,t.properties));return}h(r,d,u,!1)}else if("Polygon"===o)h(r,d,u,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(p=0;p<t.geometry.geometries.length;p++)a(e,{id:m,geometry:t.geometry.geometries[p],properties:t.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(p=0;p<r.length;p++){var f=[];h(r[p],f,u,!0),d.push(f)}}e.push(s(m,o,d,t.properties))}}function l(e,t){t.push(u(e[0])),t.push(d(e[1])),t.push(0)}function c(e,t,i,r){for(var s,o,a=0,l=0;l<e.length;l++){var c=u(e[l][0]),h=d(e[l][1]);t.push(c),t.push(h),t.push(0),l>0&&(a+=r?(s*h-c*o)/2:Math.sqrt(Math.pow(c-s,2)+Math.pow(h-o,2))),s=c,o=h}var m=t.length-3;t[2]=1,n(t,0,m,i),t[m+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function h(e,t,i,n){for(var r=0;r<e.length;r++){var s=[];c(e[r],s,i,n),t.push(s)}}function u(e){return e/360+.5}function d(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function m(e,t,i,n,r,o,a,l){if(n/=t,o>=(i/=t)&&a<n)return e;if(a<i||o>=n)return null;for(var c=[],h=0;h<e.length;h++){var u=e[h],d=u.geometry,m=u.type,g=0===r?u.minX:u.minY,y=0===r?u.maxX:u.maxY;if(g>=i&&y<n)c.push(u);else if(!(y<i||g>=n)){var _=[];if("Point"===m||"MultiPoint"===m)p(d,_,i,n,r);else if("LineString"===m)f(d,_,i,n,r,!1,l.lineMetrics);else if("MultiLineString"===m)v(d,_,i,n,r,!1);else if("Polygon"===m)v(d,_,i,n,r,!0);else if("MultiPolygon"===m)for(var x=0;x<d.length;x++){var w=[];v(d[x],w,i,n,r,!0),w.length&&_.push(w)}if(_.length){if(l.lineMetrics&&"LineString"===m){for(x=0;x<_.length;x++)c.push(s(u.id,m,_[x],u.tags));continue}"LineString"!==m&&"MultiLineString"!==m||(1===_.length?(m="LineString",_=_[0]):m="MultiLineString"),"Point"!==m&&"MultiPoint"!==m||(m=3===_.length?"Point":"MultiPoint"),c.push(s(u.id,m,_,u.tags))}}}return c.length?c:null}function p(e,t,i,n,r){for(var s=0;s<e.length;s+=3){var o=e[s+r];o>=i&&o<=n&&(t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]))}}function f(e,t,i,n,r,s,o){for(var a,l,c=g(e),h=0===r?_:x,u=e.start,d=0;d<e.length-3;d+=3){var m=e[d],p=e[d+1],f=e[d+2],v=e[d+3],w=e[d+4],b=0===r?m:p,T=0===r?v:w,M=!1;o&&(a=Math.sqrt(Math.pow(m-v,2)+Math.pow(p-w,2))),b<i?T>i&&(l=h(c,m,p,v,w,i),o&&(c.start=u+a*l)):b>n?T<n&&(l=h(c,m,p,v,w,n),o&&(c.start=u+a*l)):y(c,m,p,f),T<i&&b>=i&&(l=h(c,m,p,v,w,i),M=!0),T>n&&b<=n&&(l=h(c,m,p,v,w,n),M=!0),!s&&M&&(o&&(c.end=u+a*l),t.push(c),c=g(e)),o&&(u+=a)}var S=e.length-3;m=e[S],p=e[S+1],f=e[S+2],(b=0===r?m:p)>=i&&b<=n&&y(c,m,p,f),S=c.length-3,s&&S>=3&&(c[S]!==c[0]||c[S+1]!==c[1])&&y(c,c[0],c[1],c[2]),c.length&&t.push(c)}function g(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function v(e,t,i,n,r,s){for(var o=0;o<e.length;o++)f(e[o],t,i,n,r,s,!1)}function y(e,t,i,n){e.push(t),e.push(i),e.push(n)}function _(e,t,i,n,r,s){var o=(s-t)/(n-t);return e.push(s),e.push(i+(r-i)*o),e.push(1),o}function x(e,t,i,n,r,s){var o=(s-i)/(r-i);return e.push(t+(n-t)*o),e.push(s),e.push(1),o}function w(e,t){for(var i=[],n=0;n<e.length;n++){var r,o=e[n],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)r=b(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){r=[];for(var l=0;l<o.geometry.length;l++)r.push(b(o.geometry[l],t))}else if("MultiPolygon"===a)for(r=[],l=0;l<o.geometry.length;l++){for(var c=[],h=0;h<o.geometry[l].length;h++)c.push(b(o.geometry[l][h],t));r.push(c)}i.push(s(o.id,a,r,o.tags))}return i}function b(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var n=0;n<e.length;n+=3)i.push(e[n]+t,e[n+1],e[n+2]);return i}function T(e,t){if(e.transformed)return e;var i,n,r,s=1<<e.z,o=e.x,a=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],c=l.geometry,h=l.type;if(l.geometry=[],1===h)for(n=0;n<c.length;n+=2)l.geometry.push(M(c[n],c[n+1],t,s,o,a));else for(n=0;n<c.length;n++){var u=[];for(r=0;r<c[n].length;r+=2)u.push(M(c[n][r],c[n][r+1],t,s,o,a));l.geometry.push(u)}}return e.transformed=!0,e}function M(e,t,i,n,r,s){return[Math.round(i*(e*n-r)),Math.round(i*(t*n-s))]}function S(e,t,i,n,r){for(var s=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){o.numFeatures++,E(o,e[a],s,r);var l=e[a].minX,c=e[a].minY,h=e[a].maxX,u=e[a].maxY;l<o.minX&&(o.minX=l),c<o.minY&&(o.minY=c),h>o.maxX&&(o.maxX=h),u>o.maxY&&(o.maxY=u)}return o}function E(e,t,i,n){var r=t.geometry,s=t.type,o=[];if("Point"===s||"MultiPoint"===s)for(var a=0;a<r.length;a+=3)o.push(r[a]),o.push(r[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===s)A(o,r,e,i,!1,!1);else if("MultiLineString"===s||"Polygon"===s)for(a=0;a<r.length;a++)A(o,r[a],e,i,"Polygon"===s,0===a);else if("MultiPolygon"===s)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)A(o,c[a],e,i,!0,0===a)}if(o.length){var h=t.tags||null;if("LineString"===s&&n.lineMetrics){for(var u in h={},t.tags)h[u]=t.tags[u];h.mapbox_clip_start=r.start/r.size,h.mapbox_clip_end=r.end/r.size}var d={geometry:o,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:h};null!==t.id&&(d.id=t.id),e.features.push(d)}}function A(e,t,i,n,r,s){var o=n*n;if(n>0&&t.size<(r?o:n))i.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===n||t[l+2]>o)&&(i.numSimplified++,a.push(t[l]),a.push(t[l+1])),i.numPoints++;r&&function(e,t){for(var i=0,n=0,r=e.length,s=r-2;n<r;s=n,n+=2)i+=(e[n]-e[s])*(e[n+1]+e[s+1]);if(i>0===t)for(n=0,r=e.length;n<r/2;n+=2){var o=e[n],a=e[n+1];e[n]=e[r-2-n],e[n+1]=e[r-1-n],e[r-2-n]=o,e[r-1-n]=a}}(a,s),e.push(a)}}function C(e,t){return new P(e,t)}function P(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)a(i,e.features[n],t,n);else"Feature"===e.type?a(i,e,t):a(i,{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(e,t){var i=t.buffer/t.extent,n=e,r=m(e,1,-1-i,i,0,-1,2,t),s=m(e,1,1-i,2+i,0,-1,2,t);return(r||s)&&(n=m(e,1,-i,1+i,0,-1,2,t)||[],r&&(n=w(r,1).concat(n)),s&&(n=n.concat(w(s,-1)))),n}(n,t),n.length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function L(e,t,i){return 32*((1<<e)*i+t)+e}i.r(t),i.d(t,{default:()=>C}),P.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},P.prototype.splitTile=function(e,t,i,n,r,s,o){for(var a=[e,t,i,n],l=this.options,c=l.debug;a.length;){n=a.pop(),i=a.pop(),t=a.pop(),e=a.pop();var h=1<<t,u=L(t,i,n),d=this.tiles[u];if(!d&&(c>1&&console.time("creation"),d=this.tiles[u]=S(e,t,i,n,l),this.tileCoords.push({z:t,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,n,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=e,r){if(t===l.maxZoom||t===r)continue;var f=1<<r-t;if(i!==Math.floor(s/f)||n!==Math.floor(o/f))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==e.length){c>1&&console.time("clipping");var g,v,y,_,x,w,b=.5*l.buffer/l.extent,T=.5-b,M=.5+b,E=1+b;g=v=y=_=null,x=m(e,h,i-b,i+M,0,d.minX,d.maxX,l),w=m(e,h,i+T,i+E,0,d.minX,d.maxX,l),e=null,x&&(g=m(x,h,n-b,n+M,1,d.minY,d.maxY,l),v=m(x,h,n+T,n+E,1,d.minY,d.maxY,l),x=null),w&&(y=m(w,h,n-b,n+M,1,d.minY,d.maxY,l),_=m(w,h,n+T,n+E,1,d.minY,d.maxY,l),w=null),c>1&&console.timeEnd("clipping"),a.push(g||[],t+1,2*i,2*n),a.push(v||[],t+1,2*i,2*n+1),a.push(y||[],t+1,2*i+1,2*n),a.push(_||[],t+1,2*i+1,2*n+1)}}},P.prototype.getTile=function(e,t,i){var n=this.options,r=n.extent,s=n.debug;if(e<0||e>24)return null;var o=1<<e,a=L(e,t=(t%o+o)%o,i);if(this.tiles[a])return T(this.tiles[a],r);s>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,c=e,h=t,u=i;!l&&c>0;)c--,h=Math.floor(h/2),u=Math.floor(u/2),l=this.tiles[L(c,h,u)];return l&&l.source?(s>1&&console.log("found parent tile z%d-%d-%d",c,h,u),s>1&&console.time("drilling down"),this.splitTile(l.source,c,h,u,e,t,i),s>1&&console.timeEnd("drilling down"),this.tiles[a]?T(this.tiles[a],r):null):null}},5133:e=>{e.exports=i;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function i(e,t,i){this.low=0|e,this.high=0|t,this.unsigned=!!i}function n(e){return!0===(e&&e.__isLong__)}i.prototype.__isLong__,Object.defineProperty(i.prototype,"__isLong__",{value:!0}),i.isLong=n;var r={},s={};function o(e,t){var i,n,o;return t?(o=0<=(e>>>=0)&&e<256)&&(n=s[e])?n:(i=l(e,(0|e)<0?-1:0,!0),o&&(s[e]=i),i):(o=-128<=(e|=0)&&e<128)&&(n=r[e])?n:(i=l(e,e<0?-1:0,!1),o&&(r[e]=i),i)}function a(e,t){if(isNaN(e))return t?v:g;if(t){if(e<0)return v;if(e>=m)return b}else{if(e<=-p)return T;if(e+1>=p)return w}return e<0?a(-e,t).neg():l(e%d|0,e/d|0,t)}function l(e,t,n){return new i(e,t,n)}i.fromInt=o,i.fromNumber=a,i.fromBits=l;var c=Math.pow;function h(e,t,i){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return g;if("number"==typeof t?(i=t,t=!1):t=!!t,(i=i||10)<2||36<i)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return h(e.substring(1),t,i).neg();for(var r=a(c(i,8)),s=g,o=0;o<e.length;o+=8){var l=Math.min(8,e.length-o),u=parseInt(e.substring(o,o+l),i);if(l<8){var d=a(c(i,l));s=s.mul(d).add(a(u))}else s=(s=s.mul(r)).add(a(u))}return s.unsigned=t,s}function u(e,t){return"number"==typeof e?a(e,t):"string"==typeof e?h(e,t):l(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}i.fromString=h,i.fromValue=u;var d=4294967296,m=d*d,p=m/2,f=o(1<<24),g=o(0);i.ZERO=g;var v=o(0,!0);i.UZERO=v;var y=o(1);i.ONE=y;var _=o(1,!0);i.UONE=_;var x=o(-1);i.NEG_ONE=x;var w=l(-1,2147483647,!1);i.MAX_VALUE=w;var b=l(-1,-1,!0);i.MAX_UNSIGNED_VALUE=b;var T=l(0,-2147483648,!1);i.MIN_VALUE=T;var M=i.prototype;M.toInt=function(){return this.unsigned?this.low>>>0:this.low},M.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},M.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(T)){var t=a(e),i=this.div(t),n=i.mul(t).sub(this);return i.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var r=a(c(e,6),this.unsigned),s=this,o="";;){var l=s.div(r),h=(s.sub(l.mul(r)).toInt()>>>0).toString(e);if((s=l).isZero())return h+o;for(;h.length<6;)h="0"+h;o=""+h+o}},M.getHighBits=function(){return this.high},M.getHighBitsUnsigned=function(){return this.high>>>0},M.getLowBits=function(){return this.low},M.getLowBitsUnsigned=function(){return this.low>>>0},M.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},M.isZero=function(){return 0===this.high&&0===this.low},M.eqz=M.isZero,M.isNegative=function(){return!this.unsigned&&this.high<0},M.isPositive=function(){return this.unsigned||this.high>=0},M.isOdd=function(){return 1==(1&this.low)},M.isEven=function(){return 0==(1&this.low)},M.equals=function(e){return n(e)||(e=u(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},M.eq=M.equals,M.notEquals=function(e){return!this.eq(e)},M.neq=M.notEquals,M.ne=M.notEquals,M.lessThan=function(e){return this.comp(e)<0},M.lt=M.lessThan,M.lessThanOrEqual=function(e){return this.comp(e)<=0},M.lte=M.lessThanOrEqual,M.le=M.lessThanOrEqual,M.greaterThan=function(e){return this.comp(e)>0},M.gt=M.greaterThan,M.greaterThanOrEqual=function(e){return this.comp(e)>=0},M.gte=M.greaterThanOrEqual,M.ge=M.greaterThanOrEqual,M.compare=function(e){if(n(e)||(e=u(e)),this.eq(e))return 0;var t=this.isNegative(),i=e.isNegative();return t&&!i?-1:!t&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},M.comp=M.compare,M.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(y)},M.neg=M.negate,M.add=function(e){n(e)||(e=u(e));var t=this.high>>>16,i=65535&this.high,r=this.low>>>16,s=65535&this.low,o=e.high>>>16,a=65535&e.high,c=e.low>>>16,h=0,d=0,m=0,p=0;return m+=(p+=s+(65535&e.low))>>>16,d+=(m+=r+c)>>>16,h+=(d+=i+a)>>>16,h+=t+o,l((m&=65535)<<16|(p&=65535),(h&=65535)<<16|(d&=65535),this.unsigned)},M.subtract=function(e){return n(e)||(e=u(e)),this.add(e.neg())},M.sub=M.subtract,M.multiply=function(e){if(this.isZero())return g;if(n(e)||(e=u(e)),t)return l(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return g;if(this.eq(T))return e.isOdd()?T:g;if(e.eq(T))return this.isOdd()?T:g;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(f)&&e.lt(f))return a(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,r=65535&this.high,s=this.low>>>16,o=65535&this.low,c=e.high>>>16,h=65535&e.high,d=e.low>>>16,m=65535&e.low,p=0,v=0,y=0,_=0;return y+=(_+=o*m)>>>16,v+=(y+=s*m)>>>16,y&=65535,v+=(y+=o*d)>>>16,p+=(v+=r*m)>>>16,v&=65535,p+=(v+=s*d)>>>16,v&=65535,p+=(v+=o*h)>>>16,p+=i*m+r*d+s*h+o*c,l((y&=65535)<<16|(_&=65535),(p&=65535)<<16|(v&=65535),this.unsigned)},M.mul=M.multiply,M.divide=function(e){if(n(e)||(e=u(e)),e.isZero())throw Error("division by zero");var i,r,s;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?v:g;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return _;s=v}else{if(this.eq(T))return e.eq(y)||e.eq(x)?T:e.eq(T)?y:(i=this.shr(1).div(e).shl(1)).eq(g)?e.isNegative()?y:x:(r=this.sub(e.mul(i)),s=i.add(r.div(e)));if(e.eq(T))return this.unsigned?v:g;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=g}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(i)/Math.LN2),h=o<=48?1:c(2,o-48),d=a(i),m=d.mul(e);m.isNegative()||m.gt(r);)m=(d=a(i-=h,this.unsigned)).mul(e);d.isZero()&&(d=y),s=s.add(d),r=r.sub(m)}return s},M.div=M.divide,M.modulo=function(e){return n(e)||(e=u(e)),t?l((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},M.mod=M.modulo,M.rem=M.modulo,M.not=function(){return l(~this.low,~this.high,this.unsigned)},M.and=function(e){return n(e)||(e=u(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},M.or=function(e){return n(e)||(e=u(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},M.xor=function(e){return n(e)||(e=u(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},M.shiftLeft=function(e){return n(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},M.shl=M.shiftLeft,M.shiftRight=function(e){return n(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},M.shr=M.shiftRight,M.shiftRightUnsigned=function(e){if(n(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?l(this.low>>>e|t<<32-e,t>>>e,this.unsigned):l(32===e?t:t>>>e-32,0,this.unsigned)},M.shru=M.shiftRightUnsigned,M.shr_u=M.shiftRightUnsigned,M.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},M.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},M.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},M.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},M.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},i.fromBytes=function(e,t,n){return n?i.fromBytesLE(e,t):i.fromBytesBE(e,t)},i.fromBytesLE=function(e,t){return new i(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},i.fromBytesBE=function(e,t){return new i(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},6918:(e,t,i)=>{"use strict";e.exports=i(3729)},3729:(e,t,i)=>{"use strict";var n=t;function r(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=i(8116),n.BufferWriter=i(1819),n.Reader=i(2461),n.BufferReader=i(9117),n.util=i(1679),n.rpc=i(8082),n.roots=i(575),n.configure=r,r()},2461:(e,t,i)=>{"use strict";e.exports=l;var n,r=i(1679),s=r.LongBits,o=r.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var c,h="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},u=function(){return r.Buffer?function(e){return(l.create=function(e){return r.Buffer.isBuffer(e)?new n(e):h(e)})(e)}:h};function d(){var e=new s(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function m(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new s(m(this.buf,this.pos+=4),m(this.buf,this.pos+=4))}l.create=u(),l.prototype._slice=r.Array.prototype.subarray||r.Array.prototype.slice,l.prototype.uint32=(c=4294967295,function(){if(c=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return c;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return c}),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return m(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|m(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=r.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=r.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,i):t===i?new this.buf.constructor(0):this._slice.call(this.buf,t,i)},l.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){n=e,l.create=u(),n._configure();var t=r.Long?"toLong":"toNumber";r.merge(l.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},9117:(e,t,i)=>{"use strict";e.exports=s;var n=i(2461);(s.prototype=Object.create(n.prototype)).constructor=s;var r=i(1679);function s(e){n.call(this,e)}s._configure=function(){r.Buffer&&(s.prototype._slice=r.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},575:e=>{"use strict";e.exports={}},8082:(e,t,i)=>{"use strict";t.Service=i(7927)},7927:(e,t,i)=>{"use strict";e.exports=r;var n=i(1679);function r(e,t,i){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(i)}(r.prototype=Object.create(n.EventEmitter.prototype)).constructor=r,r.prototype.rpcCall=function e(t,i,r,s,o){if(!s)throw TypeError("request must be specified");var a=this;if(!o)return n.asPromise(e,a,t,i,r,s);if(a.rpcImpl)try{return a.rpcImpl(t,i[a.requestDelimited?"encodeDelimited":"encode"](s).finish(),(function(e,i){if(e)return a.emit("error",e,t),o(e);if(null!==i){if(!(i instanceof r))try{i=r[a.responseDelimited?"decodeDelimited":"decode"](i)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",i,t),o(null,i)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},r.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},8294:(e,t,i)=>{"use strict";e.exports=r;var n=i(1679);function r(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=r.zero=new r(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var o=r.zeroHash="\0\0\0\0\0\0\0\0";r.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var i=e>>>0,n=(e-i)/4294967296>>>0;return t&&(n=~n>>>0,i=~i>>>0,++i>4294967295&&(i=0,++n>4294967295&&(n=0))),new r(i,n)},r.from=function(e){if("number"==typeof e)return r.fromNumber(e);if(n.isString(e)){if(!n.Long)return r.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new r(e.low>>>0,e.high>>>0):s},r.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,i=~this.hi>>>0;return t||(i=i+1>>>0),-(t+4294967296*i)}return this.lo+4294967296*this.hi},r.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;r.fromHash=function(e){return e===o?s:new r((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},r.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},r.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},r.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},r.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return 0===i?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10}},1679:function(e,t,i){"use strict";var n=t;function r(e,t,i){for(var n=Object.keys(t),r=0;r<n.length;++r)void 0!==e[n[r]]&&i||(e[n[r]]=t[n[r]]);return e}function s(e){function t(e,i){if(!(this instanceof t))return new t(e,i);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),i&&r(this,i)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=i(7018),n.base64=i(2647),n.EventEmitter=i(2922),n.float=i(7955),n.inquire=i(8446),n.utf8=i(5226),n.pool=i(5374),n.LongBits=i(8294),n.isNode=Boolean(void 0!==i.g&&i.g&&i.g.process&&i.g.process.versions&&i.g.process.versions.node),n.global=n.isNode&&i.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var i=e[t];return!(null==i||!e.hasOwnProperty(t))&&("object"!=typeof i||(Array.isArray(i)?i.length:Object.keys(i).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var i=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(i.lo,i.hi,t):i.toNumber(Boolean(t))},n.merge=r,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=1;return function(){for(var e=Object.keys(this),i=e.length-1;i>-1;--i)if(1===t[e[i]]&&void 0!==this[e[i]]&&null!==this[e[i]])return e[i]}},n.oneOfSetter=function(e){return function(t){for(var i=0;i<e.length;++i)e[i]!==t&&delete this[e[i]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,i){return new e(t,i)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}},8116:(e,t,i)=>{"use strict";e.exports=u;var n,r=i(1679),s=r.LongBits,o=r.base64,a=r.utf8;function l(e,t,i){this.fn=e,this.len=t,this.next=void 0,this.val=i}function c(){}function h(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function u(){this.len=0,this.head=new l(c,0,0),this.tail=this.head,this.states=null}var d=function(){return r.Buffer?function(){return(u.create=function(){return new n})()}:function(){return new u}};function m(e,t,i){t[i]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function f(e,t,i){for(;e.hi;)t[i++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[i++]=127&e.lo|128,e.lo=e.lo>>>7;t[i++]=e.lo}function g(e,t,i){t[i]=255&e,t[i+1]=e>>>8&255,t[i+2]=e>>>16&255,t[i+3]=e>>>24}u.create=d(),u.alloc=function(e){return new r.Array(e)},r.Array!==Array&&(u.alloc=r.pool(u.alloc,r.Array.prototype.subarray)),u.prototype._push=function(e,t,i){return this.tail=this.tail.next=new l(e,t,i),this.len+=t,this},p.prototype=Object.create(l.prototype),p.prototype.fn=function(e,t,i){for(;e>127;)t[i++]=127&e|128,e>>>=7;t[i]=e},u.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},u.prototype.int32=function(e){return e<0?this._push(f,10,s.fromNumber(e)):this.uint32(e)},u.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},u.prototype.uint64=function(e){var t=s.from(e);return this._push(f,t.length(),t)},u.prototype.int64=u.prototype.uint64,u.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(f,t.length(),t)},u.prototype.bool=function(e){return this._push(m,1,e?1:0)},u.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},u.prototype.sfixed32=u.prototype.fixed32,u.prototype.fixed64=function(e){var t=s.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},u.prototype.sfixed64=u.prototype.fixed64,u.prototype.float=function(e){return this._push(r.float.writeFloatLE,4,e)},u.prototype.double=function(e){return this._push(r.float.writeDoubleLE,8,e)};var v=r.Array.prototype.set?function(e,t,i){t.set(e,i)}:function(e,t,i){for(var n=0;n<e.length;++n)t[i+n]=e[n]};u.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(m,1,0);if(r.isString(e)){var i=u.alloc(t=o.length(e));o.decode(e,i,0),e=i}return this.uint32(t)._push(v,t,e)},u.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(m,1,0)},u.prototype.fork=function(){return this.states=new h(this),this.head=this.tail=new l(c,0,0),this.len=0,this},u.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(c,0,0),this.len=0),this},u.prototype.ldelim=function(){var e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=t,this.len+=i),this},u.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t},u._configure=function(e){n=e,u.create=d(),n._configure()}},1819:(e,t,i)=>{"use strict";e.exports=s;var n=i(8116);(s.prototype=Object.create(n.prototype)).constructor=s;var r=i(1679);function s(){n.call(this)}function o(e,t,i){e.length<40?r.utf8.write(e,t,i):t.utf8Write?t.utf8Write(e,i):t.write(e,i)}s._configure=function(){s.alloc=r._Buffer_allocUnsafe,s.writeBytesBuffer=r.Buffer&&r.Buffer.prototype instanceof Uint8Array&&"set"===r.Buffer.prototype.set.name?function(e,t,i){t.set(e,i)}:function(e,t,i){if(e.copy)e.copy(t,i,0,e.length);else for(var n=0;n<e.length;)t[i++]=e[n++]}},s.prototype.bytes=function(e){r.isString(e)&&(e=r._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=r.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},s._configure()},1102:function(e){e.exports=function(){"use strict";function e(e,n,r,s,o){!function e(i,n,r,s,o){for(;s>r;){if(s-r>600){var a=s-r+1,l=n-r+1,c=Math.log(a),h=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*h*(a-h)/a)*(l-a/2<0?-1:1);e(i,n,Math.max(r,Math.floor(n-l*h/a+u)),Math.min(s,Math.floor(n+(a-l)*h/a+u)),o)}var d=i[n],m=r,p=s;for(t(i,r,n),o(i[s],d)>0&&t(i,r,s);m<p;){for(t(i,m,p),m++,p--;o(i[m],d)<0;)m++;for(;o(i[p],d)>0;)p--}0===o(i[r],d)?t(i,r,p):t(i,++p,s),p<=n&&(r=p+1),n<=p&&(s=p-1)}}(e,n,r||0,s||e.length-1,o||i)}function t(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function i(e,t){return e<t?-1:e>t?1:0}var n=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(e,t,i){if(!i)return t.indexOf(e);for(var n=0;n<t.length;n++)if(i(e,t[n]))return n;return-1}function s(e,t){o(e,0,e.children.length,t,e)}function o(e,t,i,n,r){r||(r=p(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var s=t;s<i;s++){var o=e.children[s];a(r,e.leaf?n(o):o)}return r}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function u(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function m(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function p(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function f(t,i,n,r,s){for(var o=[i,n];o.length;)if(!((n=o.pop())-(i=o.pop())<=r)){var a=i+Math.ceil((n-i)/r/2)*r;e(t,a,i,n,s),o.push(i,a,a,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(e){var t=this.data,i=[];if(!m(e,t))return i;for(var n=this.toBBox,r=[];t;){for(var s=0;s<t.children.length;s++){var o=t.children[s],a=t.leaf?n(o):o;m(e,a)&&(t.leaf?i.push(o):d(e,a)?this._all(o,i):r.push(o))}t=r.pop()}return i},n.prototype.collides=function(e){var t=this.data;if(!m(e,t))return!1;for(var i=[];t;){for(var n=0;n<t.children.length;n++){var r=t.children[n],s=t.leaf?this.toBBox(r):r;if(m(e,s)){if(t.leaf||d(e,s))return!0;i.push(r)}}t=i.pop()}return!1},n.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},n.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},n.prototype.clear=function(){return this.data=p([]),this},n.prototype.remove=function(e,t){if(!e)return this;for(var i,n,s,o=this.data,a=this.toBBox(e),l=[],c=[];o||l.length;){if(o||(o=l.pop(),n=l[l.length-1],i=c.pop(),s=!0),o.leaf){var h=r(e,o.children,t);if(-1!==h)return o.children.splice(h,1),l.push(o),this._condense(l),this}s||o.leaf||!d(o,a)?n?(i++,o=n.children[i],s=!1):o=null:(l.push(o),c.push(i),i=0,n=o,o=o.children[0])}return this},n.prototype.toBBox=function(e){return e},n.prototype.compareMinX=function(e,t){return e.minX-t.minX},n.prototype.compareMinY=function(e,t){return e.minY-t.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(e){return this.data=e,this},n.prototype._all=function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},n.prototype._build=function(e,t,i,n){var r,o=i-t+1,a=this._maxEntries;if(o<=a)return s(r=p(e.slice(t,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),(r=p([])).leaf=!1,r.height=n;var l=Math.ceil(o/a),c=l*Math.ceil(Math.sqrt(a));f(e,t,i,c,this.compareMinX);for(var h=t;h<=i;h+=c){var u=Math.min(h+c-1,i);f(e,h,u,l,this.compareMinY);for(var d=h;d<=u;d+=l){var m=Math.min(d+l-1,u);r.children.push(this._build(e,d,m,n-1))}}return s(r,this.toBBox),r},n.prototype._chooseSubtree=function(e,t,i,n){for(;n.push(t),!t.leaf&&n.length-1!==i;){for(var r=1/0,s=1/0,o=void 0,a=0;a<t.children.length;a++){var l=t.children[a],c=h(l),u=(d=e,m=l,(Math.max(m.maxX,d.maxX)-Math.min(m.minX,d.minX))*(Math.max(m.maxY,d.maxY)-Math.min(m.minY,d.minY))-c);u<s?(s=u,r=c<r?c:r,o=l):u===s&&c<r&&(r=c,o=l)}t=o||t.children[0]}var d,m;return t},n.prototype._insert=function(e,t,i){var n=i?e:this.toBBox(e),r=[],s=this._chooseSubtree(n,this.data,t,r);for(s.children.push(e),a(s,n);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(n,r,t)},n.prototype._split=function(e,t){var i=e[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var o=this._chooseSplitIndex(i,r,n),a=p(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,s(i,this.toBBox),s(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)},n.prototype._splitRoot=function(e,t){this.data=p([e,t]),this.data.height=e.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(e,t,i){for(var n,r,s,a,l,c,u,d=1/0,m=1/0,p=t;p<=i-t;p++){var f=o(e,0,p,this.toBBox),g=o(e,p,i,this.toBBox),v=(r=f,s=g,void 0,void 0,void 0,void 0,a=Math.max(r.minX,s.minX),l=Math.max(r.minY,s.minY),c=Math.min(r.maxX,s.maxX),u=Math.min(r.maxY,s.maxY),Math.max(0,c-a)*Math.max(0,u-l)),y=h(f)+h(g);v<d?(d=v,n=p,m=y<m?y:m):v===d&&y<m&&(m=y,n=p)}return n||i-t},n.prototype._chooseSplitAxis=function(e,t,i){var n=e.leaf?this.compareMinX:l,r=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,r)&&e.children.sort(n)},n.prototype._allDistMargin=function(e,t,i,n){e.children.sort(n);for(var r=this.toBBox,s=o(e,0,t,r),l=o(e,i-t,i,r),c=u(s)+u(l),h=t;h<i-t;h++){var d=e.children[h];a(s,e.leaf?r(d):d),c+=u(s)}for(var m=i-t-1;m>=t;m--){var p=e.children[m];a(l,e.leaf?r(p):p),c+=u(l)}return c},n.prototype._adjustParentBBoxes=function(e,t,i){for(var n=i;n>=0;n--)a(t[n],e)},n.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e[t].children.length?t>0?(i=e[t-1].children).splice(i.indexOf(e[t]),1):this.clear():s(e[t],this.toBBox)},n}()},82:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ACESFilmicToneMapping:()=>ie,AddEquation:()=>S,AddOperation:()=>$,AdditiveAnimationBlendMode:()=>qt,AdditiveBlending:()=>w,AlphaFormat:()=>Ve,AlwaysDepth:()=>G,AlwaysStencilFunc:()=>Ti,AmbientLight:()=>Ou,AmbientLightProbe:()=>id,AnimationClip:()=>Fh,AnimationLoader:()=>jh,AnimationMixer:()=>Od,AnimationObjectGroup:()=>Dd,AnimationUtils:()=>bh,ArcCurve:()=>$h,ArrayCamera:()=>Ya,ArrowHelper:()=>Mm,Audio:()=>md,AudioAnalyser:()=>_d,AudioContext:()=>Qu,AudioListener:()=>dd,AudioLoader:()=>ed,AxesHelper:()=>Sm,AxisHelper:()=>bp,BackSide:()=>f,BasicDepthPacking:()=>ri,BasicShadowMap:()=>h,BinaryTextureLoader:()=>Ap,Bone:()=>Ol,BooleanKeyframeTrack:()=>Ch,BoundingBoxHelper:()=>Tp,Box2:()=>Hd,Box3:()=>hn,Box3Helper:()=>_m,BoxBufferGeometry:()=>Ms,BoxGeometry:()=>Ms,BoxHelper:()=>ym,BufferAttribute:()=>Ur,BufferGeometry:()=>rs,BufferGeometryLoader:()=>Gu,ByteType:()=>Se,Cache:()=>Uh,Camera:()=>Ps,CameraHelper:()=>fm,CanvasRenderer:()=>Pp,CanvasTexture:()=>hc,CatmullRomCurve3:()=>nu,CineonToneMapping:()=>te,CircleBufferGeometry:()=>dc,CircleGeometry:()=>dc,ClampToEdgeWrapping:()=>de,Clock:()=>od,Color:()=>Ir,ColorKeyframeTrack:()=>Ph,CompressedTexture:()=>cc,CompressedTextureLoader:()=>Hh,ConeBufferGeometry:()=>pc,ConeGeometry:()=>pc,CubeCamera:()=>Ds,CubeReflectionMapping:()=>se,CubeRefractionMapping:()=>oe,CubeTexture:()=>Is,CubeTextureLoader:()=>qh,CubeUVReflectionMapping:()=>ce,CubeUVRefractionMapping:()=>he,CubicBezierCurve:()=>au,CubicBezierCurve3:()=>lu,CubicInterpolant:()=>Mh,CullFaceBack:()=>a,CullFaceFront:()=>l,CullFaceFrontBack:()=>c,CullFaceNone:()=>o,Curve:()=>Yh,CurvePath:()=>fu,CustomBlending:()=>M,CustomToneMapping:()=>ne,CylinderBufferGeometry:()=>mc,CylinderGeometry:()=>mc,Cylindrical:()=>Gd,DataTexture:()=>Fl,DataTexture2DArray:()=>ro,DataTexture3D:()=>so,DataTextureLoader:()=>Xh,DataUtils:()=>Cm,DecrementStencilOp:()=>di,DecrementWrapStencilOp:()=>pi,DefaultLoadingManager:()=>Nh,DepthFormat:()=>Ge,DepthStencilFormat:()=>je,DepthTexture:()=>uc,DirectionalLight:()=>Iu,DirectionalLightHelper:()=>dm,DiscreteInterpolant:()=>Eh,DodecahedronBufferGeometry:()=>gc,DodecahedronGeometry:()=>gc,DoubleSide:()=>g,DstAlphaFactor:()=>V,DstColorFactor:()=>B,DynamicBufferAttribute:()=>dp,DynamicCopyUsage:()=>Ri,DynamicDrawUsage:()=>Si,DynamicReadUsage:()=>Ci,EdgesGeometry:()=>wc,EdgesHelper:()=>Mp,EllipseCurve:()=>Kh,EqualDepth:()=>W,EqualStencilFunc:()=>yi,EquirectangularReflectionMapping:()=>ae,EquirectangularRefractionMapping:()=>le,Euler:()=>Zn,EventDispatcher:()=>Fi,ExtrudeBufferGeometry:()=>Yc,ExtrudeGeometry:()=>Yc,FaceColors:()=>tp,FileLoader:()=>Gh,FlatShading:()=>v,Float16BufferAttribute:()=>Wr,Float32Attribute:()=>xp,Float32BufferAttribute:()=>qr,Float64Attribute:()=>wp,Float64BufferAttribute:()=>Xr,FloatType:()=>Le,Fog:()=>rl,FogExp2:()=>nl,Font:()=>Yu,FontLoader:()=>$u,FrontSide:()=>p,Frustum:()=>Us,GLBufferAttribute:()=>Ud,GLSL1:()=>Ii,GLSL3:()=>Oi,GammaEncoding:()=>Jt,GreaterDepth:()=>X,GreaterEqualDepth:()=>q,GreaterEqualStencilFunc:()=>bi,GreaterStencilFunc:()=>xi,GridHelper:()=>am,Group:()=>Ka,HalfFloatType:()=>Re,HemisphereLight:()=>_u,HemisphereLightHelper:()=>om,HemisphereLightProbe:()=>td,IcosahedronBufferGeometry:()=>$c,IcosahedronGeometry:()=>$c,ImageBitmapLoader:()=>Xu,ImageLoader:()=>Wh,ImageUtils:()=>$i,ImmediateRenderObject:()=>Zd,IncrementStencilOp:()=>ui,IncrementWrapStencilOp:()=>mi,InstancedBufferAttribute:()=>zu,InstancedBufferGeometry:()=>ku,InstancedInterleavedBuffer:()=>Vd,InstancedMesh:()=>jl,Int16Attribute:()=>gp,Int16BufferAttribute:()=>zr,Int32Attribute:()=>yp,Int32BufferAttribute:()=>jr,Int8Attribute:()=>mp,Int8BufferAttribute:()=>Br,IntType:()=>Ce,InterleavedBuffer:()=>ol,InterleavedBufferAttribute:()=>ll,Interpolant:()=>Th,InterpolateDiscrete:()=>Nt,InterpolateLinear:()=>kt,InterpolateSmooth:()=>zt,InvertStencilOp:()=>fi,JSONLoader:()=>Lp,KeepStencilOp:()=>ci,KeyframeTrack:()=>Ah,LOD:()=>Al,LatheBufferGeometry:()=>Jc,LatheGeometry:()=>Jc,Layers:()=>Yn,LensFlare:()=>Dp,LessDepth:()=>j,LessEqualDepth:()=>H,LessEqualStencilFunc:()=>_i,LessStencilFunc:()=>vi,Light:()=>yu,LightProbe:()=>Uu,Line:()=>Kl,Line3:()=>Xd,LineBasicMaterial:()=>Hl,LineCurve:()=>cu,LineCurve3:()=>hu,LineDashedMaterial:()=>xh,LineLoop:()=>ec,LinePieces:()=>Qm,LineSegments:()=>Ql,LineStrip:()=>Jm,LinearEncoding:()=>Kt,LinearFilter:()=>_e,LinearInterpolant:()=>Sh,LinearMipMapLinearFilter:()=>Te,LinearMipMapNearestFilter:()=>we,LinearMipmapLinearFilter:()=>be,LinearMipmapNearestFilter:()=>xe,LinearToneMapping:()=>Q,Loader:()=>kh,LoaderUtils:()=>Nu,LoadingManager:()=>Bh,LogLuvEncoding:()=>ei,LoopOnce:()=>Vt,LoopPingPong:()=>Bt,LoopRepeat:()=>Ut,LuminanceAlphaFormat:()=>ke,LuminanceFormat:()=>Ne,MOUSE:()=>r,Material:()=>Er,MaterialLoader:()=>Bu,Math:()=>Xi,MathUtils:()=>Xi,Matrix3:()=>Yi,Matrix4:()=>Bn,MaxEquation:()=>P,Mesh:()=>bs,MeshBasicMaterial:()=>Or,MeshDepthMaterial:()=>za,MeshDistanceMaterial:()=>Ga,MeshFaceMaterial:()=>np,MeshLambertMaterial:()=>yh,MeshMatcapMaterial:()=>_h,MeshNormalMaterial:()=>vh,MeshPhongMaterial:()=>fh,MeshPhysicalMaterial:()=>ph,MeshStandardMaterial:()=>mh,MeshToonMaterial:()=>gh,MinEquation:()=>C,MirroredRepeatWrapping:()=>me,MixOperation:()=>K,MultiMaterial:()=>rp,MultiplyBlending:()=>T,MultiplyOperation:()=>Y,NearestFilter:()=>pe,NearestMipMapLinearFilter:()=>ye,NearestMipMapNearestFilter:()=>ge,NearestMipmapLinearFilter:()=>ve,NearestMipmapNearestFilter:()=>fe,NeverDepth:()=>z,NeverStencilFunc:()=>gi,NoBlending:()=>_,NoColors:()=>ep,NoToneMapping:()=>J,NormalAnimationBlendMode:()=>Wt,NormalBlending:()=>x,NotEqualDepth:()=>Z,NotEqualStencilFunc:()=>wi,NumberKeyframeTrack:()=>Lh,Object3D:()=>cr,ObjectLoader:()=>ju,ObjectSpaceNormalMap:()=>ai,OctahedronBufferGeometry:()=>Qc,OctahedronGeometry:()=>Qc,OneFactor:()=>R,OneMinusDstAlphaFactor:()=>U,OneMinusDstColorFactor:()=>N,OneMinusSrcAlphaFactor:()=>F,OneMinusSrcColorFactor:()=>I,OrthographicCamera:()=>Ru,PCFShadowMap:()=>u,PCFSoftShadowMap:()=>d,PMREMGenerator:()=>Wm,ParametricBufferGeometry:()=>eh,ParametricGeometry:()=>eh,Particle:()=>op,ParticleBasicMaterial:()=>cp,ParticleSystem:()=>ap,ParticleSystemMaterial:()=>hp,Path:()=>gu,PerspectiveCamera:()=>Ls,Plane:()=>mr,PlaneBufferGeometry:()=>ks,PlaneGeometry:()=>ks,PlaneHelper:()=>xm,PointCloud:()=>sp,PointCloudMaterial:()=>lp,PointLight:()=>Lu,PointLightHelper:()=>im,Points:()=>oc,PointsMaterial:()=>tc,PolarGridHelper:()=>lm,PolyhedronBufferGeometry:()=>fc,PolyhedronGeometry:()=>fc,PositionalAudio:()=>yd,PropertyBinding:()=>Rd,PropertyMixer:()=>xd,QuadraticBezierCurve:()=>uu,QuadraticBezierCurve3:()=>du,Quaternion:()=>on,QuaternionKeyframeTrack:()=>Dh,QuaternionLinearInterpolant:()=>Rh,REVISION:()=>n,RGBADepthPacking:()=>si,RGBAFormat:()=>Be,RGBAIntegerFormat:()=>Ye,RGBA_ASTC_10x10_Format:()=>yt,RGBA_ASTC_10x5_Format:()=>ft,RGBA_ASTC_10x6_Format:()=>gt,RGBA_ASTC_10x8_Format:()=>vt,RGBA_ASTC_12x10_Format:()=>_t,RGBA_ASTC_12x12_Format:()=>xt,RGBA_ASTC_4x4_Format:()=>at,RGBA_ASTC_5x4_Format:()=>lt,RGBA_ASTC_5x5_Format:()=>ct,RGBA_ASTC_6x5_Format:()=>ht,RGBA_ASTC_6x6_Format:()=>ut,RGBA_ASTC_8x5_Format:()=>dt,RGBA_ASTC_8x6_Format:()=>mt,RGBA_ASTC_8x8_Format:()=>pt,RGBA_BPTC_Format:()=>wt,RGBA_ETC2_EAC_Format:()=>ot,RGBA_PVRTC_2BPPV1_Format:()=>nt,RGBA_PVRTC_4BPPV1_Format:()=>it,RGBA_S3TC_DXT1_Format:()=>$e,RGBA_S3TC_DXT3_Format:()=>Je,RGBA_S3TC_DXT5_Format:()=>Qe,RGBDEncoding:()=>ni,RGBEEncoding:()=>Qt,RGBEFormat:()=>ze,RGBFormat:()=>Ue,RGBIntegerFormat:()=>Ze,RGBM16Encoding:()=>ii,RGBM7Encoding:()=>ti,RGB_ETC1_Format:()=>rt,RGB_ETC2_Format:()=>st,RGB_PVRTC_2BPPV1_Format:()=>tt,RGB_PVRTC_4BPPV1_Format:()=>et,RGB_S3TC_DXT1_Format:()=>Ke,RGFormat:()=>qe,RGIntegerFormat:()=>Xe,RawShaderMaterial:()=>dh,Ray:()=>Un,Raycaster:()=>Bd,RectAreaLight:()=>Fu,RedFormat:()=>He,RedIntegerFormat:()=>We,ReinhardToneMapping:()=>ee,RepeatWrapping:()=>ue,ReplaceStencilOp:()=>hi,ReverseSubtractEquation:()=>A,RingBufferGeometry:()=>th,RingGeometry:()=>th,SRGB8_ALPHA8_ASTC_10x10_Format:()=>It,SRGB8_ALPHA8_ASTC_10x5_Format:()=>Lt,SRGB8_ALPHA8_ASTC_10x6_Format:()=>Rt,SRGB8_ALPHA8_ASTC_10x8_Format:()=>Dt,SRGB8_ALPHA8_ASTC_12x10_Format:()=>Ot,SRGB8_ALPHA8_ASTC_12x12_Format:()=>Ft,SRGB8_ALPHA8_ASTC_4x4_Format:()=>bt,SRGB8_ALPHA8_ASTC_5x4_Format:()=>Tt,SRGB8_ALPHA8_ASTC_5x5_Format:()=>Mt,SRGB8_ALPHA8_ASTC_6x5_Format:()=>St,SRGB8_ALPHA8_ASTC_6x6_Format:()=>Et,SRGB8_ALPHA8_ASTC_8x5_Format:()=>At,SRGB8_ALPHA8_ASTC_8x6_Format:()=>Ct,SRGB8_ALPHA8_ASTC_8x8_Format:()=>Pt,Scene:()=>sl,SceneUtils:()=>Rp,ShaderChunk:()=>zs,ShaderLib:()=>js,ShaderMaterial:()=>Cs,ShadowMaterial:()=>uh,Shape:()=>vu,ShapeBufferGeometry:()=>ih,ShapeGeometry:()=>ih,ShapePath:()=>Zu,ShapeUtils:()=>qc,ShortType:()=>Ee,Skeleton:()=>Bl,SkeletonHelper:()=>em,SkinnedMesh:()=>Il,SmoothShading:()=>y,Sphere:()=>Pn,SphereBufferGeometry:()=>nh,SphereGeometry:()=>nh,Spherical:()=>zd,SphericalHarmonics3:()=>Vu,SplineCurve:()=>mu,SpotLight:()=>Su,SpotLightHelper:()=>Kd,Sprite:()=>Tl,SpriteMaterial:()=>cl,SrcAlphaFactor:()=>O,SrcAlphaSaturateFactor:()=>k,SrcColorFactor:()=>D,StaticCopyUsage:()=>Li,StaticDrawUsage:()=>Mi,StaticReadUsage:()=>Ai,StereoCamera:()=>sd,StreamCopyUsage:()=>Di,StreamDrawUsage:()=>Ei,StreamReadUsage:()=>Pi,StringKeyframeTrack:()=>Ih,SubtractEquation:()=>E,SubtractiveBlending:()=>b,TOUCH:()=>s,TangentSpaceNormalMap:()=>oi,TetrahedronBufferGeometry:()=>rh,TetrahedronGeometry:()=>rh,TextBufferGeometry:()=>sh,TextGeometry:()=>sh,Texture:()=>Qi,TextureLoader:()=>Zh,TorusBufferGeometry:()=>oh,TorusGeometry:()=>oh,TorusKnotBufferGeometry:()=>ah,TorusKnotGeometry:()=>ah,Triangle:()=>Mr,TriangleFanDrawMode:()=>Yt,TriangleStripDrawMode:()=>Zt,TrianglesDrawMode:()=>Xt,TubeBufferGeometry:()=>lh,TubeGeometry:()=>lh,UVMapping:()=>re,Uint16Attribute:()=>vp,Uint16BufferAttribute:()=>Gr,Uint32Attribute:()=>_p,Uint32BufferAttribute:()=>Hr,Uint8Attribute:()=>pp,Uint8BufferAttribute:()=>Nr,Uint8ClampedAttribute:()=>fp,Uint8ClampedBufferAttribute:()=>kr,Uniform:()=>Fd,UniformsLib:()=>Gs,UniformsUtils:()=>As,UnsignedByteType:()=>Me,UnsignedInt248Type:()=>Fe,UnsignedIntType:()=>Pe,UnsignedShort4444Type:()=>De,UnsignedShort5551Type:()=>Ie,UnsignedShort565Type:()=>Oe,UnsignedShortType:()=>Ae,VSMShadowMap:()=>m,Vector2:()=>Zi,Vector3:()=>an,Vector4:()=>tn,VectorKeyframeTrack:()=>Oh,Vertex:()=>up,VertexColors:()=>ip,VideoTexture:()=>lc,WebGL1Renderer:()=>il,WebGLCubeRenderTarget:()=>Os,WebGLMultipleRenderTargets:()=>rn,WebGLMultisampleRenderTarget:()=>sn,WebGLRenderTarget:()=>nn,WebGLRenderTargetCube:()=>Cp,WebGLRenderer:()=>tl,WebGLUtils:()=>Za,WireframeGeometry:()=>ch,WireframeHelper:()=>Sp,WrapAroundEnding:()=>Ht,XHRLoader:()=>Ep,ZeroCurvatureEnding:()=>Gt,ZeroFactor:()=>L,ZeroSlopeEnding:()=>jt,ZeroStencilOp:()=>li,sRGBEncoding:()=>$t});const n="129",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,a=1,l=2,c=3,h=0,u=1,d=2,m=3,p=0,f=1,g=2,v=1,y=2,_=0,x=1,w=2,b=3,T=4,M=5,S=100,E=101,A=102,C=103,P=104,L=200,R=201,D=202,I=203,O=204,F=205,V=206,U=207,B=208,N=209,k=210,z=0,G=1,j=2,H=3,W=4,q=5,X=6,Z=7,Y=0,K=1,$=2,J=0,Q=1,ee=2,te=3,ie=4,ne=5,re=300,se=301,oe=302,ae=303,le=304,ce=306,he=307,ue=1e3,de=1001,me=1002,pe=1003,fe=1004,ge=1004,ve=1005,ye=1005,_e=1006,xe=1007,we=1007,be=1008,Te=1008,Me=1009,Se=1010,Ee=1011,Ae=1012,Ce=1013,Pe=1014,Le=1015,Re=1016,De=1017,Ie=1018,Oe=1019,Fe=1020,Ve=1021,Ue=1022,Be=1023,Ne=1024,ke=1025,ze=Be,Ge=1026,je=1027,He=1028,We=1029,qe=1030,Xe=1031,Ze=1032,Ye=1033,Ke=33776,$e=33777,Je=33778,Qe=33779,et=35840,tt=35841,it=35842,nt=35843,rt=36196,st=37492,ot=37496,at=37808,lt=37809,ct=37810,ht=37811,ut=37812,dt=37813,mt=37814,pt=37815,ft=37816,gt=37817,vt=37818,yt=37819,_t=37820,xt=37821,wt=36492,bt=37840,Tt=37841,Mt=37842,St=37843,Et=37844,At=37845,Ct=37846,Pt=37847,Lt=37848,Rt=37849,Dt=37850,It=37851,Ot=37852,Ft=37853,Vt=2200,Ut=2201,Bt=2202,Nt=2300,kt=2301,zt=2302,Gt=2400,jt=2401,Ht=2402,Wt=2500,qt=2501,Xt=0,Zt=1,Yt=2,Kt=3e3,$t=3001,Jt=3007,Qt=3002,ei=3003,ti=3004,ii=3005,ni=3006,ri=3200,si=3201,oi=0,ai=1,li=0,ci=7680,hi=7681,ui=7682,di=7683,mi=34055,pi=34056,fi=5386,gi=512,vi=513,yi=514,_i=515,xi=516,wi=517,bi=518,Ti=519,Mi=35044,Si=35048,Ei=35040,Ai=35045,Ci=35049,Pi=35041,Li=35046,Ri=35050,Di=35042,Ii="100",Oi="300 es";class Fi{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e);e.target=null}}}const Vi=[];for(let e=0;e<256;e++)Vi[e]=(e<16?"0":"")+e.toString(16);let Ui=1234567;const Bi=Math.PI/180,Ni=180/Math.PI;function ki(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Vi[255&e]+Vi[e>>8&255]+Vi[e>>16&255]+Vi[e>>24&255]+"-"+Vi[255&t]+Vi[t>>8&255]+"-"+Vi[t>>16&15|64]+Vi[t>>24&255]+"-"+Vi[63&i|128]+Vi[i>>8&255]+"-"+Vi[i>>16&255]+Vi[i>>24&255]+Vi[255&n]+Vi[n>>8&255]+Vi[n>>16&255]+Vi[n>>24&255]).toUpperCase()}function zi(e,t,i){return Math.max(t,Math.min(i,e))}function Gi(e,t){return(e%t+t)%t}function ji(e,t,i){return(1-i)*e+i*t}function Hi(e){return 0==(e&e-1)&&0!==e}function Wi(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function qi(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Xi=Object.freeze({__proto__:null,DEG2RAD:Bi,RAD2DEG:Ni,generateUUID:ki,clamp:zi,euclideanModulo:Gi,mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},inverseLerp:function(e,t,i){return e!==t?(i-e)/(t-e):0},lerp:ji,damp:function(e,t,i,n){return ji(e,t,1-Math.exp(-i*n))},pingpong:function(e,t=1){return t-Math.abs(Gi(e,2*t)-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Ui=e%2147483647),Ui=16807*Ui%2147483647,(Ui-1)/2147483646},degToRad:function(e){return e*Bi},radToDeg:function(e){return e*Ni},isPowerOfTwo:Hi,ceilPowerOfTwo:Wi,floorPowerOfTwo:qi,setQuaternionFromProperEuler:function(e,t,i,n,r){const s=Math.cos,o=Math.sin,a=s(i/2),l=o(i/2),c=s((t+n)/2),h=o((t+n)/2),u=s((t-n)/2),d=o((t-n)/2),m=s((n-t)/2),p=o((n-t)/2);switch(r){case"XYX":e.set(a*h,l*u,l*d,a*c);break;case"YZY":e.set(l*d,a*h,l*u,a*c);break;case"ZXZ":e.set(l*u,l*d,a*h,a*c);break;case"XZX":e.set(a*h,l*p,l*m,a*c);break;case"YXY":e.set(l*m,a*h,l*p,a*c);break;case"ZYZ":e.set(l*p,l*m,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}});class Zi{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*i-s*n+e.x,this.y=r*n+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Zi.prototype.isVector2=!0;class Yi{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,r,s,o,a,l){const c=this.elements;return c[0]=e,c[1]=n,c[2]=o,c[3]=t,c[4]=r,c[5]=a,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],m=i[8],p=n[0],f=n[3],g=n[6],v=n[1],y=n[4],_=n[7],x=n[2],w=n[5],b=n[8];return r[0]=s*p+o*v+a*x,r[3]=s*f+o*y+a*w,r[6]=s*g+o*_+a*b,r[1]=l*p+c*v+h*x,r[4]=l*f+c*y+h*w,r[7]=l*g+c*_+h*b,r[2]=u*p+d*v+m*x,r[5]=u*f+d*y+m*w,r[8]=u*g+d*_+m*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*s*c-t*o*l-i*r*c+i*o*a+n*r*l-n*s*a}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=c*s-o*l,u=o*a-c*r,d=l*r-s*a,m=t*h+i*u+n*d;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return e[0]=h*p,e[1]=(n*l-c*i)*p,e[2]=(o*i-n*s)*p,e[3]=u*p,e[4]=(c*t-n*a)*p,e[5]=(n*r-o*t)*p,e[6]=d*p,e[7]=(i*a-l*t)*p,e[8]=(s*t-i*r)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(i*a,i*l,-i*(a*s+l*o)+s+e,-n*l,n*a,-n*(-l*s+a*o)+o+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),n=this.elements,r=n[0],s=n[3],o=n[6],a=n[1],l=n[4],c=n[7];return n[0]=t*r+i*a,n[3]=t*s+i*l,n[6]=t*o+i*c,n[1]=-i*r+t*a,n[4]=-i*s+t*l,n[7]=-i*o+t*c,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}let Ki;Yi.prototype.isMatrix3=!0;class $i{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Ki&&(Ki=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ki.width=e.width,Ki.height=e.height;const i=Ki.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Ki}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let Ji=0;class Qi extends Fi{constructor(e=Qi.DEFAULT_IMAGE,t=Qi.DEFAULT_MAPPING,i=de,n=de,r=_e,s=be,o=Be,a=Me,l=1,c=Kt){super(),Object.defineProperty(this,"id",{value:Ji++}),this.uuid=ki(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Zi(0,0),this.repeat=new Zi(1,1),this.center=new Zi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Yi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=ki()),!t&&void 0===e.images[n.uuid]){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(en(n[e].image)):t.push(en(n[e]))}else t=en(n);e.images[n.uuid]={uuid:n.uuid,url:t}}i.image=n.uuid}return t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==re)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ue:e.x=e.x-Math.floor(e.x);break;case de:e.x=e.x<0?0:1;break;case me:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ue:e.y=e.y-Math.floor(e.y);break;case de:e.y=e.y<0?0:1;break;case me:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function en(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?$i.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Qi.DEFAULT_IMAGE=void 0,Qi.DEFAULT_MAPPING=re,Qi.prototype.isTexture=!0;class tn{constructor(e=0,t=0,i=0,n=1){this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*t+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*t+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*t+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const s=.01,o=.1,a=e.elements,l=a[0],c=a[4],h=a[8],u=a[1],d=a[5],m=a[9],p=a[2],f=a[6],g=a[10];if(Math.abs(c-u)<s&&Math.abs(h-p)<s&&Math.abs(m-f)<s){if(Math.abs(c+u)<o&&Math.abs(h+p)<o&&Math.abs(m+f)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(d+1)/2,v=(g+1)/2,y=(c+u)/4,_=(h+p)/4,x=(m+f)/4;return e>a&&e>v?e<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(e),n=y/i,r=_/i):a>v?a<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(a),i=y/n,r=x/n):v<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(v),i=_/r,n=x/r),this.set(i,n,r,t),this}let v=Math.sqrt((f-m)*(f-m)+(h-p)*(h-p)+(u-c)*(u-c));return Math.abs(v)<.001&&(v=1),this.x=(f-m)/v,this.y=(h-p)/v,this.z=(u-c)/v,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}tn.prototype.isVector4=!0;class nn extends Fi{constructor(e,t,i){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new tn(0,0,e,t),this.scissorTest=!1,this.viewport=new tn(0,0,e,t),i=i||{},this.texture=new Qi(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:_e,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,i=1){this.width===e&&this.height===t&&this.depth===i||(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}nn.prototype.isWebGLRenderTarget=!0;class rn extends nn{constructor(e,t,i){super(e,t);const n=this.texture;this.texture=[];for(let e=0;e<i;e++)this.texture[e]=n.clone()}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=e,this.texture[n].image.height=t,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone();return this}}rn.prototype.isWebGLMultipleRenderTargets=!0;class sn extends nn{constructor(e,t,i){super(e,t,i),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}sn.prototype.isWebGLMultisampleRenderTarget=!0;class on{constructor(e=0,t=0,i=0,n=1){this._x=e,this._y=t,this._z=i,this._w=n}static slerp(e,t,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,n)}static slerpFlat(e,t,i,n,r,s,o){let a=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3];const u=r[s+0],d=r[s+1],m=r[s+2],p=r[s+3];if(0===o)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===o)return e[t+0]=u,e[t+1]=d,e[t+2]=m,void(e[t+3]=p);if(h!==p||a!==u||l!==d||c!==m){let e=1-o;const t=a*u+l*d+c*m+h*p,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,t*i);e=Math.sin(e*s)/r,o=Math.sin(o*s)/r}const r=o*i;if(a=a*e+u*r,l=l*e+d*r,c=c*e+m*r,h=h*e+p*r,e===1-o){const e=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=e,l*=e,c*=e,h*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,n,r,s){const o=i[n],a=i[n+1],l=i[n+2],c=i[n+3],h=r[s],u=r[s+1],d=r[s+2],m=r[s+3];return e[t]=o*m+c*h+a*d-l*u,e[t+1]=a*m+c*u+l*h-o*d,e[t+2]=l*m+c*d+o*u-a*h,e[t+3]=c*m-o*h-a*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,n=e._y,r=e._z,s=e._order,o=Math.cos,a=Math.sin,l=o(i/2),c=o(n/2),h=o(r/2),u=a(i/2),d=a(n/2),m=a(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*m,this._y=l*d*h-u*c*m,this._z=l*c*m+u*d*h,this._w=l*c*h-u*d*m;break;case"YXZ":this._x=u*c*h+l*d*m,this._y=l*d*h-u*c*m,this._z=l*c*m-u*d*h,this._w=l*c*h+u*d*m;break;case"ZXY":this._x=u*c*h-l*d*m,this._y=l*d*h+u*c*m,this._z=l*c*m+u*d*h,this._w=l*c*h-u*d*m;break;case"ZYX":this._x=u*c*h-l*d*m,this._y=l*d*h+u*c*m,this._z=l*c*m-u*d*h,this._w=l*c*h+u*d*m;break;case"YZX":this._x=u*c*h+l*d*m,this._y=l*d*h+u*c*m,this._z=l*c*m-u*d*h,this._w=l*c*h-u*d*m;break;case"XZY":this._x=u*c*h-l*d*m,this._y=l*d*h-u*c*m,this._z=l*c*m+u*d*h,this._w=l*c*h+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],s=t[1],o=t[5],a=t[9],l=t[2],c=t[6],h=t[10],u=i+o+h;if(u>0){const e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(c-a)*e,this._y=(r-l)*e,this._z=(s-n)*e}else if(i>o&&i>h){const e=2*Math.sqrt(1+i-o-h);this._w=(c-a)/e,this._x=.25*e,this._y=(n+s)/e,this._z=(r+l)/e}else if(o>h){const e=2*Math.sqrt(1+o-i-h);this._w=(r-l)/e,this._x=(n+s)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+h-i-o);this._w=(s-n)/e,this._x=(r+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(zi(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,s=e._w,o=t._x,a=t._y,l=t._z,c=t._w;return this._x=i*c+s*o+n*l-r*a,this._y=n*c+s*a+r*o-i*l,this._z=r*c+s*l+i*a-n*o,this._w=s*c-i*o-n*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,n=this._y,r=this._z,s=this._w;let o=s*e._w+i*e._x+n*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){this.copy(e).slerp(t,i)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}on.prototype.isQuaternion=!0;class an{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(cn.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(cn.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,s=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,s=e.y,o=e.z,a=e.w,l=a*t+s*n-o*i,c=a*i+o*t-r*n,h=a*n+r*i-s*t,u=-r*t-s*i-o*n;return this.x=l*a+u*-r+c*-o-h*-s,this.y=c*a+u*-s+h*-r-l*-o,this.z=h*a+u*-o+l*-s-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,s=t.x,o=t.y,a=t.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return ln.copy(this).projectOnVector(e),this.sub(ln)}reflect(e){return this.sub(ln.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(zi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}an.prototype.isVector3=!0;const ln=new an,cn=new on;class hn{constructor(e=new an(1/0,1/0,1/0),t=new an(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],h=e[a+2];l<t&&(t=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(t,i,n),this.max.set(r,s,o),this}setFromBufferAttribute(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),c=e.getY(a),h=e.getZ(a);l<t&&(t=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(t,i,n),this.max.set(r,s,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=dn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new an),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new an),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),mn.copy(t.boundingBox),mn.applyMatrix4(e.matrixWorld),this.union(mn));const i=e.children;for(let e=0,t=i.length;e<t;e++)this.expandByObject(i[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new an),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,dn),dn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(xn),wn.subVectors(this.max,xn),pn.subVectors(e.a,xn),fn.subVectors(e.b,xn),gn.subVectors(e.c,xn),vn.subVectors(fn,pn),yn.subVectors(gn,fn),_n.subVectors(pn,gn);let t=[0,-vn.z,vn.y,0,-yn.z,yn.y,0,-_n.z,_n.y,vn.z,0,-vn.x,yn.z,0,-yn.x,_n.z,0,-_n.x,-vn.y,vn.x,0,-yn.y,yn.x,0,-_n.y,_n.x,0];return!!Mn(t,pn,fn,gn,wn)&&(t=[1,0,0,0,1,0,0,0,1],!!Mn(t,pn,fn,gn,wn)&&(bn.crossVectors(vn,yn),t=[bn.x,bn.y,bn.z],Mn(t,pn,fn,gn,wn)))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new an),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return dn.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(dn).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(un[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),un[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),un[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),un[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),un[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),un[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),un[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),un[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(un)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}hn.prototype.isBox3=!0;const un=[new an,new an,new an,new an,new an,new an,new an,new an],dn=new an,mn=new hn,pn=new an,fn=new an,gn=new an,vn=new an,yn=new an,_n=new an,xn=new an,wn=new an,bn=new an,Tn=new an;function Mn(e,t,i,n,r){for(let s=0,o=e.length-3;s<=o;s+=3){Tn.fromArray(e,s);const o=r.x*Math.abs(Tn.x)+r.y*Math.abs(Tn.y)+r.z*Math.abs(Tn.z),a=t.dot(Tn),l=i.dot(Tn),c=n.dot(Tn);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const Sn=new hn,En=new an,An=new an,Cn=new an;class Pn{constructor(e=new an,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):Sn.setFromPoints(e).getCenter(i);let n=0;for(let t=0,r=e.length;t<r;t++)n=Math.max(n,i.distanceToSquared(e[t]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new an),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new hn),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Cn.subVectors(e,this.center);const t=Cn.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),i=.5*(e-this.radius);this.center.add(Cn.multiplyScalar(i/e)),this.radius+=i}return this}union(e){return An.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(En.copy(e.center).add(An)),this.expandByPoint(En.copy(e.center).sub(An)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ln=new an,Rn=new an,Dn=new an,In=new an,On=new an,Fn=new an,Vn=new an;class Un{constructor(e=new an,t=new an(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new an),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ln)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new an),t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ln.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ln.copy(this.direction).multiplyScalar(t).add(this.origin),Ln.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){Rn.copy(e).add(t).multiplyScalar(.5),Dn.copy(t).sub(e).normalize(),In.copy(this.origin).sub(Rn);const r=.5*e.distanceTo(t),s=-this.direction.dot(Dn),o=In.dot(this.direction),a=-In.dot(Dn),l=In.lengthSq(),c=Math.abs(1-s*s);let h,u,d,m;if(c>0)if(h=s*a-o,u=s*o-a,m=r*c,h>=0)if(u>=-m)if(u<=m){const e=1/c;h*=e,u*=e,d=h*(h+s*u+2*o)+u*(s*h+u+2*a)+l}else u=r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u=-r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u<=-m?(h=Math.max(0,-(-s*r+o)),u=h>0?-r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l):u<=m?(h=0,u=Math.min(Math.max(-r,-a),r),d=u*(u+2*a)+l):(h=Math.max(0,-(s*r+o)),u=h>0?r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(Dn).multiplyScalar(u).add(Rn),d}intersectSphere(e,t){Ln.subVectors(e.center,this.origin);const i=Ln.dot(this.direction),n=Ln.dot(Ln)-i*i,r=e.radius*e.radius;if(n>r)return null;const s=Math.sqrt(r-n),o=i-s,a=i+s;return o<0&&a<0?null:o<0?this.at(a,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(e.min.x-u.x)*l,n=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,n=(e.min.x-u.x)*l),c>=0?(r=(e.min.y-u.y)*c,s=(e.max.y-u.y)*c):(r=(e.max.y-u.y)*c,s=(e.min.y-u.y)*c),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),h>=0?(o=(e.min.z-u.z)*h,a=(e.max.z-u.z)*h):(o=(e.max.z-u.z)*h,a=(e.min.z-u.z)*h),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,t)))}intersectsBox(e){return null!==this.intersectBox(e,Ln)}intersectTriangle(e,t,i,n,r){On.subVectors(t,e),Fn.subVectors(i,e),Vn.crossVectors(On,Fn);let s,o=this.direction.dot(Vn);if(o>0){if(n)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}In.subVectors(this.origin,e);const a=s*this.direction.dot(Fn.crossVectors(In,Fn));if(a<0)return null;const l=s*this.direction.dot(On.cross(In));if(l<0)return null;if(a+l>o)return null;const c=-s*In.dot(Vn);return c<0?null:this.at(c/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Bn{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,r,s,o,a,l,c,h,u,d,m,p,f){const g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=m,g[11]=p,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Bn).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/Nn.setFromMatrixColumn(e,0).length(),r=1/Nn.setFromMatrixColumn(e,1).length(),s=1/Nn.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,n=e.y,r=e.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){const e=s*c,i=s*h,n=o*c,r=o*h;t[0]=a*c,t[4]=-a*h,t[8]=l,t[1]=i+n*l,t[5]=e-r*l,t[9]=-o*a,t[2]=r-e*l,t[6]=n+i*l,t[10]=s*a}else if("YXZ"===e.order){const e=a*c,i=a*h,n=l*c,r=l*h;t[0]=e+r*o,t[4]=n*o-i,t[8]=s*l,t[1]=s*h,t[5]=s*c,t[9]=-o,t[2]=i*o-n,t[6]=r+e*o,t[10]=s*a}else if("ZXY"===e.order){const e=a*c,i=a*h,n=l*c,r=l*h;t[0]=e-r*o,t[4]=-s*h,t[8]=n+i*o,t[1]=i+n*o,t[5]=s*c,t[9]=r-e*o,t[2]=-s*l,t[6]=o,t[10]=s*a}else if("ZYX"===e.order){const e=s*c,i=s*h,n=o*c,r=o*h;t[0]=a*c,t[4]=n*l-i,t[8]=e*l+r,t[1]=a*h,t[5]=r*l+e,t[9]=i*l-n,t[2]=-l,t[6]=o*a,t[10]=s*a}else if("YZX"===e.order){const e=s*a,i=s*l,n=o*a,r=o*l;t[0]=a*c,t[4]=r-e*h,t[8]=n*h+i,t[1]=h,t[5]=s*c,t[9]=-o*c,t[2]=-l*c,t[6]=i*h+n,t[10]=e-r*h}else if("XZY"===e.order){const e=s*a,i=s*l,n=o*a,r=o*l;t[0]=a*c,t[4]=-h,t[8]=l*c,t[1]=e*h+r,t[5]=s*c,t[9]=i*h-n,t[2]=n*h-i,t[6]=o*c,t[10]=r*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(zn,e,Gn)}lookAt(e,t,i){const n=this.elements;return Wn.subVectors(e,t),0===Wn.lengthSq()&&(Wn.z=1),Wn.normalize(),jn.crossVectors(i,Wn),0===jn.lengthSq()&&(1===Math.abs(i.z)?Wn.x+=1e-4:Wn.z+=1e-4,Wn.normalize(),jn.crossVectors(i,Wn)),jn.normalize(),Hn.crossVectors(Wn,jn),n[0]=jn.x,n[4]=Hn.x,n[8]=Wn.x,n[1]=jn.y,n[5]=Hn.y,n[9]=Wn.y,n[2]=jn.z,n[6]=Hn.z,n[10]=Wn.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],m=i[2],p=i[6],f=i[10],g=i[14],v=i[3],y=i[7],_=i[11],x=i[15],w=n[0],b=n[4],T=n[8],M=n[12],S=n[1],E=n[5],A=n[9],C=n[13],P=n[2],L=n[6],R=n[10],D=n[14],I=n[3],O=n[7],F=n[11],V=n[15];return r[0]=s*w+o*S+a*P+l*I,r[4]=s*b+o*E+a*L+l*O,r[8]=s*T+o*A+a*R+l*F,r[12]=s*M+o*C+a*D+l*V,r[1]=c*w+h*S+u*P+d*I,r[5]=c*b+h*E+u*L+d*O,r[9]=c*T+h*A+u*R+d*F,r[13]=c*M+h*C+u*D+d*V,r[2]=m*w+p*S+f*P+g*I,r[6]=m*b+p*E+f*L+g*O,r[10]=m*T+p*A+f*R+g*F,r[14]=m*M+p*C+f*D+g*V,r[3]=v*w+y*S+_*P+x*I,r[7]=v*b+y*E+_*L+x*O,r[11]=v*T+y*A+_*R+x*F,r[15]=v*M+y*C+_*D+x*V,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],s=e[1],o=e[5],a=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+r*a*h-n*l*h-r*o*u+i*l*u+n*o*d-i*a*d)+e[7]*(+t*a*d-t*l*u+r*s*u-n*s*d+n*l*c-r*a*c)+e[11]*(+t*l*h-t*o*d-r*s*h+i*s*d+r*o*c-i*l*c)+e[15]*(-n*o*c-t*a*h+t*o*u+n*s*h-i*s*u+i*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],m=e[12],p=e[13],f=e[14],g=e[15],v=h*f*l-p*u*l+p*a*d-o*f*d-h*a*g+o*u*g,y=m*u*l-c*f*l-m*a*d+s*f*d+c*a*g-s*u*g,_=c*p*l-m*h*l+m*o*d-s*p*d-c*o*g+s*h*g,x=m*h*a-c*p*a-m*o*u+s*p*u+c*o*f-s*h*f,w=t*v+i*y+n*_+r*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/w;return e[0]=v*b,e[1]=(p*u*r-h*f*r-p*n*d+i*f*d+h*n*g-i*u*g)*b,e[2]=(o*f*r-p*a*r+p*n*l-i*f*l-o*n*g+i*a*g)*b,e[3]=(h*a*r-o*u*r-h*n*l+i*u*l+o*n*d-i*a*d)*b,e[4]=y*b,e[5]=(c*f*r-m*u*r+m*n*d-t*f*d-c*n*g+t*u*g)*b,e[6]=(m*a*r-s*f*r-m*n*l+t*f*l+s*n*g-t*a*g)*b,e[7]=(s*u*r-c*a*r+c*n*l-t*u*l-s*n*d+t*a*d)*b,e[8]=_*b,e[9]=(m*h*r-c*p*r-m*i*d+t*p*d+c*i*g-t*h*g)*b,e[10]=(s*p*r-m*o*r+m*i*l-t*p*l-s*i*g+t*o*g)*b,e[11]=(c*o*r-s*h*r-c*i*l+t*h*l+s*i*d-t*o*d)*b,e[12]=x*b,e[13]=(c*p*n-m*h*n+m*i*u-t*p*u-c*i*f+t*h*f)*b,e[14]=(m*o*n-s*p*n-m*i*a+t*p*a+s*i*f-t*o*f)*b,e[15]=(s*h*n-c*o*n+c*i*a-t*h*a-s*i*u+t*o*u)*b,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,s=e.x,o=e.y,a=e.z,l=r*s,c=r*o;return this.set(l*s+i,l*o-n*a,l*a+n*o,0,l*o+n*a,c*o+i,c*a-n*s,0,l*a-n*o,c*a+n*s,r*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,s){return this.set(1,i,r,0,e,1,s,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,s=t._y,o=t._z,a=t._w,l=r+r,c=s+s,h=o+o,u=r*l,d=r*c,m=r*h,p=s*c,f=s*h,g=o*h,v=a*l,y=a*c,_=a*h,x=i.x,w=i.y,b=i.z;return n[0]=(1-(p+g))*x,n[1]=(d+_)*x,n[2]=(m-y)*x,n[3]=0,n[4]=(d-_)*w,n[5]=(1-(u+g))*w,n[6]=(f+v)*w,n[7]=0,n[8]=(m+y)*b,n[9]=(f-v)*b,n[10]=(1-(u+p))*b,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=Nn.set(n[0],n[1],n[2]).length();const s=Nn.set(n[4],n[5],n[6]).length(),o=Nn.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],kn.copy(this);const a=1/r,l=1/s,c=1/o;return kn.elements[0]*=a,kn.elements[1]*=a,kn.elements[2]*=a,kn.elements[4]*=l,kn.elements[5]*=l,kn.elements[6]*=l,kn.elements[8]*=c,kn.elements[9]*=c,kn.elements[10]*=c,t.setFromRotationMatrix(kn),i.x=r,i.y=s,i.z=o,this}makePerspective(e,t,i,n,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*r/(t-e),l=2*r/(i-n),c=(t+e)/(t-e),h=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,i,n,r,s){const o=this.elements,a=1/(t-e),l=1/(i-n),c=1/(s-r),h=(t+e)*a,u=(i+n)*l,d=(s+r)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}Bn.prototype.isMatrix4=!0;const Nn=new an,kn=new Bn,zn=new an(0,0,0),Gn=new an(1,1,1),jn=new an,Hn=new an,Wn=new an,qn=new Bn,Xn=new on;class Zn{constructor(e=0,t=0,i=0,n=Zn.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,i){const n=e.elements,r=n[0],s=n[4],o=n[8],a=n[1],l=n[5],c=n[9],h=n[2],u=n[6],d=n[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(zi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-zi(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(zi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-zi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(zi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-zi(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return qn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(qn,t,i)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return Xn.setFromEuler(this),this.setFromQuaternion(Xn,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new an(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Zn.prototype.isEuler=!0,Zn.DefaultOrder="XYZ",Zn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Yn{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let Kn=0;const $n=new an,Jn=new on,Qn=new Bn,er=new an,tr=new an,ir=new an,nr=new on,rr=new an(1,0,0),sr=new an(0,1,0),or=new an(0,0,1),ar={type:"added"},lr={type:"removed"};class cr extends Fi{constructor(){super(),Object.defineProperty(this,"id",{value:Kn++}),this.uuid=ki(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=cr.DefaultUp.clone();const e=new an,t=new Zn,i=new on,n=new an(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Bn},normalMatrix:{value:new Yi}}),this.matrix=new Bn,this.matrixWorld=new Bn,this.matrixAutoUpdate=cr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Yn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Jn.setFromAxisAngle(e,t),this.quaternion.multiply(Jn),this}rotateOnWorldAxis(e,t){return Jn.setFromAxisAngle(e,t),this.quaternion.premultiply(Jn),this}rotateX(e){return this.rotateOnAxis(rr,e)}rotateY(e){return this.rotateOnAxis(sr,e)}rotateZ(e){return this.rotateOnAxis(or,e)}translateOnAxis(e,t){return $n.copy(e).applyQuaternion(this.quaternion),this.position.add($n.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(rr,e)}translateY(e){return this.translateOnAxis(sr,e)}translateZ(e){return this.translateOnAxis(or,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Qn.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?er.copy(e):er.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),tr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Qn.lookAt(tr,er,this.up):Qn.lookAt(er,tr,this.up),this.quaternion.setFromRotationMatrix(Qn),n&&(Qn.extractRotation(n.matrixWorld),Jn.setFromRotationMatrix(Qn),this.quaternion.premultiply(Jn.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ar)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(lr)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(lr)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Qn.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Qn.multiply(e.parent.matrixWorld)),e.applyMatrix4(Qn),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getWorldPosition(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new an),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new on),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tr,e,ir),e}getWorldScale(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new an),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tr,nr,e),e}getWorldDirection(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new an),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const n=i[t];r(e.shapes,n)}else r(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(r(e.materials,this.material[i]));n.material=t}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];n.animations.push(r(e.animations,i))}}if(t){const t=s(e.geometries),n=s(e.materials),r=s(e.textures),o=s(e.images),a=s(e.shapes),l=s(e.skeletons),c=s(e.animations);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c)}return i.object=n,i;function s(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const i=e.children[t];this.add(i.clone())}return this}}cr.DefaultUp=new an(0,1,0),cr.DefaultMatrixAutoUpdate=!0,cr.prototype.isObject3D=!0;const hr=new an,ur=new an,dr=new Yi;class mr{constructor(e=new an(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=hr.subVectors(i,t).cross(ur.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new an),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new an);const i=e.delta(hr),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(i).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new an),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||dr.getNormalMatrix(e),n=this.coplanarPoint(hr).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}mr.prototype.isPlane=!0;const pr=new an,fr=new an,gr=new an,vr=new an,yr=new an,_r=new an,xr=new an,wr=new an,br=new an,Tr=new an;class Mr{constructor(e=new an,t=new an,i=new an){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new an),n.subVectors(i,t),pr.subVectors(e,t),n.cross(pr);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){pr.subVectors(n,t),fr.subVectors(i,t),gr.subVectors(e,t);const s=pr.dot(pr),o=pr.dot(fr),a=pr.dot(gr),l=fr.dot(fr),c=fr.dot(gr),h=s*l-o*o;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new an),0===h)return r.set(-2,-1,-1);const u=1/h,d=(l*a-o*c)*u,m=(s*c-o*a)*u;return r.set(1-d-m,m,d)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,vr),vr.x>=0&&vr.y>=0&&vr.x+vr.y<=1}static getUV(e,t,i,n,r,s,o,a){return this.getBarycoord(e,t,i,n,vr),a.set(0,0),a.addScaledVector(r,vr.x),a.addScaledVector(s,vr.y),a.addScaledVector(o,vr.z),a}static isFrontFacing(e,t,i,n){return pr.subVectors(i,t),fr.subVectors(e,t),pr.cross(fr).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return pr.subVectors(this.c,this.b),fr.subVectors(this.a,this.b),.5*pr.cross(fr).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new an),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Mr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new mr),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Mr.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,r){return Mr.getUV(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return Mr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Mr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new an);const i=this.a,n=this.b,r=this.c;let s,o;yr.subVectors(n,i),_r.subVectors(r,i),wr.subVectors(e,i);const a=yr.dot(wr),l=_r.dot(wr);if(a<=0&&l<=0)return t.copy(i);br.subVectors(e,n);const c=yr.dot(br),h=_r.dot(br);if(c>=0&&h<=c)return t.copy(n);const u=a*h-c*l;if(u<=0&&a>=0&&c<=0)return s=a/(a-c),t.copy(i).addScaledVector(yr,s);Tr.subVectors(e,r);const d=yr.dot(Tr),m=_r.dot(Tr);if(m>=0&&d<=m)return t.copy(r);const p=d*l-a*m;if(p<=0&&l>=0&&m<=0)return o=l/(l-m),t.copy(i).addScaledVector(_r,o);const f=c*m-d*h;if(f<=0&&h-c>=0&&d-m>=0)return xr.subVectors(r,n),o=(h-c)/(h-c+(d-m)),t.copy(n).addScaledVector(xr,o);const g=1/(f+p+u);return s=p*g,o=u*g,t.copy(i).addScaledVector(yr,s).addScaledVector(_r,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Sr=0;class Er extends Fi{constructor(){super(),Object.defineProperty(this,"id",{value:Sr++}),this.uuid=ki(),this.name="",this.type="Material",this.fog=!0,this.blending=x,this.side=p,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=O,this.blendDst=F,this.blendEquation=S,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=H,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ti,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ci,this.stencilZFail=ci,this.stencilZPass=ci,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===v;continue}const n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==x&&(i.blending=this.blending),this.side!==p&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const t=n(e.textures),r=n(e.images);t.length>0&&(i.textures=t),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const e=t.length;i=new Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}Er.prototype.isMaterial=!0;const Ar={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Cr={h:0,s:0,l:0},Pr={h:0,s:0,l:0};function Lr(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function Rr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Dr(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Ir{constructor(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=Gi(e,1),t=zi(t,0,1),i=zi(i,0,1),0===t)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+t):i+t-i*t,r=2*i-n;this.r=Lr(r,n,e+1/3),this.g=Lr(r,n,e),this.b=Lr(r,n,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const n=i[1],r=i[2];switch(n){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const i=parseFloat(e[1])/360,n=parseInt(e[2],10)/100,r=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(i,n,r)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Ar[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Rr(e.r),this.g=Rr(e.g),this.b=Rr(e.b),this}copyLinearToSRGB(e){return this.r=Dr(e.r),this.g=Dr(e.g),this.b=Dr(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,i=this.g,n=this.b,r=Math.max(t,i,n),s=Math.min(t,i,n);let o,a;const l=(s+r)/2;if(s===r)o=0,a=0;else{const e=r-s;switch(a=l<=.5?e/(r+s):e/(2-r-s),r){case t:o=(i-n)/e+(i<n?6:0);break;case i:o=(n-t)/e+2;break;case n:o=(t-i)/e+4}o/=6}return e.h=o,e.s=a,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,i){return this.getHSL(Cr),Cr.h+=e,Cr.s+=t,Cr.l+=i,this.setHSL(Cr.h,Cr.s,Cr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Cr),e.getHSL(Pr);const i=ji(Cr.h,Pr.h,t),n=ji(Cr.s,Pr.s,t),r=ji(Cr.l,Pr.l,t);return this.setHSL(i,n,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Ir.NAMES=Ar,Ir.prototype.isColor=!0,Ir.prototype.r=1,Ir.prototype.g=1,Ir.prototype.b=1;class Or extends Er{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Ir(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this}}Or.prototype.isMeshBasicMaterial=!0;const Fr=new an,Vr=new Zi;class Ur{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=Mi,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new Ir),t[i++]=r.r,t[i++]=r.g,t[i++]=r.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new Zi),t[i++]=r.x,t[i++]=r.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new an),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new tn),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z,t[i++]=r.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)Vr.fromBufferAttribute(this,t),Vr.applyMatrix3(e),this.setXY(t,Vr.x,Vr.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)Fr.fromBufferAttribute(this,t),Fr.applyMatrix3(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Fr.x=this.getX(t),Fr.y=this.getY(t),Fr.z=this.getZ(t),Fr.applyMatrix4(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Fr.x=this.getX(t),Fr.y=this.getY(t),Fr.z=this.getZ(t),Fr.applyNormalMatrix(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Fr.x=this.getX(t),Fr.y=this.getY(t),Fr.z=this.getZ(t),Fr.transformDirection(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Mi&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}Ur.prototype.isBufferAttribute=!0;class Br extends Ur{constructor(e,t,i){super(new Int8Array(e),t,i)}}class Nr extends Ur{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class kr extends Ur{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class zr extends Ur{constructor(e,t,i){super(new Int16Array(e),t,i)}}class Gr extends Ur{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class jr extends Ur{constructor(e,t,i){super(new Int32Array(e),t,i)}}class Hr extends Ur{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Wr extends Ur{constructor(e,t,i){super(new Uint16Array(e),t,i)}}Wr.prototype.isFloat16BufferAttribute=!0;class qr extends Ur{constructor(e,t,i){super(new Float32Array(e),t,i)}}class Xr extends Ur{constructor(e,t,i){super(new Float64Array(e),t,i)}}function Zr(e){if(0===e.length)return-1/0;let t=e[0];for(let i=1,n=e.length;i<n;++i)e[i]>t&&(t=e[i]);return t}const Yr={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Kr(e,t){return new Yr[e](t)}let $r=0;const Jr=new Bn,Qr=new cr,es=new an,ts=new hn,is=new hn,ns=new an;class rs extends Fi{constructor(){super(),Object.defineProperty(this,"id",{value:$r++}),this.uuid=ki(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Zr(e)>65535?Hr:Gr)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const t=(new Yi).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Jr.makeRotationFromQuaternion(e),this.applyMatrix4(Jr),this}rotateX(e){return Jr.makeRotationX(e),this.applyMatrix4(Jr),this}rotateY(e){return Jr.makeRotationY(e),this.applyMatrix4(Jr),this}rotateZ(e){return Jr.makeRotationZ(e),this.applyMatrix4(Jr),this}translate(e,t,i){return Jr.makeTranslation(e,t,i),this.applyMatrix4(Jr),this}scale(e,t,i){return Jr.makeScale(e,t,i),this.applyMatrix4(Jr),this}lookAt(e){return Qr.lookAt(e),Qr.updateMatrix(),this.applyMatrix4(Qr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(es).negate(),this.translate(es.x,es.y,es.z),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new qr(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new hn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new an(-1/0,-1/0,-1/0),new an(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];ts.setFromBufferAttribute(i),this.morphTargetsRelative?(ns.addVectors(this.boundingBox.min,ts.min),this.boundingBox.expandByPoint(ns),ns.addVectors(this.boundingBox.max,ts.max),this.boundingBox.expandByPoint(ns)):(this.boundingBox.expandByPoint(ts.min),this.boundingBox.expandByPoint(ts.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Pn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new an,1/0);if(e){const i=this.boundingSphere.center;if(ts.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];is.setFromBufferAttribute(i),this.morphTargetsRelative?(ns.addVectors(ts.min,is.min),ts.expandByPoint(ns),ns.addVectors(ts.max,is.max),ts.expandByPoint(ns)):(ts.expandByPoint(is.min),ts.expandByPoint(is.max))}ts.getCenter(i);let n=0;for(let t=0,r=e.count;t<r;t++)ns.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(ns));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],o=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)ns.fromBufferAttribute(s,t),o&&(es.fromBufferAttribute(e,t),ns.add(es)),n=Math.max(n,i.distanceToSquared(ns))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,n=t.position.array,r=t.normal.array,s=t.uv.array,o=n.length/3;void 0===t.tangent&&this.setAttribute("tangent",new Ur(new Float32Array(4*o),4));const a=t.tangent.array,l=[],c=[];for(let e=0;e<o;e++)l[e]=new an,c[e]=new an;const h=new an,u=new an,d=new an,m=new Zi,p=new Zi,f=new Zi,g=new an,v=new an;function y(e,t,i){h.fromArray(n,3*e),u.fromArray(n,3*t),d.fromArray(n,3*i),m.fromArray(s,2*e),p.fromArray(s,2*t),f.fromArray(s,2*i),u.sub(h),d.sub(h),p.sub(m),f.sub(m);const r=1/(p.x*f.y-f.x*p.y);isFinite(r)&&(g.copy(u).multiplyScalar(f.y).addScaledVector(d,-p.y).multiplyScalar(r),v.copy(d).multiplyScalar(p.x).addScaledVector(u,-f.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[i].add(g),c[e].add(v),c[t].add(v),c[i].add(v))}let _=this.groups;0===_.length&&(_=[{start:0,count:i.length}]);for(let e=0,t=_.length;e<t;++e){const t=_[e],n=t.start;for(let e=n,r=n+t.count;e<r;e+=3)y(i[e+0],i[e+1],i[e+2])}const x=new an,w=new an,b=new an,T=new an;function M(e){b.fromArray(r,3*e),T.copy(b);const t=l[e];x.copy(t),x.sub(b.multiplyScalar(b.dot(t))).normalize(),w.crossVectors(T,t);const i=w.dot(c[e])<0?-1:1;a[4*e]=x.x,a[4*e+1]=x.y,a[4*e+2]=x.z,a[4*e+3]=i}for(let e=0,t=_.length;e<t;++e){const t=_[e],n=t.start;for(let e=n,r=n+t.count;e<r;e+=3)M(i[e+0]),M(i[e+1]),M(i[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new Ur(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);const n=new an,r=new an,s=new an,o=new an,a=new an,l=new an,c=new an,h=new an;if(e)for(let u=0,d=e.count;u<d;u+=3){const d=e.getX(u+0),m=e.getX(u+1),p=e.getX(u+2);n.fromBufferAttribute(t,d),r.fromBufferAttribute(t,m),s.fromBufferAttribute(t,p),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),o.fromBufferAttribute(i,d),a.fromBufferAttribute(i,m),l.fromBufferAttribute(i,p),o.add(c),a.add(c),l.add(c),i.setXYZ(d,o.x,o.y,o.z),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,o=t.count;e<o;e+=3)n.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===e.attributes[n])continue;const r=i[n].array,s=e.attributes[n],o=s.array,a=s.itemSize*t,l=Math.min(o.length,r.length-a);for(let e=0,t=a;e<l;e++,t++)r[t]=o[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)ns.fromBufferAttribute(e,t),ns.normalize(),e.setXYZ(t,ns.x,ns.y,ns.z)}toNonIndexed(){function e(e,t){const i=e.array,n=e.itemSize,r=e.normalized,s=new i.constructor(t.length*n);let o=0,a=0;for(let e=0,r=t.length;e<r;e++){o=t[e]*n;for(let e=0;e<n;e++)s[a++]=i[o++]}return new Ur(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new rs,i=this.index.array,n=this.attributes;for(const r in n){const s=e(n[r],i);t.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],o=r[n];for(let t=0,n=o.length;t<n;t++){const n=e(o[t],i);s.push(n)}t.morphAttributes[n]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,i=s.length;e<i;e++){const i=s[e];t.addGroup(i.start,i.count,i.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const t in i){const n=i[t];e.data.attributes[t]=n.toJSON(e.data)}const n={};let r=!1;for(const t in this.morphAttributes){const i=this.morphAttributes[t],s=[];for(let t=0,n=i.length;t<n;t++){const n=i[t];s.push(n.toJSON(e.data))}s.length>0&&(n[t]=s,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new rs).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const n=e.attributes;for(const e in n){const i=n[e];this.setAttribute(e,i.clone(t))}const r=e.morphAttributes;for(const e in r){const i=[],n=r[e];for(let e=0,r=n.length;e<r;e++)i.push(n[e].clone(t));this.morphAttributes[e]=i}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}rs.prototype.isBufferGeometry=!0;const ss=new Bn,os=new Un,as=new Pn,ls=new an,cs=new an,hs=new an,us=new an,ds=new an,ms=new an,ps=new an,fs=new an,gs=new an,vs=new Zi,ys=new Zi,_s=new Zi,xs=new an,ws=new an;class bs extends cr{constructor(e=new rs,t=new Or){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),as.copy(i.boundingSphere),as.applyMatrix4(r),!1===e.ray.intersectsSphere(as))return;if(ss.copy(r).invert(),os.copy(e.ray).applyMatrix4(ss),null!==i.boundingBox&&!1===os.intersectsBox(i.boundingBox))return;let s;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,h=i.attributes.uv2,u=i.groups,d=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,m=u.length;i<m;i++){const m=u[i],p=n[m.materialIndex];for(let i=Math.max(m.start,d.start),n=Math.min(m.start+m.count,d.start+d.count);i<n;i+=3){const n=r.getX(i),u=r.getX(i+1),d=r.getX(i+2);s=Ts(this,p,e,os,o,a,l,c,h,n,u,d),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else for(let i=Math.max(0,d.start),u=Math.min(r.count,d.start+d.count);i<u;i+=3){const u=r.getX(i),d=r.getX(i+1),m=r.getX(i+2);s=Ts(this,n,e,os,o,a,l,c,h,u,d,m),s&&(s.faceIndex=Math.floor(i/3),t.push(s))}else if(void 0!==o)if(Array.isArray(n))for(let i=0,r=u.length;i<r;i++){const r=u[i],m=n[r.materialIndex];for(let i=Math.max(r.start,d.start),n=Math.min(r.start+r.count,d.start+d.count);i<n;i+=3)s=Ts(this,m,e,os,o,a,l,c,h,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,t.push(s))}else for(let i=Math.max(0,d.start),r=Math.min(o.count,d.start+d.count);i<r;i+=3)s=Ts(this,n,e,os,o,a,l,c,h,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),t.push(s))}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Ts(e,t,i,n,r,s,o,a,l,c,h,u){ls.fromBufferAttribute(r,c),cs.fromBufferAttribute(r,h),hs.fromBufferAttribute(r,u);const d=e.morphTargetInfluences;if(t.morphTargets&&s&&d){ps.set(0,0,0),fs.set(0,0,0),gs.set(0,0,0);for(let e=0,t=s.length;e<t;e++){const t=d[e],i=s[e];0!==t&&(us.fromBufferAttribute(i,c),ds.fromBufferAttribute(i,h),ms.fromBufferAttribute(i,u),o?(ps.addScaledVector(us,t),fs.addScaledVector(ds,t),gs.addScaledVector(ms,t)):(ps.addScaledVector(us.sub(ls),t),fs.addScaledVector(ds.sub(cs),t),gs.addScaledVector(ms.sub(hs),t)))}ls.add(ps),cs.add(fs),hs.add(gs)}e.isSkinnedMesh&&(e.boneTransform(c,ls),e.boneTransform(h,cs),e.boneTransform(u,hs));const m=function(e,t,i,n,r,s,o,a){let l;if(l=t.side===f?n.intersectTriangle(o,s,r,!0,a):n.intersectTriangle(r,s,o,t.side!==g,a),null===l)return null;ws.copy(a),ws.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(ws);return c<i.near||c>i.far?null:{distance:c,point:ws.clone(),object:e}}(e,t,i,n,ls,cs,hs,xs);if(m){a&&(vs.fromBufferAttribute(a,c),ys.fromBufferAttribute(a,h),_s.fromBufferAttribute(a,u),m.uv=Mr.getUV(xs,ls,cs,hs,vs,ys,_s,new Zi)),l&&(vs.fromBufferAttribute(l,c),ys.fromBufferAttribute(l,h),_s.fromBufferAttribute(l,u),m.uv2=Mr.getUV(xs,ls,cs,hs,vs,ys,_s,new Zi));const e={a:c,b:h,c:u,normal:new an,materialIndex:0};Mr.getNormal(ls,cs,hs,e.normal),m.face=e}return m}bs.prototype.isMesh=!0;class Ms extends rs{constructor(e=1,t=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const o=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],c=[],h=[];let u=0,d=0;function m(e,t,i,n,r,s,m,p,f,g,v){const y=s/f,_=m/g,x=s/2,w=m/2,b=p/2,T=f+1,M=g+1;let S=0,E=0;const A=new an;for(let s=0;s<M;s++){const o=s*_-w;for(let a=0;a<T;a++){const u=a*y-x;A[e]=u*n,A[t]=o*r,A[i]=b,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[i]=p>0?1:-1,c.push(A.x,A.y,A.z),h.push(a/f),h.push(1-s/g),S+=1}}for(let e=0;e<g;e++)for(let t=0;t<f;t++){const i=u+t+T*e,n=u+t+T*(e+1),r=u+(t+1)+T*(e+1),s=u+(t+1)+T*e;a.push(i,n,s),a.push(n,r,s),E+=6}o.addGroup(d,E,v),d+=E,u+=S}m("z","y","x",-1,-1,i,t,e,s,r,0),m("z","y","x",1,-1,i,t,-e,s,r,1),m("x","z","y",1,1,e,i,t,n,s,2),m("x","z","y",1,-1,e,i,-t,n,s,3),m("x","y","z",1,-1,e,t,i,n,r,4),m("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(a),this.setAttribute("position",new qr(l,3)),this.setAttribute("normal",new qr(c,3)),this.setAttribute("uv",new qr(h,2))}}function Ss(e){const t={};for(const i in e){t[i]={};for(const n in e[i]){const r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}function Es(e){const t={};for(let i=0;i<e.length;i++){const n=Ss(e[i]);for(const e in n)t[e]=n[e]}return t}const As={clone:Ss,merge:Es};class Cs extends Er{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ss(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const e in this.extensions)!0===this.extensions[e]&&(i[e]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}Cs.prototype.isShaderMaterial=!0;class Ps extends cr{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Bn,this.projectionMatrix=new Bn,this.projectionMatrixInverse=new Bn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new an),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Ps.prototype.isCamera=!0;class Ls extends Ps{constructor(e=50,t=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Ni*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Bi*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Ni*Math.atan(Math.tan(.5*Bi*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Bi*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,o=s.fullHeight;r+=s.offsetX*n/e,t-=s.offsetY*i/o,n*=s.width/e,i*=s.height/o}const o=this.filmOffset;0!==o&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Ls.prototype.isPerspectiveCamera=!0;const Rs=90;class Ds extends cr{constructor(e,t,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new Ls(Rs,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new an(1,0,0)),this.add(n);const r=new Ls(Rs,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new an(-1,0,0)),this.add(r);const s=new Ls(Rs,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new an(0,1,0)),this.add(s);const o=new Ls(Rs,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new an(0,-1,0)),this.add(o);const a=new Ls(Rs,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new an(0,0,1)),this.add(a);const l=new Ls(Rs,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new an(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,s,o,a,l]=this.children,c=e.xr.enabled,h=e.getRenderTarget();e.xr.enabled=!1;const u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,o),e.setRenderTarget(i,4),e.render(t,a),i.texture.generateMipmaps=u,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(h),e.xr.enabled=c}}class Is extends Qi{constructor(e,t,i,n,r,s,o,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:se,i,n,r,s,o=void 0!==o?o:Ue,a,l,c),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Is.prototype.isCubeTexture=!0;class Os extends nn{constructor(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),super(e,e,t),t=t||{},this.texture=new Is(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:_e,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Be,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={tEquirect:{value:null}},n="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new Ms(5,5,5),o=new Cs({name:"CubemapFromEquirect",uniforms:Ss(i),vertexShader:n,fragmentShader:r,side:f,blending:_});o.uniforms.tEquirect.value=t;const a=new bs(s,o),l=t.minFilter;return t.minFilter===be&&(t.minFilter=_e),new Ds(1,10,this).update(e,a),t.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,i,n){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,i,n);e.setRenderTarget(r)}}Os.prototype.isWebGLCubeRenderTarget=!0;const Fs=new Pn,Vs=new an;class Us{constructor(e=new mr,t=new mr,i=new mr,n=new mr,r=new mr,s=new mr){this.planes=[e,t,i,n,r,s]}set(e,t,i,n,r,s){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(n),o[4].copy(r),o[5].copy(s),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,n=i[0],r=i[1],s=i[2],o=i[3],a=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],m=i[10],p=i[11],f=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(o-n,h-a,p-u,y-f).normalize(),t[1].setComponents(o+n,h+a,p+u,y+f).normalize(),t[2].setComponents(o+r,h+l,p+d,y+g).normalize(),t[3].setComponents(o-r,h-l,p-d,y-g).normalize(),t[4].setComponents(o-s,h-c,p-m,y-v).normalize(),t[5].setComponents(o+s,h+c,p+m,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Fs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Fs)}intersectsSprite(e){return Fs.center.set(0,0,0),Fs.radius=.7071067811865476,Fs.applyMatrix4(e.matrixWorld),this.intersectsSphere(Fs)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(Vs.x=n.normal.x>0?e.max.x:e.min.x,Vs.y=n.normal.y>0?e.max.y:e.min.y,Vs.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Vs)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Bs(){let e=null,t=!1,i=null,n=null;function r(t,s){i(t,s),n=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function Ns(e,t){const i=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const i=n.get(t);i&&(e.deleteBuffer(i.buffer),n.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=n.get(t);return void((!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=n.get(t);void 0===s?n.set(t,function(t,n){const r=t.array,s=t.usage,o=e.createBuffer();e.bindBuffer(n,o),e.bufferData(n,r,s),t.onUploadCallback();let a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?t.isFloat16BufferAttribute?i?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(a=5121),{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):s.version<t.version&&(function(t,n,r){const s=n.array,o=n.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,s):(i?e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,t,r),s.version=t.version)}}}class ks extends rs{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const r=e/2,s=t/2,o=Math.floor(i),a=Math.floor(n),l=o+1,c=a+1,h=e/o,u=t/a,d=[],m=[],p=[],f=[];for(let e=0;e<c;e++){const t=e*u-s;for(let i=0;i<l;i++){const n=i*h-r;m.push(n,-t,0),p.push(0,0,1),f.push(i/o),f.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<o;t++){const i=t+l*e,n=t+l*(e+1),r=t+1+l*(e+1),s=t+1+l*e;d.push(i,n,s),d.push(n,r,s)}this.setIndex(d),this.setAttribute("position",new qr(m,3)),this.setAttribute("normal",new qr(p,3)),this.setAttribute("uv",new qr(f,2))}}const zs={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), rawDiffuseColor, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), rawDiffuseColor, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSNMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition.xyz / vWorldPosition.w;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\tfloat ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );\n\tvec3 f0 = vec3( pow( ior - 1.0, 2.0 ) / pow( ior + 1.0, 2.0 ) );\n\tvec3 f90 = vec3( 1.0 );\n\tvec3 f_transmission = totalTransmission * getIBLVolumeRefraction(\n\t\tnormal, v, viewDir, roughnessFactor, diffuseColor.rgb, f0, f90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance);\n\tdiffuseColor.rgb = mix( diffuseColor.rgb, f_transmission, totalTransmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec4 vWorldPosition;\n\tvec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {\n\t\tvec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length(vec3(modelMatrix[0].xyz));\n\t\tmodelScale.y = length(vec3(modelMatrix[1].xyz));\n\t\tmodelScale.z = length(vec3(modelMatrix[2].xyz));\n\t\treturn normalize(refractionVector) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness(float roughness, float ior) {\n\t\treturn roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);\n\t}\n\tvec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {\n\t\tfloat framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);\n\t\treturn texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;\n\t}\n\tvec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {\n\t\tif (attenuationDistance == 0.0) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;\n\t\t\tvec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec3 getIBLVolumeRefraction(vec3 n, vec3 v, vec3 viewDir, float perceptualRoughness, vec3 baseColor, vec3 f0, vec3 f90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec3 attenuationColor, float attenuationDistance) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);\n\t\tvec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);\n\t\tfloat NdotV = saturate(dot(n, viewDir));\n\t\tvec2 brdf = integrateSpecularBRDF(NdotV, perceptualRoughness);\n\t\tvec3 specularColor = f0 * brdf.x + f90 * brdf.y;\n\t\treturn (1.0 - specularColor) * attenuatedColor * baseColor;\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform vec3 attenuationColor;\n\tuniform float attenuationDistance;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef USE_TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t\tfloat thicknessFactor = thickness;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\tvec3 rawDiffuseColor = diffuseColor.rgb;\n\t#include <transmission_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#ifdef USE_TRANSMISSION\n\tvarying vec4 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition;\n#endif\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Gs={common:{diffuse:{value:new Ir(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Yi},uv2Transform:{value:new Yi},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Zi(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ir(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ir(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Yi}},sprite:{diffuse:{value:new Ir(16777215)},opacity:{value:1},center:{value:new Zi(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Yi}}},js={basic:{uniforms:Es([Gs.common,Gs.specularmap,Gs.envmap,Gs.aomap,Gs.lightmap,Gs.fog]),vertexShader:zs.meshbasic_vert,fragmentShader:zs.meshbasic_frag},lambert:{uniforms:Es([Gs.common,Gs.specularmap,Gs.envmap,Gs.aomap,Gs.lightmap,Gs.emissivemap,Gs.fog,Gs.lights,{emissive:{value:new Ir(0)}}]),vertexShader:zs.meshlambert_vert,fragmentShader:zs.meshlambert_frag},phong:{uniforms:Es([Gs.common,Gs.specularmap,Gs.envmap,Gs.aomap,Gs.lightmap,Gs.emissivemap,Gs.bumpmap,Gs.normalmap,Gs.displacementmap,Gs.fog,Gs.lights,{emissive:{value:new Ir(0)},specular:{value:new Ir(1118481)},shininess:{value:30}}]),vertexShader:zs.meshphong_vert,fragmentShader:zs.meshphong_frag},standard:{uniforms:Es([Gs.common,Gs.envmap,Gs.aomap,Gs.lightmap,Gs.emissivemap,Gs.bumpmap,Gs.normalmap,Gs.displacementmap,Gs.roughnessmap,Gs.metalnessmap,Gs.fog,Gs.lights,{emissive:{value:new Ir(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:zs.meshphysical_vert,fragmentShader:zs.meshphysical_frag},toon:{uniforms:Es([Gs.common,Gs.aomap,Gs.lightmap,Gs.emissivemap,Gs.bumpmap,Gs.normalmap,Gs.displacementmap,Gs.gradientmap,Gs.fog,Gs.lights,{emissive:{value:new Ir(0)}}]),vertexShader:zs.meshtoon_vert,fragmentShader:zs.meshtoon_frag},matcap:{uniforms:Es([Gs.common,Gs.bumpmap,Gs.normalmap,Gs.displacementmap,Gs.fog,{matcap:{value:null}}]),vertexShader:zs.meshmatcap_vert,fragmentShader:zs.meshmatcap_frag},points:{uniforms:Es([Gs.points,Gs.fog]),vertexShader:zs.points_vert,fragmentShader:zs.points_frag},dashed:{uniforms:Es([Gs.common,Gs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:zs.linedashed_vert,fragmentShader:zs.linedashed_frag},depth:{uniforms:Es([Gs.common,Gs.displacementmap]),vertexShader:zs.depth_vert,fragmentShader:zs.depth_frag},normal:{uniforms:Es([Gs.common,Gs.bumpmap,Gs.normalmap,Gs.displacementmap,{opacity:{value:1}}]),vertexShader:zs.normal_vert,fragmentShader:zs.normal_frag},sprite:{uniforms:Es([Gs.sprite,Gs.fog]),vertexShader:zs.sprite_vert,fragmentShader:zs.sprite_frag},background:{uniforms:{uvTransform:{value:new Yi},t2D:{value:null}},vertexShader:zs.background_vert,fragmentShader:zs.background_frag},cube:{uniforms:Es([Gs.envmap,{opacity:{value:1}}]),vertexShader:zs.cube_vert,fragmentShader:zs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:zs.equirect_vert,fragmentShader:zs.equirect_frag},distanceRGBA:{uniforms:Es([Gs.common,Gs.displacementmap,{referencePosition:{value:new an},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:zs.distanceRGBA_vert,fragmentShader:zs.distanceRGBA_frag},shadow:{uniforms:Es([Gs.lights,Gs.fog,{color:{value:new Ir(0)},opacity:{value:1}}]),vertexShader:zs.shadow_vert,fragmentShader:zs.shadow_frag}};function Hs(e,t,i,n,r){const s=new Ir(0);let o,a,l=0,c=null,h=0,u=null;function d(e,t){i.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return s},setClearColor:function(e,t=1){s.set(e),l=t,d(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,d(s,l)},render:function(i,r){let m=!1,g=!0===r.isScene?r.background:null;g&&g.isTexture&&(g=t.get(g));const v=e.xr,y=v.getSession&&v.getSession();y&&"additive"===y.environmentBlendMode&&(g=null),null===g?d(s,l):g&&g.isColor&&(d(g,1),m=!0),(e.autoClear||m)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.mapping===ce)?(void 0===a&&(a=new bs(new Ms(1,1,1),new Cs({name:"BackgroundCubeMaterial",uniforms:Ss(js.cube.uniforms),vertexShader:js.cube.vertexShader,fragmentShader:js.cube.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(a)),a.material.uniforms.envMap.value=g,a.material.uniforms.flipEnvMap.value=g.isCubeTexture&&g._needsFlipEnvMap?-1:1,c===g&&h===g.version&&u===e.toneMapping||(a.material.needsUpdate=!0,c=g,h=g.version,u=e.toneMapping),i.unshift(a,a.geometry,a.material,0,0,null)):g&&g.isTexture&&(void 0===o&&(o=new bs(new ks(2,2),new Cs({name:"BackgroundMaterial",uniforms:Ss(js.background.uniforms),vertexShader:js.background.vertexShader,fragmentShader:js.background.fragmentShader,side:p,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),o.material.uniforms.uvTransform.value.copy(g.matrix),c===g&&h===g.version&&u===e.toneMapping||(o.material.needsUpdate=!0,c=g,h=g.version,u=e.toneMapping),i.unshift(o,o.geometry,o.material,0,0,null))}}}function Ws(e,t,i,n){const r=e.getParameter(34921),s=n.isWebGL2?null:t.get("OES_vertex_array_object"),o=n.isWebGL2||null!==s,a={},l=d(null);let c=l;function h(t){return n.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function u(t){return n.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function d(e){const t=[],i=[],n=[];for(let e=0;e<r;e++)t[e]=0,i[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function m(){const e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function p(e){f(e,0)}function f(i,r){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;s[i]=1,0===o[i]&&(e.enableVertexAttribArray(i),o[i]=1),a[i]!==r&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),a[i]=r)}function g(){const t=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function v(t,i,r,s,o,a){!0!==n.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,i,r,s,o,a):e.vertexAttribIPointer(t,i,r,o,a)}function y(){_(),c!==l&&(c=l,h(c.object))}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,u,y,_){let x=!1;if(o){const t=function(t,i,r){const o=!0===r.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[o];return void 0===h&&(h=d(n.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),c[o]=h),h}(y,u,l);c!==t&&(c=t,h(c.object)),x=function(e,t){const i=c.attributes,n=e.attributes;let r=0;for(const e in n){const t=i[e],s=n[e];if(void 0===t)return!0;if(t.attribute!==s)return!0;if(t.data!==s.data)return!0;r++}return c.attributesNum!==r||c.index!==t}(y,_),x&&function(e,t){const i={},n=e.attributes;let r=0;for(const e in n){const t=n[e],s={};s.attribute=t,t.data&&(s.data=t.data),i[e]=s,r++}c.attributes=i,c.attributesNum=r,c.index=t}(y,_)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===u.id&&c.wireframe===e||(c.geometry=y.id,c.program=u.id,c.wireframe=e,x=!0)}!0===r.isInstancedMesh&&(x=!0),null!==_&&i.update(_,34963),x&&(function(r,s,o,a){if(!1===n.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;m();const l=a.attributes,c=o.getAttributes(),h=s.defaultAttributeValues;for(const t in c){const n=c[t];if(n>=0){const s=l[t];if(void 0!==s){const t=s.normalized,r=s.itemSize,o=i.get(s);if(void 0===o)continue;const l=o.buffer,c=o.type,h=o.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,o=i.stride,u=s.offset;i&&i.isInstancedInterleavedBuffer?(f(n,i.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)):p(n),e.bindBuffer(34962,l),v(n,r,c,t,o*h,u*h)}else s.isInstancedBufferAttribute?(f(n,s.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)):p(n),e.bindBuffer(34962,l),v(n,r,c,t,0,0)}else if("instanceMatrix"===t){const t=i.get(r.instanceMatrix);if(void 0===t)continue;const s=t.buffer,o=t.type;f(n+0,1),f(n+1,1),f(n+2,1),f(n+3,1),e.bindBuffer(34962,s),e.vertexAttribPointer(n+0,4,o,!1,64,0),e.vertexAttribPointer(n+1,4,o,!1,64,16),e.vertexAttribPointer(n+2,4,o,!1,64,32),e.vertexAttribPointer(n+3,4,o,!1,64,48)}else if("instanceColor"===t){const t=i.get(r.instanceColor);if(void 0===t)continue;const s=t.buffer,o=t.type;f(n,1),e.bindBuffer(34962,s),e.vertexAttribPointer(n,3,o,!1,12,0)}else if(void 0!==h){const i=h[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:e.vertexAttrib1fv(n,i)}}}}g()}(r,l,u,y),null!==_&&e.bindBuffer(34963,i.get(_).buffer))},reset:y,resetDefaultState:_,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const i=t[e];for(const e in i)u(i[e].object),delete i[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const i=t[e];for(const e in i)u(i[e].object),delete i[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const i=a[t];if(void 0===i[e.id])continue;const n=i[e.id];for(const e in n)u(n[e].object),delete n[e];delete i[e.id]}},initAttributes:m,enableAttribute:p,disableUnusedAttributes:g}}function qs(e,t,i,n){const r=n.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,n){e.drawArrays(s,t,n),i.update(n,s,1)},this.renderInstances=function(n,o,a){if(0===a)return;let l,c;if(r)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,n,o,a),i.update(o,s,a)}}function Xs(e,t,i){let n;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let o=void 0!==i.precision?i.precision:"highp";const a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||t.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=e.getParameter(34930),u=e.getParameter(35660),d=e.getParameter(3379),m=e.getParameter(34076),p=e.getParameter(34921),f=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),y=u>0,_=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){const i=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:m,maxAttributes:p,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:s?e.getParameter(36183):0}}function Zs(e){const t=this;let i=null,n=0,r=!1,s=!1;const o=new mr,a=new Yi,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function h(e,i,n,r){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const t=n+4*s,r=i.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,i=n;t!==s;++t,i+=4)o.copy(e[t]).applyMatrix4(r,a),o.normal.toArray(c,i),c[i+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,s){const o=0!==e.length||t||0!==n||r;return r=t,i=h(e,s,0),n=e.length,o},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1,c()},this.setState=function(t,o,a){const u=t.clippingPlanes,d=t.clipIntersection,m=t.clipShadows,p=e.get(t);if(!r||null===u||0===u.length||s&&!m)s?h(null):c();else{const e=s?0:n,t=4*e;let r=p.clippingState||null;l.value=r,r=h(u,o,t,a);for(let e=0;e!==t;++e)r[e]=i[e];p.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function Ys(e){let t=new WeakMap;function i(e,t){return t===ae?e.mapping=se:t===le&&(e.mapping=oe),e}function n(e){const i=e.target;i.removeEventListener("dispose",n);const r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping;if(s===ae||s===le){if(t.has(r))return i(t.get(r).texture,r.mapping);{const s=r.image;if(s&&s.height>0){const o=e.getRenderTarget(),a=new Os(s.height/2);return a.fromEquirectangularTexture(e,r),t.set(r,a),e.setRenderTarget(o),r.addEventListener("dispose",n),i(a.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}function Ks(e){const t={};function i(i){if(void 0!==t[i])return t[i];let n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float")},get:function(e){const t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function $s(e,t,i,n){const r={},s=new WeakMap;function o(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(t.remove(l),s.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(e){const i=[],n=e.index,r=e.attributes.position;let o=0;if(null!==n){const e=n.array;o=n.version;for(let t=0,n=e.length;t<n;t+=3){const n=e[t+0],r=e[t+1],s=e[t+2];i.push(n,r,r,s,s,n)}}else{const e=r.array;o=r.version;for(let t=0,n=e.length/3-1;t<n;t+=3){const e=t+0,n=t+1,r=t+2;i.push(e,n,n,r,r,e)}}const a=new(Zr(i)>65535?Hr:Gr)(i,1);a.version=o;const l=s.get(e);l&&t.remove(l),s.set(e,a)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,i.memory.geometries++),t},update:function(e){const i=e.attributes;for(const e in i)t.update(i[e],34962);const n=e.morphAttributes;for(const e in n){const i=n[e];for(let e=0,n=i.length;e<n;e++)t.update(i[e],34962)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const i=e.index;null!==i&&t.version<i.version&&a(e)}else a(e);return s.get(e)}}}function Js(e,t,i,n){const r=n.isWebGL2;let s,o,a;this.setMode=function(e){s=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,n){e.drawElements(s,n,o,t*a),i.update(n,s,1)},this.renderInstances=function(n,l,c){if(0===c)return;let h,u;if(r)h=e,u="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,o,n*a,c),i.update(l,s,c)}}function Qs(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,n){switch(t.calls++,i){case 4:t.triangles+=n*(e/3);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function eo(e,t){return e[0]-t[0]}function to(e,t){return Math.abs(t[1])-Math.abs(e[1])}function io(e){const t={},i=new Float32Array(8),n=[];for(let e=0;e<8;e++)n[e]=[e,0];return{update:function(r,s,o,a){const l=r.morphTargetInfluences,c=void 0===l?0:l.length;let h=t[s.id];if(void 0===h){h=[];for(let e=0;e<c;e++)h[e]=[e,0];t[s.id]=h}for(let e=0;e<c;e++){const t=h[e];t[0]=e,t[1]=l[e]}h.sort(to);for(let e=0;e<8;e++)e<c&&h[e][1]?(n[e][0]=h[e][0],n[e][1]=h[e][1]):(n[e][0]=Number.MAX_SAFE_INTEGER,n[e][1]=0);n.sort(eo);const u=o.morphTargets&&s.morphAttributes.position,d=o.morphNormals&&s.morphAttributes.normal;let m=0;for(let e=0;e<8;e++){const t=n[e],r=t[0],o=t[1];r!==Number.MAX_SAFE_INTEGER&&o?(u&&s.getAttribute("morphTarget"+e)!==u[r]&&s.setAttribute("morphTarget"+e,u[r]),d&&s.getAttribute("morphNormal"+e)!==d[r]&&s.setAttribute("morphNormal"+e,d[r]),i[e]=o,m+=o):(u&&!0===s.hasAttribute("morphTarget"+e)&&s.deleteAttribute("morphTarget"+e),d&&!0===s.hasAttribute("morphNormal"+e)&&s.deleteAttribute("morphNormal"+e),i[e]=0)}const p=s.morphTargetsRelative?1:1-m;a.getUniforms().setValue(e,"morphTargetBaseInfluence",p),a.getUniforms().setValue(e,"morphTargetInfluences",i)}}}function no(e,t,i,n){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){const o=n.render.frame,a=e.geometry,l=t.get(e,a);return r.get(l)!==o&&(t.update(l),r.set(l,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",s)&&e.addEventListener("dispose",s),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}js.physical={uniforms:Es([js.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Zi(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Ir(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Zi},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ir(0)}}]),vertexShader:zs.meshphysical_vert,fragmentShader:zs.meshphysical_frag};class ro extends Qi{constructor(e=null,t=1,i=1,n=1){super(null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=pe,this.minFilter=pe,this.wrapR=de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ro.prototype.isDataTexture2DArray=!0;class so extends Qi{constructor(e=null,t=1,i=1,n=1){super(null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=pe,this.minFilter=pe,this.wrapR=de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}so.prototype.isDataTexture3D=!0;const oo=new Qi,ao=new ro,lo=new so,co=new Is,ho=[],uo=[],mo=new Float32Array(16),po=new Float32Array(9),fo=new Float32Array(4);function go(e,t,i){const n=e[0];if(n<=0||n>0)return e;const r=t*i;let s=ho[r];if(void 0===s&&(s=new Float32Array(r),ho[r]=s),0!==t){n.toArray(s,0);for(let n=1,r=0;n!==t;++n)r+=i,e[n].toArray(s,r)}return s}function vo(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function yo(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function _o(e,t){let i=uo[t];void 0===i&&(i=new Int32Array(t),uo[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function xo(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function wo(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(vo(i,t))return;e.uniform2fv(this.addr,t),yo(i,t)}}function bo(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(vo(i,t))return;e.uniform3fv(this.addr,t),yo(i,t)}}function To(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(vo(i,t))return;e.uniform4fv(this.addr,t),yo(i,t)}}function Mo(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(vo(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),yo(i,t)}else{if(vo(i,n))return;fo.set(n),e.uniformMatrix2fv(this.addr,!1,fo),yo(i,n)}}function So(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(vo(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),yo(i,t)}else{if(vo(i,n))return;po.set(n),e.uniformMatrix3fv(this.addr,!1,po),yo(i,n)}}function Eo(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(vo(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),yo(i,t)}else{if(vo(i,n))return;mo.set(n),e.uniformMatrix4fv(this.addr,!1,mo),yo(i,n)}}function Ao(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function Co(e,t){const i=this.cache;vo(i,t)||(e.uniform2iv(this.addr,t),yo(i,t))}function Po(e,t){const i=this.cache;vo(i,t)||(e.uniform3iv(this.addr,t),yo(i,t))}function Lo(e,t){const i=this.cache;vo(i,t)||(e.uniform4iv(this.addr,t),yo(i,t))}function Ro(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function Do(e,t){const i=this.cache;vo(i,t)||(e.uniform2uiv(this.addr,t),yo(i,t))}function Io(e,t){const i=this.cache;vo(i,t)||(e.uniform3uiv(this.addr,t),yo(i,t))}function Oo(e,t){const i=this.cache;vo(i,t)||(e.uniform4uiv(this.addr,t),yo(i,t))}function Fo(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.safeSetTexture2D(t||oo,r)}function Vo(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||lo,r)}function Uo(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.safeSetTextureCube(t||co,r)}function Bo(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||ao,r)}function No(e,t){e.uniform1fv(this.addr,t)}function ko(e,t){const i=go(t,this.size,2);e.uniform2fv(this.addr,i)}function zo(e,t){const i=go(t,this.size,3);e.uniform3fv(this.addr,i)}function Go(e,t){const i=go(t,this.size,4);e.uniform4fv(this.addr,i)}function jo(e,t){const i=go(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function Ho(e,t){const i=go(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function Wo(e,t){const i=go(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function qo(e,t){e.uniform1iv(this.addr,t)}function Xo(e,t){e.uniform2iv(this.addr,t)}function Zo(e,t){e.uniform3iv(this.addr,t)}function Yo(e,t){e.uniform4iv(this.addr,t)}function Ko(e,t){e.uniform1uiv(this.addr,t)}function $o(e,t){e.uniform2uiv(this.addr,t)}function Jo(e,t){e.uniform3uiv(this.addr,t)}function Qo(e,t){e.uniform4uiv(this.addr,t)}function ea(e,t,i){const n=t.length,r=_o(i,n);e.uniform1iv(this.addr,r);for(let e=0;e!==n;++e)i.safeSetTexture2D(t[e]||oo,r[e])}function ta(e,t,i){const n=t.length,r=_o(i,n);e.uniform1iv(this.addr,r);for(let e=0;e!==n;++e)i.safeSetTextureCube(t[e]||co,r[e])}function ia(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return xo;case 35664:return wo;case 35665:return bo;case 35666:return To;case 35674:return Mo;case 35675:return So;case 35676:return Eo;case 5124:case 35670:return Ao;case 35667:case 35671:return Co;case 35668:case 35672:return Po;case 35669:case 35673:return Lo;case 5125:return Ro;case 36294:return Do;case 36295:return Io;case 36296:return Oo;case 35678:case 36198:case 36298:case 36306:case 35682:return Fo;case 35679:case 36299:case 36307:return Vo;case 35680:case 36300:case 36308:case 36293:return Uo;case 36289:case 36303:case 36311:case 36292:return Bo}}(t.type)}function na(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return No;case 35664:return ko;case 35665:return zo;case 35666:return Go;case 35674:return jo;case 35675:return Ho;case 35676:return Wo;case 5124:case 35670:return qo;case 35667:case 35671:return Xo;case 35668:case 35672:return Zo;case 35669:case 35673:return Yo;case 5125:return Ko;case 36294:return $o;case 36295:return Jo;case 36296:return Qo;case 35678:case 36198:case 36298:case 36306:case 35682:return ea;case 35680:case 36300:case 36308:case 36293:return ta}}(t.type)}function ra(e){this.id=e,this.seq=[],this.map={}}na.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),yo(t,e)},ra.prototype.setValue=function(e,t,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(e,t[s.id],i)}};const sa=/(\w+)(\])?(\[|\.)?/g;function oa(e,t){e.seq.push(t),e.map[t.id]=t}function aa(e,t,i){const n=e.name,r=n.length;for(sa.lastIndex=0;;){const s=sa.exec(n),o=sa.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===r){oa(i,void 0===c?new ia(a,e,t):new na(a,e,t));break}{let e=i.map[a];void 0===e&&(e=new ra(a),oa(i,e)),i=e}}}function la(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let n=0;n<i;++n){const i=e.getActiveUniform(t,n);aa(i,e.getUniformLocation(t,i.name),this)}}function ca(e,t,i){const n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}la.prototype.setValue=function(e,t,i,n){const r=this.map[t];void 0!==r&&r.setValue(e,i,n)},la.prototype.setOptional=function(e,t,i){const n=t[i];void 0!==n&&this.setValue(e,i,n)},la.upload=function(e,t,i,n){for(let r=0,s=t.length;r!==s;++r){const s=t[r],o=i[s.id];!1!==o.needsUpdate&&s.setValue(e,o.value,n)}},la.seqWithValue=function(e,t){const i=[];for(let n=0,r=e.length;n!==r;++n){const r=e[n];r.id in t&&i.push(r)}return i};let ha=0;function ua(e){switch(e){case Kt:return["Linear","( value )"];case $t:return["sRGB","( value )"];case Qt:return["RGBE","( value )"];case ti:return["RGBM","( value, 7.0 )"];case ii:return["RGBM","( value, 16.0 )"];case ni:return["RGBD","( value, 256.0 )"];case Jt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case ei:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function da(e,t,i){const n=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return n&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+r+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function ma(e,t){const i=ua(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function pa(e,t){const i=ua(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function fa(e,t){let i;switch(t){case Q:i="Linear";break;case ee:i="Reinhard";break;case te:i="OptimizedCineon";break;case ie:i="ACESFilmic";break;case ne:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function ga(e){return""!==e}function va(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ya(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const _a=/^[ \t]*#include +<([\w\d./]+)>/gm;function xa(e){return e.replace(_a,wa)}function wa(e,t){const i=zs[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return xa(i)}const ba=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Ta=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ma(e){return e.replace(Ta,Ea).replace(ba,Sa)}function Sa(e,t,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Ea(0,t,i,n)}function Ea(e,t,i,n){let r="";for(let e=parseInt(t);e<parseInt(i);e++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function Aa(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Ca(e,t,i,n){const r=e.getContext(),s=i.defines;let o=i.vertexShader,a=i.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===u?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===d?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===m&&(t="SHADOWMAP_TYPE_VSM"),t}(i),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case se:case oe:t="ENVMAP_TYPE_CUBE";break;case ce:case he:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),h=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case oe:case he:t="ENVMAP_MODE_REFRACTION"}return t}(i),p=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Y:t="ENVMAP_BLENDING_MULTIPLY";break;case K:t="ENVMAP_BLENDING_MIX";break;case $:t="ENVMAP_BLENDING_ADD"}return t}(i),f=e.gammaFactor>0?e.gammaFactor:1,g=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission>0)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ga).join("\n")}(i),v=function(e){const t=[];for(const i in e){const n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(s),y=r.createProgram();let _,x,w=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(_=[v].filter(ga).join("\n"),_.length>0&&(_+="\n"),x=[g,v].filter(ga).join("\n"),x.length>0&&(x+="\n")):(_=[Aa(i),"#define SHADER_NAME "+i.shaderName,v,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+f,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ga).join("\n"),x=[g,Aa(i),"#define SHADER_NAME "+i.shaderName,v,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==J?"#define TONE_MAPPING":"",i.toneMapping!==J?zs.tonemapping_pars_fragment:"",i.toneMapping!==J?fa("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",zs.encodings_pars_fragment,i.map?ma("mapTexelToLinear",i.mapEncoding):"",i.matcap?ma("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?ma("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?ma("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?ma("lightMapTexelToLinear",i.lightMapEncoding):"",pa("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(ga).join("\n")),o=xa(o),o=va(o,i),o=ya(o,i),a=xa(a),a=va(a,i),a=ya(a,i),o=Ma(o),a=Ma(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(w="#version 300 es\n",_=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+_,x=["#define varying in",i.glslVersion===Oi?"":"out highp vec4 pc_fragColor;",i.glslVersion===Oi?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+x);const b=w+x+a,T=ca(r,35633,w+_+o),M=ca(r,35632,b);if(r.attachShader(y,T),r.attachShader(y,M),void 0!==i.index0AttributeName?r.bindAttribLocation(y,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(y,0,"position"),r.linkProgram(y),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(y).trim(),t=r.getShaderInfoLog(T).trim(),i=r.getShaderInfoLog(M).trim();let n=!0,s=!0;if(!1===r.getProgramParameter(y,35714)){n=!1;const t=da(r,T,"vertex"),i=da(r,M,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(y,35715),"gl.getProgramInfoLog",e,t,i)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==i||(s=!1);s&&(this.diagnostics={runnable:n,programLog:e,vertexShader:{log:t,prefix:_},fragmentShader:{log:i,prefix:x}})}let S,E;return r.deleteShader(T),r.deleteShader(M),this.getUniforms=function(){return void 0===S&&(S=new la(r,y)),S},this.getAttributes=function(){return void 0===E&&(E=function(e,t){const i={},n=e.getProgramParameter(t,35721);for(let r=0;r<n;r++){const n=e.getActiveAttrib(t,r).name;i[n]=e.getAttribLocation(t,n)}return i}(r,y)),E},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(y),this.program=void 0},this.name=i.shaderName,this.id=ha++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=T,this.fragmentShader=M,this}function Pa(e,t,i,n,r,s){const o=[],a=n.isWebGL2,l=n.logarithmicDepthBuffer,c=n.floatVertexTextures,h=n.maxVertexUniforms,u=n.vertexTextures;let d=n.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function v(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=Kt,t}return{getParameters:function(r,o,p,y,_){const x=y.fog,w=r.isMeshStandardMaterial?y.environment:null,b=t.get(r.envMap||w),T=m[r.type],M=_.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(c)return 1024;{const e=h,i=Math.floor((e-20)/4),n=Math.min(i,t.length);return n<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+n+"."),0):n}}(_):0;let S,E;if(null!==r.precision&&(d=n.getMaxPrecision(r.precision),d!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",d,"instead.")),T){const e=js[T];S=e.vertexShader,E=e.fragmentShader}else S=r.vertexShader,E=r.fragmentShader;const A=e.getRenderTarget();return{isWebGL2:a,shaderID:T,shaderName:r.type,vertexShader:S,fragmentShader:E,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:d,instancing:!0===_.isInstancedMesh,instancingColor:!0===_.isInstancedMesh&&null!==_.instanceColor,supportsVertexTextures:u,outputEncoding:null!==A?v(A.texture):e.outputEncoding,map:!!r.map,mapEncoding:v(r.map),matcap:!!r.matcap,matcapEncoding:v(r.matcap),envMap:!!b,envMapMode:b&&b.mapping,envMapEncoding:v(b),envMapCubeUV:!!b&&(b.mapping===ce||b.mapping===he),lightMap:!!r.lightMap,lightMapEncoding:v(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:v(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===ai,tangentSpaceNormalMap:r.normalMapType===oi,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmission:!!r.transmission,transmissionMap:!!r.transmissionMap,thicknessMap:!!r.thicknessMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexAlphas:!0===r.vertexColors&&_.geometry&&_.geometry.attributes.color&&4===_.geometry.attributes.color.itemSize,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmission||r.transmissionMap||r.thicknessMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmission||r.transmissionMap||r.thicknessMap||!r.displacementMap),fog:!!x,useFog:r.fog,fogExp2:x&&x.isFogExp2,flatShading:!!r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:l,skinning:!0===_.isSkinnedMesh&&M>0,maxBones:M,useVertexTexture:c,morphTargets:r.morphTargets,morphNormals:r.morphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&p.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:J,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===g,flipSided:r.side===f,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||i.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(t){const i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)i.push(e),i.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<p.length;e++)i.push(t[p[e]]);i.push(e.outputEncoding),i.push(e.gammaFactor)}return i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){const t=m[e.type];let i;if(t){const e=js[t];i=As.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(t,i){let n;for(let e=0,t=o.length;e<t;e++){const t=o[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new Ca(e,i,t,r),o.push(n)),n},releaseProgram:function(e){if(0==--e.usedTimes){const t=o.indexOf(e);o[t]=o[o.length-1],o.pop(),e.destroy()}},programs:o}}function La(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function Ra(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Da(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ia(e){const t=[];let i=0;const n=[],r=[],s=[],o={id:-1};function a(n,r,s,a,l,c){let h=t[i];const u=e.get(s);return void 0===h?(h={id:n.id,object:n,geometry:r,material:s,program:u.program||o,groupOrder:a,renderOrder:n.renderOrder,z:l,group:c},t[i]=h):(h.id=n.id,h.object=n,h.geometry=r,h.material=s,h.program=u.program||o,h.groupOrder=a,h.renderOrder=n.renderOrder,h.z=l,h.group=c),i++,h}return{opaque:n,transmissive:r,transparent:s,init:function(){i=0,n.length=0,r.length=0,s.length=0},push:function(e,t,i,o,l,c){const h=a(e,t,i,o,l,c);i.transmission>0?r.push(h):!0===i.transparent?s.push(h):n.push(h)},unshift:function(e,t,i,o,l,c){const h=a(e,t,i,o,l,c);i.transmission>0?r.unshift(h):!0===i.transparent?s.unshift(h):n.unshift(h)},finish:function(){for(let e=i,n=t.length;e<n;e++){const i=t[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Ra),r.length>1&&r.sort(t||Da),s.length>1&&s.sort(t||Da)}}}function Oa(e){let t=new WeakMap;return{get:function(i,n){let r;return!1===t.has(i)?(r=new Ia(e),t.set(i,[r])):n>=t.get(i).length?(r=new Ia(e),t.get(i).push(r)):r=t.get(i)[n],r},dispose:function(){t=new WeakMap}}}function Fa(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new an,color:new Ir};break;case"SpotLight":i={position:new an,direction:new an,color:new Ir,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new an,color:new Ir,distance:0,decay:0};break;case"HemisphereLight":i={direction:new an,skyColor:new Ir,groundColor:new Ir};break;case"RectAreaLight":i={color:new Ir,position:new an,halfWidth:new an,halfHeight:new an}}return e[t.id]=i,i}}}let Va=0;function Ua(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Ba(e,t){const i=new Fa,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zi};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zi,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)r.probe.push(new an);const s=new an,o=new Bn,a=new Bn;return{setup:function(s){let o=0,a=0,l=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let c=0,h=0,u=0,d=0,m=0,p=0,f=0,g=0;s.sort(Ua);for(let e=0,t=s.length;e<t;e++){const t=s[e],v=t.color,y=t.intensity,_=t.distance,x=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=v.r*y,a+=v.g*y,l+=v.b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.directionalShadow[c]=i,r.directionalShadowMap[c]=x,r.directionalShadowMatrix[c]=t.shadow.matrix,p++}r.directional[c]=e,c++}else if(t.isSpotLight){const e=i.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(v).multiplyScalar(y),e.distance=_,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.spotShadow[u]=i,r.spotShadowMap[u]=x,r.spotShadowMatrix[u]=t.shadow.matrix,g++}r.spot[u]=e,u++}else if(t.isRectAreaLight){const e=i.get(t);e.color.copy(v).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[d]=e,d++}else if(t.isPointLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,r.pointShadow[h]=i,r.pointShadowMap[h]=x,r.pointShadowMatrix[h]=t.shadow.matrix,f++}r.point[h]=e,h++}else if(t.isHemisphereLight){const e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(y),e.groundColor.copy(t.groundColor).multiplyScalar(y),r.hemi[m]=e,m++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=Gs.LTC_FLOAT_1,r.rectAreaLTC2=Gs.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Gs.LTC_HALF_1,r.rectAreaLTC2=Gs.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=a,r.ambient[2]=l;const v=r.hash;v.directionalLength===c&&v.pointLength===h&&v.spotLength===u&&v.rectAreaLength===d&&v.hemiLength===m&&v.numDirectionalShadows===p&&v.numPointShadows===f&&v.numSpotShadows===g||(r.directional.length=c,r.spot.length=u,r.rectArea.length=d,r.point.length=h,r.hemi.length=m,r.directionalShadow.length=p,r.directionalShadowMap.length=p,r.pointShadow.length=f,r.pointShadowMap.length=f,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=p,r.pointShadowMatrix.length=f,r.spotShadowMatrix.length=g,v.directionalLength=c,v.pointLength=h,v.spotLength=u,v.rectAreaLength=d,v.hemiLength=m,v.numDirectionalShadows=p,v.numPointShadows=f,v.numSpotShadows=g,r.version=Va++)},setupView:function(e,t){let i=0,n=0,l=0,c=0,h=0;const u=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=r.directional[i];e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),i++}else if(d.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),a.identity(),o.copy(d.matrixWorld),o.premultiply(u),a.extractRotation(o),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const e=r.point[n];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const e=r.hemi[h];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(u),e.direction.normalize(),h++}}},state:r}}function Na(e,t){const i=new Ba(e,t),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(){i.setup(n)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function ka(e,t){let i=new WeakMap;return{get:function(n,r=0){let s;return!1===i.has(n)?(s=new Na(e,t),i.set(n,[s])):r>=i.get(n).length?(s=new Na(e,t),i.get(n).push(s)):s=i.get(n)[r],s},dispose:function(){i=new WeakMap}}}class za extends Er{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=ri,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}za.prototype.isMeshDepthMaterial=!0;class Ga extends Er{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new an,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}Ga.prototype.isMeshDistanceMaterial=!0;var ja="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",Ha="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function Wa(e,t,i){let n=new Us;const r=new Zi,s=new Zi,o=new tn,a=[],l=[],c={},h=i.maxTextureSize,d={0:f,1:p,2:g},v=new Cs({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Zi},radius:{value:4}},vertexShader:Ha,fragmentShader:ja}),y=v.clone();y.defines.HORIZONTAL_PASS=1;const x=new rs;x.setAttribute("position",new Ur(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new bs(x,v),b=this;function T(i,n){const r=t.update(w);v.uniforms.shadow_pass.value=i.map.texture,v.uniforms.resolution.value=i.mapSize,v.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,r,v,w,null),y.uniforms.shadow_pass.value=i.mapPass.texture,y.uniforms.resolution.value=i.mapSize,y.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,r,y,w,null)}function M(e){const t=e<<0;let i=a[t];return void 0===i&&(i=new za({depthPacking:si,morphTargets:e}),a[t]=i),i}function S(e){const t=e<<0;let i=l[t];return void 0===i&&(i=new Ga({morphTargets:e}),l[t]=i),i}function E(t,i,n,r,s,o,a){let l=null,h=M,u=t.customDepthMaterial;if(!0===r.isPointLight&&(h=S,u=t.customDistanceMaterial),void 0===u){let e=!1;!0===n.morphTargets&&(e=i.morphAttributes&&i.morphAttributes.position&&i.morphAttributes.position.length>0),l=h(e)}else l=u;if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){const e=l.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=l.clone(),i[t]=r),l=r}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=a===m?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=s,l.farDistance=o),l}function A(i,r,s,o,a){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===m)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=t.update(i),r=i.material;if(Array.isArray(r)){const t=n.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=r[c.materialIndex];if(h&&h.visible){const t=E(i,n,h,o,s.near,s.far,a);e.renderBufferDirect(s,null,n,t,i,c)}}}else if(r.visible){const t=E(i,n,r,o,s.near,s.far,a);e.renderBufferDirect(s,null,n,t,i,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)A(l[e],r,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=u,this.render=function(t,i,a){if(!1===b.enabled)return;if(!1===b.autoUpdate&&!1===b.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),d=e.state;d.setBlending(_),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=t.length;l<c;l++){const c=t[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const p=u.getFrameExtents();if(r.multiply(p),s.copy(u.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/p.x),r.x=s.x*p.x,u.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/p.y),r.y=s.y*p.y,u.mapSize.y=s.y)),null===u.map&&!u.isPointLightShadow&&this.type===m){const e={minFilter:_e,magFilter:_e,format:Be};u.map=new nn(r.x,r.y,e),u.map.texture.name=c.name+".shadowMap",u.mapPass=new nn(r.x,r.y,e),u.camera.updateProjectionMatrix()}if(null===u.map){const e={minFilter:pe,magFilter:pe,format:Be};u.map=new nn(r.x,r.y,e),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();const f=u.getViewportCount();for(let e=0;e<f;e++){const t=u.getViewport(e);o.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),d.viewport(o),u.updateMatrices(c,e),n=u.getFrustum(),A(i,a,u.camera,c,this.type)}u.isPointLightShadow||this.type!==m||T(u,a),u.needsUpdate=!1}b.needsUpdate=!1,e.setRenderTarget(l,c,u)}}function qa(e,t,i){const n=i.isWebGL2,r=new function(){let t=!1;const i=new tn;let n=null;const r=new tn(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,s,o,a){!0===a&&(t*=o,n*=o,s*=o),i.set(t,n,s,o),!1===r.equals(i)&&(e.clearColor(t,n,s,o),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},s=new function(){let t=!1,i=null,n=null,r=null;return{setTest:function(e){e?ye(2929):_e(2929)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case z:e.depthFunc(512);break;case G:e.depthFunc(519);break;case j:e.depthFunc(513);break;case H:e.depthFunc(515);break;case W:e.depthFunc(514);break;case q:e.depthFunc(518);break;case X:e.depthFunc(516);break;case Z:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,i=null,n=null,r=null}}},c=new function(){let t=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(e){t||(e?ye(2960):_e(2960))},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,o){n===t&&r===i&&s===o||(e.stencilFunc(t,i,o),n=t,r=i,s=o)},setOp:function(t,i,n){o===t&&a===i&&l===n||(e.stencilOp(t,i,n),o=t,a=i,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null}}};let h={},u=null,d={},m=null,p=!1,v=null,y=null,Y=null,K=null,$=null,J=null,Q=null,ee=!1,te=null,ie=null,ne=null,re=null,se=null;const oe=e.getParameter(35661);let ae=!1,le=0;const ce=e.getParameter(7938);-1!==ce.indexOf("WebGL")?(le=parseFloat(/^WebGL (\d)/.exec(ce)[1]),ae=le>=1):-1!==ce.indexOf("OpenGL ES")&&(le=parseFloat(/^OpenGL ES (\d)/.exec(ce)[1]),ae=le>=2);let he=null,ue={};const de=e.getParameter(3088),me=e.getParameter(2978),pe=(new tn).fromArray(de),fe=(new tn).fromArray(me);function ge(t,i,n){const r=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<n;t++)e.texImage2D(i+t,0,6408,1,1,0,6408,5121,r);return s}const ve={};function ye(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function _e(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}ve[3553]=ge(3553,3553,1),ve[34067]=ge(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),c.setClear(0),ye(2929),s.setFunc(H),Te(!1),Me(a),ye(2884),be(_);const xe={[S]:32774,[E]:32778,[A]:32779};if(n)xe[C]=32775,xe[P]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(xe[C]=e.MIN_EXT,xe[P]=e.MAX_EXT)}const we={[L]:0,[R]:1,[D]:768,[O]:770,[k]:776,[B]:774,[V]:772,[I]:769,[F]:771,[N]:775,[U]:773};function be(t,i,n,r,s,o,a,l){if(t!==_){if(!1===p&&(ye(3042),p=!0),t===M)s=s||i,o=o||n,a=a||r,i===y&&s===$||(e.blendEquationSeparate(xe[i],xe[s]),y=i,$=s),n===Y&&r===K&&o===J&&a===Q||(e.blendFuncSeparate(we[n],we[r],we[o],we[a]),Y=n,K=r,J=o,Q=a),v=t,ee=null;else if(t!==v||l!==ee){if(y===S&&$===S||(e.blendEquation(32774),y=S,$=S),l)switch(t){case x:e.blendFuncSeparate(1,771,1,771);break;case w:e.blendFunc(1,1);break;case b:e.blendFuncSeparate(0,0,769,771);break;case T:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case x:e.blendFuncSeparate(770,771,1,771);break;case w:e.blendFunc(770,1);break;case b:e.blendFunc(0,769);break;case T:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Y=null,K=null,J=null,Q=null,v=t,ee=l}}else!0===p&&(_e(3042),p=!1)}function Te(t){te!==t&&(t?e.frontFace(2304):e.frontFace(2305),te=t)}function Me(t){t!==o?(ye(2884),t!==ie&&(t===a?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):_e(2884),ie=t}function Se(t,i,n){t?(ye(32823),re===i&&se===n||(e.polygonOffset(i,n),re=i,se=n)):_e(32823)}function Ee(t){void 0===t&&(t=33984+oe-1),he!==t&&(e.activeTexture(t),he=t)}return{buffers:{color:r,depth:s,stencil:c},enable:ye,disable:_e,bindFramebuffer:function(t,i){return null===i&&null!==u&&(i=u),d[t]!==i&&(e.bindFramebuffer(t,i),d[t]=i,n&&(36009===t&&(d[36160]=i),36160===t&&(d[36009]=i)),!0)},bindXRFramebuffer:function(t){t!==u&&(e.bindFramebuffer(36160,t),u=t)},useProgram:function(t){return m!==t&&(e.useProgram(t),m=t,!0)},setBlending:be,setMaterial:function(e,t){e.side===g?_e(2884):ye(2884);let i=e.side===f;t&&(i=!i),Te(i),e.blending===x&&!1===e.transparent?be(_):be(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),r.setMask(e.colorWrite);const n=e.stencilWrite;c.setTest(n),n&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Se(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?ye(32926):_e(32926)},setFlipSided:Te,setCullFace:Me,setLineWidth:function(t){t!==ne&&(ae&&e.lineWidth(t),ne=t)},setPolygonOffset:Se,setScissorTest:function(e){e?ye(3089):_e(3089)},activeTexture:Ee,bindTexture:function(t,i){null===he&&Ee();let n=ue[he];void 0===n&&(n={type:void 0,texture:void 0},ue[he]=n),n.type===t&&n.texture===i||(e.bindTexture(t,i||ve[t]),n.type=t,n.texture=i)},unbindTexture:function(){const t=ue[he];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===pe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),pe.copy(t))},viewport:function(t){!1===fe.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),fe.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===n&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),h={},he=null,ue={},u=null,d={},m=null,p=!1,v=null,y=null,Y=null,K=null,$=null,J=null,Q=null,ee=!1,te=null,ie=null,ne=null,re=null,se=null,pe.set(0,0,e.canvas.width,e.canvas.height),fe.set(0,0,e.canvas.width,e.canvas.height),r.reset(),s.reset(),c.reset()}}}function Xa(e,t,i,n,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,h=r.maxTextureSize,u=r.maxSamples,d=new WeakMap;let m,p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function f(e,t){return p?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(e,t,i,n){let r=1;if((e.width>n||e.height>n)&&(r=n/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const n=t?qi:Math.floor,s=n(r*e.width),o=n(r*e.height);void 0===m&&(m=f(s,o));const a=i?f(s,o):m;return a.width=s,a.height=o,a.getContext("2d").drawImage(e,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+o+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return Hi(e.width)&&Hi(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==pe&&e.minFilter!==_e}function _(t,i,r,s){e.generateMipmap(t),n.get(i).__maxMipLevel=Math.log2(Math.max(r,s))}function x(i,n,r){if(!1===a)return n;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let s=n;return 6403===n&&(5126===r&&(s=33326),5131===r&&(s=33325),5121===r&&(s=33321)),6407===n&&(5126===r&&(s=34837),5131===r&&(s=34843),5121===r&&(s=32849)),6408===n&&(5126===r&&(s=34836),5131===r&&(s=34842),5121===r&&(s=32856)),33325!==s&&33326!==s&&34842!==s&&34836!==s||t.get("EXT_color_buffer_float"),s}function w(e){return e===pe||e===fe||e===ve?9728:9729}function b(t){const i=t.target;i.removeEventListener("dispose",b),function(t){const i=n.get(t);void 0!==i.__webglInit&&(e.deleteTexture(i.__webglTexture),n.remove(t))}(i),i.isVideoTexture&&d.delete(i),o.memory.textures--}function T(t){const i=t.target;i.removeEventListener("dispose",T),function(t){const i=t.texture,r=n.get(t),s=n.get(i);if(t){if(void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),o.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&e.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,r=i.length;t<r;t++){const r=n.get(i[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),o.memory.textures--),n.remove(i[t])}n.remove(i),n.remove(t)}}(i)}let M=0;function S(e,t){const r=n.get(e);if(e.isVideoTexture&&function(e){const t=o.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(e),e.version>0&&r.__version!==e.version){const i=e.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void R(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+t),i.bindTexture(3553,r.__webglTexture)}function E(t,r){const o=n.get(t);t.version>0&&o.__version!==t.version?function(t,n,r){if(6!==n.image.length)return;L(t,n),i.activeTexture(33984+r),i.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),e.pixelStorei(37443,0);const o=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),l=n.image[0]&&n.image[0].isDataTexture,h=[];for(let e=0;e<6;e++)h[e]=o||l?l?n.image[e].image:n.image[e]:g(n.image[e],!1,!0,c);const u=h[0],d=v(u)||a,m=s.convert(n.format),p=s.convert(n.type),f=x(n.internalFormat,m,p);let w;if(P(34067,n,d),o){for(let e=0;e<6;e++){w=h[e].mipmaps;for(let t=0;t<w.length;t++){const r=w[t];n.format!==Be&&n.format!==Ue?null!==m?i.compressedTexImage2D(34069+e,t,f,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+e,t,f,r.width,r.height,0,m,p,r.data)}}t.__maxMipLevel=w.length-1}else{w=n.mipmaps;for(let e=0;e<6;e++)if(l){i.texImage2D(34069+e,0,f,h[e].width,h[e].height,0,m,p,h[e].data);for(let t=0;t<w.length;t++){const n=w[t].image[e].image;i.texImage2D(34069+e,t+1,f,n.width,n.height,0,m,p,n.data)}}else{i.texImage2D(34069+e,0,f,m,p,h[e]);for(let t=0;t<w.length;t++){const n=w[t];i.texImage2D(34069+e,t+1,f,m,p,n.image[e])}}t.__maxMipLevel=w.length}y(n,d)&&_(34067,n,u.width,u.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}(o,t,r):(i.activeTexture(33984+r),i.bindTexture(34067,o.__webglTexture))}const A={[ue]:10497,[de]:33071,[me]:33648},C={[pe]:9728,[fe]:9984,[ve]:9986,[_e]:9729,[xe]:9985,[be]:9987};function P(i,s,o){if(o?(e.texParameteri(i,10242,A[s.wrapS]),e.texParameteri(i,10243,A[s.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,A[s.wrapR]),e.texParameteri(i,10240,C[s.magFilter]),e.texParameteri(i,10241,C[s.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),s.wrapS===de&&s.wrapT===de||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,w(s.magFilter)),e.texParameteri(i,10241,w(s.minFilter)),s.minFilter!==pe&&s.minFilter!==_e&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(s.type===Le&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&s.type===Re&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(e.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function L(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",b),t.__webglTexture=e.createTexture(),o.memory.textures++)}function R(t,n,r){let o=3553;n.isDataTexture2DArray&&(o=35866),n.isDataTexture3D&&(o=32879),L(t,n),i.activeTexture(33984+r),i.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),e.pixelStorei(37443,0);const l=function(e){return!a&&(e.wrapS!==de||e.wrapT!==de||e.minFilter!==pe&&e.minFilter!==_e)}(n)&&!1===v(n.image),c=g(n.image,l,!1,h),u=v(c)||a,d=s.convert(n.format);let m,p=s.convert(n.type),f=x(n.internalFormat,d,p);P(o,n,u);const w=n.mipmaps;if(n.isDepthTexture)f=6402,a?f=n.type===Le?36012:n.type===Pe?33190:n.type===Fe?35056:33189:n.type===Le&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===Ge&&6402===f&&n.type!==Ae&&n.type!==Pe&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Ae,p=s.convert(n.type)),n.format===je&&6402===f&&(f=34041,n.type!==Fe&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Fe,p=s.convert(n.type))),i.texImage2D(3553,0,f,c.width,c.height,0,d,p,null);else if(n.isDataTexture)if(w.length>0&&u){for(let e=0,t=w.length;e<t;e++)m=w[e],i.texImage2D(3553,e,f,m.width,m.height,0,d,p,m.data);n.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(3553,0,f,c.width,c.height,0,d,p,c.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(let e=0,t=w.length;e<t;e++)m=w[e],n.format!==Be&&n.format!==Ue?null!==d?i.compressedTexImage2D(3553,e,f,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,e,f,m.width,m.height,0,d,p,m.data);t.__maxMipLevel=w.length-1}else if(n.isDataTexture2DArray)i.texImage3D(35866,0,f,c.width,c.height,c.depth,0,d,p,c.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)i.texImage3D(32879,0,f,c.width,c.height,c.depth,0,d,p,c.data),t.__maxMipLevel=0;else if(w.length>0&&u){for(let e=0,t=w.length;e<t;e++)m=w[e],i.texImage2D(3553,e,f,d,p,m);n.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(3553,0,f,d,p,c),t.__maxMipLevel=0;y(n,u)&&_(o,n,c.width,c.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function D(t,r,o,a,l){const c=s.convert(o.format),h=s.convert(o.type),u=x(o.internalFormat,c,h);32879===l||35866===l?i.texImage3D(l,0,u,r.width,r.height,r.depth,0,c,h,null):i.texImage2D(l,0,u,r.width,r.height,0,c,h,null),i.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,l,n.get(o).__webglTexture,0),i.bindFramebuffer(36160,null)}function I(t,i,n){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n){const t=i.depthTexture;t&&t.isDepthTexture&&(t.type===Le?r=36012:t.type===Pe&&(r=33190));const n=O(i);e.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else e.renderbufferStorage(36161,r,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){if(n){const t=O(i);e.renderbufferStorageMultisample(36161,t,35056,i.width,i.height)}else e.renderbufferStorage(36161,34041,i.width,i.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,r=s.convert(t.format),o=s.convert(t.type),a=x(t.internalFormat,r,o);if(n){const t=O(i);e.renderbufferStorageMultisample(36161,t,a,i.width,i.height)}else e.renderbufferStorage(36161,a,i.width,i.height)}e.bindRenderbuffer(36161,null)}function O(e){return a&&e.isWebGLMultisampleRenderTarget?Math.min(u,e.samples):0}let F=!1,V=!1;this.allocateTextureUnit=function(){const e=M;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=S,this.setTexture2DArray=function(e,t){const r=n.get(e);e.version>0&&r.__version!==e.version?R(r,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){const r=n.get(e);e.version>0&&r.__version!==e.version?R(r,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(t){const l=t.texture,c=n.get(t),h=n.get(l);t.addEventListener("dispose",T),!0!==t.isWebGLMultipleRenderTargets&&(h.__webglTexture=e.createTexture(),h.__version=l.version,o.memory.textures++);const u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,m=!0===t.isWebGLMultisampleRenderTarget,p=l.isDataTexture3D||l.isDataTexture2DArray,f=v(t)||a;if(!a||l.format!==Ue||l.type!==Le&&l.type!==Re||(l.format=Be,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else if(c.__webglFramebuffer=e.createFramebuffer(),d)if(r.drawBuffers){const i=t.texture;for(let t=0,r=i.length;t<r;t++){const r=n.get(i[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(m)if(a){c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const n=s.convert(l.format),r=s.convert(l.type),o=x(l.internalFormat,n,r),a=O(t);e.renderbufferStorageMultisample(36161,a,o,t.width,t.height),i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),I(c.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){i.bindTexture(34067,h.__webglTexture),P(34067,l,f);for(let e=0;e<6;e++)D(c.__webglFramebuffer[e],t,l,36064,34069+e);y(l,f)&&_(34067,l,t.width,t.height),i.bindTexture(34067,null)}else if(d){const e=t.texture;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=n.get(s);i.bindTexture(3553,o.__webglTexture),P(3553,s,f),D(c.__webglFramebuffer,t,s,36064+r,3553),y(s,f)&&_(3553,s,t.width,t.height)}i.bindTexture(3553,null)}else{let e=3553;p&&(a?e=l.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),i.bindTexture(e,h.__webglTexture),P(e,l,f),D(c.__webglFramebuffer,t,l,36064,e),y(l,f)&&_(3553,l,t.width,t.height),i.bindTexture(3553,null)}t.depthBuffer&&function(t){const r=n.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),S(r.depthTexture,0);const s=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Ge)e.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==je)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=e.createRenderbuffer(),I(r.__webglDepthbuffer[n],t,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),I(r.__webglDepthbuffer,t,!1);i.bindFramebuffer(36160,null)}(t)},this.updateRenderTargetMipmap=function(e){const t=v(e)||a,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let s=0,o=r.length;s<o;s++){const o=r[s];if(y(o,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,r=n.get(o).__webglTexture;i.bindTexture(t,r),_(t,o,e.width,e.height),i.bindTexture(t,null)}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(a){const r=t.width,s=t.height;let o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024);const a=n.get(t);i.bindFramebuffer(36008,a.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,a.__webglFramebuffer),e.blitFramebuffer(0,0,r,s,0,0,r,s,o,9728),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,a.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),F=!0),e=e.texture),S(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===V&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),V=!0),e=e.texture),E(e,t)}}function Za(e,t,i){const n=i.isWebGL2;return{convert:function(e){let i;if(e===Me)return 5121;if(e===De)return 32819;if(e===Ie)return 32820;if(e===Oe)return 33635;if(e===Se)return 5120;if(e===Ee)return 5122;if(e===Ae)return 5123;if(e===Ce)return 5124;if(e===Pe)return 5125;if(e===Le)return 5126;if(e===Re)return n?5131:(i=t.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(e===Ve)return 6406;if(e===Ue)return 6407;if(e===Be)return 6408;if(e===Ne)return 6409;if(e===ke)return 6410;if(e===Ge)return 6402;if(e===je)return 34041;if(e===He)return 6403;if(e===We)return 36244;if(e===qe)return 33319;if(e===Xe)return 33320;if(e===Ze)return 36248;if(e===Ye)return 36249;if(e===Ke||e===$e||e===Je||e===Qe){if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(e===Ke)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===$e)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Je)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Qe)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===et||e===tt||e===it||e===nt){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(e===et)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===tt)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===it)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===nt)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===rt)return i=t.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===st||e===ot)&&(i=t.get("WEBGL_compressed_texture_etc"),null!==i)){if(e===st)return i.COMPRESSED_RGB8_ETC2;if(e===ot)return i.COMPRESSED_RGBA8_ETC2_EAC}return e===at||e===lt||e===ct||e===ht||e===ut||e===dt||e===mt||e===pt||e===ft||e===gt||e===vt||e===yt||e===_t||e===xt||e===bt||e===Tt||e===Mt||e===St||e===Et||e===At||e===Ct||e===Pt||e===Lt||e===Rt||e===Dt||e===It||e===Ot||e===Ft?(i=t.get("WEBGL_compressed_texture_astc"),null!==i?e:null):e===wt?(i=t.get("EXT_texture_compression_bptc"),null!==i?e:null):e===Fe?n?34042:(i=t.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Ya extends Ls{constructor(e=[]){super(),this.cameras=e}}Ya.prototype.isArrayCamera=!0;class Ka extends cr{constructor(){super(),this.type="Group"}}Ka.prototype.isGroup=!0;const $a={type:"move"};class Ja{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Ka,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ka,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new an,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new an),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Ka,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new an,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new an),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==o&&(n=t.getPose(e.targetRaySpace,i),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent($a))),l&&e.hand){s=!0;for(const n of e.hand.values()){const e=t.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const e=new Ka;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[n.jointName]=e,l.add(e)}const r=l.joints[n.jointName];null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=n.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class Qa extends Fi{constructor(e,t){super();const i=this,n=e.state;let r=null,s=1,o=null,a="local-floor",l=null;const c=[],h=new Map,u=new Ls;u.layers.enable(1),u.viewport=new tn;const d=new Ls;d.layers.enable(2),d.viewport=new tn;const m=[u,d],p=new Ya;p.layers.enable(1),p.layers.enable(2);let f=null,g=null;function v(e){const t=h.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function y(){h.forEach((function(e,t){e.disconnect(t)})),h.clear(),f=null,g=null,n.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),M.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function _(e){const t=r.inputSources;for(let e=0;e<c.length;e++)h.set(t[e],c[e]);for(let t=0;t<e.removed.length;t++){const i=e.removed[t],n=h.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),h.delete(i))}for(let t=0;t<e.added.length;t++){const i=e.added[t],n=h.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=c[e];return void 0===t&&(t=new Ja,c[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=c[e];return void 0===t&&(t=new Ja,c[e]=t),t.getGripSpace()},this.getHand=function(e){let t=c[e];return void 0===t&&(t=new Ja,c[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){s=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return r},this.setSession=async function(e){if(r=e,null!==r){r.addEventListener("select",v),r.addEventListener("selectstart",v),r.addEventListener("selectend",v),r.addEventListener("squeeze",v),r.addEventListener("squeezestart",v),r.addEventListener("squeezeend",v),r.addEventListener("end",y),r.addEventListener("inputsourceschange",_);const e=t.getContextAttributes();!0!==e.xrCompatible&&await t.makeXRCompatible();const n={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:s},l=new XRWebGLLayer(r,t,n);r.updateRenderState({baseLayer:l}),o=await r.requestReferenceSpace(a),M.setContext(r),M.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const x=new an,w=new an;function b(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;p.near=d.near=u.near=e.near,p.far=d.far=u.far=e.far,f===p.near&&g===p.far||(r.updateRenderState({depthNear:p.near,depthFar:p.far}),f=p.near,g=p.far);const t=e.parent,i=p.cameras;b(p,t);for(let e=0;e<i.length;e++)b(i[e],t);e.matrixWorld.copy(p.matrixWorld),e.matrix.copy(p.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const n=e.children;for(let e=0,t=n.length;e<t;e++)n[e].updateMatrixWorld(!0);2===i.length?function(e,t,i){x.setFromMatrixPosition(t.matrixWorld),w.setFromMatrixPosition(i.matrixWorld);const n=x.distanceTo(w),r=t.projectionMatrix.elements,s=i.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=o*h,m=o*u,p=n/(-h+u),f=p*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+p,v=a+p,y=d-f,_=m+(n-f),b=l*a/v*g,T=c*a/v*g;e.projectionMatrix.makePerspective(y,_,b,T,g,v)}(p,u,d):p.projectionMatrix.copy(u.projectionMatrix)},this.getCamera=function(){return p};let T=null;const M=new Bs;M.setAnimationLoop((function(e,t){if(l=t.getViewerPose(o),null!==l){const e=l.views,t=r.renderState.baseLayer;n.bindXRFramebuffer(t.framebuffer);let i=!1;e.length!==p.cameras.length&&(p.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const r=e[n],s=t.getViewport(r),o=m[n];o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===n&&p.matrix.copy(o.matrix),!0===i&&p.cameras.push(o)}}const i=r.inputSources;for(let e=0;e<c.length;e++){const n=c[e],r=i[e];n.update(r,t,o)}T&&T(e,t)})),this.setAnimationLoop=function(e){T=e},this.dispose=function(){}}}function el(e){function t(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map),i.alphaMap&&(t.alphaMap.value=i.alphaMap),i.specularMap&&(t.specularMap.value=i.specularMap);const n=e.get(i).envMap;if(n){t.envMap.value=n,t.flipEnvMap.value=n.isCubeTexture&&n._needsFlipEnvMap?-1:1,t.reflectivity.value=i.reflectivity,t.refractionRatio.value=i.refractionRatio;const r=e.get(n).__maxMipLevel;void 0!==r&&(t.maxMipLevel.value=r)}let r,s;i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap&&(r=i.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),i.aoMap?s=i.aoMap:i.lightMap&&(s=i.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),t.uv2Transform.value.copy(s.matrix))}function i(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap),i.bumpMap&&(t.bumpMap.value=i.bumpMap,t.bumpScale.value=i.bumpScale,i.side===f&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,t.normalScale.value.copy(i.normalScale),i.side===f&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias),e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,n,r,s,o){n.isMeshBasicMaterial?t(e,n):n.isMeshLambertMaterial?(t(e,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,n)):n.isMeshToonMaterial?(t(e,n),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshPhongMaterial?(t(e,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshStandardMaterial?(t(e,n),n.isMeshPhysicalMaterial?function(e,t,n){i(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===f&&e.clearcoatNormalScale.value.negate()),e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),t.transmission>0&&(e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)}(e,n,o):i(e,n)):n.isMeshMatcapMaterial?(t(e,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshDepthMaterial?(t(e,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshDistanceMaterial?(t(e,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,n)):n.isMeshNormalMaterial?(t(e,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,n)):n.isPointsMaterial?function(e,t,i,n){let r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*n,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,n,r,s):n.isSpriteMaterial?function(e,t){let i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,n):n.isShadowMaterial?(e.color.value.copy(n.color),e.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function tl(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),i=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let u=null,d=null;const m=[],p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Kt,this.physicallyCorrectLights=!1,this.toneMapping=J,this.toneMappingExposure=1;const f=this;let g=!1,v=0,y=0,_=null,x=-1,w=null;const b=new tn,T=new tn;let M=null,S=t.width,E=t.height,A=1,C=null,P=null;const L=new tn(0,0,S,E),R=new tn(0,0,S,E);let D=!1;const I=[],O=new Us;let F=!1,V=!1,U=null;const B=new Bn,N=new an,k={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function z(){return null===_?A:1}let G,j,H,W,q,X,Z,Y,K,$,Q,ee,te,ie,ne,re,se,oe,ae,le,ce,he,ue=i;function me(e,i){for(let n=0;n<e.length;n++){const r=e[n],s=t.getContext(r,i);if(null!==s)return s}return null}try{const e={alpha:n,depth:r,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if(t.addEventListener("webglcontextlost",ve,!1),t.addEventListener("webglcontextrestored",ye,!1),null===ue){const t=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&t.shift(),ue=me(t,e),null===ue)throw me(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ue.getShaderPrecisionFormat&&(ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function fe(){G=new Ks(ue),j=new Xs(ue,G,e),G.init(j),ce=new Za(ue,G,j),H=new qa(ue,G,j),I[0]=1029,W=new Qs(ue),q=new La,X=new Xa(ue,G,H,q,j,ce,W),Z=new Ys(f),Y=new Ns(ue,j),he=new Ws(ue,G,Y,j),K=new $s(ue,Y,W,he),$=new no(ue,K,Y,W),oe=new io(ue),ne=new Zs(q),Q=new Pa(f,Z,G,j,he,ne),ee=new el(q),te=new Oa(q),ie=new ka(G,j),se=new Hs(f,Z,H,$,a),re=new Wa(f,$,j),ae=new qs(ue,G,W,j),le=new Js(ue,G,W,j),W.programs=Q.programs,f.capabilities=j,f.extensions=G,f.properties=q,f.renderLists=te,f.shadowMap=re,f.state=H,f.info=W}fe();const ge=new Qa(f,ue);function ve(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function ye(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const e=W.autoReset,t=re.enabled,i=re.autoUpdate,n=re.needsUpdate,r=re.type;fe(),W.autoReset=e,re.enabled=t,re.autoUpdate=i,re.needsUpdate=n,re.type=r}function _e(e){const t=e.target;t.removeEventListener("dispose",_e),function(e){(function(e){const t=q.get(e).programs;void 0!==t&&t.forEach((function(e){Q.releaseProgram(e)}))})(e),q.remove(e)}(t)}this.xr=ge,this.getContext=function(){return ue},this.getContextAttributes=function(){return ue.getContextAttributes()},this.forceContextLoss=function(){const e=G.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=G.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return A},this.setPixelRatio=function(e){void 0!==e&&(A=e,this.setSize(S,E,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Zi),e.set(S,E)},this.setSize=function(e,i,n){ge.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(S=e,E=i,t.width=Math.floor(e*A),t.height=Math.floor(i*A),!1!==n&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Zi),e.set(S*A,E*A).floor()},this.setDrawingBufferSize=function(e,i,n){S=e,E=i,A=n,t.width=Math.floor(e*n),t.height=Math.floor(i*n),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new tn),e.copy(b)},this.getViewport=function(e){return e.copy(L)},this.setViewport=function(e,t,i,n){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,i,n),H.viewport(b.copy(L).multiplyScalar(A).floor())},this.getScissor=function(e){return e.copy(R)},this.setScissor=function(e,t,i,n){e.isVector4?R.set(e.x,e.y,e.z,e.w):R.set(e,t,i,n),H.scissor(T.copy(R).multiplyScalar(A).floor())},this.getScissorTest=function(){return D},this.setScissorTest=function(e){H.setScissorTest(D=e)},this.setOpaqueSort=function(e){C=e},this.setTransparentSort=function(e){P=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new Ir),e.copy(se.getClearColor())},this.setClearColor=function(){se.setClearColor.apply(se,arguments)},this.getClearAlpha=function(){return se.getClearAlpha()},this.setClearAlpha=function(){se.setClearAlpha.apply(se,arguments)},this.clear=function(e,t,i){let n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===i||i)&&(n|=1024),ue.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ve,!1),t.removeEventListener("webglcontextrestored",ye,!1),te.dispose(),ie.dispose(),q.dispose(),Z.dispose(),$.dispose(),he.dispose(),ge.dispose(),ge.removeEventListener("sessionstart",we),ge.removeEventListener("sessionend",Te),U&&(U.dispose(),U=null),Se.stop()},this.renderBufferImmediate=function(e,t){he.initAttributes();const i=q.get(e);e.hasPositions&&!i.position&&(i.position=ue.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=ue.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=ue.createBuffer()),e.hasColors&&!i.color&&(i.color=ue.createBuffer());const n=t.getAttributes();e.hasPositions&&(ue.bindBuffer(34962,i.position),ue.bufferData(34962,e.positionArray,35048),he.enableAttribute(n.position),ue.vertexAttribPointer(n.position,3,5126,!1,0,0)),e.hasNormals&&(ue.bindBuffer(34962,i.normal),ue.bufferData(34962,e.normalArray,35048),he.enableAttribute(n.normal),ue.vertexAttribPointer(n.normal,3,5126,!1,0,0)),e.hasUvs&&(ue.bindBuffer(34962,i.uv),ue.bufferData(34962,e.uvArray,35048),he.enableAttribute(n.uv),ue.vertexAttribPointer(n.uv,2,5126,!1,0,0)),e.hasColors&&(ue.bindBuffer(34962,i.color),ue.bufferData(34962,e.colorArray,35048),he.enableAttribute(n.color),ue.vertexAttribPointer(n.color,3,5126,!1,0,0)),he.disableUnusedAttributes(),ue.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,n,r,s){null===t&&(t=k);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=Ie(e,t,n,r);H.setMaterial(n,o);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,u=1;!0===n.wireframe&&(l=K.getWireframeAttribute(i),u=2),(n.morphTargets||n.morphNormals)&&oe.update(r,i,n,a),he.setup(r,n,a,i,l);let d=ae;null!==l&&(h=Y.get(l),d=le,d.setIndex(h));const m=null!==l?l.count:c.count,p=i.drawRange.start*u,f=i.drawRange.count*u,g=null!==s?s.start*u:0,v=null!==s?s.count*u:1/0,y=Math.max(p,g),_=Math.min(m,p+f,g+v)-1,x=Math.max(0,_-y+1);if(0!==x){if(r.isMesh)!0===n.wireframe?(H.setLineWidth(n.wireframeLinewidth*z()),d.setMode(1)):d.setMode(4);else if(r.isLine){let e=n.linewidth;void 0===e&&(e=1),H.setLineWidth(e*z()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(y,x,r.count);else if(i.isInstancedBufferGeometry){const e=Math.min(i.instanceCount,i._maxInstanceCount);d.renderInstances(y,x,e)}else d.render(y,x)}},this.compile=function(e,t){d=ie.get(e),d.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(),e.traverse((function(t){const i=t.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++)Pe(i[n],e,t);else Pe(i,e,t)}))};let xe=null;function we(){Se.stop()}function Te(){Se.start()}const Se=new Bs;function Ee(e,t,i,n){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||O.intersectsSprite(e)){n&&N.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B);const t=$.update(e),r=e.material;r.visible&&u.push(e,t,r,i,N.z,null)}}else if(e.isImmediateRenderObject)n&&N.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B),u.push(e,null,e.material,i,N.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==W.render.frame&&(e.skeleton.update(),e.skeleton.frame=W.render.frame),!e.frustumCulled||O.intersectsObject(e))){n&&N.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B);const t=$.update(e),r=e.material;if(Array.isArray(r)){const n=t.groups;for(let s=0,o=n.length;s<o;s++){const o=n[s],a=r[o.materialIndex];a&&a.visible&&u.push(e,t,a,i,N.z,o)}}else r.visible&&u.push(e,t,r,i,N.z,null)}const r=e.children;for(let e=0,s=r.length;e<s;e++)Ee(r[e],t,i,n)}function Ae(e,t,i){const n=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=s.object,a=s.geometry,l=null===n?s.material:n,c=s.group;if(i.isArrayCamera){const e=i.cameras;for(let i=0,n=e.length;i<n;i++){const n=e[i];o.layers.test(n.layers)&&(H.viewport(b.copy(n.viewport)),d.setupLightsView(n),Ce(o,t,n,a,l,c))}}else Ce(o,t,i,a,l,c)}}function Ce(e,t,i,n,r,s){if(e.onBeforeRender(f,t,i,n,r,s),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const n=Ie(i,t,r,e);H.setMaterial(r),he.reset(),function(e,t){e.render((function(e){f.renderBufferImmediate(e,t)}))}(e,n)}else f.renderBufferDirect(i,t,n,r,e,s);e.onAfterRender(f,t,i,n,r,s)}function Pe(e,t,i){!0!==t.isScene&&(t=k);const n=q.get(e),r=d.state.lights,s=d.state.shadowsArray,o=r.state.version,a=Q.getParameters(e,r.state,s,t,i),l=Q.getProgramCacheKey(a);let c=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=Z.get(e.envMap||n.environment),void 0===c&&(e.addEventListener("dispose",_e),c=new Map,n.programs=c);let h=c.get(l);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===o)return De(e,a),h}else a.uniforms=Q.getUniforms(e),e.onBuild(a,f),e.onBeforeCompile(a,f),h=Q.acquireProgram(a,l),c.set(l,h),n.uniforms=a.uniforms;const u=n.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(u.clippingPlanes=ne.uniform),De(e,a),n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=o,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const m=h.getUniforms(),p=la.seqWithValue(m.seq,u);return n.currentProgram=h,n.uniformsList=p,h}function De(e,t){const i=q.get(e);i.outputEncoding=t.outputEncoding,i.instancing=t.instancing,i.skinning=t.skinning,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas}function Ie(e,t,i,n){!0!==t.isScene&&(t=k),X.resetTextureUnits();const r=t.fog,s=i.isMeshStandardMaterial?t.environment:null,o=null===_?f.outputEncoding:_.texture.encoding,a=Z.get(i.envMap||s),l=!0===i.vertexColors&&n.geometry&&n.geometry.attributes.color&&4===n.geometry.attributes.color.itemSize,c=q.get(i),h=d.state.lights;if(!0===F&&(!0===V||e!==w)){const t=e===w&&i.id===x;ne.setState(i,e,t)}let u=!1;i.version===c.__version?c.needsLights&&c.lightsStateVersion!==h.state.version||c.outputEncoding!==o||n.isInstancedMesh&&!1===c.instancing?u=!0:n.isInstancedMesh||!0!==c.instancing?n.isSkinnedMesh&&!1===c.skinning?u=!0:n.isSkinnedMesh||!0!==c.skinning?c.envMap!==a||i.fog&&c.fog!==r?u=!0:void 0===c.numClippingPlanes||c.numClippingPlanes===ne.numPlanes&&c.numIntersection===ne.numIntersection?c.vertexAlphas!==l&&(u=!0):u=!0:u=!0:u=!0:(u=!0,c.__version=i.version);let m=c.currentProgram;!0===u&&(m=Pe(i,t,n));let p=!1,g=!1,v=!1;const y=m.getUniforms(),b=c.uniforms;if(H.useProgram(m.program)&&(p=!0,g=!0,v=!0),i.id!==x&&(x=i.id,g=!0),p||w!==e){if(y.setValue(ue,"projectionMatrix",e.projectionMatrix),j.logarithmicDepthBuffer&&y.setValue(ue,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),w!==e&&(w=e,g=!0,v=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=y.map.cameraPosition;void 0!==t&&t.setValue(ue,N.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&y.setValue(ue,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||n.isSkinnedMesh)&&y.setValue(ue,"viewMatrix",e.matrixWorldInverse)}if(n.isSkinnedMesh){y.setOptional(ue,n,"bindMatrix"),y.setOptional(ue,n,"bindMatrixInverse");const e=n.skeleton;e&&(j.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),y.setValue(ue,"boneTexture",e.boneTexture,X),y.setValue(ue,"boneTextureSize",e.boneTextureSize)):y.setOptional(ue,e,"boneMatrices"))}var T,M;return(g||c.receiveShadow!==n.receiveShadow)&&(c.receiveShadow=n.receiveShadow,y.setValue(ue,"receiveShadow",n.receiveShadow)),g&&(y.setValue(ue,"toneMappingExposure",f.toneMappingExposure),c.needsLights&&(M=v,(T=b).ambientLightColor.needsUpdate=M,T.lightProbe.needsUpdate=M,T.directionalLights.needsUpdate=M,T.directionalLightShadows.needsUpdate=M,T.pointLights.needsUpdate=M,T.pointLightShadows.needsUpdate=M,T.spotLights.needsUpdate=M,T.spotLightShadows.needsUpdate=M,T.rectAreaLights.needsUpdate=M,T.hemisphereLights.needsUpdate=M),r&&i.fog&&ee.refreshFogUniforms(b,r),ee.refreshMaterialUniforms(b,i,A,E,U),la.upload(ue,c.uniformsList,b,X)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(la.upload(ue,c.uniformsList,b,X),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&y.setValue(ue,"center",n.center),y.setValue(ue,"modelViewMatrix",n.modelViewMatrix),y.setValue(ue,"normalMatrix",n.normalMatrix),y.setValue(ue,"modelMatrix",n.matrixWorld),m}Se.setAnimationLoop((function(e){xe&&xe(e)})),"undefined"!=typeof window&&Se.setContext(window),this.setAnimationLoop=function(e){xe=e,ge.setAnimationLoop(e),null===e?Se.stop():Se.start()},ge.addEventListener("sessionstart",we),ge.addEventListener("sessionend",Te),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===ge.enabled&&!0===ge.isPresenting&&(!0===ge.cameraAutoUpdate&&ge.updateCamera(t),t=ge.getCamera()),!0===e.isScene&&e.onBeforeRender(f,e,t,_),d=ie.get(e,p.length),d.init(),p.push(d),B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),O.setFromProjectionMatrix(B),V=this.localClippingEnabled,F=ne.init(this.clippingPlanes,V,t),u=te.get(e,m.length),u.init(),m.push(u),Ee(e,t,0,f.sortObjects),u.finish(),!0===f.sortObjects&&u.sort(C,P),!0===F&&ne.beginShadows();const i=d.state.shadowsArray;re.render(i,e,t),d.setupLights(),d.setupLightsView(t),!0===F&&ne.endShadows(),!0===this.info.autoReset&&this.info.reset(),se.render(u,e);const n=u.opaque,r=u.transmissive,s=u.transparent;n.length>0&&Ae(n,e,t),r.length>0&&function(e,t,i,n){null===U&&(U=new nn(1024,1024,{generateMipmaps:!0,minFilter:be,magFilter:pe,wrapS:de,wrapT:de}));const r=f.getRenderTarget();f.setRenderTarget(U),f.clear(),Ae(e,i,n),X.updateRenderTargetMipmap(U),f.setRenderTarget(r),Ae(t,i,n)}(n,r,e,t),s.length>0&&Ae(s,e,t),null!==_&&(X.updateRenderTargetMipmap(_),X.updateMultisampleRenderTarget(_)),!0===e.isScene&&e.onAfterRender(f,e,t),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1),he.resetDefaultState(),x=-1,w=null,p.pop(),d=p.length>0?p[p.length-1]:null,m.pop(),u=m.length>0?m[m.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return _},this.setRenderTarget=function(e,t=0,i=0){_=e,v=t,y=i,e&&void 0===q.get(e).__webglFramebuffer&&X.setupRenderTarget(e);let n=null,r=!1,s=!1;if(e){const i=e.texture;(i.isDataTexture3D||i.isDataTexture2DArray)&&(s=!0);const o=q.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=o[t],r=!0):n=e.isWebGLMultisampleRenderTarget?q.get(e).__webglMultisampledFramebuffer:o,b.copy(e.viewport),T.copy(e.scissor),M=e.scissorTest}else b.copy(L).multiplyScalar(A).floor(),T.copy(R).multiplyScalar(A).floor(),M=D;if(H.bindFramebuffer(36160,n)&&j.drawBuffers){let t=!1;if(e)if(e.isWebGLMultipleRenderTargets){const i=e.texture;if(I.length!==i.length||36064!==I[0]){for(let e=0,t=i.length;e<t;e++)I[e]=36064+e;I.length=i.length,t=!0}}else 1===I.length&&36064===I[0]||(I[0]=36064,I.length=1,t=!0);else 1===I.length&&1029===I[0]||(I[0]=1029,I.length=1,t=!0);t&&(j.isWebGL2?ue.drawBuffers(I):G.get("WEBGL_draw_buffers").drawBuffersWEBGL(I))}if(H.viewport(b),H.scissor(T),H.setScissorTest(M),r){const n=q.get(e.texture);ue.framebufferTexture2D(36160,36064,34069+t,n.__webglTexture,i)}else if(s){const n=q.get(e.texture),r=t||0;ue.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}},this.readRenderTargetPixels=function(e,t,i,n,r,s,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=q.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){H.bindFramebuffer(36160,a);try{const o=e.texture,a=o.format,l=o.type;if(a!==Be&&ce.convert(a)!==ue.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Re&&(G.has("EXT_color_buffer_half_float")||j.isWebGL2&&G.has("EXT_color_buffer_float"));if(!(l===Me||ce.convert(l)===ue.getParameter(35738)||l===Le&&(j.isWebGL2||G.has("OES_texture_float")||G.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ue.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&i>=0&&i<=e.height-r&&ue.readPixels(t,i,n,r,ce.convert(a),ce.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==_?q.get(_).__webglFramebuffer:null;H.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,i=0){const n=Math.pow(2,-i),r=Math.floor(t.image.width*n),s=Math.floor(t.image.height*n);let o=ce.convert(t.format);j.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),X.setTexture2D(t,0),ue.copyTexImage2D(3553,i,o,e.x,e.y,r,s,0),H.unbindTexture()},this.copyTextureToTexture=function(e,t,i,n=0){const r=t.image.width,s=t.image.height,o=ce.convert(i.format),a=ce.convert(i.type);X.setTexture2D(i,0),ue.pixelStorei(37440,i.flipY),ue.pixelStorei(37441,i.premultiplyAlpha),ue.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?ue.texSubImage2D(3553,n,e.x,e.y,r,s,o,a,t.image.data):t.isCompressedTexture?ue.compressedTexSubImage2D(3553,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ue.texSubImage2D(3553,n,e.x,e.y,o,a,t.image),0===n&&i.generateMipmaps&&ue.generateMipmap(3553),H.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,n,r=0){if(f.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const{width:s,height:o,data:a}=i.image,l=ce.convert(n.format),c=ce.convert(n.type);let h;if(n.isDataTexture3D)X.setTexture3D(n,0),h=32879;else{if(!n.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");X.setTexture2DArray(n,0),h=35866}ue.pixelStorei(37440,n.flipY),ue.pixelStorei(37441,n.premultiplyAlpha),ue.pixelStorei(3317,n.unpackAlignment);const u=ue.getParameter(3314),d=ue.getParameter(32878),m=ue.getParameter(3316),p=ue.getParameter(3315),g=ue.getParameter(32877);ue.pixelStorei(3314,s),ue.pixelStorei(32878,o),ue.pixelStorei(3316,e.min.x),ue.pixelStorei(3315,e.min.y),ue.pixelStorei(32877,e.min.z),ue.texSubImage3D(h,r,t.x,t.y,t.z,e.max.x-e.min.x+1,e.max.y-e.min.y+1,e.max.z-e.min.z+1,l,c,a),ue.pixelStorei(3314,u),ue.pixelStorei(32878,d),ue.pixelStorei(3316,m),ue.pixelStorei(3315,p),ue.pixelStorei(32877,g),0===r&&n.generateMipmaps&&ue.generateMipmap(h),H.unbindTexture()},this.initTexture=function(e){X.setTexture2D(e,0),H.unbindTexture()},this.resetState=function(){v=0,y=0,_=null,H.reset(),he.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class il extends tl{}il.prototype.isWebGL1Renderer=!0;class nl{constructor(e,t=25e-5){this.name="",this.color=new Ir(e),this.density=t}clone(){return new nl(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}nl.prototype.isFogExp2=!0;class rl{constructor(e,t=1,i=1e3){this.name="",this.color=new Ir(e),this.near=t,this.far=i}clone(){return new rl(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}rl.prototype.isFog=!0;class sl extends cr{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}sl.prototype.isScene=!0;class ol{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Mi,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ki()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ki()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ki()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}ol.prototype.isInterleavedBuffer=!0;const al=new an;class ll{constructor(e,t,i,n){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)al.x=this.getX(t),al.y=this.getY(t),al.z=this.getZ(t),al.applyMatrix4(e),this.setXYZ(t,al.x,al.y,al.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)al.x=this.getX(t),al.y=this.getY(t),al.z=this.getZ(t),al.applyNormalMatrix(e),this.setXYZ(t,al.x,al.y,al.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)al.x=this.getX(t),al.y=this.getY(t),al.z=this.getZ(t),al.transformDirection(e),this.setXYZ(t,al.x,al.y,al.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new Ur(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ll(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}ll.prototype.isInterleavedBufferAttribute=!0;class cl extends Er{constructor(e){super(),this.type="SpriteMaterial",this.color=new Ir(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let hl;cl.prototype.isSpriteMaterial=!0;const ul=new an,dl=new an,ml=new an,pl=new Zi,fl=new Zi,gl=new Bn,vl=new an,yl=new an,_l=new an,xl=new Zi,wl=new Zi,bl=new Zi;class Tl extends cr{constructor(e){if(super(),this.type="Sprite",void 0===hl){hl=new rs;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new ol(e,5);hl.setIndex([0,1,2,0,2,3]),hl.setAttribute("position",new ll(t,3,0,!1)),hl.setAttribute("uv",new ll(t,2,3,!1))}this.geometry=hl,this.material=void 0!==e?e:new cl,this.center=new Zi(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),dl.setFromMatrixScale(this.matrixWorld),gl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ml.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&dl.multiplyScalar(-ml.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;Ml(vl.set(-.5,-.5,0),ml,s,dl,n,r),Ml(yl.set(.5,-.5,0),ml,s,dl,n,r),Ml(_l.set(.5,.5,0),ml,s,dl,n,r),xl.set(0,0),wl.set(1,0),bl.set(1,1);let o=e.ray.intersectTriangle(vl,yl,_l,!1,ul);if(null===o&&(Ml(yl.set(-.5,.5,0),ml,s,dl,n,r),wl.set(0,1),o=e.ray.intersectTriangle(vl,_l,yl,!1,ul),null===o))return;const a=e.ray.origin.distanceTo(ul);a<e.near||a>e.far||t.push({distance:a,point:ul.clone(),uv:Mr.getUV(ul,vl,yl,_l,xl,wl,bl,new Zi),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Ml(e,t,i,n,r,s){pl.subVectors(e,i).addScalar(.5).multiply(n),void 0!==r?(fl.x=s*pl.x-r*pl.y,fl.y=r*pl.x+s*pl.y):fl.copy(pl),e.copy(t),e.x+=fl.x,e.y+=fl.y,e.applyMatrix4(gl)}Tl.prototype.isSprite=!0;const Sl=new an,El=new an;class Al extends cr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,i=t.length;e<i;e++){const i=t[e];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const i=this.levels;let n;for(n=0;n<i.length&&!(t<i[n].distance);n++);return i.splice(n,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,n;for(i=1,n=t.length;i<n&&!(e<t[i].distance);i++);return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){Sl.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(Sl);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Sl.setFromMatrixPosition(e.matrixWorld),El.setFromMatrixPosition(this.matrixWorld);const i=Sl.distanceTo(El)/e.zoom;let n,r;for(t[0].object.visible=!0,n=1,r=t.length;n<r&&i>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let e=0,n=i.length;e<n;e++){const n=i[e];t.object.levels.push({object:n.object.uuid,distance:n.distance})}return t}}const Cl=new an,Pl=new tn,Ll=new tn,Rl=new an,Dl=new Bn;class Il extends bs{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Bn,this.bindMatrixInverse=new Bn}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new tn,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,n=this.geometry;Pl.fromBufferAttribute(n.attributes.skinIndex,e),Ll.fromBufferAttribute(n.attributes.skinWeight,e),Cl.fromBufferAttribute(n.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const n=Ll.getComponent(e);if(0!==n){const r=Pl.getComponent(e);Dl.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),t.addScaledVector(Rl.copy(Cl).applyMatrix4(Dl),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}Il.prototype.isSkinnedMesh=!0;class Ol extends cr{constructor(){super(),this.type="Bone"}}Ol.prototype.isBone=!0;class Fl extends Qi{constructor(e,t,i,n,r,s,o,a,l,c,h,u){super(null,s,o,a,l,c,n,r,h,u),this.image={data:e||null,width:t||1,height:i||1},this.magFilter=void 0!==l?l:pe,this.minFilter=void 0!==c?c:pe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Fl.prototype.isDataTexture=!0;const Vl=new Bn,Ul=new Bn;class Bl{constructor(e=[],t=[]){this.uuid=ki(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Bn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Bn;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=e.length;n<r;n++){const r=e[n]?e[n].matrixWorld:Ul;Vl.multiplyMatrices(r,t[n]),Vl.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new Bl(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=Wi(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Fl(t,e,e,Be,Le);return this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const n=e.bones[i];let r=t[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new Ol),this.bones.push(r),this.boneInverses.push((new Bn).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){const r=t[n];e.bones.push(r.uuid);const s=i[n];e.boneInverses.push(s.toArray())}return e}}const Nl=new Bn,kl=new Bn,zl=[],Gl=new bs;class jl extends bs{constructor(e,t,i){super(e,t),this.instanceMatrix=new Ur(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,n=this.count;if(Gl.geometry=this.geometry,Gl.material=this.material,void 0!==Gl.material)for(let r=0;r<n;r++){this.getMatrixAt(r,Nl),kl.multiplyMatrices(i,Nl),Gl.matrixWorld=kl,Gl.raycast(e,zl);for(let e=0,i=zl.length;e<i;e++){const i=zl[e];i.instanceId=r,i.object=this,t.push(i)}zl.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Ur(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}jl.prototype.isInstancedMesh=!0;class Hl extends Er{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Ir(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}Hl.prototype.isLineBasicMaterial=!0;const Wl=new an,ql=new an,Xl=new Bn,Zl=new Un,Yl=new Pn;class Kl extends cr{constructor(e=new rs,t=new Hl){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)Wl.fromBufferAttribute(t,e-1),ql.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=Wl.distanceTo(ql);e.setAttribute("lineDistance",new qr(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Yl.copy(i.boundingSphere),Yl.applyMatrix4(n),Yl.radius+=r,!1===e.ray.intersectsSphere(Yl))return;Xl.copy(n).invert(),Zl.copy(e.ray).applyMatrix4(Xl);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new an,c=new an,h=new an,u=new an,d=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n)for(let i=Math.max(0,s.start),o=Math.min(n.count,s.start+s.count)-1;i<o;i+=d){const s=n.getX(i),o=n.getX(i+1);if(l.fromBufferAttribute(r,s),c.fromBufferAttribute(r,o),Zl.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(u);d<e.near||d>e.far||t.push({distance:d,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}else for(let i=Math.max(0,s.start),n=Math.min(r.count,s.start+s.count)-1;i<n;i+=d){if(l.fromBufferAttribute(r,i),c.fromBufferAttribute(r,i+1),Zl.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const n=e.ray.origin.distanceTo(u);n<e.near||n>e.far||t.push({distance:n,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Kl.prototype.isLine=!0;const $l=new an,Jl=new an;class Ql extends Kl{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)$l.fromBufferAttribute(t,e),Jl.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+$l.distanceTo(Jl);e.setAttribute("lineDistance",new qr(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Ql.prototype.isLineSegments=!0;class ec extends Kl{constructor(e,t){super(e,t),this.type="LineLoop"}}ec.prototype.isLineLoop=!0;class tc extends Er{constructor(e){super(),this.type="PointsMaterial",this.color=new Ir(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}tc.prototype.isPointsMaterial=!0;const ic=new Bn,nc=new Un,rc=new Pn,sc=new an;class oc extends cr{constructor(e=new rs,t=new tc){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),rc.copy(i.boundingSphere),rc.applyMatrix4(n),rc.radius+=r,!1===e.ray.intersectsSphere(rc))return;ic.copy(n).invert(),nc.copy(e.ray).applyMatrix4(ic);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position;if(null!==r)for(let i=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);i<l;i++){const s=r.getX(i);sc.fromBufferAttribute(o,s),ac(sc,s,a,n,e,t,this)}else for(let i=Math.max(0,s.start),r=Math.min(o.count,s.start+s.count);i<r;i++)sc.fromBufferAttribute(o,i),ac(sc,i,a,n,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function ac(e,t,i,n,r,s,o){const a=nc.distanceSqToPoint(e);if(a<i){const i=new an;nc.closestPointToPoint(e,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:t,face:null,object:o})}}oc.prototype.isPoints=!0;class lc extends Qi{constructor(e,t,i,n,r,s,o,a,l){super(e,t,i,n,r,s,o,a,l),this.format=void 0!==o?o:Ue,this.minFilter=void 0!==s?s:_e,this.magFilter=void 0!==r?r:_e,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}lc.prototype.isVideoTexture=!0;class cc extends Qi{constructor(e,t,i,n,r,s,o,a,l,c,h,u){super(null,s,o,a,l,c,n,r,h,u),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}cc.prototype.isCompressedTexture=!0;class hc extends Qi{constructor(e,t,i,n,r,s,o,a,l){super(e,t,i,n,r,s,o,a,l),this.needsUpdate=!0}}hc.prototype.isCanvasTexture=!0;class uc extends Qi{constructor(e,t,i,n,r,s,o,a,l,c){if((c=void 0!==c?c:Ge)!==Ge&&c!==je)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Ge&&(i=Ae),void 0===i&&c===je&&(i=Fe),super(null,n,r,s,o,a,c,i,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:pe,this.minFilter=void 0!==a?a:pe,this.flipY=!1,this.generateMipmaps=!1}}uc.prototype.isDepthTexture=!0;class dc extends rs{constructor(e=1,t=8,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},t=Math.max(3,t);const r=[],s=[],o=[],a=[],l=new an,c=new Zi;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let r=0,h=3;r<=t;r++,h+=3){const u=i+r/t*n;l.x=e*Math.cos(u),l.y=e*Math.sin(u),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[h]/e+1)/2,c.y=(s[h+1]/e+1)/2,a.push(c.x,c.y)}for(let e=1;e<=t;e++)r.push(e,e+1,0);this.setIndex(r),this.setAttribute("position",new qr(s,3)),this.setAttribute("normal",new qr(o,3)),this.setAttribute("uv",new qr(a,2))}}class mc extends rs{constructor(e=1,t=1,i=1,n=8,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const l=this;n=Math.floor(n),r=Math.floor(r);const c=[],h=[],u=[],d=[];let m=0;const p=[],f=i/2;let g=0;function v(i){const r=m,s=new Zi,p=new an;let v=0;const y=!0===i?e:t,_=!0===i?1:-1;for(let e=1;e<=n;e++)h.push(0,f*_,0),u.push(0,_,0),d.push(.5,.5),m++;const x=m;for(let e=0;e<=n;e++){const t=e/n*a+o,i=Math.cos(t),r=Math.sin(t);p.x=y*r,p.y=f*_,p.z=y*i,h.push(p.x,p.y,p.z),u.push(0,_,0),s.x=.5*i+.5,s.y=.5*r*_+.5,d.push(s.x,s.y),m++}for(let e=0;e<n;e++){const t=r+e,n=x+e;!0===i?c.push(n,n+1,t):c.push(n+1,n,t),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}!function(){const s=new an,v=new an;let y=0;const _=(t-e)/i;for(let l=0;l<=r;l++){const c=[],g=l/r,y=g*(t-e)+e;for(let e=0;e<=n;e++){const t=e/n,r=t*a+o,l=Math.sin(r),p=Math.cos(r);v.x=y*l,v.y=-g*i+f,v.z=y*p,h.push(v.x,v.y,v.z),s.set(l,_,p).normalize(),u.push(s.x,s.y,s.z),d.push(t,1-g),c.push(m++)}p.push(c)}for(let e=0;e<n;e++)for(let t=0;t<r;t++){const i=p[t][e],n=p[t+1][e],r=p[t+1][e+1],s=p[t][e+1];c.push(i,n,s),c.push(n,r,s),y+=6}l.addGroup(g,y,0),g+=y}(),!1===s&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new qr(h,3)),this.setAttribute("normal",new qr(u,3)),this.setAttribute("uv",new qr(d,2))}}class pc extends mc{constructor(e=1,t=1,i=8,n=1,r=!1,s=0,o=2*Math.PI){super(0,e,t,i,n,r,s,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:o}}}class fc extends rs{constructor(e,t,i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};const r=[],s=[];function o(e,t,i,n){const r=n+1,s=[];for(let n=0;n<=r;n++){s[n]=[];const o=e.clone().lerp(i,n/r),a=t.clone().lerp(i,n/r),l=r-n;for(let e=0;e<=l;e++)s[n][e]=0===e&&n===r?o:o.clone().lerp(a,e/l)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){const i=Math.floor(t/2);t%2==0?(a(s[e][i+1]),a(s[e+1][i]),a(s[e][i])):(a(s[e][i+1]),a(s[e+1][i+1]),a(s[e+1][i]))}}function a(e){r.push(e.x,e.y,e.z)}function l(t,i){const n=3*t;i.x=e[n+0],i.y=e[n+1],i.z=e[n+2]}function c(e,t,i,n){n<0&&1===e.x&&(s[t]=e.x-1),0===i.x&&0===i.z&&(s[t]=n/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}!function(e){const i=new an,n=new an,r=new an;for(let s=0;s<t.length;s+=3)l(t[s+0],i),l(t[s+1],n),l(t[s+2],r),o(i,n,r,e)}(n),function(e){const t=new an;for(let i=0;i<r.length;i+=3)t.x=r[i+0],t.y=r[i+1],t.z=r[i+2],t.normalize().multiplyScalar(e),r[i+0]=t.x,r[i+1]=t.y,r[i+2]=t.z}(i),function(){const e=new an;for(let i=0;i<r.length;i+=3){e.x=r[i+0],e.y=r[i+1],e.z=r[i+2];const n=h(e)/2/Math.PI+.5,o=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);s.push(n,1-o)}var t;(function(){const e=new an,t=new an,i=new an,n=new an,o=new Zi,a=new Zi,l=new Zi;for(let u=0,d=0;u<r.length;u+=9,d+=6){e.set(r[u+0],r[u+1],r[u+2]),t.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),n.copy(e).add(t).add(i).divideScalar(3);const m=h(n);c(o,d+0,e,m),c(a,d+2,t,m),c(l,d+4,i,m)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],i=s[e+2],n=s[e+4],r=Math.max(t,i,n),o=Math.min(t,i,n);r>.9&&o<.1&&(t<.2&&(s[e+0]+=1),i<.2&&(s[e+2]+=1),n<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new qr(r,3)),this.setAttribute("normal",new qr(r.slice(),3)),this.setAttribute("uv",new qr(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}}class gc extends fc{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}}const vc=new an,yc=new an,_c=new an,xc=new Mr;class wc extends rs{constructor(e,t){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,!0===e.isGeometry)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const i=Math.pow(10,4),n=Math.cos(Bi*t),r=e.getIndex(),s=e.getAttribute("position"),o=r?r.count:s.count,a=[0,0,0],l=["a","b","c"],c=new Array(3),h={},u=[];for(let e=0;e<o;e+=3){r?(a[0]=r.getX(e),a[1]=r.getX(e+1),a[2]=r.getX(e+2)):(a[0]=e,a[1]=e+1,a[2]=e+2);const{a:t,b:o,c:d}=xc;if(t.fromBufferAttribute(s,a[0]),o.fromBufferAttribute(s,a[1]),d.fromBufferAttribute(s,a[2]),xc.getNormal(_c),c[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,c[1]=`${Math.round(o.x*i)},${Math.round(o.y*i)},${Math.round(o.z*i)}`,c[2]=`${Math.round(d.x*i)},${Math.round(d.y*i)},${Math.round(d.z*i)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){const t=(e+1)%3,i=c[e],r=c[t],s=xc[l[e]],o=xc[l[t]],d=`${i}_${r}`,m=`${r}_${i}`;m in h&&h[m]?(_c.dot(h[m].normal)<=n&&(u.push(s.x,s.y,s.z),u.push(o.x,o.y,o.z)),h[m]=null):d in h||(h[d]={index0:a[e],index1:a[t],normal:_c.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:i}=h[e];vc.fromBufferAttribute(s,t),yc.fromBufferAttribute(s,i),u.push(vc.x,vc.y,vc.z),u.push(yc.x,yc.y,yc.z)}this.setAttribute("position",new qr(u,3))}}function bc(e,t,i,n,r){let s,o;if(r===function(e,t,i,n){let r=0;for(let s=t,o=i-n;s<i;s+=n)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}(e,t,i,n)>0)for(s=t;s<i;s+=n)o=jc(s,e[s],e[s+1],o);else for(s=i-n;s>=t;s-=n)o=jc(s,e[s],e[s+1],o);return o&&Uc(o,o.next)&&(Hc(o),o=o.next),o}function Tc(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!Uc(n,n.next)&&0!==Vc(n.prev,n,n.next))n=n.next;else{if(Hc(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function Mc(e,t,i,n,r,s,o){if(!e)return;!o&&s&&function(e,t,i,n){let r=e;do{null===r.z&&(r.z=Dc(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,i,n,r,s,o,a,l,c=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ,n);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1)}(r)}(e,n,r,s);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,s?Ec(e,n,r,s):Sc(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),Hc(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?Mc(e=Ac(Tc(e),t,i),t,i,n,r,s,2):2===o&&Cc(e,t,i,n,r,s):Mc(Tc(e),t,i,n,r,s,1);break}}function Sc(e){const t=e.prev,i=e,n=e.next;if(Vc(t,i,n)>=0)return!1;let r=e.next.next;for(;r!==e.prev;){if(Oc(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&Vc(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Ec(e,t,i,n){const r=e.prev,s=e,o=e.next;if(Vc(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,h=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,u=Dc(a,l,t,i,n),d=Dc(c,h,t,i,n);let m=e.prevZ,p=e.nextZ;for(;m&&m.z>=u&&p&&p.z<=d;){if(m!==e.prev&&m!==e.next&&Oc(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&Vc(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,p!==e.prev&&p!==e.next&&Oc(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Vc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;m&&m.z>=u;){if(m!==e.prev&&m!==e.next&&Oc(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&Vc(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&Oc(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Vc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Ac(e,t,i){let n=e;do{const r=n.prev,s=n.next.next;!Uc(r,s)&&Bc(r,n,n.next,s)&&zc(r,s)&&zc(s,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(s.i/i),Hc(n),Hc(n.next),n=e=s),n=n.next}while(n!==e);return Tc(n)}function Cc(e,t,i,n,r,s){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&Fc(o,e)){let a=Gc(o,e);return o=Tc(o,o.next),a=Tc(a,a.next),Mc(o,t,i,n,r,s),void Mc(a,t,i,n,r,s)}e=e.next}o=o.next}while(o!==e)}function Pc(e,t){return e.x-t.x}function Lc(e,t){if(t=function(e,t){let i=t;const n=e.x,r=e.y;let s,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const e=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=n&&e>o){if(o=e,e===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!s)return null;if(n===o)return s;const a=s,l=s.x,c=s.y;let h,u=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&Oc(r<c?n:o,r,l,c,r<c?o:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),zc(i,e)&&(h<u||h===u&&(i.x>s.x||i.x===s.x&&Rc(s,i)))&&(s=i,u=h)),i=i.next}while(i!==a);return s}(e,t),t){const i=Gc(t,e);Tc(t,t.next),Tc(i,i.next)}}function Rc(e,t){return Vc(e.prev,e,t.prev)<0&&Vc(t.next,e,e.next)<0}function Dc(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ic(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Oc(e,t,i,n,r,s,o,a){return(r-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(n-a)-(i-o)*(t-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function Fc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Bc(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(zc(e,t)&&zc(t,e)&&function(e,t){let i=e,n=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(Vc(e.prev,e,t.prev)||Vc(e,t.prev,t))||Uc(e,t)&&Vc(e.prev,e,e.next)>0&&Vc(t.prev,t,t.next)>0)}function Vc(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Uc(e,t){return e.x===t.x&&e.y===t.y}function Bc(e,t,i,n){const r=kc(Vc(e,t,i)),s=kc(Vc(e,t,n)),o=kc(Vc(i,n,e)),a=kc(Vc(i,n,t));return r!==s&&o!==a||!(0!==r||!Nc(e,i,t))||!(0!==s||!Nc(e,n,t))||!(0!==o||!Nc(i,e,n))||!(0!==a||!Nc(i,t,n))}function Nc(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function kc(e){return e>0?1:e<0?-1:0}function zc(e,t){return Vc(e.prev,e,e.next)<0?Vc(e,t,e.next)>=0&&Vc(e,e.prev,t)>=0:Vc(e,t,e.prev)<0||Vc(e,e.next,t)<0}function Gc(e,t){const i=new Wc(e.i,e.x,e.y),n=new Wc(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function jc(e,t,i,n){const r=new Wc(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Hc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Wc(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class qc{static area(e){const t=e.length;let i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i}static isClockWise(e){return qc.area(e)<0}static triangulateShape(e,t){const i=[],n=[],r=[];Xc(e),Zc(i,e);let s=e.length;t.forEach(Xc);for(let e=0;e<t.length;e++)n.push(s),s+=t[e].length,Zc(i,t[e]);const o=function(e,t,i){i=i||2;const n=t&&t.length,r=n?t[0]*i:e.length;let s=bc(e,0,r,i,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,h,u,d,m;if(n&&(s=function(e,t,i,n){const r=[];let s,o,a,l,c;for(s=0,o=t.length;s<o;s++)a=t[s]*n,l=s<o-1?t[s+1]*n:e.length,c=bc(e,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(Ic(c));for(r.sort(Pc),s=0;s<r.length;s++)Lc(r[s],i),i=Tc(i,i.next);return i}(e,t,s,i)),e.length>80*i){a=c=e[0],l=h=e[1];for(let t=i;t<r;t+=i)u=e[t],d=e[t+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);m=Math.max(c-a,h-l),m=0!==m?1/m:0}return Mc(s,o,i,a,l,m),o}(i,n);for(let e=0;e<o.length;e+=3)r.push(o.slice(e,e+3));return r}}function Xc(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Zc(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class Yc extends rs{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,n=[],r=[];for(let t=0,i=e.length;t<i;t++)s(e[t]);function s(e){const s=[],o=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:6,u=void 0!==t.bevelSize?t.bevelSize:h-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,m=void 0!==t.bevelSegments?t.bevelSegments:3;const p=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:Kc;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let g,v,y,_,x,w=!1;p&&(g=p.getSpacedPoints(a),w=!0,c=!1,v=p.computeFrenetFrames(a,!1),y=new an,_=new an,x=new an),c||(m=0,h=0,u=0,d=0);const b=e.extractPoints(o);let T=b.shape;const M=b.holes;if(!qc.isClockWise(T)){T=T.reverse();for(let e=0,t=M.length;e<t;e++){const t=M[e];qc.isClockWise(t)&&(M[e]=t.reverse())}}const S=qc.triangulateShape(T,M),E=T;for(let e=0,t=M.length;e<t;e++){const t=M[e];T=T.concat(t)}function A(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}const C=T.length,P=S.length;function L(e,t,i){let n,r,s;const o=e.x-t.x,a=e.y-t.y,l=i.x-e.x,c=i.y-e.y,h=o*o+a*a,u=o*c-a*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),m=t.x-a/u,p=t.y+o/u,f=((i.x-c/d-m)*c-(i.y+l/d-p)*l)/(o*c-a*l);n=m+o*f-e.x,r=p+a*f-e.y;const g=n*n+r*r;if(g<=2)return new Zi(n,r);s=Math.sqrt(g/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(n=-a,r=o,s=Math.sqrt(h)):(n=o,r=a,s=Math.sqrt(h/2))}return new Zi(n/s,r/s)}const R=[];for(let e=0,t=E.length,i=t-1,n=e+1;e<t;e++,i++,n++)i===t&&(i=0),n===t&&(n=0),R[e]=L(E[e],E[i],E[n]);const D=[];let I,O=R.concat();for(let e=0,t=M.length;e<t;e++){const t=M[e];I=[];for(let e=0,i=t.length,n=i-1,r=e+1;e<i;e++,n++,r++)n===i&&(n=0),r===i&&(r=0),I[e]=L(t[e],t[n],t[r]);D.push(I),O=O.concat(I)}for(let e=0;e<m;e++){const t=e/m,i=h*Math.cos(t*Math.PI/2),n=u*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=A(E[e],R[e],n);U(t.x,t.y,-i)}for(let e=0,t=M.length;e<t;e++){const t=M[e];I=D[e];for(let e=0,r=t.length;e<r;e++){const r=A(t[e],I[e],n);U(r.x,r.y,-i)}}}const F=u+d;for(let e=0;e<C;e++){const t=c?A(T[e],O[e],F):T[e];w?(_.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),x.copy(g[0]).add(_).add(y),U(x.x,x.y,x.z)):U(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<C;t++){const i=c?A(T[t],O[t],F):T[t];w?(_.copy(v.normals[e]).multiplyScalar(i.x),y.copy(v.binormals[e]).multiplyScalar(i.y),x.copy(g[e]).add(_).add(y),U(x.x,x.y,x.z)):U(i.x,i.y,l/a*e)}for(let e=m-1;e>=0;e--){const t=e/m,i=h*Math.cos(t*Math.PI/2),n=u*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=A(E[e],R[e],n);U(t.x,t.y,l+i)}for(let e=0,t=M.length;e<t;e++){const t=M[e];I=D[e];for(let e=0,r=t.length;e<r;e++){const r=A(t[e],I[e],n);w?U(r.x,r.y+g[a-1].y,g[a-1].x+i):U(r.x,r.y,l+i)}}}function V(e,t){let i=e.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=e.length-1);for(let e=0,i=a+2*m;e<i;e++){const i=C*e,s=C*(e+1);N(t+n+i,t+r+i,t+r+s,t+n+s)}}}function U(e,t,i){s.push(e),s.push(t),s.push(i)}function B(e,t,r){k(e),k(t),k(r);const s=n.length/3,o=f.generateTopUV(i,n,s-3,s-2,s-1);z(o[0]),z(o[1]),z(o[2])}function N(e,t,r,s){k(e),k(t),k(s),k(t),k(r),k(s);const o=n.length/3,a=f.generateSideWallUV(i,n,o-6,o-3,o-2,o-1);z(a[0]),z(a[1]),z(a[3]),z(a[1]),z(a[2]),z(a[3])}function k(e){n.push(s[3*e+0]),n.push(s[3*e+1]),n.push(s[3*e+2])}function z(e){r.push(e.x),r.push(e.y)}!function(){const e=n.length/3;if(c){let e=0,t=C*e;for(let e=0;e<P;e++){const i=S[e];B(i[2]+t,i[1]+t,i[0]+t)}e=a+2*m,t=C*e;for(let e=0;e<P;e++){const i=S[e];B(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<P;e++){const t=S[e];B(t[2],t[1],t[0])}for(let e=0;e<P;e++){const t=S[e];B(t[0]+C*a,t[1]+C*a,t[2]+C*a)}}i.addGroup(e,n.length/3-e,0)}(),function(){const e=n.length/3;let t=0;V(E,t),t+=E.length;for(let e=0,i=M.length;e<i;e++){const i=M[e];V(i,t),t+=i.length}i.addGroup(e,n.length/3-e,1)}()}this.setAttribute("position",new qr(n,3)),this.setAttribute("uv",new qr(r,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,n=e.length;t<n;t++){const n=e[t];i.shapes.push(n.uuid)}else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,e)}}const Kc={generateTopUV:function(e,t,i,n,r){const s=t[3*i],o=t[3*i+1],a=t[3*n],l=t[3*n+1],c=t[3*r],h=t[3*r+1];return[new Zi(s,o),new Zi(a,l),new Zi(c,h)]},generateSideWallUV:function(e,t,i,n,r,s){const o=t[3*i],a=t[3*i+1],l=t[3*i+2],c=t[3*n],h=t[3*n+1],u=t[3*n+2],d=t[3*r],m=t[3*r+1],p=t[3*r+2],f=t[3*s],g=t[3*s+1],v=t[3*s+2];return Math.abs(a-h)<Math.abs(o-c)?[new Zi(o,1-l),new Zi(c,1-u),new Zi(d,1-p),new Zi(f,1-v)]:[new Zi(a,1-l),new Zi(h,1-u),new Zi(m,1-p),new Zi(g,1-v)]}};class $c extends fc{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}}class Jc extends rs{constructor(e,t=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=zi(n,0,2*Math.PI);const r=[],s=[],o=[],a=1/t,l=new an,c=new Zi;for(let r=0;r<=t;r++){const h=i+r*a*n,u=Math.sin(h),d=Math.cos(h);for(let i=0;i<=e.length-1;i++)l.x=e[i].x*u,l.y=e[i].y,l.z=e[i].x*d,s.push(l.x,l.y,l.z),c.x=r/t,c.y=i/(e.length-1),o.push(c.x,c.y)}for(let i=0;i<t;i++)for(let t=0;t<e.length-1;t++){const n=t+i*e.length,s=n,o=n+e.length,a=n+e.length+1,l=n+1;r.push(s,o,l),r.push(o,a,l)}if(this.setIndex(r),this.setAttribute("position",new qr(s,3)),this.setAttribute("uv",new qr(o,2)),this.computeVertexNormals(),n===2*Math.PI){const i=this.attributes.normal.array,n=new an,r=new an,s=new an,o=t*e.length*3;for(let t=0,a=0;t<e.length;t++,a+=3)n.x=i[a+0],n.y=i[a+1],n.z=i[a+2],r.x=i[o+a+0],r.y=i[o+a+1],r.z=i[o+a+2],s.addVectors(n,r).normalize(),i[a+0]=i[o+a+0]=s.x,i[a+1]=i[o+a+1]=s.y,i[a+2]=i[o+a+2]=s.z}}}class Qc extends fc{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}}class eh extends rs{constructor(e,t,i){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i};const n=[],r=[],s=[],o=[],a=1e-5,l=new an,c=new an,h=new an,u=new an,d=new an;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const m=t+1;for(let n=0;n<=i;n++){const m=n/i;for(let i=0;i<=t;i++){const n=i/t;e(n,m,c),r.push(c.x,c.y,c.z),n-a>=0?(e(n-a,m,h),u.subVectors(c,h)):(e(n+a,m,h),u.subVectors(h,c)),m-a>=0?(e(n,m-a,h),d.subVectors(c,h)):(e(n,m+a,h),d.subVectors(h,c)),l.crossVectors(u,d).normalize(),s.push(l.x,l.y,l.z),o.push(n,m)}}for(let e=0;e<i;e++)for(let i=0;i<t;i++){const t=e*m+i,r=e*m+i+1,s=(e+1)*m+i+1,o=(e+1)*m+i;n.push(t,r,o),n.push(r,s,o)}this.setIndex(n),this.setAttribute("position",new qr(r,3)),this.setAttribute("normal",new qr(s,3)),this.setAttribute("uv",new qr(o,2))}}class th extends rs{constructor(e=.5,t=1,i=8,n=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:s},i=Math.max(3,i);const o=[],a=[],l=[],c=[];let h=e;const u=(t-e)/(n=Math.max(1,n)),d=new an,m=new Zi;for(let e=0;e<=n;e++){for(let e=0;e<=i;e++){const n=r+e/i*s;d.x=h*Math.cos(n),d.y=h*Math.sin(n),a.push(d.x,d.y,d.z),l.push(0,0,1),m.x=(d.x/t+1)/2,m.y=(d.y/t+1)/2,c.push(m.x,m.y)}h+=u}for(let e=0;e<n;e++){const t=e*(i+1);for(let e=0;e<i;e++){const n=e+t,r=n,s=n+i+1,a=n+i+2,l=n+1;o.push(r,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new qr(a,3)),this.setAttribute("normal",new qr(l,3)),this.setAttribute("uv",new qr(c,2))}}class ih extends rs{constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],n=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(o,a,t),o+=a,a=0;function l(e){const o=n.length/3,l=e.extractPoints(t);let c=l.shape;const h=l.holes;!1===qc.isClockWise(c)&&(c=c.reverse());for(let e=0,t=h.length;e<t;e++){const t=h[e];!0===qc.isClockWise(t)&&(h[e]=t.reverse())}const u=qc.triangulateShape(c,h);for(let e=0,t=h.length;e<t;e++){const t=h[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];n.push(t.x,t.y,0),r.push(0,0,1),s.push(t.x,t.y)}for(let e=0,t=u.length;e<t;e++){const t=u[e],n=t[0]+o,r=t[1]+o,s=t[2]+o;i.push(n,r,s),a+=3}}this.setIndex(i),this.setAttribute("position",new qr(n,3)),this.setAttribute("normal",new qr(r,3)),this.setAttribute("uv",new qr(s,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,n=e.length;i<n;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class nh extends rs{constructor(e=1,t=8,i=6,n=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:o},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const a=Math.min(s+o,Math.PI);let l=0;const c=[],h=new an,u=new an,d=[],m=[],p=[],f=[];for(let d=0;d<=i;d++){const g=[],v=d/i;let y=0;0==d&&0==s?y=.5/t:d==i&&a==Math.PI&&(y=-.5/t);for(let i=0;i<=t;i++){const a=i/t;h.x=-e*Math.cos(n+a*r)*Math.sin(s+v*o),h.y=e*Math.cos(s+v*o),h.z=e*Math.sin(n+a*r)*Math.sin(s+v*o),m.push(h.x,h.y,h.z),u.copy(h).normalize(),p.push(u.x,u.y,u.z),f.push(a+y,1-v),g.push(l++)}c.push(g)}for(let e=0;e<i;e++)for(let n=0;n<t;n++){const t=c[e][n+1],r=c[e][n],o=c[e+1][n],l=c[e+1][n+1];(0!==e||s>0)&&d.push(t,r,l),(e!==i-1||a<Math.PI)&&d.push(r,o,l)}this.setIndex(d),this.setAttribute("position",new qr(m,3)),this.setAttribute("normal",new qr(p,3)),this.setAttribute("uv",new qr(f,2))}}class rh extends fc{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}}class sh extends Yc{constructor(e,t={}){const i=t.font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new rs;const n=i.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(n,t),this.type="TextGeometry"}}class oh extends rs{constructor(e=1,t=.4,i=8,n=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const s=[],o=[],a=[],l=[],c=new an,h=new an,u=new an;for(let s=0;s<=i;s++)for(let d=0;d<=n;d++){const m=d/n*r,p=s/i*Math.PI*2;h.x=(e+t*Math.cos(p))*Math.cos(m),h.y=(e+t*Math.cos(p))*Math.sin(m),h.z=t*Math.sin(p),o.push(h.x,h.y,h.z),c.x=e*Math.cos(m),c.y=e*Math.sin(m),u.subVectors(h,c).normalize(),a.push(u.x,u.y,u.z),l.push(d/n),l.push(s/i)}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){const i=(n+1)*e+t-1,r=(n+1)*(e-1)+t-1,o=(n+1)*(e-1)+t,a=(n+1)*e+t;s.push(i,r,a),s.push(r,o,a)}this.setIndex(s),this.setAttribute("position",new qr(o,3)),this.setAttribute("normal",new qr(a,3)),this.setAttribute("uv",new qr(l,2))}}class ah extends rs{constructor(e=1,t=.4,i=64,n=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);const o=[],a=[],l=[],c=[],h=new an,u=new an,d=new an,m=new an,p=new an,f=new an,g=new an;for(let o=0;o<=i;++o){const y=o/i*r*Math.PI*2;v(y,r,s,e,d),v(y+.01,r,s,e,m),f.subVectors(m,d),g.addVectors(m,d),p.crossVectors(f,g),g.crossVectors(p,f),p.normalize(),g.normalize();for(let e=0;e<=n;++e){const r=e/n*Math.PI*2,s=-t*Math.cos(r),m=t*Math.sin(r);h.x=d.x+(s*g.x+m*p.x),h.y=d.y+(s*g.y+m*p.y),h.z=d.z+(s*g.z+m*p.z),a.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(o/i),c.push(e/n)}}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){const i=(n+1)*(e-1)+(t-1),r=(n+1)*e+(t-1),s=(n+1)*e+t,a=(n+1)*(e-1)+t;o.push(i,r,a),o.push(r,s,a)}function v(e,t,i,n,r){const s=Math.cos(e),o=Math.sin(e),a=i/t*e,l=Math.cos(a);r.x=n*(2+l)*.5*s,r.y=n*(2+l)*o*.5,r.z=n*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new qr(a,3)),this.setAttribute("normal",new qr(l,3)),this.setAttribute("uv",new qr(c,2))}}class lh extends rs{constructor(e,t=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:r};const s=e.computeFrenetFrames(t,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new an,a=new an,l=new Zi;let c=new an;const h=[],u=[],d=[],m=[];function p(r){c=e.getPointAt(r/t,c);const l=s.normals[r],d=s.binormals[r];for(let e=0;e<=n;e++){const t=e/n*Math.PI*2,r=Math.sin(t),s=-Math.cos(t);a.x=s*l.x+r*d.x,a.y=s*l.y+r*d.y,a.z=s*l.z+r*d.z,a.normalize(),u.push(a.x,a.y,a.z),o.x=c.x+i*a.x,o.y=c.y+i*a.y,o.z=c.z+i*a.z,h.push(o.x,o.y,o.z)}}!function(){for(let e=0;e<t;e++)p(e);p(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let i=0;i<=n;i++)l.x=e/t,l.y=i/n,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=n;t++){const i=(n+1)*(e-1)+(t-1),r=(n+1)*e+(t-1),s=(n+1)*e+t,o=(n+1)*(e-1)+t;m.push(i,r,o),m.push(r,s,o)}}()}(),this.setIndex(m),this.setAttribute("position",new qr(h,3)),this.setAttribute("normal",new qr(u,3)),this.setAttribute("uv",new qr(d,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}}class ch extends rs{constructor(e){if(super(),this.type="WireframeGeometry",!0===e.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const t=[],i=[0,0],n={},r=new an;if(null!==e.index){const s=e.attributes.position,o=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,t=a.length;e<t;++e){const t=a[e],r=t.start;for(let e=r,s=r+t.count;e<s;e+=3)for(let t=0;t<3;t++){const r=o.getX(e+t),s=o.getX(e+(t+1)%3);i[0]=Math.min(r,s),i[1]=Math.max(r,s);const a=i[0]+","+i[1];void 0===n[a]&&(n[a]={index1:i[0],index2:i[1]})}}for(const e in n){const i=n[e];r.fromBufferAttribute(s,i.index1),t.push(r.x,r.y,r.z),r.fromBufferAttribute(s,i.index2),t.push(r.x,r.y,r.z)}}else{const i=e.attributes.position;for(let e=0,n=i.count/3;e<n;e++)for(let n=0;n<3;n++){const s=3*e+n;r.fromBufferAttribute(i,s),t.push(r.x,r.y,r.z);const o=3*e+(n+1)%3;r.fromBufferAttribute(i,o),t.push(r.x,r.y,r.z)}}this.setAttribute("position",new qr(t,3))}}var hh=Object.freeze({__proto__:null,BoxGeometry:Ms,BoxBufferGeometry:Ms,CircleGeometry:dc,CircleBufferGeometry:dc,ConeGeometry:pc,ConeBufferGeometry:pc,CylinderGeometry:mc,CylinderBufferGeometry:mc,DodecahedronGeometry:gc,DodecahedronBufferGeometry:gc,EdgesGeometry:wc,ExtrudeGeometry:Yc,ExtrudeBufferGeometry:Yc,IcosahedronGeometry:$c,IcosahedronBufferGeometry:$c,LatheGeometry:Jc,LatheBufferGeometry:Jc,OctahedronGeometry:Qc,OctahedronBufferGeometry:Qc,ParametricGeometry:eh,ParametricBufferGeometry:eh,PlaneGeometry:ks,PlaneBufferGeometry:ks,PolyhedronGeometry:fc,PolyhedronBufferGeometry:fc,RingGeometry:th,RingBufferGeometry:th,ShapeGeometry:ih,ShapeBufferGeometry:ih,SphereGeometry:nh,SphereBufferGeometry:nh,TetrahedronGeometry:rh,TetrahedronBufferGeometry:rh,TextGeometry:sh,TextBufferGeometry:sh,TorusGeometry:oh,TorusBufferGeometry:oh,TorusKnotGeometry:ah,TorusKnotBufferGeometry:ah,TubeGeometry:lh,TubeBufferGeometry:lh,WireframeGeometry:ch});class uh extends Er{constructor(e){super(),this.type="ShadowMaterial",this.color=new Ir(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}uh.prototype.isShadowMaterial=!0;class dh extends Cs{constructor(e){super(e),this.type="RawShaderMaterial"}}dh.prototype.isRawShaderMaterial=!0;class mh extends Er{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ir(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ir(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Zi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}}mh.prototype.isMeshStandardMaterial=!0;class ph extends mh{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Zi(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=zi(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Ir(1,1,1),this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Ir).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this}}ph.prototype.isMeshPhysicalMaterial=!0;class fh extends Er{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Ir(16777215),this.specular=new Ir(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ir(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Zi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}fh.prototype.isMeshPhongMaterial=!0;class gh extends Er{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ir(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ir(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Zi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}gh.prototype.isMeshToonMaterial=!0;class vh extends Er{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Zi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}vh.prototype.isMeshNormalMaterial=!0;class yh extends Er{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Ir(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ir(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}yh.prototype.isMeshLambertMaterial=!0;class _h extends Er{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ir(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Zi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}_h.prototype.isMeshMatcapMaterial=!0;class xh extends Hl{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}xh.prototype.isLineDashedMaterial=!0;var wh=Object.freeze({__proto__:null,ShadowMaterial:uh,SpriteMaterial:cl,RawShaderMaterial:dh,ShaderMaterial:Cs,PointsMaterial:tc,MeshPhysicalMaterial:ph,MeshStandardMaterial:mh,MeshPhongMaterial:fh,MeshToonMaterial:gh,MeshNormalMaterial:vh,MeshLambertMaterial:yh,MeshDepthMaterial:za,MeshDistanceMaterial:Ga,MeshBasicMaterial:Or,MeshMatcapMaterial:_h,LineDashedMaterial:xh,LineBasicMaterial:Hl,Material:Er});const bh={arraySlice:function(e,t,i){return bh.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){const n=e.length,r=new e.constructor(n);for(let s=0,o=0;o!==n;++s){const n=i[s]*t;for(let i=0;i!==t;++i)r[o++]=e[n+i]}return r},flattenJSON:function(e,t,i,n){let r=1,s=e[0];for(;void 0!==s&&void 0===s[n];)s=e[r++];if(void 0===s)return;let o=s[n];if(void 0!==o)if(Array.isArray(o))do{o=s[n],void 0!==o&&(t.push(s.time),i.push.apply(i,o)),s=e[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[n],void 0!==o&&(t.push(s.time),o.toArray(i,i.length)),s=e[r++]}while(void 0!==s);else do{o=s[n],void 0!==o&&(t.push(s.time),i.push(o)),s=e[r++]}while(void 0!==s)},subclip:function(e,t,i,n,r=30){const s=e.clone();s.name=t;const o=[];for(let e=0;e<s.tracks.length;++e){const t=s.tracks[e],a=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const s=t.times[e]*r;if(!(s<i||s>=n)){l.push(t.times[e]);for(let i=0;i<a;++i)c.push(t.values[e*a+i])}}0!==l.length&&(t.times=bh.convertArray(l,t.times.constructor),t.values=bh.convertArray(c,t.values.constructor),o.push(t))}s.tracks=o;let a=1/0;for(let e=0;e<s.tracks.length;++e)a>s.tracks[e].times[0]&&(a=s.tracks[e].times[0]);for(let e=0;e<s.tracks.length;++e)s.tracks[e].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,i=e,n=30){n<=0&&(n=30);const r=i.tracks.length,s=t/n;for(let t=0;t<r;++t){const n=i.tracks[t],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const o=e.tracks.find((function(e){return e.name===n.name&&e.ValueTypeName===r}));if(void 0===o)continue;let a=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=n.times.length-1;let d;if(s<=n.times[0]){const e=a,t=l-a;d=bh.arraySlice(n.values,e,t)}else if(s>=n.times[u]){const e=u*l+a,t=e+l-a;d=bh.arraySlice(n.values,e,t)}else{const e=n.createInterpolant(),t=a,i=l-a;e.evaluate(s),d=bh.arraySlice(e.resultBuffer,t,i)}"quaternion"===r&&(new on).fromArray(d).normalize().conjugate().toArray(d);const m=o.times.length;for(let e=0;e<m;++e){const t=e*h+c;if("quaternion"===r)on.multiplyQuaternionsFlat(o.values,t,d,0,o.values,t);else{const e=h-2*c;for(let i=0;i<e;++i)o.values[t+i]-=d[i]}}}return e.blendMode=qt,e}};class Th{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let s;i:{n:if(!(e<n)){for(let s=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,r)}if(i===s)break;if(r=n,n=t[++i],e<n)break t}s=t.length;break i}if(e>=r)break e;{const o=t[1];e<o&&(i=2,r=o);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(i===s)break;if(n=r,r=t[--i-1],e>=r)break t}s=i,i=0}}for(;i<s;){const n=i+s>>>1;e<t[n]?s=n:i=n+1}if(n=t[i],r=t[i-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,r,e)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let e=0;e!==n;++e)t[e]=i[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Th.prototype.beforeStart_=Th.prototype.copySampleValue_,Th.prototype.afterEnd_=Th.prototype.copySampleValue_;class Mh extends Th{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Gt,endingEnd:Gt}}intervalChanged_(e,t,i){const n=this.parameterPositions;let r=e-2,s=e+1,o=n[r],a=n[s];if(void 0===o)switch(this.getSettings_().endingStart){case jt:r=e,o=2*t-i;break;case Ht:r=n.length-2,o=t+n[r]-n[r+1];break;default:r=e,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case jt:s=e,a=2*i-t;break;case Ht:s=1,a=i+n[1]-n[0];break;default:s=e-1,a=t}const l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(a-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,m=(i-t)/(n-t),p=m*m,f=p*m,g=-u*f+2*u*p-u*m,v=(1+u)*f+(-1.5-2*u)*p+(-.5+u)*m+1,y=(-1-d)*f+(1.5+d)*p+.5*m,_=d*f-d*p;for(let e=0;e!==o;++e)r[e]=g*s[c+e]+v*s[l+e]+y*s[a+e]+_*s[h+e];return r}}class Sh extends Th{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=(i-t)/(n-t),h=1-c;for(let e=0;e!==o;++e)r[e]=s[l+e]*h+s[a+e]*c;return r}}class Eh extends Th{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ah{constructor(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=bh.convertArray(t,this.TimeBufferType),this.values=bh.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:bh.convertArray(e.times,Array),values:bh.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(i.interpolation=t)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Eh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Sh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Mh(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Nt:t=this.InterpolantFactoryMethodDiscrete;break;case kt:t=this.InterpolantFactoryMethodLinear;break;case zt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Nt;case this.InterpolantFactoryMethodLinear:return kt;case this.InterpolantFactoryMethodSmooth:return zt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<e;)++r;for(;-1!==s&&i[s]>t;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=bh.arraySlice(i,r,s),this.values=bh.arraySlice(this.values,r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let t=0;t!==r;t++){const n=i[t];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,n),e=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,n,s),e=!1;break}s=n}if(void 0!==n&&bh.isTypedArray(n))for(let t=0,i=n.length;t!==i;++t){const i=n[t];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,i),e=!1;break}}return e}optimize(){const e=bh.arraySlice(this.times),t=bh.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===zt,r=e.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=e[o];if(a!==e[o+1]&&(1!==o||a!==e[0]))if(n)r=!0;else{const e=o*i,n=e-i,s=e+i;for(let o=0;o!==i;++o){const i=t[e+o];if(i!==t[n+o]||i!==t[s+o]){r=!0;break}}}if(r){if(o!==s){e[s]=e[o];const n=o*i,r=s*i;for(let e=0;e!==i;++e)t[r+e]=t[n+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*i,n=s*i,o=0;o!==i;++o)t[n+o]=t[e+o];++s}return s!==e.length?(this.times=bh.arraySlice(e,0,s),this.values=bh.arraySlice(t,0,s*i)):(this.times=e,this.values=t),this}clone(){const e=bh.arraySlice(this.times,0),t=bh.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}Ah.prototype.TimeBufferType=Float32Array,Ah.prototype.ValueBufferType=Float32Array,Ah.prototype.DefaultInterpolation=kt;class Ch extends Ah{}Ch.prototype.ValueTypeName="bool",Ch.prototype.ValueBufferType=Array,Ch.prototype.DefaultInterpolation=Nt,Ch.prototype.InterpolantFactoryMethodLinear=void 0,Ch.prototype.InterpolantFactoryMethodSmooth=void 0;class Ph extends Ah{}Ph.prototype.ValueTypeName="color";class Lh extends Ah{}Lh.prototype.ValueTypeName="number";class Rh extends Th{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(i-t)/(n-t);let l=e*o;for(let e=l+o;l!==e;l+=4)on.slerpFlat(r,0,s,l-o,s,l,a);return r}}class Dh extends Ah{InterpolantFactoryMethodLinear(e){return new Rh(this.times,this.values,this.getValueSize(),e)}}Dh.prototype.ValueTypeName="quaternion",Dh.prototype.DefaultInterpolation=kt,Dh.prototype.InterpolantFactoryMethodSmooth=void 0;class Ih extends Ah{}Ih.prototype.ValueTypeName="string",Ih.prototype.ValueBufferType=Array,Ih.prototype.DefaultInterpolation=Nt,Ih.prototype.InterpolantFactoryMethodLinear=void 0,Ih.prototype.InterpolantFactoryMethodSmooth=void 0;class Oh extends Ah{}Oh.prototype.ValueTypeName="vector";class Fh{constructor(e,t=-1,i,n=Wt){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=ki(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let e=0,r=i.length;e!==r;++e)t.push(Vh(i[e]).scale(n));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,n=i.length;e!==n;++e)t.push(Ah.toJSON(i[e]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const r=t.length,s=[];for(let e=0;e<r;e++){let o=[],a=[];o.push((e+r-1)%r,e,(e+1)%r),a.push(0,1,0);const l=bh.getKeyframeOrder(o);o=bh.sortedArray(o,1,l),a=bh.sortedArray(a,1,l),n||0!==o[0]||(o.push(r),a.push(a[0])),s.push(new Lh(".morphTargetInfluences["+t[e].name+"]",o,a).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,i=e.length;t<i;t++){const i=e[t],s=i.name.match(r);if(s&&s.length>1){const e=s[1];let t=n[e];t||(n[e]=t=[]),t.push(i)}}const s=[];for(const e in n)s.push(this.CreateFromMorphTargetSequence(e,n[e],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(e,t,i,n,r){if(0!==i.length){const s=[],o=[];bh.flattenJSON(i,s,o,n),0!==s.length&&r.push(new e(t,s,o))}},n=[],r=e.name||"default",s=e.fps||30,o=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const r=l[e].keys;if(r&&0!==r.length)if(r[0].morphTargets){const e={};let t;for(t=0;t<r.length;t++)if(r[t].morphTargets)for(let i=0;i<r[t].morphTargets.length;i++)e[r[t].morphTargets[i]]=-1;for(const i in e){const e=[],s=[];for(let n=0;n!==r[t].morphTargets.length;++n){const n=r[t];e.push(n.time),s.push(n.morphTarget===i?1:0)}n.push(new Lh(".morphTargetInfluence["+i+"]",e,s))}a=e.length*(s||1)}else{const s=".bones["+t[e].name+"]";i(Oh,s+".position",r,"pos",n),i(Dh,s+".quaternion",r,"rot",n),i(Oh,s+".scale",r,"scl",n)}}return 0===n.length?null:new this(r,a,n,o)}resetDuration(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){const i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Vh(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Lh;case"vector":case"vector2":case"vector3":case"vector4":return Oh;case"color":return Ph;case"quaternion":return Dh;case"bool":case"boolean":return Ch;case"string":return Ih}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],i=[];bh.flattenJSON(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Uh={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Bh{constructor(e,t,i){const n=this;let r,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===s&&void 0!==n.onStart&&n.onStart(e,o,a),s=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,a),o===a&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){const i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}}const Nh=new Bh;class kh{constructor(e){this.manager=void 0!==e?e:Nh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise((function(n,r){i.load(e,n,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const zh={};class Gh extends kh{constructor(e){super(e)}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Uh.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;if(void 0!==zh[e])return void zh[e].push({onLoad:t,onProgress:i,onError:n});const o=e.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(o){const i=o[1],s=!!o[2];let a=o[3];a=decodeURIComponent(a),s&&(a=atob(a));try{let n;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const e=new Uint8Array(a.length);for(let t=0;t<a.length;t++)e[t]=a.charCodeAt(t);n="blob"===s?new Blob([e.buffer],{type:i}):e.buffer;break;case"document":const t=new DOMParser;n=t.parseFromString(a,i);break;case"json":n=JSON.parse(a);break;default:n=a}setTimeout((function(){t&&t(n),r.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}),0)}}else{zh[e]=[],zh[e].push({onLoad:t,onProgress:i,onError:n}),a=new XMLHttpRequest,a.open("GET",e,!0),a.addEventListener("load",(function(t){const i=this.response,n=zh[e];if(delete zh[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Uh.add(e,i);for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onLoad&&t.onLoad(i)}r.manager.itemEnd(e)}else{for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}}),!1),a.addEventListener("progress",(function(t){const i=zh[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onProgress&&n.onProgress(t)}}),!1),a.addEventListener("error",(function(t){const i=zh[e];delete zh[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),a.addEventListener("abort",(function(t){const i=zh[e];delete zh[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)a.setRequestHeader(e,this.requestHeader[e]);a.send(null)}return r.manager.itemStart(e),a}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class jh extends kh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=new Gh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(i){try{t(r.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}}),i,n)}parse(e){const t=[];for(let i=0;i<e.length;i++){const n=Fh.parse(e[i]);t.push(n)}return t}}class Hh extends kh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=[],o=new cc,a=new Gh(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let l=0;function c(c){a.load(e[c],(function(e){const i=r.parse(e,!0);s[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(o.minFilter=_e),o.image=s,o.format=i.format,o.needsUpdate=!0,t&&t(o))}),i,n)}if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)c(t);else a.load(e,(function(e){const i=r.parse(e,!0);if(i.isCubemap){const e=i.mipmaps.length/i.mipmapCount;for(let t=0;t<e;t++){s[t]={mipmaps:[]};for(let e=0;e<i.mipmapCount;e++)s[t].mipmaps.push(i.mipmaps[t*i.mipmapCount+e]),s[t].format=i.format,s[t].width=i.width,s[t].height=i.height}o.image=s}else o.image.width=i.width,o.image.height=i.height,o.mipmaps=i.mipmaps;1===i.mipmapCount&&(o.minFilter=_e),o.format=i.format,o.needsUpdate=!0,t&&t(o)}),i,n);return o}}class Wh extends kh{constructor(e){super(e)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Uh.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),Uh.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}class qh extends kh{constructor(e){super(e)}load(e,t,i,n){const r=new Is,s=new Wh(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(i){s.load(e[i],(function(e){r.images[i]=e,o++,6===o&&(r.needsUpdate=!0,t&&t(r))}),void 0,n)}for(let t=0;t<e.length;++t)a(t);return r}}class Xh extends kh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=new Fl,o=new Gh(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(e,(function(e){const i=r.parse(e);i&&(void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:de,s.wrapT=void 0!==i.wrapT?i.wrapT:de,s.magFilter=void 0!==i.magFilter?i.magFilter:_e,s.minFilter=void 0!==i.minFilter?i.minFilter:_e,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(s.encoding=i.encoding),void 0!==i.flipY&&(s.flipY=i.flipY),void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=be),1===i.mipmapCount&&(s.minFilter=_e),void 0!==i.generateMipmaps&&(s.generateMipmaps=i.generateMipmaps),s.needsUpdate=!0,t&&t(s,i))}),i,n),s}}class Zh extends kh{constructor(e){super(e)}load(e,t,i,n){const r=new Qi,s=new Wh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(i){r.image=i;const n=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=n?Ue:Be,r.needsUpdate=!0,void 0!==t&&t(r)}),i,n),r}}class Yh{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let n=0;const r=i.length;let s;s=t||e*i[r-1];let o,a=0,l=r-1;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),o=i[n]-s,o<0)a=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const c=i[n];return(n+(s-c)/(i[n+1]-c))/(r-1)}getTangent(e,t){const i=1e-4;let n=e-i,r=e+i;n<0&&(n=0),r>1&&(r=1);const s=this.getPoint(n),o=this.getPoint(r),a=t||(s.isVector2?new Zi:new an);return a.copy(o).sub(s).normalize(),a}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new an,n=[],r=[],s=[],o=new an,a=new Bn;for(let t=0;t<=e;t++){const i=t/e;n[t]=this.getTangentAt(i,new an),n[t].normalize()}r[0]=new an,s[0]=new an;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],o),s[0].crossVectors(n[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),s[t]=s[t-1].clone(),o.crossVectors(n[t-1],n[t]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(zi(n[t-1].dot(n[t]),-1,1));r[t].applyMatrix4(a.makeRotationAxis(o,e))}s[t].crossVectors(n[t],r[t])}if(!0===t){let t=Math.acos(zi(r[0].dot(r[e]),-1,1));t/=e,n[0].dot(o.crossVectors(r[0],r[e]))>0&&(t=-t);for(let i=1;i<=e;i++)r[i].applyMatrix4(a.makeRotationAxis(n[i],t*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Kh extends Yh{constructor(e=0,t=0,i=1,n=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(e,t){const i=t||new Zi,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const o=this.aStartAngle+e*r;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=a-this.aX,n=l-this.aY;a=i*e-n*t+this.aX,l=i*t+n*e+this.aY}return i.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Kh.prototype.isEllipseCurve=!0;class $h extends Kh{constructor(e,t,i,n,r,s){super(e,t,i,i,n,r,s),this.type="ArcCurve"}}function Jh(){let e=0,t=0,i=0,n=0;function r(r,s,o,a){e=r,t=o,i=-3*r+3*s-2*o-a,n=2*r-2*s+o+a}return{initCatmullRom:function(e,t,i,n,s){r(t,i,s*(i-e),s*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,s,o,a){let l=(t-e)/s-(i-e)/(s+o)+(i-t)/o,c=(i-t)/o-(n-t)/(o+a)+(n-i)/a;l*=o,c*=o,r(t,i,l,c)},calc:function(r){const s=r*r;return e+t*r+i*s+n*(s*r)}}}$h.prototype.isArcCurve=!0;const Qh=new an,eu=new Jh,tu=new Jh,iu=new Jh;class nu extends Yh{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new an){const i=t,n=this.points,r=n.length,s=(r-(this.closed?0:1))*e;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?o=n[(l-1)%r]:(Qh.subVectors(n[0],n[1]).add(n[0]),o=Qh);const h=n[l%r],u=n[(l+1)%r];if(this.closed||l+2<r?a=n[(l+2)%r]:(Qh.subVectors(n[r-1],n[r-2]).add(n[r-1]),a=Qh),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(a),e);i<1e-4&&(i=1),t<1e-4&&(t=i),n<1e-4&&(n=i),eu.initNonuniformCatmullRom(o.x,h.x,u.x,a.x,t,i,n),tu.initNonuniformCatmullRom(o.y,h.y,u.y,a.y,t,i,n),iu.initNonuniformCatmullRom(o.z,h.z,u.z,a.z,t,i,n)}else"catmullrom"===this.curveType&&(eu.initCatmullRom(o.x,h.x,u.x,a.x,this.tension),tu.initCatmullRom(o.y,h.y,u.y,a.y,this.tension),iu.initCatmullRom(o.z,h.z,u.z,a.z,this.tension));return i.set(eu.calc(c),tu.calc(c),iu.calc(c)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new an).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function ru(e,t,i,n,r){const s=.5*(n-t),o=.5*(r-i),a=e*e;return(2*i-2*n+s+o)*(e*a)+(-3*i+3*n-2*s-o)*a+s*e+i}function su(e,t,i,n){return function(e,t){const i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,n)}function ou(e,t,i,n,r){return function(e,t){const i=1-e;return i*i*i*t}(e,t)+function(e,t){const i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,r)}nu.prototype.isCatmullRomCurve3=!0;class au extends Yh{constructor(e=new Zi,t=new Zi,i=new Zi,n=new Zi){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new Zi){const i=t,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(ou(e,n.x,r.x,s.x,o.x),ou(e,n.y,r.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}au.prototype.isCubicBezierCurve=!0;class lu extends Yh{constructor(e=new an,t=new an,i=new an,n=new an){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new an){const i=t,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(ou(e,n.x,r.x,s.x,o.x),ou(e,n.y,r.y,s.y,o.y),ou(e,n.z,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}lu.prototype.isCubicBezierCurve3=!0;class cu extends Yh{constructor(e=new Zi,t=new Zi){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Zi){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new Zi;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}cu.prototype.isLineCurve=!0;class hu extends Yh{constructor(e=new an,t=new an){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new an){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class uu extends Yh{constructor(e=new Zi,t=new Zi,i=new Zi){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Zi){const i=t,n=this.v0,r=this.v1,s=this.v2;return i.set(su(e,n.x,r.x,s.x),su(e,n.y,r.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}uu.prototype.isQuadraticBezierCurve=!0;class du extends Yh{constructor(e=new an,t=new an,i=new an){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new an){const i=t,n=this.v0,r=this.v1,s=this.v2;return i.set(su(e,n.x,r.x,s.x),su(e,n.y,r.y,s.y),su(e,n.z,r.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}du.prototype.isQuadraticBezierCurve3=!0;class mu extends Yh{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Zi){const i=t,n=this.points,r=(n.length-1)*e,s=Math.floor(r),o=r-s,a=n[0===s?s:s-1],l=n[s],c=n[s>n.length-2?n.length-1:s+1],h=n[s>n.length-3?n.length-1:s+2];return i.set(ru(o,a.x,l.x,c.x,h.x),ru(o,a.y,l.y,c.y,h.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new Zi).fromArray(i))}return this}}mu.prototype.isSplineCurve=!0;var pu=Object.freeze({__proto__:null,ArcCurve:$h,CatmullRomCurve3:nu,CubicBezierCurve:au,CubicBezierCurve3:lu,EllipseCurve:Kh,LineCurve:cu,LineCurve3:hu,QuadraticBezierCurve:uu,QuadraticBezierCurve3:du,SplineCurve:mu});class fu extends Yh{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new cu(t,e))}getPoint(e){const t=e*this.getLength(),i=this.getCurveLengths();let n=0;for(;n<i.length;){if(i[n]>=t){const e=i[n]-t,r=this.curves[n],s=r.getLength(),o=0===s?0:1-e/s;return r.getPointAt(o)}n++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],o=s&&s.isEllipseCurve?2*e:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?e*s.points.length:e,a=s.getPoints(o);for(let e=0;e<a.length;e++){const n=a[e];i&&i.equals(n)||(t.push(n),i=n)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push((new pu[i.type]).fromJSON(i))}return this}}class gu extends fu{constructor(e){super(),this.type="Path",this.currentPoint=new Zi,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new cu(this.currentPoint.clone(),new Zi(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){const r=new uu(this.currentPoint.clone(),new Zi(e,t),new Zi(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,s){const o=new au(this.currentPoint.clone(),new Zi(e,t),new Zi(i,n),new Zi(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new mu(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+o,t+a,i,n,r,s),this}absarc(e,t,i,n,r,s){return this.absellipse(e,t,i,i,n,r,s),this}ellipse(e,t,i,n,r,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,n,r,s,o,a),this}absellipse(e,t,i,n,r,s,o,a){const l=new Kh(e,t,i,n,r,s,o,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class vu extends gu{constructor(e){super(e),this.uuid=ki(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push((new gu).fromJSON(i))}return this}}class yu extends cr{constructor(e,t=1){super(),this.type="Light",this.color=new Ir(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}yu.prototype.isLight=!0;class _u extends yu{constructor(e,t,i){super(e,i),this.type="HemisphereLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.groundColor=new Ir(t)}copy(e){return yu.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}_u.prototype.isHemisphereLight=!0;const xu=new Bn,wu=new an,bu=new an;class Tu{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Zi(512,512),this.map=null,this.mapPass=null,this.matrix=new Bn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Us,this._frameExtents=new Zi(1,1),this._viewportCount=1,this._viewports=[new tn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;wu.setFromMatrixPosition(e.matrixWorld),t.position.copy(wu),bu.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(bu),t.updateMatrixWorld(),xu.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(xu),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Mu extends Tu{constructor(){super(new Ls(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,i=2*Ni*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;i===t.fov&&n===t.aspect&&r===t.far||(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Mu.prototype.isSpotLightShadow=!0;class Su extends yu{constructor(e,t,i=0,n=Math.PI/3,r=0,s=1){super(e,t),this.type="SpotLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.target=new cr,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.shadow=new Mu}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Su.prototype.isSpotLight=!0;const Eu=new Bn,Au=new an,Cu=new an;class Pu extends Tu{constructor(){super(new Ls(90,1,.5,500)),this._frameExtents=new Zi(4,2),this._viewportCount=6,this._viewports=[new tn(2,1,1,1),new tn(0,1,1,1),new tn(3,1,1,1),new tn(1,1,1,1),new tn(3,0,1,1),new tn(1,0,1,1)],this._cubeDirections=[new an(1,0,0),new an(-1,0,0),new an(0,0,1),new an(0,0,-1),new an(0,1,0),new an(0,-1,0)],this._cubeUps=[new an(0,1,0),new an(0,1,0),new an(0,1,0),new an(0,1,0),new an(0,0,1),new an(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Au.setFromMatrixPosition(e.matrixWorld),i.position.copy(Au),Cu.copy(i.position),Cu.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Cu),i.updateMatrixWorld(),n.makeTranslation(-Au.x,-Au.y,-Au.z),Eu.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Eu)}}Pu.prototype.isPointLightShadow=!0;class Lu extends yu{constructor(e,t,i=0,n=1){super(e,t),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Pu}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}Lu.prototype.isPointLight=!0;class Ru extends Ps{constructor(e=-1,t=1,i=1,n=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-e,s=i+e,o=n+t,a=n-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,o-=t*this.view.offsetY,a=o-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}Ru.prototype.isOrthographicCamera=!0;class Du extends Tu{constructor(){super(new Ru(-5,5,5,-5,.5,500))}}Du.prototype.isDirectionalLightShadow=!0;class Iu extends yu{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(cr.DefaultUp),this.updateMatrix(),this.target=new cr,this.shadow=new Du}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Iu.prototype.isDirectionalLight=!0;class Ou extends yu{constructor(e,t){super(e,t),this.type="AmbientLight"}}Ou.prototype.isAmbientLight=!0;class Fu extends yu{constructor(e,t,i=10,n=10){super(e,t),this.type="RectAreaLight",this.width=i,this.height=n}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}Fu.prototype.isRectAreaLight=!0;class Vu{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new an)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,n=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*n),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*i),t.addScaledVector(s[4],i*n*1.092548),t.addScaledVector(s[5],n*r*1.092548),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],i*r*1.092548),t.addScaledVector(s[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){const i=e.x,n=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*n),t.addScaledVector(s[2],1.023328*r),t.addScaledVector(s[3],1.023328*i),t.addScaledVector(s[4],.858086*i*n),t.addScaledVector(s[5],.858086*n*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],.858086*i*r),t.addScaledVector(s[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+3*n);return this}toArray(e=[],t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+3*n);return e}static getBasisAt(e,t){const i=e.x,n=e.y,r=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-n*n)}}Vu.prototype.isSphericalHarmonics3=!0;class Uu extends yu{constructor(e=new Vu,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}Uu.prototype.isLightProbe=!0;class Bu extends kh{constructor(e){super(e),this.textures={}}load(e,t,i,n){const r=this,s=new Gh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(i){try{t(r.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}}),i,n)}parse(e){const t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const n=new wh[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&void 0!==n.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=(new Ir).setHex(e.sheen)),void 0!==e.emissive&&void 0!==n.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==n.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(n.transmission=e.transmission),void 0!==e.thickness&&(n.thickness=e.thickness),void 0!==e.attenuationDistance&&(n.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.shadowSide&&(n.shadowSide=e.shadowSide),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(n.morphNormals=e.morphNormals),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.alphaToCoverage&&(n.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(n.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.vertexTangents&&(n.vertexTangents=e.vertexTangents),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const r=e.uniforms[t];switch(n.uniforms[t]={},r.type){case"t":n.uniforms[t].value=i(r.value);break;case"c":n.uniforms[t].value=(new Ir).setHex(r.value);break;case"v2":n.uniforms[t].value=(new Zi).fromArray(r.value);break;case"v3":n.uniforms[t].value=(new an).fromArray(r.value);break;case"v4":n.uniforms[t].value=(new tn).fromArray(r.value);break;case"m3":n.uniforms[t].value=(new Yi).fromArray(r.value);break;case"m4":n.uniforms[t].value=(new Bn).fromArray(r.value);break;default:n.uniforms[t].value=r.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)n.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=i(e.map)),void 0!==e.matcap&&(n.matcap=i(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(n.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),n.normalScale=(new Zi).fromArray(t)}return void 0!==e.displacementMap&&(n.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=i(e.specularMap)),void 0!==e.envMap&&(n.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(n.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Zi).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(n.transmissionMap=i(e.transmissionMap)),void 0!==e.thicknessMap&&(n.thicknessMap=i(e.thicknessMap)),n}setTextures(e){return this.textures=e,this}}class Nu{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}class ku extends rs{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}ku.prototype.isInstancedBufferGeometry=!0;class zu extends Ur{constructor(e,t,i,n){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,i),this.meshPerAttribute=n||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}zu.prototype.isInstancedBufferAttribute=!0;class Gu extends kh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=new Gh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(i){try{t(r.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}}),i,n)}parse(e){const t={},i={};function n(e,n){if(void 0!==t[n])return t[n];const r=e.interleavedBuffers[n],s=function(e,t){if(void 0!==i[t])return i[t];const n=e.arrayBuffers[t],r=new Uint32Array(n).buffer;return i[t]=r,r}(e,r.buffer),o=Kr(r.type,s),a=new ol(o,r.stride);return a.uuid=r.uuid,t[n]=a,a}const r=e.isInstancedBufferGeometry?new ku:new rs,s=e.data.index;if(void 0!==s){const e=Kr(s.type,s.array);r.setIndex(new Ur(e,1))}const o=e.data.attributes;for(const t in o){const i=o[t];let s;if(i.isInterleavedBufferAttribute){const t=n(e.data,i.data);s=new ll(t,i.itemSize,i.offset,i.normalized)}else{const e=Kr(i.type,i.array);s=new(i.isInstancedBufferAttribute?zu:Ur)(e,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),void 0!==i.usage&&s.setUsage(i.usage),void 0!==i.updateRange&&(s.updateRange.offset=i.updateRange.offset,s.updateRange.count=i.updateRange.count),r.setAttribute(t,s)}const a=e.data.morphAttributes;if(a)for(const t in a){const i=a[t],s=[];for(let t=0,r=i.length;t<r;t++){const r=i[t];let o;if(r.isInterleavedBufferAttribute){const t=n(e.data,r.data);o=new ll(t,r.itemSize,r.offset,r.normalized)}else{const e=Kr(r.type,r.array);o=new Ur(e,r.itemSize,r.normalized)}void 0!==r.name&&(o.name=r.name),s.push(o)}r.morphAttributes[t]=s}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];r.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new an;void 0!==c.center&&e.fromArray(c.center),r.boundingSphere=new Pn(e,c.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class ju extends kh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=""===this.path?Nu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const o=new Gh(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(i){let s=null;try{s=JSON.parse(i)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const o=s.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?r.parse(s,t):console.error("THREE.ObjectLoader: Can't load "+e)}),i,n)}parse(e,t){const i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),s=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,i),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in s)if(s[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}parseShapes(e){const t={};if(void 0!==e)for(let i=0,n=e.length;i<n;i++){const n=(new vu).fromJSON(e[i]);t[n.uuid]=n}return t}parseSkeletons(e,t){const i={},n={};if(t.traverse((function(e){e.isBone&&(n[e.uuid]=e)})),void 0!==e)for(let t=0,r=e.length;t<r;t++){const r=(new Bl).fromJSON(e[t],n);i[r.uuid]=r}return i}parseGeometries(e,t){const i={};let n;if(void 0!==e){const r=new Gu;for(let s=0,o=e.length;s<o;s++){let o;const a=e[s];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new hh[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":o=new hh[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new hh[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new hh[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new hh[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new hh[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new hh[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new hh[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new hh[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new hh[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new hh[a.type]((new pu[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new hh[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new hh[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":n=[];for(let e=0,i=a.shapes.length;e<i;e++){const i=t[a.shapes[e]];n.push(i)}o=new hh[a.type](n,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":n=[];for(let e=0,i=a.shapes.length;e<i;e++){const i=t[a.shapes[e]];n.push(i)}const e=a.options.extrudePath;void 0!==e&&(a.options.extrudePath=(new pu[e.type]).fromJSON(e)),o=new hh[a.type](n,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(a);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),!0===o.isBufferGeometry&&void 0!==a.userData&&(o.userData=a.userData),i[a.uuid]=o}}return i}parseMaterials(e,t){const i={},n={};if(void 0!==e){const r=new Bu;r.setTextures(t);for(let t=0,s=e.length;t<s;t++){const s=e[t];if("MultiMaterial"===s.type){const e=[];for(let t=0;t<s.materials.length;t++){const n=s.materials[t];void 0===i[n.uuid]&&(i[n.uuid]=r.parse(n)),e.push(i[n.uuid])}n[s.uuid]=e}else void 0===i[s.uuid]&&(i[s.uuid]=r.parse(s)),n[s.uuid]=i[s.uuid]}}return n}parseAnimations(e){const t={};if(void 0!==e)for(let i=0;i<e.length;i++){const n=e[i],r=Fh.parse(n);t[r.uuid]=r}return t}parseImages(e,t){const i=this,n={};let r;function s(e){if("string"==typeof e){const t=e;return function(e){return i.manager.itemStart(e),r.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:i.resourcePath+t)}return e.data?{data:Kr(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const i=new Bh(t);r=new Wh(i),r.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],r=i.url;if(Array.isArray(r)){n[i.uuid]=[];for(let e=0,t=r.length;e<t;e++){const t=s(r[e]);null!==t&&(t instanceof HTMLImageElement?n[i.uuid].push(t):n[i.uuid].push(new Fl(t.data,t.width,t.height)))}}else{const e=s(i.url);null!==e&&(n[i.uuid]=e)}}}return n}parseTextures(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const n={};if(void 0!==e)for(let r=0,s=e.length;r<s;r++){const s=e[r];let o;void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const a=t[s.image];Array.isArray(a)?(o=new Is(a),6===a.length&&(o.needsUpdate=!0)):(o=a&&a.data?new Fl(a.data,a.width,a.height):new Qi(a),a&&(o.needsUpdate=!0)),o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=i(s.mapping,Hu)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=i(s.wrap[0],Wu),o.wrapT=i(s.wrap[1],Wu)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=i(s.minFilter,qu)),void 0!==s.magFilter&&(o.magFilter=i(s.magFilter,qu)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),n[s.uuid]=o}return n}parseObject(e,t,i,n){let r,s,o;function a(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];void 0===i[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),t.push(i[r])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}switch(e.type){case"Scene":r=new sl,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new Ir(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new rl(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new nl(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new Ls(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new Ru(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new Ou(e.color,e.intensity);break;case"DirectionalLight":r=new Iu(e.color,e.intensity);break;case"PointLight":r=new Lu(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new Fu(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new Su(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new _u(e.color,e.groundColor,e.intensity);break;case"LightProbe":r=(new Uu).fromJSON(e);break;case"SkinnedMesh":s=a(e.geometry),o=l(e.material),r=new Il(s,o),void 0!==e.bindMode&&(r.bindMode=e.bindMode),void 0!==e.bindMatrix&&r.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(r.skeleton=e.skeleton);break;case"Mesh":s=a(e.geometry),o=l(e.material),r=new bs(s,o);break;case"InstancedMesh":s=a(e.geometry),o=l(e.material);const t=e.count,i=e.instanceMatrix,n=e.instanceColor;r=new jl(s,o,t),r.instanceMatrix=new Ur(new Float32Array(i.array),16),void 0!==n&&(r.instanceColor=new Ur(new Float32Array(n.array),n.itemSize));break;case"LOD":r=new Al;break;case"Line":r=new Kl(a(e.geometry),l(e.material));break;case"LineLoop":r=new ec(a(e.geometry),l(e.material));break;case"LineSegments":r=new Ql(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":r=new oc(a(e.geometry),l(e.material));break;case"Sprite":r=new Tl(l(e.material));break;case"Group":r=new Ka;break;case"Bone":r=new Ol;break;default:r=new cr}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(r.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children){const s=e.children;for(let e=0;e<s.length;e++)r.add(this.parseObject(s[e],t,i,n))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const i=t[e];r.animations.push(n[i])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(r.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const i=t[e],n=r.getObjectByProperty("uuid",i.object);void 0!==n&&r.addLevel(n,i.distance)}}return r}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const i=t[e.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(i,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const Hu={UVMapping:re,CubeReflectionMapping:se,CubeRefractionMapping:oe,EquirectangularReflectionMapping:ae,EquirectangularRefractionMapping:le,CubeUVReflectionMapping:ce,CubeUVRefractionMapping:he},Wu={RepeatWrapping:ue,ClampToEdgeWrapping:de,MirroredRepeatWrapping:me},qu={NearestFilter:pe,NearestMipmapNearestFilter:fe,NearestMipmapLinearFilter:ve,LinearFilter:_e,LinearMipmapNearestFilter:xe,LinearMipmapLinearFilter:be};class Xu extends kh{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Uh.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){Uh.add(e,i),t&&t(i),r.manager.itemEnd(e)})).catch((function(t){n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}Xu.prototype.isImageBitmapLoader=!0;class Zu{constructor(){this.type="ShapePath",this.color=new Ir,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new gu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){return this.currentPath.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,r,s){return this.currentPath.bezierCurveTo(e,t,i,n,r,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function i(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i],r=new vu;r.curves=n.curves,t.push(r)}return t}function n(e,t){const i=t.length;let n=!1;for(let r=i-1,s=0;s<i;r=s++){let i=t[r],o=t[s],a=o.x-i.x,l=o.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=t[s],a=-a,o=t[r],l=-l),e.y<i.y||e.y>o.y)continue;if(e.y===i.y){if(e.x===i.x)return!0}else{const t=l*(e.x-i.x)-a*(e.y-i.y);if(0===t)return!0;if(t<0)continue;n=!n}}else{if(e.y!==i.y)continue;if(o.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=o.x)return!0}}return n}const r=qc.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===t)return i(s);let o,a,l;const c=[];if(1===s.length)return a=s[0],l=new vu,l.curves=a.curves,c.push(l),c;let h=!r(s[0].getPoints());h=e?!h:h;const u=[],d=[];let m,p,f=[],g=0;d[g]=void 0,f[g]=[];for(let t=0,i=s.length;t<i;t++)a=s[t],m=a.getPoints(),o=r(m),o=e?!o:o,o?(!h&&d[g]&&g++,d[g]={s:new vu,p:m},d[g].s.curves=a.curves,h&&g++,f[g]=[]):f[g].push({h:a,p:m[0]});if(!d[0])return i(s);if(d.length>1){let e=!1;const t=[];for(let e=0,t=d.length;e<t;e++)u[e]=[];for(let i=0,r=d.length;i<r;i++){const r=f[i];for(let s=0;s<r.length;s++){const o=r[s];let a=!0;for(let r=0;r<d.length;r++)n(o.p,d[r].p)&&(i!==r&&t.push({froms:i,tos:r,hole:s}),a?(a=!1,u[r].push(o)):e=!0);a&&u[i].push(o)}}t.length>0&&(e||(f=u))}for(let e=0,t=d.length;e<t;e++){l=d[e].s,c.push(l),p=f[e];for(let e=0,t=p.length;e<t;e++)l.holes.push(p[e].h)}return c}}class Yu{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){const i=[],n=function(e,t,i){const n=Array.from(e),r=t/i.resolution,s=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*r,o=[];let a=0,l=0;for(let e=0;e<n.length;e++){const t=n[e];if("\n"===t)a=0,l-=s;else{const e=Ku(t,r,a,l,i);a+=e.offsetX,o.push(e.path)}}return o}(e,t,this.data);for(let e=0,t=n.length;e<t;e++)Array.prototype.push.apply(i,n[e].toShapes());return i}}function Ku(e,t,i,n,r){const s=r.glyphs[e]||r.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+r.familyName+".");const o=new Zu;let a,l,c,h,u,d,m,p;if(s.o){const e=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let r=0,s=e.length;r<s;)switch(e[r++]){case"m":a=e[r++]*t+i,l=e[r++]*t+n,o.moveTo(a,l);break;case"l":a=e[r++]*t+i,l=e[r++]*t+n,o.lineTo(a,l);break;case"q":c=e[r++]*t+i,h=e[r++]*t+n,u=e[r++]*t+i,d=e[r++]*t+n,o.quadraticCurveTo(u,d,c,h);break;case"b":c=e[r++]*t+i,h=e[r++]*t+n,u=e[r++]*t+i,d=e[r++]*t+n,m=e[r++]*t+i,p=e[r++]*t+n,o.bezierCurveTo(u,d,m,p,c,h)}}return{offsetX:s.ha*t,path:o}}Yu.prototype.isFont=!0;class $u extends kh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=new Gh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(e){let i;try{i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}const n=r.parse(i);t&&t(n)}),i,n)}parse(e){return new Yu(e)}}let Ju;const Qu={getContext:function(){return void 0===Ju&&(Ju=new(window.AudioContext||window.webkitAudioContext)),Ju},setContext:function(e){Ju=e}};class ed extends kh{constructor(e){super(e)}load(e,t,i,n){const r=this,s=new Gh(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(i){try{const e=i.slice(0);Qu.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}}),i,n)}}class td extends Uu{constructor(e,t,i=1){super(void 0,i);const n=(new Ir).set(e),r=(new Ir).set(t),s=new an(n.r,n.g,n.b),o=new an(r.r,r.g,r.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}}td.prototype.isHemisphereLightProbe=!0;class id extends Uu{constructor(e,t=1){super(void 0,t);const i=(new Ir).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}id.prototype.isAmbientLightProbe=!0;const nd=new Bn,rd=new Bn;class sd{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ls,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ls,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const i=e.projectionMatrix.clone(),n=t.eyeSep/2,r=n*t.near/t.focus,s=t.near*Math.tan(Bi*t.fov*.5)/t.zoom;let o,a;rd.elements[12]=-n,nd.elements[12]=n,o=-s*t.aspect+r,a=s*t.aspect+r,i.elements[0]=2*t.near/(a-o),i.elements[8]=(a+o)/(a-o),this.cameraL.projectionMatrix.copy(i),o=-s*t.aspect-r,a=s*t.aspect-r,i.elements[0]=2*t.near/(a-o),i.elements[8]=(a+o)/(a-o),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(rd),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(nd)}}class od{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=ad(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=ad();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function ad(){return("undefined"==typeof performance?Date:performance).now()}const ld=new an,cd=new on,hd=new an,ud=new an;class dd extends cr{constructor(){super(),this.type="AudioListener",this.context=Qu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new od}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ld,cd,hd),ud.set(0,0,-1).applyQuaternion(cd),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(ld.x,e),t.positionY.linearRampToValueAtTime(ld.y,e),t.positionZ.linearRampToValueAtTime(ld.z,e),t.forwardX.linearRampToValueAtTime(ud.x,e),t.forwardY.linearRampToValueAtTime(ud.y,e),t.forwardZ.linearRampToValueAtTime(ud.z,e),t.upX.linearRampToValueAtTime(i.x,e),t.upY.linearRampToValueAtTime(i.y,e),t.upZ.linearRampToValueAtTime(i.z,e)}else t.setPosition(ld.x,ld.y,ld.z),t.setOrientation(ud.x,ud.y,ud.z,i.x,i.y,i.z)}}class md extends cr{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const pd=new an,fd=new on,gd=new an,vd=new an;class yd extends md{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(pd,fd,gd),vd.set(0,0,1).applyQuaternion(fd);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(pd.x,e),t.positionY.linearRampToValueAtTime(pd.y,e),t.positionZ.linearRampToValueAtTime(pd.z,e),t.orientationX.linearRampToValueAtTime(vd.x,e),t.orientationY.linearRampToValueAtTime(vd.y,e),t.orientationZ.linearRampToValueAtTime(vd.z,e)}else t.setPosition(pd.x,pd.y,pd.z),t.setOrientation(vd.x,vd.y,vd.z)}}class _d{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class xd{constructor(e,t,i){let n,r,s;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,n=this.valueSize,r=e*n+n;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==n;++e)i[r+e]=i[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(i,r,0,e,n)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(i,n,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let e=t,r=t+t;e!==r;++e)if(i[e]!==i[e+t]){o.setValue(i,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let e=i,r=n;e!==r;++e)t[e]=t[n+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)e[t+n]=e[i+n]}_slerp(e,t,i,n){on.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){const s=this._workIndex*r;on.multiplyQuaternionsFlat(e,s,e,t,e,i),on.slerpFlat(e,t,e,t,e,s,n)}_lerp(e,t,i,n,r){const s=1-n;for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]*s+e[i+o]*n}}_lerpAdditive(e,t,i,n,r){for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]+e[i+s]*n}}}const wd="\\[\\]\\.:\\/",bd=new RegExp("["+wd+"]","g"),Td="[^"+wd+"]",Md="[^"+wd.replace("\\.","")+"]",Sd=/((?:WC+[\/:])*)/.source.replace("WC",Td),Ed=/(WCOD+)?/.source.replace("WCOD",Md),Ad=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Td),Cd=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Td),Pd=new RegExp("^"+Sd+Ed+Ad+Cd+"$"),Ld=["material","materials","bones"];class Rd{constructor(e,t,i){this.path=t,this.parsedPath=i||Rd.parseTrackName(t),this.node=Rd.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Rd.Composite(e,t,i):new Rd(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(bd,"")}static parseTrackName(e){const t=Pd.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const e=i.nodeName.substring(n+1);-1!==Ld.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){const i=function(e){for(let n=0;n<e.length;n++){const r=e[n];if(r.name===t||r.uuid===t)return r;const s=i(r.children);if(s)return s}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let r=t.propertyIndex;if(e||(e=Rd.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}const s=e[n];if(void 0===s){const i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Rd.Composite=class{constructor(e,t,i){const n=i||Rd.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},Rd.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Rd.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Rd.prototype.GetterByBindingType=[Rd.prototype._getValue_direct,Rd.prototype._getValue_array,Rd.prototype._getValue_arrayElement,Rd.prototype._getValue_toArray],Rd.prototype.SetterByBindingTypeAndVersioning=[[Rd.prototype._setValue_direct,Rd.prototype._setValue_direct_setNeedsUpdate,Rd.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Rd.prototype._setValue_array,Rd.prototype._setValue_array_setNeedsUpdate,Rd.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Rd.prototype._setValue_arrayElement,Rd.prototype._setValue_arrayElement_setNeedsUpdate,Rd.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Rd.prototype._setValue_fromArray,Rd.prototype._setValue_fromArray_setNeedsUpdate,Rd.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Dd{constructor(){this.uuid=ki(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,s=r.length;let o,a=e.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],u=h.uuid;let d=t[u];if(void 0===d){d=a++,t[u]=d,e.push(h);for(let e=0,t=s;e!==t;++e)r[e].push(new Rd(h,i[e],n[e]))}else if(d<l){o=e[d];const a=--l,c=e[a];t[c.uuid]=d,e[d]=c,t[u]=a,e[a]=h;for(let e=0,t=s;e!==t;++e){const t=r[e],s=t[a];let o=t[d];t[d]=s,void 0===o&&(o=new Rd(h,i[e],n[e])),t[a]=o}}else e[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,l=t[a];if(void 0!==l&&l>=r){const s=r++,c=e[s];t[c.uuid]=l,e[l]=c,t[a]=s,e[s]=o;for(let e=0,t=n;e!==t;++e){const t=i[e],n=t[s],r=t[l];t[l]=n,t[s]=r}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,s=e.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<r){const o=--r,a=e[o],c=--s,h=e[c];t[a.uuid]=l,e[l]=a,t[h.uuid]=o,e[o]=h,e.pop();for(let e=0,t=n;e!==t;++e){const t=i[e],n=t[o],r=t[c];t[l]=n,t[o]=r,t.pop()}}else{const r=--s,o=e[r];r>0&&(t[o.uuid]=l),e[l]=o,e.pop();for(let e=0,t=n;e!==t;++e){const t=i[e];t[l]=t[r],t.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const i=this._bindingsIndicesByPath;let n=i[e];const r=this._bindings;if(void 0!==n)return r[n];const s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,h=new Array(l);n=r.length,i[e]=n,s.push(e),o.push(t),r.push(h);for(let i=c,n=a.length;i!==n;++i){const n=a[i];h[i]=new Rd(n,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){const n=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];t[e[o]]=i,s[i]=a,s.pop(),r[i]=r[o],r.pop(),n[i]=n[o],n.pop()}}}Dd.prototype.isAnimationObjectGroup=!0;class Id{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;const r=t.tracks,s=r.length,o=new Array(s),a={endingStart:Gt,endingEnd:Gt};for(let e=0;e!==s;++e){const t=r[e].createInterpolant(null);o[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ut,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const i=this._clip.duration,n=e._clip.duration,r=n/i,s=i/n;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,r=n.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const n=(e-r)*i;if(n<0||0===i)return;this._startTime=null,t=i*n}t*=this._updateTimeScale(e);const s=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===qt)for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(s),t[i].accumulateAdditive(o);else for(let i=0,r=e.length;i!==r;++i)e[i].evaluate(s),t[i].accumulate(n,o)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let n=this.time+e,r=this._loopCount;const s=i===Bt;if(0===e)return-1===r?n:s&&1==(1&r)?t-n:n;if(i===Vt){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=t||n<0){const i=Math.floor(n/t);n-=t*i,r+=Math.abs(i);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&1==(1&r))return t-n}return n}_setEndings(e,t,i){const n=this._interpolantSettings;i?(n.endingStart=jt,n.endingEnd=jt):(n.endingStart=e?this.zeroSlopeAtStart?jt:Gt:Ht,n.endingEnd=t?this.zeroSlopeAtEnd?jt:Gt:Ht)}_scheduleFading(e,t,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=t,o[1]=r+e,a[1]=i,this}}class Od extends Fi{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,s=e._propertyBindings,o=e._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let e=0;e!==r;++e){const r=n[e],l=r.name;let h=c[l];if(void 0!==h)s[e]=h;else{if(h=s[e],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,l));continue}const n=t&&t._propertyBindings[e].binding.parsedPath;h=new xd(Rd.create(i,l,n),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,l),s[e]=h}o[e].resultBuffer=h.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){const n=this._actions,r=this._actionsByClip;let s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[t];void 0===s&&(s={},n[t]=s),s[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,o=s[n],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete o[r],0===Object.keys(o).length&&delete s[n]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new Sh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){const n=t||this._root,r=n.uuid;let s="string"==typeof e?Fh.findByName(n,e):e;const o=null!==s?s.uuid:e,a=this._actionsByClip[o];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:Wt),void 0!==a){const e=a.actionByRoot[r];if(void 0!==e&&e.blendMode===i)return e;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new Id(this,s,t,i);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(e,t){const i=t||this._root,n=i.uuid,r="string"==typeof e?Fh.findByName(i,e):e,s=r?r.uuid:e,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let o=0;o!==i;++o)t[o]._update(n,e,r,s);const o=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)o[e].apply(s);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const e=r.knownActions;for(let i=0,n=e.length;i!==n;++i){const n=e[i];this._deactivateAction(n);const r=n._cacheIndex,s=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const e in i){const n=i[e].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[t];if(void 0!==n)for(const e in n){const t=n[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}Od.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Fd{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Fd(void 0===this.value.clone?this.value:this.value.clone())}}class Vd extends ol{constructor(e,t,i=1){super(e,t),this.meshPerAttribute=i||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}Vd.prototype.isInstancedInterleavedBuffer=!0;class Ud{constructor(e,t,i,n,r){this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}Ud.prototype.isGLBufferAttribute=!0;class Bd{constructor(e,t,i=0,n=1/0){this.ray=new Un(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new Yn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!1,i=[]){return kd(e,this,i,t),i.sort(Nd),i}intersectObjects(e,t=!1,i=[]){for(let n=0,r=e.length;n<r;n++)kd(e[n],this,i,t);return i.sort(Nd),i}}function Nd(e,t){return e.distance-t.distance}function kd(e,t,i,n){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===n){const n=e.children;for(let e=0,r=n.length;e<r;e++)kd(n[e],t,i,!0)}}class zd{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(zi(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Gd{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const jd=new Zi;class Hd{constructor(e=new Zi(1/0,1/0),t=new Zi(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=jd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Zi),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Zi),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Zi),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Zi),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return jd.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Hd.prototype.isBox2=!0;const Wd=new an,qd=new an;class Xd{constructor(e=new an,t=new an){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new an),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new an),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new an),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Wd.subVectors(e,this.start),qd.subVectors(this.end,this.start);const i=qd.dot(qd);let n=qd.dot(Wd)/i;return t&&(n=zi(n,0,1)),n}closestPointToPoint(e,t,i){const n=this.closestPointToPointParameter(e,t);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new an),this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class Zd extends cr{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}Zd.prototype.isImmediateRenderObject=!0;const Yd=new an;class Kd extends cr{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const i=new rs,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,i=32;e<i;e++,t++){const r=e/i*Math.PI*2,s=t/i*Math.PI*2;n.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new qr(n,3));const r=new Hl({fog:!1,toneMapped:!1});this.cone=new Ql(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Yd.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Yd),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const $d=new an,Jd=new Bn,Qd=new Bn;class em extends Ql{constructor(e){const t=tm(e),i=new rs,n=[],r=[],s=new Ir(0,0,1),o=new Ir(0,1,0);for(let e=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(s.r,s.g,s.b),r.push(o.r,o.g,o.b))}i.setAttribute("position",new qr(n,3)),i.setAttribute("color",new qr(r,3)),super(i,new Hl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,n=i.getAttribute("position");Qd.copy(this.root.matrixWorld).invert();for(let e=0,i=0;e<t.length;e++){const r=t[e];r.parent&&r.parent.isBone&&(Jd.multiplyMatrices(Qd,r.matrixWorld),$d.setFromMatrixPosition(Jd),n.setXYZ(i,$d.x,$d.y,$d.z),Jd.multiplyMatrices(Qd,r.parent.matrixWorld),$d.setFromMatrixPosition(Jd),n.setXYZ(i+1,$d.x,$d.y,$d.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function tm(e){const t=[];e&&e.isBone&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,tm(e.children[i]));return t}class im extends bs{constructor(e,t,i){super(new nh(t,4,2),new Or({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const nm=new an,rm=new Ir,sm=new Ir;class om extends cr{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const n=new Qc(t);n.rotateY(.5*Math.PI),this.material=new Or({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=n.getAttribute("position"),s=new Float32Array(3*r.count);n.setAttribute("color",new Ur(s,3)),this.add(new bs(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");rm.copy(this.light.color),sm.copy(this.light.groundColor);for(let e=0,i=t.count;e<i;e++){const n=e<i/2?rm:sm;t.setXYZ(e,n.r,n.g,n.b)}t.needsUpdate=!0}e.lookAt(nm.setFromMatrixPosition(this.light.matrixWorld).negate())}}class am extends Ql{constructor(e=10,t=10,i=4473924,n=8947848){i=new Ir(i),n=new Ir(n);const r=t/2,s=e/t,o=e/2,a=[],l=[];for(let e=0,c=0,h=-o;e<=t;e++,h+=s){a.push(-o,0,h,o,0,h),a.push(h,0,-o,h,0,o);const t=e===r?i:n;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new rs;c.setAttribute("position",new qr(a,3)),c.setAttribute("color",new qr(l,3)),super(c,new Hl({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class lm extends Ql{constructor(e=10,t=16,i=8,n=64,r=4473924,s=8947848){r=new Ir(r),s=new Ir(s);const o=[],a=[];for(let i=0;i<=t;i++){const n=i/t*(2*Math.PI),l=Math.sin(n)*e,c=Math.cos(n)*e;o.push(0,0,0),o.push(l,0,c);const h=1&i?r:s;a.push(h.r,h.g,h.b),a.push(h.r,h.g,h.b)}for(let t=0;t<=i;t++){const l=1&t?r:s,c=e-e/i*t;for(let e=0;e<n;e++){let t=e/n*(2*Math.PI),i=Math.sin(t)*c,r=Math.cos(t)*c;o.push(i,0,r),a.push(l.r,l.g,l.b),t=(e+1)/n*(2*Math.PI),i=Math.sin(t)*c,r=Math.cos(t)*c,o.push(i,0,r),a.push(l.r,l.g,l.b)}}const l=new rs;l.setAttribute("position",new qr(o,3)),l.setAttribute("color",new qr(a,3)),super(l,new Hl({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const cm=new an,hm=new an,um=new an;class dm extends cr{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1);let n=new rs;n.setAttribute("position",new qr([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Hl({fog:!1,toneMapped:!1});this.lightPlane=new Kl(n,r),this.add(this.lightPlane),n=new rs,n.setAttribute("position",new qr([0,0,0,0,0,1],3)),this.targetLine=new Kl(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){cm.setFromMatrixPosition(this.light.matrixWorld),hm.setFromMatrixPosition(this.light.target.matrixWorld),um.subVectors(hm,cm),this.lightPlane.lookAt(hm),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(hm),this.targetLine.scale.z=um.length()}}const mm=new an,pm=new Ps;class fm extends Ql{constructor(e){const t=new rs,i=new Hl({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={},o=new Ir(16755200),a=new Ir(16711680),l=new Ir(43775),c=new Ir(16777215),h=new Ir(3355443);function u(e,t,i){d(e,i),d(t,i)}function d(e,t){n.push(0,0,0),r.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(n.length/3-1)}u("n1","n2",o),u("n2","n4",o),u("n4","n3",o),u("n3","n1",o),u("f1","f2",o),u("f2","f4",o),u("f4","f3",o),u("f3","f1",o),u("n1","f1",o),u("n2","f2",o),u("n3","f3",o),u("n4","f4",o),u("p","n1",a),u("p","n2",a),u("p","n3",a),u("p","n4",a),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",c),u("p","c",h),u("cn1","cn2",h),u("cn3","cn4",h),u("cf1","cf2",h),u("cf3","cf4",h),t.setAttribute("position",new qr(n,3)),t.setAttribute("color",new qr(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){const e=this.geometry,t=this.pointMap;pm.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),gm("c",t,e,pm,0,0,-1),gm("t",t,e,pm,0,0,1),gm("n1",t,e,pm,-1,-1,-1),gm("n2",t,e,pm,1,-1,-1),gm("n3",t,e,pm,-1,1,-1),gm("n4",t,e,pm,1,1,-1),gm("f1",t,e,pm,-1,-1,1),gm("f2",t,e,pm,1,-1,1),gm("f3",t,e,pm,-1,1,1),gm("f4",t,e,pm,1,1,1),gm("u1",t,e,pm,.7,1.1,-1),gm("u2",t,e,pm,-.7,1.1,-1),gm("u3",t,e,pm,0,2,-1),gm("cf1",t,e,pm,-1,0,1),gm("cf2",t,e,pm,1,0,1),gm("cf3",t,e,pm,0,-1,1),gm("cf4",t,e,pm,0,1,1),gm("cn1",t,e,pm,-1,0,-1),gm("cn2",t,e,pm,1,0,-1),gm("cn3",t,e,pm,0,-1,-1),gm("cn4",t,e,pm,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function gm(e,t,i,n,r,s,o){mm.set(r,s,o).unproject(n);const a=t[e];if(void 0!==a){const e=i.getAttribute("position");for(let t=0,i=a.length;t<i;t++)e.setXYZ(a[t],mm.x,mm.y,mm.z)}}const vm=new hn;class ym extends Ql{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new rs;r.setIndex(new Ur(i,1)),r.setAttribute("position",new Ur(n,3)),super(r,new Hl({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&vm.setFromObject(this.object),vm.isEmpty())return;const t=vm.min,i=vm.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=t.x,r[4]=i.y,r[5]=i.z,r[6]=t.x,r[7]=t.y,r[8]=i.z,r[9]=i.x,r[10]=t.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=t.z,r[15]=t.x,r[16]=i.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=i.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Ql.prototype.copy.call(this,e),this.object=e.object,this}}class _m extends Ql{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new rs;n.setIndex(new Ur(i,1)),n.setAttribute("position",new qr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new Hl({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class xm extends Kl{constructor(e,t=1,i=16776960){const n=i,r=new rs;r.setAttribute("position",new qr([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new Hl({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const s=new rs;s.setAttribute("position",new qr([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new bs(s,new Or({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?f:p,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const wm=new an;let bm,Tm;class Mm extends cr{constructor(e=new an(0,0,1),t=new an(0,0,0),i=1,n=16776960,r=.2*i,s=.2*r){super(),this.type="ArrowHelper",void 0===bm&&(bm=new rs,bm.setAttribute("position",new qr([0,0,0,0,1,0],3)),Tm=new mc(0,.5,1,5,1),Tm.translate(0,-.5,0)),this.position.copy(t),this.line=new Kl(bm,new Hl({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new bs(Tm,new Or({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{wm.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(wm,t)}}setLength(e,t=.2*e,i=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class Sm extends Ql{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new rs;i.setAttribute("position",new qr(t,3)),i.setAttribute("color",new qr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new Hl({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Em=new Float32Array(1),Am=new Int32Array(Em.buffer);class Cm{static toHalfFloat(e){Em[0]=e;const t=Am[0];let i=t>>16&32768,n=t>>12&2047;const r=t>>23&255;return r<103?i:r>142?(i|=31744,i|=(255==r?0:1)&&8388607&t,i):r<113?(n|=2048,i|=(n>>114-r)+(n>>113-r&1),i):(i|=r-112<<10|n>>1,i+=1&n,i)}}const Pm=Math.pow(2,8),Lm=[.125,.215,.35,.446,.526,.582],Rm=5+Lm.length,Dm={[Kt]:0,[$t]:1,[Qt]:2,[ti]:3,[ii]:4,[ni]:5,[Jt]:6},Im=new Or({side:f,depthWrite:!1,depthTest:!1}),Om=new bs(new Ms,Im),Fm=new Ru,{_lodPlanes:Vm,_sizeLods:Um,_sigmas:Bm}=Xm(),Nm=new Ir;let km=null;const zm=(1+Math.sqrt(5))/2,Gm=1/zm,jm=[new an(1,1,1),new an(-1,1,1),new an(1,1,-1),new an(-1,1,-1),new an(0,zm,Gm),new an(0,zm,-Gm),new an(Gm,0,zm),new an(-Gm,0,zm),new an(zm,Gm,0),new an(-zm,Gm,0)];function Hm(e){const t=Math.max(e.r,e.g,e.b),i=Math.min(Math.max(Math.ceil(Math.log2(t)),-128),127);return e.multiplyScalar(Math.pow(2,-i)),(i+128)/255}class Wm{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(20),i=new an(0,1,0);return new dh({name:"SphericalGaussianBlur",defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:Dm[Kt]},outputEncoding:{value:Dm[Kt]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:_,depthTest:!1,depthWrite:!1})}(),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){km=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=$m(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Km(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<Vm.length;e++)Vm[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(km),e.scissorTest=!1,Ym(e,0,0,e.width,e.height)}_fromTexture(e){km=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:pe,minFilter:pe,generateMipmaps:!1,type:Me,format:ze,encoding:qm(e)?e.encoding:Qt,depthBuffer:!1},i=Zm(t);return i.depthBuffer=!e,this._pingPongRenderTarget=Zm(t),i}_compileMaterial(e){const t=new bs(Vm[0],e);this._renderer.compile(t,Fm)}_sceneToCubeUV(e,t,i,n){const r=new Ls(90,1,t,i),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.outputEncoding,h=a.toneMapping;a.getClearColor(Nm),a.toneMapping=J,a.outputEncoding=Kt,a.autoClear=!1;let u=!1;const d=e.background;if(d){if(d.isColor){Im.color.copy(d).convertSRGBToLinear(),e.background=null;const t=Hm(Im.color);Im.opacity=t,u=!0}}else{Im.color.copy(Nm).convertSRGBToLinear();const e=Hm(Im.color);Im.opacity=e,u=!0}for(let t=0;t<6;t++){const i=t%3;0==i?(r.up.set(0,s[t],0),r.lookAt(o[t],0,0)):1==i?(r.up.set(0,0,s[t]),r.lookAt(0,o[t],0)):(r.up.set(0,s[t],0),r.lookAt(0,0,o[t])),Ym(n,i*Pm,t>2?Pm:0,Pm,Pm),a.setRenderTarget(n),u&&a.render(Om,r),a.render(e,r)}a.toneMapping=h,a.outputEncoding=c,a.autoClear=l}_textureToCubeUV(e,t){const i=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=$m()):null==this._equirectShader&&(this._equirectShader=Km());const n=e.isCubeTexture?this._cubemapShader:this._equirectShader,r=new bs(Vm[0],n),s=n.uniforms;s.envMap.value=e,e.isCubeTexture||s.texelSize.value.set(1/e.image.width,1/e.image.height),s.inputEncoding.value=Dm[e.encoding],s.outputEncoding.value=Dm[t.texture.encoding],Ym(t,0,0,3*Pm,2*Pm),i.setRenderTarget(t),i.render(r,Fm)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let t=1;t<Rm;t++){const i=Math.sqrt(Bm[t]*Bm[t]-Bm[t-1]*Bm[t-1]),n=jm[(t-1)%jm.length];this._blur(e,t-1,t,i,n)}t.autoClear=i}_blur(e,t,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,n,"latitudinal",r),this._halfBlur(s,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new bs(Vm[n],l),h=l.uniforms,u=Um[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,m=r/d,p=isFinite(r)?1+Math.floor(3*m):20;p>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const f=[];let g=0;for(let e=0;e<20;++e){const t=e/m,i=Math.exp(-t*t/2);f.push(i),0==e?g+=i:e<p&&(g+=2*i)}for(let e=0;e<f.length;e++)f[e]=f[e]/g;h.envMap.value=e.texture,h.samples.value=p,h.weights.value=f,h.latitudinal.value="latitudinal"===s,o&&(h.poleAxis.value=o),h.dTheta.value=d,h.mipInt.value=8-i,h.inputEncoding.value=Dm[e.texture.encoding],h.outputEncoding.value=Dm[e.texture.encoding];const v=Um[n];Ym(t,3*Math.max(0,Pm-2*v),(0===n?0:2*Pm)+2*v*(n>4?n-8+4:0),3*v,2*v),a.setRenderTarget(t),a.render(c,Fm)}}function qm(e){return void 0!==e&&e.type===Me&&(e.encoding===Kt||e.encoding===$t||e.encoding===Jt)}function Xm(){const e=[],t=[],i=[];let n=8;for(let r=0;r<Rm;r++){const s=Math.pow(2,n);t.push(s);let o=1/s;r>4?o=Lm[r-8+4-1]:0==r&&(o=0),i.push(o);const a=1/(s-1),l=-a/2,c=1+a/2,h=[l,l,c,l,c,c,l,l,c,c,l,c],u=6,d=6,m=3,p=2,f=1,g=new Float32Array(m*d*u),v=new Float32Array(p*d*u),y=new Float32Array(f*d*u);for(let e=0;e<u;e++){const t=e%3*2/3-1,i=e>2?0:-1,n=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];g.set(n,m*d*e),v.set(h,p*d*e);const r=[e,e,e,e,e,e];y.set(r,f*d*e)}const _=new rs;_.setAttribute("position",new Ur(g,m)),_.setAttribute("uv",new Ur(v,p)),_.setAttribute("faceIndex",new Ur(y,f)),e.push(_),n>4&&n--}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}function Zm(e){const t=new nn(3*Pm,3*Pm,e);return t.texture.mapping=ce,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Ym(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function Km(){const e=new Zi(1,1);return new dh({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Dm[Kt]},outputEncoding:{value:Dm[Kt]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:_,depthTest:!1,depthWrite:!1})}function $m(){return new dh({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Dm[Kt]},outputEncoding:{value:Dm[Kt]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:_,depthTest:!1,depthWrite:!1})}const Jm=0,Qm=1,ep=0,tp=1,ip=2;function np(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function rp(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function sp(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new oc(e,t)}function op(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Tl(e)}function ap(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new oc(e,t)}function lp(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new tc(e)}function cp(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new tc(e)}function hp(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new tc(e)}function up(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new an(e,t,i)}function dp(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Ur(e,t).setUsage(Si)}function mp(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Br(e,t)}function pp(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Nr(e,t)}function fp(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new kr(e,t)}function gp(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new zr(e,t)}function vp(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Gr(e,t)}function yp(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new jr(e,t)}function _p(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Hr(e,t)}function xp(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new qr(e,t)}function wp(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Xr(e,t)}function bp(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Sm(e)}function Tp(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new ym(e,t)}function Mp(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Ql(new wc(e.geometry),new Hl({color:void 0!==t?t:16777215}))}function Sp(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Ql(new ch(e.geometry),new Hl({color:void 0!==t?t:16777215}))}function Ep(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Gh(e)}function Ap(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Xh(e)}function Cp(e,t,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Os(e,i)}function Pp(){console.error("THREE.CanvasRenderer has been removed")}function Lp(){console.error("THREE.JSONLoader has been removed.")}Yh.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Yh.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},gu.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},am.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},em.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},kh.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Nu.extractUrlBase(e)},kh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Hd.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},Hd.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Hd.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Hd.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},hn.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},hn.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},hn.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},hn.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},hn.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Pn.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Us.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Xd.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Yi.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Yi.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Yi.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Yi.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Yi.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Yi.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Bn.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Bn.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Bn.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new an).setFromMatrixColumn(this,3)},Bn.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Bn.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Bn.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Bn.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Bn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Bn.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Bn.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Bn.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Bn.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Bn.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Bn.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Bn.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Bn.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Bn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Bn.prototype.makeFrustum=function(e,t,i,n,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,i,r,s)},Bn.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},mr.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},on.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},on.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Un.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Un.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},Un.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Mr.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Mr.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},Mr.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},Mr.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},Mr.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},Mr.barycoordFromPoint=function(e,t,i,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Mr.getBarycoord(e,t,i,n,r)},Mr.normal=function(e,t,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Mr.getNormal(e,t,i,n)},vu.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},vu.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Yc(this,e)},vu.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ih(this,e)},Zi.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},Zi.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Zi.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},an.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},an.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},an.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},an.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},an.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},an.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},an.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},an.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},an.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},tn.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},tn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},cr.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},cr.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},cr.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},cr.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},cr.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(cr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),bs.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(bs.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Xt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Il.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Ls.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(yu.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Ur.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Si},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Si)}}}),Ur.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Si:Mi),this},Ur.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Ur.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},rs.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},rs.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Ur(arguments[1],arguments[2])))},rs.prototype.addDrawCall=function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},rs.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},rs.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},rs.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},rs.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(rs.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),ol.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Si:Mi),this},ol.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Yc.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Yc.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Yc.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},sl.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Fd.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Er.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ir}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===v}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Cs.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),tl.prototype.clearTarget=function(e,t,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,n)},tl.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},tl.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},tl.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},tl.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},tl.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},tl.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},tl.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},tl.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},tl.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},tl.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},tl.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},tl.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},tl.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},tl.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},tl.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},tl.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},tl.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},tl.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},tl.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},tl.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},tl.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},tl.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},tl.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},tl.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(tl.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?$t:Kt}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Wa.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(nn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),md.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new ed).load(e,(function(e){t.setBuffer(e)})),this},_d.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Ds.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Ds.prototype.clear=function(e,t,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,i,n)},$i.crossOrigin=void 0,$i.loadTexture=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new Zh;r.setCrossOrigin(this.crossOrigin);const s=r.load(e,i,void 0,n);return t&&(s.mapping=t),s},$i.loadTextureCube=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new qh;r.setCrossOrigin(this.crossOrigin);const s=r.load(e,i,void 0,n);return t&&(s.mapping=t),s},$i.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},$i.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Rp={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function Dp(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:n}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=n)},7769:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(5185),t),r(i(6406),t),r(i(6114),t),r(i(8934),t),r(i(1072),t),r(i(7259),t),r(i(8284),t),r(i(1017),t),r(i(1370),t),r(i(1216),t),r(i(8131),t)},8152:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(7395),t),r(i(8920),t),r(i(4835),t),r(i(9421),t),r(i(9362),t),r(i(7980),t),r(i(2286),t),r(i(3253),t),r(i(8770),t),r(i(1072),t)},3253:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scaleHeight=t.getFeatureText=t.getFeatureName=t.getFeatureId=t.getProjectionName=t.getProjection=t.GeometryType=t.getArrayConstructor=void 0;const n=i(2616),r=i(1984),s=i(3561);function o(e,t,i,n,r){var s;let o;if(void 0===t&&(t="name"),i){const i=e.lookup(`${t}:short`);if("string"==typeof i&&i.length>0)return i}if(n){const t=e.lookup("iso_code");if("string"==typeof t&&t.length>0)return t}if(void 0!==r)for(const i of r)if(o=null!==(s=e.lookup(`${t}:${i}`))&&void 0!==s?s:e.lookup(`${t}_${i}`),"string"==typeof o&&o.length>0)return o;if(o=e.lookup(t),"string"==typeof o)return o}var a;t.getArrayConstructor=function(e){switch(e){case"float":return Float32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array}},(a=t.GeometryType||(t.GeometryType={}))[a.Unspecified=0]="Unspecified",a[a.Point=1]="Point",a[a.Line=2]="Line",a[a.SolidLine=3]="SolidLine",a[a.Text=4]="Text",a[a.TextPath=5]="TextPath",a[a.ExtrudedLine=6]="ExtrudedLine",a[a.Polygon=7]="Polygon",a[a.ExtrudedPolygon=8]="ExtrudedPolygon",a[a.Object3D=9]="Object3D",a[a.Other=1e3]="Other",t.getProjection=function(e){switch(e){case"mercator":return n.mercatorProjection;case"webMercator":return n.webMercatorProjection;case"sphere":return n.sphereProjection;case"normalizedEquirectangular":return n.normalizedEquirectangularProjection;case"equirectangular":return n.equirectangularProjection;default:throw new Error(`Unknown projection ${e}`)}},t.getProjectionName=function(e){if(e===n.mercatorProjection)return"mercator";if(e===n.webMercatorProjection)return"webMercator";if(e===n.sphereProjection)return"sphere";if(e===n.normalizedEquirectangularProjection)return"normalizedEquirectangular";if(e===n.equirectangularProjection)return"equirectangular";throw new Error("Unknown projection")},t.getFeatureId=function(e){if(void 0===e)return 0;if("string"==typeof e||"number"==typeof e)return e;if(e.hasOwnProperty("$id")){const t=e.$id;if("string"==typeof t||"number"==typeof t)return t}return 0},t.getFeatureName=o,t.getFeatureText=function(e,t,i){let n,a;const l=e instanceof r.Env?e:e.env;let c="name";if((0,r.isTextTechnique)(t)||(0,r.isIconTextTechnique)(t)||(0,r.isLineMarkerTechnique)(t)){if(void 0!==t.text)return(0,s.evaluateTechniqueAttr)(e,t.text);if(void 0!==t.label&&(c=(0,s.evaluateTechniqueAttr)(e,t.label),"string"!=typeof c))return;n=t.useAbbreviation,a=t.useIsoCode}return o(l,c,n,a,i)},t.scaleHeight=function(e,t,i){return!(0,s.evaluateTechniqueAttr)(e,t.constantHeight,i<12)}},1072:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFeatureGeometry=void 0,t.isFeatureGeometry=function(e){const t=e.type;return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}},6406:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7980:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2286:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6114:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addPolygonEdges=void 0;const n=i(82),r=new n.Vector2,s=new n.Vector2,o=new n.Vector2,a=new n.Vector2;t.addPolygonEdges=function(e,t,i,n,l,c,h,u){for(let d=0;d<l.length;++d)if(l[d])if(!0===c){const c=t+2*d,m=c+1,p=t+(d+1)%l.length*2,f=p+1;!0===h&&e.push(c,p),e.push(m,f);const g=(0===d?l.length:d)-1;if(l[g])if(void 0!==u){const t=n[d*i],h=n[d*i+1],p=n[(d+1)%l.length*i],f=n[(d+1)%l.length*i+1];r.set(t,h),s.set(p,f),o.set(n[g*i],n[g*i+1]),a.set(r.x,r.y),a.sub(o).normalize().dot(s.sub(r).normalize())<=u&&e.push(c,m)}else e.push(c,m)}else{const i=t+d,n=t+(d+1)%l.length;e.push(i,n)}}},7395:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8920:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPropertyValue=void 0;const n=i(1984),r=i(4342).LoggerManager.instance.create("PropertyValue");t.getPropertyValue=function(e,t,i){try{return(0,n.getPropertyValue)(e,t,i)}catch(t){return r.error("failed to evaluate expression",JSON.stringify(e),"error",String(t)),null}}},5185:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeDecodedTechnique=t.StyleSetEvaluator=void 0;const n=i(1984),r=i(8023),s=i(8797),o=i(8628),a=i(4342),l=i(5535),c=a.LoggerManager.instance.create("StyleSetEvaluator"),h=l.AttrScope.TechniqueGeometry;class u{classify(e){if(e._whenExpr){const t=this.switchStyle(e);e._whenExpr=e._whenExpr.accept(this,void 0),this._style=t}}visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){return e}visitHasAttributeExpr(e,t){return e}visitMatchExpr(e,t){return e}visitCaseExpr(e,t){return e}visitCallExpr(e,t){if("all"===e.op){const t=e.args.map((t=>t.accept(this,e))).filter((e=>void 0!==e));return new r.CallExpr(e.op,t)}if(t){const t=this.matchVarStringComparison(e);if(t){if(void 0===this._style.layer&&"$layer"===t.name)return void(this._style.layer=t.value);if(void 0===this._style._geometryType&&"$geometryType"===t.name)return void(this._style._geometryType=t.value)}}return e}visitLookupExpr(e,t){return this.visitCallExpr(e,t)}visitStepExpr(e,t){return e}visitInterpolateExpr(e,t){return e}matchVarStringComparison(e){if("=="===e.op){const t=e.args[0],i=e.args[1];if(t instanceof r.VarExpr&&i instanceof r.StringLiteralExpr)return{name:t.name,value:i.value};if(i instanceof r.VarExpr&&t instanceof r.StringLiteralExpr)return{name:i.name,value:t.value}}}switchStyle(e){const t=this._style;return this._style=e,t}}class d{constructor(e,t){this.key="",this.set(e,t)}set(e,t,i){let n=!1;if(void 0===e){const t=void 0!==i?i.lookup("$layer"):void 0;e="string"==typeof t?t:void 0}if(this.layer!==e&&(this.layer=e,n=!0),void 0===t){const e=void 0!==i?i.lookup("$geometryType"):void 0;t="string"==typeof e?e:void 0}return this.geometryType!==t&&(this.geometryType=t,n=!0),n&&this.updateKey(),this}updateKey(){void 0!==this.layer?void 0!==this.geometryType?this.key=`${this.layer}:${this.geometryType}`:this.key=`${this.layer}:`:void 0!==this.geometryType?this.key=`:${this.geometryType}`:this.key="all",this.cachedStyleSet=void 0}}function m(e){const t={};for(const i in e){if(!e.hasOwnProperty(i))continue;let n=e[i];"object"==typeof n&&(n.isVector2||n.isVector3||n.isVector4)&&(n=r.LiteralExpr.fromValue(n)),r.Expr.isExpr(n)&&(n=n.toJSON()),t[i]=n}return t}t.StyleSetEvaluator=class{constructor(e){this.m_options=e,this.styleSet=[],this.m_techniques=[],this.m_exprPool=new s.ExprPool,this.m_cachedResults=new Map,this.m_styleConditionClassifier=new u,this.m_subStyleSetCache=new Map,this.m_areCurrentDefinitionsOverridden=!0,this.m_definitionsContainVerbose=!1,this.m_disabledStyles={byId:new Set,byLayer:new Set},this.m_definitionExprCache=new Map,this.m_tmpOptimizedSubSetKey=new d,this.m_emptyEnv=new n.Env,this.m_featureDependencies=["$layer","$geometryType","$zoom"],this.m_nextArrayBufferId=0,this.m_definitions=this.m_options.definitions;for(const e in this.m_definitions)this.m_definitionsContainVerbose||(this.m_definitionsContainVerbose=(0,n.isVerboseDefinition)(this.m_definitions[e]));this.styleSet=this.m_options.styleSet.map((e=>Object.assign(Object.assign({},e),{_forceCompile:!0}))),function(e){let t=0,i=0;for(const n of e)n._styleSetIndex=i++,void 0!==n.technique&&void 0===n.renderOrder&&(n.renderOrder=t++)}(this.styleSet),this.m_features=this.validateFeatures(this.m_options.features);const t=[];for(const e in this.m_features)this.m_features[e].modes.forEach((e=>{e.extendedDefinitions&&Array.prototype.push.apply(t,Object.keys(e.extendedDefinitions))}));this.m_modesDefinitions=new Set(t),this.setEnabledFeatures(e.enabledFeatures)}setEnabledFeatures(e){this.applyFeaturesAndModes(null!=e?e:this.getFeaturesEnabledByDefault())}getFeaturesEnabledByDefault(){var e;const t=[];if(this.m_features)for(const i in this.m_features){const n=this.m_features[i];n.enabledByDefault&&t.push({feature:i,mode:null===(e=n.modes[0])||void 0===e?void 0:e.name})}return t}applyFeaturesAndModes(e){if(this.m_disabledStyles.byId.clear(),this.m_disabledStyles.byLayer.clear(),this.resetTechniques(),this.m_areCurrentDefinitionsOverridden&&(this.m_definitionsContainVerbose?this.m_currentDefinitions=JSON.parse(JSON.stringify(this.m_definitions)):this.m_currentDefinitions=Object.assign({},this.m_definitions),this.m_areCurrentDefinitionsOverridden=!1),this.m_features)for(const t in this.m_features){const i=this.m_features[t];let n;const r=e.find((e=>e.feature===t));r?(n=i.modes.find((e=>e.name===r.mode)),n||(n=i.modes[0])):n=i.disabledMode,n.disabledLayers&&n.disabledLayers.forEach((e=>{this.m_disabledStyles.byLayer.add(e)})),n.disabledStyleRules&&n.disabledStyleRules.forEach((e=>{this.m_disabledStyles.byId.add(e)})),this.m_currentDefinitions&&(null==n?void 0:n.extendedDefinitions)&&(this.m_areCurrentDefinitionsOverridden=!0,Object.assign(this.m_currentDefinitions,null==n?void 0:n.extendedDefinitions))}this.m_definitionExprCache.clear(),this.m_cachedResults.clear(),this.m_subStyleSetCache.clear(),this.compileStyleSet()}validateFeatures(e){const t={};for(const i in e){const n=e[i];Array.isArray(n.modes)&&0!==n.modes.length&&void 0!==n.disabledMode?t[i]=n:c.error(`The style configuration is invalid. The feature "${i}" must be an array, have at least one mode and specify a value for disabledMode property`)}if(Object.keys(t).length>0)return t}isStyleDisabled(e){if(void 0!==this.m_disabledStyles){if(void 0!==e.styleSet&&this.m_disabledStyles.byLayer.has(e.styleSet))return!0;if(void 0!==e.id&&this.m_disabledStyles.byId.has(e.id))return!0}return!1}getMatchingTechniques(e,t,i){if(this.m_previousResult&&this.m_previousEnv&&this.m_featureDependencies.every((t=>{var i;return(null===(i=this.m_previousEnv)||void 0===i?void 0:i.lookup(t))===e.lookup(t)})))return this.m_previousResult;const n=[];this.m_cachedResults.clear();const r=this.m_tmpOptimizedSubSetKey;r.set(t,i,e),this.m_layer=r.layer,this.m_geometryType=r.geometryType,this.m_zoomLevel=e.lookup("$zoom");const s=this.getOptimizedStyleSet(r);for(const t of s)if(this.processStyle(e,t,n))break;return this.m_previousResult=n,this.m_previousEnv=e,n}wantsLayer(e){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,void 0)).length>0}wantsFeature(e,t){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,t)).length>0}resetTechniques(){for(const e of this.m_techniques)e._index=void 0;this.m_techniques.length=0,this.m_previousResult=void 0,this.m_previousEnv=void 0}get techniques(){return this.m_techniques}get decodedTechniques(){return this.m_techniques.map(m)}getOptimizedStyleSet(e){if(void 0!==e.cachedStyleSet)return e.cachedStyleSet;let t=this.m_subStyleSetCache.get(e.key);return void 0!==t?(e.cachedStyleSet=t,t):(t=this.createPreFilteredStyleSet(e),this.m_subStyleSetCache.set(e.key,t),e.cachedStyleSet=t,t)}createPreFilteredStyleSet(e){const{layer:t,geometryType:i}=e;return this.styleSet.filter((e=>!(void 0!==t&&void 0!==e.layer&&e.layer!==t||void 0!==i&&void 0!==e._geometryType&&e._geometryType!==i)))}compileStyleSet(){this.styleSet.forEach((e=>this.compileStyle(e))),this.styleSet.forEach((e=>{this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e.layer,e._geometryType))}))}compileStyle(e){if(this.compileStyleAttributes(e),void 0!==e.when)try{e._whenExpr=Array.isArray(e.when)?r.Expr.fromJSON(e.when,this.m_currentDefinitions,this.m_definitionExprCache):r.Expr.parse(e.when),this.m_styleConditionClassifier.classify(e),void 0!==e._whenExpr&&(e._whenExpr=e._whenExpr.intern(this.m_exprPool));const t=e._whenExpr.dependencies();null==t||t.properties.forEach((e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)})),(0,n.isJsonExpr)(e.minZoomLevel)&&(e._minZoomLevelExpr=r.Expr.fromJSON(e.minZoomLevel,this.m_currentDefinitions,void 0).intern(this.m_exprPool)),(0,n.isJsonExpr)(e.maxZoomLevel)&&(e._maxZoomLevelExpr=r.Expr.fromJSON(e.maxZoomLevel,this.m_currentDefinitions,void 0).intern(this.m_exprPool))}catch(t){c.log("failed to evaluate expression",JSON.stringify(e.when),"error",String(t))}}processStyle(e,t,i){if(!this.checkZoomLevel(e,t))return!1;if(this.isStyleDisabled(t))return!1;if(void 0!==this.m_layer&&void 0!==t.layer&&t.layer!==this.m_layer)return!1;if(void 0!==this.m_geometryType&&void 0!==t._geometryType&&t._geometryType!==this.m_geometryType)return!1;if(t._whenExpr)try{if(!t._whenExpr.evaluate(e,r.ExprScope.Condition,this.m_cachedResults))return!1}catch(e){return c.error(`failed to evaluate expression '${JSON.stringify(t.when)}': ${e}`),!1}return void 0!==t.technique&&("none"!==t.technique&&i.push(this.getTechniqueForStyleMatch(e,t)),!0===t.final)}checkZoomLevel(e,t){var i,n;if(void 0===t.minZoomLevel&&void 0===t.maxZoomLevel)return!0;const s=this.m_zoomLevel;if(void 0===s)return!0;if(void 0!==t.minZoomLevel){let n=t.minZoomLevel;if(!1===(null===(i=t._minZoomLevelExpr)||void 0===i?void 0:i.isDynamic()))try{n=t._minZoomLevelExpr.evaluate(e,r.ExprScope.Condition,this.m_cachedResults)}catch(e){c.error(`failed to evaluate expression '${JSON.stringify(t._minZoomLevelExpr)}': ${e}`)}if("number"==typeof n&&s<n)return!1}if(void 0!==t.maxZoomLevel){let i=t.maxZoomLevel;if(!1===(null===(n=t._maxZoomLevelExpr)||void 0===n?void 0:n.isDynamic()))try{i=t._maxZoomLevelExpr.evaluate(e,r.ExprScope.Condition,this.m_cachedResults)}catch(e){c.error(`failed to evaluate expression '${JSON.stringify(t._maxZoomLevelExpr)}': ${e}`)}if("number"==typeof i&&s>=i)return!1}return!0}getTechniqueForStyleMatch(e,t){let i;if(void 0!==t._dynamicTechniques){const n=this.evaluateTechniqueProperties(t,e),r=this.getDynamicTechniqueKey(t,n);i=t._dynamicTechniques.get(r),void 0===i&&(i=this.createTechnique(t,n),t._dynamicTechniques.set(r,i))}else i=t._staticTechnique,void 0===i&&(t._staticTechnique=i=this.createTechnique(t,[]));return void 0===i._index&&(i._index=this.m_techniques.length,this.m_techniques.push(i)),i}getDynamicTechniqueKey(e,t){const i=t.map((([e,t])=>void 0===t?"U":"object"==typeof t?JSON.stringify(t,((e,t)=>{if(t instanceof ArrayBuffer){let e=t.id;return void 0===e&&(e=t.id=this.m_nextArrayBufferId++),e}return t})):JSON.stringify(t))).join(":");return`${e._styleSetIndex}:${i}`}compileStyleAttributes(e){var t;if(!e._forceCompile&&(void 0!==e._dynamicTechniqueAttributes||"none"===e.technique))return;e._dynamicTechniqueAttributes=[],e._dynamicFeatureAttributes=[],e._dynamicForwardedAttributes=[],e._staticAttributes=[],e._staticTechnique=void 0,e._dynamicTechniques=void 0;const i=e._dynamicFeatureAttributes,s=e._dynamicTechniqueAttributes,a=e._dynamicForwardedAttributes,u=e._staticAttributes,d=(t,d)=>{if(void 0===d)return;const m=new Set;if((0,n.isJsonExpr)(d)?d=r.Expr.fromJSON(d,this.m_currentDefinitions,this.m_definitionExprCache,m).intern(this.m_exprPool):(0,o.isInterpolatedPropertyDefinition)(d)&&(d=r.Expr.fromJSON((0,o.interpolatedPropertyDefinitionToJsonExpr)(d)).intern(this.m_exprPool)),r.Expr.isExpr(d)){const i=d.dependencies();i.featureState&&("enabled"!==t?c.log("feature-state is not supported in this context"):e._usesFeatureState=!0),0!==i.properties.size||d.isDynamic()||(d=d.evaluate(this.m_emptyEnv))}if(r.Expr.isExpr(d)){const n=function(e,t){var i,n;return"extruded-polygon"===e.technique&&"color"===t&&!1!==e.vertexColors?h:null!==(n=null===(i=(0,l.getTechniqueAttributeDescriptor)(e.technique,t))||void 0===i?void 0:i.scope)&&void 0!==n?n:h}(e,t),r=d.dependencies();switch(r.properties.forEach((e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)})),n){case l.AttrScope.FeatureGeometry:i.push([t,d]);break;case l.AttrScope.TechniqueGeometry:s.push([t,d]);break;case l.AttrScope.TechniqueRendering:0===r.properties.size?a.push([t,d]):s.push([t,d])}}else null!=d&&u.push([t,d]);for(const t of m.values())if(this.m_modesDefinitions.has(t)){e._forceCompile=!0;break}},m=new Map([["category","_category"]]);e._forceCompile=!1;for(const i in e)e.hasOwnProperty(i)&&(i.startsWith("_")||["when","technique","layer","attr","description"].includes(i)||d(null!==(t=m.get(i))&&void 0!==t?t:i,e[i]));if(void 0!==e.attr)for(const t in e.attr)e.attr.hasOwnProperty(t)&&d(t,e.attr[t]);s.length>0&&(e._dynamicTechniques=new Map)}evaluateTechniqueProperties(e,t){return void 0===e._dynamicTechniqueAttributes?[]:e._dynamicTechniqueAttributes.map((([e,i])=>{try{return[e,i.evaluate(t,r.ExprScope.Value,this.m_cachedResults)]}catch(t){return c.error(`failed to evaluate expression '${i.toJSON()}': ${t}`),[e,null]}}))}createTechnique(e,t){var i,r;const s={};if(s.name=e.technique,void 0!==e._staticAttributes)for(const[t,i]of e._staticAttributes)null!==i&&(s[t]=i);for(const[e,i]of t)null!==i&&(s[e]=i);if(void 0!==e._dynamicFeatureAttributes)for(const[t,i]of e._dynamicFeatureAttributes)s[t]=i;if(void 0!==e._dynamicForwardedAttributes)for(const[t,i]of e._dynamicForwardedAttributes)s[t]=i;return s._index=this.m_techniques.length,s._styleSetIndex=e._styleSetIndex,void 0!==e.styleSet&&(s._styleSet=e.styleSet),void 0!==e._usesFeatureState&&(s._usesFeatureState=e._usesFeatureState),(0,n.setTechniqueRenderOrderOrPriority)(s,null!==(i=this.m_options.priorities)&&void 0!==i?i:[],null!==(r=this.m_options.labelPriorities)&&void 0!==r?r:[]),this.m_techniques.push(s),s}},t.makeDecodedTechnique=m},3561:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateTechniqueAttr=void 0;const n=i(1984),r=i(8920);t.evaluateTechniqueAttr=function(e,t,i){if(void 0===t)return i;const s=n.Env.isEnv(e)?(0,r.getPropertyValue)(t,e):(0,r.getPropertyValue)(t,e.env,e.cachedExprResults);return null!=s?s:i}},5535:(e,t)=>{"use strict";var i;function n(...e){const t={attrDescriptors:{}};for(const i of e)void 0!==i.attrTransparencyColor&&(t.attrTransparencyColor=i.attrTransparencyColor),void 0!==i.attrDescriptors&&(t.attrDescriptors=Object.assign(Object.assign({},t.attrDescriptors),i.attrDescriptors));return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getTechniqueAutomaticAttrs=t.getTechniqueAttributeDescriptor=t.getTechniqueDescriptor=t.AttrScope=void 0,function(e){e[e.FeatureGeometry=0]="FeatureGeometry",e[e.TechniqueGeometry=1]="TechniqueGeometry",e[e.TechniqueRendering=2]="TechniqueRendering"}(i=t.AttrScope||(t.AttrScope={}));const r={attrTransparencyColor:"color",attrDescriptors:{constantHeight:i.FeatureGeometry,enabled:i.FeatureGeometry,fadeFar:i.TechniqueRendering,fadeNear:i.TechniqueRendering,transparent:{scope:i.TechniqueRendering,automatic:!0},side:{scope:i.TechniqueRendering,automatic:!0}}},s=n(r,{attrDescriptors:{color:{scope:i.TechniqueRendering,automatic:!0},size:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0}}}),o=n(r,s),a=n(r,s),l=n(r,{attrDescriptors:{text:i.FeatureGeometry,label:i.FeatureGeometry,useAbbreviation:i.FeatureGeometry,useIsoCode:i.FeatureGeometry,imageTexture:i.FeatureGeometry,iconColor:i.TechniqueRendering,iconBrightness:i.TechniqueRendering,backgroundColor:i.TechniqueRendering,backgroundSize:i.TechniqueRendering,backgroundOpacity:i.TechniqueRendering,color:i.TechniqueRendering,opacity:i.TechniqueRendering,size:i.TechniqueRendering,priority:i.TechniqueRendering,zOrder:i.TechniqueRendering,margin:i.TechniqueRendering,"check-margin":i.TechniqueRendering,"anchor-point-density":i.TechniqueRendering}}),c={attrDescriptors:{polygonOffset:{scope:i.TechniqueRendering,automatic:!0},polygonOffsetFactor:{scope:i.TechniqueRendering,automatic:!0},polygonOffsetUnits:{scope:i.TechniqueRendering,automatic:!0},depthTest:{scope:i.TechniqueRendering,automatic:!0},transparent:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},color:{scope:i.TechniqueRendering,automatic:!0},lineColor:i.TechniqueRendering,lineFadeFar:i.TechniqueRendering,lineFadeNear:i.TechniqueRendering}},h=n(r,c,{attrDescriptors:{lineWidth:i.TechniqueRendering,dashSize:i.TechniqueRendering,gapSize:i.TechniqueRendering,caps:{scope:i.TechniqueRendering,automatic:!0},drawRangeStart:{scope:i.TechniqueRendering,automatic:!0},drawRangeEnd:{scope:i.TechniqueRendering,automatic:!0},dashes:{scope:i.TechniqueRendering,automatic:!0},dashColor:{scope:i.TechniqueRendering,automatic:!0},"dash-image":{scope:i.TechniqueRendering,automatic:!0}}}),u=n(r,{attrDescriptors:{color:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},lineWidth:i.FeatureGeometry}}),d=n(r,c,{attrDescriptors:{wireframe:{scope:i.TechniqueRendering,automatic:!0},color:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},transparent:{scope:i.TechniqueRendering,automatic:!0},lineWidth:i.TechniqueRendering,map:{scope:i.TechniqueRendering,automatic:!0}}}),m=n(r,{attrDescriptors:{color:{scope:i.TechniqueRendering,automatic:!0},vertexColors:{scope:i.TechniqueRendering,automatic:!0},wireframe:{scope:i.TechniqueRendering,automatic:!0},roughness:{scope:i.TechniqueRendering,automatic:!0},metalness:{scope:i.TechniqueRendering,automatic:!0},alphaTest:{scope:i.TechniqueRendering,automatic:!0},depthTest:{scope:i.TechniqueRendering,automatic:!0},transparent:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},emissive:{scope:i.TechniqueRendering,automatic:!0},emissiveIntensity:{scope:i.TechniqueRendering,automatic:!0},refractionRatio:{scope:i.TechniqueRendering,automatic:!0},normalMapType:{scope:i.TechniqueRendering,automatic:!0},map:{scope:i.TechniqueRendering,automatic:!0},normalMap:{scope:i.TechniqueRendering,automatic:!0},displacementMap:{scope:i.TechniqueRendering,automatic:!0},roughnessMap:{scope:i.TechniqueRendering,automatic:!0},emissiveMap:{scope:i.TechniqueRendering,automatic:!0},bumpMap:{scope:i.TechniqueRendering,automatic:!0},metalnessMap:{scope:i.TechniqueRendering,automatic:!0},alphaMap:{scope:i.TechniqueRendering,automatic:!0}}}),p={"extruded-polygon":n(r,{attrDescriptors:{depthTest:{scope:i.TechniqueRendering,automatic:!0},vertexColors:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},color:{scope:i.TechniqueRendering,automatic:!0},colorIntensity:{scope:i.TechniqueRendering,automatic:!0},specular:{scope:i.TechniqueRendering,automatic:!0},emissive:{scope:i.TechniqueRendering,automatic:!0},emissiveIntensity:{scope:i.TechniqueRendering,automatic:!0},shininess:{scope:i.TechniqueRendering,automatic:!0},displacementMap:{scope:i.TechniqueRendering,automatic:!0},height:i.FeatureGeometry,floorHeight:i.FeatureGeometry,defaultColor:i.FeatureGeometry,defaultHeight:i.FeatureGeometry,boundaryWalls:i.FeatureGeometry,footprint:i.FeatureGeometry,maxSlope:i.FeatureGeometry,animateExtrusion:i.TechniqueRendering,lineWidth:i.TechniqueRendering,lineFadeNear:i.TechniqueRendering,lineFadeFar:i.TechniqueRendering,lineColor:i.TechniqueRendering}}),"line-marker":l,"labeled-icon":l,"solid-line":h,"dashed-line":h,terrain:m,standard:m,squares:o,circles:a,line:u,segments:u,fill:d,text:n(r,{attrDescriptors:{text:i.FeatureGeometry,label:i.FeatureGeometry,useAbbreviation:i.FeatureGeometry,useIsoCode:i.FeatureGeometry,backgroundColor:i.TechniqueRendering,backgroundSize:i.TechniqueRendering,backgroundOpacity:i.TechniqueRendering,color:i.TechniqueRendering,opacity:i.TechniqueRendering,size:i.TechniqueRendering,priority:i.TechniqueRendering,zOrder:i.TechniqueRendering}}),raster:n(r,{attrDescriptors:{brightness:{scope:i.TechniqueRendering,automatic:!0},gamma:{scope:i.TechniqueRendering,automatic:!0}}})};function f(e){return"string"!=typeof e&&(e=e.name),p[e]}t.getTechniqueDescriptor=f,t.getTechniqueAttributeDescriptor=function(e,t){const i=f(e),n=null==i?void 0:i.attrDescriptors,r=null==n?void 0:n[t];if(void 0!==typeof r)return"object"==typeof r?r:{scope:r}};const g=new Map;t.getTechniqueAutomaticAttrs=function(e){var t;if("string"!=typeof e&&(e=e.name),g.has(e))return g.get(e);const i=[],n=null===(t=f(e))||void 0===t?void 0:t.attrDescriptors;if(void 0===n)return i;for(const e in n){if(!n.hasOwnProperty(e))continue;const t=n[e];void 0!==t&&"number"!=typeof t&&!0===t.automatic&&i.push(e)}return g.set(e,i),i}},8934:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThreeBufferUtils=void 0;const n=i(3253);!function(e){function t(e){if(e instanceof Int8Array)return"int8";if(e instanceof Uint8Array)return"uint8";if(e instanceof Int16Array)return"int16";if(e instanceof Uint16Array)return"uint16";if(e instanceof Int32Array)return"int32";if(e instanceof Uint32Array)return"uint32";if(e instanceof Float32Array)return"float";throw new Error(`Unsupported buffer type ${name}`)}function i(e){const i=e.array;return{name:e.name,buffer:i.buffer,type:t(i),itemCount:e.itemSize,normalized:e.normalized}}e.getBufferElementType=t,e.fromThreeBufferAttribute=i,e.fromThreeInterleavedBufferAttribute=function(e){throw new Error("Not implemented yet")},e.fromThreeBufferGeometry=function(e,t){const r=[],s=Object.getOwnPropertyNames(e.attributes);for(const t of s){const n=i(e.attributes[t]);n.name=t,r.push(n)}const o=null!==e.index?i(e.index):void 0;let a=0;if(void 0!==o)a=null===e.index?0:e.index.count;else{const t=e.attributes.position;if(void 0===t)throw new Error("Missing position attibute to deduce item count");a=t.count}return{type:n.GeometryType.Unspecified,vertexAttributes:r,index:o,groups:[{start:0,count:a,technique:t}]}}}(t.ThreeBufferUtils||(t.ThreeBufferUtils={}))},8770:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9362:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerDecoderProtocol=t.RequestController=void 0,t.RequestController=class{constructor(e=0,t=new AbortController){this.priority=e,this.abortController=t}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}},function(e){let t,i;!function(e){e.Configuration="configuration"}(t=e.DecoderMessageName||(e.DecoderMessageName={})),e.isConfigurationMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Configuration},function(e){e.DecodeTileRequest="decode-tile-request",e.TileInfoRequest="tile-info-request"}(i=e.Requests||(e.Requests={})),e.isDecodeTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.DecodeTileRequest},e.isTileInfoRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.TileInfoRequest}}(t.WorkerDecoderProtocol||(t.WorkerDecoderProtocol={}))},4835:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerServiceProtocol=void 0,function(e){let t,i;e.WORKER_SERVICE_MANAGER_SERVICE_ID="worker-service-manager",function(e){e.Initialized="initialized",e.Request="request",e.Response="response"}(t=e.ServiceMessageName||(e.ServiceMessageName={})),e.isInitializedMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Initialized},function(e){e.CreateService="create-service",e.DestroyService="destroy-service"}(i=e.Requests||(e.Requests={})),e.isUnknownServiceError=function(e){return e.message.includes("unknown targetServiceType requested: ")},e.isRequestMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Request},e.isResponseMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Response}}(t.WorkerServiceProtocol||(t.WorkerServiceProtocol={}))},9421:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerTilerProtocol=void 0,function(e){let t;!function(e){e.RegisterIndex="register-index",e.UpdateIndex="update-index",e.TileRequest="tile-request"}(t=e.Requests||(e.Requests={})),e.isRegisterIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.RegisterIndex},e.isUpdateIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.UpdateIndex},e.isTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.TileRequest}}(t.WorkerTilerProtocol||(t.WorkerTilerProtocol={}))},6892:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6112:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wrapLineString=t.clipLineString=void 0;const n=i(82),r=i(2616),s=i(4342);class o{constructor(e,t,i,r,s){this.isInside=s,this.p0=new n.Vector2(e,t),this.p1=new n.Vector2(i,r)}inside(e){return this.isInside(e)}computeIntersection(e,t){const i=new n.Vector2;return s.Math2D.intersectLines(e.x,e.y,t.x,t.y,this.p0.x,this.p0.y,this.p1.x,this.p1.y,i),i}clipLine(e){const t=e,i=[];e=[],i.push(e);const n=t=>{0!==e.length&&e[e.length-1].equals(t)||e.push(t)};for(let r=0;r<t.length;++r){const s=t[r],o=r>0?t[r-1]:void 0;this.inside(s)?(void 0===o||this.inside(o)||(e.length>0&&(e=[],i.push(e)),n(this.computeIntersection(o,s))),n(s)):void 0!==o&&this.inside(o)&&n(this.computeIntersection(o,s))}return 0===i[i.length-1].length&&(i.length=i.length-1),i}clipLines(e){const t=[];return e.forEach((e=>{this.clipLine(e).forEach((e=>{t.push(e)}))})),t}}function a(e,t,i){for(const i of t)e=i.clipLines(e);const s=new n.Vector3,o=[];return e.forEach((e=>{if(0===e.length)return;const t=e.map((({x:e,y:t})=>{s.set(e,t,0);const n=r.webMercatorProjection.unprojectPoint(s);return n.longitude+=i,n}));o.push(t)})),o.length>0?o:void 0}t.clipLineString=function(e,t,i,n,r){const s=new o(t,i,t,r,(e=>e.x>t)),a=new o(t,r,n,r,(e=>e.y<r)),l=new o(n,r,n,i,(e=>e.x<n)),c=new o(n,i,t,i,(e=>e.y>i));let h=s.clipLine(e);return h=a.clipLines(h),h=l.clipLines(h),h=c.clipLines(h),h},t.wrapLineString=function(e){const t=new n.Vector3,i=[e.map((e=>{const{x:i,y:s}=r.webMercatorProjection.projectPoint(e,t);return new n.Vector2(i,s)}))];return{left:a(i,h,360),middle:a(i,c,0),right:a(i,u,-360)}};const l=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE,c=[new o(0,l,0,0,(e=>e.x>0)),new o(l+0,0,l+0,l,(e=>e.x<l+0))],h=[new o(-l-0,l,-l-0,0,(e=>e.x>-l-0)),new o(0,0,0,l,(e=>e.x<0))],u=[new o(l-0,l,l-0,0,(e=>e.x>l-0)),new o(2*l+0,0,2*l+0,l,(e=>e.x<2*l+0))]},2982:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clipPolygon=t.ClippingEdge=void 0;const n=i(82);class r{clipPolygon(e,t){const i=e;e=[];const n=t=>{const i=e[e.length-1];(!(null==i?void 0:i.equals(t))||!0===t.isClipped&&!(null==i?void 0:i.isClipped)||!t.isClipped&&!0===(null==i?void 0:i.isClipped))&&e.push(t)};for(let e=0;e<i.length;++e){const r=i[e],s=i[(e+i.length-1)%i.length];if(this.inside(r,t)){if(!this.inside(s,t)){const e=this.computeIntersection(s,r,t);e.isClipped=!0,n(e)}n(r)}else if(this.inside(s,t)){const e=this.computeIntersection(s,r,t);e.isClipped=!0,n(e)}}return e}}t.ClippingEdge=r;const s=[new class extends r{inside(e){return e.y>=0}computeIntersection(e,t){const{x:i,y:r}=e,{x:s,y:o}=t;return new n.Vector2((i*o-r*s)/-(r-o),0).round()}},new class extends r{inside(e,t){return e.x<=t}computeIntersection(e,t,i){const{x:r,y:s}=e,{x:o,y:a}=t;return new n.Vector2(i,(r*a-s*o-(s-a)*-i)/(r-o)).round()}},new class extends r{inside(e,t){return e.y<=t}computeIntersection(e,t,i){const{x:r,y:s}=e,{x:o,y:a}=t;return new n.Vector2((r*a-s*o-(r-o)*i)/-(s-a),i).round()}},new class extends r{inside(e){return e.x>=0}computeIntersection(e,t){const{x:i,y:r}=e,{x:s,y:o}=t;return new n.Vector2(0,(i*o-r*s)/(i-s)).round()}}];t.clipPolygon=function(e,t){if(0===e.length)return e;e[0].equals(e[e.length-1])||(e=[...e,e[0]]);for(const i of s)e=i.clipPolygon(e,t);return e.length<3?[]:e}},6525:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeLengthGeometrySubdivisionModifier=t.SubdivisionMode=void 0;const n=i(82),r=i(2616),s=i(4342),o=i(3386),a=[new n.Vector3,new n.Vector3];var l;!function(e){e[e.All=0]="All",e[e.NoDiagonals=1]="NoDiagonals"}(l=t.SubdivisionMode||(t.SubdivisionMode={}));class c extends o.SubdivisionModifier{constructor(e,t,i=l.All,n){super(),this.subdivision=e,this.geoBox=t,this.subdivisionMode=i,this.projection=n,(0,s.assert)(n.type===r.ProjectionType.Planar,"EdgeLengthGeometrySubdivisionModifier only supports planar projections");const o=n.projectPoint(t.northEast,a[0]),c=n.projectPoint(t.southWest,a[1]);this.m_projectedBox={min:{x:Math.min(o.x,c.x),y:Math.min(o.y,c.y),z:Math.min(o.z,c.z)},max:{x:Math.max(o.x,c.x),y:Math.max(o.y,c.y),z:Math.max(o.z,c.z)}},this.m_maxLengthX=(this.m_projectedBox.max.x-this.m_projectedBox.min.x)/e,this.m_maxLengthY=(this.m_projectedBox.max.y-this.m_projectedBox.min.y)/e,this.subdivisionMode===l.All&&(this.m_maxLengthX*=1.1,this.m_maxLengthY*=1.1),this.m_maxLength=Math.sqrt(this.m_maxLengthX*this.m_maxLengthX+this.m_maxLengthY*this.m_maxLengthY)}get maxLength(){return this.m_maxLength}get maxLengthX(){return this.m_maxLengthX}get maxLengthY(){return this.m_maxLengthY}shouldSplitTriangle(e,t,i){const n=this.shouldSplitEdge(e,t),r=this.shouldSplitEdge(t,i),s=this.shouldSplitEdge(i,e);if(!(n||r||s))return;const o=e.distanceTo(t),a=t.distanceTo(i),l=i.distanceTo(e),c=Math.max(n?o:0,r?a:0,s?l:0);if(o===c)return 0;if(a===c)return 1;if(l===c)return 2;throw new Error("Could not split triangle.")}shouldSplitEdge(e,t){switch(this.subdivisionMode){case l.All:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY||e.distanceTo(t)>this.m_maxLength;case l.NoDiagonals:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY}}}t.EdgeLengthGeometrySubdivisionModifier=c},6189:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphericalGeometrySubdivisionModifier=void 0;const n=i(82),r=i(2616),s=i(3386),o=[new n.Vector3,new n.Vector3,new n.Vector3];class a extends s.SubdivisionModifier{constructor(e,t=r.sphereProjection){super(),this.angle=e,this.projection=t}shouldSplitTriangle(e,t,i){const n=r.sphereProjection.reprojectPoint(this.projection,e,o[0]),s=r.sphereProjection.reprojectPoint(this.projection,t,o[1]),a=r.sphereProjection.reprojectPoint(this.projection,i,o[2]),l=n.angleTo(s),c=s.angleTo(a),h=a.angleTo(n),u=Math.max(l,Math.max(c,h));if(!(u<this.angle)){if(u===l)return 0;if(u===c)return 1;if(u===h)return 2;throw new Error("failed to split triangle")}}}t.SphericalGeometrySubdivisionModifier=a},3386:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubdivisionModifier=void 0;const n=i(82),r=new n.Vector3,s=new n.Vector3,o=new n.Vector3;t.SubdivisionModifier=class{constructor(){}modify(e){const t=e.getAttribute("position"),i=Array.from(t.array),n=e.getAttribute("uv"),a=void 0!==n?Array.from(n.array):void 0,l=e.getAttribute("edge"),c=void 0!==l?Array.from(l.array):void 0,h=e.getAttribute("wall"),u=void 0!==h?Array.from(h.array):void 0,d=e.getIndex(),m=Array.from(d.array),p=new Map;function f(e,t){const n=`${Math.min(e,t)}_${Math.max(e,t)}`,l=p.get(n);if(void 0!==l)return l;r.set(i[3*e],i[3*e+1],i[3*e+2]),s.set(i[3*t],i[3*t+1],i[3*t+2]),o.lerpVectors(r,s,.5);const h=i.length/3;return i.push(...o.toArray()),p.set(n,h),void 0!==a&&(r.set(a[2*e],a[2*e+1],0),s.set(a[2*t],a[2*t+1],0),o.lerpVectors(r,s,.5),a.push(o.x,o.y)),void 0!==c&&(c[e]===t?(c.push(t),c[e]=h):c[t]===e?(c.push(e),c[t]=h):c.push(-1)),void 0!==u&&(u[e]===t?(u.push(t),u[e]=h):u[t]===e?(u.push(e),u[t]=h):u.push(-1)),h}const g=[];for(;m.length>=3;){const e=m.shift(),t=m.shift(),n=m.shift();switch(r.set(i[3*e],i[3*e+1],i[3*e+2]),s.set(i[3*t],i[3*t+1],i[3*t+2]),o.set(i[3*n],i[3*n+1],i[3*n+2]),this.shouldSplitTriangle(r,s,o)){case 0:{const i=f(e,t);m.push(e,i,n,i,t,n);break}case 1:{const i=f(t,n);m.push(e,t,i,e,i,n);break}case 2:{const i=f(n,e);m.push(e,t,i,i,t,n);break}case void 0:g.push(e,t,n);break;default:throw new Error("failed to subdivide the given geometry")}}return t.array=t.array instanceof Float32Array?new Float32Array(i):new Float64Array(i),t.count=i.length/t.itemSize,t.needsUpdate=!0,e.setIndex(g),void 0!==a&&(n.array=new Float32Array(a),n.count=a.length/n.itemSize,n.needsUpdate=!0),void 0!==c&&(l.array=new Float32Array(c),l.count=c.length/l.itemSize,l.needsUpdate=!0),e}}},3997:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wrapLineString=void 0;var n=i(6112);Object.defineProperty(t,"wrapLineString",{enumerable:!0,get:function(){return n.wrapLineString}})},8965:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wrapPolygon=void 0;const n=i(82),r=i(2616),s=i(4342),o=i(2982);class a extends o.ClippingEdge{constructor(e,t,i){super(),this.isInside=i,this.p0=(new n.Vector2).fromArray(e),this.p1=(new n.Vector2).fromArray(t)}inside(e,t){return this.isInside(e)}computeIntersection(e,t,i){const r=new n.Vector2;return s.Math2D.intersectLines(e.x,e.y,t.x,t.y,this.p0.x,this.p0.y,this.p1.x,this.p1.y,r),r}}const l=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE,c=.05*l,h=[new a([0-c,l],[0-c,0],(e=>e.x>0-c)),new a([l+c,0],[l+c,l],(e=>e.x<l+c))],u=[new a([-l-c,l],[-l-c,0],(e=>e.x>-l-c)),new a([0+c,0],[0+c,l],(e=>e.x<0+c))],d=[new a([l-c,l],[l-c,0],(e=>e.x>l-c)),new a([2*l+c,0],[2*l+c,l],(e=>e.x<2*l+c))];function m(e,t,i){for(const i of t)e=i.clipPolygon(e,0);const s=new n.Vector3,o=e.map((({x:e,y:t})=>{s.set(e,t,0);const n=r.webMercatorProjection.unprojectPoint(s);return n.longitude+=i,n}));return o.length>0?o:void 0}t.wrapPolygon=function(e){const t=new n.Vector3,i=e.map((e=>{const{x:i,y:s}=r.webMercatorProjection.projectPoint(e,t);return new n.Vector2(i,s)}));return{left:m(i,u,360),middle:m(i,h,0),right:m(i,d,-360)}}},2616:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(3068),t),r(i(5999),t),r(i(6306),t),r(i(4860),t),r(i(8248),t),r(i(9019),t),r(i(6482),t),r(i(7870),t),r(i(5610),t),r(i(1515),t),r(i(9686),t),r(i(5234),t),r(i(9885),t),r(i(7289),t),r(i(6322),t),r(i(9861),t),r(i(435),t),r(i(9447),t),r(i(7171),t),r(i(3424),t),r(i(4948),t),r(i(6541),t),r(i(7841),t),r(i(2801),t),r(i(6557),t),r(i(4490),t),r(i(2224),t),r(i(1635),t),r(i(1871),t),r(i(2953),t),r(i(1383),t),r(i(9264),t),r(i(58),t),r(i(7523),t),r(i(2683),t),r(i(2334),t)},3068:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoBox=void 0;const n=i(82),r=i(4860);class s{static fromCoordinates(e,t){return new s(e,t)}static fromCenterAndExtents(e,t){return new s(new r.GeoCoordinates(e.latitude-t.latitudeSpan/2,e.longitude-t.longitudeSpan/2),new r.GeoCoordinates(e.latitude+t.latitudeSpan/2,e.longitude+t.longitudeSpan/2))}constructor(e,t){this.southWest=e,this.northEast=t,this.west>this.east&&(this.northEast.longitude+=360)}get minAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)}get maxAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)}get south(){return this.southWest.latitude}get north(){return this.northEast.latitude}get west(){return this.southWest.longitude}get east(){return this.northEast.longitude}get center(){const e=.5*(this.south+this.north),{west:t,east:i}=this,{minAltitude:n,altitudeSpan:s}=this;let o;if(void 0!==n&&void 0!==s&&(o=n+.5*s),t<=i)return new r.GeoCoordinates(e,.5*(t+i),o);let a=.5*(360+i+t);return a>360&&(a-=360),new r.GeoCoordinates(e,a,o)}get latitudeSpanInRadians(){return n.MathUtils.degToRad(this.latitudeSpan)}get longitudeSpanInRadians(){return n.MathUtils.degToRad(this.longitudeSpan)}get latitudeSpan(){return this.north-this.south}get altitudeSpan(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude}get longitudeSpan(){let e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e}get latitudeSpanInDegrees(){return this.latitudeSpan}get longitudeSpanInDegrees(){return this.longitudeSpan}contains(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);const t=this.minAltitude===this.maxAltitude,i=this.minAltitude===e.altitude,n=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!!(t?i:n)&&this.containsHelper(e)}clone(){return new s(this.southWest.clone(),this.northEast.clone())}growToContain(e){this.southWest.latitude=Math.min(this.southWest.latitude,e.latitude),this.southWest.longitude=Math.min(this.southWest.longitude,e.longitude),this.southWest.altitude=void 0!==this.southWest.altitude&&void 0!==e.altitude?Math.min(this.southWest.altitude,e.altitude):void 0!==this.southWest.altitude?this.southWest.altitude:void 0!==e.altitude?e.altitude:void 0,this.northEast.latitude=Math.max(this.northEast.latitude,e.latitude),this.northEast.longitude=Math.max(this.northEast.longitude,e.longitude),this.northEast.altitude=void 0!==this.northEast.altitude&&void 0!==e.altitude?Math.max(this.northEast.altitude,e.altitude):void 0!==this.northEast.altitude?this.northEast.altitude:void 0!==e.altitude?e.altitude:void 0}containsHelper(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;const{west:t,east:i}=this;let n=e.longitude;if(i>r.MAX_LONGITUDE)for(;n<t;)n+=360;if(n>i)for(;n>t+360;)n-=360;return n>=t&&n<i}}t.GeoBox=s},5999:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoBoxExtentLike=void 0,t.isGeoBoxExtentLike=function(e){return e&&"object"==typeof e&&"number"==typeof e.latitudeSpan&&"number"==typeof e.longitudeSpan}},680:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordLike=t.geoCoordLikeToGeoPointLike=t.geoCoordLikeToGeoCoordinatesLike=void 0;const n=i(6306),r=i(8248),s=i(7870);t.geoCoordLikeToGeoCoordinatesLike=function(e){return(0,n.isGeoCoordinatesLike)(e)?e:(0,s.isLatLngLike)(e)?{latitude:e.lat,longitude:e.lng}:{latitude:e[1],longitude:e[0]}},t.geoCoordLikeToGeoPointLike=function(e){return(0,r.isGeoPointLike)(e)?e:(0,s.isLatLngLike)(e)?[e.lng,e.lat]:[e.longitude,e.latitude]},t.isGeoCoordLike=function(e){return(0,n.isGeoCoordinatesLike)(e)||(0,s.isLatLngLike)(e)||!(0,r.isGeoPointLike)(e)}},4860:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoCoordinates=t.MIN_LONGITUDE=t.MAX_LONGITUDE=t.MIN_LATITUDE=t.MAX_LATITUDE=void 0;const n=i(82),r=i(6306),s=i(8248),o=i(7870);t.MAX_LATITUDE=90,t.MIN_LATITUDE=-90,t.MAX_LONGITUDE=180,t.MIN_LONGITUDE=-180;const a=new n.Vector3,l=new n.Vector3;class c{static fromDegrees(e,t,i){return new c(e,t,i)}static fromRadians(e,t,i){return new c(n.MathUtils.radToDeg(e),n.MathUtils.radToDeg(t),i)}static fromLatLng(e){return new c(e.lat,e.lng)}static fromGeoPoint(e){return new c(e[1],e[0],e[2])}static fromObject(e){if((0,s.isGeoPointLike)(e))return c.fromGeoPoint(e);if((0,r.isGeoCoordinatesLike)(e))return c.fromDegrees(e.latitude,e.longitude,e.altitude);if((0,o.isLatLngLike)(e))return c.fromDegrees(e.lat,e.lng);throw new Error("Invalid input coordinate format.")}static lerp(e,t,i,n=!1,r=!1){var s,o;if(n){if(e.lng<t.lng){const n=e.clone();return n.longitude+=360,this.lerp(t,n,1-i)}{const n=t.clone();return n.longitude+=360,this.lerp(e,n,i)}}const h=a.set(e.lat,e.lng,null!==(s=e.altitude)&&void 0!==s?s:0),u=l.set(t.lat,t.lng,null!==(o=t.altitude)&&void 0!==o?o:0);h.lerp(u,i);const d=new c(h.x,h.y,h.z);return r?d.normalized():d}constructor(e,t,i){this.latitude=e,this.longitude=t,this.altitude=i}get latitudeInRadians(){return n.MathUtils.degToRad(this.latitude)}get longitudeInRadians(){return n.MathUtils.degToRad(this.longitude)}get latitudeInDegrees(){return this.latitude}get longitudeInDegrees(){return this.longitude}get lat(){return this.latitude}get lng(){return this.longitude}isValid(){return!isNaN(this.latitude)&&!isNaN(this.longitude)}normalized(){let{latitude:e,longitude:t}=this;return isNaN(e)||isNaN(t)?this:((t<-180||t>180)&&(t=function(e,t){const i=e%360;return i<0==0?i:i+360}(t+180)-180),e=n.MathUtils.clamp(e,-90,90),new c(e,t,this.altitude))}equals(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude}copy(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this}clone(){return new c(this.latitude,this.longitude,this.altitude)}toLatLng(){return{lat:this.latitude,lng:this.longitude}}toGeoPoint(){return void 0!==this.altitude?[this.longitude,this.latitude,this.altitude]:[this.longitude,this.latitude]}minLongitudeSpanTo(e){const t=Math.min(this.longitude,e.longitude),i=Math.max(this.longitude,e.longitude);return Math.min(i-t,360+t-i)}}t.GeoCoordinates=c},6306:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordinatesLike=void 0,t.isGeoCoordinatesLike=function(e){return e&&"number"==typeof e.latitude&&"number"==typeof e.longitude&&("number"==typeof e.altitude||void 0===e.altitude)}},8248:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoPointLike=void 0,t.isGeoPointLike=function(e){if(Array.isArray(e)){const[t,i,n]=e;return"number"==typeof t&&"number"==typeof i&&(void 0===n||"number"==typeof n)}return!1}},6482:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoPolygon=t.isAntimeridianCrossing=void 0;const n=i(82),r=i(3068),s=i(4860),o=i(680);function a(e,t){return Math.max(e,t)-Math.min(e,t)}function l(e,t){return e>0&&t<0&&a(e,t)>180}t.isAntimeridianCrossing=function(e,t){return Math.sign(e)===-Math.sign(t)&&a(e,t)>180},t.GeoPolygon=class{constructor(e,t=!1,i=!1){this.m_coordinates=e.map((e=>(0,o.geoCoordLikeToGeoCoordinatesLike)(e))),t&&this.sortCCW(),i&&this.wrapCoordinatesAround()}get coordinates(){return this.m_coordinates}getGeoBoundingBox(){const e=this.getCentroid();if(void 0===e)return r.GeoBox.fromCoordinates(this.coordinates[0],this.coordinates[0]);const{east:t,west:i}=this.getEastAndWest(e),{north:n,south:o}=this.getNorthAndSouth();return r.GeoBox.fromCoordinates(new s.GeoCoordinates(o,i),new s.GeoCoordinates(n,t))}getCentroid(){const e=this.getArea();if(0===e)return;let t,i=0,n=0,r=this.m_coordinates.length-1;return this.m_coordinates.forEach(((e,s)=>{const o=this.m_coordinates[r];t=e.latitude*o.longitude-o.latitude*e.longitude,i+=(e.latitude+o.latitude)*t,n+=(e.longitude+o.longitude)*t,r=s})),t=6*e,new s.GeoCoordinates(i/t,e<0?n/t-180:n/t)}sortCCW(){const e=this.getPolyAverageCenter();e&&this.m_coordinates.sort(((t,i)=>{const r=new n.Vector2(t.latitude-e.latitude,t.longitude-e.longitude).normalize();return new n.Vector2(i.latitude-e.latitude,i.longitude-e.longitude).normalize().angle()-r.angle()}))}wrapCoordinatesAround(){const e=this.m_coordinates.findIndex(((e,t)=>{const i=0===t?this.m_coordinates.length-1:t-1;return l(this.m_coordinates[i].longitude,e.longitude)}));if(e<0)return;let t=!0;for(let i=0;i<this.m_coordinates.length;i++){const n=(e+i)%this.m_coordinates.length,r=this.m_coordinates[n].longitude,s=this.m_coordinates[(n+1)%this.m_coordinates.length].longitude;t&&(this.m_coordinates[n].longitude+=360),l(s,r)?t=!1:l(r,s)&&(t=!0)}}getPolyAverageCenter(){const e=this.m_coordinates.reduce(((e,t)=>new s.GeoCoordinates(e.latitude+t.latitude,e.longitude+t.longitude)));return new s.GeoCoordinates(e.latitude/this.m_coordinates.length,e.longitude/this.m_coordinates.length)}getArea(){let e=0,t=this.m_coordinates.length-1;return this.m_coordinates.forEach(((i,n)=>{const r=this.m_coordinates[t];e+=i.latitude*r.longitude,e-=i.longitude*r.latitude,t=n})),e/=2}getEastAndWest(e){let t=e.longitude,i=e.longitude,r=this.m_coordinates.length-1;return this.m_coordinates.forEach(((s,o)=>{const a=this.m_coordinates[r];r=o;const l=new n.Vector2(s.latitude-e.latitude,s.longitude-e.longitude).normalize(),c=new n.Vector2(a.latitude-e.latitude,a.longitude-e.longitude).normalize();let h=1===Math.sign(c.angle()-l.angle());c.y>=0&&l.y<0&&(h=!0);const u=s.longitude;u<e.longitude?h?t=Math.min(t,u):i=Math.min(i,u):h?i=Math.max(i,u):t=Math.max(t,u)})),{east:i,west:t}}getNorthAndSouth(){let e=s.MIN_LATITUDE,t=s.MAX_LATITUDE;return this.m_coordinates.forEach(((i,n)=>{e=Math.max(e,i.latitude),t=Math.min(t,i.latitude)})),{north:e,south:t}}}},9019:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoPolygonLike=void 0;const n=i(680);t.isGeoPolygonLike=function(e){if(!e||!Array.isArray(e.coordinates)&&e.coordinates.length>2)return!1;let t=!0;return e.coordinates.forEach((i=>{(0,n.isGeoCoordLike)(e)||(t=!1)})),t}},7870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLatLngLike=void 0,t.isLatLngLike=function(e){return e&&"number"==typeof e.lat&&"number"==typeof e.lng}},9264:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBox3Like=void 0,t.isBox3Like=function(e){const t=e;return void 0!==t.min&&void 0!==t.max}},7523:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathUtils=void 0;const n=i(82);!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function i(e,i){const n=(e=t(e))-(i=t(i));return n>180?n-360:n<=-180?n+360:n}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.newVector3=function(e,t,i,n){return void 0===n?{x:e,y:t,z:i}:(n.x=e,n.y=t,n.z=i,n)},e.copyVector3=function(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t},e.degToRad=n.MathUtils.degToRad,e.radToDeg=n.MathUtils.radToDeg,e.clamp=n.MathUtils.clamp,e.normalizeAngleDeg=t,e.normalizeLongitudeDeg=function(e){return(e=t(e))>180&&(e-=360),e},e.angleDistanceDeg=i,e.interpolateAnglesDeg=function(e,t,n){return(e+i(t,e)*n)%360}}(t.MathUtils||(t.MathUtils={}))},2334:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrientedBox3=void 0;const n=i(82);function r(e,t,i,n,r){const s=i.dot(t),o=i.dot(e);if(Math.abs(o)<1e-20)return Math.abs(s)<=n;const a=1/o,l=(s+n)*a,c=(s-n)*a;return l>c?(c>r.min&&(r.min=c),l<r.max&&(r.max=l)):(l>r.min&&(r.min=l),c<r.max&&(r.max=c)),r.min<=r.max&&r.max>=0}const s=new n.Vector3,o={min:-1/0,max:1/0};class a{constructor(e,t,i){this.position=new n.Vector3,this.xAxis=new n.Vector3(1,0,0),this.yAxis=new n.Vector3(0,1,0),this.zAxis=new n.Vector3(0,0,1),this.extents=new n.Vector3,void 0!==e&&this.position.copy(e),void 0!==t&&t.extractBasis(this.xAxis,this.yAxis,this.zAxis),void 0!==i&&this.extents.copy(i)}clone(){const e=new a;return e.copy(this),e}copy(e){this.position.copy(e.position),this.xAxis.copy(e.xAxis),this.yAxis.copy(e.yAxis),this.zAxis.copy(e.zAxis),this.extents.copy(e.extents)}getCenter(e=new n.Vector3){return e.copy(this.position)}getSize(e=new n.Vector3){return e.copy(this.extents).multiplyScalar(2)}getRotationMatrix(e=new n.Matrix4){return e.makeBasis(this.xAxis,this.yAxis,this.zAxis)}intersects(e){const t=Array.isArray(e)?e:e.planes;for(const e of t){const t=Math.abs(e.normal.dot(this.xAxis)*this.extents.x)+Math.abs(e.normal.dot(this.yAxis)*this.extents.y)+Math.abs(e.normal.dot(this.zAxis)*this.extents.z);if(e.distanceToPoint(this.position)+t<0)return!1}return!0}intersectsRay(e){if(o.min=-1/0,o.max=1/0,s.copy(this.position).sub(e.origin),r(e.direction,s,this.xAxis,this.extents.x,o)&&r(e.direction,s,this.yAxis,this.extents.y,o)&&r(e.direction,s,this.zAxis,this.extents.z,o))return o.min>0?o.min:o.max}contains(e){const t=e.x-this.position.x,i=e.y-this.position.y,n=e.z-this.position.z,r=Math.abs(t*this.xAxis.x+i*this.xAxis.y+n*this.xAxis.z),s=Math.abs(t*this.yAxis.x+i*this.yAxis.y+n*this.yAxis.z),o=Math.abs(t*this.zAxis.x+i*this.zAxis.y+n*this.zAxis.z);return!(r>this.extents.x||s>this.extents.y||o>this.extents.z)}distanceToPoint(e){return Math.sqrt(this.distanceToPointSquared(e))}distanceToPointSquared(e){const t=new n.Vector3;t.subVectors(e,this.position);const i=[t.dot(this.xAxis),t.dot(this.yAxis),t.dot(this.zAxis)];let r=0;for(let e=0;e<3;++e){const t=i[e],n=this.extents.getComponent(e);if(t<-n){const e=n+t;r+=e*e}else if(t>n){const e=t-n;r+=e*e}}return r}}t.OrientedBox3=a},58:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOrientedBox3Like=void 0,t.isOrientedBox3Like=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis&&void 0!==t.extents}},2683:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTransformLike=void 0,t.isTransformLike=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis}},2953:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector2Like=void 0,t.isVector2Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y}},1383:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector3Like=void 0,t.isVector3Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}},5610:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EarthConstants=void 0;class i{}t.EarthConstants=i,i.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,i.EQUATORIAL_RADIUS=6378137,i.MIN_ELEVATION=-433,i.MAX_ELEVATION=8848,i.MAX_BUILDING_HEIGHT=828},1515:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.equirectangularProjection=t.normalizedEquirectangularProjection=void 0;const n=i(82),r=i(3068),s=i(4860),o=i(9264),a=i(7523),l=i(58),c=i(5610),h=i(5234);class u extends h.Projection{constructor(){super(...arguments),this.type=h.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,i){return i||(i=new n.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale/2,i.max.z=t,i}projectPoint(e,t){var i;return void 0===t&&(t={x:0,y:0,z:0}),t.x=(n.MathUtils.degToRad(e.longitude)+Math.PI)*u.geoToWorldScale*this.unitScale,t.y=(n.MathUtils.degToRad(e.latitude)+.5*Math.PI)*u.geoToWorldScale*this.unitScale,t.z=null!==(i=e.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){return s.GeoCoordinates.fromRadians(e.y*u.worldToGeoScale/this.unitScale-.5*Math.PI,e.x*u.worldToGeoScale/this.unitScale-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){const i=this.projectPoint(new s.GeoCoordinates(e.center.latitude,e.center.longitude,0)),{latitudeSpanInRadians:r,longitudeSpanInRadians:c,altitudeSpan:h}=e,d=c*u.geoToWorldScale,m=r*u.geoToWorldScale;return t||(t=new n.Box3),(0,o.isBox3Like)(t)?(t.min.x=i.x-.5*d*this.unitScale,t.min.y=i.y-.5*m*this.unitScale,t.max.x=i.x+.5*d*this.unitScale,t.max.y=i.y+.5*m*this.unitScale,void 0!==h?(t.min.z=i.z-.5*h,t.max.z=i.z+.5*h):(t.min.z=0,t.max.z=0)):(0,l.isOrientedBox3Like)(t)&&(a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=i.x,t.position.y=i.y,t.position.z=i.z,t.extents.x=.5*d*this.unitScale,t.extents.y=.5*m*this.unitScale,t.extents.z=Math.max(Number.EPSILON,.5*(null!=h?h:0))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}u.geoToWorldScale=1/(2*Math.PI),u.worldToGeoScale=2*Math.PI/1,t.normalizedEquirectangularProjection=new u(1),t.equirectangularProjection=new u(c.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},9686:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.identityProjection=void 0;const n=i(82),r=i(3068),s=i(4860),o=i(9264),a=i(7523),l=i(58),c=i(5234);class h extends c.Projection{constructor(){super(...arguments),this.type=c.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,i){return i||(i=new n.Box3),i.min.x=-Math.PI,i.min.y=.5*-Math.PI,i.min.z=e,i.max.x=Math.PI,i.max.y=.5*Math.PI,i.max.z=t,i}projectPoint(e,t){var i;return t||(t={x:0,y:0,z:0}),t.x=n.MathUtils.degToRad(e.longitude),t.y=n.MathUtils.degToRad(e.latitude),t.z=null!==(i=e.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){return s.GeoCoordinates.fromRadians(e.y,e.x,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){t||(t=new n.Box3);const i=this.projectPoint(new s.GeoCoordinates(e.south,e.west,e.minAltitude)),r=this.projectPoint(new s.GeoCoordinates(e.north,e.east,e.maxAltitude));return(0,o.isBox3Like)(t)?(t.min.x=i.x,t.min.y=i.y,t.min.z=i.z,t.max.x=r.x,t.max.y=r.y,t.max.z=r.z):(0,l.isOrientedBox3Like)(t)&&(a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(i.x+r.x),t.position.y=.5*(i.y+r.y),t.position.z=.5*(i.z+r.z),t.extents.x=.5*(r.x-i.x),t.extents.y=.5*(r.y-i.y),t.extents.z=Math.max(Number.EPSILON,.5*(r.z-i.z))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}t.identityProjection=new h(1)},9885:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webMercatorProjection=t.mercatorProjection=t.MercatorConstants=void 0;const n=i(82),r=i(3068),s=i(4860),o=i(6306),a=i(9264),l=i(7523),c=i(58),h=i(5610),u=i(5234);class d extends u.Projection{constructor(){super(...arguments),this.type=u.ProjectionType.Planar}static clamp(e,t,i){return Math.min(Math.max(t,e),i)}static latitudeClamp(e){return d.clamp(e,-m.MAXIMUM_LATITUDE,m.MAXIMUM_LATITUDE)}static latitudeProject(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI}static latitudeClampProject(e){return d.latitudeProject(d.latitudeClamp(e))}static unprojectLatitude(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI}getScaleFactor(e){return Math.cosh(2*Math.PI*(e.y/this.unitScale-.5))}worldExtent(e,t,i){return i||(i=new n.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale,i.max.z=t,i}projectPoint(e,t){var i;let n;return n=e instanceof s.GeoCoordinates?e:new s.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(n.longitude+180)/360*this.unitScale,t.y=(.5*d.latitudeClampProject(n.latitudeInRadians)+.5)*this.unitScale,t.z=null!==(i=n.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){return s.GeoCoordinates.fromRadians(d.unprojectLatitude(2*(e.y/this.unitScale-.5)),e.x/this.unitScale*2*Math.PI-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){var i;const r=this.projectPoint(e.center),s=(.5*d.latitudeClampProject(e.northEast.latitudeInRadians)+.5)*this.unitScale,o=(.5*d.latitudeClampProject(e.southWest.latitudeInRadians)+.5)*this.unitScale,h=.5*(s+o);r.y=h;const u=s-o,m=e.longitudeSpan/360*this.unitScale;if(t||(t=new n.Box3),(0,a.isBox3Like)(t)){t.min.x=r.x-.5*m,t.min.y=r.y-.5*u,t.max.x=r.x+.5*m,t.max.y=r.y+.5*u;const i=e.altitudeSpan;void 0!==i?(t.min.z=r.z-.5*i,t.max.z=r.z+.5*i):(t.min.z=0,t.max.z=0)}else{if(!(0,c.isOrientedBox3Like)(t))throw new Error("invalid bounding box");l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,1,0,t.yAxis),l.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=r.x,t.position.y=r.y,t.position.z=r.z,t.extents.x=.5*m,t.extents.y=.5*u,t.extents.z=Math.max(Number.EPSILON,.5*(null!==(i=e.altitudeSpan)&&void 0!==i?i:0))}return t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}reprojectPoint(e,i,n){return e===this||e!==t.webMercatorProjection&&e!==t.mercatorProjection?super.reprojectPoint(e,i,n):(void 0===n&&(n={}),n.x=i.x,n.y=this.unitScale-i.y,n.z=i.z,n)}}class m{}t.MercatorConstants=m,m.MAXIMUM_LATITUDE=1.4844222297453322,t.mercatorProjection=new d(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE),t.webMercatorProjection=new class extends d{projectPoint(e,t){var i;let n;n=e instanceof s.GeoCoordinates?e:new s.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(n.longitude+180)/360*this.unitScale;const r=Math.sin(d.latitudeClamp(n.latitudeInRadians));return t.y=(.5-Math.log((1+r)/(1-r))/(4*Math.PI))*this.unitScale,t.z=null!==(i=n.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){const t=e.x/this.unitScale-.5,i=.5-e.y/this.unitScale,n=360*t,r=90-360*Math.atan(Math.exp(2*-i*Math.PI))/Math.PI;return new s.GeoCoordinates(r,n,e.z)}projectBox(e,t){const i=super.projectBox(e,t);if((0,a.isBox3Like)(i)){const e=i.max.y;i.max.y=this.unitScale-i.min.y,i.min.y=this.unitScale-e}else(0,c.isOrientedBox3Like)(i)&&(l.MathUtils.newVector3(1,0,0,i.xAxis),l.MathUtils.newVector3(0,-1,0,i.yAxis),l.MathUtils.newVector3(0,0,-1,i.zAxis),i.position.y=this.unitScale-i.position.y);return i}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return new r.GeoBox(new s.GeoCoordinates(i.latitude,t.longitude,t.altitude),new s.GeoCoordinates(t.latitude,i.longitude,i.altitude))}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}localTangentSpace(e,t){return(0,o.isGeoCoordinatesLike)(e)?this.projectPoint(e,t.position):l.MathUtils.copyVector3(e,t.position),l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,-1,0,t.yAxis),l.MathUtils.newVector3(0,0,-1,t.zAxis),t}}(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},5234:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Projection=t.ProjectionType=void 0;const n=i(6306),r=i(7523);var s;(s=t.ProjectionType||(t.ProjectionType={}))[s.Planar=0]="Planar",s[s.Spherical=1]="Spherical",t.Projection=class{constructor(e){this.unitScale=e}localTangentSpace(e,t){return(0,n.isGeoCoordinatesLike)(e)?this.projectPoint(e,t.position):r.MathUtils.copyVector3(e,t.position),r.MathUtils.newVector3(1,0,0,t.xAxis),r.MathUtils.newVector3(0,1,0,t.yAxis),r.MathUtils.newVector3(0,0,1,t.zAxis),t}reprojectPoint(e,t,i){return e===this?void 0===i?{x:t.x,y:t.y,z:t.z}:(i.x=t.x,i.y=t.y,i.z=t.z,i):this.projectPoint(e.unprojectPoint(t),i)}}},6322:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sphereProjection=void 0;const n=i(82),r=i(4860),s=i(6306),o=i(9264),a=i(7523),l=i(58),c=i(5610),h=i(9885),u=i(5234);function d(e){const t=1/Math.PI,i=Math.floor(2*(e*t+1));return n.MathUtils.clamp(i,0,4)}function m(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}function p(e,t,i){var r;const s=.5*(i+(null!==(r=e.maxAltitude)&&void 0!==r?r:0)),o=n.MathUtils.degToRad(e.west),a=n.MathUtils.degToRad(e.east),l=d(o),c=d(a);let h=Math.cos(o),u=h,m=Math.sin(o),p=m;for(let e=l+1;e<=c;e++){const t=(e+1&1)*((2&e)-1);h=Math.min(t,h),u=Math.max(t,u);const i=(1&e)*((2&e)-1);m=Math.min(i,m),p=Math.max(i,p)}const f=Math.cos(a);h=Math.min(f,h),u=Math.max(f,u);const g=Math.sin(a);m=Math.min(g,m),p=Math.max(g,p);const v=(u+h)*s,y=(u-h)*s,_=(p+m)*s,x=(p-m)*s,w=n.MathUtils.degToRad(e.south),b=n.MathUtils.degToRad(e.north),T=Math.sin(b),M=Math.sin(w),S=(T+M)*s,E=(T-M)*s;return t.min.x=v-y,t.min.y=_-x,t.min.z=S-E,t.max.x=v+y,t.max.y=_+x,t.max.z=S+E,t}class f extends u.Projection{constructor(){super(...arguments),this.type=u.ProjectionType.Spherical}worldExtent(e,t,i=new n.Box3){const r=this.unitScale+t;return i.min.x=-r,i.min.y=-r,i.min.z=-r,i.max.x=r,i.max.y=r,i.max.z=r,i}projectPoint(e,t=a.MathUtils.newVector3(0,0,0)){return function(e,t,i){var r;const s=i+(null!==(r=e.altitude)&&void 0!==r?r:0),o=n.MathUtils.degToRad(e.latitude),a=n.MathUtils.degToRad(e.longitude),l=Math.cos(o);return t.x=s*l*Math.cos(a),t.y=s*l*Math.sin(a),t.z=s*Math.sin(o),t}(e,t,this.unitScale)}unprojectPoint(e){const t=e.x*e.x+e.y*e.y,i=Math.sqrt(t),n=e.z/i;if(isNaN(n))return r.GeoCoordinates.fromRadians(0,0,-this.unitScale);const s=Math.sqrt(t+e.z*e.z);return r.GeoCoordinates.fromRadians(Math.atan(n),Math.atan2(e.y,e.x),s-this.unitScale)}unprojectAltitude(e){const t=e.x*e.x+e.y*e.y+e.z*e.z;return Math.sqrt(t)-c.EarthConstants.EQUATORIAL_RADIUS}projectBox(e,t=new n.Box3){var i,r;if((0,o.isBox3Like)(t))return p(e,t,this.unitScale);if((0,l.isOrientedBox3Like)(t)){if(e.longitudeSpan>=90){const i=p(e,new n.Box3,this.unitScale);return a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(i.max.x+i.min.x),t.position.y=.5*(i.max.y+i.min.y),t.position.z=.5*(i.max.z+i.min.z),t.extents.x=.5*(i.max.x-i.min.x),t.extents.y=.5*(i.max.y-i.min.y),t.extents.z=.5*(i.max.z-i.min.z),t}const{south:s,west:o,north:l,east:c,center:h}=e,u=h.longitude,d=h.latitude,m=Math.cos(n.MathUtils.degToRad(s)),f=Math.sin(n.MathUtils.degToRad(s)),g=Math.cos(n.MathUtils.degToRad(o)),v=Math.sin(n.MathUtils.degToRad(o)),y=Math.cos(n.MathUtils.degToRad(l)),_=Math.sin(n.MathUtils.degToRad(l)),x=Math.cos(n.MathUtils.degToRad(c)),w=Math.sin(n.MathUtils.degToRad(c)),b=Math.cos(n.MathUtils.degToRad(u)),T=Math.sin(n.MathUtils.degToRad(u)),M=Math.cos(n.MathUtils.degToRad(d)),S=Math.sin(n.MathUtils.degToRad(d));let E,A,C;a.MathUtils.newVector3(b*M,T*M,S,t.zAxis),a.MathUtils.newVector3(-T,b,0,t.xAxis),a.MathUtils.newVector3(-b*S,-T*S,M,t.yAxis),s>=0?(E=Math.abs(m*(b*(v-w)+T*(x-g))),A=M*f-S*m,C=M*_-S*y*(b*x+T*w)):(l<=0?(E=Math.abs(y*(b*(v-w)+T*(x-g))),C=M*_-S*y):(E=Math.abs(b*(v-w)+T*(x-g)),C=M*_-S*y*(T*w+b*x)),A=M*f-S*m*(b*x+T*w));const P=.5*(this.unitScale+(null!==(i=e.maxAltitude)&&void 0!==i?i:0)),L=.5*(this.unitScale+(null!==(r=e.minAltitude)&&void 0!==r?r:0)),R=M*(b*x+T*w),D=Math.min(y*R+_*S,m*R+f*S);return a.MathUtils.newVector3(E*P,(C-A)*P,P-D*L,t.extents),a.MathUtils.newVector3(0,(A+C)*P,P+P,t.position),function(e,t,i,n){const r=e.x*n.x+t.x*n.y+i.x*n.z,s=e.y*n.x+t.y*n.y+i.y*n.z,o=e.z*n.x+t.z*n.y+i.z*n.z;n.x=r,n.y=s,n.z=o}(t.xAxis,t.yAxis,t.zAxis,t.position),t.position.x=t.position.x-t.zAxis.x*t.extents.z,t.position.y=t.position.y-t.zAxis.y*t.extents.z,t.position.z=t.position.z-t.zAxis.z*t.extents.z,t}throw new Error("Invalid bounding box")}unprojectBox(e){throw new Error("Method not implemented.")}getScaleFactor(e){return 1}groundDistance(e){return m(e)-this.unitScale}scalePointToSurface(e){const t=this.unitScale/(m(e)||1);return e.x*=t,e.y*=t,e.z*=t,e}surfaceNormal(e,t){void 0===t&&(t={x:0,y:0,z:0});const i=1/(m(e)||1);return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t}reprojectPoint(e,t,i){if(e===h.mercatorProjection||e===h.webMercatorProjection){const{x:n,y:r,z:s}=t,o=this.unitScale,a=n/o-Math.PI,l=r/o-Math.PI,c=Math.exp(l),u=c*c,d=2*c/(u+1),m=(u-1)/(u+1),p=o+s;return void 0===i&&(i={}),i.x=Math.cos(a)*d*p,i.y=Math.sin(a)*d*p,i.z=m*p,e===h.webMercatorProjection&&(i.z=-i.z),i}return super.reprojectPoint(e,t,i)}localTangentSpace(e,t){let i;(0,s.isGeoCoordinatesLike)(e)?(this.projectPoint(e,t.position),i=e):(a.MathUtils.copyVector3(e,t.position),i=this.unprojectPoint(e));const r=n.MathUtils.degToRad(i.latitude),o=n.MathUtils.degToRad(i.longitude),l=Math.cos(o),c=Math.sin(o),h=Math.cos(r),u=Math.sin(r);return a.MathUtils.newVector3(l*h,c*h,u,t.zAxis),a.MathUtils.newVector3(-c,l,0,t.xAxis),a.MathUtils.newVector3(-l*u,-c*u,h,t.yAxis),t}}t.sphereProjection=new f(c.EarthConstants.EQUATORIAL_RADIUS)},7289:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transverseMercatorProjection=t.TransverseMercatorUtils=void 0;const n=i(82),r=i(3068),s=i(4860),o=i(9264),a=i(7523),l=i(58),c=i(5610),h=i(5234);class u extends h.Projection{static clampGeoPoint(e,t){const i=e.latitude,n=e.longitude,r=d.POLE_RADIUS,o=d.POLE_RADIUS_SQ,a=Math.round(n/90),l=90*a-n;if(a%2==0||Math.abs(l)>r)return e;const c=i-0,h=l*l+c*c;if(h<o){const e=Math.sqrt(h),t=(r-e)/e,o=0===l&&0===c?1*r:l;return new s.GeoCoordinates(i+c*t,n+o*t)}return e}constructor(e){super(e),this.unitScale=e,this.type=h.ProjectionType.Planar,this.m_phi0=0,this.m_lambda0=0}getScaleFactor(e){return Math.cosh(2*(e.x/this.unitScale-.5)*Math.PI)}worldExtent(e,t,i){return i||(i=new n.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale,i.max.z=t,i}projectPoint(e,t){var i;t||(t={x:0,y:0,z:0});const r=u.clampGeoPoint(e,this.unitScale),s=r.longitude/360+.5,o=1===s?0:Math.floor(s),a=n.MathUtils.degToRad(r.latitude),l=n.MathUtils.degToRad(r.longitude-360*o)-this.m_lambda0,c=Math.cos(a)*Math.sin(l);t.x=Math.atanh(c),t.y=Math.atan2(Math.tan(a),Math.cos(l))-this.m_phi0;const h=.5/Math.PI;return t.x=this.unitScale*(n.MathUtils.clamp(t.x*h+.5,0,1)+o),t.y=this.unitScale*n.MathUtils.clamp(t.y*h+.5,0,1),t.z=null!==(i=e.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){const t=2*Math.PI,i=e.x/this.unitScale,n=e.y/this.unitScale,r=1===i?0:Math.floor(i),o=t*(i-.5-r),a=t*(n-.5),l=e.z||0,c=a+this.m_phi0,h=Math.asin(Math.sin(c)/Math.cosh(o)),u=this.m_lambda0+Math.atan2(Math.sinh(o),Math.cos(c))+r*t;return s.GeoCoordinates.fromRadians(h,u,l)}projectBox(e,t){const{north:i,south:r,east:c,west:h}=e,u=[e.center,e.northEast,e.southWest,new s.GeoCoordinates(r,c),new s.GeoCoordinates(i,h)],m=d.POLE_EDGE_DEG,p=h<90&&c>90,f=h<0&&c>0,g=h<m&&c>-m&&i>0&&r<0;h<-90&&c>-90&&(u.push(new s.GeoCoordinates(i,-90)),u.push(new s.GeoCoordinates(r,-90))),p&&(u.push(new s.GeoCoordinates(i,90)),u.push(new s.GeoCoordinates(r,90))),f&&(u.push(new s.GeoCoordinates(i,0)),u.push(new s.GeoCoordinates(r,0))),g&&(u.push(new s.GeoCoordinates(0,h)),u.push(new s.GeoCoordinates(0,c))),d.alignLatitude(u,u[0]);const v=u.map((e=>this.projectPoint(e))),y=v.map((e=>e.x)),_=v.map((e=>e.y)),x=v.map((e=>e.z)),w=Math.min(...y),b=Math.min(..._),T=Math.min(...x),M=Math.max(...y),S=Math.max(..._),E=Math.max(...x);if(t||(t=new n.Box3),(0,o.isBox3Like)(t))t.min.x=w,t.min.y=b,t.min.z=T,t.max.x=M,t.max.y=S,t.max.z=E;else{if(!(0,l.isOrientedBox3Like)(t))throw new Error("invalid bounding box");a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=(w+M)/2,t.position.y=(b+S)/2,t.position.z=(T+E)/2,t.extents.x=(M-w)/2,t.extents.y=(S-b)/2,t.extents.z=(E-T)/2}return t}unprojectBox(e){const t=this.unitScale,i=e.min,n=e.max,o=[{x:(i.x+n.x)/2,y:(i.y+n.y)/2,z:0},i,n,{x:i.x,y:n.y,z:0},{x:n.x,y:i.y,z:0}],a=.5*t,l=.25*t,c=.75*t,h=i.x<a&&n.x>a,u=i.y<a&&n.y>a,m=i.y<l&&n.y>l,p=i.y<c&&n.y>c;u&&(o.push({x:i.x,y:a,z:0}),o.push({x:n.x,y:a,z:0}),h&&o.push({x:a,y:a,z:0})),m&&(o.push({x:i.x,y:l,z:0}),o.push({x:n.x,y:l,z:0}),h&&o.push({x:a,y:l,z:0})),p&&(o.push({x:i.x,y:c,z:0}),o.push({x:n.x,y:c,z:0}),h&&o.push({x:a,y:c,z:0}));const f=o.map((e=>this.unprojectPoint(e)));d.alignLongitude(f,f[0]);const g=f.map((e=>e.latitude)),v=f.filter((e=>Math.abs(e.latitude)<90)).map((e=>e.longitude)),y=f.map((e=>{var t;return null!==(t=e.altitude)&&void 0!==t?t:0})),_=new s.GeoCoordinates(Math.min(...g),Math.min(...v),Math.min(...y)),x=new s.GeoCoordinates(Math.max(...g),Math.max(...v),Math.max(...y));return r.GeoBox.fromCoordinates(_,x)}unprojectAltitude(e){return e.z}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}}class d{static alignLatitude(e,t){for(const i of e)0===i.latitude&&(i.latitude=1e-9*t.latitude)}static alignLongitude(e,t){const i=t.longitude<0?180:-180,n=t.longitude<0?-180:180;for(const t of e)t.longitude===i&&(t.longitude=n)}}t.TransverseMercatorUtils=d,d.POLE_EDGE=1.4844222297453322,d.POLE_EDGE_DEG=n.MathUtils.radToDeg(d.POLE_EDGE),d.POLE_RADIUS=90-d.POLE_EDGE_DEG,d.POLE_RADIUS_SQ=Math.pow(d.POLE_RADIUS,2),t.transverseMercatorProjection=new u(c.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},9861:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlatTileBoundingBoxGenerator=void 0;const n=i(82);t.FlatTileBoundingBoxGenerator=class{constructor(e,t=0,i=0){this.tilingScheme=e,this.minElevation=t,this.maxElevation=i,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,i);const{min:n,max:r}=this.m_worldBox;this.m_worldDimensions={x:r.x-n.x,y:r.y-n.y,z:r.z-n.z}}get projection(){return this.m_tilingScheme.projection}get subdivisionScheme(){return this.m_tilingScheme.subdivisionScheme}getWorldBox(e,t){const i=e.level,r=this.subdivisionScheme.getLevelDimensionX(i),s=this.subdivisionScheme.getLevelDimensionY(i),o=this.m_worldDimensions.x/r,a=this.m_worldDimensions.y/s,l=this.m_worldBox.min.x+o*e.column,c=this.m_worldBox.min.y+a*e.row;return t||(t=new n.Box3),t.min.x=l,t.min.y=c,t.min.z=this.m_worldBox.min.z,t.max.x=l+o,t.max.y=c+a,t.max.z=this.m_worldBox.max.z,t}getGeoBox(e){const t=this.getWorldBox(e);return this.projection.unprojectBox(t)}}},435:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.halfQuadTreeSubdivisionScheme=void 0,t.halfQuadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(e){return 0===e?1:2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 0!==e?1<<e-1:1}}},4490:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hereTilingScheme=void 0;const n=i(1515),r=i(435),s=i(6557);t.hereTilingScheme=new s.TilingScheme(r.halfQuadTreeSubdivisionScheme,n.normalizedEquirectangularProjection)},1635:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mercatorTilingScheme=void 0;const n=i(9885),r=i(9447),s=i(6557);t.mercatorTilingScheme=new s.TilingScheme(r.quadTreeSubdivisionScheme,n.mercatorProjection)},1871:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.polarTilingScheme=void 0;const n=i(7289),r=i(9447),s=i(6557);t.polarTilingScheme=new s.TilingScheme(r.quadTreeSubdivisionScheme,n.transverseMercatorProjection)},7171:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuadTree=void 0;const n=i(6541);t.QuadTree=class{constructor(e){this.tilingScheme=e}visit(e){this.visitTileKey(n.TileKey.fromRowColumnLevel(0,0,0),e)}visitTileKey(e,t){if(t(e,this.tilingScheme.getGeoBox(e)))for(const i of this.tilingScheme.getSubTileKeys(e))this.visitTileKey(i,t)}}},9447:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quadTreeSubdivisionScheme=void 0,t.quadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(){return 2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 1<<e}}},3424:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubTiles=void 0;const n=i(6541);class r{constructor(e,t,i){this.tileKey=e,this.sizeX=t,this.sizeY=i}[Symbol.iterator](){return 2===this.sizeX&&2===this.sizeY?r.ZCurveIterator(this.tileKey):r.RowColumnIterator(this.tileKey,this.sizeX,this.sizeY)}}t.SubTiles=r,function(e){e.RowColumnIterator=function*(e,t,i){for(let r=0;r<i;r++)for(let s=0;s<t;s++)yield n.TileKey.fromRowColumnLevel(e.row*i+r,e.column*t+s,e.level+1)},e.ZCurveIterator=function*(e){for(let t=0;t<4;t++)yield n.TileKey.fromRowColumnLevel(e.row<<1|t>>1,e.column<<1|1&t,e.level+1)}}(r=t.SubTiles||(t.SubTiles={}))},4948:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6541:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileKey=void 0;const i=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];class n{static fromRowColumnLevel(e,t,i){return new n(e,t,i)}static fromQuadKey(e){const t=e.length;let i=0,r=0;for(let n=0;n<e.length;++n){const s=1<<n,o=parseInt(e.charAt(t-n-1),10);1&o&&(r|=s),2&o&&(i|=s)}return n.fromRowColumnLevel(i,r,t)}static fromMortonCode(e){let t=0,i=0,r=0,s=e;for(;s>1;){const e=1<<t;1&s&&(r|=e),2&s&&(i|=e),t++,s=(s-(3&s))/4}const o=n.fromRowColumnLevel(i,r,t);return o.m_mortonCode=e,o}static fromHereTile(e){const t=n.fromMortonCode(parseInt(e,10));return t.m_hereTile=e,t}static columnsAtLevel(e){return Math.pow(2,e)}static rowsAtLevel(e){return Math.pow(2,e)}static atCoords(e,t,i,r,s){return n.fromRowColumnLevel(Math.floor(i/(s/n.rowsAtLevel(e))),Math.floor(t/(r/n.columnsAtLevel(e))),e)}static parentMortonCode(e){return Math.floor(e/4)}constructor(e,t,i){this.row=e,this.column=t,this.level=i}parent(){if(0===this.level)throw new Error("Cannot get the parent of the root tile key");return n.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)}changedLevelBy(e){const t=Math.max(0,this.level+e);let i=this.row,r=this.column;return e>=0?(i<<=e,r<<=e):(i>>>=-e,r>>>=-e),n.fromRowColumnLevel(i,r,t)}changedLevelTo(e){return this.changedLevelBy(e-this.level)}mortonCode(){if(void 0===this.m_mortonCode){let e=this.column,t=this.row,n=i[this.level<<1];for(let r=0;r<this.level;++r)1&e&&(n+=i[2*r]),1&t&&(n+=i[2*r+1]),e>>>=1,t>>>=1;this.m_mortonCode=n}return this.m_mortonCode}toHereTile(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile}toQuadKey(){let e="";for(let t=this.level;t>0;--t){const i=1<<t-1,n=0!=(this.column&i),r=0!=(this.row&i);e+=n&&r?"3":r?"2":n?"1":"0"}return e}equals(e){return this.row===e.row&&this.column===e.column&&this.level===e.level}addedSubKey(e){const t=n.fromQuadKey(0===e.length?"-":e),i=this.changedLevelBy(t.level);return n.fromRowColumnLevel(i.row+t.row,i.column+t.column,i.level)}addedSubHereTile(e){const t=n.fromHereTile(e),i=this.changedLevelBy(t.level);return n.fromRowColumnLevel(i.row+t.row,i.column+t.column,i.level)}getSubHereTile(e){const t=1<<2*e;return(this.mortonCode()&t-1|t).toString()}rowCount(){return n.rowsAtLevel(this.level)}columnCount(){return n.columnsAtLevel(this.level)}}t.TileKey=n},7841:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileKeyUtils=t.powerOfTwo=void 0;const n=i(4860),r=i(6541);t.powerOfTwo=(()=>{let e=.5;return new Array(53).fill(0).map((()=>e*=2))})(),function(e){function i(e,t,i){const n=e.projection,s=e.subdivisionScheme,o=s.getLevelDimensionX(i),a=s.getLevelDimensionY(i),{min:l,max:c}=n.worldExtent(0,0),h=c.x-l.x,u=c.y-l.y;if(t.x<l.x||t.x>c.x)return null;if(t.y<l.y||t.y>c.y)return null;const d=Math.min(o-1,Math.floor(o*(t.x-l.x)/h)),m=Math.min(a-1,Math.floor(a*(t.y-l.y)/u));return r.TileKey.fromRowColumnLevel(m,d,i)}function s(e,i,n=4){const r=function(e,i=4){let n=0;const r=t.powerOfTwo[i];for(e+=r/2;e<0;)e+=r;for(;e>=r;)e-=r;for(let r=0;r<i&&e>0;r++)1&e&&(n+=t.powerOfTwo[53-i+r]),e>>>=1;return n}(i,n);return e.mortonCode()+r}function o(e,i=4){let n=0,r=e,s=0;for(;s<i;s++){const e=t.powerOfTwo[52-s];r>=e&&(r-=e,n+=t.powerOfTwo[i-1-s])}return n-=t.powerOfTwo[i-1],{offset:n,mortonCode:r}}e.geoCoordinatesToTileKey=function(e,t,n){return i(e,e.projection.projectPoint(t),n)},e.worldCoordinatesToTileKey=i,e.geoRectangleToTileKeys=function(t,i,s){const o=(e,t,i)=>e<t?i-(t-e)%(i-t):t+(e-t)%(i-t),a=(e,t,i)=>Math.min(Math.max(e,t),i),l=o(i.southWest.longitudeInRadians,-Math.PI,Math.PI),c=a(i.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),h=o(i.northEast.longitudeInRadians,-Math.PI,Math.PI),u=a(i.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),d=e.geoCoordinatesToTileKey(t,n.GeoCoordinates.fromRadians(c,l),s),m=e.geoCoordinatesToTileKey(t,n.GeoCoordinates.fromRadians(u,h),s),p=t.subdivisionScheme.getLevelDimensionX(s);if(!d||!m)throw new Error("Invalid coordinates");const f=d.column;let g=m.column;l>h&&(g+=g!==f?p:p-1);const v=Math.min(d.row,m.row),y=Math.max(d.row,m.row),_=new Array;for(let e=v;e<=y;++e)for(let t=f;t<=g;++t)_.push(r.TileKey.fromRowColumnLevel(e,t%p,s));return _},e.getKeyForTileKeyAndOffset=s,e.extractOffsetAndMortonKeyFromKey=o,e.getParentKeyFromKey=function(e,t=4){const{offset:i,mortonCode:n}=o(e,t);return s(r.TileKey.fromMortonCode(r.TileKey.parentMortonCode(n)),i,t)}}(t.TileKeyUtils||(t.TileKeyUtils={}))},2801:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileTreeTraverse=void 0;const n=i(3424);t.TileTreeTraverse=class{constructor(e){this.m_subdivisionScheme=e}subTiles(e){const t=this.m_subdivisionScheme.getSubdivisionX(e.level),i=this.m_subdivisionScheme.getSubdivisionY(e.level);return new n.SubTiles(e,t,i)}}},6557:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilingScheme=void 0;const n=i(9861),r=i(7841),s=i(2801);t.TilingScheme=class{constructor(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new n.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new s.TileTreeTraverse(e)}getSubTileKeys(e){return this.tileTreeTraverse.subTiles(e)}getTileKey(e,t){return r.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)}getTileKeys(e,t){return r.TileKeyUtils.geoRectangleToTileKeys(this,e,t)}getGeoBox(e){return this.boundingBoxGenerator.getGeoBox(e)}getWorldBox(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)}}},2224:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webMercatorTilingScheme=void 0;const n=i(9885),r=i(9447),s=i(6557);t.webMercatorTilingScheme=new s.TilingScheme(r.quadTreeSubdivisionScheme,n.webMercatorProjection)},3211:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(4388),t),r(i(3711),t),r(i(8487),t),r(i(3674),t)},8487:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionLine=t.HighPrecisionWireFrameLine=void 0;const n=i(82),r=i(3674);class s extends n.Line{constructor(e,t,i){super(e,t),this.matrixWorldInverse=new n.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}get shaderMaterial(){return this.material}setPositions(e){r.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.onBeforeRender=(e,t,i,n,s,o)=>{r.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.copy(this.matrixWorld).invert()}}t.HighPrecisionWireFrameLine=s;class o extends n.Mesh{constructor(e,t,i){super(e,t),this.matrixWorldInverse=new n.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}get shaderMaterial(){return this.material}setPositions(e){r.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.onBeforeRender=(e,t,i,n,s,o)=>{r.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.copy(this.matrixWorld).invert()}}t.HighPrecisionLine=o},1939:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionPoints=void 0;const n=i(82),r=i(4250),s=i(3674);class o extends n.Points{constructor(e,t,i,s,o){void 0===t&&(t=new r.HighPrecisionPointMaterial({color:s||r.HighPrecisionPointMaterial.DEFAULT_COLOR,opacity:void 0!==o?o:1})),super(void 0===e?new n.BufferGeometry:e,t),this.matrixWorldInverse=new n.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}clearGeometry(){return this.geometry=new n.BufferGeometry}get shaderMaterial(){return this.material}setPositions(e){s.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.material.isHighPrecisionPointsMaterial&&void 0!==this.dimensionality&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=(e,t,i,n,r,o)=>{s.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.copy(this.matrixWorld).invert()}}t.HighPrecisionPoints=o},3674:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionUtils=void 0;const n=i(82),r=i(4250),s=i(8487),o=i(1939),a=i(3711);!function(e){function t(e){return new n.Vector3(Math.fround(e.x),Math.fround(e.y),Math.fround(e.z))}function i(e,i){const r=(new n.Matrix4).copy(e.projectionMatrix).multiply(e.matrixWorldInverse),s=new n.Vector3(0,0,0).applyMatrix4(i),o=t(s);return{viewProjection:r,eyePosHi:o,eyePosLo:t(s.sub(o))}}function l(e){if(e.length>0){const t=e[0];if(null==t)throw Error("Empty element in positions");const i=new Array,r=new Array,s=(...e)=>{for(const t of e){const e=Math.fround(t);r.push(t-e),i.push(e)}},o=e=>{s(e.x,e.y,e.z)};if(void 0!==t.z)e.forEach((e=>{o(e)}));else{if(i.length%3!=0)throw Error("Positions must be 3D, not 2D");e.forEach((e=>{s(e)}))}return{positionHigh:new n.Float32BufferAttribute(i,3),positionLow:new n.Float32BufferAttribute(r,3)}}return{positionHigh:new n.Float32BufferAttribute([],3),positionLow:new n.Float32BufferAttribute([],3)}}function c(e,t,i=0){const n=new Array,r=e.length;for(let s=0;s<r;s+=t){for(let t=0;t<i;t++)n.push(e[s+t]);const r=e[s+i],o=e[s+i+1],a=e[s+i+2],l=Math.fround(r),c=r-l,h=Math.fround(o),u=o-h,d=Math.fround(a),m=a-d;n.push(l,h,d,c,u,m);for(let r=i+3;r<t;r++)n.push(e[s+r])}return n}function h(e,t){const i=l(t);return e.bufferGeometry.setAttribute("position",i.positionHigh),e.bufferGeometry.setAttribute("positionLow",i.positionLow),i.positionHigh.itemSize}e.doubleToFloatVec=t,e.makeFloatVec=function(e){const t=Math.fround(e.x),i=Math.fround(e.y),r=Math.fround(e.z),s=new n.Vector3(e.x-t,e.y-i,e.z-r);return e.x=Math.fround(t),e.y=Math.fround(i),e.z=Math.fround(r),s},e.createHighPrecisionCameraPos=i,e.updateHpUniforms=function(e,t,n){const r=i(t,e.matrixWorldInverse),s=r.viewProjection;if(void 0===n||!n.isMaterial)throw Error("High pecision line has no high precision material");if(!(n.uniforms&&n.uniforms.u_mvp&&n.uniforms.u_eyepos&&n.uniforms.u_eyepos_lowpart))throw Error("High pecision material has missing uniforms");n.uniforms.u_mvp.value=new Float32Array(s.elements),n.uniforms.u_eyepos.value=new Float32Array(r.eyePosHi.toArray()),n.uniforms.u_eyepos_lowpart.value=new Float32Array(r.eyePosLo.toArray())},e.createAttributes=l,e.addInterleavedAttributes3=c,e.setPositions=h,e.convertPositions=function(e){if(e.length<=0)return{positions:[]};const t=e[0];if(null==t)throw Error("Empty element in positions");const i=t;if(void 0===i.y&&void 0===i.z)return{positions:e};const n=new Array;return e.forEach((e=>{n.push(e.x,e.y,e.z)})),{positions:n}},e.createLine=function(e,t){const i=void 0!==t.lineWidth?t.lineWidth:5,o=void 0!==t.addCircles&&t.addCircles,l=void 0!==t.wireFrame&&t.wireFrame,h=[],u=[];(0,a.triangulateLine)(e,i,h,u,o);const d=new n.BufferGeometry,m=c(h,3),p=new n.InterleavedBuffer(new Float32Array(m),6),f=new n.InterleavedBufferAttribute(p,3,0,!1),g=new n.InterleavedBufferAttribute(p,3,3,!1);d.setAttribute("position",f),d.setAttribute("positionLow",g),d.setIndex(new n.BufferAttribute(new Uint32Array(u),1));const v=new r.HighPrecisionLineMaterial(t),y=l?new s.HighPrecisionWireFrameLine(d,v):new s.HighPrecisionLine(d,v);return y.setupForRendering(),y},e.createPoints=function(e,t){const i=[];for(let t=0;t<e.length;t++)i.push(i.length/3);const s=new n.BufferGeometry,a=(0,r.isHighPrecisionPointMaterial)(t)?t:new r.HighPrecisionPointMaterial(t),l=new o.HighPrecisionPoints(s,a);return h(l,e),l.setupForRendering(),l}}(t.HighPrecisionUtils||(t.HighPrecisionUtils={}))},4388:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineGroup=t.createSimpleLineGeometry=t.createLineGeometry=t.LineGeometry=void 0;const n=i(82),r=i(4342),s=new n.Vector3,o=new n.Vector3,a=new n.Vector3,l=new n.Vector3,c=new n.Vector3,h={attributes:[{name:"extrusionCoord",itemSize:3,offset:0},{name:"position",itemSize:3,offset:3},{name:"tangent",itemSize:3,offset:6},{name:"biTangent",itemSize:4,offset:9}],stride:13},u={attributes:[{name:"uv",itemSize:2,offset:h.stride},{name:"normal",itemSize:3,offset:h.stride+2}],stride:5},d={attributes:[...h.attributes,...u.attributes],stride:h.stride+u.stride},m={attributes:[{name:"extrusionCoord",itemSize:2,offset:0},{name:"position",itemSize:3,offset:2},{name:"positionLow",itemSize:3,offset:5},{name:"tangent",itemSize:3,offset:8},{name:"biTangent",itemSize:4,offset:11}],stride:15},p={attributes:[...m.attributes,...u.attributes],stride:m.stride+u.stride};class f{constructor(){this.vertices=[],this.vertexColors=[],this.indices=[]}}function g(e,t){return t?e?p:m:e?d:h}function v(e,t,i,n,h,u,d=new f,m=!1){if(0===t.length)return d;const p=g(void 0!==h,m).stride,v=t.length/3,y=new Array(v),_=new Array(t.length-3),x=d.vertices.length/p,w=void 0!==n&&n.length>0,b=void 0!==h&&h.length>0,T=void 0!==u&&u.length&&t.length;(0,r.assert)(!w||n.length===v),(0,r.assert)(!b||h.length/2===v),(0,r.assert)(!T||u.length===t.length);let M=.1;y[0]=M;for(let e=0;e<v-1;++e){let i=0;for(let n=0;n<3;++n){const r=t[3*(e+1)+n]-t[3*e+n];_[3*e+n]=r,i+=r*r}M+=Math.sqrt(i),y[e+1]=M}const S=w?Math.abs(n[n.length-1]-n[0]):1,E=y[y.length-1]/S;if(w)for(let e=0;e<v;++e)y[e]=n[e]*E+.1;let A=!0;for(let e=0;e<3;++e)A=A&&t[e]===t[t.length-3+e];const C=[],P=(n,r,p,f,g)=>{C.length=0,d.vertices.push(f,-1*g,E),C.push(f,1*g,E);for(let e=0;e<3;++e){if(m){const i=Math.fround(t[3*n+e]),r=t[3*n+e]-i;d.vertices.push(i,r),C.push(i,r)}else d.vertices.push(t[3*n+e]),C.push(t[3*n+e]);o.setComponent(e,t[3*n+e])}for(let e=0;e<3;++e)a.setComponent(e,_[r+e]),l.setComponent(e,_[p+e]);a.normalize(),d.vertices.push(a.x,a.y,a.z),C.push(a.x,a.y,a.z),o.add(e),i.surfaceNormal(o,o);const v=function(e,t,i,n){let r=0;return t.equals(i)||(r=Math.acos(t.dot(i))*Math.sign(e.dot(s.copy(t).cross(i))),Number.isNaN(r)&&(r=0)),n.copy(t).add(i).normalize().cross(e).normalize(),r}(o,a,l.normalize(),c);d.vertices.push(c.x,c.y,c.z,v),C.push(c.x,c.y,c.z,v),b&&(d.vertices.push(h[2*n],h[2*n+1]),C.push(h[2*n],h[2*n+1]),d.vertices.push(o.x,o.y,o.z),C.push(o.x,o.y,o.z)),d.vertices.push(...C),T&&(d.vertexColors.push(u[3*n],u[3*n+1],u[3*n+2]),d.vertexColors.push(u[3*n],u[3*n+1],u[3*n+2]))};for(let e=0;e<v;++e){const t=A&&0===e?_.length-3:3*Math.max(0,e-1),i=A&&e===v-1?0:Math.min(3*e,_.length-3);e>0&&P(e,t,i,y[e-1],y[e]),e+1<v&&P(e,t,i,-1*y[Math.min(e,y.length-1)],y[Math.min(e+1,y.length-1)])}for(let e=0;e<v-1;++e){const t=x+4*e;d.indices.push(t,t+1,t+2,t+2,t+1,t+3)}return d}function y(e,t,i=new f){if(0===e.length)return i;const n=e.length/3;let r=i.vertices.length/3;const s=void 0!==t&&t.length&&e.length;for(let o=0;o<n;++o,r++){o>0&&i.indices.push(r),o<n-1&&i.indices.push(r);for(let n=0;n<3;++n)i.vertices.push(e[3*o+n]),s&&i.vertexColors.push(t[3*o+n])}return i}t.LineGeometry=f,t.createLineGeometry=v,t.createSimpleLineGeometry=y;class _{static createGeometry(e,t,i,r,s=!1,o=!1,a=!1){if(a)return r.setAttribute("position",new n.BufferAttribute(new Float32Array(e),3)),t.length===e.length&&r.setAttribute("color",new n.BufferAttribute(new Float32Array(t),3)),r.setIndex(new n.BufferAttribute(new Uint32Array(i),1)),r;{const a=g(s,o),l=new n.InterleavedBuffer(new Float32Array(e),a.stride);return a.attributes.forEach((e=>{const t=new n.InterleavedBufferAttribute(l,e.itemSize,e.offset,!1);r.setAttribute(e.name,t)})),t.length===e.length&&r.setAttribute("color",new n.BufferAttribute(new Float32Array(t),3)),r.setIndex(new n.BufferAttribute(new Uint32Array(i),1)),r}}constructor(e=!1,t=!1,i=!1){this.hasNormalsAndUvs=e,this.highPrecision=t,this.isSimple=i,this.m_geometry=new f}clear(){this.m_geometry.vertices=[],this.m_geometry.vertexColors=[],this.m_geometry.indices=[]}add(e,t,i,n,s,o){return this.isSimple?y(t,o,this.m_geometry):((0,r.assert)(!this.hasNormalsAndUvs||void 0!==s),v(e,t,i,n,s,o,this.m_geometry,this.highPrecision)),this}get vertices(){return this.m_geometry.vertices}get vertexColors(){return this.m_geometry.vertexColors}get indices(){return this.m_geometry.indices}get vertexAttributes(){return g(this.hasNormalsAndUvs,this.highPrecision).attributes}get stride(){return g(this.hasNormalsAndUvs,this.highPrecision).stride}createGeometry(e){return void 0===e&&(e=new n.BufferGeometry),_.createGeometry(this.m_geometry.vertices,this.m_geometry.vertexColors,this.m_geometry.indices,e,this.hasNormalsAndUvs,this.highPrecision)}}t.LineGroup=_},3711:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reconstructLineWidth=t.reconstructLine=t.triangulateLine=t.numCirclePoints=void 0;const n=i(82),r=new n.Vector3(0,0,1),s=[0,1,2,1,3,2],o=[0,1,3,3,1,2,0,3,4,5,4,3],a=Math.PI/8;function l(e,t,i,n,r,s){const o=r.length/3;r.push(e,t,0);for(let l=0;l<9;++l){const c=a*l+Math.PI/2+i;r.push(e+n*Math.cos(c),t+n*Math.sin(c),0),s.push(o,o+l+1,o+(l+1)%9+1)}}t.numCirclePoints=function(e){return 9},t.triangulateLine=function(e,t,i,a,c=!0,h=c){if(e.length<3)return;const u=new n.Vector2;if(c){const n=3!==e.length?u.set(e[3]-e[0],e[4]-e[1]).angle():0;l(e[0],e[1],n,t,i,a)}const d=i.length/3,m=new n.Vector3,p=new n.Vector3,f=new n.Vector3,g=new n.Vector3,v=new n.Vector3,y=new n.Vector3,_=new n.Vector3,x=new n.Vector3,w=new n.Vector3,b=e.length/3;let T=0;for(let n=0;n<b;++n){let l=!1;if(p.set(e[3*n],e[3*n+1],e[3*n+2]),n+1<b){if(f.set(e[3*(n+1)],e[3*(n+1)+1],e[3*(n+1)+2]),g.copy(f).sub(p).normalize().cross(r),v.copy(g),n>0&&(v.add(m).multiplyScalar(1-.5*g.dot(m)),l=m.angleTo(g)>Math.PI/2,l)){const e=t/Math.cos(g.angleTo(m)/2);y.copy(g).add(m).normalize().multiplyScalar(-e).add(p),_.copy(m).multiplyScalar(t).add(p),x.copy(g).add(m).normalize().multiplyScalar(e).add(p),w.copy(g).multiplyScalar(t).add(p)}l?i.push(y.x,y.y,y.z,_.x,_.y,_.z,x.x,x.y,x.z,w.x,w.y,w.z):(y.copy(v).multiplyScalar(-t).add(p),_.copy(v).multiplyScalar(t).add(p),i.push(y.x,y.y,y.z,_.x,_.y,_.z)),m.copy(g)}else y.copy(m).multiplyScalar(-t).add(p),_.copy(m).multiplyScalar(t).add(p),i.push(y.x,y.y,y.z,_.x,_.y,_.z);n!==b-1&&((l?o:s).forEach((e=>a.push(d+T+e))),T+=l?4:2)}if(h){const n=2!==e.length?u.set(e[3*(b-3)]-e[3*(b-2)],e[3*(b-3)+1]-e[3*(b-2)+1]).angle():Math.PI;l(e[3*(b-2)],e[3*(b-2)+1],n,t,i,a)}},t.reconstructLine=function(e,t){const i=new Float32Array(e.length/2);for(let n=3*t,r=2*n;n<i.length;n+=3,r+=6)i[n]=e[r]+.5*(e[r+3]-e[r]),i[n+1]=e[r+1]+.5*(e[r+3+1]-e[r+1]),i[n+2]=e[r+2]+.5*(e[r+3+2]-e[r+2]);return i},t.reconstructLineWidth=function(e,t){const i=e[2*t+3]-e[2*t],n=e[2*t+3+1]-e[2*t+1],r=e[2*t+3+2]-e[2*t+2];return.5*Math.sqrt(i*i+n*n+r*r)}},8263:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(8759),t)},8759:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=t.Entry=void 0;const n=i(4342);class r{constructor(e,t,i,n,r){this.key=e,this.value=t,this.size=i,this.newer=n,this.older=r}}t.Entry=r,t.LRUCache=class{constructor(e,t=(()=>1)){this.m_size=0,this.m_map=new Map,this.m_newest=null,this.m_oldest=null,this.m_capacity=e,this.m_sizeFunction=t}forEach(e,t){let i=this.m_newest;for(;null!==i;){const n=i.older;e.call(t,i.value,i.key,this),i=n}}get size(){return this.m_size}get capacity(){return this.m_capacity}get map(){return this.m_map}get newest(){return this.m_newest}get oldest(){return this.m_oldest}setCapacity(e){this.m_capacity=e,this.evict()}setCapacityAndMeasure(e,t=(()=>1)){this.m_capacity=e,this.m_sizeFunction=t,this.shrinkToCapacity()}shrinkToCapacity(){let e=0;const t=this.m_sizeFunction;let i=this.m_newest;for(;null!==i;){const n=t(i.value);i.size=n,e+=n,i=i.older}this.m_size=e,this.evict()}set(e,t){const i=this.m_sizeFunction(t);let s=this.m_map.get(e);if(void 0!==s)this.m_size=this.m_size-s.size+i,s.value=t,s.size=i,this.promoteEntry(s),this.evict();else{if(i>this.m_capacity)return;if(s=new r(e,t,i,null,null),0===this.m_map.size)this.m_newest=this.m_oldest=s;else{(0,n.assert)(null!==this.m_newest);const e=this.m_newest;s.older=this.m_newest,e.newer=s,this.m_newest=s}this.m_map.set(e,s),this.m_size+=i,this.evict()}}get(e){const t=this.m_map.get(e);if(void 0!==t)return this.promoteEntry(t),t.value}has(e){return this.m_map.has(e)}clear(){this.m_newest=this.m_oldest=null,this.m_size=0,this.m_map.clear()}evictAll(){const e=this.evictionCallback;void 0!==e&&this.forEach(((t,i)=>e(i,t))),this.clear()}evictSelected(e,t){const i=this.evictionCallback;let n=this.m_newest;for(;null!==n;){const r=n.older;e.call(t,n.value,n.key)&&(void 0!==i&&i(n.key,n.value),this.deleteEntry(n),this.m_map.delete(n.key)),n=r}}delete(e){const t=this.m_map.get(e);return void 0!==t&&(this.deleteEntry(t),this.m_map.delete(e))}evict(){for(;null!==this.m_oldest&&this.m_size>this.m_capacity;)if(void 0===this.evictOldest())return}evictOldest(){(0,n.assert)(null!==this.m_oldest);const e=this.m_oldest;(0,n.assert)(null===e.older);let t=e;if(void 0!==this.canEvict)for(;!this.canEvict(t.key,t.value);){if(null===t.newer)return;t=t.newer}if(t===e)this.m_oldest=t.newer,null!==t.newer&&((0,n.assert)(t.newer.older===t),t.newer.older=null);else{if(null===t.newer)return;(0,n.assert)(t.newer.older===t),t.newer.older=t.older,null!==t.older&&(t.older.newer=t.newer)}const i=this.m_map.delete(t.key);return(0,n.assert)(!0===i),i&&void 0!==this.evictionCallback&&this.evictionCallback(t.key,t.value),this.m_size-=t.size,t}deleteEntry(e){e===this.m_newest?this.m_newest=e.older:e.newer?e.newer.older=e.older:(0,n.assert)(!1),e===this.m_oldest?this.m_oldest=e.newer:e.older?e.older.newer=e.newer:(0,n.assert)(!1),this.m_size-=e.size}promoteEntry(e){if(e===this.m_newest)return;e.newer&&((0,n.assert)(e.newer.older===e),e.newer.older=e.older),e.older&&((0,n.assert)(e.older.newer===e),e.older.newer=e.newer),e===this.m_oldest&&(this.m_oldest=e.newer),e.newer=null,e.older=this.m_newest,(0,n.assert)(null!==this.m_newest);const t=this.m_newest;(0,n.assert)(null===t.newer),t.newer=e,this.m_newest=e}}},4609:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(3453),t),r(i(5363),t),r(i(4194),t),r(i(1555),t),r(i(1773),t),r(i(9026),t),r(i(2505),t)},2505:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraAnimationBuilder=void 0;const n=i(2616),r=i(2344),s=i(82),o=i(1350),a=i(9026);class l{static getLookAtFromView(e){return{target:e.target,heading:e.heading,tilt:e.tilt,distance:e.targetDistance}}static appendControlPoint(e,t,i){i=null!=i?i:10,e.controlPoints.length>0&&(void 0===t.timestamp||t.timestamp<=e.controlPoints[e.controlPoints.length-1].timestamp)&&(t.timestamp=e.controlPoints[e.controlPoints.length-1].timestamp+i),e.controlPoints.push(t)}static prependControlPoint(e,t,i){i=void 0!==i?i:10;for(const t of e.controlPoints)t.timestamp+=i;t.timestamp=0,e.controlPoints.unshift(t)}static createFlyToOptions(e,t,i,c){var h,u,d,m;const p=new a.ControlPoint(Object.assign({},l.getLookAtFromView(e))),f=void 0!==t.target?n.GeoCoordinates.fromObject(t.target):void 0;let g=null!=f?f:p.target;const v=void 0!==t.zoomLevel?r.MapViewUtils.calculateDistanceFromZoomLevel(e,t.zoomLevel):t.distance;let y=null!=v?v:e.targetDistance;if(void 0!==t.bounds){const i=Math.min(null!==(h=t.tilt)&&void 0!==h?h:e.tilt,r.MapViewUtils.MAX_TILT_DEG),n=-(null!==(u=t.heading)&&void 0!==u?u:e.heading),a=(0,o.getFitLookAtBoundsDistance)({target:e.target,camera:e.camera,cameraSettings:e,projection:e.projection,maxZoomLevel:e.maxZoomLevel,viewportSize:e.renderer.getSize(new s.Vector2),tileWrapping:e.tileWrappingEnabled},{bounds:t.bounds,target:f,distance:v,yaw:n,tilt:i,padding:t.padding});y=a.distance,g=a.target}const _=new a.ControlPoint({target:g,distance:y,tilt:null!==(d=t.tilt)&&void 0!==d?d:p.tilt,heading:null!==(m=t.heading)&&void 0!==m?m:p.heading});if(r.MapViewUtils.closeToFrustum(e.projection.projectPoint(g,new s.Vector3),e.camera))return _.timestamp=i(p,_),{controlPoints:[p,_]};const x=[p],w=new s.Vector3;e.projection.projectPoint(p.target,w);let b=null!=c?c:2*w.distanceTo(e.projection.projectPoint(_.target));b=Math.max(p.distance+_.distance,b);const T=n.GeoCoordinates.lerp(p.target,_.target,.25),M=new a.ControlPoint({target:T,distance:b,timestamp:0,tilt:n.MathUtils.interpolateAnglesDeg(p.tilt,_.tilt,.25),heading:n.MathUtils.interpolateAnglesDeg(p.heading,_.heading,.25)});M.timestamp=M.timestamp+i(p,M),x.push(M);const S=n.GeoCoordinates.lerp(p.target,_.target,.75),E=new a.ControlPoint({target:S,distance:b,timestamp:0,tilt:n.MathUtils.interpolateAnglesDeg(p.tilt,_.tilt,.75),heading:n.MathUtils.interpolateAnglesDeg(p.heading,_.heading,.75)});return E.timestamp=M.timestamp+i(M,E),x.push(E),_.timestamp=E.timestamp+i(E,_),x.push(_),{controlPoints:x}}static createOrbitOptions(e,t=10){const i=[e],n=t/3;for(let e=1;e<4;e++){const t=i[e-1];i.push(Object.assign(Object.assign({},t),{heading:t.heading-120,timestamp:t.timestamp+n}))}return{controlPoints:i}}}t.CameraAnimationBuilder=l},9026:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraKeyTrackAnimation=t.ControlPoint=void 0;const n=i(2616),r=i(2344),s=i(4342),o=i(82),a=s.LoggerManager.instance.create("CameraKeyTrackAnimation");t.ControlPoint=class{constructor(e){var t,i,r,s,o;this.timestamp=0,this.timestamp=null!==(t=e.timestamp)&&void 0!==t?t:0,this.target=e.target?n.GeoCoordinates.fromObject(e.target):new n.GeoCoordinates(0,0),this.tilt=null!==(i=e.tilt)&&void 0!==i?i:0,this.heading=null!==(r=e.heading)&&void 0!==r?r:0,this.distance=null!==(s=e.distance)&&void 0!==s?s:0,this.name=null!==(o=e.name)&&void 0!==o?o:Date.now().toString()}};class l extends o.Object3D{constructor(e){super(),this.distance=0,this.name=e}}t.CameraKeyTrackAnimation=class{constructor(e,t){var i,n,r,s;this.m_mapView=e,this.m_options=t,this.m_dummy=new l("dummy"),this.m_azimuthAxis=new o.Vector3(0,0,1),this.m_altitudeAxis=new o.Vector3(1,0,0),this.m_running=!1,this.m_lastFrameTime=0;const c=void 0!==this.m_options.interpolation?this.m_options.interpolation:o.InterpolateSmooth;this.m_options.loop=null!==(i=this.m_options.loop)&&void 0!==i?i:o.LoopOnce,this.m_options.repetitions=null!==(n=this.m_options.repetitions)&&void 0!==n?n:1,this.m_options.rotateOnlyClockwise=null===(r=this.m_options.rotateOnlyClockwise)||void 0===r||r,this.m_name=(null!==(s=this.m_options.name)&&void 0!==s?s:"CameraKeyTrackAnimation")+Date.now();const h=this.m_options.controlPoints.map((e=>e.timestamp)),u=[],d=[];this.m_options.controlPoints.map((e=>{const t=this.m_mapView.projection.projectPoint(e.target);u.push(t.x),u.push(t.y),u.push(t.z);const i=new o.Quaternion;i.setFromAxisAngle(this.m_azimuthAxis,o.MathUtils.degToRad(e.heading)),i.multiply((new o.Quaternion).setFromAxisAngle(this.m_altitudeAxis,o.MathUtils.degToRad(e.tilt))),d.push(i.x),d.push(i.y),d.push(i.z),d.push(i.w)}));const m=new o.VectorKeyframeTrack(".position",h,u,c),p=new o.QuaternionKeyframeTrack(".quaternion",h,d,c),f=new o.NumberKeyframeTrack(".distance",h,this.m_options.controlPoints.map((e=>e.distance)),c);this.m_animationClip=new o.AnimationClip("cameraflyoveranimation",-1,[m,p,f]),this.m_animationClip.validate()||a.error("Review the entered controlpoints for: ",this.m_name,", The Animation was provided with invalid track data"),this.m_animationClip.resetDuration(),this.m_animationClip.trim(),this.m_animationMixer=new o.AnimationMixer(this.m_dummy),this.m_animationAction=this.m_animationMixer.clipAction(this.m_animationClip),this.m_animationAction.setLoop(this.m_options.loop,this.m_options.repetitions),this.m_animationAction.clampWhenFinished=!0,this.m_animateCb=this.animate.bind(this),this.m_animationMixer.addEventListener("finished",this.stop.bind(this))}set loop(e){this.m_options.loop=e,this.m_animationAction.setLoop(this.m_options.loop,this.m_options.repetitions)}set repetitions(e){this.m_options.repetitions=e,this.m_animationAction.setLoop(this.m_options.loop,this.m_options.repetitions)}set rotateOnlyClockwise(e){this.m_options.rotateOnlyClockwise=e}start(e,t){this.m_running&&this.stop(),this.m_onFinished=t,this.m_animationAction.reset().play(),this.m_lastFrameTime=Date.now(),this.m_mapView.addEventListener(r.MapViewEventNames.Render,this.m_animateCb),this.m_mapView.beginAnimation(),this.m_running=!0}stop(){this.m_mapView.removeEventListener(r.MapViewEventNames.Render,this.m_animateCb),this.m_mapView.endAnimation(),void 0!==this.m_onFinished&&window.setTimeout(this.m_onFinished,0),this.m_running=!1}isRunning(){return this.m_running}updateCameraFromDummy(){let e=o.MathUtils.radToDeg(this.m_azimuthAxis.clone().applyQuaternion(this.m_dummy.quaternion).angleTo(this.m_azimuthAxis));e=o.MathUtils.clamp(e,0,r.MapViewUtils.MAX_TILT_DEG);const t=this.m_altitudeAxis.clone().applyQuaternion(this.m_dummy.quaternion);let i=t.angleTo(this.m_altitudeAxis);this.m_options.rotateOnlyClockwise&&this.m_azimuthAxis.dot(t.normalize().cross(this.m_altitudeAxis))>=0&&(i=2*Math.PI-i);const n=o.MathUtils.radToDeg(i),s=this.m_mapView.projection.unprojectPoint(this.m_dummy.position),l=Math.max(0,this.m_dummy.distance);(isNaN(e)||isNaN(n)||isNaN(l)||!s.isValid())&&a.error("Cannot update due to invalid data",e,n,l,s),this.m_mapView.lookAt({target:s,distance:l,tilt:e,heading:n})}animate(e){const t=(Date.now()-this.m_lastFrameTime)/1e3;this.m_animationMixer.update(t),this.m_lastFrameTime=Date.now(),this.updateCameraFromDummy()}}},4194:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LongPressHandler=void 0,t.LongPressHandler=class{constructor(e,t,i){this.element=e,this.onLongPress=t,this.onTap=i,this.timeout=500,this.moveThreshold=5,this.buttonId=0,this.m_pressEvent=void 0,this.m_timerId=void 0,this.m_moveHandlerRegistered=!1,this.m_boundPointerMoveHandler=this.onPointerMove.bind(this),this.m_boundMouseDownHandler=this.onMouseDown.bind(this),this.m_boundTouchStartHandler=this.onTouchStart.bind(this),this.m_boundMouseUpHandler=this.onMouseUp.bind(this),this.m_boundTouchEndHandler=this.onTouchEnd.bind(this),this.element.addEventListener("mousedown",this.m_boundMouseDownHandler),this.element.addEventListener("touchstart",this.m_boundTouchStartHandler),this.element.addEventListener("mouseup",this.m_boundMouseUpHandler),this.element.addEventListener("touchend",this.m_boundTouchEndHandler)}dispose(){this.cancel(),this.element.removeEventListener("mousedown",this.m_boundMouseDownHandler),this.element.removeEventListener("touchstart",this.m_boundTouchStartHandler),this.element.removeEventListener("mouseup",this.m_boundMouseUpHandler),this.element.removeEventListener("touchend",this.m_boundTouchEndHandler)}startPress(e){var t,i;this.cancelTimer(),this.m_pressEvent=null!==(i=null===(t=e.changedTouches)||void 0===t?void 0:t[0])&&void 0!==i?i:e,this.m_timerId=setTimeout((()=>this.onTimeout()),this.timeout),this.addPointerMoveHandler()}onMouseDown(e){e.button===this.buttonId&&this.startPress(e)}onTouchStart(e){this.m_pressEvent?this.cancel():1===e.changedTouches.length&&this.startPress(e)}onMouseUp(e){var t;this.m_pressEvent&&e.button===this.buttonId&&(this.cancel(),null===(t=this.onTap)||void 0===t||t.call(this,e))}onTouchEnd(e){var t;1===e.changedTouches.length&&e.changedTouches[0].identifier===this.m_pressEvent.identifier&&(this.cancel(),null===(t=this.onTap)||void 0===t||t.call(this,e.changedTouches[0]))}onPointerMove(e){var t,i;if(void 0===this.m_pressEvent)return;const{clientX:n,clientY:r}=null!==(i=null===(t=e.changedTouches)||void 0===t?void 0:t[0])&&void 0!==i?i:e;Math.abs(n-this.m_pressEvent.clientX)+Math.abs(r-this.m_pressEvent.clientY)>this.moveThreshold&&this.cancel()}cancel(){this.m_pressEvent=void 0,this.cancelTimer(),this.removePointerMoveHandler()}cancelTimer(){void 0!==this.m_timerId&&(clearTimeout(this.m_timerId),this.m_timerId=void 0)}addPointerMoveHandler(){this.m_moveHandlerRegistered||(this.element.addEventListener("mousemove",this.m_boundPointerMoveHandler),this.element.addEventListener("touchmove",this.m_boundPointerMoveHandler),this.m_moveHandlerRegistered=!0)}removePointerMoveHandler(){this.m_moveHandlerRegistered&&(this.element.removeEventListener("mousemove",this.m_boundPointerMoveHandler),this.element.removeEventListener("touchmove",this.m_boundPointerMoveHandler),this.m_moveHandlerRegistered=!1)}onTimeout(){const e=this.m_pressEvent;this.m_timerId=void 0,this.cancel(),void 0!==e&&this.onLongPress(e)}}},1773:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraPanAnimation=t.CameraRotationAnimation=t.CameraAnimation=t.InterpolationFunction=t.EasingFunction=void 0;const n=i(9761),r=i(82),s=i(2616),o=i(4342),a=i(3453);var l,c;!function(e){e[e.Linear=0]="Linear",e[e.QuadraticIn=1]="QuadraticIn",e[e.QuadraticOut=2]="QuadraticOut",e[e.QuadraticInOut=3]="QuadraticInOut",e[e.CubicIn=4]="CubicIn",e[e.CubicOut=5]="CubicOut",e[e.CubicInOut=6]="CubicInOut",e[e.QuarticIn=7]="QuarticIn",e[e.QuarticOut=8]="QuarticOut",e[e.QuarticInOut=9]="QuarticInOut",e[e.QuinticIn=10]="QuinticIn",e[e.QuinticOut=11]="QuinticOut",e[e.QuinticInOut=12]="QuinticInOut",e[e.SinusoidalIn=13]="SinusoidalIn",e[e.SinusoidalOut=14]="SinusoidalOut",e[e.SinusoidalInOut=15]="SinusoidalInOut",e[e.ExponentialIn=16]="ExponentialIn",e[e.ExponentialOut=17]="ExponentialOut",e[e.ExponentialInOut=18]="ExponentialInOut",e[e.CircularIn=19]="CircularIn",e[e.CircularOut=20]="CircularOut",e[e.CircularInOut=21]="CircularInOut",e[e.ElasticIn=22]="ElasticIn",e[e.ElasticOut=23]="ElasticOut",e[e.ElasticInOut=24]="ElasticInOut",e[e.BackIn=25]="BackIn",e[e.BackOut=26]="BackOut",e[e.BackInOut=27]="BackInOut",e[e.BounceIn=28]="BounceIn",e[e.BounceOut=29]="BounceOut",e[e.BounceInOut=30]="BounceInOut"}(l=t.EasingFunction||(t.EasingFunction={})),function(e){e[e.Linear=0]="Linear",e[e.Bezier=1]="Bezier",e[e.CatmullRom=2]="CatmullRom"}(c=t.InterpolationFunction||(t.InterpolationFunction={}));class h{constructor(e,t){this.mapView=e,this.name=t,this.running=!1,this.stopped=!1,this.duration=1e4,this.repeat=0,this.easing=n.Easing.Linear.None,void 0===u&&(u=new Map,d=new Map,u.set(l.Linear,n.Easing.Linear.None),u.set(l.QuadraticIn,n.Easing.Quadratic.In),u.set(l.QuadraticOut,n.Easing.Quadratic.Out),u.set(l.QuadraticInOut,n.Easing.Quadratic.InOut),u.set(l.CubicIn,n.Easing.Cubic.In),u.set(l.CubicOut,n.Easing.Cubic.Out),u.set(l.CubicInOut,n.Easing.Cubic.InOut),u.set(l.QuarticIn,n.Easing.Quartic.In),u.set(l.QuarticOut,n.Easing.Quartic.Out),u.set(l.QuarticInOut,n.Easing.Quartic.InOut),u.set(l.QuinticIn,n.Easing.Quintic.In),u.set(l.QuinticOut,n.Easing.Quintic.Out),u.set(l.QuinticInOut,n.Easing.Quintic.InOut),u.set(l.SinusoidalIn,n.Easing.Sinusoidal.In),u.set(l.SinusoidalOut,n.Easing.Sinusoidal.Out),u.set(l.SinusoidalInOut,n.Easing.Sinusoidal.InOut),u.set(l.ExponentialIn,n.Easing.Exponential.In),u.set(l.ExponentialOut,n.Easing.Exponential.Out),u.set(l.ExponentialInOut,n.Easing.Exponential.InOut),u.set(l.CircularIn,n.Easing.Circular.In),u.set(l.CircularOut,n.Easing.Circular.Out),u.set(l.CircularOut,n.Easing.Circular.InOut),u.set(l.ElasticIn,n.Easing.Elastic.In),u.set(l.ElasticOut,n.Easing.Elastic.Out),u.set(l.ElasticInOut,n.Easing.Elastic.InOut),u.set(l.BackIn,n.Easing.Back.In),u.set(l.BackOut,n.Easing.Back.Out),u.set(l.BackInOut,n.Easing.Back.InOut),u.set(l.BounceIn,n.Easing.Bounce.In),u.set(l.BounceOut,n.Easing.Bounce.Out),u.set(l.BounceInOut,n.Easing.Bounce.InOut),d.set(c.Linear,n.Interpolation.Linear),d.set(c.Bezier,n.Interpolation.Bezier),d.set(c.CatmullRom,n.Interpolation.CatmullRom))}update(e){return!!this.tween&&this.tween.update(null!=e?e:o.PerformanceTimer.now())}get isRunning(){return this.running}}let u,d;t.CameraAnimation=h,t.CameraRotationAnimation=class extends h{constructor(e,t,i,s){var o;super(e,s),this.m_mapControls=t,this.startAngle=0,this.endAngle=360,this.m_axis=new r.Vector3(0,0,1),this.beginInteractionListener=()=>{this.stopped||this.stopTween()},this.endInteractionListener=()=>{this.stopped||this.startTween()},void 0!==i.axis&&(this.m_axis=i.axis),void 0!==i.startAngle&&(this.startAngle=i.startAngle),void 0!==i.endAngle&&(this.endAngle=i.endAngle),void 0!==i.duration&&(this.duration=i.duration),void 0!==i.repeat&&(this.repeat=i.repeat),void 0!==i.easing&&(this.easing="function"==typeof i.easing?i.easing:null!==(o=u.get(i.easing))&&void 0!==o?o:n.Easing.Linear.None),this.m_lastRotationValue=this.startAngle}start(e,t){if(this.running)throw new Error("Animation already running"+this.name!==void 0?this.name:0);this.running=!0,this.onFinished=t,this.stopped=!1,this.m_mapControls&&(this.m_mapControls.addEventListener(a.EventNames.BeginInteraction,this.beginInteractionListener),this.m_mapControls.addEventListener(a.EventNames.EndInteraction,this.endInteractionListener)),this.startTween(e),this.mapView.beginAnimation()}stop(){if(!this.running)throw new Error("Animation not running"+this.name!==void 0?this.name:0);this.running=!1,this.stopped=!0,this.mapView.endAnimation(),this.tween&&this.tween.stop(),this.m_mapControls&&(this.m_mapControls.removeEventListener(a.EventNames.BeginInteraction,this.beginInteractionListener),this.m_mapControls.removeEventListener(a.EventNames.EndInteraction,this.endInteractionListener))}startTween(e){const t=new r.Quaternion;this.m_userCamerRotation=new r.Quaternion,this.mapView.camera.getWorldQuaternion(this.m_userCamerRotation),this.tween=new n.Tween({rotation:0}).to({rotation:this.endAngle-this.m_lastRotationValue},this.duration).onComplete((()=>{this.stop(),this.onFinished&&this.onFinished()})).onUpdate((({rotation:e})=>{this.m_lastRotationValue=e,t.setFromEuler(new r.Euler(0,0,r.MathUtils.degToRad(e))),void 0!==this.m_userCamerRotation&&t.multiply(this.m_userCamerRotation),this.mapView.camera.quaternion.copy(t)})),this.tween.repeat(this.repeat),this.tween.easing(this.easing),this.tween.start(e)}stopTween(){this.tween&&this.tween.stop()}},t.CameraPanAnimation=class extends h{constructor(e,t,i){var r,s;super(e,i),this.name=i,this.interpolation=n.Interpolation.CatmullRom,void 0!==t.duration&&(this.duration=t.duration),void 0!==t.repeat&&(this.repeat=t.repeat),void 0!==t.easing&&(this.easing="function"==typeof t.easing?t.easing:null!==(r=u.get(t.easing))&&void 0!==r?r:n.Easing.Linear.None),void 0!==t.interpolation&&(this.interpolation="function"==typeof t.interpolation?t.interpolation:null!==(s=d.get(t.interpolation))&&void 0!==s?s:n.Interpolation.Linear),this.m_geoCoordinates=void 0!==t.geoCoordinates?t.geoCoordinates:[]}addPosition(e){this.m_geoCoordinates.push(e)}start(e,t){var i;if(this.running)throw new Error("Animation already running"+this.name!==void 0?this.name:0);this.onFinished=t,this.running=!0;const r=new s.GeoCoordinates(this.mapView.geoCenter.latitude,this.mapView.geoCenter.longitude,this.mapView.camera.position.z),o={latitude:new Array,longitude:new Array,altitude:new Array};for(const e of this.m_geoCoordinates)o.latitude.push(e.latitude),o.longitude.push(e.longitude),o.altitude.push(null!==(i=e.altitude)&&void 0!==i?i:this.mapView.camera.position.z);this.tween=new n.Tween(r).to(o,this.duration).onComplete((()=>{this.stop(),this.onFinished&&this.onFinished()})).onUpdate((({latitude:e,longitude:t,altitude:i})=>{this.mapView.geoCenter=new s.GeoCoordinates(e,t,i),this.mapView.camera.position.z=null!=i?i:0})),this.tween.repeat(this.repeat),this.tween.easing(this.easing),this.tween.interpolation(this.interpolation),this.tween.start(e),this.mapView.beginAnimation()}stop(){if(!this.running)throw new Error("Animation not running"+this.name!==void 0?this.name:0);this.running=!1,this.mapView.endAnimation(),this.tween&&this.tween.stop()}get isRunning(){return this.running}}},3453:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapControls=t.EventNames=t.TiltState=void 0;const n=i(82),r=i(2616),s=i(2344),o=i(1555);var a,l,c;!function(e){e[e.NONE=0]="NONE",e[e.PAN=1]="PAN",e[e.ROTATE=2]="ROTATE",e[e.ORBIT=3]="ORBIT",e[e.TOUCH=4]="TOUCH"}(a||(a={})),function(e){e[e.Tilted=0]="Tilted",e[e.Down=1]="Down"}(l=t.TiltState||(t.TiltState={})),function(e){e.Update="update",e.BeginInteraction="begin-interaction",e.EndInteraction="end-interaction"}(c=t.EventNames||(t.EventNames={}));const h={type:c.Update},u={type:c.BeginInteraction},d={type:c.EndInteraction},m=n.MathUtils.degToRad(89),p=.01;class f extends s.EventDispatcher{static create(e,t=!0){return new f(e,t)}get zoomLevelDeltaOnMouseWheel(){return void 0!==this.m_zoomLevelDeltaOnMouseWheel?this.m_zoomLevelDeltaOnMouseWheel:this.inertiaEnabled?.8:.2}set zoomLevelDeltaOnMouseWheel(e){this.m_zoomLevelDeltaOnMouseWheel=e}constructor(e,t=!0){super(),this.mapView=e,this.rotationMouseDeltaFactor=.1,this.orbitingMouseDeltaFactor=.1*n.MathUtils.DEG2RAD,this.orbitingTouchDeltaFactor=.1*n.MathUtils.DEG2RAD,this.enabled=!0,this.zoomEnabled=!0,this.panEnabled=!0,this.tiltEnabled=!0,this.rotateEnabled=!0,this.inertiaEnabled=!0,this.zoomInertiaDampingDuration=.6,this.panInertiaDampingDuration=1,this.tiltToggleDuration=.5,this.tiltAngle=Math.PI/4,this.northResetAnimationDuration=1.5,this.zoomLevelDeltaOnControl=1,this.minZoomLevel=0,this.maxZoomLevel=20,this.minCameraHeight=3,this.zoomLevelDeltaOnDoubleClick=1,this.doubleTapTime=.3,this.m_currentViewDirection=new n.Vector3,this.m_lastMousePosition=new n.Vector2(0,0),this.m_initialMousePosition=new n.Vector2(0,0),this.m_mouseDelta=new n.Vector2(0,0),this.m_needsRenderLastFrame=!0,this.m_panIsAnimated=!1,this.m_panDistanceFrameDelta=new n.Vector3,this.m_panAnimationTime=0,this.m_panAnimationStartTime=0,this.m_lastAveragedPanDistanceOrAngle=0,this.m_currentInertialPanningSpeed=0,this.m_lastPanVector=new n.Vector3,this.m_rotateGlobeQuaternion=new n.Quaternion,this.m_lastRotateGlobeAxis=new n.Vector3,this.m_lastRotateGlobeAngle=0,this.m_lastRotateGlobeFromVector=new n.Vector3,this.m_recentPanDistancesOrAngles=[0,0,0,0,0],this.m_currentPanDistanceOrAngleIndex=0,this.m_zoomIsAnimated=!1,this.m_zoomDeltaRequested=0,this.m_zoomTargetNormalizedCoordinates=new n.Vector2,this.m_zoomAnimationTime=0,this.m_zoomAnimationStartTime=0,this.m_startZoom=0,this.m_tiltIsAnimated=!1,this.m_tiltRequested=void 0,this.m_tiltAnimationTime=0,this.m_tiltAnimationStartTime=0,this.m_startTilt=0,this.m_state=a.NONE,this.m_tmpVector2=new n.Vector2,this.m_tmpVector3=new n.Vector3,this.m_tapStartTime=0,this.m_lastSingleTapTime=0,this.m_fingerMoved=!1,this.m_isDoubleTap=!1,this.m_resetNorthStartTime=0,this.m_resetNorthIsAnimated=!1,this.m_resetNorthAnimationDuration=0,this.m_currentAzimuth=0,this.m_lastAzimuth=0,this.m_startAzimuth=0,this.m_maxTiltAngle=m,this.m_touchState={touches:[],currentRotation:0,initialRotation:0},this.dispose=()=>{},this.camera=e.camera,this.domElement=e.renderer.domElement,this.maxZoomLevel=e.maxZoomLevel,this.minZoomLevel=e.minZoomLevel,this.minCameraHeight=e.minCameraHeight,this.bindInputEvents(this.domElement),this.handleZoom=this.handleZoom.bind(this),this.handlePan=this.handlePan.bind(this),this.tilt=this.tilt.bind(this),this.resetNorth=this.resetNorth.bind(this),this.assignZoomAfterTouchZoomRender=this.assignZoomAfterTouchZoomRender.bind(this),t&&e.addEventListener(s.MapViewEventNames.Dispose,(()=>{this.dispose()}))}get attitude(){const e=s.MapViewUtils.extractAttitude(this.mapView,this.camera);return{yaw:n.MathUtils.radToDeg(e.yaw),pitch:n.MathUtils.radToDeg(e.pitch),roll:n.MathUtils.radToDeg(e.roll)}}pointToNorth(){this.m_startAzimuth=Math.PI+s.MapViewUtils.extractSphericalCoordinatesFromLocation(this.mapView,this.camera,this.mapView.target).azimuth,this.m_startAzimuth=Math.atan2(Math.sin(this.m_startAzimuth),Math.cos(this.m_startAzimuth)),0!==this.m_startAzimuth&&(this.stopExistingAnimations(),this.m_resetNorthAnimationDuration=this.northResetAnimationDuration,this.m_currentAzimuth=this.m_startAzimuth,this.m_resetNorthStartTime=performance.now(),this.resetNorth())}zoomOnTargetPosition(e,t,i){s.MapViewUtils.zoomOnTargetPosition(this.mapView,e,t,i,this.m_maxTiltAngle)}setZoomLevel(e,t={x:0,y:0}){this.enabled&&this.zoomEnabled&&(this.dispatchEvent(u),this.m_startZoom=this.currentZoom,this.m_zoomDeltaRequested=e-this.zoomLevelTargeted,this.stopExistingAnimations(),this.m_zoomAnimationStartTime=performance.now(),this.m_zoomTargetNormalizedCoordinates.set(t.x,t.y),this.handleZoom(),this.dispatchEvent(d))}toggleTilt(){if(!this.enabled||!this.tiltEnabled)return;this.stopExistingAnimations(),this.m_startTilt=this.currentTilt;const e=this.m_startTilt<p;this.m_tiltRequested=e?this.tiltAngle:0,this.m_tiltState=e?l.Tilted:l.Down,this.m_tiltAnimationStartTime=performance.now(),this.tilt()}set cameraHeight(e){this.camera.position.setZ(e),this.camera.matrixWorldNeedsUpdate=!0}get cameraHeight(){return this.mapView.camera.position.z}set maxTiltAngle(e){this.m_maxTiltAngle=Math.max(0,Math.min(m,n.MathUtils.degToRad(e)))}get maxTiltAngle(){return n.MathUtils.radToDeg(this.m_maxTiltAngle)}get zoomLevelTargeted(){return void 0===this.m_targetedZoom?this.currentZoom:this.m_targetedZoom}get tiltState(){return void 0===this.m_tiltState&&(this.m_tiltState=this.currentTilt<p||this.m_tiltState===l.Down?l.Tilted:l.Down),this.m_tiltState}set currentZoom(e){this.m_currentZoom=e}get currentZoom(){return void 0!==this.m_currentZoom?this.m_currentZoom:this.mapView.zoomLevel}set currentTilt(e){this.m_currentTilt=e}get currentTilt(){return n.MathUtils.degToRad(this.mapView.tilt)}get targetedTilt(){return void 0===this.m_targetedTilt?void 0===this.m_currentTilt?this.currentTilt:this.m_currentTilt:this.m_targetedTilt}assignZoomAfterTouchZoomRender(){this.m_currentZoom=this.mapView.zoomLevel,this.m_targetedZoom=this.mapView.zoomLevel,this.mapView.removeEventListener(s.MapViewEventNames.AfterRender,this.assignZoomAfterTouchZoomRender)}stopExistingAnimations(){this.stopResetNorth(),this.stopZoom(),this.stopPan(),this.stopTilt()}resetNorth(){const e=(performance.now()-this.m_resetNorthStartTime)/1e3;this.inertiaEnabled&&(this.m_resetNorthIsAnimated||(this.m_resetNorthIsAnimated=!0,this.mapView.addEventListener(s.MapViewEventNames.AfterRender,this.resetNorth)),e>this.m_resetNorthAnimationDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.stopResetNorth()):this.m_needsRenderLastFrame=!0),this.m_lastAzimuth=this.m_currentAzimuth,this.m_currentAzimuth=this.inertiaEnabled?this.easeOutCubic(this.m_startAzimuth,0,Math.min(1,e/this.m_resetNorthAnimationDuration)):0;const t=this.m_currentAzimuth-this.m_lastAzimuth;s.MapViewUtils.orbitAroundScreenPoint(this.mapView,{deltaAzimuth:t,maxTiltAngle:this.m_maxTiltAngle}),this.updateMapView()}stopResetNorth(){this.mapView.removeEventListener(s.MapViewEventNames.AfterRender,this.resetNorth),this.m_resetNorthIsAnimated=!1}tilt(){void 0!==this.m_tiltRequested&&(this.m_targetedTilt=Math.max(Math.min(this.m_tiltRequested,this.maxTiltAngle),0),this.m_tiltRequested=void 0);let e=!1;if(this.inertiaEnabled){this.m_tiltIsAnimated||(this.m_tiltIsAnimated=!0,this.mapView.addEventListener(s.MapViewEventNames.AfterRender,this.tilt));const t=performance.now();this.m_tiltAnimationTime=(t-this.m_tiltAnimationStartTime)/1e3,this.m_tiltAnimationTime>=this.tiltToggleDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.m_tiltAnimationTime=this.tiltToggleDuration,e=!0):this.m_needsRenderLastFrame=!0}this.m_currentTilt=this.inertiaEnabled?this.easeOutCubic(this.m_startTilt,this.targetedTilt,Math.min(1,this.m_tiltAnimationTime/this.tiltToggleDuration)):this.targetedTilt;const t=this.currentTilt,i=this.m_currentTilt-t;s.MapViewUtils.orbitAroundScreenPoint(this.mapView,{deltaTilt:i,maxTiltAngle:this.m_maxTiltAngle}),this.updateMapView(),e&&this.stopTilt()}stopTilt(){this.mapView.removeEventListener(s.MapViewEventNames.AfterRender,this.tilt),this.m_tiltIsAnimated=!1,this.m_targetedTilt=this.m_currentTilt=void 0}easeOutCubic(e,t,i){return e+(t-e)*(1-Math.pow(1-i,3))}easeOutCirc(e,t,i){return e+(t-e)*Math.sqrt(1-Math.pow(i-1,2))}handleZoom(){let e=!1;if(0!==this.m_zoomDeltaRequested&&(this.m_targetedZoom=Math.max(Math.min(this.zoomLevelTargeted+this.m_zoomDeltaRequested,this.maxZoomLevel),this.minZoomLevel),this.m_zoomDeltaRequested=0),this.inertiaEnabled&&this.zoomInertiaDampingDuration>0){this.m_zoomIsAnimated||(this.m_zoomIsAnimated=!0,this.mapView.addEventListener(s.MapViewEventNames.AfterRender,this.handleZoom));const t=performance.now();this.m_zoomAnimationTime=(t-this.m_zoomAnimationStartTime)/1e3,this.m_zoomAnimationTime>this.zoomInertiaDampingDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.m_zoomAnimationTime=this.zoomInertiaDampingDuration,e=!0,this.stopZoom()):this.m_needsRenderLastFrame=!0}this.currentZoom=!this.inertiaEnabled||Math.abs(this.zoomLevelTargeted-this.m_startZoom)<p?this.zoomLevelTargeted:this.easeOutCirc(this.m_startZoom,this.zoomLevelTargeted,Math.min(1,this.m_zoomAnimationTime/this.zoomInertiaDampingDuration));const t=s.MapViewUtils.zoomOnTargetPosition(this.mapView,this.m_zoomTargetNormalizedCoordinates.x,this.m_zoomTargetNormalizedCoordinates.y,this.currentZoom,this.m_maxTiltAngle);!e&&t||(this.m_targetedZoom=void 0,this.m_currentZoom=void 0),this.updateMapView()}stopZoom(){this.mapView.removeEventListener(s.MapViewEventNames.AfterRender,this.handleZoom),this.m_zoomIsAnimated=!1}handlePan(){if(this.m_state===a.NONE&&0===this.m_lastAveragedPanDistanceOrAngle)return;this.inertiaEnabled&&!this.m_panIsAnimated&&(this.m_panIsAnimated=!0,this.mapView.addEventListener(s.MapViewEventNames.AfterRender,this.handlePan));const e=this.inertiaEnabled&&this.panInertiaDampingDuration>0&&this.m_state===a.NONE&&this.m_lastAveragedPanDistanceOrAngle>0;if(e){const e=performance.now();this.m_panAnimationTime=(e-this.m_panAnimationStartTime)/1e3,this.m_panAnimationTime>this.panInertiaDampingDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.m_panAnimationTime=this.panInertiaDampingDuration,this.mapView.removeEventListener(s.MapViewEventNames.AfterRender,this.handlePan),this.m_panIsAnimated=!1):this.m_needsRenderLastFrame=!0;const t=this.m_panAnimationTime/this.panInertiaDampingDuration;this.m_currentInertialPanningSpeed=this.easeOutCubic(this.m_lastAveragedPanDistanceOrAngle,0,Math.min(1,t)),0===this.m_currentInertialPanningSpeed&&(this.m_lastAveragedPanDistanceOrAngle=0),this.mapView.projection.type===r.ProjectionType.Planar?this.m_panDistanceFrameDelta.copy(this.m_lastPanVector).setLength(this.m_currentInertialPanningSpeed):this.mapView.projection.type===r.ProjectionType.Spherical&&this.m_rotateGlobeQuaternion.setFromAxisAngle(this.m_lastRotateGlobeAxis,this.m_currentInertialPanningSpeed).normalize()}else{let e=0;this.mapView.projection.type===r.ProjectionType.Planar?e=this.m_lastPanVector.copy(this.m_panDistanceFrameDelta).length():this.mapView.projection.type===r.ProjectionType.Spherical&&(e=this.m_lastRotateGlobeAngle,this.m_rotateGlobeQuaternion.setFromAxisAngle(this.m_lastRotateGlobeAxis,this.m_lastRotateGlobeAngle),this.m_rotateGlobeQuaternion.normalize()),this.m_currentPanDistanceOrAngleIndex=(this.m_currentPanDistanceOrAngleIndex+1)%5,this.m_recentPanDistancesOrAngles[this.m_currentPanDistanceOrAngleIndex]=e,this.m_lastAveragedPanDistanceOrAngle=this.m_recentPanDistancesOrAngles.reduce(((e,t)=>e+t))/5}this.mapView.projection.type===r.ProjectionType.Planar?s.MapViewUtils.panCameraAboveFlatMap(this.mapView,this.m_panDistanceFrameDelta.x,this.m_panDistanceFrameDelta.y):this.mapView.projection.type===r.ProjectionType.Spherical&&s.MapViewUtils.panCameraAroundGlobe(this.mapView,this.m_lastRotateGlobeFromVector,this.m_tmpVector3.copy(this.m_lastRotateGlobeFromVector).applyQuaternion(this.m_rotateGlobeQuaternion)),e||(this.m_panDistanceFrameDelta.set(0,0,0),this.m_lastRotateGlobeAngle=0),this.updateMapView()}stopPan(){this.m_panDistanceFrameDelta.set(0,0,0),this.m_lastAveragedPanDistanceOrAngle=0}bindInputEvents(e){const t=this.contextMenu.bind(this),i=this.mouseDown.bind(this),n=this.mouseWheel.bind(this),r=this.touchStart.bind(this),s=this.touchEnd.bind(this),o=this.touchMove.bind(this),a=this.mouseDoubleClick.bind(this);e.addEventListener("dblclick",a,!1),e.addEventListener("contextmenu",t,!1),e.addEventListener("mousedown",i,!1),e.addEventListener("wheel",n,!1),e.addEventListener("touchstart",r,!1),e.addEventListener("touchend",s,!1),e.addEventListener("touchmove",o,!1),this.dispose=()=>{e.removeEventListener("dblclick",a,!1),e.removeEventListener("contextmenu",t,!1),e.removeEventListener("mousedown",i,!1),e.removeEventListener("wheel",n,!1),e.removeEventListener("touchstart",r,!1),e.removeEventListener("touchend",s,!1),e.removeEventListener("touchmove",o,!1)}}updateMapView(){this.dispatchEvent(h),this.mapView.update()}mouseDoubleClick(e){if(!this.enabled||!this.zoomEnabled)return;const t=this.getPointerPosition(e);this.zoomOnDoubleClickOrTap(t.x,t.y)}mouseDown(e){if(!1===this.enabled)return;if(e.shiftKey)return;if(e.stopPropagation(),this.m_state!==a.NONE)return;if(0===e.button&&!e.ctrlKey&&this.panEnabled)this.m_state=a.PAN;else if(1===e.button)this.m_state=a.ROTATE;else{if(2!==e.button&&!e.ctrlKey||!this.tiltEnabled)return;this.m_state=a.ORBIT}this.dispatchEvent(u);const t=this.getPointerPosition(e);if(this.m_lastMousePosition.copy(t),!0===e.altKey){const{width:e,height:i}=o.getWidthAndHeightFromCanvas(this.domElement);this.m_initialMousePosition.copy(o.calculateNormalizedDeviceCoordinates(t.x,t.y,e,i))}else s.CameraUtils.getPrincipalPoint(this.mapView.camera,this.m_initialMousePosition);const i=this.mouseMove.bind(this),n=this.mouseUp.bind(this);window.addEventListener("mousemove",i,!1),window.addEventListener("mouseup",n,!1),this.m_cleanupMouseEventListeners=()=>{window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",n)}}mouseMove(e){if(!1===this.enabled)return;const t=this.getPointerPosition(e);if(this.m_mouseDelta.set(t.x-this.m_lastMousePosition.x,t.y-this.m_lastMousePosition.y),this.m_state===a.PAN){const e=this.getWorldPositionWithElevation(this.m_lastMousePosition.x,this.m_lastMousePosition.y,t.x,t.y);if(void 0===e)return;const{fromWorld:i,toWorld:n}=e;this.panFromTo(i,n)}else this.m_state===a.ROTATE?(this.stopExistingAnimations(),s.MapViewUtils.rotate(this.mapView,-this.rotationMouseDeltaFactor*this.m_mouseDelta.x,this.rotationMouseDeltaFactor*this.m_mouseDelta.y,this.m_maxTiltAngle)):this.m_state===a.ORBIT&&(this.stopExistingAnimations(),s.MapViewUtils.orbitAroundScreenPoint(this.mapView,{center:this.m_tmpVector2.set(this.m_initialMousePosition.x,this.m_initialMousePosition.y),deltaAzimuth:this.orbitingMouseDeltaFactor*this.m_mouseDelta.x,deltaTilt:-this.orbitingMouseDeltaFactor*this.m_mouseDelta.y,maxTiltAngle:this.m_maxTiltAngle}));this.m_lastMousePosition.set(t.x,t.y),this.m_zoomAnimationStartTime=performance.now(),this.updateMapView(),e.preventDefault(),e.stopPropagation()}mouseUp(e){!1!==this.enabled&&(this.updateMapView(),e.preventDefault(),e.stopPropagation(),this.m_state=a.NONE,this.m_cleanupMouseEventListeners&&this.m_cleanupMouseEventListeners(),this.dispatchEvent(d))}mouseWheel(e){if(!this.enabled||!this.zoomEnabled)return;const{width:t,height:i}=o.getWidthAndHeightFromCanvas(this.domElement),n=o.calculateNormalizedDeviceCoordinates(e.offsetX,e.offsetY,t,i);this.setZoomLevel(this.mapView.zoomLevel-this.zoomLevelDeltaOnMouseWheel*Math.sign(e.deltaY),n),e.preventDefault(),e.stopPropagation()}updateCurrentRotation(){if(this.m_touchState.touches.length<2||0===this.m_touchState.touches[1].currentWorldPosition.length()||0===this.m_touchState.touches[0].currentWorldPosition.length())return;let e=0,t=0;this.mapView.projection.type===r.ProjectionType.Planar?(e=this.m_touchState.touches[1].currentWorldPosition.x-this.m_touchState.touches[0].currentWorldPosition.x,t=this.m_touchState.touches[1].currentWorldPosition.y-this.m_touchState.touches[0].currentWorldPosition.y):this.mapView.projection.type===r.ProjectionType.Spherical&&(e=this.m_touchState.touches[1].currentTouchPoint.x-this.m_touchState.touches[0].currentTouchPoint.x,t=this.m_touchState.touches[0].currentTouchPoint.y-this.m_touchState.touches[1].currentTouchPoint.y,this.m_touchState.initialRotation=this.m_touchState.currentRotation),this.m_touchState.currentRotation=Math.atan2(t,e)}calculatePinchDistanceInWorldSpace(){if(this.m_touchState.touches.length<2)return 0;const e=this.m_tmpVector3.subVectors(this.m_touchState.touches[0].initialWorldPosition,this.m_touchState.touches[1].initialWorldPosition).length();return this.m_tmpVector3.subVectors(this.m_touchState.touches[0].currentWorldPosition,this.m_touchState.touches[1].currentWorldPosition).length()-e}convertTouchPoint(e,t){const i=this.getPointerPosition(e);if(void 0!==t){const e=t.currentTouchPoint,r=this.getWorldPositionWithElevation(e.x,e.y,i.x,i.y),s=void 0===r?new n.Vector3:r.toWorld;return 0!==s.length()||3===this.m_touchState.touches.length&&this.tiltEnabled?(this.m_state!==a.TOUCH&&this.dispatchEvent(u),this.m_state=a.TOUCH,{currentTouchPoint:i,lastTouchPoint:i,currentWorldPosition:s,initialWorldPosition:s}):(this.setTouchState([]),this.m_state=a.NONE,void this.dispatchEvent(d))}{const{width:e,height:t}=o.getWidthAndHeightFromCanvas(this.domElement),r=o.calculateNormalizedDeviceCoordinates(i.x,i.y,e,t),l=s.MapViewUtils.rayCastWorldCoordinates(this.mapView,r.x,r.y),c=null===l?new n.Vector3:l;return 0!==c.length()||3===this.m_touchState.touches.length&&this.tiltEnabled?(this.m_state!==a.TOUCH&&this.dispatchEvent(u),this.m_state=a.TOUCH,{currentTouchPoint:i,lastTouchPoint:i,currentWorldPosition:c,initialWorldPosition:c}):(this.setTouchState([]),this.m_state=a.NONE,void this.dispatchEvent(d))}}setTouchState(e){this.m_touchState.touches=[];for(let t=0;t<e.length;++t){const i=this.convertTouchPoint(e[t]);void 0!==i&&this.m_touchState.touches.push(i)}0!==this.m_touchState.touches.length&&(this.updateCurrentRotation(),this.m_touchState.initialRotation=this.m_touchState.currentRotation)}updateTouches(e){const t=Math.min(e.length,this.m_touchState.touches.length);for(let i=0;i<t;++i){const t=this.m_touchState.touches[i],n=this.convertTouchPoint(e[i],t);void 0!==n&&void 0!==t&&(n.initialWorldPosition=t.initialWorldPosition,n.lastTouchPoint=t.currentTouchPoint,this.m_touchState.touches[i]=n)}}zoomOnDoubleClickOrTap(e,t){if(0===this.zoomLevelDeltaOnDoubleClick)return;const{width:i,height:n}=o.getWidthAndHeightFromCanvas(this.domElement),r=o.calculateNormalizedDeviceCoordinates(e,t,i,n);this.setZoomLevel(this.currentZoom+this.zoomLevelDeltaOnDoubleClick,r)}touchStart(e){!1!==this.enabled&&(this.m_tapStartTime=performance.now(),this.m_fingerMoved=!1,this.m_state=a.TOUCH,this.dispatchEvent(u),this.setTouchState(e.touches),this.updateTouches(e.touches),e.preventDefault(),e.stopPropagation())}touchMove(e){if(!1!==this.enabled){if(this.m_fingerMoved=!0,this.updateTouches(e.touches),this.panEnabled&&this.m_touchState.touches.length<=2&&void 0!==this.m_touchState.touches[0]&&this.panFromTo(this.m_touchState.touches[0].initialWorldPosition,this.m_touchState.touches[0].currentWorldPosition),2===this.m_touchState.touches.length){const e=this.m_touchState.touches,t=new n.Vector2;if(!0===this.zoomEnabled||!0===this.rotateEnabled){const{width:i,height:n}=o.getWidthAndHeightFromCanvas(this.domElement);e.forEach((e=>{const r=o.calculateNormalizedDeviceCoordinates(e.currentTouchPoint.x,e.currentTouchPoint.y,i,n);t.add(r)})),t.divideScalar(e.length)}if(this.zoomEnabled){const e=this.calculatePinchDistanceInWorldSpace();if(Math.abs(e)<p)return;const i=s.MapViewUtils.calculateZoomLevelFromDistance(this.mapView,this.mapView.targetDistance-e);s.MapViewUtils.zoomOnTargetPosition(this.mapView,t.x,t.y,i,this.m_maxTiltAngle)}if(this.rotateEnabled){this.updateCurrentRotation();const e=this.m_touchState.currentRotation-this.m_touchState.initialRotation;this.stopExistingAnimations(),s.MapViewUtils.orbitAroundScreenPoint(this.mapView,{center:this.m_tmpVector2.set(t.x,t.y),deltaAzimuth:e,maxTiltAngle:this.m_maxTiltAngle})}}if(3===this.m_touchState.touches.length&&this.tiltEnabled){const e=this.m_touchState.touches[0],t=this.m_tmpVector2.subVectors(e.currentTouchPoint,e.lastTouchPoint);this.stopExistingAnimations(),s.MapViewUtils.orbitAroundScreenPoint(this.mapView,{deltaAzimuth:this.orbitingTouchDeltaFactor*t.x,deltaTilt:-this.orbitingTouchDeltaFactor*t.y,maxTiltAngle:this.m_maxTiltAngle})}this.m_zoomAnimationStartTime=performance.now(),this.updateMapView(),e.preventDefault(),e.stopPropagation()}}touchEnd(e){!1!==this.enabled&&(this.m_state=a.NONE,this.handleDoubleTap(),this.setTouchState(e.touches),this.dispatchEvent(d),this.updateMapView(),e.preventDefault(),e.stopPropagation())}handleDoubleTap(){if(this.m_fingerMoved||!this.zoomEnabled)return;const e=performance.now();return e-this.m_tapStartTime>120?void 0:this.m_isDoubleTap?(e-this.m_lastSingleTapTime>1e3*this.doubleTapTime||this.zoomOnDoubleClickOrTap(this.m_touchState.touches[0].currentTouchPoint.x,this.m_touchState.touches[0].currentTouchPoint.y),void(this.m_isDoubleTap=!1)):(this.m_isDoubleTap=!0,void(this.m_lastSingleTapTime=e))}contextMenu(e){e.preventDefault()}getWorldPositionWithElevation(e,t,i,n){const{width:r,height:a}=o.getWidthAndHeightFromCanvas(this.domElement),l=o.calculateNormalizedDeviceCoordinates(e,t,r,a),c=o.calculateNormalizedDeviceCoordinates(i,n,r,a);let h,u,d;if(void 0!==this.mapView.elevationProvider&&(d=this.mapView.elevationProvider.rayCast(e,t)),void 0===d)u=s.MapViewUtils.rayCastWorldCoordinates(this.mapView,l.x,l.y),h=s.MapViewUtils.rayCastWorldCoordinates(this.mapView,c.x,c.y);else{u=d;const e=this.mapView.projection.unprojectAltitude(u);h=s.MapViewUtils.rayCastWorldCoordinates(this.mapView,c.x,c.y,e)}if(null!==u&&null!==h)return{fromWorld:u,toWorld:h}}panFromTo(e,t){this.stopExistingAnimations(),this.m_panAnimationStartTime=performance.now(),this.mapView.projection.type===r.ProjectionType.Planar?this.m_panDistanceFrameDelta.subVectors(e,t):this.mapView.projection.type===r.ProjectionType.Spherical&&(this.m_lastRotateGlobeFromVector.copy(e),this.m_lastRotateGlobeAxis.crossVectors(e,t).normalize(),this.m_lastRotateGlobeAngle=e.angleTo(t),isNaN(this.m_lastRotateGlobeAngle)&&(this.m_lastRotateGlobeAngle=0)),this.handlePan()}getPointerPosition(e){const t=o.getWidthAndHeightFromCanvas(this.domElement),i=this.domElement.getBoundingClientRect(),r=Math.round(i.width)/t.width,s=Math.round(i.height)/t.height;return new n.Vector2((e.clientX-Math.floor(i.left))*r,(e.clientY-Math.floor(i.top))*s)}}t.MapControls=f},5363:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapControlsUI=void 0;const n=i(2616),r=i(2344);t.MapControlsUI=class{constructor(e,t={}){this.controls=e,this.domElement=document.createElement("div"),this.m_buttonsElement=document.createElement("div"),this.m_zoomLevelElement=null,this.m_projectionSwitchElement=null,this.m_onMapViewRenderEvent=()=>{if(null===this.m_zoomLevelElement)return;const e=this.controls.zoomLevelTargeted.toFixed(1);"INPUT"===this.m_zoomLevelElement.tagName?this.m_zoomLevelElement.value=e:this.m_zoomLevelElement.innerHTML=e},this.m_onWindowClick=e=>{const t=this.m_zoomLevelElement;e&&e.target&&e.target.contains&&e.target!==t&&!e.target.contains(t)&&t.blur()};const i=document.createElement("span");i.className="harp-gl_v-align",this.domElement.appendChild(i),this.m_buttonsElement=document.createElement("div"),this.m_buttonsElement.className="harp-gl_v-aligned",this.domElement.appendChild(this.m_buttonsElement);const s=document.createElement("button");s.innerText="+",s.className="harp-gl_controls_button-top",s.classList.add("harp-gl_controls-button");const o=document.createElement("button");o.innerText="-",o.className="harp-gl_controls_button-bottom",o.classList.add("harp-gl_controls-button");const a=document.createElement("button");a.innerText="3D",a.id="harp-gl_controls_tilt-button-ui",a.title="Toggle tilt",a.classList.add("harp-gl_controls-button"),a.classList.add("harp-gl_controls_button-bottom");const l=document.createElement("button");l.id="harp-gl_controls-button_compass",l.title="Reset North",l.classList.add("harp-gl_controls-button"),l.classList.add("harp-gl_controls_button-top");const c=document.createElement("span");if(c.id="harp-gl_controls_compass",l.appendChild(c),"show"===t.zoomLevel)this.m_zoomLevelElement=document.createElement("div"),e.mapView.addEventListener(r.MapViewEventNames.Render,this.m_onMapViewRenderEvent);else if("input"===t.zoomLevel){const t=document.createElement("input");t.type="number",t.step="0.1",e.mapView.addEventListener(r.MapViewEventNames.Render,this.m_onMapViewRenderEvent);const i=i=>{e.setZoomLevel(parseFloat(t.value)),i.preventDefault()};t.addEventListener("blur",i),t.addEventListener("keypress",(e=>{"Enter"===e.key&&i(e)})),window.addEventListener("click",this.m_onWindowClick),this.m_zoomLevelElement=t}if(t.projectionSwitch){const e=document.createElement("button");e.id="harp-gl_controls_switch_projection",e.classList.add("harp-gl_controls-button");const t=()=>`Switch to ${this.controls.mapView.projection.type===n.ProjectionType.Spherical?"flat":"globe"} projection`;e.title=t();const i='\n    <svg style="margin-top:5px;" stroke-width="2" class="harp-gl_controls_switch_svg" width="50" height="50" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">\n        <ellipse ry="9.79855" rx="4.56139" id="svg_6" cy="11.99798" cx="11.99798" fill="none"/>\n        <line id="svg_8" y2="8.16866" x2="21.12086" y1="8.16866" x1="3.10044"/>\n        <line id="svg_9" y2="16.10887" x2="21.0645" y1="16.10887" x1="3.04409"/>\n        <ellipse id="svg_11" ry="9.79855" rx="9.82671" cy="11.94167" cx="12.02614" fill="none"/>\n    </svg>',r='\n    <svg style="margin-top:5px;" class="harp-gl_controls_switch_svg" width="25" height="25" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">\n        <rect id="svg_1" stroke-width="2" height="13.51524" width="18.35821" y="5.80349" x="3.21307" fill="none"/>\n        <path id="svg_14" d="m9.52018,7.71815l1.2357,-0.0032l-0.61945,1.18258l-0.61625,-1.17938z"/>\n        <path id="svg_15" d="m4.11409,7.32396l3.65718,-0.0032l0.28156,2.13991l-2.59042,1.57678l0.50682,1.80203l2.25254,0.8447l-0.90101,2.0836l0.28157,2.25254l-3.26619,-3.04093l0.67576,-2.02728l-0.61945,-1.97097l-1.01364,-3.15356l0.73528,-0.50362z"/>\n        <path id="svg_17" d="m13.23688,7.4929l2.02409,-0.0032l0.78839,1.29521l2.47779,-1.35152l2.75936,0.78839l0,1.57678l-0.73208,0.61945l-0.28157,1.97097c0,0 -0.67256,0.8479 -0.72888,0.90422c-0.05631,0.05631 0.28157,1.06996 0.33788,1.18258c0.05631,0.11263 -1.68941,-1.35152 -1.6926,-1.35472c-0.0032,-0.0032 -0.16574,1.29841 -0.16894,1.29521c-0.0032,-0.0032 -1.57358,-1.34832 -1.57678,-1.35152c-0.0032,-0.0032 -0.72888,0.67896 -0.73208,0.67576c-0.0032,-0.0032 -0.8415,-0.67256 -0.8447,-0.67576c-0.0032,-0.0032 0.73528,2.0868 0.79159,2.0868c0.05631,0 -0.50682,3.20987 -0.51002,3.20667c-0.0032,-0.0032 -1.2357,-0.16574 -1.34832,-0.16574c-0.11263,0 -0.95733,-1.52046 -0.90102,-1.57678c0.05631,-0.05631 0,-1.80203 -0.0032,-1.80523c-0.0032,-0.0032 -1.40464,-0.33468 -1.40784,-0.33788c-0.0032,-0.0032 -0.05311,-1.74252 -0.05631,-1.74572c-0.0032,-0.0032 1.18578,-0.8415 1.18258,-0.8447c-0.0032,-0.0032 1.69261,-0.16574 1.74892,-0.16574c0.05631,0 1.2389,-1.06996 1.2357,-1.07316c-0.0032,-0.0032 -1.91146,-0.10943 -1.91466,-0.11263c-0.0032,-0.0032 -1.96777,0.17214 -1.97097,0.16894c-0.0032,-0.0032 1.52366,-3.20667 1.52366,-3.20667z"/>\n    </svg>';e.innerHTML=this.controls.mapView.projection.type===n.ProjectionType.Spherical?r:i,e.addEventListener("click",(()=>{this.controls.mapView.projection=this.controls.mapView.projection.type===n.ProjectionType.Spherical?n.mercatorProjection:n.sphereProjection,e.title=t(),e.innerHTML=this.controls.mapView.projection.type===n.ProjectionType.Spherical?r:i})),this.m_projectionSwitchElement=e}return this.m_buttonsElement.appendChild(s),null!==this.m_zoomLevelElement&&this.m_buttonsElement.appendChild(this.m_zoomLevelElement),this.m_buttonsElement.appendChild(o),this.m_buttonsElement.appendChild(l),this.m_buttonsElement.appendChild(a),null!==this.m_projectionSwitchElement&&this.m_buttonsElement.appendChild(this.m_projectionSwitchElement),s.addEventListener("click",(t=>{const i=e.zoomLevelTargeted+e.zoomLevelDeltaOnControl;e.setZoomLevel(i)})),s.addEventListener("dblclick",(e=>{e.stopPropagation()})),o.addEventListener("click",(t=>{const i=e.zoomLevelTargeted-e.zoomLevelDeltaOnControl;e.setZoomLevel(i)})),o.addEventListener("dblclick",(e=>{e.stopPropagation()})),a.addEventListener("click",(t=>{e.toggleTilt()})),l.addEventListener("click",(t=>{e.pointToNorth()})),e.mapView.addEventListener(r.MapViewEventNames.AfterRender,(()=>{c.style.transform=`rotate(${e.mapView.heading}deg)`})),this.domElement.className="harp-gl_controls",null!==this.m_zoomLevelElement&&this.m_zoomLevelElement.classList.add("harp-gl_controls_zoom-level"),!0!==t.disableDefaultStyle&&(this.initStyle(),this.domElement.style.cssText="\n                position: absolute;\n                right: 5px;\n                top: 0;\n                height: 100%; /* Vertical alignment is done dynamically, in the rest of the CSS. */\n                pointer-events: none; /* Allows to click the map even though height is 100%. */\n            "),this}get projectionSwitchElement(){return this.m_projectionSwitchElement}dispose(){null!==this.m_zoomLevelElement&&"INPUT"===this.m_zoomLevelElement.tagName&&window.removeEventListener("click",this.m_onWindowClick),this.controls.mapView.removeEventListener(r.MapViewEventNames.Render,this.m_onMapViewRenderEvent),this.domElement.remove()}initStyle(){if(null!==document.getElementById("here-harp-controls.map-controls-ui-styles"))return;const e=document.createElement("style");e.id="here-harp-controls.map-controls-ui-styles",e.appendChild(document.createTextNode('\n        /* CSS trick to align another div dynamically. */\n        .harp-gl_v-align{\n            height: 100%;\n            display: inline-block;\n            vertical-align: middle;\n        }\n        /* The target element to align vertically with vertical-align. */\n        .harp-gl_v-aligned{\n            pointer-events: all;\n            vertical-align: middle;\n            display: inline-block;\n        }\n        .harp-gl_controls-button {\n            display: block;\n            background-color: #272d37;\n            width: 40px;\n            height: 40px;\n            font-size: 22px;\n            font-weight: bold;\n            outline: none;\n            margin:0;\n            border: none;\n            color: rgba(255, 255, 255, 0.8);\n            cursor: pointer;\n            border-radius: 4px;\n            box-shadow: 0px 0px 5px 0 hsl(220, 4%, 40%);\n            transition: all 0.1s;\n            padding: 0 0 1px 1px;\n            user-select: none;\n            position:relative;\n        }\n        #harp-gl_controls_tilt-button-ui {\n            font-size: 16px;\n        }\n        .harp-gl_controls-button:active {\n            background-color: #37afaa;\n            color: #eee;\n        }\n        .harp-gl_controls-button:focus {\n            outline:none;\n        }\n        .harp-gl_controls_button-top{\n            margin-bottom:0;\n            border-bottom-right-radius:0;\n            border-bottom-left-radius:0;\n        }\n        .harp-gl_controls_button-bottom{\n            margin-top:1px;\n            border-top-right-radius:0;\n            border-top-left-radius:0;\n        }\n        .harp-gl_controls_zoom-level {\n            display: block;\n            background-color: #fff;\n            width: 40px;\n            height: 20px;\n            font-size: 12px;\n            font-weight: bold;\n            outline: none;\n            border: none;\n            color: #555;\n            opacity: 0.87;\n            box-shadow: 0px 0px 4px #aaa;\n            padding: 2px 0 0;\n            text-align: center;\n            user-select: text;\n        }\n        input.harp-gl_controls_zoom-level::-webkit-outer-spin-button,\n        input.harp-gl_controls_zoom-level::-webkit-inner-spin-button {\n            /* display: none; <- Crashes Chrome on hover */\n            -webkit-appearance: none;\n            margin: 0; /* <-- Apparently some margin are still there even though it\'s hidden */\n        }\n        input.harp-gl_controls_zoom-level[type=number] {\n            -moz-appearance:textfield; /* Firefox */\n        }\n        #harp-gl_controls-button_compass{\n            overflow: hidden;\n            margin: 5px 0 0 0;\n        }\n        #harp-gl_controls_compass{\n            pointer-events:none;\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            margin:0\n        }\n        #harp-gl_controls_compass::after{\n            content: " ";\n            position:absolute;\n            left:50%;\n            margin-left:-3px;\n            top:50%;\n            margin-top: -18px;\n            border:solid 3px rgba(0,0,0,0);\n            border-bottom:solid 15px #a34f2e;\n        }\n        #harp-gl_controls_compass::before{\n            content: " ";\n            position:absolute;\n            left:50%;\n            margin-left:-3px;\n            top:50%;\n            margin-top:0px;\n            border:solid 3px rgba(0,0,0,0);\n            border-top:solid 15px #eee;\n        }\n        #harp-gl_controls_switch_projection{\n            margin-top:5px;\n        }\n        .harp-gl_controls_switch_svg{\n            width: 25px;\n            height: 25px;\n            stroke: #d4d5d7;\n            fill: #d4d5d7;\n        }\n    ')),document.head.appendChild(e)}}},1555:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWidthAndHeightFromCanvas=t.safeParseDecimalInt=t.azimuthAltitudeToDirection=t.calculateNormalizedDeviceCoordinates=void 0;const n=i(82);function r(e,t){if(null==e||""===e)return t;if(!e.match(s))return t;const i=Number.parseInt(e,10);return isNaN(i)?t:i}t.calculateNormalizedDeviceCoordinates=function(e,t,i,r){return new n.Vector2(e/i*2-1,-t/r*2+1)},t.azimuthAltitudeToDirection=function(e,t){const i=new n.Vector3,r=Math.cos(t);return i.setX(Math.sin(e)*r),i.setY(Math.cos(e)*r),i.setZ(Math.sin(t)),i},t.safeParseDecimalInt=r;const s=/^\d+$/;t.getWidthAndHeightFromCanvas=function(e){return{width:r(e.style.width,e.clientWidth),height:r(e.style.height,e.clientHeight)}}},2626:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(1153),t),r(i(5805),t),r(i(4773),t),r(i(2369),t),r(i(5199),t),r(i(1781),t)},8449:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(8635),t),r(i(1930),t),r(i(4069),t)},8635:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataProvider=void 0;const n=i(82);class r extends n.EventDispatcher{constructor(){super(...arguments),this.m_clients=new Set}register(e){return 0===this.m_clients.size&&(this.m_connectPromise=this.connect()),this.m_clients.add(e),this.m_connectPromise}unregister(e){this.m_clients.delete(e)&&0===this.m_clients.size&&this.dispose()}}t.DataProvider=r},1781:(e,t,i)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonTiler=void 0;const r=i(242),s=i(8152),o=null!==(n=r.default)&&void 0!==n?n:r,a=-(-2&-Math.ceil(204.8));t.GeoJsonTiler=class{constructor(){this.indexes=new Map}dispose(){}async connect(){return await Promise.resolve()}async registerIndex(e,t){if(!this.indexes.has(e))return await this.updateIndex(e,t)}async updateIndex(e,t){if(t instanceof URL){const e=await fetch(t.href);if(!e.ok)throw new Error(`GeoJsonTiler: Unable to fetch ${t.href}: ${e.statusText}`);t=await e.json()}const i=(0,s.isFeatureGeometry)(t)||"GeometryCollection"===t.type||"Feature"===t.type&&void 0===t.id||"FeatureCollection"===t.type&&t.features.length>0&&void 0===t.features[0].id,n=o(t,{maxZoom:20,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:a,lineMetrics:!1,promoteId:null,generateId:i,debug:0});n.geojson=t,this.indexes.set(e,n)}async getTile(e,t){const i=this.indexes.get(e);if(void 0===i)throw new Error("Tile not found");const n=i.getTile(t.level,t.column,t.row);return null!==n&&(n.layer=e),n||{}}}},1153:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThemedTileDecoder=void 0;const n=i(7769),r=i(4342).LoggerManager.instance.create("ThemedTileDecoder");t.ThemedTileDecoder=class{constructor(){this.m_storageLevelOffset=0}dispose(){}decodeTile(e,t,i){return void 0===this.m_styleSetEvaluator?(r.info("cannot decode tile, as there is not style available"),Promise.resolve(void 0)):this.decodeThemedTile(e,t,this.m_styleSetEvaluator,i)}getTileInfo(e,t,i){return Promise.resolve(void 0)}configure(e,t){void 0!==(null==e?void 0:e.styleSet)&&(this.m_styleSetEvaluator=new n.StyleSetEvaluator(e)),this.m_styleSetEvaluator&&this.m_styleSetEvaluator.setEnabledFeatures(null==e?void 0:e.enabledFeatures),void 0!==(null==e?void 0:e.languages)&&(this.languages=e.languages),void 0!==t&&void 0!==t.storageLevelOffset&&(this.m_storageLevelOffset=t.storageLevelOffset)}}},1930:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileDataSource=t.TileFactory=void 0;const n=i(2344),r=i(6586),s=i(1984),o=i(4342),a=i(4069);t.TileFactory=class{constructor(e){this.m_modelConstructor=e}create(e,t){const i=new this.m_modelConstructor(e,t);return i.tileLoader=new a.TileLoader(e,t,e.dataProvider(),e.decoder,e.mapView.taskQueue),i}};class l extends n.DataSource{constructor(e,t){var i,r;if(super(t),this.m_tileFactory=e,this.m_options=t,this.logger=o.LoggerManager.instance.create("TileDataSource"),this.m_isReady=!1,t.decoder)this.m_decoder=t.decoder;else{if(!t.concurrentDecoderServiceName)throw new Error(`TileDataSource[${this.name}]: unable to create, missing decoder or concurrentDecoderServiceName`);this.m_decoder=n.ConcurrentDecoderFacade.getTileDecoder(t.concurrentDecoderServiceName,t.concurrentDecoderScriptUrl,t.concurrentDecoderWorkerCount,t.workerConnectionTimeout)}this.useGeometryLoader=!0,this.cacheable=!0,this.m_unregisterClearTileCache=null===(r=(i=this.dataProvider()).onDidInvalidate)||void 0===r?void 0:r.call(i,(()=>this.mapView.markTilesDirty(this)))}dispose(){var e;null===(e=this.m_unregisterClearTileCache)||void 0===e||e.call(this),this.decoder.dispose(),this.dataProvider().unregister(this)}ready(){return this.m_isReady&&this.m_options.dataProvider.ready()}get decoder(){return this.m_decoder}async connect(){await Promise.all([this.m_options.dataProvider.register(this),this.m_decoder.connect()]),this.m_isReady=!0;let e={};void 0!==this.m_options.storageLevelOffset&&(e={storageLevelOffset:this.m_options.storageLevelOffset}),this.m_decoder.configure({languages:super.languages},e)}set languages(e){super.languages=e,this.m_decoder.configure({languages:e}),this.mapView.markTilesDirty(this)}get languages(){return super.languages}async setTheme(e,t){var i;e=await r.load(e,{baseUrl:t});const n=(0,s.getStyles)(e.styles).filter((e=>{var t;return!e.styleSet||(null===(t=this.styleSetNames)||void 0===t?void 0:t.includes(e.styleSet))}));n.length>0&&(this.m_decoder.configure({styleSet:n,definitions:e.definitions,features:e.features,priorities:e.priorities,labelPriorities:e.labelPriorities,enabledFeatures:this.enabledFeatures}),this.isDetached()||null===(i=this.mapView)||void 0===i||i.markTilesDirty(this))}get enabledFeatures(){return this.m_enabledFeatures}set enabledFeatures(e){this.m_enabledFeatures=e,this.m_decoder.configure({enabledFeatures:e}),this.isDetached()||this.mapView.markTilesDirty(this)}dataProvider(){return this.m_options.dataProvider}getTilingScheme(){return this.m_options.tilingScheme}getTile(e,t=!1){const i=this.m_tileFactory.create(this,e);return i.copyrightInfo=this.m_options.copyrightInfo,void 0!==this.m_options.copyrightProvider&&this.m_options.copyrightProvider.getCopyrights(i.geoBox,e.level).then((e=>{i.copyrightInfo=void 0===i.copyrightInfo?e:[...i.copyrightInfo,...e],this.requestUpdate()})),t||i.load(),i}getTileInfo(e){return new Promise(((t,i)=>{const r=new a.TileInfoLoader(this,e,this.m_options.dataProvider,this.decoder);r.loadAndDecode().then((e=>{e===n.TileLoaderState.Ready?t(r.tileInfo):i(new Error(`TileDataSource#getInfoTile wrong final state: ${e}`))}))}))}}t.TileDataSource=l},5805:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileDecoderService=void 0;const n=i(8152),r=i(2616),s=i(1984),o=i(4342),a=i(2369),l=o.LoggerManager.instance.create("TileDecoderService");class c extends a.WorkerService{static start(e,t){return new c(e,t)}constructor(e,t){super(e),this.serviceId=e,this.m_decoder=t,this.m_decoder.connect()}handleRequest(e){return n.WorkerDecoderProtocol.isDecodeTileRequest(e)?this.handleDecodeTileRequest(e):n.WorkerDecoderProtocol.isTileInfoRequest(e)?this.handleTileInfoRequest(e):super.handleRequest(e)}handleMessage(e){n.WorkerDecoderProtocol.isConfigurationMessage(e)?this.handleConfigurationMessage(e):l.error(`[${this.serviceId}]: invalid message ${e.type}`)}async handleDecodeTileRequest(e){const t=r.TileKey.fromMortonCode(e.tileKey),i=(0,n.getProjection)(e.projection),o=await this.m_decoder.decodeTile(e.data,t,i),a=[],l=e=>{void 0!==e&&e.buffer.byteLength>0&&!a.includes(e.buffer)&&a.push(e.buffer)};return null==o||o.geometries.forEach((e=>{var t,i,n;if(null===(t=e.vertexAttributes)||void 0===t||t.forEach((e=>l(e))),null===(i=e.interleavedVertexAttributes)||void 0===i||i.forEach((e=>l(e))),l(e.index),l(e.edgeIndex),Array.isArray(e.objInfos)&&1===e.objInfos.length&&"object"==typeof e.objInfos[0]&&(null===(n=e.objInfos[0])||void 0===n?void 0:n.hasOwnProperty("displacementMap"))){const t=e.objInfos[0];l(t.displacementMap)}Array.isArray(e.attachments)&&e.attachments.forEach((e=>{l(e.index),l(e.edgeIndex)}))})),null==o||o.techniques.forEach((e=>{(0,s.addBuffersToTransferList)(e,a)})),{response:o,transferList:a}}handleTileInfoRequest(e){const t=r.TileKey.fromMortonCode(e.tileKey),i=(0,n.getProjection)(e.projection);return this.m_decoder.getTileInfo(e.data,t,i).then((e=>({response:e,transferList:void 0!==e&&void 0!==e.transferList?e.transferList:[]})))}handleConfigurationMessage(e){this.m_decoder.configure(e,e.options)}}t.TileDecoderService=c},4069:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileInfoLoader=t.TileLoader=void 0;const n=i(8152),r=i(2344),s=i(1406),o=i(4342).LoggerManager.instance.create("TileLoader");class a extends r.BaseTileLoader{constructor(e,t,i,n,r){super(e,t),this.dataSource=e,this.tileKey=t,this.dataProvider=i,this.tileDecoder=n,this.m_taskQueue=r}get priority(){return this.m_priority}set priority(e){this.m_priority=e,this.requestController&&(this.requestController.priority=e)}loadImpl(e,t,i){this.m_taskQueue?this.m_taskQueue.add({execute:this.loadData.bind(this,e,t,i),group:r.TileTaskGroups.FETCH_AND_DECODE,getPriority:()=>{var e;return null!==(e=this.priority)&&void 0!==e?e:0},isExpired:()=>e.aborted,estimatedProcessTime:()=>1}):this.loadData(e,t,i)}cancelImpl(){this.requestController=void 0}startDecodeTile(e,t,i){const r=this.payload;void 0!==r?(this.state=s.TileLoaderState.Decoding,this.payload=void 0,0===r.byteLength||r.constructor===Object&&0===Object.keys(r).length?this.onDecoded({geometries:[],techniques:[]},t):(this.requestController=new n.RequestController(this.priority,this.loadAbortController),this.tileDecoder.decodeTile(r,this.tileKey,this.dataSource.projection,this.requestController).then((i=>{e.aborted||this.onDecoded(i,t)})).catch((e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&i(e)})))):o.error("TileLoader#startDecodeTile: Cannot decode without payload")}loadData(e,t,i){this.dataProvider.getTile(this.tileKey,e).then((n=>{if(e.aborted){const e=new Error("Aborted");throw e.name="AbortError",e}this.onLoaded(n,t,i,e)})).catch((e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&i(e)}))}onLoaded(e,t,i,n){this.state===s.TileLoaderState.Loading&&(this.state=s.TileLoaderState.Loaded,this.payload=e,this.startDecodeTile(n,t,i))}onDecoded(e,t){this.decodedTile=e,t(s.TileLoaderState.Ready)}}t.TileLoader=a,t.TileInfoLoader=class extends a{startDecodeTile(e,t,i){const r=this.payload;void 0!==r?(this.state=s.TileLoaderState.Decoding,this.requestController=new n.RequestController(this.priority),this.tileDecoder.getTileInfo(r,this.tileKey,this.dataSource.projection,this.requestController).then((i=>{e.aborted||(this.tileInfo=i,t(s.TileLoaderState.Ready))})).catch((e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&i(e)}))):o.error("TileInfoLoader#startDecodeTile: Cannot decode without payload")}}},4773:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilerService=void 0;const n=i(8152),r=i(2616),s=i(1781),o=i(2369);class a extends o.WorkerService{static start(e){return new a(e)}constructor(e){super(e),this.serviceId=e,this.tiler=new s.GeoJsonTiler}handleRequest(e){return n.WorkerTilerProtocol.isRegisterIndexRequest(e)?this.handleRegisterIndexRequest(e):n.WorkerTilerProtocol.isUpdateIndexRequest(e)?this.handleUpdateIndexRequest(e):n.WorkerTilerProtocol.isTileRequest(e)?this.handleTileRequest(e):super.handleRequest(e)}async handleTileRequest(e){const t=r.TileKey.fromMortonCode(e.tileKey);return{response:await this.tiler.getTile(e.index,t)||{}}}async handleRegisterIndexRequest(e){const t="string"==typeof e.input?new URL(e.input):e.input;return await this.tiler.registerIndex(e.id,t),{response:{}}}async handleUpdateIndexRequest(e){const t="string"==typeof e.input?new URL(e.input):e.input;return this.tiler.updateIndex(e.id,t),{response:{}}}}t.TilerService=a},2369:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerService=void 0;const n=i(8152),r=i(4342).LoggerManager.instance.create("WorkerService",{enabled:!0});t.WorkerService=class{constructor(e){this.serviceId=e,this.m_pendingRequests=new Map,this.onMessage=e=>{if("string"==typeof e.data.service&&e.data.service===this.serviceId)try{if(n.WorkerServiceProtocol.isRequestMessage(e.data)){const t=e.data,i={service:t.service,messageId:t.messageId,responseSent:!1};this.m_pendingRequests.set(t.messageId,i),this.tryHandleRequest(t.request).then((e=>{this.doSendResponse(i,{service:this.serviceId,type:n.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,response:e.response},e.transferList)})).catch((e=>{this.doSendResponse(i,{service:this.serviceId,type:n.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,errorMessage:e.toString(),errorStack:e.stack})}))}else this.tryHandleMessage(e.data)}catch(t){r.error(`[${this.serviceId}]: Unhandled exception when handling ${e.type}`)}},self.addEventListener("message",this.onMessage);const t={service:e,type:n.WorkerServiceProtocol.ServiceMessageName.Initialized};self.postMessage(t)}destroy(){this.cancelAllPendingRequests(),self.removeEventListener("message",this.onMessage)}handleMessage(e){r.error(`[${this.serviceId}]: Invalid message ${e.type}`)}handleRequest(e){throw new Error(`ServiceAdapter[${this.serviceId}]: Invalid request '${e.type}'`)}tryHandleMessage(e){try{this.handleMessage(e)}catch(t){r.error(`[${this.serviceId}]: Failed, handling message ${e.type}`)}}tryHandleRequest(e){try{return this.handleRequest(e)}catch(e){return r.error(`[${this.serviceId}]: Failure`,e),Promise.reject(e)}}doSendResponse(e,t,i){e.responseSent||(void 0!==i?self.postMessage(t,i):self.postMessage(t),e.responseSent=!0,this.m_pendingRequests.delete(e.messageId))}cancelAllPendingRequests(){this.m_pendingRequests.forEach((e=>{this.doSendResponse(e,{service:this.serviceId,type:n.WorkerServiceProtocol.ServiceMessageName.Response,messageId:e.messageId,errorMessage:"cancelled"})}))}}},5199:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerServiceManager=void 0;const n=i(8152),r=i(2369);class s extends r.WorkerService{static getInstance(){return void 0===this.m_service&&(this.m_service=new s(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID)),this.m_service}constructor(e=n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID){super(e),this.m_factories=new Map,this.m_services=new Map}register(e){this.m_factories.set(e.serviceType,e.factory)}handleRequest(e){if(e.type===n.WorkerServiceProtocol.Requests.CreateService){if(void 0!==this.m_services.get(e.targetServiceId))throw Error(`error - service with targetServiceId='${e.targetServiceId}' already running, ignoring CreateService request`);const t=this.m_factories.get(e.targetServiceType);if(void 0===t)throw Error(`unknown targetServiceType requested: '${e.targetServiceType}'`);const i=t(e.targetServiceId);this.m_services.set(e.targetServiceId,i)}if(e.type===n.WorkerServiceProtocol.Requests.DestroyService){const t=this.m_services.get(e.targetServiceId);if(void 0===t)throw Error(`unknown targetServiceId '${e.targetServiceId}'`);t.destroy(),this.m_services.delete(e.targetServiceId)}return Promise.resolve({response:{}})}}t.WorkerServiceManager=s},2344:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeLoader=void 0,r(i(2541),t),r(i(3509),t),r(i(7220),t),r(i(8907),t),r(i(4442),t),r(i(9978),t),r(i(207),t),r(i(5307),t),r(i(1818),t),r(i(7511),t),r(i(4549),t),r(i(8380),t),r(i(9348),t),r(i(5808),t),r(i(4757),t),r(i(4303),t),r(i(4055),t),r(i(1774),t),r(i(3103),t),r(i(5187),t),r(i(8427),t),r(i(2476),t),r(i(5071),t),r(i(2175),t),r(i(4988),t),r(i(1406),t),r(i(9237),t),r(i(5159),t),r(i(5482),t),r(i(3977),t),r(i(4247),t),r(i(3061),t),r(i(5146),t),r(i(8881),t),r(i(5738),t),r(i(8015),t),r(i(2967),t),r(i(304),t),r(i(3800),t),r(i(1797),t),t.ThemeLoader=i(6586),r(i(1447),t),r(i(5571),t),r(i(4269),t),r(i(541),t),r(i(5008),t),r(i(9931),t),r(i(3373),t),r(i(1973),t)},2541:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimatedExtrusionHandler=t.AnimatedExtrusionState=void 0;const n=i(8152),r=i(4250),s=i(1984),o=i(4342);var a;!function(e){e[e.None=0]="None",e[e.Started=1]="Started",e[e.Finished=2]="Finished"}(a=t.AnimatedExtrusionState||(t.AnimatedExtrusionState={})),t.AnimatedExtrusionHandler=class{constructor(e){this.m_mapView=e,this.enabled=!0,this.duration=750,this.m_minZoomLevel=1,this.m_forceEnabled=!1,this.m_dataSourceMap=new Map,this.m_state=a.None,this.m_startTime=-1}get forceEnabled(){return this.m_forceEnabled}set forceEnabled(e){this.m_forceEnabled=e,this.duration=750}get minZoomLevel(){return this.m_minZoomLevel}setAnimationProperties(e,t){if(!(0,s.isExtrudedPolygonTechnique)(e))return!1;if(e.hasOwnProperty("minZoomLevel")&&(this.m_minZoomLevel=e.minZoomLevel),this.forceEnabled)return this.enabled;void 0!==e.animateExtrusionDuration&&(this.duration=e.animateExtrusionDuration);const i=(0,n.getPropertyValue)(e.animateExtrusion,t);return null===i?this.enabled:"boolean"==typeof i?i:"number"==typeof i&&0!==i}update(e){const t=this.m_dataSourceMap.size>0&&e>=this.m_minZoomLevel;this.m_state===a.None&&t?this.m_state=a.Started:this.m_state===a.None||t||this.resetAnimation(!0),this.animateExtrusion()}add(e,t){e.addDisposeCallback(this.removeTile.bind(this));let i=!1;this.m_state!==a.None&&(i=this.skipAnimation(e),i?this.setTileExtrusionRatio(t,1):this.m_state===a.Finished&&this.resetAnimation(!1)),this.getOrCreateTileMap(e.dataSource).set(e.tileKey.mortonCode(),{materials:t,animated:i})}get isAnimating(){return this.m_state!==a.Finished&&this.m_state!==a.None}getTileMap(e,t=!1){return this.m_dataSourceMap.get(e)}getOrCreateTileMap(e){let t=this.m_dataSourceMap.get(e);return t||(t=new Map,this.m_dataSourceMap.set(e,t)),t}skipAnimation(e){return this.wasAnyAncestorAnimated(e)||this.wasAnyDescendantAnimated(e)}wasAnyAncestorAnimated(e){var t,i;const n=e.dataSource.getDataZoomLevel(this.m_minZoomLevel),r=Math.max(0,e.tileKey.level-n),s=Math.min(r,this.m_mapView.visibleTileSet.options.quadTreeSearchDistanceUp),o=this.getTileMap(e.dataSource);if(!o)return!1;let a=e.tileKey;for(let e=1;e<=s;++e)if(a=a.parent(),null!==(i=null===(t=o.get(a.mortonCode()))||void 0===t?void 0:t.animated)&&void 0!==i&&i)return!0;return!1}wasAnyDescendantAnimated(e){var t,i;const n=e.dataSource.maxDataLevel-e.tileKey.level,r=Math.min(n,this.m_mapView.visibleTileSet.options.quadTreeSearchDistanceDown),s=this.getTileMap(e.dataSource);if(!s)return!1;const o=e.dataSource.getTilingScheme();let a=[e.tileKey],l=[];for(let e=1;e<=r;++e){l.length=0;for(const e of a)for(const n of o.getSubTileKeys(e)){if(null!==(i=null===(t=s.get(n.mortonCode()))||void 0===t?void 0:t.animated)&&void 0!==i&&i)return!0;l.push(n)}[a,l]=[l,a]}return!1}removeTile(e){const t=this.getTileMap(e.dataSource);t&&(t.delete(e.tileKey.mortonCode()),0===t.size&&this.m_dataSourceMap.delete(e.dataSource))}animateExtrusion(){if(this.m_state!==a.Started)return;const e=Date.now();this.m_startTime<0&&(this.m_startTime=e);const t=this.duration,i=Math.min(e-this.m_startTime,t),n=o.MathUtils.easeInOutCubic(r.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN,r.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX,i/t);this.setExtrusionRatio(n),i>=t&&(this.m_state=a.Finished),this.m_mapView.update()}resetAnimation(e){this.m_state=a.None,this.m_startTime=-1,e&&this.m_dataSourceMap.forEach((e=>{e.forEach((e=>{e.animated=!1}))}))}setExtrusionRatio(e){this.m_dataSourceMap.forEach((t=>{t.forEach((t=>{t.animated||(this.setTileExtrusionRatio(t.materials,e),e>=1&&(t.animated=!0))}))}))}setTileExtrusionRatio(e,t){e.forEach((e=>{e.extrusionRatio=t}))}}},5863:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundDataSource=void 0;const n=i(2616),r=i(8023),s=i(4303),o=i(8024),a=i(1447);class l extends s.DataSource{constructor(e){super({name:l.NAME,dataSourceOrder:l.GROUND_RENDER_ORDER}),this.m_backgroundColor=l.DEFAULT_COLOR,this.cacheable=!0,this.addGroundPlane=!0,this.enablePicking=!1,this.m_tilingScheme=null!=e?e:l.DEFAULT_TILING_SCHEME}get backgroundColor(){return this.m_backgroundColor}updateStorageLevelOffset(){let e;this.mapView.dataSources.forEach((t=>{t!==this&&t.getTilingScheme()===this.m_tilingScheme&&(e=void 0===e?t.storageLevelOffset:Math.max(e,t.storageLevelOffset))})),void 0===e&&(e=0),e!==this.storageLevelOffset&&(this.storageLevelOffset=e,this.mapView.clearTileCache(this.name))}async setTheme(e){if(this.mapView.clearTileCache(this.name),void 0!==e.clearColor){const t=r.Expr.fromJSON(e.clearColor,e.definitions);this.m_backgroundColor=t.isDynamic()?t:t.evaluate(this.mapView.env,r.ExprScope.Value)}else this.m_backgroundColor=l.DEFAULT_COLOR}getTilingScheme(){return this.m_tilingScheme}getTile(e){const t=new a.Tile(this,e);return t.forceHasGeometry(!0),(0,o.addGroundPlane)(t,l.GROUND_RENDER_ORDER,this.m_backgroundColor),t}}t.BackgroundDataSource=l,l.NAME="background",l.DEFAULT_COLOR=16777215,l.GROUND_RENDER_ORDER=Number.MIN_SAFE_INTEGER,l.DEFAULT_TILING_SCHEME=n.webMercatorTilingScheme},3509:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseTileLoader=void 0;const n=i(4342),r=i(1406),s=n.LoggerManager.instance.create("BaseTileLoader");t.BaseTileLoader=class{constructor(e,t){this.dataSource=e,this.tileKey=t,this.state=r.TileLoaderState.Initialized,this.m_priority=0,this.loadAbortController=new AbortController}get priority(){return this.m_priority}set priority(e){this.m_priority=e}loadAndDecode(){switch(this.state){case r.TileLoaderState.Loading:case r.TileLoaderState.Loaded:case r.TileLoaderState.Decoding:return this.donePromise;case r.TileLoaderState.Ready:case r.TileLoaderState.Failed:case r.TileLoaderState.Initialized:case r.TileLoaderState.Canceled:return this.startLoading(),this.donePromise}}waitSettled(){return this.donePromise?this.donePromise:Promise.resolve(this.state)}cancel(){this.isFinished||(this.loadAbortController.abort(),this.loadAbortController=new AbortController,this.cancelImpl()),this.onDone(r.TileLoaderState.Canceled)}get isFinished(){return this.state===r.TileLoaderState.Ready||this.state===r.TileLoaderState.Canceled||this.state===r.TileLoaderState.Failed}cancelImpl(){}startLoading(){(0,n.assert)(this.state!==r.TileLoaderState.Loading),this.state=r.TileLoaderState.Loading,this.loadImpl(this.loadAbortController.signal,this.onDone.bind(this),this.onError.bind(this)),void 0===this.donePromise&&(this.donePromise=new Promise(((e,t)=>{this.resolveDonePromise=e,this.rejectedDonePromise=t})))}onDone(e){this.resolveDonePromise&&e===r.TileLoaderState.Ready?this.resolveDonePromise(e):this.rejectedDonePromise&&this.rejectedDonePromise(e),this.resolveDonePromise=void 0,this.rejectedDonePromise=void 0,this.donePromise=void 0,this.state=e}onError(e){if(this.state===r.TileLoaderState.Canceled)return;const t=this.dataSource;s.error(`[${t.name}]: failed to load tile ${this.tileKey.mortonCode()}`,e),this.error=e,this.onDone(r.TileLoaderState.Failed)}}},7220:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BoundsGenerator=void 0;const n=i(2616),r=i(6313),s=i(7284);t.BoundsGenerator=class{constructor(e){this.m_view=e,this.createViewBounds()}generate(){return this.m_view.projection!==this.m_viewBounds.projection&&this.createViewBounds(),this.m_viewBounds.generate()}createViewBounds(){this.m_viewBounds=this.m_view.projection.type===n.ProjectionType.Planar?new r.PlaneViewBounds(this.m_view.camera,this.m_view.projection,this.m_view):new s.SphereViewBounds(this.m_view.camera,this.m_view.projection)}}},8907:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraMovementDetector=void 0;const n=i(82),r=i(541);t.CameraMovementDetector=class{constructor(e,t,i){this.m_throttlingTimeout=e,this.m_movementStartedFunc=t,this.m_movementFinishedFunc=i,this.m_lastCameraPos=new n.Vector3,this.m_newCameraPos=new n.Vector3,this.m_throttlingTimerId=void 0,this.m_movementDetectorDeadline=0,this.onDeadlineTimer=()=>{this.m_throttlingTimerId=void 0;const e=performance.now();e>=this.m_movementDetectorDeadline?this.movementFinished():this.startMovementFinishedTimer(e)},void 0===this.m_throttlingTimeout&&(this.m_throttlingTimeout=300)}checkCameraMoved(e,t){const i=r.MapViewUtils.extractAttitude(e,e.camera),n=e.camera.getWorldPosition(this.m_newCameraPos);if(void 0===this.m_lastAttitude)return this.m_lastCameraPos.copy(n),this.m_lastAttitude=i,!1;const s=!this.m_lastCameraPos.equals(n)||i.yaw!==this.m_lastAttitude.yaw||i.pitch!==this.m_lastAttitude.pitch||i.roll!==this.m_lastAttitude.roll;return s&&(this.m_lastCameraPos.copy(n),this.m_lastAttitude=i),s!==this.m_cameraMovedLastFrame&&(s&&this.movementStarted(),this.m_cameraMovedLastFrame=s),s&&(this.m_movementDetectorDeadline=t+this.m_throttlingTimeout,this.startMovementFinishedTimer(t)),this.m_cameraMovedLastFrame}clear(e){const t=e.camera.getWorldPosition(this.m_newCameraPos);this.m_lastCameraPos.set(t.x,t.y,t.z);const i=r.MapViewUtils.extractAttitude(e,e.camera);this.m_lastAttitude=i}forceMoved(){this.m_lastCameraPos.set(Number.NaN,Number.NaN,Number.NaN)}get cameraIsMoving(){return void 0!==this.m_throttlingTimerId}dispose(){this.removeMovementFinishedTimer(),this.m_movementStartedFunc=void 0,this.m_movementFinishedFunc=void 0}get cameraMovedLastFrame(){return!0===this.m_cameraMovedLastFrame}movementStarted(){void 0!==this.m_movementStartedFunc&&this.m_movementStartedFunc()}movementFinished(){this.removeMovementFinishedTimer(),void 0!==this.m_movementFinishedFunc&&this.m_movementFinishedFunc()}startMovementFinishedTimer(e){if(void 0===this.m_throttlingTimerId){const t=Math.max(0,this.m_movementDetectorDeadline-e);this.m_throttlingTimerId=setTimeout(this.onDeadlineTimer,t)}}removeMovementFinishedTimer(){void 0!==this.m_throttlingTimerId&&(clearTimeout(this.m_throttlingTimerId),this.m_throttlingTimerId=void 0)}}},4442:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraUtils=void 0;const n=i(82),r=i(4342),s=i(3103);function o(e,t,i){return(0,r.assert)(e>0,"Focal length must be larger than 0"),Math.atan((1-t)*i*.5/e)}function a(e,t,i){return(0,r.assert)(e>0,"Focal length must be larger than 0"),0===t?2*Math.atan(.5*i/e):o(e,t,i)+o(e,-t,i)}function l(e){return e.userData.fovs}function c(e,t,i,r,l){const c=r*e.aspect;let u=a(i,t.x,c);if((u<s.MIN_FOV_RAD||u>s.MAX_FOV_RAD)&&(u=n.MathUtils.clamp(u,s.MIN_FOV_RAD,s.MAX_FOV_RAD),l=a(h(u,c,t.x),t.y,r)),e.fov=n.MathUtils.radToDeg(l),0===(d=t).x&&0===d.y)delete e.userData.fovs;else{const n=r*e.aspect;e.userData.fovs={top:o(i,t.y,r),right:o(i,t.x,n),horizontal:u}}var d;e.userData.focalLength=i}function h(e,t,i){const n=t/2;if(0===i)return n/Math.tan(e/2);const s=i**2;if(Math.abs(e-Math.PI/2)<1e-6)return n*Math.sqrt(1-s);const o=Math.tan(e),a=n*(1+Math.sign(o)*Math.sqrt(1+o**2*(1-s)))/o;return(0,r.assert)(a>=0,"Focal length must be larger than 0"),a}!function(e){function t(e){var t;return null===(t=e.userData)||void 0===t?void 0:t.focalLength}function i(e){return n.MathUtils.degToRad(e.fov)}function r(e,t,r){t=n.MathUtils.clamp(t,s.MIN_FOV_RAD,s.MAX_FOV_RAD);const a=o(e);return c(e,a,h(t,r,a.y),r,t),i(e)}function o(e,t=new n.Vector2){return t.x=-e.projectionMatrix.elements[8],t.y=-e.projectionMatrix.elements[9],t}function u(e){var t,i;return null!==(i=null===(t=l(e))||void 0===t?void 0:t.horizontal)&&void 0!==i?i:2*Math.atan(Math.tan(n.MathUtils.degToRad(e.fov)/2)*e.aspect)}function d(e){var t,i;return null!==(i=null===(t=l(e))||void 0===t?void 0:t.top)&&void 0!==i?i:n.MathUtils.degToRad(e.fov/2)}function m(e){var t,i;return null!==(i=null===(t=l(e))||void 0===t?void 0:t.right)&&void 0!==i?i:u(e)/2}e.getFocalLength=t,e.setFocalLength=function(e,i,n){const l=o(e),h=a(i,l.y,n);return h<s.MIN_FOV_RAD||h>s.MAX_FOV_RAD?r(e,h,n):c(e,l,i,n,h),t(e)},e.getVerticalFov=i,e.setVerticalFov=r,e.convertWorldToScreenSize=function(e,t,i){return e*i/t},e.convertScreenToWorldSize=function(e,t,i){return t*i/e},e.getPrincipalPoint=o,e.setPrincipalPoint=function(e,t){const i=e.aspect,r=.999999;e.setViewOffset(i,1,-n.MathUtils.clamp(t.x,-.999999,r)*i/2,1*n.MathUtils.clamp(t.y,-.999999,r)/2,i,1)},e.getHorizontalFov=u,e.getTopFov=d,e.getBottomFov=function(e){return n.MathUtils.degToRad(e.fov)-d(e)},e.getRightFov=m,e.getLeftFov=function(e){var t;return void 0!==(null===(t=l(e))||void 0===t?void 0:t.right)?u(e)-m(e):u(e)/2}}(t.CameraUtils||(t.CameraUtils={}))},9978:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDefaultClipPlanesEvaluator=t.TiltViewClipPlanesEvaluator=t.TopViewClipPlanesEvaluator=t.ElevationBasedClipPlanesEvaluator=void 0;const n=i(82),r=i(2616),s=i(4342),o=i(4442),a=i(541),l=1e-6;var c;!function(e){const t=[new n.Vector3,new n.Vector3],i=new n.Raycaster,s=new n.Sphere(new n.Vector3,r.EarthConstants.EQUATORIAL_RADIUS);function o(e,t){return e-t<l?0:Math.sqrt(e*e-t*t)}e.getFarDistanceFromElevatedHorizon=function(t,i,n,r){const s=o(i,n),a=o(r,n),l=Math.asin(n/i),c=Math.abs(l-e.getNormalToFwdAngle(t));return Math.cos(c)*(s+a)},e.getProjNearPlaneTanDistance=function(e,i,n){const r=e.getWorldDirection(t[0]),s=t[1].copy(r).multiplyScalar(-n).sub(e.position),o=s.dot(r);return o/s.length()>Math.cos(i)?o:void 0},e.getProjSphereIntersectionDistance=function(e,n,r){i.setFromCamera(n,e),s.radius=r;const o=i.ray.intersectSphere(s,t[0]);return null!==o?o.sub(e.position).dot(e.getWorldDirection(t[1])):void 0},e.getNormalToFwdAngle=function(e){const i=t[0].copy(e.position).negate().normalize().dot(e.getWorldDirection(t[1]));return Math.acos(n.MathUtils.clamp(i,-1,1))}}(c||(c={}));class h{constructor(e,t){(0,s.assert)(e>=t),this.m_minElevation=t,this.m_maxElevation=e}set maxElevation(e){this.m_maxElevation=e,this.m_minElevation=Math.min(e,this.m_minElevation)}get maxElevation(){return this.m_maxElevation}set minElevation(e){this.m_minElevation=e,this.m_maxElevation=Math.max(e,this.m_maxElevation)}get minElevation(){return this.m_minElevation}}t.ElevationBasedClipPlanesEvaluator=h;class u extends h{constructor(e=r.EarthConstants.MAX_BUILDING_HEIGHT,t=0,i=1,o=.05,a=6){super(e,t),this.nearMin=i,this.nearFarMarginRatio=o,this.farMaxRatio=a,this.m_tmpVectors=[new n.Vector3,new n.Vector3,new n.Vector3],this.m_tmpQuaternion=new n.Quaternion,(0,s.assert)(i>0),(0,s.assert)(o>=0),(0,s.assert)(a>1);const l=o*i;this.m_minimumViewRange={near:i,far:i+l,minimum:this.nearMin,maximum:Math.max(i*a,i+l)}}evaluateClipPlanes(e,t,i){(0,s.assert)(e instanceof n.PerspectiveCamera,"Unsupported camera type.");const o=e;return t.type===r.ProjectionType.Spherical?this.evaluateDistanceSphericalProj(o,t,i):t.type===r.ProjectionType.Planar?this.evaluateDistancePlanarProj(o,t,i):((0,s.assert)(!1,"Unsupported projection type"),Object.assign({},this.minimumViewRange))}get minimumViewRange(){return this.m_minimumViewRange}evaluateDistancePlanarProj(e,t,i){(0,s.assert)(t.type!==r.ProjectionType.Spherical);let n=this.nearMin,o=this.nearMin*this.farMaxRatio;const a=t.groundDistance(e.position),l=a*this.farMaxRatio;n=a-this.maxElevation,o=a-this.minElevation,n=Math.max(n,this.nearMin),o=Math.min(o,l);const c=this.nearFarMarginRatio*(n+o)/2;return n=Math.max(n-c/2,this.nearMin),o=Math.max(o+c/2,n+c),{near:n,far:o,minimum:this.nearMin,maximum:Math.max(l,o)}}evaluateDistanceSphericalProj(e,t,i){(0,s.assert)(t.type===r.ProjectionType.Spherical);const o=t.groundDistance(e.position);let h=o-this.maxElevation;const u=r.EarthConstants.EQUATORIAL_RADIUS,d=Math.max(l,e.position.length()),m=Math.asin(u/d);let p=n.MathUtils.degToRad(e.fov/2);e.aspect>1&&(p=a.MapViewUtils.calculateHorizontalFovByVerticalFov(2*p,e.aspect));const f=u+this.maxElevation,g=c.getFarDistanceFromElevatedHorizon(e,d,u,f);let v=p>m?g:this.getFovBasedFarPlane(e,d,u,2*p,t);const y=o-this.minElevation,_=o*this.farMaxRatio;h=Math.max(h,this.nearMin),v=Math.max(v,y);const x=this.nearFarMarginRatio*(h+v)/2;return h=Math.max(h-x/2,this.nearMin),v=Math.max(v+x/2,h+x),{near:h,far:v,minimum:this.nearMin,maximum:_}}getFovBasedFarPlane(e,t,i,n,r){const o=e.position;e.matrixWorld.extractBasis(this.m_tmpVectors[0],this.m_tmpVectors[1],this.m_tmpVectors[2]),this.m_tmpQuaternion.setFromAxisAngle(this.m_tmpVectors[0],n/2);const a=this.m_tmpVectors[2],l=this.m_tmpVectors[1].copy(a).applyQuaternion(this.m_tmpQuaternion),c=o.dot(l);if(c<0)return r.groundDistance(e.position)*this.farMaxRatio;const h=o.dot(o)-c*c,u=i*i;return(0,s.assert)(h<=u,"Please use this evaluator only for top view camera poses."),c-Math.sqrt(u-h)}}t.TopViewClipPlanesEvaluator=u;class d extends u{constructor(){super(...arguments),this.m_tmpV2=new n.Vector2}evaluateDistancePlanarProj(e,t,i){(0,s.assert)(t.type!==r.ProjectionType.Spherical);const c=Object.assign({},this.minimumViewRange),h=Math.PI/2-l,u=t.groundDistance(e.position),d=a.MapViewUtils.extractCameraTilt(e,t),m=o.CameraUtils.getTopFov(e),p=o.CameraUtils.getBottomFov(e),f=n.MathUtils.clamp(d+m,-h,h),g=n.MathUtils.clamp(d-p,-h,h),v=Math.max(0,(u-this.minElevation)/Math.cos(f)),y=Math.max(0,(u-this.maxElevation)/Math.cos(g));return c.near=y*Math.cos(p),c.far=v*Math.cos(m),this.applyViewRangeConstraints(c,e,t,i)}evaluateDistanceSphericalProj(e,t,i){(0,s.assert)(t.type===r.ProjectionType.Spherical);const n=Object.assign({},this.minimumViewRange);return n.near=this.computeNearDistSphericalProj(e,t),n.far=this.computeFarDistSphericalProj(e,t),this.applyViewRangeConstraints(n,e,t,i)}computeNearDistSphericalProj(e,t){(0,s.assert)(t.type===r.ProjectionType.Spherical);const i=t.groundDistance(e.position)-this.maxElevation;if(i<=0)return 0;const n=r.EarthConstants.EQUATORIAL_RADIUS+this.maxElevation,a=o.CameraUtils.getBottomFov(e),l=c.getProjNearPlaneTanDistance(e,a,n);if(void 0!==l)return l;o.CameraUtils.getPrincipalPoint(e,this.m_tmpV2);const h=this.m_tmpV2.y>0,u=c.getProjSphereIntersectionDistance(e,this.m_tmpV2.setComponent(1,-1),n),d=h?c.getProjSphereIntersectionDistance(e,this.m_tmpV2.setComponent(1,1),n):1/0,m=Math.min(null!=u?u:1/0,null!=d?d:1/0);return(0,s.assert)(m!==1/0,"No reference point for near distance found"),null!=m?m:i}computeFarDistSphericalProj(e,t){(0,s.assert)(t.type===r.ProjectionType.Spherical);const i=r.EarthConstants.EQUATORIAL_RADIUS,n=i+this.minElevation,a=i+this.maxElevation,l=e.position.length();o.CameraUtils.getPrincipalPoint(e,this.m_tmpV2);const h=this.m_tmpV2.x<=0?1:-1,u=this.m_tmpV2.y>0,d=c.getProjSphereIntersectionDistance(e,this.m_tmpV2.set(h,1),n),m=u?c.getProjSphereIntersectionDistance(e,this.m_tmpV2.set(h,-1),n):0,p=Math.max(null!=d?d:1/0,null!=m?m:1/0);return p!==1/0?p:c.getFarDistanceFromElevatedHorizon(e,l,i,a)}applyViewRangeConstraints(e,t,i,r){const{distance:s}=a.MapViewUtils.getTargetAndDistance(i,t,r),o=i.groundDistance(t.position)-this.minElevation,l=s*this.farMaxRatio;e.near=Math.max(e.near,this.nearMin),e.far=n.MathUtils.clamp(e.far,o,l);const c=this.nearFarMarginRatio*(e.near+e.far)/2;return e.near=Math.max(e.near-c/2,this.nearMin),e.far=Math.max(e.far+c/2,e.near+c),e.minimum=this.nearMin,e.maximum=l,e}}t.TiltViewClipPlanesEvaluator=d,t.createDefaultClipPlanesEvaluator=()=>new d},207:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorCache=void 0;const n=i(82);class r{constructor(){this.m_map=new Map}static get instance(){return this.m_instance}getColor(e){"number"==typeof e&&(e="#"+e.toString(16).padStart(6,"0"));let t=this.m_map.get(e);return void 0!==t||(t=new n.Color(e),this.m_map.set(e,t)),t}get size(){return this.m_map.size}clear(){this.m_map.clear()}}t.ColorCache=r,r.m_instance=new r},1818:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentDecoderFacade=void 0;const n=i(7685),r=i(9931);class s{static getTileDecoder(e,t,i,n){const s=this.getWorkerSet(t,i,n);return new r.WorkerBasedDecoder(s,e)}static getWorkerSet(e,t,i){void 0===e&&(e=this.defaultScriptUrl);let r=this.workerSets[e];if(void 0===r){const s=void 0!==i?1e3*i:void 0;r=new n.ConcurrentWorkerSet({scriptUrl:e,workerCount:null!=t?t:this.defaultWorkerCount,workerConnectionTimeout:s}),this.workerSets[e]=r}return r}static destroyWorkerSet(e){const t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])}static destroy(){Object.keys(this.workerSets).forEach((e=>{this.workerSets[e].destroy()})),this.workerSets={}}static destroyIfTerminated(){let e=!0;Object.keys(this.workerSets).forEach((t=>{this.workerSets[t].terminated||(e=!1)})),e&&s.destroy()}}t.ConcurrentDecoderFacade=s,s.defaultScriptUrl="./decoder.bundle.js",s.defaultWorkerCount=void 0,s.workerSets={}},7511:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentTilerFacade=void 0;const n=i(7685),r=i(3373);class s{static getTiler(e,t,i,n){const s=this.getWorkerSet(t,i,n);return new r.WorkerBasedTiler(s,e)}static getWorkerSet(e,t,i){void 0===e&&(e=this.defaultScriptUrl);let r=this.workerSets[e];if(void 0===r){const s=void 0!==i?1e3*i:void 0;r=new n.ConcurrentWorkerSet({scriptUrl:e,workerCount:null!=t?t:this.defaultWorkerCount,workerConnectionTimeout:s}),this.workerSets[e]=r}return r}static destroyWorkerSet(e){const t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])}static destroy(){Object.keys(this.workerSets).forEach((e=>{this.workerSets[e].destroy()})),this.workerSets={}}static destroyIfTerminated(){let e=!0;Object.keys(this.workerSets).forEach((t=>{this.workerSets[t].terminated||(e=!1)})),e&&s.destroy()}}t.ConcurrentTilerFacade=s,s.defaultScriptUrl="./decoder.bundle.js",s.defaultWorkerCount=1,s.workerSets={}},7685:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentWorkerSet=t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT=t.isLoggingMessage=void 0;const n=i(82),r=i(8152),s=i(4342),o=i(1973),a=s.LoggerManager.instance.create("ConcurrentWorkerSet");function l(e){return e&&"number"==typeof e.level&&e.type===s.WORKERCHANNEL_MSG_TYPE}t.isLoggingMessage=l,t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT=1e4,t.ConcurrentWorkerSet=class{constructor(e){this.m_options=e,this.m_workerChannelLogger=s.LoggerManager.instance.create("WorkerChannel"),this.m_eventListeners=new Map,this.m_workers=new Array,this.m_availableWorkers=new Array,this.m_workerPromises=new Array,this.m_readyPromises=new Map,this.m_requests=new Map,this.m_workerRequestQueue=[],this.m_nextMessageId=0,this.m_stopped=!0,this.m_referenceCount=0,this.onWorkerMessage=(e,t)=>{if(r.WorkerServiceProtocol.isResponseMessage(t.data)){const i=t.data;if(null===i.messageId)return void a.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: no messageId`);const n=this.m_requests.get(i.messageId);if(void 0===n)return void a.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: invalid messageId`);if(e>=0&&e<this.m_workers.length){const t=this.m_workers[e];this.m_availableWorkers.push(t),this.checkWorkerRequestQueue()}else a.error(`[${this.m_options.scriptUrl}]: onWorkerMessage: invalid workerId`);if(void 0!==i.errorMessage){const e=new Error(i.errorMessage);void 0!==i.errorStack&&(e.stack=i.errorStack),n.resolver(e)}else n.resolver(void 0,i.response)}else if(r.WorkerServiceProtocol.isInitializedMessage(t.data)){const e=this.getReadyPromise(t.data.service);++e.count===this.m_workerPromises.length&&e.resolve()}else if(l(t.data))switch(t.data.level){case s.LogLevel.Trace:this.m_workerChannelLogger.trace(...t.data.message);break;case s.LogLevel.Debug:this.m_workerChannelLogger.debug(...t.data.message);break;case s.LogLevel.Log:this.m_workerChannelLogger.log(...t.data.message);break;case s.LogLevel.Info:this.m_workerChannelLogger.info(...t.data.message);break;case s.LogLevel.Warn:this.m_workerChannelLogger.warn(...t.data.message);break;case s.LogLevel.Error:this.m_workerChannelLogger.error(...t.data.message)}else this.eventHandler(t)},this.start()}addReference(){this.m_referenceCount+=1,1===this.m_referenceCount&&this.m_stopped&&this.start()}removeReference(){this.m_referenceCount-=1,0===this.m_referenceCount&&this.destroy()}start(e){if(void 0!==e&&(this.m_options=e),!this.m_stopped)throw new Error("ConcurrentWorker set already started");this.m_workerCount=(0,s.getOptionValue)(this.m_options.workerCount,"undefined"!=typeof navigator&&void 0!==navigator.hardwareConcurrency?n.MathUtils.clamp(navigator.hardwareConcurrency-1,1,2):void 0,2);const i=(0,s.getOptionValue)(this.m_options.workerConnectionTimeout,t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT),r=this.m_workers,a=this.m_availableWorkers;for(let e=0;e<this.m_workerCount;++e){const t=o.WorkerLoader.startWorker(this.m_options.scriptUrl,i).then((t=>{const i=t=>{this.onWorkerMessage(e,t)};return t.addEventListener("message",i),r.push(t),a.push(t),{worker:t,listener:i}}));this.m_workerPromises.push(t)}this.m_stopped=!1}get workerCount(){return this.m_workerCount}async stop(){this.m_stopped=!0,await this.waitForAllResponses().then((()=>{this.terminateWorkers()}))}destroy(){this.m_stopped=!0,this.m_requests.forEach((e=>{e.resolver(new Error("worker destroyed"))})),this.m_requests.clear(),this.m_workerRequestQueue=[],this.terminateWorkers(),this.m_eventListeners.clear()}get terminated(){return 0===this.m_workers.length}async connect(e){return this.ensureStarted(),await Promise.all(this.m_workerPromises),await this.getReadyPromise(e).promise}addEventListener(e,t){this.m_eventListeners.set(e,t)}removeEventListener(e){this.m_eventListeners.delete(e)}invokeRequest(e,t,i,n){this.ensureStarted();const s=this.m_nextMessageId++;let o;const a=new Promise(((e,t)=>{o=(i,n)=>{this.m_requests.delete(s),void 0!==i?t(i):e(n)}}));this.m_requests.set(s,{promise:a,resolver:o});const l={service:e,type:r.WorkerServiceProtocol.ServiceMessageName.Request,messageId:s,request:t};return this.postRequestMessage(l,i,n),a}broadcastRequest(e,t,i){const n=[];for(const s of this.m_workers){const o=this.m_nextMessageId++;let a;const l=new Promise(((e,t)=>{a=(i,n)=>{this.m_requests.delete(o),void 0!==i?t(i):e(n)}}));n.push(l),this.m_requests.set(o,{promise:l,resolver:a});const c={service:e,type:r.WorkerServiceProtocol.ServiceMessageName.Request,messageId:o,request:t};void 0!==i?s.postMessage(c,i):s.postMessage(c)}return Promise.all(n)}broadcastMessage(e,t){this.ensureStarted(),void 0!==t?this.m_workers.forEach((i=>i.postMessage(e,t))):this.m_workers.forEach((t=>t.postMessage(e)))}get requestQueueSize(){return this.m_workerRequestQueue.length}get numWorkers(){return this.m_workers.length}get numIdleWorkers(){return this.m_availableWorkers.length}eventHandler(e){"string"==typeof e.data.type&&this.dispatchEvent(e.data.type,e)}postRequestMessage(e,t,i){if(this.ensureStarted(),0===this.m_workers.length)throw new Error("ConcurrentWorkerSet#postMessage: no workers started");if(void 0!==i&&i.signal.aborted){const t=this.m_requests.get(e.messageId);if(void 0===t)return void a.error(`[${this.m_options.scriptUrl}]: Bad RequestMessage: invalid messageId`);const i=new Error("Aborted");return i.name="AbortError",void t.resolver(i,void 0)}if(this.m_availableWorkers.length>0){const i=this.m_availableWorkers.pop();void 0!==t?i.postMessage(e,t):i.postMessage(e)}else void 0===i&&(i=new r.RequestController(0)),0===i.priority&&(i.priority=-this.m_nextMessageId),this.m_workerRequestQueue.unshift({message:e,buffers:t,requestController:i})}ensureStarted(){if(this.m_stopped)throw new Error("ConcurrentWorkerSet stopped")}async waitForAllResponses(){const e=new Array;this.m_requests.forEach((t=>{e.push(t.promise)})),await Promise.all(e)}dispatchEvent(e,t){const i=this.m_eventListeners.get(e);void 0!==i&&i(t)}terminateWorkers(){this.m_workerPromises.forEach((e=>{e.then((e=>{void 0!==e&&(e.worker.removeEventListener("message",e.listener),e.worker.terminate())}))})),this.m_workers=[],this.m_availableWorkers=[],this.m_workerPromises=[],this.m_readyPromises.clear()}getReadyPromise(e){const t=this.m_readyPromises.get(e);if(void 0!==t)return t;const i={count:0,promise:void 0,resolve:()=>{},reject:e=>{i.error=e},error:void 0};return i.promise=new Promise(((e,t)=>{const n=i;void 0!==n.error?t(n.error):n.count===this.m_workerPromises.length&&e(),n.resolve=e,n.reject=t})),this.m_readyPromises.set(e,i),i}checkWorkerRequestQueue(){if(0!==this.m_workerRequestQueue.length&&0!==this.m_availableWorkers.length)for(this.m_workerRequestQueue.sort(((e,t)=>e.requestController.priority-t.requestController.priority));this.m_availableWorkers.length>0&&this.m_workerRequestQueue.length>0;){const e=this.m_workerRequestQueue.pop();this.postRequestMessage(e.message,e.buffers,e.requestController)}}}},4303:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataSource=void 0;const n=i(82),r=i(8797),s=i(4342),o=s.LoggerManager.instance.create("DataSource");class a extends n.EventDispatcher{constructor(e={}){super(),this.UPDATE_EVENT={type:"update"},this.enabled=!0,this.cacheable=!1,this.useGeometryLoader=!1,this.addGroundPlane=!1,this.minDataLevel=1,this.maxDataLevel=20,this.minDisplayLevel=0,this.maxDisplayLevel=22,this.allowOverlappingTiles=!0,this.enablePicking=!0,this.dataSourceOrder=0,this.exprPool=new r.ExprPool,this.m_maxGeometryHeight=0,this.m_minGeometryHeight=0,this.m_storageLevelOffset=0,this.m_featureStateMap=new Map;let{name:t}=e;const{styleSetNames:i,languages:n,minZoomLevel:s,maxZoomLevel:o,minDataLevel:l,maxDataLevel:c,minDisplayLevel:h,maxDisplayLevel:u,storageLevelOffset:d,allowOverlappingTiles:m,enablePicking:p,minGeometryHeight:f,maxGeometryHeight:g,dataSourceOrder:v}=e;void 0!==t&&0!==t.length||(t="anonymous-datasource#"+ ++a.uniqueNameCounter),this.name=t,this.styleSetNames=i,this.m_languages=n,void 0!==l&&(this.minDataLevel=l),void 0!==c&&(this.maxDataLevel=c),void 0!==s&&(this.minZoomLevel=s),void 0!==o&&(this.maxZoomLevel=o),void 0!==h&&(this.minDisplayLevel=h),void 0!==u&&(this.maxDisplayLevel=u),void 0!==d&&(this.m_storageLevelOffset=d),void 0!==m&&(this.allowOverlappingTiles=m),void 0!==p&&(this.enablePicking=p),void 0!==f&&(this.minGeometryHeight=f),void 0!==g&&(this.maxGeometryHeight=g),v&&(this.dataSourceOrder=v)}getFeatureState(e){return this.m_featureStateMap.get(e)}clearFeatureState(){this.m_featureStateMap.clear()}setFeatureState(e,t){this.m_featureStateMap.set(e,t)}removeFeatureState(e){this.m_featureStateMap.delete(e)}get styleSetNames(){return this.m_styleSetNames}set styleSetNames(e){l(e,this.m_styleSetNames)||(this.m_styleSetNames=e,this.clearCache(),this.requestUpdate())}dispose(){}clearCache(){}isFullyCovering(){return this.addGroundPlane}ready(){return!0}get mapView(){if(void 0===this.m_mapView)throw new Error("This DataSource "+this.name+" was not added to MapView");return this.m_mapView}get projection(){return this.mapView.projection}async connect(){}attach(e){this.m_mapView=e}detach(e){(0,s.assert)(this.m_mapView===e),this.m_mapView=void 0}isDetached(){return void 0===this.m_mapView}async setTheme(e){}set languages(e){this.m_languages=e}get languages(){return this.m_languages}setPoliticalView(e){}updateTile(e){}shouldPreloadTiles(){return!1}get minZoomLevel(){return o.warn("DataSource.minZoomLevel is deprecated. Use minDataLevel and maxDataLevel instead."),this.minDataLevel}set minZoomLevel(e){o.warn("DataSource.minZoomLevel is deprecated. Use minDataLevel and minDisplayLevel instead."),this.minDataLevel=e}get maxZoomLevel(){return o.warn("DataSource.maxZoomLevel is deprecated. Use maxDataLevel and maxDisplayLevel instead."),this.maxDataLevel}set maxZoomLevel(e){o.warn("DataSource.maxZoomLevel is deprecated. Use maxDataLevel and maxDisplayLevel instead."),this.maxDataLevel=e}get maxGeometryHeight(){return this.m_maxGeometryHeight}set maxGeometryHeight(e){this.m_maxGeometryHeight=e}get minGeometryHeight(){return this.m_minGeometryHeight}set minGeometryHeight(e){this.m_minGeometryHeight=e}get storageLevelOffset(){return this.m_storageLevelOffset}set storageLevelOffset(e){this.m_storageLevelOffset=e}setEnableElevationOverlay(e){}getDataZoomLevel(e){return n.MathUtils.clamp(e+this.m_storageLevelOffset,this.minDataLevel,this.maxDataLevel)}isVisible(e){return e>=this.minDisplayLevel&&e<=this.maxDisplayLevel}canGetTile(e,t){return t.level<=e}shouldSubdivide(e,t){return t.level<=e}shouldRenderText(e,t){return!0}requestUpdate(){this.dispatchEvent(this.UPDATE_EVENT)}}t.DataSource=a,a.uniqueNameCounter=0;const l=(e,t)=>{let i=e===t;if(!i&&e&&t){let n=e.length;if(t.length===n)for(i=!0;i&&n--;)i=t.includes(e[n])}return i}},507:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debugContext=t.DebugContext=void 0;const n=i(82),r="undefined"==typeof window;class s extends n.EventDispatcher{constructor(e){super(),this.value=e}set(e,t){this.value=e,this.dispatchEvent({type:s.SET_EVENT_TYPE,name:t,value:e})}}s.SET_EVENT_TYPE="set";class o{constructor(){this.m_optionsMap=new Map,!r&&"undefined"!=typeof window&&window&&(window.__debugContext=this)}setValue(e,t){let i=this.m_optionsMap.get(e);i?i.set(t,e):(i=new s(t),this.m_optionsMap.set(e,i))}getValue(e){const t=this.m_optionsMap.get(e);return t?t.value:void 0}hasOption(e){return void 0!==this.m_optionsMap.get(e)}addEventListener(e,t){const i=this.m_optionsMap.get(e);if(!i)throw Error("Unknown option: "+e);i.addEventListener(s.SET_EVENT_TYPE,t)}hasEventListener(e,t){const i=this.m_optionsMap.get(e);if(i)return i.hasEventListener(s.SET_EVENT_TYPE,t);throw Error("Unknown option: "+e)}removeEventListener(e,t){const i=this.m_optionsMap.get(e);if(!i)throw Error("Unknown option: "+e);i.removeEventListener(s.SET_EVENT_TYPE,t)}get options(){return this.m_optionsMap}clear(){this.m_optionsMap.forEach((e=>{e.set(void 0,"")}))}}t.DebugContext=o,t.debugContext=new o},8427:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateColorProperty=t.applySecondaryColorToMaterial=t.evaluateBaseColorProperty=t.buildMetricValueEvaluator=t.buildObject=t.usesObject3D=t.getBufferAttribute=t.createMaterial=void 0;const n=i(82),r=i(8152),s=i(5535),o=i(4250),a=i(5562),l=i(1984),c=i(1667),h=i(8023),u=i(6331),d=i(4342),m=i(946),p=i(8673),f=i(7063),g=i(176),v=i(3977),y=i(5146),_=d.LoggerManager.instance.create("DecodedTileHelpers");function x(e,t,i){return e[i]=t,e.needsUpdate=!0,t}const w=new n.Texture;function b(e,t,i,n,r){return new Promise(((s,o)=>{const a=(0,f.loadTexture)(t,r.textureCache,n,r.renderer,s,o);a&&x(e,a,i)}))}const T=new n.Vector2;function M(e,t){return null==e?e:("string"==typeof e&&(e.endsWith("px")?(t="Pixel",e=Number.parseFloat(e)):e.endsWith("m")&&(e=Number.parseFloat(e))),"Pixel"===t?t=>{var i;return(null!==(i=t.env.lookup("$pixelToMeters"))&&void 0!==i?i:1)*(0,r.getPropertyValue)(e,t.env)}:e)}function S(e,t){if(e=function(e,t){return void 0!==t&&h.Expr.isExpr(e)&&(e=(0,r.getPropertyValue)(e,t)),e}(e,t),null!=e){if("number"==typeof e)return e;if("string"==typeof e){const t=(0,u.parseStringEncodedColor)(e);if(void 0!==t)return t}_.error(`Unsupported color format: '${e}'`)}}t.createMaterial=function(e,t,i){var c;const u=function(e,t){if(void 0!==e.name)switch(e.name){case"extruded-line":if(!(0,l.isExtrudedLineTechnique)(e))throw new Error("Invalid extruded-line technique");return"standard"===e.shading?o.MapMeshStandardMaterial:o.MapMeshBasicMaterial;case"standard":case"terrain":return o.MapMeshStandardMaterial;case"extruded-polygon":return o.MapMeshPhongMaterial;case"dashed-line":case"solid-line":return o.SolidLineMaterial;case"fill":return t?o.MapMeshStandardMaterial:o.MapMeshBasicMaterial;case"squares":return n.PointsMaterial;case"circles":return o.CirclePointsMaterial;case"line":case"segments":return n.LineBasicMaterial;case"raster":case"text":case"labeled-icon":case"line-marker":case"label-rejection-line":return}}(e,!0===(null==i?void 0:i.shadowsEnabled)),m={};if(void 0===u)return;u.prototype instanceof o.RawShaderMaterial&&(m.rendererCapabilities=t.renderer.capabilities,u!==o.HighPrecisionLineMaterial&&(m.fog=null==i?void 0:i.fog)),!0===(null==i?void 0:i.shadowsEnabled)&&"fill"===e.name&&(m.removeDiffuseLight=!0);const p=new u(m);if(void 0!==e.id&&(p.name=e.id),(0,l.isExtrudedPolygonTechnique)(e)&&(p.flatShading=!0),(0,a.needsCanvasSize)(p)){const e=t.renderer.domElement;p.canvasSize=T.set(e.width,e.height),null===(c=t.addEventListener)||void 0===c||c.call(t,v.MapViewEventNames.Resize,(e=>{const i=t.renderer.domElement;p.canvasSize=T.set(i.width,i.height)}))}p.depthTest=(0,l.isExtrudedPolygonTechnique)(e)&&!1!==e.depthTest;const f=[];let y=!0;(0,l.supportsTextures)(e)&&l.TEXTURE_PROPERTY_KEYS.forEach((i=>{const n=function(e,t,i,n){let s=i[t];if(void 0===s)return Promise.reject(new Error(`textureProperty for texturePropertyName ${t} in technique ${i.name} is undefined`));if(h.Expr.isExpr(s)&&(s=(0,r.getPropertyValue)(s,n.env),!s))return Promise.resolve(x(e,w,t));if(!(0,l.isSolidLineTechnique)(i)){const r=i[t+"Properties"];return b(e,s,t,r,n)}return x(e,w,t),n.imageRepo.loadImage(s).then((i=>(null==i?void 0:i.imageItem.image)?b(e,null==i?void 0:i.imageItem.image,t,{minFilter:"linear",magFilter:"linear"},n):void 0))}(p,i,e,t).catch((e=>{y=!1}));f.push(n)}));const _=Promise.all(f).then((()=>Promise.resolve(y)));return g.MapMaterialAdapter.create(p,function(e){var t;const i=(0,s.getTechniqueAutomaticAttrs)(e);switch(e.name){case"dashed-line":case"solid-line":{const n=(0,d.pick)(e,i);return n.lineWidth=M(null!==(t=e.lineWidth)&&void 0!==t?t:0,e.metricUnit),n.dashSize=M(e.dashSize,e.metricUnit),n.gapSize=M(e.gapSize,e.metricUnit),n.offset=M(e.offset,e.metricUnit),n}case"fill":case"circles":case"squares":case"line":case"segments":return(0,d.pick)(e,i);case"standard":case"terrain":case"extruded-polygon":{const t=(0,d.pick)(e,i);return!0!==e.vertexColors&&(t.color=e.color),t}case"extruded-line":return(0,d.pick)(e,["color","wireframe","transparent","opacity","polygonOffset","polygonOffsetFactor","polygonOffsetUnits",...i]);case"raster":return(0,d.pick)(e,["brightness","gamma"]);default:return{}}}(e)),{material:p,texturesReady:_}},t.getBufferAttribute=function(e){switch(e.type){case"float":return new n.BufferAttribute(new Float32Array(e.buffer),e.itemCount);case"uint8":return new n.BufferAttribute(new Uint8Array(e.buffer),e.itemCount,e.normalized);case"uint16":return new n.BufferAttribute(new Uint16Array(e.buffer),e.itemCount,e.normalized);case"uint32":return new n.BufferAttribute(new Uint32Array(e.buffer),e.itemCount,e.normalized);case"int8":return new n.BufferAttribute(new Int8Array(e.buffer),e.itemCount,e.normalized);case"int16":return new n.BufferAttribute(new Int16Array(e.buffer),e.itemCount,e.normalized);case"int32":return new n.BufferAttribute(new Int32Array(e.buffer),e.itemCount,e.normalized);default:throw new Error(`unsupported buffer of type ${e.type}`)}},t.usesObject3D=function(e){const t=e.name;return void 0!==t&&"text"!==t&&"labeled-icon"!==t&&"line-marker"!==t&&"label-rejection-line"!==t},t.buildObject=function(e,t,i,r,s){switch((0,d.assert)(void 0!==e.name),e.name){case"extruded-line":case"standard":case"extruded-polygon":case"fill":return s?new m.DisplacedMesh(t,i,(()=>({min:r.elevationRange.minElevation,max:r.elevationRange.maxElevation}))):new n.Mesh(t,i);case"terrain":return new n.Mesh(t,i);case"dashed-line":case"solid-line":return s?new m.DisplacedMesh(t,i,(()=>({min:r.elevationRange.minElevation,max:r.elevationRange.maxElevation})),p.SolidLineMesh.raycast):new p.SolidLineMesh(t,i);case"circles":return new y.Circles(t,i);case"squares":return new y.Squares(t,i);case"line":case"segments":return new n.LineSegments(t,i)}return(0,d.assert)(!1,"Invalid technique"),new n.Object3D},t.buildMetricValueEvaluator=M,t.evaluateBaseColorProperty=function(e,t){const i=function(e){const t=function(e){var t;return null===(t=(0,s.getTechniqueDescriptor)(e))||void 0===t?void 0:t.attrTransparencyColor}(e);if(void 0!==t)return e[t]}(e);if(void 0!==i)return S(i,t)},t.applySecondaryColorToMaterial=function(e,t,i){let n=S(t,i);void 0!==n&&(c.ColorUtils.hasAlphaInHex(n)&&(_.warn("Used RGBA value for technique color without transparency support!"),n=c.ColorUtils.removeAlphaFromHex(n)),e.setHex(n))},t.evaluateColorProperty=S},2476:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setDepthPrePassStencil=t.createDepthPrePassMesh=t.isDepthPrePassMesh=t.createDepthPrePassMaterial=t.isRenderDepthPrePassEnabled=t.DEPTH_PRE_PASS_STENCIL_MASK=void 0;const n=i(82),r=i(4250),s=i(1667),o=i(8427);function a(e){e.depthWrite=!1,e.depthFunc=n.EqualDepth,e.colorWrite=!0,(0,r.enforceBlending)(e);const t=e.clone();return t.isDepthPrepassMaterial=!0,t.depthWrite=!0,t.depthTest=!0,t.depthFunc=n.LessDepth,t.colorWrite=!1,t.opacity=1,t.blending=n.NoBlending,t}t.DEPTH_PRE_PASS_STENCIL_MASK=1,t.isRenderDepthPrePassEnabled=function(e,t){if(!1===e.enableDepthPrePass)return!1;let i=void 0!==e.opacity&&e.opacity>0&&e.opacity<1;if(!i){const n=(0,o.evaluateBaseColorProperty)(e,t);if(void 0!==n){const e=s.ColorUtils.getAlphaFromHex(n);i=e>0&&e<1}}return i},t.createDepthPrePassMaterial=a,t.isDepthPrePassMesh=function(e){if(!0!==e.isMesh)return!1;const t=e;return t.material instanceof Array?t.material.every((e=>!0===e.isDepthPrepassMaterial)):!0===t.material.isDepthPrepassMaterial},t.createDepthPrePassMesh=function(e){const t=e.geometry;if(!(t instanceof n.BufferGeometry))throw new Error("#createDepthPassMesh only BufferGeometry is supported");const i=t.getAttribute("position");if(!i)throw new Error("#createDepthPassMesh position attribute not found");const r=new n.BufferGeometry;r.setAttribute("position",i);const s=t.getAttribute("uv");s&&r.setAttribute("uv",s);const o=t.getAttribute("normal");o&&r.setAttribute("normal",o);const l=t.getAttribute("extrusionAxis");l&&r.setAttribute("extrusionAxis",l),t.index&&r.setIndex(t.index);for(const e of t.groups){const{start:t,count:i,materialIndex:n}=e;r.addGroup(t,i,n)}const c=e.material instanceof Array?e.material.map(a):a(e.material),h=new n.Mesh(r,c);return h.renderOrder=e.renderOrder-1e-6,h},t.setDepthPrePassStencil=function(e,i){function r(e){const i=e;i.stencilWrite=!0,i.stencilFail=n.KeepStencilOp,i.stencilZFail=n.KeepStencilOp,i.stencilZPass=n.ReplaceStencilOp,i.stencilFunc=n.AlwaysStencilFunc,i.stencilRef=255,i.stencilFuncMask=t.DEPTH_PRE_PASS_STENCIL_MASK}function s(e){const i=e;i.stencilWrite=!0,i.stencilFail=n.KeepStencilOp,i.stencilZFail=n.KeepStencilOp,i.stencilZPass=n.ZeroStencilOp,i.stencilFunc=n.EqualStencilFunc,i.stencilRef=255,i.stencilFuncMask=t.DEPTH_PRE_PASS_STENCIL_MASK}e.material instanceof Array?e.material.map(r):r(e.material),i.material instanceof Array?i.material.map(s):s(i.material)}},5071:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2175:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4988:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.CalculationStatus=void 0,(i=t.CalculationStatus||(t.CalculationStatus={}))[i.PendingApproximate=0]="PendingApproximate",i[i.FinalPrecise=1]="FinalPrecise"},4055:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=void 0,t.EventDispatcher=class{constructor(){this.m_listeners=new Map}dispose(){this.removeAllEventListeners()}hasEventListener(e,t){const i=this.m_listeners.get(e);return void 0!==i&&(void 0===t||i.includes(t))}addEventListener(e,t){let i=this.m_listeners.get(e);void 0===i&&(i=[],this.m_listeners.set(e,i)),i.includes(t)||i.push(t)}removeEventListener(e,t){const i=this.m_listeners.get(e);if(void 0!==i)if(void 0===t)this.m_listeners.delete(e);else{const n=i.indexOf(t);-1!==n&&(i.splice(n,1),0===i.length&&this.m_listeners.delete(e))}}removeAllEventListeners(){const e=Array.from(this.m_listeners.keys());for(const t of e)this.removeEventListener(t)}get eventTypes(){return Array.from(this.m_listeners.keys())}listeners(e){return this.m_listeners.get(e)}dispatchEvent(e){const t=this.m_listeners.get(e.type);if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e)}}}},1774:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FixedClipPlanesEvaluator=void 0,t.FixedClipPlanesEvaluator=class{constructor(e=1,t=10){this.minNear=e,this.minFarOffset=t,this.minFar=e+t,this.m_nearPlane=e,this.m_farPlane=this.minFar}get nearPlane(){return this.m_nearPlane}set nearPlane(e){this.invalidatePlanes(e,this.m_farPlane)}get farPlane(){return this.m_farPlane}set farPlane(e){this.invalidatePlanes(this.m_nearPlane,e)}set minElevation(e){}get minElevation(){return 0}set maxElevation(e){}get maxElevation(){return 0}evaluateClipPlanes(e,t,i){return{near:this.m_nearPlane,far:this.m_farPlane,minimum:this.minNear,maximum:this.m_farPlane}}invalidatePlanes(e,t){const i=Math.max(this.minNear,e),n=Math.max(this.minFar,t,i+this.minFarOffset);this.m_nearPlane=i,this.m_farPlane=n}}},3103:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_FOV_RAD=t.MIN_FOV_RAD=t.MAX_FOV_DEG=t.MIN_FOV_DEG=t.DEFAULT_FOV_CALCULATION=void 0;const n=i(82);t.DEFAULT_FOV_CALCULATION={type:"dynamic",fov:40},t.MIN_FOV_DEG=0,t.MAX_FOV_DEG=180,t.MIN_FOV_RAD=n.MathUtils.degToRad(t.MIN_FOV_DEG),t.MAX_FOV_RAD=n.MathUtils.degToRad(t.MAX_FOV_DEG)},8502:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrustumIntersection=t.TileKeyEntry=void 0;const n=i(82),r=i(2616),s=i(4342),o=i(4988),a=i(9904),l=i(541),c=[new n.Vector3,new n.Vector3],h=new n.Vector4;class u{constructor(e,t,i=0,n,r=0){this.tileKey=e,this.area=t,this.offset=i,this.elevationRange=n,this.distance=r}}t.TileKeyEntry=u,t.FrustumIntersection=class{constructor(e,t,i,r,s,o=256){this.m_camera=e,this.mapView=t,this.m_extendedFrustumCulling=i,this.m_tileWrappingEnabled=r,this.m_enableMixedLod=s,this.m_tilePixelSize=o,this.m_frustum=new n.Frustum,this.m_viewProjectionMatrix=new n.Matrix4,this.m_rootTileKeys=[],this.m_tileKeyEntries=new Map,this.m_mapTileCuller=new a.MapTileCuller(e)}get camera(){return this.m_camera}get projection(){return this.mapView.projection}updateFrustum(e){this.m_viewProjectionMatrix.multiplyMatrices(void 0!==e?e:this.m_camera.projectionMatrix,this.m_camera.matrixWorldInverse),this.m_frustum.setFromProjectionMatrix(this.m_viewProjectionMatrix),this.m_extendedFrustumCulling&&this.m_mapTileCuller.setup(),this.computeRequiredInitialRootTileKeys(this.m_camera.position)}compute(e,t,i,o){this.m_tileKeyEntries.clear(),(0,s.assert)(0!==this.mapView.viewportHeight);const a=Math.pow(this.m_tilePixelSize/this.mapView.viewportHeight,2),l=void 0!==t&&t.getTilingScheme()===e,c=this.mapView.projection.type===r.ProjectionType.Spherical||l,h=new Set(i);let u=0,d=0;o.forEach((e=>{u=Math.min(u,e.minGeometryHeight),d=Math.max(d,e.maxGeometryHeight)}));const m={calculationFinal:!0,tileBounds:c?new r.OrientedBox3:new n.Box3};for(const e of h)this.m_tileKeyEntries.set(e,new Map);for(const i of this.m_rootTileKeys){const n=i.tileKey,s=i.offset,o=this.getTileKeyEntry(n,s,e,m,u,d,l?t:void 0);if(void 0!==o)for(const e of h)this.m_tileKeyEntries.get(e).set(r.TileKeyUtils.getKeyForTileKeyAndOffset(n,s),o)}const p=[...this.m_rootTileKeys.values()],f=this.mapView.projection===r.sphereProjection||this.mapView.tilt>0;for(;p.length>0;){const n=p.pop();if(void 0===n)break;const s=n.tileKey,c=n.offset;if(!o.some(((e,t)=>e.shouldSubdivide(i[t],s))))continue;if(this.m_enableMixedLod&&(f||n.tileKey.level<3)&&n.area<a)continue;const g=r.TileKeyUtils.getKeyForTileKeyAndOffset(s,c);for(const e of h)s.level>=e||this.m_tileKeyEntries.get(e).delete(g);for(const i of e.getSubTileKeys(s)){const n=this.getTileKeyEntry(i,c,e,m,u,d,l?t:void 0);if(void 0!==n){for(const e of h){if(n.tileKey.level>e)continue;const t=r.TileKeyUtils.getKeyForTileKeyAndOffset(i,c);this.m_tileKeyEntries.get(e).set(t,n)}p.push(n)}}}return{tileKeyEntries:this.m_tileKeyEntries,calculationFinal:m.calculationFinal}}getTileKeyEntry(e,t,i,n,r,s,a){var l,c;const h=function(e,t,i){const n=e.getGeoBox(t),r=360*i;return n.northEast.longitude+=r,n.southWest.longitude+=r,n}(i,e,t);if(void 0!==a){const t=a.getElevationRange(e);h.southWest.altitude=t.minElevation,h.northEast.altitude=t.maxElevation,n.calculationFinal=n.calculationFinal&&t.calculationStatus===o.CalculationStatus.FinalPrecise}h.southWest.altitude=(null!==(l=h.southWest.altitude)&&void 0!==l?l:0)+r,h.northEast.altitude=(null!==(c=h.northEast.altitude)&&void 0!==c?c:0)+s,this.mapView.projection.projectBox(h,n.tileBounds);const{area:d,distance:m}=this.computeTileAreaAndDistance(n.tileBounds);if(d>0)return new u(e,d,t,{minElevation:h.southWest.altitude,maxElevation:h.northEast.altitude},m)}computeTileAreaAndDistance(e){if(e instanceof n.Box3){if(this.m_extendedFrustumCulling&&!this.m_mapTileCuller.frustumIntersectsTileBox(e)||!this.m_frustum.intersectsBox(e))return{area:0,distance:1/0}}else if(!e.intersects(this.m_frustum))return{area:0,distance:1/0};const t=e.getCenter(c[0]),i=h.set(t.x,t.y,t.z,1).applyMatrix4(this.m_viewProjectionMatrix),r=.5*e.getSize(c[1]).length()/i.w;return{area:r*r,distance:i.z<=-i.w?-1:i.z>=i.w?1:i.z/i.w}}computeRequiredInitialRootTileKeys(e){this.m_rootTileKeys=[];const t=r.TileKey.fromRowColumnLevel(0,0,0);if(this.mapView.projection.type!==r.ProjectionType.Planar||!this.m_tileWrappingEnabled)return void this.m_rootTileKeys.push(new u(t,1/0,0));const i=this.mapView.projection.unprojectPoint(e),s=Math.round(i.longitude/360),o=this.m_camera,a=l.MapViewUtils.extractAttitude(this.mapView,o).pitch,c=o.aspect>1?o.aspect:1/o.aspect,h=n.MathUtils.degToRad(o.fov*c/2)+a,d=Math.tan(h)*o.position.z-Math.tan(a)*o.position.z,m=new n.Vector3(e.x-d,e.y,e.z),p=this.mapView.projection.unprojectPoint(m),f=n.MathUtils.clamp(Math.ceil(Math.abs((i.longitude-p.longitude)/360)*Math.SQRT2),0,7);for(let e=-f+s;e<=f+s;e++)this.m_rootTileKeys.push(new u(t,1/0,e))}}},1406:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.TileLoaderState=void 0,(i=t.TileLoaderState||(t.TileLoaderState={}))[i.Initialized=0]="Initialized",i[i.Loading=1]="Loading",i[i.Loaded=2]="Loaded",i[i.Decoding=3]="Decoding",i[i.Ready=4]="Ready",i[i.Canceled=5]="Canceled",i[i.Failed=6]="Failed"},5482:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapAnchors=void 0;const n=i(82),r=i(2616);t.MapAnchors=class{constructor(){this.m_anchors=[],this.m_priorities=[]}get children(){return this.m_anchors}add(e){this.m_anchors.push(e)}remove(e){const t=this.m_anchors.findIndex((t=>t===e));t>-1&&this.m_anchors.splice(t,1)}clear(){this.m_anchors.length=0}setPriorities(e){this.m_priorities=e}update(e,t,i,s){const o=new n.Vector3;this.m_anchors.forEach((n=>{var a;if(void 0!==n.styleSet){const e=null===(a=this.m_priorities)||void 0===a?void 0:a.findIndex((e=>e.group===n.styleSet&&e.category===n.category));void 0!==e&&-1!==e&&(n.renderOrder=10*(e+1))}const l=void 0!==n.geoPosition?n.geoPosition:n.anchor;void 0!==l&&((0,r.isVector3Like)(l)?o.set(l.x,l.y,l.z):(0,r.isGeoCoordinatesLike)(l)&&e.projectPoint(l,o),n.position.copy(o).sub(t)),!0===n.overlay?s.add(n):i.add(n)}))}}},176:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMaterialAdapter=void 0;const n=i(82),r=i(8152),s=i(4250),o=i(1984),a=i(1667),l=i(8023),c=i(7610),h=i(4342),u=i(8427),d=i(7063);function m(e){return"color"===e||"opacity"===e}class p{static create(e,t){const i=new p(e,t);return e.userData||(e.userData={}),e.userData.mapAdapter=i,i}static update(e,t){var i,n;const r=null===(i=e.userData)||void 0===i?void 0:i.mapAdapter;return null!==(n=null==r?void 0:r.update(t))&&void 0!==n&&n}constructor(e,t){this.m_material=e,this.m_styledProperties=t,this.m_currentPropertyValues={},this.m_lastUpdateFrameNumber=-1,this.m_dynamicProperties=[];let i=!1;for(const e in t){if(!t.hasOwnProperty(e))continue;const n=t[e];l.Expr.isExpr(n)||"function"==typeof n?this.m_dynamicProperties.push([e,n]):null!=n&&(this.m_currentPropertyValues[e]=n,m(e)?i=!0:this.setProperty(e,n))}i&&this.setBaseColorAndOpacity()}toJSON(){}update(e){if(this.m_lastUpdateFrameNumber===e.frameNumber)return!1;this.m_lastUpdateFrameNumber=e.frameNumber;const t=this.updateDynamicProperties(e),i=this.updateTextureMagFilter(e);return t||i}updateTextureMagFilter(e){let t=!1;if(this.m_material instanceof n.MeshBasicMaterial&&this.m_material.map){const i=e.env.lookup("$shouldAntialiasRasterTile")?n.LinearFilter:n.NearestFilter;this.m_material.map.magFilter!==i&&(this.m_material.map.magFilter=i,t=!0,this.m_material.map.needsUpdate=!0)}return t}updateDynamicProperties(e){let t=!1,i=!1;for(const[n,s]of this.m_dynamicProperties){const o=l.Expr.isExpr(s)?(0,r.getPropertyValue)(s,e.env):s(e);o!==this.m_currentPropertyValues[n]&&(this.m_currentPropertyValues[n]=o,m(n)?i=!0:this.setProperty(n,o,e.textureCache),t=!0)}return i&&this.setBaseColorAndOpacity(),t}setTextureProperty(e,t,i){const n=this.m_material;if(!n[e]||null===t)return;const r=n[e],s=(0,d.loadTexture)(t,i,void 0,void 0,(t=>{n[e]=t,r.dispose()}));s&&(s.wrapS=r.wrapS,s.wrapT=r.wrapT,s.magFilter=r.magFilter,s.minFilter=r.minFilter,s.flipY=r.flipY,s.repeat=r.repeat)}isColorProperty(e){const t=this.m_material[e];return t instanceof n.Color||t instanceof c.RGBA}setProperty(e,t,i){var n;this.isColorProperty(e)?this.setColorProperty(e,t):(n=e,o.TEXTURE_PROPERTY_KEYS.includes(n)?i&&this.setTextureProperty(e,t,i):this.m_material[e]=t)}setColorProperty(e,t){const i=this.m_material;(0,h.assert)(i[e]instanceof n.Color||i[e]instanceof c.RGBA);const r=(0,u.evaluateColorProperty)(t);if(void 0===r)return;const s=a.ColorUtils.getRgbaFromHex(r);return i[e]instanceof n.Color?i[e]=new n.Color(s.r,s.g,s.b):i[e]=s,s}setOpacity(e){var t;let i=null!==(t=this.m_currentPropertyValues.opacity)&&void 0!==t?t:1;i=n.MathUtils.clamp(i,0,1);const r=i*e.a,o=r>=1;this.m_material.color instanceof n.Color&&(i=r),this.m_material instanceof s.RawShaderMaterial?this.m_material.setOpacity(i):this.m_material.opacity=i,o?(0,s.disableBlending)(this.m_material):(0,s.enableBlending)(this.m_material)}setBaseColorAndOpacity(){var e;const t=null!==(e=this.m_currentPropertyValues.color)&&void 0!==e?e:16711680,i=this.setColorProperty("color",t);i&&this.setOpacity(i)}}t.MapMaterialAdapter=p},4572:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapObjectAdapter=void 0;const n=i(1984),r=i(176);class s{static get(e){var t;return(null===(t=e.userData)||void 0===t?void 0:t.mapAdapter)instanceof s?e.userData.mapAdapter:void 0}static install(e){return e.object.userData||(e.object.userData={}),e.object.userData.mapAdapter=e}static create(e,t){return s.install(new s(e,t))}static update(e,t){var i,n;return null!==(n=null===(i=s.get(e))||void 0===i?void 0:i.update(t))&&void 0!==n&&n}constructor(e,t){var i;this.m_lastUpdateFrameNumber=-1,this.m_notCompletlyTransparent=!0,this.object=e,this.technique=t.technique,this.dataSource=t.dataSource,this.m_pickability=null!==(i=t.pickability)&&void 0!==i?i:n.Pickability.onlyVisible,this.m_notCompletlyTransparent=this.getObjectMaterials().some((e=>e.opacity>0)),this.level=t.level}toJSON(){return{technique:this.technique}}update(e){return this.m_lastUpdateFrameNumber!==e.frameNumber&&(this.m_lastUpdateFrameNumber=e.frameNumber,this.updateMaterials(e))}isVisible(){return this.object.visible&&this.m_notCompletlyTransparent}isPickable(){return this.pickability===n.Pickability.onlyVisible&&this.isVisible()||this.m_pickability===n.Pickability.all}get pickability(){return this.m_pickability}updateMaterials(e){let t=!1;const i=this.getObjectMaterials();for(const n of i){const i=r.MapMaterialAdapter.update(n,e);t=t||i}return t&&(this.m_notCompletlyTransparent=i.some((e=>e.opacity>0))),t}getObjectMaterials(){const e=this.object;return Array.isArray(e.material)?e.material:void 0!==e.material?[e.material]:[]}}t.MapObjectAdapter=s},9904:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapTileCuller=void 0;const n=i(82);t.MapTileCuller=class{constructor(e){this.m_camera=e,this.m_globalFrustumMin=new n.Vector3,this.m_globalFrustumMax=new n.Vector3,this.m_frustumCorners=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3]}setup(){const e=this.getFrustumCorners(),t=this.m_camera.matrixWorld;this.m_globalFrustumMin.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.m_globalFrustumMax.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(const i of e)i.applyMatrix4(t),this.m_globalFrustumMin.x=Math.min(this.m_globalFrustumMin.x,i.x),this.m_globalFrustumMin.y=Math.min(this.m_globalFrustumMin.y,i.y),this.m_globalFrustumMin.z=Math.min(this.m_globalFrustumMin.z,i.z),this.m_globalFrustumMax.x=Math.max(this.m_globalFrustumMax.x,i.x),this.m_globalFrustumMax.y=Math.max(this.m_globalFrustumMax.y,i.y),this.m_globalFrustumMax.z=Math.max(this.m_globalFrustumMax.z,i.z)}frustumIntersectsTileBox(e){const t=this.m_globalFrustumMin,i=this.m_globalFrustumMax;return!(i.x<e.min.x||i.y<e.min.y||i.z<e.min.z||t.x>e.max.x||t.y>e.max.y||t.z>e.max.z)}getFrustumCorners(){const e=this.m_frustumCorners,t=this.m_camera.projectionMatrixInverse;let i=0;function n(n,r,s){e[i++].set(n,r,s).applyMatrix4(t)}return n(-1,-1,-1),n(1,-1,-1),n(-1,1,-1),n(1,1,-1),n(-1,-1,1),n(1,-1,1),n(-1,1,1),n(1,1,1),e}}},3977:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapView=t.MapViewPowerPreference=t.MapViewEventNames=t.TileTaskGroups=void 0;const n=i(82),r=i(2616),s=i(1984),o=i(4342),a=i(2541),l=i(5863),c=i(8907),h=i(4442),u=i(9978),d=i(5307),m=i(1818),p=i(7511),f=i(8380),g=i(4055),v=i(1350),y=i(3103),_=i(8502),x=i(9587),w=i(3801),b=i(304),T=i(8488),M=i(9297),S=i(5996),E=i(5482),A=i(3011),C=i(19),P=i(6272),L=i(8881),R=i(5187),D=i(8658),I=i(8015),O=i(9780),F=i(541),V=i(5008);var U,B;o.LoggerManager.instance.setLogLevelForAll(o.LogLevel.Error),(B=t.TileTaskGroups||(t.TileTaskGroups={})).FETCH_AND_DECODE="fetch",B.CREATE="create",function(e){e.Update="update",e.Resize="resize",e.Render="render",e.AfterRender="didrender",e.FirstFrame="first-render",e.FrameComplete="frame-complete",e.ThemeLoaded="theme-loaded",e.AnimationStarted="animation-started",e.AnimationFinished="animation-finished",e.MovementStarted="movement-started",e.MovementFinished="movement-finished",e.DataSourceConnect="datasource-connect",e.CopyrightChanged="copyright-changed",e.ContextLost="webglcontext-lost",e.ContextRestored="webglcontext-restored",e.CameraPositionChanged="camera-changed",e.Dispose="dispose"}(U=t.MapViewEventNames||(t.MapViewEventNames={}));const N=o.LoggerManager.instance.create("MapView"),k=4e6,z=["northpole","southpole"],G={vector2:[new n.Vector2],vector3:[new n.Vector3,new n.Vector3,new n.Vector3],rayCaster:new n.Raycaster,groundPlane:new n.Plane,groundSphere:new n.Sphere(void 0,r.EarthConstants.EQUATORIAL_RADIUS),matrix4:[new n.Matrix4,new n.Matrix4],transform:[{position:new n.Vector3,xAxis:new n.Vector3,yAxis:new n.Vector3,zAxis:new n.Vector3}],color:new n.Color};var j;!function(e){e.Default="default",e.LowPower="low-power",e.HighPerformance="high-performance"}(j=t.MapViewPowerPreference||(t.MapViewPowerPreference={}));const H={projection:r.mercatorProjection,addBackgroundDatasource:!0,maxVisibleDataSourceTiles:100,extendedFrustumCulling:!0,tileCacheSize:200,resourceComputationType:V.ResourceComputationType.EstimationInMb,quadTreeSearchDistanceUp:3,quadTreeSearchDistanceDown:2,pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1,target:new r.GeoCoordinates(25,0),zoomLevel:5,tilt:0,heading:0,theme:{},maxTilesPerFrame:0};class W extends g.EventDispatcher{constructor(e){var t,i;super(),this.UPDATE_EVENT={type:U.Update},this.RENDER_EVENT={type:U.Render},this.DID_RENDER_EVENT={type:U.AfterRender},this.FIRST_FRAME_EVENT={type:U.FirstFrame},this.FRAME_COMPLETE_EVENT={type:U.FrameComplete},this.THEME_LOADED_EVENT={type:U.ThemeLoaded},this.ANIMATION_STARTED_EVENT={type:U.AnimationStarted},this.ANIMATION_FINISHED_EVENT={type:U.AnimationFinished},this.MOVEMENT_STARTED_EVENT={type:U.MovementStarted},this.MOVEMENT_FINISHED_EVENT={type:U.MovementFinished},this.CONTEXT_LOST_EVENT={type:U.ContextLost},this.CONTEXT_RESTORED_EVENT={type:U.ContextRestored},this.COPYRIGHT_CHANGED_EVENT={type:U.CopyrightChanged},this.DISPOSE_EVENT={type:U.Dispose},this.m_renderLabels=!0,this.m_visibleTileSetLock=!1,this.m_tileWrappingEnabled=!0,this.m_zoomLevel=1,this.m_minZoomLevel=1,this.m_maxZoomLevel=20,this.m_minCameraHeight=20,this.m_rteCamera=new n.PerspectiveCamera,this.m_yaw=0,this.m_pitch=0,this.m_roll=0,this.m_targetDistance=0,this.m_targetGeoPos=r.GeoCoordinates.fromObject(H.target),this.m_targetWorldPos=new n.Vector3,this.m_viewRanges={near:.1,far:k,minimum:.1,maximum:k},this.m_scene=new n.Scene,this.m_overlayScene=new n.Scene,this.m_sceneRoot=new n.Object3D,this.m_overlaySceneRoot=new n.Object3D,this.m_mapAnchors=new E.MapAnchors,this.m_animationCount=0,this.m_drawing=!1,this.m_updatePending=!1,this.m_frameNumber=0,this.m_forceCameraAspect=void 0,this.m_taskSchedulerTimeout=void 0,this.m_tileDataSources=[],this.m_connectedDataSources=new Set,this.m_connectingDataSources=0,this.m_enablePolarDataSource=!0,this.m_raycaster=new n.Raycaster,this.m_plane=new n.Plane(new n.Vector3(0,0,1)),this.m_sphere=new n.Sphere(void 0,r.EarthConstants.EQUATORIAL_RADIUS),this.m_firstFrameRendered=!1,this.m_firstFrameComplete=!1,this.m_env=new s.MapEnv({}),this.m_imageRepo=new M.ImageRepo,this.m_textureCache=new S.TextureCache,this.m_lastTileIds="",this.m_copyrightInfo=[],this.m_disposed=!1,this.onWebGLContextLost=e=>{this.dispatchEvent(this.CONTEXT_LOST_EVENT),N.warn("WebGL context lost",e)},this.onWebGLContextRestored=e=>{this.dispatchEvent(this.CONTEXT_RESTORED_EVENT),void 0!==this.m_renderer&&(this.iconTextRenderer.restoreRenderers(this.m_renderer),this.update()),N.warn("WebGL context restored",e)},this.m_options=Object.assign({},e),this.m_uriResolver=this.m_options.uriResolver,void 0!==this.m_options.minZoomLevel&&(this.m_minZoomLevel=this.m_options.minZoomLevel),void 0!==this.m_options.maxZoomLevel&&(this.m_maxZoomLevel=this.m_options.maxZoomLevel),void 0!==this.m_options.minCameraHeight&&(this.m_minCameraHeight=this.m_options.minCameraHeight),void 0!==this.m_options.maxBounds&&(this.m_geoMaxBounds=this.m_options.maxBounds),void 0!==this.m_options.decoderUrl&&(m.ConcurrentDecoderFacade.defaultScriptUrl=this.m_uriResolver?this.m_uriResolver.resolveUri(this.m_options.decoderUrl):this.m_options.decoderUrl),void 0!==this.m_options.decoderCount&&(m.ConcurrentDecoderFacade.defaultWorkerCount=this.m_options.decoderCount),this.m_visibleTileSetOptions=Object.assign(Object.assign({},H),{clipPlanesEvaluator:void 0!==e.clipPlanesEvaluator?e.clipPlanesEvaluator:(0,u.createDefaultClipPlanesEvaluator)()}),void 0!==e.projection&&(this.m_visibleTileSetOptions.projection=e.projection),void 0!==e.extendedFrustumCulling&&(this.m_visibleTileSetOptions.extendedFrustumCulling=e.extendedFrustumCulling),void 0!==e.maxVisibleDataSourceTiles&&(this.m_visibleTileSetOptions.maxVisibleDataSourceTiles=e.maxVisibleDataSourceTiles),void 0!==e.tileCacheSize&&(this.m_visibleTileSetOptions.tileCacheSize=e.tileCacheSize),void 0!==e.resourceComputationType&&(this.m_visibleTileSetOptions.resourceComputationType=e.resourceComputationType),void 0!==e.quadTreeSearchDistanceUp&&(this.m_visibleTileSetOptions.quadTreeSearchDistanceUp=e.quadTreeSearchDistanceUp),void 0!==e.quadTreeSearchDistanceDown&&(this.m_visibleTileSetOptions.quadTreeSearchDistanceDown=e.quadTreeSearchDistanceDown),void 0!==e.enablePolarDataSource&&(this.m_enablePolarDataSource=e.enablePolarDataSource),this.m_pixelRatio=e.pixelRatio,this.m_options.maxFps=null!==(t=this.m_options.maxFps)&&void 0!==t?t:0,this.m_options.enableStatistics=!0===this.m_options.enableStatistics,this.handleRequestAnimationFrame=this.renderLoop.bind(this),void 0!==this.m_options.tileWrappingEnabled&&(this.m_tileWrappingEnabled=this.m_options.tileWrappingEnabled),this.setupStats(this.m_options.enableStatistics),this.canvas.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.m_renderer=new(null!==(i=n.WebGL1Renderer)&&void 0!==i?i:n.WebGLRenderer)({canvas:this.canvas,context:this.m_options.context,antialias:this.nativeWebglAntialiasEnabled,alpha:this.m_options.alpha,preserveDrawingBuffer:!0===this.m_options.preserveDrawingBuffer,powerPreference:void 0===this.m_options.powerPreference?j.Default:this.m_options.powerPreference}),this.m_renderer.autoClear=!1,this.m_renderer.debug.checkShaderErrors=!1,this.m_renderer.info.autoReset=!1,this.m_tileObjectRenderer=new O.TileObjectRenderer(this.m_env,this.m_renderer),this.setupRenderer(this.m_tileObjectRenderer),this.m_options.fovCalculation=void 0===this.m_options.fovCalculation?y.DEFAULT_FOV_CALCULATION:this.m_options.fovCalculation,this.m_options.fovCalculation.fov=n.MathUtils.clamp(this.m_options.fovCalculation.fov,y.MIN_FOV_DEG,y.MAX_FOV_DEG);const{width:l,height:h}=this.getCanvasClientSize(),p=l/h;this.m_camera=new n.PerspectiveCamera(this.m_options.fovCalculation.fov,p,.1,k),this.m_camera.up.set(0,0,1),this.setFovOnCamera(this.m_options.fovCalculation,h),this.projection.projectPoint(this.m_targetGeoPos,this.m_targetWorldPos),this.m_scene.add(this.m_camera),this.m_screenProjector=new D.ScreenProjector(this.m_camera),this.m_taskScheduler=new C.MapViewTaskScheduler(this.maxFps),this.m_tileGeometryManager=new w.TileGeometryManager(this),void 0!==e.enableMixedLod&&(this.m_enableMixedLod=e.enableMixedLod),void 0!==e.lodMinTilePixelSize&&(this.m_lodMinTilePixelSize=e.lodMinTilePixelSize),this.m_visibleTiles=this.createVisibleTileSet(),this.m_sceneEnvironment=new A.MapViewEnvironment(this,e),this.setupCamera(),this.m_pickHandler=new L.PickHandler(this,this.m_rteCamera,!0===this.m_options.enablePickTechnique),this.m_movementDetector=new c.CameraMovementDetector(this.m_options.movementThrottleTimeout,(()=>this.movementStarted()),(()=>this.movementFinished()));const f=this.m_options.customAntialiasSettings;if(this.mapRenderingManager=new d.MapRenderingManager(l,h,this.m_options.dynamicPixelRatio,f),this.m_animatedExtrusionHandler=new a.AnimatedExtrusionHandler(this),this.m_enablePolarDataSource){const t=void 0!==e.polarStyleSetNames?e.polarStyleSetNames:z;this.m_polarDataSource=new R.PolarTileDataSource({styleSetNames:t,geometryLevelOffset:e.polarGeometryLevelOffset}),this.updatePolarDataSource()}this.m_taskScheduler.addEventListener(U.Update,(()=>{this.update()})),void 0!==e.throttlingEnabled&&(this.m_taskScheduler.throttlingEnabled=e.throttlingEnabled),this.m_themeManager=new P.MapViewThemeManager(this,(0,o.getOptionValue)(this.m_options.theme,H.theme),this.m_imageRepo,this.m_uriResolver),this.m_iconTextRenderer=this.createTextRenderer(),this.update()}get lights(){return this.m_sceneEnvironment.lights}get taskQueue(){return this.m_taskScheduler.taskQueue}get renderLabels(){return this.m_renderLabels}set renderLabels(e){this.m_renderLabels=e}get delayLabelsUntilMovementFinished(){return this.iconTextRenderer.delayLabelsUntilMovementFinished}set delayLabelsUntilMovementFinished(e){this.iconTextRenderer.delayLabelsUntilMovementFinished=e}get iconTextRenderer(){return this.m_iconTextRenderer}get cameraMovementDetector(){return this.m_movementDetector}get animatedExtrusionHandler(){return this.m_animatedExtrusionHandler}get tileGeometryManager(){return this.m_tileGeometryManager}get enableMixedLod(){return this.m_enableMixedLod}set enableMixedLod(e){this.m_enableMixedLod!==e&&(this.m_enableMixedLod=e,this.createVisibleTileSet(),this.update())}get tileWrappingEnabled(){return this.m_tileWrappingEnabled}set tileWrappingEnabled(e){this.projection.type!==r.ProjectionType.Spherical?(e!==this.m_tileWrappingEnabled&&(this.m_tileWrappingEnabled=e,this.createVisibleTileSet()),this.update()):N.warn("Setting this with spherical projection has no affect. Was this intended?")}dispose(e=!0){this.DISPOSE_EVENT.time=Date.now(),this.dispatchEvent(this.DISPOSE_EVENT),this.m_disposed=!0,this.m_movementFinishedUpdateTimerId&&(clearTimeout(this.m_movementFinishedUpdateTimerId),this.m_movementFinishedUpdateTimerId=void 0),void 0!==this.m_animationFrameHandle&&(cancelAnimationFrame(this.m_animationFrameHandle),this.m_animationFrameHandle=void 0),this.canvas.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.removeEventListener("webglcontextrestored",this.onWebGLContextRestored);for(const e of this.m_tileDataSources)e.dispose();this.m_visibleTiles.clearTileCache(),this.m_iconTextRenderer.clearRenderStates(),this.m_textureCache.evictAll(),this.m_renderer.dispose(),e&&this.m_renderer.forceContextLoss(),this.m_imageRepo.iconTextManager.clear(),this.m_tileGeometryManager.clear(),this.m_movementDetector.dispose(),m.ConcurrentDecoderFacade.destroyIfTerminated(),p.ConcurrentTilerFacade.destroyIfTerminated(),this.m_taskScheduler.clearQueuedTasks(),super.dispose()}get disposed(){return this.m_disposed}get resourceComputationType(){return this.m_visibleTiles.resourceComputationType}set resourceComputationType(e){this.m_visibleTiles.resourceComputationType=e}getCacheSize(){return this.m_visibleTiles.getDataSourceCacheSize()}setCacheSize(e,t){this.m_visibleTiles.setDataSourceCacheSize(e),t=void 0!==t?t:e/2,this.m_visibleTiles.setNumberOfVisibleTiles(Math.floor(t)),this.m_iconTextRenderer.invalidateCache(),this.update()}get extendedFrustumCulling(){return void 0===this.m_options.extendedFrustumCulling||this.m_visibleTileSetOptions.extendedFrustumCulling}set extendedFrustumCulling(e){this.m_visibleTileSetOptions.extendedFrustumCulling=e}get lockVisibleTileSet(){return this.m_visibleTileSetLock}set lockVisibleTileSet(e){this.m_visibleTileSetLock=e}get pointOfView(){return this.m_pointOfView}set pointOfView(e){this.m_pointOfView=e,this.update()}loadPostEffects(e){fetch(e).then((e=>e.json())).then((e=>{this.m_postEffects=e,this.setPostEffects()}))}get postEffects(){return this.m_postEffects}set postEffects(e){this.m_postEffects=e,this.setPostEffects()}async setTheme(e,t){if(this.animatedExtrusionHandler.enabled){this.animatedExtrusionHandler.enabled=!1;const e=()=>{this.animatedExtrusionHandler.enabled=!0,this.removeEventListener(U.FrameComplete,e)};this.addEventListener(U.FrameComplete,e)}const i=await this.m_themeManager.setTheme(e,t);return this.THEME_LOADED_EVENT.time=Date.now(),this.dispatchEvent(this.THEME_LOADED_EVENT),this.update(),i}async getTheme(){return await this.m_themeManager.getTheme()}get uriResolver(){return this.m_uriResolver}get forceCameraAspect(){return this.m_forceCameraAspect}set forceCameraAspect(e){this.m_forceCameraAspect=e}get copyrightInfo(){return this.m_copyrightInfo}set disableFading(e){this.m_iconTextRenderer.disableFading=e}get disableFading(){return this.m_iconTextRenderer.disableFading}get frameNumber(){return this.m_frameNumber}resetFrameNumber(){this.m_frameNumber=0,this.m_previousFrameTimeStamp=void 0}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}get canvas(){return this.m_options.canvas}get collisionDebugCanvas(){return this.m_collisionDebugCanvas}get scene(){return this.m_scene}get overlayScene(){return this.m_overlayScene}get sceneEnvironment(){return this.m_sceneEnvironment}get camera(){return this.m_camera}get renderer(){return this.m_renderer}get clearColor(){const e=this.m_renderer.getClearColor(G.color);return void 0!==e?e.getHex():0}set clearColor(e){this.m_renderer.setClearColor(e)}get clearAlpha(){const e=this.m_renderer.getClearAlpha();return void 0!==e?e:0}set clearAlpha(e){this.m_renderer.setClearAlpha(e)}get projection(){return this.m_visibleTileSetOptions.projection}set projection(e){const t=this.tilt,i=this.heading;this.m_visibleTileSetOptions.projection=e,this.updatePolarDataSource(),this.clearTileCache(),this.iconTextRenderer.clearRenderStates(),this.createVisibleTileSet(),this.geoMaxBounds=this.geoMaxBounds,this.lookAtImpl({tilt:t,heading:i})}get clipPlanesEvaluator(){return this.m_visibleTileSetOptions.clipPlanesEvaluator}set clipPlanesEvaluator(e){this.m_visibleTileSetOptions.clipPlanesEvaluator=e}get focalLength(){var e;return null!==(e=h.CameraUtils.getFocalLength(this.m_camera))&&void 0!==e?e:0}get target(){return this.m_targetGeoPos}get worldTarget(){return this.m_targetWorldPos}get targetDistance(){return this.m_targetDistance}get viewRanges(){return this.m_viewRanges}get geoCenter(){return this.projection.unprojectPoint(this.m_camera.position).normalized()}set geoCenter(e){if(void 0!==e.altitude)this.projection.projectPoint(e,this.m_camera.position);else{const t=this.geoCenter.altitude;this.projection.projectPoint(new r.GeoCoordinates(e.latitude,e.longitude,t),this.m_camera.position)}this.update()}get mapAnchors(){return this.m_mapAnchors}get worldCenter(){return this.m_camera.position}get pickHandler(){return this.m_pickHandler}get imageRepo(){return this.m_imageRepo}get textureCache(){return this.m_textureCache}get minCameraHeight(){return this.m_minCameraHeight}get minZoomLevel(){return this.m_minZoomLevel}set minZoomLevel(e){this.m_minZoomLevel=e,this.update()}get maxZoomLevel(){return this.m_maxZoomLevel}set maxZoomLevel(e){this.m_maxZoomLevel=e,this.update()}get geoMaxBounds(){return this.m_geoMaxBounds}set geoMaxBounds(e){this.m_geoMaxBounds=e,this.m_worldMaxBounds=this.m_geoMaxBounds?this.projection.projectBox(this.m_geoMaxBounds,this.projection.type===r.ProjectionType.Planar?new n.Box3:new r.OrientedBox3):void 0}get worldMaxBounds(){return this.m_worldMaxBounds}get zoomLevel(){return this.m_zoomLevel}set zoomLevel(e){this.lookAtImpl({zoomLevel:e})}get tilt(){return n.MathUtils.radToDeg(this.m_pitch)}set tilt(e){this.lookAtImpl({tilt:e})}get heading(){return-n.MathUtils.radToDeg(this.m_yaw)}set heading(e){this.lookAtImpl({heading:e})}get env(){return this.m_env}get storageLevel(){return n.MathUtils.clamp(Math.floor(this.m_zoomLevel),this.m_minZoomLevel,this.m_maxZoomLevel)}get viewportHeight(){return this.canvas.height}get nativeWebglAntialiasEnabled(){return void 0===this.m_options.enableNativeWebglAntialias?this.pixelRatio<2:this.m_options.enableNativeWebglAntialias}get dataSources(){return this.m_tileDataSources}setFovCalculation(e){this.m_options.fovCalculation=e,this.updateCameras()}getDataSourceByName(e){return this.m_tileDataSources.find((t=>t.name===e))}getDataSourcesByStyleSetName(e){return this.m_tileDataSources.filter((t=>{var i;return null===(i=t.styleSetNames)||void 0===i?void 0:i.includes(e)}))}isDataSourceEnabled(e){return e.enabled&&e.ready()&&this.m_connectedDataSources.has(e.name)&&e.isVisible(this.zoomLevel)}async addDataSource(e){var t,i;if(void 0!==this.getDataSourceByName(e.name))throw new Error(`A DataSource with the name "${e.name}" already exists in this MapView.`);e.attach(this),e.setEnableElevationOverlay(void 0!==this.m_elevationProvider);const n=this.m_tileDataSources.find((e=>!0===e.addGroundPlane&&!(e instanceof l.BackgroundDataSource)));!0===e.addGroundPlane&&void 0!==n&&N.warn(`The DataSources ${e.name} and ${n.name} both have a ground plane added, this will cause problems with the fallback logic, see HARP-14728 & HARP-15488.`),this.m_tileDataSources.push(e),this.m_connectingDataSources++,null===(t=this.m_sceneEnvironment)||void 0===t||t.updateBackgroundDataSource();try{if(await e.connect(),!this.m_tileDataSources.includes(e))return;e.addEventListener(U.Update,(()=>{this.update()}));const t=await this.getTheme().catch((()=>{}));(null==t?void 0:t.styles)&&await e.setTheme(t),this.m_connectedDataSources.add(e.name),this.dispatchEvent({type:U.DataSourceConnect,dataSourceName:e.name}),this.update()}catch(t){N.debug(`Failed to connect to datasource ${e.name}: ${null!==(i=t.message)&&void 0!==i?i:t}`),this.dispatchEvent({type:U.DataSourceConnect,dataSourceName:e.name,error:t})}finally{this.m_connectingDataSources--}}removeDataSource(e){const t=this.m_tileDataSources.indexOf(e);-1!==t&&(e.detach(this),this.m_visibleTiles.removeDataSource(e),this.m_tileDataSources.splice(t,1),this.m_connectedDataSources.delete(e.name),this.m_sceneEnvironment.updateBackgroundDataSource(),this.update())}get visibleTileSet(){return this.m_visibleTiles}addOverlayText(e){this.m_iconTextRenderer.addOverlayText(e),this.update()}clearOverlayText(){this.m_iconTextRenderer.clearOverlayText()}lookAt(e,t,i,n){if((0,r.isGeoCoordinatesLike)(e)){const r={target:e,zoomLevel:void 0!==t?F.MapViewUtils.calculateZoomLevelFromDistance(this,t):void 0,tilt:i,heading:n};this.lookAtImpl(r)}else"object"==typeof e&&this.lookAtImpl(e)}setCameraGeolocationAndZoom(e,t,i=0,s=0){this.geoCenter=e;let o=Math.min(F.MapViewUtils.MAX_TILT_DEG,s);if(this.projection.type===r.ProjectionType.Spherical){const e=Math.asin(r.EarthConstants.EQUATORIAL_RADIUS/(F.MapViewUtils.calculateDistanceToGroundFromZoomLevel(this,t)+r.EarthConstants.EQUATORIAL_RADIUS)),i=n.MathUtils.radToDeg(e);o=Math.min(o,i)}F.MapViewUtils.zoomOnTargetPosition(this,0,0,t),F.MapViewUtils.setRotation(this,i,o),this.update()}setDynamicProperty(e,t){if(e.startsWith("$"))throw new Error(`failed to update the value of the dynamic property '${e}'`);this.m_env.entries[e]=t,this.update()}removeDynamicProperty(e){if(e.startsWith("$"))throw new Error(`failed to remove the dynamic property '${e}'`);delete this.m_env.entries[e],this.update()}get animating(){return this.m_animationCount>0}beginAnimation(){0==this.m_animationCount++&&(this.update(),this.ANIMATION_STARTED_EVENT.time=Date.now(),this.dispatchEvent(this.ANIMATION_STARTED_EVENT))}endAnimation(){this.m_animationCount>0&&--this.m_animationCount,0===this.m_animationCount&&(this.ANIMATION_FINISHED_EVENT.time=Date.now(),this.dispatchEvent(this.ANIMATION_FINISHED_EVENT))}get cameraIsMoving(){return this.m_movementDetector.cameraIsMoving}get isDynamicFrame(){return!(0===this.taskQueue.numItemsLeft())||!this.m_visibleTiles.allVisibleTilesLoaded||this.m_themeManager.isUpdating()||this.cameraIsMoving||this.animating||this.m_updatePending||this.m_animatedExtrusionHandler.isAnimating||this.m_iconTextRenderer.isUpdatePending||this.m_iconTextRenderer.loading||this.m_connectingDataSources>0}get pixelToWorld(){(0,o.assert)(this.m_camera instanceof n.PerspectiveCamera),(0,o.assert)(void 0!==this.m_options.fovCalculation);const e=h.CameraUtils.getFocalLength(this.m_camera);return(0,o.assert)(void 0!==e),h.CameraUtils.convertScreenToWorldSize(e,this.m_targetDistance,1)}get worldToPixel(){return 1/this.pixelToWorld}get pixelRatio(){return void 0!==this.m_pixelRatio?this.m_pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1}set pixelRatio(e){this.m_pixelRatio=e,this.renderer.getPixelRatio()!==this.pixelRatio&&this.renderer.setPixelRatio(this.pixelRatio)}set maxFps(e){this.m_options.maxFps=e,this.m_taskScheduler.maxFps=e}get maxFps(){return this.m_options.maxFps}set dynamicPixelRatio(e){this.mapRenderingManager.lowResPixelRatio=e}get dynamicPixelRatio(){return this.mapRenderingManager.lowResPixelRatio}getScreenPosition(e){(0,r.isVector3Like)(e)?G.vector3[0].copy(e):this.projection.projectPoint(r.GeoCoordinates.fromObject(e),G.vector3[0]);const t=this.m_screenProjector.project(G.vector3[0]);if(void 0!==t){const{width:e,height:i}=this.getCanvasClientSize();t.x=t.x+e/2,t.y=i-(t.y+i/2)}return t}getWorldPositionAt(e,t,i){this.m_raycaster.setFromCamera(this.getNormalizedScreenCoordinates(e,t),this.m_camera);const n=this.projection.type===r.ProjectionType.Spherical?this.m_raycaster.ray.intersectSphere(this.m_sphere,G.vector3[0]):this.m_raycaster.ray.intersectPlane(this.m_plane,G.vector3[0]);if(null===n&&!0===i){const e=this.m_camera.getWorldDirection(G.vector3[0]).dot(this.m_raycaster.ray.direction);return G.vector3[0].copy(this.m_raycaster.ray.direction).multiplyScalar(this.m_camera.far/e).add(this.m_camera.position)}return n}getGeoCoordinatesAt(e,t,i){const s=this.getWorldPositionAt(e,t,i);if(!s)return null;const o=this.projection.unprojectPoint(s);return this.tileWrappingEnabled||this.projection.type!==r.ProjectionType.Planar||(o.longitude=n.MathUtils.clamp(o.longitude,-180,180)),o}getNormalizedScreenCoordinates(e,t){const{width:i,height:r}=this.getCanvasClientSize();return new n.Vector3(e/i*2-1,-t/r*2+1,0)}intersectMapObjects(e,t,i){return this.m_pickHandler.intersectMapObjects(e,t,i)}resize(e,t){var i;void 0!==(null===(i=this.camera.userData)||void 0===i?void 0:i.focalLength)&&(this.camera.userData.focalLength=void 0),this.m_renderer.setSize(e,t,!1),this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),void 0!==this.mapRenderingManager&&this.mapRenderingManager.setSize(e,t),void 0!==this.collisionDebugCanvas&&(this.collisionDebugCanvas.width=e,this.collisionDebugCanvas.height=t),this.updateCameras(),this.update(),this.updateLookAtSettings(),this.dispatchEvent({type:U.Resize,size:{width:e,height:t}})}renderSync(e){void 0===e&&(e=o.PerformanceTimer.now()),this.render(e)}update(){this.disposed?N.warn("update(): MapView has been disposed of."):(this.dispatchEvent(this.UPDATE_EVENT),this.m_updatePending||(this.m_updatePending=!0,this.startRenderLoop()))}get updatePending(){return this.m_updatePending}requestUpdateIfNeeded(){this.update()}clearTileCache(e,t){if(void 0!==this.m_visibleTiles){if(void 0!==e){const i=this.getDataSourceByName(e);i&&(this.m_visibleTiles.clearTileCache(i,t),i.clearCache())}else this.m_visibleTiles.clearTileCache(void 0,t),this.m_tileDataSources.forEach((e=>e.clearCache()));void 0!==this.m_elevationProvider&&this.m_elevationProvider.clearCache()}}forEachVisibleTile(e){this.m_visibleTiles.forEachVisibleTile(e)}forEachCachedTile(e){this.m_visibleTiles.forEachCachedTile(e)}markTilesDirty(e,t){this.m_visibleTiles.markTilesDirty(e,t),this.update()}async setElevationSource(e,t,i){this.m_elevationSource&&this.m_elevationSource!==e&&this.removeDataSource(this.m_elevationSource),this.m_tileDataSources.includes(e)||await this.addDataSource(e),this.m_elevationSource=e,this.m_elevationRangeSource=t,this.m_elevationRangeSource.ready()||await this.m_elevationRangeSource.connect(),this.m_elevationProvider=i,this.dataSources.forEach((e=>{e.setEnableElevationOverlay(!0)})),this.m_tileGeometryManager.setTileUpdateCallback((e=>{(0,x.overlayOnElevation)(e)})),this.clearTileCache()}clearElevationSource(e){this.removeDataSource(e),this.m_elevationSource=void 0,this.m_elevationRangeSource=void 0,this.m_elevationProvider=void 0,this.dataSources.forEach((e=>{e.setEnableElevationOverlay(!1)})),this.m_tileGeometryManager.setTileUpdateCallback(void 0),this.clearTileCache()}get fog(){return this.m_sceneEnvironment.fog}setPostEffects(){this.mapRenderingManager.bloom.enabled=!1,this.mapRenderingManager.outline.enabled=!1,this.mapRenderingManager.vignette.enabled=!1,this.mapRenderingManager.sepia.enabled=!1,void 0!==this.m_postEffects&&(void 0!==this.m_postEffects.bloom&&(this.mapRenderingManager.bloom=this.m_postEffects.bloom),void 0!==this.m_postEffects.outline&&(this.mapRenderingManager.outline.enabled=this.m_postEffects.outline.enabled,this.mapRenderingManager.updateOutline(this.m_postEffects.outline)),void 0!==this.m_postEffects.vignette&&(this.mapRenderingManager.vignette=this.m_postEffects.vignette),void 0!==this.m_postEffects.sepia&&(this.mapRenderingManager.sepia=this.m_postEffects.sepia))}get elevationProvider(){return this.m_elevationProvider}get throttlingEnabled(){return!0===this.m_taskScheduler.throttlingEnabled}set throttlingEnabled(e){this.m_taskScheduler.throttlingEnabled=e}get shadowsEnabled(){return!0===this.m_options.enableShadows}set shadowsEnabled(e){void 0!==this.m_renderer.shadowMap&&e!==this.m_renderer.shadowMap.enabled&&(this.m_options.enableShadows=e,this.m_renderer.shadowMap.enabled=e,this.m_renderer.shadowMap.type=n.PCFSoftShadowMap,this.clearTileCache())}extractAttitude(){const e=this.m_camera,t=this.projection,i=G.vector3[1],n=G.transform[0],r=G.matrix4[1];i.setFromMatrixPosition(e.matrixWorld),t.localTangentSpace(this.m_targetGeoPos,n),r.makeBasis(n.xAxis,n.yAxis,n.zAxis),G.matrix4[0].copy(r).invert().multiply(e.matrixWorld),n.xAxis.setFromMatrixColumn(G.matrix4[0],0),n.yAxis.setFromMatrixColumn(G.matrix4[0],1),n.zAxis.setFromMatrixColumn(G.matrix4[0],2);let s=0,o=0,a=0;const l=n.zAxis.dot(i.set(0,0,1));return l<1-1e-10?l>1e-10-1?(s=Math.atan2(n.zAxis.x,-n.zAxis.y),o=Math.acos(n.zAxis.z),a=Math.atan2(n.xAxis.x,n.yAxis.z)):(s=-Math.atan2(-n.yAxis.x,n.xAxis.x),o=180,a=0):(s=Math.atan2(-n.yAxis.x,n.xAxis.x),o=0,a=0),{yaw:s,pitch:o,roll:a}}lookAtImpl(e){var t,i;const s=this.projection,o=this.camera,a=Math.min(null!==(t=e.tilt)&&void 0!==t?t:this.tilt,F.MapViewUtils.MAX_TILT_DEG),l=-(null!==(i=e.heading)&&void 0!==i?i:this.heading),c=void 0!==e.zoomLevel?F.MapViewUtils.calculateDistanceFromZoomLevel(this,n.MathUtils.clamp(e.zoomLevel,this.m_minZoomLevel,this.m_maxZoomLevel)):e.distance,h=e.target?r.GeoCoordinates.fromObject(e.target):void 0;if(e.bounds)(0,v.fitLookAtBounds)({target:this.target,camera:this.camera,cameraSettings:this,projection:this.projection,maxZoomLevel:this.maxZoomLevel,viewportSize:this.m_renderer.getSize(G.vector2[0]),tileWrapping:this.tileWrappingEnabled},{bounds:e.bounds,target:h,distance:c,yaw:l,tilt:a,padding:e.padding});else{const e=null!=h?h:this.target;F.MapViewUtils.getCameraRotationAtTarget(s,e,l,a,o.quaternion);const t=null!=c?c:this.m_targetDistance;F.MapViewUtils.getCameraPositionFromTarget(e,t,l,a,s,o.position),o.updateMatrixWorld(!0)}this.updateLookAtSettings(),this.update()}updatePolarDataSource(){const e=this.m_polarDataSource;if(!0===this.m_enablePolarDataSource&&void 0!==e){const t=this.getDataSourceByName(e.name);this.projection.type===r.ProjectionType.Spherical?void 0===t&&this.addDataSource(e):void 0!==t&&this.removeDataSource(e)}}updateCameras(e){var t;this.m_camera.updateMatrixWorld(!1),this.updateLookAtSettings();const{width:i,height:n}=this.m_renderer.getSize(G.vector2[0]);this.m_camera.aspect=void 0!==this.m_forceCameraAspect?this.m_forceCameraAspect:i/n,this.setFovOnCamera(this.m_options.fovCalculation,n);const r=this.projection.getScaleFactor(this.camera.position),s=r*this.m_tileDataSources.reduce(((e,t)=>Math.max(e,t.maxGeometryHeight)),0),o=r*this.m_tileDataSources.reduce(((e,t)=>Math.min(e,t.minGeometryHeight)),0);Object.assign(this.m_viewRanges,void 0===e?this.m_visibleTiles.updateClipPlanes(s,o):e),this.m_camera.near=this.m_viewRanges.near,this.m_camera.far=this.m_viewRanges.far,this.m_camera.updateProjectionMatrix(),this.m_rteCamera.copy(this.m_camera),this.m_rteCamera.position.setScalar(0),this.m_rteCamera.updateMatrixWorld(!0),null===(t=this.m_iconTextRenderer)||void 0===t||t.updateCamera(),this.m_screenProjector.update(this.camera,i,n),this.updateEnv(),this.m_sceneEnvironment.update()}updateLookAtSettings(){let{target:e,distance:t,final:i}=F.MapViewUtils.getTargetAndDistance(this.projection,this.camera,this.elevationProvider);i||this.update(),this.geoMaxBounds&&({target:e,distance:t}=F.MapViewUtils.constrainTargetAndDistanceToViewBounds(e,t,this)),this.m_targetWorldPos.copy(e),this.m_targetGeoPos=this.projection.unprojectPoint(this.m_targetWorldPos),this.m_targetDistance=t,this.m_zoomLevel=F.MapViewUtils.calculateZoomLevelFromDistance(this,this.m_targetDistance);const{yaw:n,pitch:r,roll:s}=this.extractAttitude();this.m_yaw=n,this.m_pitch=r,this.m_roll=s}updateEnv(){this.m_env.entries.$zoom=this.m_zoomLevel,this.m_env.entries.$shouldAntialiasRasterTile=this.m_zoomLevel%1!=0||0!==this.m_yaw||0!==this.m_pitch||0!==this.m_roll,this.m_env.entries.$pixelToMeters=this.pixelToWorld,this.m_env.entries.$frameNumber=this.m_frameNumber}ndcToView(e,t){return t.set(e.x,e.y,e.z).applyMatrix4(this.camera.projectionMatrixInverse).applyMatrix4(this.m_rteCamera.matrixWorld),t}renderLoop(e){if(!0!==this.m_options.synchronousRendering&&!this.disposed){if(0===this.maxFps)this.render(e);else{const t=3,i=1e3/this.maxFps;e>=(void 0===this.m_previousFrameTimeStamp?0:this.m_previousFrameTimeStamp)+i-t&&this.render(e)}this.isDynamicFrame?this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame):this.m_animationFrameHandle=void 0}}startRenderLoop(){void 0!==this.m_animationFrameHandle||this.m_options.synchronousRendering||(this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame))}getEnabledTileDataSources(){const e=[];for(const t of this.m_tileDataSources)this.isDataSourceEnabled(t)&&e.push(t);return e}render(e){if(this.m_drawing)return;if(this.disposed)return void N.warn("render(): MapView has been disposed of.");let t;this.RENDER_EVENT.time=e,this.dispatchEvent(this.RENDER_EVENT),this.m_tileObjectRenderer.prepareRender(),++this.m_frameNumber;const i=I.PerformanceStatistics.instance,n=i.enabled;if(n){if(t=i.currentFrame,void 0!==this.m_previousFrameTimeStamp){const i=e-this.m_previousFrameTimeStamp;t.setValue("render.fps",1e3/i)}i.storeAndClearFrameInfo(),t.setValue("renderCount.frameNumber",this.m_frameNumber)}let r,s,a,l,c,h;if(this.m_previousFrameTimeStamp=e,this.m_renderer.info.reset(),this.m_updatePending=!1,this.m_thisFrameTilesChanged=void 0,this.m_drawing=!0,this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),this.updateCameras(),this.m_renderer.clear(),this.m_sceneRoot.children.length=0,this.m_overlaySceneRoot.children.length=0,n&&(r=o.PerformanceTimer.now()),!this.lockVisibleTileSet){const e=this.m_visibleTiles.updateRenderList(this.storageLevel,Math.floor(this.zoomLevel),this.getEnabledTileDataSources(),this.m_frameNumber,this.m_elevationRangeSource);e.viewRangesChanged&&this.updateCameras(e.viewRanges)}n&&(s=o.PerformanceTimer.now());const u=this.m_visibleTiles.dataSourceTileList;if(u.forEach((({zoomLevel:e,renderedTiles:t})=>{t.forEach((t=>{this.m_tileObjectRenderer.render(t,e,this.zoomLevel,this.m_camera.position,this.m_sceneRoot),t.frameNumLastVisible=this.m_frameNumber}))})),this.m_mapAnchors.update(this.projection,this.camera.position,this.m_sceneRoot,this.m_overlaySceneRoot),this.m_animatedExtrusionHandler.update(this.zoomLevel),void 0!==t&&(t.addValue("renderCount.numTilesRendered",0),t.addValue("renderCount.numTilesVisible",0),t.addValue("renderCount.numTilesLoading",0),u.forEach((({zoomLevel:e,renderedTiles:i,visibleTiles:n,numTilesLoading:r})=>{t.addValue("renderCount.numTilesRendered",i.size),t.addValue("renderCount.numTilesVisible",n.length),t.addValue("renderCount.numTilesLoading",r)}))),this.m_movementDetector.checkCameraMoved(this,e)){const{latitude:e,longitude:t,altitude:i}=this.geoCenter;this.dispatchEvent({type:U.CameraPositionChanged,latitude:e,longitude:t,altitude:i,yaw:this.m_yaw,pitch:this.m_pitch,roll:this.m_roll,tilt:this.tilt,heading:this.heading,zoom:this.zoomLevel})}const d=void 0!==this.m_pointOfView?this.m_pointOfView:this.m_rteCamera;if(this.renderLabels&&!this.m_pointOfView&&this.m_iconTextRenderer.placeText(u,e),n&&(a=o.PerformanceTimer.now()),this.mapRenderingManager.render(this.m_renderer,this.m_scene,d,!this.isDynamicFrame),n&&(l=o.PerformanceTimer.now()),this.renderLabels&&!this.m_pointOfView&&this.m_iconTextRenderer.renderText(this.m_viewRanges.maximum),this.m_overlaySceneRoot.children.length>0&&this.m_renderer.render(this.m_overlayScene,d),n&&(c=o.PerformanceTimer.now()),this.m_firstFrameRendered||(this.m_firstFrameRendered=!0,n&&i.appResults.set("firstFrame",e),this.FIRST_FRAME_EVENT.time=e,this.dispatchEvent(this.FIRST_FRAME_EVENT)),this.m_visibleTiles.disposePendingTiles(),this.m_drawing=!1,this.checkCopyrightUpdates(),void 0!==this.m_taskSchedulerTimeout&&clearTimeout(this.m_taskSchedulerTimeout),this.m_taskSchedulerTimeout=setTimeout((()=>{this.m_taskSchedulerTimeout=void 0,this.m_taskScheduler.processPending(e)}),0),void 0!==t){h=o.PerformanceTimer.now();const n=h-e;t.setValue("render.setupTime",r-e),t.setValue("render.cullTime",s-r),t.setValue("render.textPlacementTime",a-s),t.setValue("render.drawTime",l-a),t.setValue("render.textDrawTime",c-l),t.setValue("render.cleanupTime",h-c),t.setValue("render.frameRenderTime",n),t.setValue("render.fullFrameTime",n),t.setValue("render.geometryCreationTime",0),i.addWebGLInfo(this.m_renderer.info),i.addMemoryInfo()}this.DID_RENDER_EVENT.time=e,this.dispatchEvent(this.DID_RENDER_EVENT),this.isDynamicFrame||(!1===this.m_firstFrameComplete&&(this.m_firstFrameComplete=!0,n&&i.appResults.set("firstFrameComplete",e)),this.FRAME_COMPLETE_EVENT.time=e,this.dispatchEvent(this.FRAME_COMPLETE_EVENT))}setupCamera(){(0,o.assert)(void 0!==this.m_visibleTiles),this.m_options.target=r.GeoCoordinates.fromObject((0,o.getOptionValue)(this.m_options.target,H.target)),this.m_options.target.altitude=0,this.m_options.tilt=(0,o.getOptionValue)(this.m_options.tilt,H.tilt),this.m_options.heading=(0,o.getOptionValue)(this.m_options.heading,H.heading),this.m_options.zoomLevel=(0,o.getOptionValue)(this.m_options.zoomLevel,H.zoomLevel),this.lookAtImpl(this.m_options);const{width:e,height:t}=this.getCanvasClientSize();this.resize(e,t)}createVisibleTileSet(){(0,o.assert)(void 0!==this.m_tileGeometryManager),this.m_visibleTiles&&(this.m_visibleTiles.clearTileCache(),this.m_visibleTiles.disposePendingTiles());const e=void 0===this.m_enableMixedLod?this.projection.type===r.ProjectionType.Spherical:this.m_enableMixedLod;return this.m_visibleTiles=new V.VisibleTileSet(new _.FrustumIntersection(this.m_camera,this,this.m_visibleTileSetOptions.extendedFrustumCulling,this.m_tileWrappingEnabled,e,this.m_lodMinTilePixelSize),this.m_tileGeometryManager,this.m_visibleTileSetOptions),this.m_visibleTiles}movementStarted(){this.m_iconTextRenderer.movementStarted(),this.MOVEMENT_STARTED_EVENT.time=Date.now(),this.dispatchEvent(this.MOVEMENT_STARTED_EVENT)}movementFinished(){this.m_iconTextRenderer.movementFinished(),this.MOVEMENT_FINISHED_EVENT.time=Date.now(),this.dispatchEvent(this.MOVEMENT_FINISHED_EVENT),this.animating||(void 0!==this.m_movementFinishedUpdateTimerId&&clearTimeout(this.m_movementFinishedUpdateTimerId),this.m_movementFinishedUpdateTimerId=setTimeout((()=>{this.m_movementFinishedUpdateTimerId=void 0,this.update()}),0))}checkIfTilesChanged(){if(void 0!==this.m_thisFrameTilesChanged)return this.m_thisFrameTilesChanged;const e=this.m_visibleTiles.dataSourceTileList,t=[];t.length=0,e.forEach((({dataSource:e,renderedTiles:i})=>{i.forEach((i=>{t.push(e.name+"-"+i.tileKey.mortonCode())}))})),t.sort();const i=t.join("#");return i!==this.m_lastTileIds?(this.m_lastTileIds=i,this.m_thisFrameTilesChanged=!0):this.m_thisFrameTilesChanged=!1,this.m_thisFrameTilesChanged}checkCopyrightUpdates(){if(!this.checkIfTilesChanged())return;const e=this.getRenderedTilesCopyrightInfo();if(e!==this.m_copyrightInfo){if(e.length===this.m_copyrightInfo.length){let t=!0;for(let i=0;i<e.length;i++){const n=e[i],r=this.m_copyrightInfo[i];if(n.label!==r.label){t=!1;break}}if(t)return}this.m_copyrightInfo=e,this.dispatchEvent(this.COPYRIGHT_CHANGED_EVENT)}}getRenderedTilesCopyrightInfo(){let e=[];for(const t of this.m_visibleTiles.dataSourceTileList)for(const i of t.renderedTiles.values()){const t=i.copyrightInfo;void 0!==t&&0!==t.length&&(e=f.CopyrightInfo.mergeArrays(e,t))}return e}setupStats(e){new I.PerformanceStatistics(e,1e3)}setupRenderer(e){var t;this.m_scene.add(this.m_sceneRoot),this.m_overlayScene.add(this.m_overlaySceneRoot),this.shadowsEnabled=null!==(t=this.m_options.enableShadows)&&void 0!==t&&t,e.setupRenderer()}createTextRenderer(){return new b.IconTextRenderer(new T.MapViewState(this,this.checkIfTilesChanged.bind(this)),this.m_screenProjector,this.m_imageRepo,this.m_textureCache,this.m_renderer,this.m_options)}setFovOnCamera(e,t){const i=n.MathUtils.degToRad(e.fov);if("fixed"===e.type)return void h.CameraUtils.setVerticalFov(this.m_camera,i,t);let r=h.CameraUtils.getFocalLength(this.m_camera);void 0===r&&(h.CameraUtils.setVerticalFov(this.m_camera,i,t),r=h.CameraUtils.getFocalLength(this.m_camera)),h.CameraUtils.setFocalLength(this.m_camera,r,t)}getCanvasClientSize(){const{clientWidth:e,clientHeight:t}=this.canvas;if(0===e||0===t||"number"!=typeof e||"number"!=typeof t){const e=this.m_renderer.getPixelRatio();return{width:Math.round(this.canvas.width/e),height:Math.round(this.canvas.height/e)}}return{width:e,height:t}}}t.MapView=W},4247:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewAtmosphere=t.AtmosphereLightMode=void 0;const n=i(82),r=i(2616),s=i(4250),o=i(4342),a=i(9978);var l,c,h;!function(e){e[e.Ground=1]="Ground",e[e.Sky=2]="Sky",e[e.SkyAndGround=3]="SkyAndGround"}(l||(l={})),function(e){e[e.ScatteringShader=0]="ScatteringShader",e[e.SimpleColor=1]="SimpleColor",e[e.Wireframe=2]="Wireframe"}(c||(c={})),function(e){e[e.LightOverhead=0]="LightOverhead",e[e.LightDynamic=1]="LightDynamic"}(h=t.AtmosphereLightMode||(t.AtmosphereLightMode={}));const u={clipPlanes:{near:0,far:0}};class d{static isPresent(e){for(const t of e.children)if(t.name===d.SkyAtmosphereUserName||t.name===d.GroundAtmosphereUserName)return!0;return!1}constructor(e,t,i,s,o,h=l.SkyAndGround,u=c.ScatteringShader){this.m_mapAnchors=e,this.m_sceneCamera=t,this.m_projection=i,this.m_rendererCapabilities=s,this.m_updateCallback=o,this.m_atmosphereVariant=h,this.m_materialVariant=u,this.m_enabled=!0,this.m_clipPlanesEvaluator=new a.TiltViewClipPlanesEvaluator(.025*r.EarthConstants.EQUATORIAL_RADIUS,0,1,.05,1e7),this.m_lightDirection=new n.Vector3(0,1,0),this.m_atmosphereVariant&l.Sky&&this.createSkyGeometry(),this.m_atmosphereVariant&l.Ground&&this.createGroundGeometry(),this.addToMapAnchors(this.m_mapAnchors)}get skyMesh(){return this.m_skyMesh}get groundMesh(){return this.m_groundMesh}set enabled(e){if(this.disposed)return;if(this.m_enabled===e)return;this.m_enabled=e;const t=d.isPresent(this.m_mapAnchors);e&&!t?this.addToMapAnchors(this.m_mapAnchors):!e&&t&&this.removeFromMapAnchors(this.m_mapAnchors)}get enabled(){return this.m_enabled}set lightMode(e){if(this.m_materialVariant!==c.ScatteringShader)return;const t=e===h.LightDynamic;void 0!==this.m_groundMaterial&&this.m_groundMaterial.setDynamicLighting(t),void 0!==this.m_skyMaterial&&this.m_skyMaterial.setDynamicLighting(t)}dispose(){var e,t,i,n;this.enabled&&(this.enabled=!1),null===(e=this.m_skyMaterial)||void 0===e||e.dispose(),null===(t=this.m_groundMaterial)||void 0===t||t.dispose(),null===(i=this.m_skyGeometry)||void 0===i||i.dispose(),null===(n=this.m_groundGeometry)||void 0===n||n.dispose(),this.m_skyGeometry=void 0,this.m_groundGeometry=void 0,this.m_skyMaterial=void 0,this.m_groundMaterial=void 0,this.m_skyMesh=void 0,this.m_groundMesh=void 0}reset(e){}get disposed(){return void 0===this.m_skyMesh&&void 0===this.m_groundMesh}addToMapAnchors(e){(0,o.assert)(!d.isPresent(e),"Atmosphere already added"),void 0!==this.m_skyMesh&&e.add(m(this.m_skyMesh,Number.MIN_SAFE_INTEGER)),void 0!==this.m_groundMesh&&e.add(m(this.m_groundMesh,Number.MAX_SAFE_INTEGER)),this.m_updateCallback&&this.m_updateCallback()}removeFromMapAnchors(e){if(!d.isPresent(e))return;let t=!1;void 0!==this.m_skyMesh&&(e.remove(this.m_skyMesh),t=!0),void 0!==this.m_groundMesh&&(e.remove(this.m_groundMesh),t=!0),t&&this.m_updateCallback&&this.m_updateCallback()}createSkyGeometry(){this.m_projection.type===r.ProjectionType.Spherical?this.m_skyGeometry=new n.SphereGeometry(1.025*r.EarthConstants.EQUATORIAL_RADIUS,256,256):this.m_skyGeometry=new n.PlaneGeometry(200,200),this.m_skyGeometry.translate(0,0,0),this.m_materialVariant===c.ScatteringShader?this.m_skyMaterial=new s.SkyAtmosphereMaterial({rendererCapabilities:this.m_rendererCapabilities}):this.m_materialVariant===c.SimpleColor?this.m_skyMaterial=new n.MeshBasicMaterial({color:new n.Color(12908781),opacity:.4,transparent:!1,depthTest:!0,depthWrite:!1,side:n.BackSide,blending:n.NormalBlending,fog:!1}):this.m_skyMaterial=new n.MeshStandardMaterial({color:8388607,depthTest:!1,depthWrite:!1,normalScale:new n.Vector2(-1,-1),side:n.BackSide,wireframe:!0}),this.m_skyMesh=new n.Mesh(this.m_skyGeometry,this.m_skyMaterial),this.m_skyMesh.name=d.SkyAtmosphereUserName,this.setupSkyForRendering()}createGroundGeometry(){this.m_projection.type===r.ProjectionType.Spherical?this.m_groundGeometry=new n.SphereGeometry(1.0001*r.EarthConstants.EQUATORIAL_RADIUS,256,256):this.m_groundGeometry=new n.PlaneGeometry(200,200),this.m_groundGeometry.translate(0,0,0),this.m_materialVariant===c.ScatteringShader?this.m_groundMaterial=new s.GroundAtmosphereMaterial({rendererCapabilities:this.m_rendererCapabilities}):this.m_materialVariant===c.SimpleColor?this.m_groundMaterial=new n.MeshBasicMaterial({color:new n.Color(50687),opacity:.4,transparent:!0,depthTest:!1,depthWrite:!1,side:n.FrontSide,blending:n.NormalBlending,fog:!1}):this.m_groundMaterial=new n.MeshStandardMaterial({color:1149338,depthTest:!0,depthWrite:!1,side:n.FrontSide,wireframe:!0}),this.m_groundMesh=new n.Mesh(this.m_groundGeometry,this.m_groundMaterial),this.m_groundMesh.name=d.GroundAtmosphereUserName,this.setupGroundForRendering()}setupSkyForRendering(){if(void 0===this.m_skyMesh)return;let e;e=this.m_materialVariant!==c.ScatteringShader?(e,t)=>{this.overrideClipPlanes(e)}:(e,t)=>{this.overrideClipPlanes(e),(0,o.assert)(t instanceof s.SkyAtmosphereMaterial);const i=this.m_skyMaterial;i.updateUniforms(i,this.m_skyMesh,e,this.m_lightDirection)},(0,o.assert)(void 0!==this.m_skyMaterial),this.m_skyMesh.onBeforeRender=(t,i,n,r,s,o)=>{e(n,s)},this.m_skyMesh.onAfterRender=(e,t,i,n,r,s)=>{this.revertClipPlanes(i)}}setupGroundForRendering(){void 0!==this.m_groundMesh&&this.m_materialVariant===c.ScatteringShader&&((0,o.assert)(void 0!==this.m_groundMaterial),this.m_groundMesh.onBeforeRender=(e,t,i,n,r,a)=>{(0,o.assert)(r instanceof s.GroundAtmosphereMaterial);const l=this.m_groundMaterial;l.updateUniforms(l,this.m_groundMesh,i,this.m_lightDirection)})}overrideClipPlanes(e){const t=this.m_sceneCamera;u.clipPlanes.near=t.near,u.clipPlanes.far=t.far;const i=this.m_clipPlanesEvaluator.evaluateClipPlanes(this.m_sceneCamera,this.m_projection);(0,o.assert)(e instanceof n.PerspectiveCamera);const s=e;s.near=i.near,s.far=i.far+.1*r.EarthConstants.EQUATORIAL_RADIUS,s.updateProjectionMatrix()}revertClipPlanes(e){(0,o.assert)(e instanceof n.PerspectiveCamera);const t=e;t.near=u.clipPlanes.near,t.far=u.clipPlanes.far,t.updateProjectionMatrix()}}function m(e,t){const i=e;return i.renderOrder=t,i.pickable=!1,i.anchor=new n.Vector3(0,0,0),i}t.MapViewAtmosphere=d,d.SkyAtmosphereUserName="SkyAtmosphere",d.GroundAtmosphereUserName="GroundAtmosphere"},3011:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewEnvironment=t.DEFAULT_CLEAR_COLOR=void 0;const n=i(2616),r=i(8023),s=i(7610),o=i(4342),a=i(82),l=i(5863),c=i(3977),h=i(3061),u=i(7775),d=i(5640),m=o.LoggerManager.instance.create("MapViewEnvironment");t.DEFAULT_CLEAR_COLOR=16777215;const p={vector3:[new a.Vector3,new a.Vector3,new a.Vector3],frustumPoints:[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3]};t.MapViewEnvironment=class{constructor(e,t){this.m_mapView=e,this.m_lastZoomLevelOnUpdate=NaN,this.onMapViewContextRestored=e=>{void 0!==this.m_mapView.renderer&&this.m_mapView.getTheme().then((e=>{this.updateClearColor(e.clearColor,e.clearAlpha,e.definitions),this.m_mapView.update()}))},this.applyClearColorAndAlpha=()=>{const e=this.evaluateClearColor(),t=r.Expr.isExpr(this.m_clearAlpha)?this.m_clearAlpha.evaluate(this.m_mapView.env,r.ExprScope.Dynamic):this.m_clearAlpha;void 0!==this.m_mapView.renderer&&this.m_mapView.renderer.setClearColor(e,t)},this.m_fog=new h.MapViewFog(this.m_mapView.scene),!1!==t.addBackgroundDatasource&&(this.m_backgroundDataSource=new l.BackgroundDataSource(t.backgroundTilingScheme),this.m_mapView.addDataSource(this.m_backgroundDataSource)),this.m_mapView.addEventListener(c.MapViewEventNames.ContextRestored,this.onMapViewContextRestored),this.updateClearColor()}get lights(){var e;return null!==(e=this.m_createdLights)&&void 0!==e?e:[]}get fog(){return this.m_fog}updateBackgroundDataSource(){this.m_backgroundDataSource&&this.m_backgroundDataSource.updateStorageLevelOffset()}update(){this.m_lastZoomLevelOnUpdate!==this.m_mapView.zoomLevel&&(this.m_lastZoomLevelOnUpdate=this.m_mapView.zoomLevel,this.applyClearColorAndAlpha()),this.m_fog.update(this.m_mapView,this.m_mapView.viewRanges.maximum),this.m_skyBackground&&this.m_mapView.projection.type===n.ProjectionType.Planar&&this.m_skyBackground.updateCamera(this.m_mapView.camera),this.updateLights()}updateClearColor(e,i,n){if(void 0===e)this.m_clearColor=t.DEFAULT_CLEAR_COLOR;else{const t=r.Expr.fromJSON(e,n);this.m_clearColor=t.isDynamic()?t:t.evaluate(this.m_mapView.env,r.ExprScope.Value)}if(void 0===i)this.m_clearAlpha=i;else{const e=r.Expr.fromJSON(i,n);this.m_clearAlpha=e.isDynamic()?e:e.evaluate(this.m_mapView.env,r.ExprScope.Value)}this.applyClearColorAndAlpha()}evaluateClearColor(){let e;if(r.Expr.isExpr(this.m_clearColor)){const t=this.m_clearColor.evaluate(this.m_mapView.env,r.ExprScope.Dynamic);e=t instanceof s.RGBA?t.getHex():t}else e=this.m_clearColor;return e}updateSkyBackground(e){e?this.setSkyBackground(e):this.removeSkyBackGround()}updateLighting(e){var t;this.m_createdLights&&this.m_createdLights.forEach((e=>{this.m_mapView.scene.remove(e)})),null===(t=this.m_overlayCreatedLights)||void 0===t||t.forEach((e=>{this.m_mapView.overlayScene.remove(e),e instanceof a.DirectionalLight&&this.m_mapView.overlayScene.remove(e.target)})),void 0!==e&&(this.m_createdLights=[],this.m_overlayCreatedLights=[],e.forEach((e=>{const t=(0,d.createLight)(e);if(!t)return void m.warn(`MapView: failed to create light ${e.name} of type ${e.type}`);if(this.m_mapView.scene.add(t),t.isDirectionalLight){const e=t;this.m_mapView.scene.add(e.target)}this.m_createdLights.push(t);const i=t.clone();this.m_mapView.overlayScene.add(i),i instanceof a.DirectionalLight&&this.m_mapView.overlayScene.add(i.target.clone())})))}updateLights(){if(!this.m_mapView.shadowsEnabled||this.m_mapView.projection.type===n.ProjectionType.Spherical||void 0===this.m_createdLights||0===this.m_createdLights.length)return;const e=[{x:-1,y:-1,z:-1},{x:1,y:-1,z:-1},{x:-1,y:1,z:-1},{x:1,y:1,z:-1},{x:-1,y:-1,z:1},{x:1,y:-1,z:1},{x:-1,y:1,z:1},{x:1,y:1,z:1}].map(((e,t)=>this.m_mapView.ndcToView(e,p.frustumPoints[t])));this.m_createdLights.forEach((t=>{const i=t;if(!0===i.isDirectionalLight){const t=p.vector3[0];t.copy(i.target.position),t.sub(i.position),t.normalize();const r=p.vector3[1];this.m_mapView.projection.type===n.ProjectionType.Planar&&r.set(0,0,-1);const s=this.m_mapView.tilt,o=this.m_mapView.targetDistance*Math.cos(a.MathUtils.degToRad(s))/r.dot(t);i.target.position.copy(this.m_mapView.worldTarget).sub(this.m_mapView.camera.position),i.position.copy(this.m_mapView.worldTarget),i.position.addScaledVector(t,-o),i.position.sub(this.m_mapView.camera.position),i.updateMatrixWorld(),i.shadow.updateMatrices(i);const l=i.shadow.camera,c=e.map((e=>this.viewToLightSpace(e.clone(),l))),h=new a.Box3;c.forEach((e=>{h.expandByPoint(e)})),l.left=h.min.x,l.right=h.max.x,l.top=h.max.y,l.bottom=h.min.y,l.near=.95*-h.max.z,l.far=-h.min.z,l.updateProjectionMatrix()}}))}removeSkyBackGround(){this.m_mapView.scene.background=null,void 0!==this.m_skyBackground&&(this.m_skyBackground.dispose(),this.m_skyBackground=void 0)}setSkyBackground(e){var t;this.m_skyBackground?this.m_skyBackground.updateTexture(e,this.m_mapView.projection.type):this.m_skyBackground=new u.SkyBackground(e,this.m_mapView.projection.type,this.m_mapView.camera),this.m_mapView.scene.background=null===(t=this.m_skyBackground)||void 0===t?void 0:t.texture}viewToLightSpace(e,t){return e.applyMatrix4(t.matrixWorldInverse)}}},3061:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewFog=void 0;const n=i(82),r=i(4250),s=i(4342);t.MapViewFog=class{constructor(e){this.m_scene=e,this.m_enabled=!0,this.m_fog=new n.Fog(0),this.m_fogIsDefined=!1}set enabled(e){this.m_enabled=e,e&&this.m_fogIsDefined&&null===this.m_scene.fog?this.add():e||null===this.m_scene.fog||this.remove()}get enabled(){return this.m_enabled}reset(e){this.m_cachedFog=e,void 0!==e&&void 0!==e.color&&void 0!==e.startRatio?(this.m_fogIsDefined=!0,this.m_fog.color.set(e.color),this.m_enabled&&null===this.m_scene.fog&&this.add()):(this.m_fogIsDefined=!1,null!==this.m_scene.fog&&this.remove())}update(e,t){if(null!==this.m_scene.fog&&void 0!==this.m_cachedFog&&this.m_cachedFog&&void 0!==this.m_cachedFog.startRatio&&(void 0!==e.camera.far||void 0!==t)){const i=void 0!==t?t:e.camera.far,r=1,o=0,a=this.m_cachedFog.startRatio,l=1;(0,s.assert)(a<=l);const c=Math.abs(Math.cos(e.tilt)),h=s.MathUtils.smoothStep(r,o,c);this.m_fog.near=n.MathUtils.lerp(i*a,i,1-h),this.m_fog.far=n.MathUtils.lerp(i*l,i,h),this.m_fog.near=Math.min(this.m_fog.near,e.camera.far),this.m_fog.far=Math.min(this.m_fog.far,e.camera.far)}}add(){this.m_scene.fog=this.m_fog,this.setFogInRawShaderMaterials(!0)}remove(){this.m_scene.fog=null,this.setFogInRawShaderMaterials(!1)}setFogInRawShaderMaterials(e){this.m_scene.traverse((t=>{if(t instanceof n.Mesh){const i=t.material;i instanceof n.Material&&!(i instanceof r.HighPrecisionLineMaterial)&&i.fog!==e&&(i.fog=e,i instanceof r.RawShaderMaterial&&i.invalidateFog())}}))}}},5146:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Squares=t.Circles=t.MapViewPoints=void 0;const n=i(82);class r extends n.Points{constructor(){super(...arguments),this.enableRayTesting=!0}raycast(e,t){if(!this.enableRayTesting)return;const i=this.geometry,r=this.matrixWorld,o=s(e.ray.origin.clone().add(e.ray.direction).project(e.camera),e),a=(i,n)=>{const a=function(e,t,i){const n=e.clone().applyMatrix4(t),r=n.distanceTo(i.ray.origin),o=n.project(i.camera),a=o.x<1&&o.x>-1&&o.y<1&&o.y>-1;return a?{absoluteScreenPosition:s(o,i),pointIsOnScreen:a,distance:r}:{pointIsOnScreen:a}}(i,r,e);a.pointIsOnScreen&&this.testPoint(i,a.absoluteScreenPosition,o,n,a.distance,t)},l=new n.Vector3,c=i.index,h=i.attributes.position.array;if(null!==c){const e=c.array;for(let t=0,i=e.length;t<i;t++)a(l.fromArray(h,3*e[t]),t)}else for(let e=0,t=h.length/3;e<t;e++)a(l.fromArray(h,3*e),e)}}function s(e,t){return new n.Vector2(e.x+1,1-e.y).divideScalar(2).multiply(t.canvasSize).ceil()}t.MapViewPoints=r,t.Circles=class extends r{testPoint(e,t,i,n,r,s){const o=t.x-i.x,a=t.y-i.y;Math.sqrt(o*o+a*a)<=this.material.size/2&&s.push({point:e,distance:r,index:n,object:this})}},t.Squares=class extends r{testPoint(e,t,i,n,r,s){const o=t.x-i.x,a=t.y-i.y,l=this.material.size/2;Math.abs(o)<=l&&Math.abs(a)<=l&&s.push({point:e,distance:r,index:n,object:this})}}},19:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewTaskScheduler=void 0;const n=i(4342),r=i(82),s=i(3977),o=i(8015),a={type:"update"};class l extends r.EventDispatcher{constructor(e=60){super(),this.m_maxFps=e,this.m_throttlingEnabled=!1,this.m_taskQueue=new n.TaskQueue({groups:[s.TileTaskGroups.FETCH_AND_DECODE,s.TileTaskGroups.CREATE],prioSortFn:(e,t)=>e.getPriority()-t.getPriority()}),this.maxFps=e}set maxFps(e){this.m_maxFps=e<=0?60:e}get maxFps(){return this.m_maxFps}get taskQueue(){return this.m_taskQueue}get throttlingEnabled(){return!0===this.m_throttlingEnabled}set throttlingEnabled(e){this.m_throttlingEnabled=e}requestUpdate(){this.dispatchEvent(a)}processPending(e){const t=o.PerformanceStatistics.instance,i=t.enabled?t.currentFrame:void 0;let r;t.enabled&&(r=n.PerformanceTimer.now()),this.m_taskQueue.update();let a=this.taskQueue.numItemsLeft();if(null==i||i.setValue("TaskScheduler.numPendingTasks",a),this.throttlingEnabled){let l=this.spaceInFrame(e);l=l>2?l-2:l,null==i||i.setValue("TaskScheduler.estimatedAvailableTime",l);let c=0;for(;l>0&&a>0;){function h(e){var t,i;return l-=null!==(i=null===(t=e.estimatedProcessTime)||void 0===t?void 0:t.call(e))&&void 0!==i?i:2,l>0||1===c}c++,[s.TileTaskGroups.CREATE,s.TileTaskGroups.FETCH_AND_DECODE].forEach((e=>{this.m_taskQueue.numItemsLeft(e)&&this.m_taskQueue.processNext(e,h)})),a=this.m_taskQueue.numItemsLeft()}a=this.m_taskQueue.numItemsLeft(),a>0&&(null==i||i.setValue("TaskScheduler.pendingTasksNotYetProcessed",a),this.requestUpdate())}else this.m_taskQueue.processNext(s.TileTaskGroups.CREATE,void 0,this.m_taskQueue.numItemsLeft(s.TileTaskGroups.CREATE)),this.m_taskQueue.processNext(s.TileTaskGroups.FETCH_AND_DECODE,void 0,this.m_taskQueue.numItemsLeft(s.TileTaskGroups.FETCH_AND_DECODE));t.enabled&&(null==i||i.setValue("TaskScheduler.pendingTasksTime",n.PerformanceTimer.now()-r))}clearQueuedTasks(){this.m_taskQueue.clear()}spaceInFrame(e){const t=(performance||Date).now()-e;return Math.max(1e3/this.m_maxFps-t,0)}}t.MapViewTaskScheduler=l},6272:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewThemeManager=void 0;const n=i(6586);function r(e,t){return JSON.stringify(e)===JSON.stringify(t)}t.MapViewThemeManager=class{constructor(e,t,i,n){this.m_mapView=e,this.m_theme=t,this.m_imageRepo=i,this.m_uriResolver=n,this.m_isUpdating=!1,this.m_cachedCompleteTheme={},this.m_abortController=new AbortController,this.m_completeThemePromise=this.setTheme(this.m_theme)}setTheme(e,t){var i;return this.m_abortController.abort("Abort an ongoing setTheme call due to a new setTheme call"),this.m_abortController=new AbortController,this.m_isUpdating=!0,this.m_completeThemePromise=this.loadTheme(e,t,null===(i=this.m_abortController)||void 0===i?void 0:i.signal).then((e=>{var t;return this.updateTheme(e,null===(t=this.m_abortController)||void 0===t?void 0:t.signal)})).finally((()=>{this.m_isUpdating=!1})),this.m_completeThemePromise}getTheme(){return this.m_completeThemePromise}isUpdating(){return this.m_isUpdating}loadTheme(e,t,i){return"string"!=typeof e&&n.isThemeLoaded(e)?Promise.resolve(e):n.load(e,{baseUrl:t,uriResolver:this.m_uriResolver,signal:i})}async updateTheme(e,t){var i,n;const s=this.m_mapView.sceneEnvironment;if(this.m_cachedCompleteTheme.clearAlpha===e.clearAlpha&&this.m_cachedCompleteTheme.clearColor===e.clearColor||(this.m_cachedCompleteTheme.clearColor=e.clearColor,this.m_cachedCompleteTheme.clearAlpha=e.clearAlpha,s.updateClearColor(e.clearColor,e.clearAlpha,e.definitions)),r(this.m_cachedCompleteTheme.sky,e.sky)||(this.m_cachedCompleteTheme.sky=e.sky,s.updateSkyBackground(e.sky)),r(this.m_cachedCompleteTheme.fog,e.fog)||(this.m_cachedCompleteTheme.fog=e.fog,s.fog.reset(e.fog)),r(this.m_cachedCompleteTheme.lights,e.lights)||(this.m_cachedCompleteTheme.lights=e.lights,s.updateLighting(e.lights)),!r(this.m_cachedCompleteTheme.images,e.images)||!r(this.m_cachedCompleteTheme.imageTextures,e.imageTextures))try{await this.updateImages(e.images,e.imageTextures,t),this.m_cachedCompleteTheme.images=e.images,this.m_cachedCompleteTheme.imageTextures=e.imageTextures}catch(e){throw this.m_cachedCompleteTheme.images=void 0,this.m_cachedCompleteTheme.imageTextures=void 0,e}if(!r(this.m_cachedCompleteTheme.textStyles,e.textStyles)||!r(this.m_cachedCompleteTheme.defaultTextStyle,e.defaultTextStyle)||!r(this.m_cachedCompleteTheme.fontCatalogs,e.fontCatalogs))try{await this.m_mapView.iconTextRenderer.setTheme(e,t),this.m_cachedCompleteTheme.textStyles=e.textStyles,this.m_cachedCompleteTheme.defaultTextStyle=e.defaultTextStyle,this.m_cachedCompleteTheme.fontCatalogs=e.fontCatalogs}catch(e){throw this.m_cachedCompleteTheme.textStyles=void 0,this.m_cachedCompleteTheme.defaultTextStyle=void 0,this.m_cachedCompleteTheme.fontCatalogs=void 0,e}Array.isArray(e.priorities)&&(this.m_cachedCompleteTheme.priorities=e.priorities,this.m_mapView.mapAnchors.setPriorities(null!==(i=e.priorities)&&void 0!==i?i:[])),Array.isArray(e.labelPriorities)&&(this.m_cachedCompleteTheme.labelPriorities=e.labelPriorities),this.m_cachedCompleteTheme.styles=null!==(n=e.styles)&&void 0!==n?n:[],this.m_cachedCompleteTheme.definitions=e.definitions,this.m_cachedCompleteTheme.features=e.features;for(const e of this.m_mapView.dataSources)await e.setTheme(this.m_cachedCompleteTheme);return this.m_cachedCompleteTheme}async updateImages(e,t,i){if(this.m_imageRepo.iconTextManager.clear(),this.m_imageRepo.imageCache.clear(this),this.m_mapView.textureCache.evictAll(),e){for(const{url:t,atlas:n,preload:r,scalable:s=!1}of Object.values(e)){const e=this.m_imageRepo.imageCache.registerImageByUrl(this,t,void 0,s);r&&e.loadImage(),"string"==typeof n&&await this.m_imageRepo.iconTextManager.addTextureAtlas(t,n,i)}null==t||t.forEach((t=>{var i,n;const r=null!==(n=null===(i=e[t.image])||void 0===i?void 0:i.url)&&void 0!==n?n:t.image;this.m_imageRepo.iconTextManager.addImageTexture(Object.assign(Object.assign({},t),{image:r}))}))}}}},9701:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PathBlockingElement=void 0;const n=i(82);t.PathBlockingElement=class{constructor(e){this.points=e,this.screenSpaceLines=new Array(e.length>=2?e.length-1:0);for(let e=0;e<this.screenSpaceLines.length;e++)this.screenSpaceLines[e]=new n.Line3(new n.Vector3,new n.Vector3)}}},8881:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickHandler=t.PickObjectType=void 0;const n=i(82),r=i(8152),s=i(2616),o=i(5146),a=i(6946),l=i(7979),c=i(541);var h;!function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.Area=3]="Area",e[e.Text=4]="Text",e[e.Icon=5]="Icon",e[e.Object3D=6]="Object3D"}(h=t.PickObjectType||(t.PickObjectType={}));const u=new n.Vector3,d=new s.OrientedBox3;function m(e,t,i,n,r){for(const s of e.dependencies){const o=s.mortonCode();if(n.has(o))continue;n.add(o);const a=r.visibleTileSet.getCachedTile(e.dataSource,s,e.offset,r.frameNumber);void 0!==a&&i.intersectObjects(a.objects,!0,t)}}t.PickHandler=class{constructor(e,t,i=!1){this.mapView=e,this.camera=t,this.enablePickTechnique=i,this.m_pickingRaycaster=new a.PickingRaycaster(e.renderer.getSize(new n.Vector2))}intersectMapObjects(e,t,i){const r=this.mapView.getNormalizedScreenCoordinates(e,t),s=this.setupRaycaster(e,t),o=new l.PickListener(i),{clientWidth:a,clientHeight:c}=this.mapView.canvas,u=r.x*a*.5,d=r.y*c*.5,p=new n.Vector2(u,d);this.mapView.iconTextRenderer.pickIconTexts(p,((e,t)=>{const i={type:t?h.Text:h.Icon,point:p,distance:0,renderOrder:e.renderOrder,featureId:e.featureId,userData:e.userData,dataSourceName:e.dataSourceName,dataSourceOrder:e.dataSourceOrder};i.technique=this.enablePickTechnique?e.technique:void 0,o.addResult(i)}));const f=[],g=this.getIntersectedTiles(s),v=new Set;for(const{tile:e,distance:t}of g){if(o.done&&o.furthestResult.distance<t)break;f.length=0,s.intersectObjects(e.objects,!0,f),m(e,f,s,v,this.mapView);for(const t of f)o.addResult(this.createResult(t,e))}f.length=0;for(const e of this.mapView.mapAnchors.children){s.intersectObject(e,!0,f);for(const e of f)o.addResult(this.createResult(e))}return o.finish(),o.results}raycasterFromScreenPoint(e,t){return this.m_pickingRaycaster.setFromCamera(this.mapView.getNormalizedScreenCoordinates(e,t),this.camera),this.mapView.renderer.getSize(this.m_pickingRaycaster.canvasSize),this.m_pickingRaycaster}createResult(e,t){var i,n,s;const o={type:h.Unspecified,point:e.point,distance:e.distance,dataSourceName:null===(i=e.object.userData)||void 0===i?void 0:i.dataSource,dataSourceOrder:null===(n=null==t?void 0:t.dataSource)||void 0===n?void 0:n.dataSourceOrder,intersection:e,tileKey:null==t?void 0:t.tileKey};if(void 0===e.object.userData||void 0===e.object.userData.feature)return o;this.enablePickTechnique&&(o.technique=e.object.userData.technique),o.renderOrder=null===(s=e.object)||void 0===s?void 0:s.renderOrder;const a=e.object.userData.feature;if(this.addObjInfo(a,e,o),o.userData){const e=(0,r.getFeatureId)(o.userData);o.featureId=0===e?void 0:e}let l;switch(a.geometryType){case r.GeometryType.Point:case r.GeometryType.Text:l=h.Point;break;case r.GeometryType.Line:case r.GeometryType.ExtrudedLine:case r.GeometryType.SolidLine:case r.GeometryType.TextPath:l=h.Line;break;case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:l=h.Area;break;case r.GeometryType.Object3D:l=h.Object3D;break;default:l=h.Unspecified}return o.type=l,o}getIntersectedTiles(e){const t=new Array;return this.mapView.visibleTileSet.dataSourceTileList.forEach((i=>{i.dataSource.enablePicking&&i.renderedTiles.forEach((i=>{d.copy(i.boundingBox),d.position.sub(this.mapView.worldCenter);const n=i.computeWorldOffsetX();d.position.x+=n;const r=d.intersectsRay(e.ray);void 0!==r&&t.push({tile:i,distance:r})}))})),t.sort(((e,t)=>e.distance-t.distance)),t}addObjInfo(e,t,i){if(void 0===e.objInfos)return;if(i.intersection.object instanceof o.MapViewPoints)return void(i.userData=e.objInfos[t.index]);if(void 0===e.starts||0===e.starts.length||"number"!=typeof t.faceIndex&&void 0===t.index)return void(1===e.objInfos.length&&(i.userData=e.objInfos[0]));if(1===e.starts.length)return void(i.userData=e.objInfos[0]);const n="number"==typeof t.faceIndex?3*t.faceIndex:t.index;let r=0;for(const t of e.starts){if(t>n)break;r++}i.userData=e.objInfos[r-1]}setupRaycaster(e,t){const i=this.mapView.camera,n=this.raycasterFromScreenPoint(e,t),r=this.mapView.getWorldPositionAt(e,t,!0),s=i.position.distanceTo(r)/this.mapView.camera.getWorldDirection(u).dot(n.ray.direction);return n.params.Line.threshold=c.MapViewUtils.calculateWorldSizeByFocalLength(this.mapView.focalLength,s,1),n}}},7979:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickListener=void 0;const n=i(4342);function r(e,t){var i,n;const r=null!==(i=e.dataSourceOrder)&&void 0!==i?i:0,s=null!==(n=t.dataSourceOrder)&&void 0!==n?n:0;if(r!==s)return s-r;const o=e.distance-t.distance,a=void 0!==e.renderOrder&&void 0!==t.renderOrder;return Math.abs(o)>1e-4||!a?o:t.renderOrder-e.renderOrder}t.PickListener=class{constructor(e){this.m_parameters=e,this.m_results=[],this.m_sorted=!0,this.m_finished=!0}addResult(e){var t;const i=(null===(t=this.m_parameters)||void 0===t?void 0:t.allowDuplicates)?-1:this.m_results.findIndex((t=>{var i,n,r,s;let o=!1;if(t.type===e.type){const a=null===(n=null===(i=e.intersection)||void 0===i?void 0:i.object.userData)||void 0===n?void 0:n.dataSource;a&&(null===(s=null===(r=t.intersection)||void 0===r?void 0:r.object.userData)||void 0===s?void 0:s.dataSource)===a&&(void 0===e.featureId?void 0===t.featureId&&e.userData&&t.userData===e.userData&&(o=!0):t.featureId===e.featureId&&(o=!0))}return o}));if(i<0)this.m_sorted=!1,this.m_finished=!1,this.m_results.push(e);else{const t=this.m_results[i];r(e,t)<0&&(this.m_results[i]=e,this.m_sorted=!1,this.m_finished=!1)}}get done(){return!!this.maxResults&&this.m_results.length>=this.maxResults}finish(){this.sortResults(),this.maxResults&&this.m_results.length>this.maxResults&&(this.m_results.length=this.maxResults),this.m_finished=!0}get results(){return(0,n.assert)(this.m_finished,"finish() was not called before getting the results"),this.m_results}get closestResult(){return this.sortResults(),this.m_results.length>0?this.m_results[0]:void 0}get furthestResult(){return this.sortResults(),this.m_results.length>0?this.m_results[this.m_results.length-1]:void 0}get maxResults(){var e,t;const i=null!==(t=null===(e=this.m_parameters)||void 0===e?void 0:e.maxResultCount)&&void 0!==t?t:0;return i>0?i:void 0}sortResults(){if(this.m_sorted)return;const e=[],t=[];this.m_results.sort(r).forEach((i=>(0===i.distance?e:t).push(i))),this.m_results=e.concat(t),this.m_sorted=!0}}},6946:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickingRaycaster=void 0;const n=i(82),r=i(4572);function s(e,t,i,n){if(e.layers.test(t.layers)&&e.visible){const n=r.MapObjectAdapter.get(e);n&&!n.isPickable()||e.raycast(t,i)}if(!0===n)for(const n of e.children)s(n,t,i,!0)}class o extends n.Raycaster{constructor(e){super(),this.canvasSize=e}intersectObject(e,t,i){const n=null!=i?i:[];return s(e,this,n,t),n}intersectObjects(e,t,i){const n=null!=i?i:[];for(const i of e)s(i,this,n,t);return n}}t.PickingRaycaster=o},6313:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaneViewBounds=void 0;const n=i(82),r=i(2616),s=i(4342),o=i(541);t.PlaneViewBounds=class{constructor(e,t,i){this.camera=e,this.projection=t,this.m_options=i,this.m_groundPlaneNormal=new n.Vector3(0,0,1),this.m_groundPlane=new n.Plane(this.m_groundPlaneNormal.clone()),(0,s.assert)(t.type===r.ProjectionType.Planar)}generate(){const e=[];if(this.addCanvasCornerIntersection(e),4===e.length)return this.createPolygon(e);this.addHorizonIntersection(e);const t=(new n.Frustum).setFromProjectionMatrix((new n.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse)),i=this.getWorldConers(this.projection);if(this.m_options.tileWrappingEnabled||[i.ne,i.nw,i.se,i.sw].forEach((i=>{this.addPointInFrustum(i,t,e)})),this.m_options.tileWrappingEnabled){const r=(new n.Vector3).subVectors(i.sw,i.se).normalize(),s=(new n.Vector3).subVectors(i.se,i.sw).normalize();[new n.Ray(i.se,r),new n.Ray(i.se,s),new n.Ray(i.ne,r),new n.Ray(i.ne,s)].forEach((i=>{this.addFrustumIntersection(i,t,e)}))}else[new n.Line3(i.sw,i.se),new n.Line3(i.ne,i.nw),new n.Line3(i.se,i.ne),new n.Line3(i.nw,i.sw)].forEach((i=>{this.addFrustumIntersection(i,t,e)}));return this.createPolygon(e)}createPolygon(e){if(e.length>2)return new r.GeoPolygon(e,!0)}getWorldConers(e){const t=e.worldExtent(0,0);return{sw:t.min,se:new n.Vector3(t.max.x,t.min.y,0),nw:new n.Vector3(t.min.x,t.max.y,0),ne:t.max}}addNDCRayIntersection(e,t){e.forEach((e=>{const i=o.MapViewUtils.rayCastWorldCoordinates({camera:this.camera,projection:this.projection},e[0],e[1]);i&&this.validateAndAddToGeoPolygon(i,t)}))}addHorizonIntersection(e){const t=this.getVerticalHorizonPositionInNDC();t&&this.addNDCRayIntersection([[-1,t],[1,t]],e)}addCanvasCornerIntersection(e){this.addNDCRayIntersection([[-1,-1],[1,-1],[1,1],[-1,1]],e)}validateAndAddToGeoPolygon(e,t){this.isInVisibleMap(e)&&t.push(this.projection.unprojectPoint(e))}isInVisibleMap(e){return!(e.y<0||e.y>r.EarthConstants.EQUATORIAL_CIRCUMFERENCE||!this.m_options.tileWrappingEnabled&&(e.x<0||e.x>r.EarthConstants.EQUATORIAL_CIRCUMFERENCE))}addPointInFrustum(e,t,i){if(t.containsPoint(e)){const t=this.projection.unprojectPoint(e);t.altitude=0,i.push(t)}}addFrustumIntersection(e,t,i){t.planes.forEach((t=>{let r=null;const s=new n.Vector3;if(e instanceof n.Ray&&e.intersectsPlane(t)?r=e.intersectPlane(t,s):e instanceof n.Line3&&t.intersectsLine(e)&&(r=t.intersectLine(e,s)),r&&o.MapViewUtils.closeToFrustum(r,this.camera)){const e=this.projection.unprojectPoint(r);e.altitude=0,i.push(e)}}))}getVerticalHorizonPositionInNDC(){const e=new n.Vector3(-1,-1,1).unproject(this.camera).add(new n.Vector3(1,-1,1).unproject(this.camera)).multiplyScalar(.5),t=new n.Vector3(-1,1,1).unproject(this.camera).add(new n.Vector3(1,1,1).unproject(this.camera)).multiplyScalar(.5),i=new n.Line3(e,t),r=new n.Vector3;if(this.m_groundPlane.intersectLine(i,r))return r.project(this.camera).y}}},5187:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolarTileDataSource=void 0;const n=i(82),r=i(7769),s=i(2616),o=i(1984),a=i(4303),l=i(8427),c=i(4572),h=i(6586),u=i(1447);class d extends a.DataSource{constructor({name:e="polar",styleSetNames:t=["northpole","southpole"],minDataLevel:i,maxDataLevel:r,minDisplayLevel:o,maxDisplayLevel:a,storageLevelOffset:l=-2,geometryLevelOffset:c=1,debugTiles:h=!1}){super({name:e,styleSetNames:t,minDataLevel:i,maxDataLevel:r,minDisplayLevel:o,maxDisplayLevel:a,storageLevelOffset:l}),this.m_tilingScheme=s.polarTilingScheme,this.m_maxLatitude=n.MathUtils.radToDeg(s.MercatorConstants.MAXIMUM_LATITUDE),this.m_geometryLevelOffset=c,this.m_debugTiles=h,this.cacheable=!1,this.enablePicking=!1}dispose(){this.m_northPoleEntry&&(this.m_northPoleEntry.material.dispose(),delete this.m_northPoleEntry),this.m_southPoleEntry&&(this.m_southPoleEntry.material.dispose(),delete this.m_southPoleEntry),this.m_styleSetEvaluator&&delete this.m_styleSetEvaluator}createTechiqueEntry(e){if(!this.m_styleSetEvaluator)return;const t=new r.MapEnv({$geometryType:"polygon",$layer:"earth",kind:e}),i=this.m_styleSetEvaluator.getMatchingTechniques(t);if(0===i.length)return;const n=i[0],s=(0,l.createMaterial)(n,this.mapView);return s?{material:s.material,technique:n}:void 0}async setTheme(e){e=await h.load(e);const t=(0,o.getStyles)(e.styles).filter((e=>{var t;return!e.styleSet||(null===(t=this.styleSetNames)||void 0===t?void 0:t.includes(e.styleSet))}));t.length>0&&(this.m_styleSetEvaluator=new r.StyleSetEvaluator({styleSet:t,definitions:e.definitions,priorities:e.priorities,labelPriorities:e.labelPriorities})),this.m_northPoleEntry=this.createTechiqueEntry("north_pole"),this.m_southPoleEntry=this.createTechiqueEntry("south_pole"),this.mapView.markTilesDirty(this)}canGetTile(e,t){if(e!==t.level||t.level<1)return!1;const{north:i,south:n}=this.m_tilingScheme.getGeoBox(t);return i>this.m_maxLatitude||n<-this.m_maxLatitude}shouldSubdivide(e,t){if(e<=t.level)return!1;const{north:i,south:n}=this.m_tilingScheme.getGeoBox(t);return i>this.m_maxLatitude||n<-this.m_maxLatitude}getTilingScheme(){return this.m_tilingScheme}getTile(e){const t=new u.Tile(this,e);return this.createTileGeometry(t),t}get geometryLevelOffset(){return this.m_geometryLevelOffset}set geometryLevelOffset(e){this.m_geometryLevelOffset=e}intersectEdge(e,t,i){const n=t.latitude,r=i.latitude;let o=t.longitude,a=i.longitude;90===Math.abs(n)&&(o=a),90===Math.abs(r)&&(a=o);const l=a-o,c=(e-n)/(r-n);return new s.GeoCoordinates(e,o+l*c,0)}createTileGeometry(e){const{north:t,south:i}=e.geoBox,r=t>0&&i>=0,o=r?this.m_northPoleEntry:this.m_southPoleEntry;if(void 0===o)return void e.forceHasGeometry(!0);const a=this.m_tilingScheme.projection,l=this.projection,h=this.m_maxLatitude,u=r?h:-h,d=this.m_tilingScheme.boundingBoxGenerator.getWorldBox(e.tileKey),m=a.unprojectPoint(new n.Vector3(d.min.x,d.min.y,0)),p=a.unprojectPoint(new n.Vector3(d.max.x,d.min.y,0)),f=a.unprojectPoint(new n.Vector3(d.max.x,d.max.y,0)),g=a.unprojectPoint(new n.Vector3(d.min.x,d.max.y,0));let v,y=!1;if(1===e.tileKey.level){const e=0===d.min.x,t=e?d.max.x:d.min.x,i=(d.max.y+d.min.y)/2,s=a.unprojectPoint(new n.Vector3(t,i,0)),o=e?m:p;v=r?e?[s,f,o,p]:[s,m,o,g]:e?[s,p,o,f]:[s,g,o,m],y=!0}else{v=r?[m,p,f,g]:[m,g,f,p];const e=v.map((e=>e.latitude)),t=Math.max(...e),i=Math.min(...e);if(r?t<u:i>u)return;if(y=r?i<u:t>u,y){const n=e.indexOf(r?t:i);if(0!==n)for(let e=0;e<n;e++)v.push(v.shift())}}if(y){const t=(d.min.x+d.max.x)/2,i=(d.min.y+d.max.y)/2,r=a.unprojectPoint(new n.Vector3(t,i,0));s.TransverseMercatorUtils.alignLongitude(v,r);const o=v[0],l=v[1],c=v[2],m=v[3],p=Math.abs(l.latitude)>=h,f=Math.abs(m.latitude)>=h,g=p?this.intersectEdge(u,l,c):this.intersectEdge(u,o,l),y=f?this.intersectEdge(u,m,c):this.intersectEdge(u,o,m);v.splice(p?2:1,4,g);const _=e.tileKey.level-this.storageLevelOffset+this.m_geometryLevelOffset,x=360/(1<<Math.max(0,_)),w=Math.floor((g.longitude+180)/x),b=Math.ceil((y.longitude+180)/x);for(let e=w+1;e<b;e++)v.push(new s.GeoCoordinates(u,e*x-180,0));v.push(y),f&&v.push(m)}const _=new n.BufferGeometry,x=v.map((t=>{const i=l.projectPoint(t,new n.Vector3);return i.sub(e.center),i}));_.setFromPoints(x);const w=[];for(let e=1;e<x.length-1;e++)r?w.push(0,e,e+1):w.push(0,e+1,e);_.setIndex(w);const b=new n.Mesh(_,o.material);if(b.userData={dataSource:this.name,tileKey:e.tileKey},this.m_debugTiles){const t=Math.round(16777215*Math.abs(Math.sin(11*e.tileKey.mortonCode())));b.material=new n.MeshBasicMaterial({color:t,transparent:!0,opacity:.5}),e.objects.push(new n.Mesh(_,new n.MeshBasicMaterial({color:t,wireframe:!0})))}c.MapObjectAdapter.create(b,{dataSource:this,technique:o.technique}),e.objects.push(b)}}t.PolarTileDataSource=d},7362:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenCollisionsDebug=t.ScreenCollisions=t.isLineWithBound=t.DetailedCollisionBox=t.CollisionBox=void 0;const n=i(82),r=i(4342),s=i(507),o=i(1102),a=r.LoggerManager.instance.create("ScreenCollissions");class l extends r.Math2D.Box{constructor(e){super(),void 0!==e&&this.copy(e)}copy(e){return e instanceof r.Math2D.Box?this.set(e.x,e.y,e.w,e.h):e instanceof n.Box2?this.set(e.min.x,e.min.y,e.max.x-e.min.x,e.max.y-e.min.y):this.set(e.minX,e.minY,e.maxX-e.minX,e.maxY-e.minY),this}get minX(){return this.x}set minX(e){this.x=e}get maxX(){return this.x+this.w}set maxX(e){this.w=e-this.x}get minY(){return this.y}set minY(e){this.y=e}get maxY(){return this.y+this.h}set maxY(e){this.h=e-this.y}}t.CollisionBox=l;class c extends l{constructor(e,t){super(e),this.detailBoxes=t}}function h(e){return void 0!==e.line}t.DetailedCollisionBox=c,t.isLineWithBound=h;const u=new l;class d{constructor(){this.screenBounds=new r.Math2D.Box,this.rtree=new o}reset(){this.rtree.clear()}update(e,t){this.screenBounds.set(e/-2,t/-2,e,t),this.reset()}allocate(e){const t=e instanceof l?e:new l(e);this.rtree.insert(t)}allocateIBoxes(e){this.rtree.load(e)}search(e){return this.rtree.search(e)}isAllocated(e){const t=e instanceof l?e:u.copy(e),i=this.search(t);return this.intersectsDetails(t,i)}isVisible(e){return this.screenBounds.intersects(e)}isFullyVisible(e){return this.screenBounds.containsBox(e)}intersectsDetails(e,t){for(const i of t)if(i instanceof c){for(const t of i.detailBoxes)if(t.intersects(e))return!0}else{if(!h(i))return!0;{const t=i;if(this.intersectsLine(e,t))return!0}}return!1}intersectsLine(e,t){const i=t.line,n=i.end.x-i.start.x;let r,s,o,a;if(0!==n){const t=i.end.y-i.start.y,l=t,c=-n,h=i.start.y-t/n*i.start.x;r=Math.sign(e.minX*l+(e.minY-h)*c),s=Math.sign(e.maxX*l+(e.minY-h)*c),o=Math.sign(e.minX*l+(e.maxY-h)*c),a=Math.sign(e.maxX*l+(e.maxY-h)*c)}else r=Math.sign(e.minX-i.start.x),s=Math.sign(e.maxX-i.start.x),o=Math.sign(e.minX-i.start.x),a=Math.sign(e.maxX-i.start.x);return r!==s||r!==o||r!==a}}t.ScreenCollisions=d,t.ScreenCollisionsDebug=class extends d{constructor(e){super(),this.m_renderContext=null,this.m_renderingEnabled=!1,this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0,null!=e&&(this.m_renderContext=e.getContext("2d"))}reset(){super.reset(),this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0}update(e,t){this.m_renderingEnabled&&a.log(`Allocations: ${this.m_numAllocations} Successful Tests: ${this.m_numSuccessfulTests} Failed Tests: ${this.m_numFailedTests}  Successful Visibility Tests: ${this.m_numSuccessfulVisibilityTests}  Failed Visibility Tests: ${this.m_numFailedVisibilityTests} `),super.update(e,t),null!==this.m_renderContext&&(this.m_renderContext.canvas.width=e,this.m_renderContext.canvas.height=t),this.m_renderingEnabled=s.debugContext.getValue("DEBUG_SCREEN_COLLISIONS")}allocate(e){super.allocate(e),this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#6666ff",this.m_renderContext.strokeRect(e.x-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-e.y,e.w,-e.h))}allocateIBoxes(e){for(const t of e)this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#aa2222",this.m_renderContext.strokeRect(t.minX-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-t.minY,t.maxX-t.minX,-(t.maxY-t.minY)));super.allocateIBoxes(e)}intersectsDetails(e,t){const i=super.intersectsDetails(e,t);if(this.m_renderingEnabled&&null!==this.m_renderContext){const t=i?2:1;this.m_renderContext.strokeStyle=i?"#FF0000":"#00ff00",this.m_renderContext.strokeRect(e.x-this.screenBounds.x-t,this.screenBounds.y+this.screenBounds.h-e.y+t,e.w+2*t,-e.h-2*t)}return i?this.m_numFailedTests++:this.m_numSuccessfulTests++,i}isVisible(e){const t=super.isVisible(e);return t?this.m_numSuccessfulVisibilityTests++:this.m_numFailedVisibilityTests++,t}}},8658:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenProjector=void 0;const n=i(82);function r(e){return e.z>-1&&e.z<1}class s{constructor(e){this.m_camera=e,this.m_width=0,this.m_height=0}get width(){return this.m_width}get height(){return this.m_height}project(e,t=new n.Vector2){const i=this.projectVector(e,s.tempV3);return this.ndcToScreen(i,t)}projectToScreen(e,t=new n.Vector2){const i=this.projectVector(e,s.tempV3);if(r(i))return this.ndcToScreen(i,t)}projectAreaToScreen(e,t,i,o=new n.Vector2){t*=2,i*=2;const a=this.projectVector(e,s.tempV3);if(r(a)&&a.x+t>=-1&&a.x-t<=1&&a.y+i>=-1&&a.y-i<=1)return this.ndcToScreen(a,o)}project3(e,t=new n.Vector3){const i=this.projectVector(e,s.tempV3);if(i.z>-1&&i.z<1)return t.set(i.x*this.m_width/2,i.y*this.m_height/2,i.z),t}projectVector(e,t){return t.set(e.x,e.y,e.z).project(this.m_camera),t}onScreen(e){return(t=this.projectVector(e,s.tempV3)).z>-1&&t.z<1&&t.x>=-1&&t.x<=1&&t.y>=-1&&t.y<=1;var t}update(e,t,i){this.m_camera=e,this.m_width=t,this.m_height=i}ndcToScreen(e,t){return t.set(e.x*this.m_width/2,e.y*this.m_height/2)}}t.ScreenProjector=s,s.tempV2=new n.Vector2,s.tempV3=new n.Vector3},7775:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyBackground=void 0;const n=i(3307),r=i(4257);t.SkyBackground=class{constructor(e,t,i){switch(this.m_sky=e,this.m_projectionType=t,this.m_sky.type){case"gradient":this.m_skyTexture=new r.SkyGradientTexture(this.m_sky,this.m_projectionType),this.updateCamera(i);break;case"cubemap":this.m_skyTexture=new n.SkyCubemapTexture(this.m_sky)}}dispose(){this.m_skyTexture.dispose()}get texture(){return this.m_skyTexture.texture}updateCamera(e){"gradient"===this.m_sky.type&&this.m_skyTexture.update(e)}updateTexture(e,t){const i=this.m_sky.type===e.type&&this.m_projectionType===t;switch(e.type){case"gradient":i?this.m_skyTexture.updateTexture(e):this.m_skyTexture=new r.SkyGradientTexture(e,t);break;case"cubemap":i?this.m_skyTexture.updateTexture(e):this.m_skyTexture=new n.SkyCubemapTexture(e)}this.m_projectionType=t,this.m_sky=e}}},3307:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyCubemapTexture=t.SkyCubemapFaceId=t.SKY_CUBEMAP_FACE_COUNT=void 0;const n=i(82),r=i(4342).LoggerManager.instance.create("SkyCubemapTexture");var s;t.SKY_CUBEMAP_FACE_COUNT=6,function(e){e[e.positiveX=0]="positiveX",e[e.negativeX=1]="negativeX",e[e.positiveY=2]="positiveY",e[e.negativeY=3]="negativeY",e[e.positiveZ=4]="positiveZ",e[e.negativeZ=5]="negativeZ"}(s=t.SkyCubemapFaceId||(t.SkyCubemapFaceId={})),t.SkyCubemapTexture=class{constructor(e){const t=this.createCubemapFaceArray(e);this.m_skybox=void 0!==t?(new n.CubeTextureLoader).load(t):new n.CubeTexture}dispose(){this.m_skybox.dispose()}get texture(){return this.m_skybox}updateTexture(e){const t=this.createCubemapFaceArray(e);void 0!==t&&(this.m_skybox=(new n.CubeTextureLoader).load(t))}createCubemapFaceArray(e){const i=[void 0,void 0,void 0,void 0,void 0,void 0];for(let n=0;n<t.SKY_CUBEMAP_FACE_COUNT;++n){const t=e[s[n]];if(void 0===t)return void r.error(`Face "${s[n]}" was not defined.`);i[n]=t}return i}}},4257:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyGradientTexture=t.DEFAULT_MONOMIAL_POWER=t.DEFAULT_TEXTURE_SIZE=void 0;const n=i(82),r=i(2616),s=i(4342);t.DEFAULT_TEXTURE_SIZE=512,t.DEFAULT_MONOMIAL_POWER=1;const o=[new n.Vector3(1,0,0),new n.Vector3(-1,0,0),new n.Vector3(0,-1,0),new n.Vector3(0,1,0),new n.Vector3(0,0,1),new n.Vector3(0,0,-1)],a=[new n.Vector3(0,0,-1),new n.Vector3(0,0,1),new n.Vector3(1,0,0),new n.Vector3(1,0,0),new n.Vector3(1,0,0),new n.Vector3(-1,0,0)],l=[new n.Vector3(0,1,0),new n.Vector3(0,1,0),new n.Vector3(0,0,1),new n.Vector3(0,0,-1),new n.Vector3(0,1,0),new n.Vector3(0,1,0)];t.SkyGradientTexture=class{constructor(e,i,s=t.DEFAULT_TEXTURE_SIZE){this.m_projectionType=i,this.m_height=s;const o=new n.Color(e.topColor),a=new n.Color(e.bottomColor),l=new n.Color(e.groundColor);this.m_width=this.m_projectionType===r.ProjectionType.Planar?1:this.m_height,this.m_faceCount=this.m_projectionType===r.ProjectionType.Planar?1:6,this.m_faces=[];for(let t=0;t<this.m_faceCount;++t){const i=new Uint8Array(3*this.m_width*this.m_height);this.fillTextureData(i,t,o,a,l,e.monomialPower);const r=new n.DataTexture(i,this.m_width,this.m_height,n.RGBFormat);r.needsUpdate=!0,r.unpackAlignment=1,this.m_faces.push(r)}this.m_projectionType===r.ProjectionType.Spherical?(this.m_skybox=new n.CubeTexture(this.m_faces),this.m_skybox.needsUpdate=!0):(this.m_farClipPlaneDividedVertically=new n.Line3,this.m_groundPlane=new n.Plane(new n.Vector3(0,0,1)),this.m_bottomMidFarPoint=new n.Vector3,this.m_topMidFarPoint=new n.Vector3,this.m_horizonPosition=new n.Vector3,this.m_farClipPlaneCorners=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3])}dispose(){for(let e=0;e<this.m_faceCount;++e)this.m_faces[e].dispose();this.m_projectionType===r.ProjectionType.Spherical&&this.m_skybox.dispose()}get texture(){return this.m_projectionType===r.ProjectionType.Planar?this.m_faces[0]:this.m_skybox}update(e){this.m_projectionType===r.ProjectionType.Planar&&(this.setHorizonPosition(e),this.updateTexturePosition())}updateTexture(e){for(let t=0;t<this.m_faceCount;++t)this.fillTextureData(this.m_faces[t].image.data,t,new n.Color(e.topColor),new n.Color(e.bottomColor),new n.Color(e.groundColor),e.monomialPower),this.m_faces[t].needsUpdate=!0;this.m_projectionType===r.ProjectionType.Spherical&&(this.m_skybox.needsUpdate=!0)}fillTextureData(e,i,c,h,u,d){const m=new n.Color,p=new n.Vector3,f=new n.Vector3,g=new n.Vector3,v=new n.Vector3(0,0,1);for(let n=0;n<this.m_height;++n)for(let y=0;y<this.m_width;++y){if(this.m_projectionType===r.ProjectionType.Spherical){const e=f.copy(a[i]).multiplyScalar((y+.5)/this.m_width*2-1),r=g.copy(l[i]).multiplyScalar((n+.5)/this.m_height*2-1);p.copy(o[i]).add(e).add(r).normalize();const _=Math.max(v.dot(p),0);m.copy(u).lerp(h,Math.min(100*_,1)).lerp(c,_**(0,s.getOptionValue)(d,t.DEFAULT_MONOMIAL_POWER)).multiplyScalar(255)}else{const e=n/this.m_height;0===n?m.copy(u).multiplyScalar(255):m.copy(h).lerp(c,e**(0,s.getOptionValue)(d,t.DEFAULT_MONOMIAL_POWER)).multiplyScalar(255)}e[n*this.m_width*3+3*y]=m.r,e[n*this.m_width*3+3*y+1]=m.g,e[n*this.m_width*3+3*y+2]=m.b}}setHorizonPosition(e){this.m_farClipPlaneCorners[0].set(-1,-1,1).unproject(e),this.m_farClipPlaneCorners[1].set(1,-1,1).unproject(e),this.m_farClipPlaneCorners[2].set(-1,1,1).unproject(e),this.m_farClipPlaneCorners[3].set(1,1,1).unproject(e),this.m_bottomMidFarPoint.copy(this.m_farClipPlaneCorners[0]).add(this.m_farClipPlaneCorners[1]).multiplyScalar(.5),this.m_topMidFarPoint.copy(this.m_farClipPlaneCorners[2]).add(this.m_farClipPlaneCorners[3]).multiplyScalar(.5),this.m_farClipPlaneDividedVertically.set(this.m_bottomMidFarPoint,this.m_topMidFarPoint),this.m_groundPlane.intersectLine(this.m_farClipPlaneDividedVertically,this.m_horizonPosition)||this.m_horizonPosition.set(0,0,0)}updateTexturePosition(){const e=this.m_bottomMidFarPoint.distanceTo(this.m_horizonPosition)/this.m_farClipPlaneDividedVertically.distance(),t=0===this.m_horizonPosition.length()?1:e-2/this.m_height;this.m_faces[0].offset.set(0,this.m_bottomMidFarPoint.z<=0?-t:e)}}},3228:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphereHorizon=t.previousCanvasSide=t.nextCanvasSide=t.CanvasSide=void 0;const n=i(82),r=i(2616),s=i(4342),o=i(4442),a=i(541),l=2*Math.PI;var c;function h(e){return(e+1)%4}!function(e){e[e.Bottom=0]="Bottom",e[e.Right=1]="Right",e[e.Top=2]="Top",e[e.Left=3]="Left"}(c=t.CanvasSide||(t.CanvasSide={})),t.nextCanvasSide=h,t.previousCanvasSide=function(e){return(e+3)%4},t.SphereHorizon=class{constructor(e,t){this.m_camera=e,this.m_cornerIntersects=t,this.m_intersections=[],this.m_isFullyVisible=!0;const i=r.EarthConstants.EQUATORIAL_RADIUS*r.EarthConstants.EQUATORIAL_RADIUS,s=(new n.Vector3).setFromMatrixColumn(e.matrixWorld,0).normalize(),o=e.position.clone().normalize(),l=(new n.Vector3).crossVectors(o,s),c=e.position.length();this.m_normalToTangentAngle=Math.asin(r.EarthConstants.EQUATORIAL_RADIUS/c);const h=Math.sqrt(c*c-i);this.m_distanceToHorizonCenter=h*Math.cos(this.m_normalToTangentAngle);const u=c-this.m_distanceToHorizonCenter;this.m_radius=Math.sqrt(i-u*u),this.m_cameraPitch=a.MapViewUtils.extractAttitude({projection:r.sphereProjection},this.m_camera).pitch;const d=(new n.Vector3).copy(o).setLength(u);this.m_matrix=(new n.Matrix4).makeBasis(s,l,o).setPosition(d),this.computeIntersections()}getPoint(e,t=0,i=1,r=new n.Vector3){const s=t*l,o=s+e*((i>=t?i*l:(i+1)*l)-s);return r.set(this.m_radius*Math.cos(o),this.m_radius*Math.sin(o),0),r.applyMatrix4(this.m_matrix),r}getDivisionPoints(e,t=0,i=1,n=10){const r=Math.max(Math.ceil(((i<t?1+i:i)-t)*n),1);for(let n=0;n<r;n++)e(this.getPoint(n/r,t,i))}get isFullyVisible(){return this.m_isFullyVisible}getSideIntersections(e){return this.m_intersections[e]}isTangentVisible(e){switch(e){case c.Top:{const e=this.m_normalToTangentAngle-this.m_cameraPitch;return o.CameraUtils.getTopFov(this.m_camera)>=Math.abs(e)}case c.Bottom:{const e=this.m_normalToTangentAngle+this.m_cameraPitch;return o.CameraUtils.getBottomFov(this.m_camera)>=Math.abs(e)}case c.Left:{const e=this.m_normalToTangentAngle;return o.CameraUtils.getLeftFov(this.m_camera)>=Math.abs(e)&&this.m_cameraPitch<=o.CameraUtils.getBottomFov(this.m_camera)}case c.Right:{const e=this.m_normalToTangentAngle;return o.CameraUtils.getRightFov(this.m_camera)>=Math.abs(e)&&this.m_cameraPitch<=o.CameraUtils.getBottomFov(this.m_camera)}}}getTangentOnSide(e){switch(e){case c.Bottom:return.75;case c.Right:return 0;case c.Top:return.25;case c.Left:return.5}}computeIntersections(){const e=this.m_distanceToHorizonCenter*Math.tan(this.m_cameraPitch-o.CameraUtils.getBottomFov(this.m_camera));let t,i;for(let n=c.Bottom;n<4;n++){if(this.isTangentVisible(n)){this.m_intersections.push([this.getTangentOnSide(n)]);continue}const r=new Array;switch(this.m_isFullyVisible=!1,n){case c.Bottom:r.push(...this.computeTBIntersections(e));break;case c.Right:{const n=o.CameraUtils.getRightFov(this.m_camera),s=this.computeLRIntersections(e,n);s&&([t,i]=s,r.push(void 0!==i?1+i:void 0,t));break}case c.Top:{const e=this.m_distanceToHorizonCenter*Math.tan(this.m_cameraPitch+o.CameraUtils.getTopFov(this.m_camera));r.push(...this.computeTBIntersections(e).reverse());break}case c.Left:{const n=o.CameraUtils.getLeftFov(this.m_camera);if(n===o.CameraUtils.getRightFov(this.m_camera))r.push(void 0!==t?.5-t:void 0,void 0!==i?.5-i:void 0);else{const t=this.computeLRIntersections(e,n);t&&r.push(.5-t[0],void 0!==t[1]?.5-t[1]:void 0)}break}}const s=[this.m_cornerIntersects[n],this.m_cornerIntersects[h(n)]];this.m_intersections.push(r.filter(((e,t)=>void 0!==e&&!s[t])))}}computeTBIntersections(e){const t=this.m_radius*this.m_radius,i=Math.sqrt(t-e*e),n=Math.atan2(e,i)/l;return[.5-n,n>0?n:1+n]}computeLRIntersections(e,t){const i=this.m_distanceToHorizonCenter/Math.cos(this.m_cameraPitch),n=this.m_distanceToHorizonCenter*Math.tan(this.m_cameraPitch),r=i*Math.tan(t),a=o.CameraUtils.getBottomFov(this.m_camera),c=r*(this.m_distanceToHorizonCenter*Math.cos(a)/Math.cos(this.m_cameraPitch-a))/i,h=s.Math2D.intersectLineAndCircle(c,e,r,n,this.m_radius);if(!h)return;const u=h.y1;return[Math.atan2(u,h.x1)/l,-u>=e&&void 0!==h.x2?Math.atan2(h.y2,h.x2)/l:void 0]}}},7284:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphereViewBounds=t.computeEdgeDivisions=void 0;const n=i(82),r=i(2616),s=i(4342),o=i(3228),a=i(541);function l(e,t){const i=Math.abs(t.latitude-e.latitude),n=e.minLongitudeSpanTo(t);return Math.ceil(Math.max(i/20,n/5))}t.computeEdgeDivisions=l;const c=[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}];t.SphereViewBounds=class{constructor(e,t){this.camera=e,this.projection=t,(0,s.assert)(t.type===r.ProjectionType.Spherical)}generate(){const e=this.findBoundsIntersections();return this.wrapAroundPoles(e),e.length>2?new r.GeoPolygon(e,!1,!0):void 0}addSideSegmentSubdivisions(e,t,i,r,s){e.push(r);const o=l(r,s);if(o<=1)return;const c=new n.Vector2(i.x-t.x,i.y-t.y).multiplyScalar(1/o),h=new n.Vector2(t.x,t.y);for(let t=0;t<o-1;t++){h.add(c);const t=a.MapViewUtils.rayCastWorldCoordinates({camera:this.camera,projection:this.projection},h.x,h.y);t&&e.push(this.projection.unprojectPoint(t))}}addSideIntersections(e,t,i,n,r){const a=c[t],l=c[(0,o.nextCanvasSide)(t)];if(i&&n)return void this.addSideSegmentSubdivisions(e,a,l,i,n);if(!r)return;const h=r.getSideIntersections(t);if(0!==h.length){if(i){const t=r.getPoint(h[h.length-1]),n=this.projection.unprojectPoint(t);this.addSideSegmentSubdivisions(e,a,t.project(this.camera),i,n)}else{const i=(0,o.previousCanvasSide)(t);let n=r.getSideIntersections(i);0===n.length&&(n=r.getSideIntersections((0,o.previousCanvasSide)(i))),(0,s.assert)(n.length>0),r.getDivisionPoints((t=>{e.push(this.projection.unprojectPoint(t))}),n[n.length-1],h[0])}if(h.length>1){const t=r.getPoint(h[0]),i=r.getPoint(h[1]),n=this.projection.unprojectPoint(t),s=this.projection.unprojectPoint(i);this.addSideSegmentSubdivisions(e,t.project(this.camera),i.project(this.camera),n,s)}if(n){const t=r.getPoint(h[0]),i=this.projection.unprojectPoint(t);this.addSideSegmentSubdivisions(e,t.project(this.camera),l,i,n)}}}findBoundsIntersections(){const e=[],[t,i]=this.addCanvasCornerIntersection(),n=i<4?new o.SphereHorizon(this.camera,t.map((e=>void 0!==e))):void 0;if(0===i&&n.isFullyVisible)return n.getDivisionPoints((t=>{e.push(this.projection.unprojectPoint(t))})),e;for(let i=o.CanvasSide.Bottom;i<4;i++){const r=t[i],s=t[(0,o.nextCanvasSide)(i)];this.addSideIntersections(e,i,r,s,n)}return e}wrapAroundPoles(e){const t=new n.Vector3(0,0,r.EarthConstants.EQUATORIAL_RADIUS),i=new n.Vector3(0,0,-r.EarthConstants.EQUATORIAL_RADIUS),s=a.MapViewUtils.closeToFrustum(t,this.camera),o=a.MapViewUtils.closeToFrustum(i,this.camera);if(!s&&!o)return;const l=this.projection.unprojectPoint(this.camera.position).lng,c=s?90:-90,h=s?l+180:l-180,u=new r.GeoCoordinates(c,h),d=u.normalized(),m=d.lng;let p=e[e.length-1].lng,f=!1;const g=e.findIndex((e=>{const t=(0,r.isAntimeridianCrossing)(p,e.lng);return Math.sign(m-e.lng)===Math.sign(m-p)===t?(f=t,!0):(p=e.lng,!1)}));if(g<0)return;const v=s?90:-90,y=s?1e-5:-1e-5,_=new r.GeoCoordinates(c,l+v).normalized(),x=new r.GeoCoordinates(c,l).normalized(),w=new r.GeoCoordinates(c,l-v).normalized(),b=new r.GeoCoordinates(c,h+y).normalized(),T=e[(g+e.length-1)%e.length],M=e[g];let S=r.GeoCoordinates.lerp(T,M,.01,f);f&&s?S.longitude-=360:S=S.normalized(),e.splice(g,0,h<-180?u:d,_,x,w,b,S)}addCanvasCornerIntersection(){const e=new Array;let t=0;return c.forEach((i=>{const n=a.MapViewUtils.rayCastWorldCoordinates({camera:this.camera,projection:this.projection},i.x,i.y);n?(e.push(this.projection.unprojectPoint(n)),++t):e.push(void 0)})),[e,t]}}},8015:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceStatistics=t.FrameStatsArray=t.FrameStats=t.Statistics=t.MultiStageTimer=t.computeArrayAverage=t.computeArrayStats=t.SampledTimer=t.SimpleTimer=t.RingBuffer=void 0;const n=i(4342),r=n.LoggerManager.instance.create("Statistics");class s{constructor(e){this.capacity=e,this.buffer=new Array(e),this.capacity=e,this.head=this.tail=this.size=0}clear(){this.head=this.tail=this.size=0}enqOne(e){let t=this.head+1;t>=this.capacity&&(t=0),this.size<this.capacity&&this.size++,this.buffer[this.head]=e,this.head=t,this.size===this.capacity&&(this.tail=this.head)}enq(...e){for(const t of e)this.enqOne(t)}deq(){if(0===this.size)throw new Error("Ringbuffer underrun");const e=this.buffer[this.tail];let t=this.tail+1;return t>=this.capacity&&(t=0),this.size>0&&this.size--,this.tail=t,e}get top(){if(0===this.size)throw new Error("Ringbuffer underrun");return this.buffer[this.tail]}get bottom(){if(0===this.size)throw new Error("Ringbuffer underrun");let e=this.head-1;return e<0&&(e=this.capacity-1),this.buffer[e]}iterator(){return new s.Iterator(this)}asArray(){const e=new Array;for(let t=0;t<this.size;t++)e.push(this.buffer[(this.tail+t)%this.capacity]);return e}}t.RingBuffer=s,function(e){e.Iterator=class{constructor(e,t=0){this.m_buffer=e,this.m_index=t}get value(){return this.m_buffer.buffer[(this.m_buffer.tail+this.m_index)%this.m_buffer.capacity]}next(){return this.m_index++,this.m_index<this.m_buffer.size}}}(s=t.RingBuffer||(t.RingBuffer={}));class o{constructor(e,t){this.statistics=e,this.name=t,this.running=!1}get value(){return this.m_currentValue}setValue(e){this.m_currentValue=e}reset(){this.m_currentValue=void 0}start(){if(!this.statistics.enabled)return-1;if(this.running)throw new Error("Timer '"+this.name+"' is already running");return this.running=!0,this.m_currentValue=n.PerformanceTimer.now()}stop(){var e;if(!this.statistics.enabled)return-1;if(this.running){const t=n.PerformanceTimer.now()-(null!==(e=this.m_currentValue)&&void 0!==e?e:0);return this.m_currentValue=t,this.setValue(t),this.running=!1,t}throw new Error("Timer '"+this.name+"' has not been started")}now(){var e;if(!this.statistics.enabled)return-1;if(this.running)return n.PerformanceTimer.now()-(null!==(e=this.m_currentValue)&&void 0!==e?e:0);throw new Error("Timer '"+this.name+"' has not been started")}}t.SimpleTimer=o;class a extends o{constructor(e,t){super(e,t),this.statistics=e,this.name=t,this.numResets=0,this.maxNumSamples=1e3,this.samples=new s(this.maxNumSamples)}reset(){super.reset(),this.getStats(),this.samples.clear(),this.numResets++}setValue(e){super.setValue(e),void 0!==e&&this.samples.enqOne(e)}getStats(){return l(this.samples.asArray())}}function l(e){if(0===e.length)return;e.sort(((e,t)=>e-t));const t=e[0],i=e[e.length-1];let n,r,s,o,a,l,c;if(1===e.length)r=s=o=a=l=c=n=e[0];else if(2===e.length)n=.5*e[0]+.5*e[1],r=s=o=a=l=c=e[1];else{const t=Math.floor(e.length/2);n=e.length%2==0?.5*e[t-1]+.5*e[t]:e[t],r=e[Math.round(.75*e.length)-1],s=e[Math.round(.9*e.length)-1],o=e[Math.round(.95*e.length)-1],a=e[Math.round(.97*e.length)-1],l=e[Math.round(.99*e.length)-1],c=e[Math.round(.999*e.length)-1]}let h=0;for(let t=0,i=e.length;t<i;t++)h+=e[t];return{min:t,max:i,avg:h/e.length,median:n,median75:r,median90:s,median95:o,median97:a,median99:l,median999:c,numSamples:e.length}}t.SampledTimer=a,t.computeArrayStats=l,t.computeArrayAverage=function(e){if(0===e.length)return;let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i];return t/e.length},t.MultiStageTimer=class{constructor(e,t,i){if(this.statistics=e,this.name=t,this.stages=i,i.length<1)throw new Error("MultiStageTimer needs stages");i.forEach((t=>{if(!e.hasTimer(t))throw new Error("Unknown timer: "+t)}))}get value(){return this.statistics.getTimer(this.stages[this.stages.length-1]).value}reset(){this.statistics.enabled&&this.stages.forEach((e=>{this.statistics.getTimer(e).reset()}))}start(){var e;return this.stage=this.stages[0],null!==(e=this.statistics.getTimer(this.stages[0]).value)&&void 0!==e?e:-1}stop(){return this.stage=void 0,void 0!==this.value?this.value:-1}get stage(){return this.currentStage}set stage(e){this.currentStage!==e&&(this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).stop(),this.currentStage=e,this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).start())}},t.Statistics=class{constructor(e,t=!1){this.name=e,this.enabled=t,this.timers=new Map,this.nullTimer=new o(this,"<null>")}createTimer(e,t=!0){const i=t?new a(this,e):new o(this,e);return this.addTimer(i)}addTimer(e){if(void 0!==this.timers.get(e.name))throw new Error("Duplicate timer name: '"+e.name+"'");return this.timers.set(e.name,e),e}getTimer(e){if(!this.enabled)return this.nullTimer;const t=this.timers.get(e);return void 0===t?this.nullTimer:t}hasTimer(e){return void 0!==this.timers.get(e)}reset(){this.timers.forEach((e=>{e.reset()}))}log(e,t){void 0===e&&void 0===this.name||r.log(void 0!==e?e:this.name);let i=0;this.timers.forEach((e=>{i=Math.max(i,e.name.length)}));const n=e=>void 0!==e?e.toFixed(5):"?";this.timers.forEach((e=>{let t=e.name+": "+" ".repeat(i-e.name.length);if(t+=n(e.value),e instanceof a){const i=e.getStats();void 0!==i&&(t+=`  [ min=${n(i.min)}, max=${n(i.max)}, avg=${n(i.avg)}, med=${n(i.median)}, med95=${n(i.median95)}, med99=${n(i.median99)}, N=${n(i.numSamples)} ]`)}r.log(t)})),void 0!==t&&r.log(t)}};class c{constructor(){this.entries=new Map,this.messages=void 0}getValue(e){return this.entries.get(e)}setValue(e,t){this.entries.set(e,t)}addValue(e,t){const i=this.entries.get(e);this.entries.set(e,t+(void 0===i?0:i))}addMessage(e){void 0===this.messages&&(this.messages=[]),this.messages.push(e)}reset(){this.entries.forEach(((e,t)=>{this.entries.set(t,0)})),this.messages=void 0}}t.FrameStats=c;class h{constructor(e=0){this.capacity=e,this.frameEntries=new Map,this.messages=new s(e)}get length(){return this.messages.size}reset(){this.frameEntries.forEach(((e,t)=>{e.clear()})),this.messages.clear()}addFrame(e){const t=this.length,i=this.frameEntries;e.entries.forEach(((e,n)=>{let r=i.get(n);if(void 0===r){r=new s(this.capacity);for(let e=0;e<t;e++)r.enqOne(0);this.frameEntries.set(n,r)}r.enqOne(e)})),this.messages.enq(e.messages)}log(){let e=0;this.frameEntries.forEach(((t,i)=>{e=Math.max(e,i.length)}));const t=e=>void 0!==e?e.toFixed(5):"?";this.frameEntries.forEach(((i,n)=>{let s=n+": "+" ".repeat(e-n.length);const o=l(i.asArray());void 0!==o&&(s+=`  [ min=${t(o.min)}, max=${t(o.max)}, avg=${t(o.avg)}, med=${t(o.median)}, med95=${t(o.median95)}, med99=${t(o.median99)}, N=${t(o.numSamples)} ]`),r.log(s)}))}}t.FrameStatsArray=h;class u{get isFull(){return this.m_frameEvents.length>=this.maxNumFrames}static get instance(){return void 0===u.m_instance&&(u.m_instance=new u(!1,0)),u.m_instance}get frameEvents(){return this.m_frameEvents}constructor(e=!0,t=1e3){this.enabled=e,this.maxNumFrames=t,this.currentFrame=new c,this.appResults=new Map,this.configs=new Map,u.m_instance=this,this.m_frameEvents=new h(t)}clear(){this.clearFrames(),this.configs.clear(),this.appResults.clear()}clearFrames(){this.m_frameEvents.reset(),this.currentFrame.reset()}addWebGLInfo(e){void 0!==e.render&&(this.currentFrame.setValue("gl.numCalls",null===e.render.calls?0:e.render.calls),this.currentFrame.setValue("gl.numPoints",null===e.render.points?0:e.render.points),this.currentFrame.setValue("gl.numLines",null===e.render.lines?0:e.render.lines),this.currentFrame.setValue("gl.numTriangles",null===e.render.triangles?0:e.render.triangles)),void 0!==e.memory&&(this.currentFrame.setValue("gl.numGeometries",null===e.memory.geometries?0:e.memory.geometries),this.currentFrame.setValue("gl.numTextures",null===e.memory.textures?0:e.memory.textures)),void 0!==e.programs&&this.currentFrame.setValue("gl.numPrograms",null===e.programs?0:e.programs.length)}addMemoryInfo(){if(void 0!==window&&void 0!==window.performance){const e=window.performance.memory;void 0!==e&&(this.currentFrame.setValue("memory.totalJSHeapSize",e.totalJSHeapSize),this.currentFrame.setValue("memory.usedJSHeapSize",e.usedJSHeapSize),this.currentFrame.setValue("memory.jsHeapSizeLimit",e.jsHeapSizeLimit))}}storeAndClearFrameInfo(){return!(this.m_frameEvents.length>=this.maxNumFrames||(this.m_frameEvents.addFrame(this.currentFrame),this.currentFrame.reset(),0))}log(e,t){r.log(void 0!==e?e:"PerformanceStatistics"),this.appResults.forEach(((e,t)=>{r.log(t,e)})),this.configs.forEach(((e,t)=>{r.log(t,e)})),this.m_frameEvents.log(),void 0!==t&&r.log(t)}getAsPlainObject(e=!1){const t={},i={},n={},r={configs:i,appResults:t,frames:n};if(this.appResults.forEach(((e,i)=>{t[i]=e})),this.configs.forEach(((e,t)=>{i[t]=e})),e)for(const[e,t]of this.m_frameEvents.frameEntries)n[e]=t.bottom;else for(const[e,t]of this.m_frameEvents.frameEntries)n[e]=t.asArray();return r.messages=this.m_frameEvents.messages.asArray(),r}getLastFrameStatistics(){return this.getAsPlainObject(!0)}getAsSimpleFrameStatistics(e=!1){const t=new Map,i=new Map,n=new Map,r={configs:t,appResults:i,frames:n,messages:this.m_frameEvents.messages.asArray()};if(this.appResults.forEach(((e,t)=>{i.set(t,e)})),this.configs.forEach(((e,i)=>{t.set(i,e)})),e)for(const[e,t]of this.m_frameEvents.frameEntries)n.set(e,t.bottom);else for(const[e,t]of this.m_frameEvents.frameEntries)n.set(e,t.asArray());return r}}t.PerformanceStatistics=u,u.m_instance=void 0},1797:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureLoader=void 0;const n=i(82);t.TextureLoader=class{constructor(){this.m_textureLoader=new n.TextureLoader}async load(e,t,i,r=!0){if(void 0===t)return await this.loadWithThreeLoader(e);const s=await fetch(e,{headers:t,signal:i,mode:r?"cors":"no-cors"}),o=await s.blob(),a=await this.loadWithThreeLoader(URL.createObjectURL(o)),l="image/jpeg/"===o.type||e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);return a.format=l?n.RGBFormat:n.RGBAFormat,a}loadWithThreeLoader(e){return new Promise(((t,i)=>{this.m_textureLoader.setCrossOrigin(""),this.m_textureLoader.load(e,(e=>t(e)),void 0,(()=>i(new Error("failed to load texture"))))}))}}},5640:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLight=t.toTextureFilter=t.toWrappingMode=t.toTextureDataType=t.toPixelFormat=void 0;const n=i(82),r=i(2616);t.toPixelFormat=function(e){switch(e){case"Alpha":return n.AlphaFormat;case"RGB":return n.RGBFormat;case"RGBA":return n.RGBAFormat;case"Luminance":return n.LuminanceFormat;case"LuminanceAlpha":return n.LuminanceAlphaFormat;case"RGBE":return n.RGBEFormat;case"Depth":return n.DepthFormat;case"DepthStencil":return n.DepthStencilFormat;case"Red":return n.RedFormat;default:throw new Error(`invalid pixel format: ${e}`)}},t.toTextureDataType=function(e){switch(e){case"UnsignedByte":return n.UnsignedByteType;case"Byte":return n.ByteType;case"Short":return n.ShortType;case"UnsignedShort":return n.UnsignedShortType;case"Int":return n.IntType;case"UnsignedInt":return n.UnsignedIntType;case"Float":return n.FloatType;case"HalfFloat":return n.HalfFloatType;default:throw new Error(`invalid texture data type: ${e}`)}},t.toWrappingMode=function(e){switch(e){case"clamp":return n.ClampToEdgeWrapping;case"repeat":return n.RepeatWrapping;case"mirror":return n.MirroredRepeatWrapping;default:throw new Error(`invalid wrapping mode: ${e}`)}},t.toTextureFilter=function(e){switch(e){case"nearest":return n.NearestFilter;case"nearestMipMapNearest":return n.NearestMipMapNearestFilter;case"nearestMipMapLinear":return n.NearestMipMapLinearFilter;case"linear":return n.LinearFilter;case"linearMipMapNearest":return n.LinearMipMapNearestFilter;case"linearMipMapLinear":return n.LinearMipMapLinearFilter;default:throw new Error(`invalid texture filter: ${e}`)}},t.createLight=function(e){switch(e.type){case"ambient":{const t=new n.AmbientLight(e.color,e.intensity);return t.name=e.name,t}case"directional":{const t=new n.DirectionalLight(e.color,e.intensity);return t.name=e.name,void 0!==e.castShadow&&(t.castShadow=e.castShadow),t.castShadow&&(t.shadow.bias=1e-5,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024),function(e,t){if((0,r.isVector3Like)(t.direction)){const{x:i,y:n,z:r}=t.direction;e.position.set(i,n,r)}else{const[i,r]=t.direction.map((e=>n.MathUtils.degToRad(e))),s=Math.cos(r);e.position.set(Math.sin(i)*s,Math.cos(i)*s,Math.sin(r))}e.position.normalize()}(t,e),t}}}},6586:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isThemeLoaded=t.load=t.DEFAULT_MAX_THEME_INHERITANCE_DEPTH=void 0,i(6892);const n=i(2616),r=i(1984),s=i(4342),o=i(3307);async function a(e,i){var n,o,h;if(i=null!=i?i:{},"string"==typeof e){const t=null!==(o=null===(n=i.uriResolver)||void 0===n?void 0:n.resolveUri(e))&&void 0!==o?o:e,r=await fetch(t,{signal:i.signal});if(!r.ok)throw new Error(`ThemeLoader#load: cannot load theme: ${r.statusText}`);(e=await r.json()).url=t,e=l(e,i)}else void 0===e.url&&(e.url=(0,s.getAppBaseUrl)(),e=l(e,i));if(e.styles=(0,r.getStyles)(e.styles),null==e)throw new Error("ThemeLoader#load: loaded resource is not valid JSON");const d=(0,s.getOptionValue)(i.resolveLightDefinitions,!0);e=await async function(e,i){if(i=null!=i?i:{},void 0===e.extends)return e;const n=(0,s.getOptionValue)(i.maxInheritanceDepth,t.DEFAULT_MAX_THEME_INHERITANCE_DEPTH);if(n<=0)throw new Error("maxInheritanceDepth reached when attempting to load base theme");const o=Array.isArray(e.extends)?e.extends:[e.extends];delete e.extends;let l={};for(const e of o){let t,s;(0,r.isConditionalExtendsEntry)(e)?(t=e.value,s=e.when):t=e,l=u(await a(t,Object.assign(Object.assign({},i),{resolveLightDefinitions:!1,maxInheritanceDepth:n-1})),l,s)}return u(e,l)}(e,i);const m=new s.ContextLogger(null!==(h=i.logger)&&void 0!==h?h:console,`when processing Theme ${e.url}:`);return d&&void 0!==e.lights&&(m.pushAttr("lights"),e.lights=function(e,t,i){const n=[];for(let r=0;r<e.length;++r){i.pushIndex(r);const s=c(e[r],t,i);void 0!==s?n.push(s):i.warn("invalid light, ignored"),i.pop()}return n}(e.lights,e.definitions,m),m.pop()),e}function l(e,t){if(void 0===e.url)return e;if(e.base){const i=`${e.base.style}/${e.base.scheme}.json`,n=null==t?void 0:t.baseUrl;e.extends=void 0!==n?(0,s.resolveReferenceUri)(n,i):i}const i={resolveUri(i){var n,r;const o=null!==(r=null===(n=null==t?void 0:t.uriResolver)||void 0===n?void 0:n.resolveUri(i))&&void 0!==r?r:i;return o!==i?o:(0,s.resolveReferenceUri)(e.url,i)}};return e.extends&&(e.extends=(Array.isArray(e.extends)?e.extends:[e.extends]).map((n=>{let s;if("string"==typeof n)s=i.resolveUri(n);else if((0,r.isConditionalExtendsEntry)(n)){s=n;let r=n.value;"string"==typeof r?r=i.resolveUri(r):void 0===r.url&&(r.url=e.url,r=l(r,t)),s.value=r}else void 0!==n.url?s=n:(n.url=e.url,s=l(n,t));return s}))),!1!==(null==t?void 0:t.resolveResourceUris)&&function(e,t){if(e.sky&&"cubemap"===e.sky.type)for(let i=0;i<o.SKY_CUBEMAP_FACE_COUNT;++i){const n=e.sky[o.SkyCubemapFaceId[i]];void 0!==n&&(e.sky[o.SkyCubemapFaceId[i]]=t.resolveUri(n))}if(e.images)for(const i of Object.keys(e.images)){const n=e.images[i];n.url=t.resolveUri(n.url),void 0!==n.atlas&&(n.atlas=t.resolveUri(n.atlas))}if(e.fontCatalogs)for(const i of e.fontCatalogs)i.url=t.resolveUri(i.url);if(void 0!==e.styles)for(const i of(0,r.getStyles)(e.styles))i.attr&&["map","normalMap","displacementMap","roughnessMap"].forEach((e=>{const n=i.attr[e];n&&"string"==typeof n&&(i.attr[e]=t.resolveUri(n))}))}(e,i),e}function c(e,t,i){const s=h(e.color,t,i);if(void 0===s)return;e.color=s;const o=h(e.intensity,t,i);if(void 0!==o){if(e.intensity=o,(0,r.isDirectionalLight)(e)&&!(0,n.isVector3Like)(e.direction)){const n=e.direction.map((e=>h(e,t,i)));if(n.some((e=>void 0===e)))return;e.direction=n}return e}}function h(e,t,i){let n=!1;const s=function e(s){if((0,r.isJsonExprReference)(s)){const e=s[1],o=t&&t[e];return void 0===o?(i.warn(`invalid reference '${e}' - not found`),void(n=!0)):(0,r.isJsonExpr)(o)?o:(0,r.getDefinitionValue)(o)}if(Array.isArray(s)){const t=[...s];for(let i=1;i<t.length;++i)t[i]=e(t[i]);return t}return s}(e);if(!n)return s}function u(e,t,i){const n=function(e,t,i){let n;if(void 0!==i&&void 0!==e){n=Object.assign({},t);for(const t of Object.keys(e)){const s=n[t],o=e[t];let a;(0,r.isJsonExpr)(s)&&"case"===s[0]?(a=s.slice(),a.splice(1,0,i,o)):a=["case",i,o,void 0===s?null:s],n[t]=a}}else n=Object.assign(Object.assign({},t),e);return n}(e.definitions,t.definitions,i);let s;const o=(0,r.getStyles)(t.styles),a=(0,r.getStyles)(e.styles);if(t.styles&&e.styles){const e=[],t=new Map;o.forEach((i=>{"string"==typeof i.id&&(t.has(i.id)||t.set(i.id,e.length)),e.push(i)})),a.forEach((i=>{if("string"==typeof i.extends&&t.has(i.extends)){const n=t.get(i.extends),r=e[n];return e[n]=Object.assign(Object.assign({},r),i),void(e[n].extends=void 0)}if("string"==typeof i.id&&t.has(i.id)){const n=t.get(i.id);e[n].styleSet===i.styleSet&&(e[n]=i)}else e.push(i)})),s=e}else t.styles?s=[...o]:e.styles&&(s=[...a]);return Object.assign(Object.assign(Object.assign(Object.assign({},t),e),function(e,t){const i=Object.assign(Object.assign({},t.images),e.images);let n=[];return!t.imageTextures&&e.imageTextures?n=e.imageTextures:t.imageTextures&&!e.imageTextures?n=t.imageTextures:t.imageTextures&&e.imageTextures&&(n=e.imageTextures.slice(),t.imageTextures.forEach((e=>{n.find((({name:t})=>t===e.name))||n.push(e)}))),{images:i,imageTextures:n}}(e,t)),{definitions:n,styles:s})}t.DEFAULT_MAX_THEME_INHERITANCE_DEPTH=4,t.load=async function(e,t){return await a(e,Object.assign(Object.assign({},t),{resolveLightDefinitions:!0}))},t.isThemeLoaded=function(e){return void 0===e.extends&&!(0,r.isStylesDictionary)(e.styles)}},1447:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tile=t.getFeatureDataSize=void 0;const n=i(82),r=i(2616),s=i(4342),o=i(6473),a=i(7987),l=i(1335),c=i(7013),h=i(3922),u=i(1406),d=i(8015),m=s.LoggerManager.instance.create("Tile");t.getFeatureDataSize=function(e){let t=100;return void 0!==e.starts&&(t+=8*e.starts.length),void 0!==e.objInfos&&(t+=16*e.objInfos.length),t},t.Tile=class{constructor(e,t,i=0,s){this.dataSource=e,this.tileKey=t,this.objects=[],this.dependencies=[],this.frameNumLastRequested=-1,this.frameNumVisible=-1,this.frameNumLastVisible=-1,this.numFramesVisible=0,this.visibilityCounter=-1,this.levelOffset=0,this.skipRendering=!1,this.delayRendering=!1,this.m_boundingBox=new r.OrientedBox3,this.m_disposed=!1,this.m_forceHasGeometry=void 0,this.m_iconTextGroups=new c.IconTextGroupPriorityList,this.m_pathBlockingElements=[],this.m_worldCenter=new n.Vector3,this.m_visibleArea=0,this.m_elevationRange={minElevation:0,maxElevation:0},this.geoBox=this.dataSource.getTilingScheme().getGeoBox(this.tileKey),this.updateBoundingBox(),this.m_worldCenter.copy(this.boundingBox.position),this.m_localTangentSpace=null!=s&&s,this.m_textStyleCache=new h.TileTextStyleCache(this),this.m_offset=i,this.m_uniqueKey=r.TileKeyUtils.getKeyForTileKeyAndOffset(this.tileKey,this.offset),e.useGeometryLoader&&(this.m_tileGeometryLoader=new l.TileGeometryLoader(this,this.mapView.taskQueue),this.attachGeometryLoadedCallback())}get isVisible(){try{return this.frameNumLastRequested>=this.dataSource.mapView.frameNumber-1}catch(e){return m.debug(e),!1}}set isVisible(e){this.frameNumLastRequested=e?this.dataSource.mapView.frameNumber:-1,e||!this.m_tileGeometryLoader||this.m_tileGeometryLoader.isSettled||this.m_tileGeometryLoader.cancel()}get projection(){return this.dataSource.projection}get mapView(){return this.dataSource.mapView}get localTangentSpace(){return this.m_localTangentSpace}get memoryUsage(){return void 0===this.m_resourceInfo&&this.computeResourceInfo(),this.m_resourceInfo.heapSize}get center(){return this.m_worldCenter}get uniqueKey(){return this.m_uniqueKey}get offset(){return this.m_offset}set offset(e){this.m_offset!==e&&(this.m_uniqueKey=r.TileKeyUtils.getKeyForTileKeyAndOffset(this.tileKey,e)),this.m_offset=e}getResourceInfo(){return void 0===this.m_resourceInfo&&this.computeResourceInfo(),this.m_resourceInfo}invalidateResourceInfo(){this.m_resourceInfo=void 0}addIconText(e){this.iconTextGroups.add(e),this.iconTextsChanged=!0}addBlockingElement(e){this.m_pathBlockingElements.push(e)}get iconTextGroups(){return this.m_iconTextGroups}get iconTextsChanged(){var e;return null!==(e=this.m_iconTextsChanged)&&void 0!==e&&e}set iconTextsChanged(e){this.m_iconTextsChanged=e}hasIconTexts(){return this.m_iconTextGroups.count()>0}get blockingElements(){return this.m_pathBlockingElements}willRender(e){return!this.skipRendering&&!this.delayRendering}didRender(){}get visibleArea(){return this.m_visibleArea}set visibleArea(e){this.m_visibleArea=e,void 0!==this.tileLoader&&(this.tileLoader.priority=e)}get elevationRange(){return this.m_elevationRange}set elevationRange(e){var t;e.minElevation===this.m_elevationRange.minElevation&&e.maxElevation===this.m_elevationRange.maxElevation&&e.calculationStatus===this.m_elevationRange.calculationStatus||(this.m_elevationRange.minElevation=e.minElevation,this.m_elevationRange.maxElevation=e.maxElevation,this.m_elevationRange.calculationStatus=e.calculationStatus,this.elevateGeoBox(),void 0===this.m_maxGeometryHeight&&void 0===this.m_minGeometryHeight||((0,s.assert)(void 0===(null===(t=this.decodedTile)||void 0===t?void 0:t.boundingBox)),this.updateBoundingBox()))}get decodedTile(){return this.m_decodedTile}set decodedTile(e){var t,i;if(this.m_decodedTile=e,this.invalidateResourceInfo(),void 0===e)return;0===e.geometries.length&&this.forceHasGeometry(!0),this.m_maxGeometryHeight=e.boundingBox?void 0:null!==(t=e.maxGeometryHeight)&&void 0!==t?t:0,this.m_minGeometryHeight=e.boundingBox?void 0:null!==(i=e.minGeometryHeight)&&void 0!==i?i:0,this.elevateGeoBox(),this.updateBoundingBox(e.boundingBox);const n=d.PerformanceStatistics.instance;n.enabled&&void 0!==e.decodeTime&&(n.currentFrame.addValue("decode.decodingTime",e.decodeTime),n.currentFrame.addValue("decode.decodedTiles",1)),void 0!==e.copyrightHolderIds&&(this.copyrightInfo=e.copyrightHolderIds.map((e=>({id:e})))),this.dataSource.requestUpdate()}get disposed(){return this.m_disposed}get allGeometryLoaded(){var e,t;return null!==(t=null===(e=this.m_tileGeometryLoader)||void 0===e?void 0:e.isFinished)&&void 0!==t?t:this.hasGeometry}get hasGeometry(){return void 0===this.m_forceHasGeometry?0!==this.objects.length:this.m_forceHasGeometry}forceHasGeometry(e){this.m_forceHasGeometry=e}resetVisibilityCounter(){this.visibilityCounter=-1}get tileLoader(){return this.m_tileLoader}set tileLoader(e){this.m_tileLoader=e}async load(e){const t=this.tileLoader;if(void 0===t)return await Promise.resolve();if(this.m_tileGeometryLoader){const e=this.m_tileGeometryLoader.isSettled;this.m_tileGeometryLoader.reset(),e&&this.attachGeometryLoadedCallback()}return!0===e&&t.cancel(),await t.loadAndDecode().then((e=>{var i;(0,s.assert)(e===u.TileLoaderState.Ready);const n=t.decodedTile;this.decodedTile=n,null===(i=null==n?void 0:n.dependencies)||void 0===i||i.forEach((e=>{this.dependencies.push(r.TileKey.fromMortonCode(e))}))})).catch((e=>{e===u.TileLoaderState.Failed?this.dispose():e!==u.TileLoaderState.Canceled&&m.error("Unknown error"+e)}))}get textStyleCache(){return this.m_textStyleCache}clear(){const e=e=>{Object.getOwnPropertyNames(e).forEach((t=>{const i=e[t];i instanceof n.Texture&&i.dispose()})),e.dispose()},t=t=>{var i,n;null===(i=t.geometry)||void 0===i||i.dispose();for(const e of null!==(n=t.geometries)&&void 0!==n?n:[])e.dispose();t.material instanceof Array?t.material.forEach((t=>{void 0!==t&&e(t)})):t.material&&e(t.material)};this.objects.forEach((e=>{e.traverse((e=>{t(e)})),t(e)})),this.objects.length=0,this.preparedTextPaths&&(this.preparedTextPaths=[]),this.m_textStyleCache.clear(),this.clearIconTexts(),this.invalidateResourceInfo()}clearIconTexts(){this.hasIconTexts()&&(this.iconTextsChanged=!0,this.m_pathBlockingElements.splice(0),this.iconTextGroups.forEachElement((e=>{e.dispose()})),this.iconTextGroups.clear())}addDisposeCallback(e){this.m_disposeCallback=(0,s.chainCallbacks)(this.m_disposeCallback,e)}dispose(){var e;this.m_disposed||(this.m_tileLoader&&(this.m_tileLoader.cancel(),this.m_tileLoader=void 0),this.clear(),this.frameNumLastRequested=0,this.m_disposed=!0,null===(e=this.m_tileGeometryLoader)||void 0===e||e.dispose(),this.m_disposeCallback&&this.m_disposeCallback(this))}computeWorldOffsetX(){return this.projection.worldExtent(0,0).max.x*this.offset}update(e){for(const t of this.objects)t instanceof o.LodMesh&&t.setLevelOfDetail(e-this.tileKey.level)}get boundingBox(){return this.m_boundingBox}updateGeometry(e){if(!this.m_tileGeometryLoader)return!1;if(this.m_tileGeometryLoader.isSettled)return!0;if(this.dataSource.isDetached())return this.m_tileGeometryLoader.cancel(),!0;if(this.tileLoader){if(!this.tileLoader.isFinished)return!0;if(!this.decodedTile)return this.m_tileGeometryLoader.finish(),!0}return void 0!==e&&(this.m_tileGeometryLoader.priority=e),this.m_tileGeometryLoader.update(),!0}loadingFinished(){}attachGeometryLoadedCallback(){(0,s.assert)(void 0!==this.m_tileGeometryLoader),this.m_tileGeometryLoader.waitFinished().then((()=>{this.loadingFinished(),this.removeDecodedTile()})).catch((()=>{this.disposed||this.dataSource.isDetached()||this.mapView.visibleTileSet.disposeTile(this)}))}removeDecodedTile(){this.m_decodedTile=void 0,this.invalidateResourceInfo()}updateBoundingBox(e){e?(this.m_boundingBox.copy(e),this.m_worldCenter.copy(this.boundingBox.position)):this.projection.projectBox(this.geoBox,this.boundingBox)}elevateGeoBox(){var e,t;this.geoBox.southWest.altitude=this.m_elevationRange.minElevation+(null!==(e=this.m_minGeometryHeight)&&void 0!==e?e:0),this.geoBox.northEast.altitude=this.m_elevationRange.maxElevation+(null!==(t=this.m_maxGeometryHeight)&&void 0!==t?t:0)}computeResourceInfo(){let e=0,t=0;const i={heapSize:0,gpuSize:0},n=new Map;for(const e of this.objects)e.visible&&t++,a.Object3DUtils.estimateSize(e,i,n);const r=this.iconTextGroups.count();e+=312*r,void 0!==this.m_decodedTile&&void 0!==this.m_decodedTile.tileInfo&&(i.heapSize+=this.m_decodedTile.tileInfo.numBytes),this.m_resourceInfo={heapSize:i.heapSize+e,gpuSize:i.gpuSize,num3dObjects:t,numIconTexts:r,numUserIconTexts:0}}}},9780:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileObjectRenderer=void 0;const n=i(8152),r=i(1984),s=i(8023),o=i(5863),a=i(8673),l=i(4572);t.TileObjectRenderer=class{constructor(e,t){this.m_env=e,this.m_renderer=t,this.m_renderOrderStencilValues=new Map,this.m_stencilValue=1}render(e,t,i,n,r){const s=e.computeWorldOffsetX();if(e.willRender(t)){for(const t of e.objects){const o=l.MapObjectAdapter.get(t);this.processTileObject(e,i,t,o)&&(this.updateStencilRef(t),t.position.copy(e.center),void 0!==t.displacement&&t.position.add(t.displacement),t.position.x+=s,t.position.sub(n),e.localTangentSpace&&t.setRotationFromMatrix(e.boundingBox.getRotationMatrix()),t.frustumCulled=!1,r.add(t))}e.didRender()}}prepareRender(){this.m_stencilValue=1,this.m_renderOrderStencilValues.clear()}setupRenderer(){const e=(e,t)=>e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.object.userData.tileKey&&t.object.userData.tileKey&&e.object.userData.tileKey.mortonCode()!==t.object.userData.tileKey.mortonCode()?e.object.userData.tileKey.mortonCode()-t.object.userData.tileKey.mortonCode():e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id;this.m_renderer.setOpaqueSort(((t,i)=>{var n,s;const a=l.MapObjectAdapter.get(t.object),c=l.MapObjectAdapter.get(i.object),h=null===(n=null==a?void 0:a.dataSource)||void 0===n?void 0:n.dataSourceOrder,u=null===(s=null==c?void 0:c.dataSource)||void 0===s?void 0:s.dataSourceOrder;if(void 0!==h&&void 0!==u&&h!==u)return h-u;if(t.renderOrder===o.BackgroundDataSource.GROUND_RENDER_ORDER||i.renderOrder===o.BackgroundDataSource.GROUND_RENDER_ORDER)return e(t,i);if(void 0!==(null==a?void 0:a.level)&&void 0!==(null==c?void 0:c.level)){const n=void 0!==a.technique&&(0,r.isExtrudedPolygonTechnique)(a.technique)||void 0!==c.technique&&(0,r.isExtrudedPolygonTechnique)(c.technique);return a.level===c.level||n?e(t,i):a.level-c.level}return e(t,i)}))}updateStencilRef(e){if(void 0!==e.renderOrder&&e instanceof a.SolidLineMesh){const t=e.material;Array.isArray(t)?t.forEach((t=>t.stencilRef=this.getStencilValue(e.renderOrder))):t.stencilRef=this.getStencilValue(e.renderOrder)}}allocateStencilValue(e){const t=this.m_stencilValue++;return this.m_renderOrderStencilValues.set(e,t),t}getStencilValue(e){var t;return null!==(t=this.m_renderOrderStencilValues.get(e))&&void 0!==t?t:this.allocateStencilValue(e)}processTileObject(e,t,i,n){return!(!i.visible||!this.processTileObjectFeatures(e,t,i)||n&&(n.update(e.mapView),!n.isVisible()&&n.pickability!==r.Pickability.all))}processTileObjectFeatures(e,t,i){var o,a;const l=i.userData.technique,c=(0,n.getPropertyValue)(null==l?void 0:l.minZoomLevel,this.m_env),h=(0,n.getPropertyValue)(null==l?void 0:l.maxZoomLevel,this.m_env);if("number"==typeof c&&t<c)return!1;if("number"==typeof h&&t>=h)return!1;if(void 0===(null==l?void 0:l.enabled))return!0;const u=i.userData.feature;if(!u||!s.Expr.isExpr(l.enabled))return Boolean((0,n.getPropertyValue)(l.enabled,this.m_env));const{starts:d,objInfos:m}=u;if(!Array.isArray(m)||!Array.isArray(d))return!0;const p=i.geometry;if(!p||!p.isBufferGeometry)return!0;const f=null!==(a=null===(o=p.getIndex())||void 0===o?void 0:o.count)&&void 0!==a?a:p.attributes.position.count;let g;return p.clearGroups(),m.forEach(((t,i)=>{var o,a;const c=(0,n.getFeatureId)(t);let h=!0;if(s.Expr.isExpr(l.enabled)){const i=e.dataSource.getFeatureState(c),s=i?new r.MapEnv(i):null,o="object"==typeof t?new r.MapEnv(t,this.m_env):this.m_env,a=new r.MapEnv({$state:s},o);h=Boolean((0,n.getPropertyValue)(l.enabled,a))}if(!h)return;const u=null!==(o=d[i])&&void 0!==o?o:0,m=(null!==(a=d[i+1])&&void 0!==a?a:f)-u;u===g?p.groups[p.groups.length-1].count+=m:p.addGroup(u,m),g=u+m})),p.groups.length>0}}},541:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileOffsetUtils=t.MapViewUtils=void 0;const n=i(82),r=i(2616),s=i(5610),o=i(4342),a=i(4442),l=i(7987),c=o.LoggerManager.instance.create("MapViewUtils"),h=new n.Vector3(0,0,1),u=new n.Plane(h.clone()),d=new n.Sphere(void 0,s.EarthConstants.EQUATORIAL_RADIUS),m=new n.Raycaster,p={x:new n.Vector3,y:new n.Vector3,z:new n.Vector3},f={x:new n.Vector3,y:new n.Vector3,z:new n.Vector3},g={box3:[new n.Box3],obox3:[new r.OrientedBox3],quaternions:[new n.Quaternion,new n.Quaternion],vector2:[new n.Vector2,new n.Vector2],vector3:[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3],matrix4:[new n.Matrix4,new n.Matrix4],transforms:[{xAxis:new n.Vector3,yAxis:new n.Vector3,zAxis:new n.Vector3,position:new n.Vector3}]},v=new n.PerspectiveCamera;var y;!function(e){function t(t,i,s,o,l,h){var u,d,m;const p=a.CameraUtils.getPrincipalPoint(t.camera,g.vector2[0]),f=e.rayCastWorldCoordinates(t,p.x,p.y);if(null===f)return;let v;if("number"==typeof i)v=g.vector2[1].set(i,s);else{const e=i;v=null!==(u=e.center)&&void 0!==u?u:p,o=null!==(d=e.deltaAzimuth)&&void 0!==d?d:0,l=null!==(m=e.deltaTilt)&&void 0!==m?m:0,h=e.maxTiltAngle}const y=v.x===p.x&&v.y===p.y?f:e.rayCastWorldCoordinates(t,v.x,v.y);if(null===y)return;!function(e,t,i){const n=e.camera,r=e.projection.surfaceNormal(t,g.vector3[0]),s=g.quaternions[0].setFromAxisAngle(r,i);n.quaternion.premultiply(s),n.position.sub(t),n.position.applyQuaternion(s),n.position.add(t)}(t,y,-o);const _=new n.Vector3(1,0,0).applyQuaternion(t.camera.quaternion),x=function(e,t,i,s,o,a,l){const c=e.camera,h=e.projection,u=S(h,c,o,l);if(u+i<0)return-u;if(i<=0)return i;if(o.equals(a)||t<0)return r.MathUtils.clamp(i+u,0,s)-u;const d=S(h,c,a,l),m=n.MathUtils.degToRad(89);if(d>m)return 0;let p=0;if(h===r.sphereProjection){const e=h.surfaceNormal(a,g.vector3[0]).projectOnPlane(l).normalize(),t=h.surfaceNormal(o,g.vector3[1]);p=e.angleTo(t)}const f=n.MathUtils.degToRad(90),v=f+p-(2*f-(2*f-(f+p-d+(f+u)))-f-s);return r.MathUtils.clamp(i+d,0,Math.min(v,m))-d}(t,v.y-p.y,l,h,f,y,_);!function(t,i,n,r){const s=t.camera,o=s.position.clone(),a=s.quaternion.clone(),l=g.quaternions[0].setFromAxisAngle(r,n);s.quaternion.premultiply(l),s.position.sub(i),s.position.applyQuaternion(l),s.position.add(i),null===e.rayCastWorldCoordinates(t,0,0)&&(c.warn("Target got invalidated during rotation."),s.position.copy(o),s.quaternion.copy(a))}(t,y,x,_)}function i(e,t,i){const o=g.vector3[0].copy(e.position),a=e.getWorldDirection(g.vector3[1]);m.set(o,a),void 0!==i&&(u.constant-=i,d.radius+=i);const l=new n.Vector3,c=t.type===r.ProjectionType.Planar?m.ray.intersectPlane(u,l):m.ray.intersectSphere(d,l);return void 0!==i&&(u.constant=0,d.radius=s.EarthConstants.EQUATORIAL_RADIUS),c}function h(t,i,s){const o={target:t,distance:i},l=s.worldMaxBounds,c=s.camera,h=s.projection;if(!l)return o;const u=l.getSize(g.vector3[1]),d=s.renderer.getSize(g.vector2[0]),m=a.CameraUtils.convertScreenToWorldSize(s.focalLength,o.distance,d.height),p=m*c.aspect,f=Math.max(p/u.x,m/u.y),v=new n.Vector3(p/2,m/2,0),y={target:o.target.clone(),distance:o.distance};if(h.type===r.ProjectionType.Planar){if(f>1)y.distance/=f,c.getWorldDirection(c.position).multiplyScalar(-y.distance).add(l.getCenter(y.target));else{if(g.box3[0].copy(l).expandByVector(v.multiplyScalar(-1)).clampPoint(o.target,y.target).setZ(o.target.z),y.target.equals(o.target))return o;c.position.x+=y.target.x-o.target.x,c.position.y+=y.target.y-o.target.y}return y}if(f>1)l.getCenter(y.target),y.target.setLength(o.target.length()),y.distance/=f;else{const e=g.obox3[0];e.copy(l),e.position.setLength(o.target.length()),e.extents.sub(v);const t=e.getRotationMatrix(g.matrix4[0]),i=g.vector3[1].copy(y.target).sub(e.position).applyMatrix4(g.matrix4[1].copy(t).transpose()).setZ(0),n=g.vector3[2].copy(i).clamp(g.vector3[3].copy(e.extents).multiplyScalar(-1),e.extents);if(n.equals(i))return o;y.target.copy(n).applyMatrix4(t).add(e.position);const r=e.position.lengthSq(),s=y.target.distanceToSquared(e.position),a=Math.sqrt(r)-Math.sqrt(r-s);y.target.addScaledVector(e.zAxis,-a),y.target.setLength(o.target.length())}return e.panCameraAroundGlobe(s,g.vector3[1].copy(y.target),g.vector3[2].copy(o.target)),c.getWorldDirection(c.position).multiplyScalar(-y.distance).add(y.target),y}function y(e,t,i,o,a,l=new n.Vector3){const c=n.MathUtils.degToRad(o),h=Math.cos(c)*t,u=n.MathUtils.degToRad(i);a.projectPoint(e,l);const d=t*Math.sin(c);if(a.type===r.ProjectionType.Planar)l.x=l.x+Math.sin(u)*d,l.y=l.y-Math.cos(u)*d,l.z=l.z+h;else if(a.type===r.ProjectionType.Spherical){f.z.copy(l).normalize(),f.y.set(0,0,1).projectOnPlane(f.z).normalize(),g.quaternions[0].setFromAxisAngle(f.z,u-Math.PI),f.y.applyQuaternion(g.quaternions[0]),f.y.setLength(d);const e=t*Math.cos(c);l.add(f.y).add(f.z.setLength(e));const i=s.EarthConstants.EQUATORIAL_RADIUS+h,n=Math.sin(c)*t,r=Math.sqrt(i*i+n*n);l.setLength(r)}return l}function _(e,t,i,o){const a=g.vector3[0].set(t,i,0);e.camera.updateMatrixWorld();const l=g.vector3[1].copy(e.camera.position);g.matrix4[0].extractRotation(e.camera.matrixWorld),g.matrix4[1].multiplyMatrices(g.matrix4[0],g.matrix4[1].copy(e.camera.projectionMatrix).invert());const c=a.applyMatrix4(g.matrix4[1]);m.set(l,c.normalize()),void 0!==o&&(u.constant-=o,d.radius+=o);const h=new n.Vector3,p=e.projection.type===r.ProjectionType.Planar?m.ray.intersectPlane(u,h):m.ray.intersectSphere(d,h);return void 0!==o&&(u.constant=0,d.radius=s.EarthConstants.EQUATORIAL_RADIUS),p}function x(e,t,i){e.camera.position.x+=t,e.camera.position.y+=i}function w(e,t,i){g.quaternions[0].setFromUnitVectors(t.normalize(),i.normalize()).invert(),g.matrix4[0].makeRotationFromQuaternion(g.quaternions[0]),e.camera.applyMatrix4(g.matrix4[0]),e.camera.updateMatrixWorld()}function b(e,t,i,r,s=new n.Quaternion){const o=g.transforms[0];return e.localTangentSpace(t,o),g.matrix4[0].makeBasis(o.xAxis,o.yAxis,o.zAxis),s.setFromRotationMatrix(g.matrix4[0]),g.quaternions[0].setFromAxisAngle(g.vector3[1].set(0,0,1),n.MathUtils.degToRad(i)),g.quaternions[1].setFromAxisAngle(g.vector3[1].set(1,0,0),n.MathUtils.degToRad(r)),s.multiply(g.quaternions[0]),s.multiply(g.quaternions[1]),s}function T(t,i){if(i.type===r.ProjectionType.Planar){const e=t.getWorldDirection(g.vector3[0]).normalize(),r=i.surfaceNormal(t.position,g.vector3[1]).negate(),s=e.dot(r);return Math.acos(n.MathUtils.clamp(s,-1,1))}{(0,o.assert)(i.type===r.ProjectionType.Spherical);const n=e.getGeoTargetFromCamera(t,i);return null!==n?e.extractTiltAngleFromLocation(i,t,n):(c.warn("MapView camera is pointing in the void, using maxTilt: ",e.MAX_TILT_RAD),e.MAX_TILT_RAD)}}function M(e,t){g.vector3[1].setFromMatrixPosition(t.matrixWorld),e.projection.localTangentSpace(g.vector3[1],{xAxis:f.x,yAxis:f.y,zAxis:f.z,position:g.vector3[0]}),g.matrix4[1].makeBasis(f.x,f.y,f.z),g.matrix4[0].copy(g.matrix4[1]).invert().multiply(t.matrixWorld),p.x.setFromMatrixColumn(g.matrix4[0],0),p.y.setFromMatrixColumn(g.matrix4[0],1),p.z.setFromMatrixColumn(g.matrix4[0],2);let i=0,n=0,r=0;const s=p.z.dot(g.vector3[1].set(0,0,1));return s<1-Number.EPSILON?s>-1+Number.EPSILON?(i=Math.atan2(p.z.x,-p.z.y),n=Math.acos(p.z.z),r=Math.atan2(p.x.z,p.y.z)):(i=-Math.atan2(-p.y.x,p.x.x),n=180,r=0):(i=Math.atan2(-p.y.x,p.x.x),n=0,r=0),{yaw:i,pitch:n,roll:r}}function S(e,t,i,r){e.localTangentSpace(i,{xAxis:f.x,yAxis:f.y,zAxis:f.z,position:g.vector3[0]});const s=g.vector3[2].copy(t.position).sub(g.vector3[0]);r&&(s.projectOnPlane(r),f.z.projectOnPlane(r).normalize());const o=s.length();if(o<1e-5)return c.error("Can not calculate tilt for the zero length vector!"),0;s.divideScalar(o);const a=s.dot(f.z);return a>=1-Number.EPSILON?0:Math.acos(n.MathUtils.clamp(a,-1,1))}function E(e,t){const i=s.EarthConstants.EQUATORIAL_CIRCUMFERENCE/Math.pow(2,t);return e.focalLength*i/256}e.MAX_TILT_DEG=89,e.MAX_TILT_RAD=e.MAX_TILT_DEG*n.MathUtils.DEG2RAD,e.zoomOnTargetPosition=function(i,n,s,o,a=e.MAX_TILT_RAD){const{elevationProvider:l,camera:c,projection:u}=i,d=l?l.getHeight(u.unprojectPoint(c.position),4):void 0,m=_(i,n,s,d),p=e.getTargetAndDistance(u,c,l).target,f=E(i,o);if(i.geoMaxBounds&&h(p,f,i).distance!==f)return o>=i.zoomLevel;if(c.getWorldDirection(c.position).multiplyScalar(-f).add(p),u.type===r.ProjectionType.Spherical){const e=T(c,u)-a;e>0&&t(i,{deltaTilt:e,maxTiltAngle:a})}const g=_(i,n,s,d);return!m||!g||(u.type===r.ProjectionType.Planar?(m.sub(g),x(i,m.x,m.y)):u.type===r.ProjectionType.Spherical&&w(i,m,g),!0)},e.orbitAroundScreenPoint=t,e.getGeoTargetFromCamera=function(e,t,n){const r=i(e,t,n);return null!==r?t.unprojectPoint(r):null},e.getWorldTargetFromCamera=i,e.constrainTargetAndDistanceToViewBounds=h,e.getTargetAndDistance=function(t,n,o){const a=M({projection:t},n).pitch,l=o?o.getHeight(t.unprojectPoint(n.position),4):void 0,c=!o||void 0!==l,h=a<e.MAX_TILT_RAD?i(n,t,l):null;if(null!==h)return{target:h,distance:n.position.distanceTo(h),final:c};{const i=t.groundDistance(n.position),o=Math.max(i-(null!=l?l:0),0),h=t.type===r.ProjectionType.Planar?o/Math.cos(Math.min(a,e.MAX_TILT_RAD)):Math.sqrt(Math.pow(o+s.EarthConstants.EQUATORIAL_RADIUS,2)-Math.pow(s.EarthConstants.EQUATORIAL_RADIUS,2)),u=n.getWorldDirection(g.vector3[0]);u.multiplyScalar(h);const d=g.vector3[1];return d.copy(n.position).add(u),{target:d,distance:h,final:c}}},e.getCameraPositionFromTarget=y,e.wrapGeoPointsToScreen=function(e,t){let i=0;void 0===t&&(t=r.GeoCoordinates.fromObject(e[0]),i=1);let n=t.latitude,s=t.latitude,o=r.MathUtils.normalizeLongitudeDeg(t.longitude),a=0,l=t.longitude,c=t.longitude;const h=[];h.push(new r.GeoCoordinates(n,o));for(let t=i;t<e.length;t++){const i=r.GeoCoordinates.fromObject(e[t]);i.latitude>n?n=i.latitude:i.latitude<s&&(s=i.latitude);let u=r.MathUtils.normalizeLongitudeDeg(i.longitude);const d=r.MathUtils.angleDistanceDeg(o,u);u=o-d,d<0&&-d>a/2?(l=Math.max(l,o-d),a=l-c,o=(l+c)/2):d>0&&d>a/2&&(c=Math.min(c,u),a=l-c,o=(l+c)/2),h.push(new r.GeoCoordinates(i.latitude,u))}return h},e.wrapWorldPointsToView=function(e,t){const i=t.clone().normalize();for(const n of e)if(n.angleTo(t)>Math.PI/2){const e=n.length();n.projectOnPlane(i).setLength(e)}},e.geoBoxToGeoPoints=function(e){const t=e.center;return[new r.GeoCoordinates(e.north,e.west),new r.GeoCoordinates(e.north,e.east),new r.GeoCoordinates(t.latitude,e.west),new r.GeoCoordinates(t.latitude,e.east),new r.GeoCoordinates(e.south,e.west),new r.GeoCoordinates(e.south,e.east),new r.GeoCoordinates(e.north,t.longitude),new r.GeoCoordinates(e.south,t.longitude)]},e.getCameraCoordinatesFromTargetCoordinates=function(e,t,i,n,r){return r.projection.unprojectPoint(y(e,t,i,n,r.projection,g.vector3[1]))},e.rayCastWorldCoordinates=_,e.panCameraAboveFlatMap=x,e.panCameraAroundGlobe=w,e.rotate=function(t,i,o=0,a=Math.PI/4){if(t.camera.rotateOnWorldAxis(t.projection.type===r.ProjectionType.Spherical?g.vector3[0].copy(t.camera.position).normalize():g.vector3[0].set(0,0,1),n.MathUtils.degToRad(-i)),t.camera.updateMatrixWorld(),0===o)return;const l=e.extractAttitude(t,t.camera).pitch;let c=n.MathUtils.clamp(l+n.MathUtils.degToRad(o),0,a);if(t.projection.type===r.ProjectionType.Spherical){const e=Math.asin(s.EarthConstants.EQUATORIAL_RADIUS*Math.sin(Math.PI-a)/t.camera.position.length());c=Math.min(c,e)}t.camera.rotateX(c-l)},e.getCameraRotationAtTarget=b,e.setRotation=function(e,t,i){b(e.projection,e.geoCenter,t,i,e.camera.quaternion)},e.extractCameraTilt=T,e.extractAttitude=M,e.extractSphericalCoordinatesFromLocation=function(e,t,i){e.projection.localTangentSpace(i,{xAxis:f.x,yAxis:f.y,zAxis:f.z,position:g.vector3[0]});let n=0,r=0;return g.vector3[1].copy(t.position).sub(g.vector3[0]).normalize(),g.vector3[1].dot(f.z)>1-Number.EPSILON?(r=Math.PI-M(e,t).yaw,r=Math.atan2(Math.sin(r),Math.cos(r)),n=0,{tilt:n,azimuth:r}):(n=g.vector3[1].angleTo(f.z),g.vector3[1].copy(t.position).sub(g.vector3[0]).projectOnPlane(f.z).normalize(),r=g.vector3[1].angleTo(f.y),g.vector3[1].cross(f.y).dot(f.z)<0&&(r=-r),{tilt:n,azimuth:r})},e.extractTiltAngleFromLocation=S,e.getCameraFrustumPlanes=function(e){const t=e.near,i=e.far;let r=t*Math.tan(n.MathUtils.degToRad(.5*e.fov))/e.zoom,s=2*r,o=e.aspect*s,a=-.5*o;const l=e.view;if(null!==l&&l.enabled){const e=l.fullWidth,t=l.fullHeight;a+=l.offsetX*o/e,r-=l.offsetY*s/t,o*=l.width/e,s*=l.height/t}return a+=0!==e.filmOffset?t*e.filmOffset/e.getFilmWidth():0,{left:a,right:a+o,top:r,bottom:r-s,near:t,far:i}},e.rayCastGeoCoordinates=function(e,t,i){const n=_(e,t,i);return n?e.projection.unprojectPoint(n):null},e.calculateDistanceToGroundFromZoomLevel=function(e,t){const i=M(e,e.camera).pitch,n=s.EarthConstants.EQUATORIAL_CIRCUMFERENCE/Math.pow(2,t);return e.focalLength*n/256*Math.cos(i)},e.calculateDistanceFromZoomLevel=E,e.calculateZoomLevelFromDistance=function(e,t){const i=256*t/e.focalLength;return function(e){const t=Math.ceil(e);return t-e<1e-6?t:e}(n.MathUtils.clamp(Math.log2(s.EarthConstants.EQUATORIAL_CIRCUMFERENCE/i),e.minZoomLevel,e.maxZoomLevel))},e.calculateDepthFromClipDistance=function(e,t){const i=t,n=i.far-i.near,r=e*i.far;return(1-i.near/r)*(i.far/n)},e.cameraToWorldDistance=function(e,t){return e*t.far},e.calculateVerticalFovByHorizontalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)/t)},e.calculateHorizontalFovByVerticalFov=function(e,t){return v.fov=n.MathUtils.radToDeg(e),v.aspect=t,a.CameraUtils.getHorizontalFov(v)},e.calculateFocalLengthByVerticalFov=function(e,t){return a.CameraUtils.setPrincipalPoint(v,new n.Vector2),a.CameraUtils.setVerticalFov(v,e,t),a.CameraUtils.getFocalLength(v)},e.calculateFovByFocalLength=function(e,t){return a.CameraUtils.setPrincipalPoint(v,new n.Vector2),a.CameraUtils.setFocalLength(v,e,t),v.fov},e.calculateScreenSizeByFocalLength=a.CameraUtils.convertWorldToScreenSize,e.calculateWorldSizeByFocalLength=a.CameraUtils.convertScreenToWorldSize,e.estimateObject3dSize=l.Object3DUtils.estimateSize,e.mapViewIsLoading=function(e){let t=0;for(const i of e.visibleTileSet.dataSourceTileList){t+=i.numTilesLoading;for(const e of i.visibleTiles)e.allGeometryLoaded||t++}let i=t>0;return void 0!==e.iconTextRenderer&&(i=i||e.iconTextRenderer.loading),i=i||!e.visibleTileSet.allVisibleTilesLoaded,i},e.closeToFrustum=function(e,t,i=1e-13){const r=(new n.Vector3).copy(e).project(t);return Math.abs(r.x)-i<1&&Math.abs(r.y)-i<1&&Math.abs(r.z)-i<1},e.getBrowserLanguages=o.DOMUtils.getBrowserLanguages}(t.MapViewUtils||(t.MapViewUtils={})),(y=t.TileOffsetUtils||(t.TileOffsetUtils={})).getKeyForTileKeyAndOffset=r.TileKeyUtils.getKeyForTileKeyAndOffset,y.extractOffsetAndMortonKeyFromKey=r.TileKeyUtils.extractOffsetAndMortonKeyFromKey,y.getParentKeyFromKey=r.TileKeyUtils.getParentKeyFromKey},5008:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisibleTileSet=t.ResourceComputationType=void 0;const n=i(82),r=i(2616),s=i(8263),o=i(4342),a=i(5863),l=i(8502);var c,h;!function(e){e[e.EstimationInMb=0]="EstimationInMb",e[e.NumberOfTiles=1]="NumberOfTiles"}(c=t.ResourceComputationType||(t.ResourceComputationType={})),function(e){e[e.NONE=0]="NONE",e[e.UP=1]="UP",e[e.DOWN=2]="DOWN",e[e.BOTH=3]="BOTH"}(h||(h={}));const u=1/1048576;class d{static getKey(e,t,i){return`${i.name}_${e}_${t}`}static getKeyForTile(e){return d.getKey(e.tileKey.mortonCode(),e.offset,e.dataSource)}constructor(e,t=c.EstimationInMb){this.m_disposedTiles=[],this.m_resourceComputationType=t,this.m_tileCache=new s.LRUCache(e,(e=>this.m_resourceComputationType===c.EstimationInMb?e.memoryUsage*u:1)),this.m_tileCache.evictionCallback=(e,t)=>{void 0!==t.tileLoader&&t.tileLoader.cancel(),this.m_disposedTiles.push(t)},this.m_tileCache.canEvict=(e,t)=>!t.isVisible}get resourceComputationType(){return this.m_resourceComputationType}get capacity(){return this.m_tileCache.capacity}get size(){return this.m_tileCache.size}setCapacity(e,t){this.m_resourceComputationType=t,this.m_tileCache.setCapacityAndMeasure(e,(e=>this.m_resourceComputationType===c.EstimationInMb?e.memoryUsage*u:1))}get(e,t,i){return this.m_tileCache.get(d.getKey(e,t,i))}set(e,t,i,n){this.m_tileCache.set(d.getKey(e,t,i),n)}delete(e){const t=d.getKeyForTile(e);this.deleteByKey(t)}deleteByKey(e){this.m_tileCache.delete(e)}disposeTiles(){this.m_disposedTiles.forEach((e=>{e.dispose()})),this.m_disposedTiles.length=0}shrinkToCapacity(){this.m_tileCache.shrinkToCapacity()}evictAll(){this.m_tileCache.evictAll()}evictSelected(e){this.m_tileCache.evictSelected(e)}forEach(e,t){this.m_tileCache.forEach(((i,n)=>{void 0!==t&&i.dataSource!==t||e(i,n)}))}}const m=(e,t)=>{const i=e.distance-t.distance,n=1e-6*(e.distance+t.distance);return Math.abs(i)<n?e.tileKey.mortonCode()-t.tileKey.mortonCode():i};t.VisibleTileSet=class{constructor(e,t,i){var r;this.m_frustumIntersection=e,this.m_tileGeometryManager=t,this.options=i,this.dataSourceTileList=[],this.allVisibleTilesLoaded=!1,this.m_cameraOverride=new n.PerspectiveCamera,this.m_viewRange={near:.1,far:1/0,minimum:.1,maximum:1/0},this.m_coveringMap=new Map,this.m_resourceComputationType=c.EstimationInMb,this.options=i,this.options.maxTilesPerFrame=Math.floor(null!==(r=this.options.maxTilesPerFrame)&&void 0!==r?r:0),this.m_resourceComputationType=void 0===i.resourceComputationType?c.EstimationInMb:i.resourceComputationType,this.m_dataSourceCache=new d(this.options.tileCacheSize,this.m_resourceComputationType)}getDataSourceCacheSize(){return this.options.tileCacheSize}setDataSourceCacheSize(e,t=c.EstimationInMb){this.options.tileCacheSize=e,this.resourceComputationType=t}getNumberOfVisibleTiles(){return this.options.maxVisibleDataSourceTiles}setNumberOfVisibleTiles(e){this.options.maxVisibleDataSourceTiles=e}get maxTilesPerFrame(){return this.options.maxTilesPerFrame}set maxTilesPerFrame(e){if(e<0)throw new Error("Invalid value, this will result in no tiles ever showing");this.options.maxTilesPerFrame=Math.floor(e)}get resourceComputationType(){return this.m_resourceComputationType}set resourceComputationType(e){this.m_resourceComputationType=e,this.m_dataSourceCache.setCapacity(this.options.tileCacheSize,e)}updateClipPlanes(e,t){void 0!==e&&(this.options.clipPlanesEvaluator.maxElevation=e),void 0!==t&&(this.options.clipPlanesEvaluator.minElevation=t);const{camera:i,projection:n,elevationProvider:r}=this.m_frustumIntersection.mapView;return this.m_viewRange=this.options.clipPlanesEvaluator.evaluateClipPlanes(i,n,r),this.m_viewRange}updateRenderList(e,t,i,n,r){let s=!0;const a=this.getVisibleTileKeysForDataSources(t,i,r);this.dataSourceTileList=[],this.m_coveringMap.clear();for(const{dataSource:i,visibleTileKeys:r}of a.tileKeys){r.sort(m);const o=i.getDataZoomLevel(t),a=this.processVisibleTiles(r,i,n,{newTilesPerFrame:0},!0),l=this.processVisibleTiles(a.dependentTiles,i,n,{newTilesPerFrame:0},!1);this.m_tileGeometryManager.updateTiles(a.visibleTiles),this.m_tileGeometryManager.updateTiles(l.visibleTiles),this.dataSourceTileList.push({dataSource:i,storageLevel:e,zoomLevel:o,allVisibleTileLoaded:a.allDataSourceTilesLoaded&&l.allDataSourceTilesLoaded,numTilesLoading:a.numTilesLoading+l.numTilesLoading,visibleTiles:[...a.visibleTiles,...l.visibleTiles],renderedTiles:new Map}),s=s&&a.allDataSourceTilesLoaded}let l,c;this.allVisibleTilesLoaded=s&&a.allBoundingBoxesFinal,this.populateRenderedTiles(),this.forEachCachedTile((e=>{e.isVisible||e.allGeometryLoaded||this.disposeTile(e)})),this.m_dataSourceCache.shrinkToCapacity(),this.dataSourceTileList.forEach((e=>{e.renderedTiles.forEach((t=>{t.update(e.zoomLevel),l=o.MathUtils.min2(l,t.geoBox.minAltitude),c=o.MathUtils.max2(c,t.geoBox.maxAltitude)}))})),void 0===l&&(l=0),void 0===c&&(c=0);let h=!1;const u=this.m_viewRange,d=this.updateClipPlanes(c,l);var p,f;return h=0==(f=u,(p=d).far===f.far&&p.maximum===f.maximum&&p.minimum===f.minimum&&p.near===f.near),{viewRanges:d,viewRangesChanged:h}}getTile(e,t,i,n){return this.getTileImpl(e,t,i,!1,n)}getCachedTile(e,t,i,n){return(0,o.assert)(e.cacheable),this.getTileImpl(e,t,i,!0,n)}getRenderedTile(e,t,i=0){const n=this.dataSourceTileList.find((t=>t.dataSource===e));if(void 0!==n)return n.renderedTiles.get(r.TileKeyUtils.getKeyForTileKeyAndOffset(t,i))}getRenderedTileAtLocation(e,t,i=0){const n=this.dataSourceTileList.find((t=>t.dataSource===e));if(void 0===n)return;const s=e.getTilingScheme(),o=n.zoomLevel,a=s.getTileKey(t,o);if(!a)return;let l=n.renderedTiles.get(r.TileKeyUtils.getKeyForTileKeyAndOffset(a,i));if(void 0!==l)return l;const{searchLevelsUp:c,searchLevelsDown:h}=this.getSearchDirection(e,o);let u=a;for(let e=1;e<=c;++e)if(u=u.parent(),l=n.renderedTiles.get(r.TileKeyUtils.getKeyForTileKeyAndOffset(u,i)),void 0!==l)return l;const d=s.projection.projectPoint(t);for(let e=1;e<=h;++e){const t=o+e,a=r.TileKeyUtils.worldCoordinatesToTileKey(s,d,t);if(a&&(l=n.renderedTiles.get(r.TileKeyUtils.getKeyForTileKeyAndOffset(a,i)),void 0!==l))return l}}removeDataSource(e){this.clearTileCache(e),this.dataSourceTileList=this.dataSourceTileList.filter((t=>t.dataSource!==e))}clearTileCache(e,t){void 0!==e?this.m_dataSourceCache.evictSelected(((i,n)=>i.dataSource===e&&(void 0===t||t(i)))):void 0!==t?this.m_dataSourceCache.evictSelected(t):this.m_dataSourceCache.evictAll()}markTilesDirty(e,t){if(void 0===e)this.dataSourceTileList.forEach((e=>{this.markDataSourceTilesDirty(e,t)}));else{const i=this.dataSourceTileList.find((t=>t.dataSource===e));if(void 0===i)return;this.markDataSourceTilesDirty(i,t)}}disposePendingTiles(){this.m_dataSourceCache.disposeTiles()}forEachVisibleTile(e){for(const t of this.dataSourceTileList)t.renderedTiles.forEach(e)}forEachCachedTile(e,t){this.m_dataSourceCache.forEach(((t,i)=>e(t)),t)}disposeTile(e){this.m_dataSourceCache.delete(e),e.dispose()}processVisibleTiles(e,t,i,n,r){var s;let o=!0,a=0;const c=[],h=[];for(let u=0;u<e.length&&c.length<this.options.maxVisibleDataSourceTiles;u++){const d=e[u],m=this.getTile(t,d.tileKey,d.offset,i);if(void 0!==m&&(c.push(m),o=o&&m.allGeometryLoaded,m.allGeometryLoaded?(this.skipOverlappedTiles(t,m),this.processDelayTileRendering(m,n.newTilesPerFrame,i)&&n.newTilesPerFrame++):a++,m.visibleArea=d.area,m.elevationRange=null!==(s=d.elevationRange)&&void 0!==s?s:{minElevation:0,maxElevation:0},r))for(const t of m.dependencies)void 0===e.find((e=>e.tileKey.mortonCode()===t.mortonCode()))&&void 0===h.find((e=>e.tileKey.mortonCode()===t.mortonCode()))&&h.push(new l.TileKeyEntry(t,0))}return{allDataSourceTilesLoaded:o,numTilesLoading:a,visibleTiles:c,dependentTiles:h}}processDelayTileRendering(e,t,i){let n=!1;return 0!==this.options.maxTilesPerFrame&&t>this.options.maxTilesPerFrame&&e.frameNumLastVisible!==i-1?(e.delayRendering=!0,e.mapView.update()):(e.frameNumVisible<0&&(e.frameNumVisible=i,n=!0),e.numFramesVisible++,e.delayRendering=!1),n}skipOverlappedTiles(e,t){if(this.options.projection.type!==r.ProjectionType.Spherical&&e.isFullyCovering()){const i=t.uniqueKey,n=this.m_coveringMap.get(i);void 0===n?(t.skipRendering=!1,this.m_coveringMap.set(i,t)):n.dataSource instanceof a.BackgroundDataSource?n.skipRendering=!0:e instanceof a.BackgroundDataSource&&(t.skipRendering=!0)}}getSearchDirection(e,t){const i=Math.min(this.options.quadTreeSearchDistanceUp,Math.max(0,t-e.minDataLevel)),n=Math.min(this.options.quadTreeSearchDistanceDown,Math.max(0,e.maxDataLevel-t));return{searchDirection:n>0&&i>0?h.BOTH:n>0?h.DOWN:i>0?h.UP:h.NONE,searchLevelsUp:i,searchLevelsDown:n}}populateRenderedTiles(){this.dataSourceTileList.forEach((e=>{const t=e.renderedTiles,i=[];e.visibleTiles.forEach((e=>{e.levelOffset=0,e.hasGeometry&&!e.delayRendering?t.set(e.uniqueKey,e):i.push(e.uniqueKey)}));const n=e.dataSource;if(0===i.length||!1===n.allowOverlappingTiles)return;const r=e.zoomLevel,{searchDirection:s}=this.getSearchDirection(n,r),o=new Map;for(const e of i)(s!==h.BOTH&&s!==h.UP||!this.findUp(e,r,t,o,n))&&(s!==h.BOTH&&s!==h.DOWN||this.findDown(e,r,t,n))}))}findDown(e,t,i,n){const{offset:s,mortonCode:o}=r.TileKeyUtils.extractOffsetAndMortonKeyFromKey(e),a=r.TileKey.fromMortonCode(o),l=n.getTilingScheme();for(const e of l.getSubTileKeys(a)){const o=r.TileKeyUtils.getKeyForTileKeyAndOffset(e,s),a=this.m_dataSourceCache.get(e.mortonCode(),s,n),l=Math.abs(e.level-t);void 0===a||!a.hasGeometry||a.delayRendering?l<this.options.quadTreeSearchDistanceDown&&this.findDown(o,t,i,n):(i.set(o,a),a.levelOffset=l)}}findUp(e,t,i,n,s){const o=r.TileKeyUtils.getParentKeyFromKey(e);if(void 0!==i.get(o))return!0;const a=n.get(o);if(void 0!==a)return a;const{offset:l,mortonCode:c}=r.TileKeyUtils.extractOffsetAndMortonKeyFromKey(o),h=this.m_dataSourceCache.get(c,l,s),u=h?h.tileKey:r.TileKey.fromMortonCode(c),d=Math.abs(t-u.level);if(void 0!==h&&h.hasGeometry&&!h.delayRendering)return n.set(o,!0),i.set(o,h),h.levelOffset=-d,!0;if(n.set(o,!1),d<this.options.quadTreeSearchDistanceUp&&0!==u.level){const e=this.findUp(o,t,i,n,s);if(n.set(o,e),e)return!0}return!1}getTileImpl(e,t,i,n,r){function s(e){e.frameNumLastRequested=r}if(!e.cacheable&&!n){const i=e.getTile(t,!0);return void 0!==i&&(i.load(),s(i)),i}const o=this.m_dataSourceCache;let a=o.get(t.mortonCode(),i,e);return void 0!==a&&a.offset===i?(s(a),a):n?void 0:(a=e.getTile(t,!0),void 0!==a&&(a.load(),a.offset=i,s(a),o.set(t.mortonCode(),i,e,a)),a)}markDataSourceTilesDirty(e,t){const i=this.m_dataSourceCache,n=new Set,r=e=>{const t=d.getKeyForTile(e);n.has(t)||(n.add(t),e.load(!0))};e.visibleTiles.forEach((e=>{(void 0===t||t(e))&&r(e)})),e.renderedTiles.forEach((e=>{(void 0===t||t(e))&&r(e)})),i.forEach(((e,r)=>{void 0!==t&&!t(e)||n.has(r)||(i.deleteByKey(r),e.dispose())}),e.dataSource)}getVisibleTileKeysForDataSources(e,t,i){const n=Array();let r=!0;if(0===t.length)return{tileKeys:n,allBoundingBoxesFinal:r};const s=new Map;t.forEach((e=>{const t=e.getTilingScheme(),i=s.get(t);void 0===i?s.set(t,[e]):i.push(e)})),void 0!==i?(this.m_cameraOverride.copy(this.m_frustumIntersection.camera),this.m_cameraOverride.near=Math.min(this.m_cameraOverride.near,this.m_viewRange.minimum),this.m_cameraOverride.far=Math.max(this.m_cameraOverride.far,this.m_viewRange.maximum),this.m_cameraOverride.updateProjectionMatrix(),this.m_frustumIntersection.updateFrustum(this.m_cameraOverride.projectionMatrix)):this.m_frustumIntersection.updateFrustum();for(const[t,o]of s){const s=o.map((t=>t.getDataZoomLevel(e))),a=this.m_frustumIntersection.compute(t,i,s,o);r=r&&a.calculationFinal;for(const t of o){const i=[],r=t.getDataZoomLevel(e);for(const e of a.tileKeyEntries.get(r).values())t.canGetTile(r,e.tileKey)&&i.push(e);n.push({dataSource:t,visibleTileKeys:i})}}return{tileKeys:n,allBoundingBoxesFinal:r}}}},9931:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerBasedDecoder=void 0;const n=i(8152);let r=0;t.WorkerBasedDecoder=class{constructor(e,t){this.workerSet=e,this.decoderServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=`${this.decoderServiceType}-${r++}`}dispose(){this.m_serviceCreated&&this.workerSet.broadcastRequest(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:n.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}).catch((()=>{})),this.workerSet.removeReference()}async connect(){await this.workerSet.connect(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID),this.m_serviceCreated||(await this.workerSet.broadcastRequest(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:n.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.decoderServiceType,targetServiceId:this.serviceId}),this.m_serviceCreated=!0)}decodeTile(e,t,i,r){const s=t.mortonCode(),o={type:n.WorkerDecoderProtocol.Requests.DecodeTileRequest,tileKey:s,data:e,projection:(0,n.getProjectionName)(i)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,o,a,r)}getTileInfo(e,t,i,r){const s=t.mortonCode(),o={type:n.WorkerDecoderProtocol.Requests.TileInfoRequest,tileKey:s,data:e,projection:(0,n.getProjectionName)(i)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,o,a,r)}configure(e,t){const i=Object.assign(Object.assign({service:this.serviceId,type:n.WorkerDecoderProtocol.DecoderMessageName.Configuration},e),{options:t});this.workerSet.broadcastMessage(i)}get workerCount(){return this.workerSet.workerCount}}},3373:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerBasedTiler=void 0;const n=i(8152);let r=0;t.WorkerBasedTiler=class{constructor(e,t){this.workerSet=e,this.tilerServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=`${this.tilerServiceType}-${r++}`}dispose(){this.m_serviceCreated&&this.workerSet.broadcastRequest(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:n.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}).catch((()=>{})),this.workerSet.removeReference()}async connect(){await this.workerSet.connect(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID),this.m_serviceCreated||(await this.workerSet.broadcastRequest(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:n.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.tilerServiceType,targetServiceId:this.serviceId}),this.m_serviceCreated=!0)}registerIndex(e,t){const i={type:n.WorkerTilerProtocol.Requests.RegisterIndex,id:e,input:t instanceof URL?t.href:t};return this.workerSet.invokeRequest(this.serviceId,i)}updateIndex(e,t){const i={type:n.WorkerTilerProtocol.Requests.UpdateIndex,id:e,input:t instanceof URL?t.href:t};return this.workerSet.invokeRequest(this.serviceId,i)}getTile(e,t){const i=t.mortonCode(),r={type:n.WorkerTilerProtocol.Requests.TileRequest,index:e,tileKey:i};return this.workerSet.invokeRequest(this.serviceId,r)}}},2453:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LowResRenderPass=void 0;const n=i(82),r=i(4250),s=i(2331);class o extends s.Pass{constructor(e){super(),this.lowResPixelRatio=e,this.m_renderTarget=null,this.m_localCamera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_quadScene=new n.Scene,this.m_quadUniforms=r.CopyShader.uniforms,this.m_quadMaterial=new r.CopyMaterial(this.m_quadUniforms),this.m_quad=new n.Mesh(new n.PlaneBufferGeometry(2,2),this.m_quadMaterial),this.m_savedWidth=0,this.m_savedHeight=0,this.m_quad.frustumCulled=!1,this.m_quadScene.add(this.m_quad),this.m_pixelRatio=e}dispose(){this.m_quadMaterial.dispose(),this.m_quad.geometry.dispose(),null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)}set pixelRatio(e){this.m_pixelRatio=e,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio))}get pixelRatio(){return this.m_pixelRatio}render(e,t,i,r,s){if(!this.enabled||void 0===this.pixelRatio)return;null===this.m_renderTarget&&(this.m_savedWidth=s.width,this.m_savedHeight=s.height,this.m_renderTarget=new n.WebGLRenderTarget(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio),{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat,depthBuffer:!0,stencilBuffer:!0}),this.m_renderTarget.texture.name="LowResRenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture,this.m_quadUniforms.opacity.value=1;const o=e.getRenderTarget();e.setRenderTarget(this.m_renderTarget),e.clear(),e.render(t,i),e.setRenderTarget(this.renderToScreen?null:r),e.clear(),e.render(this.m_quadScene,this.m_localCamera),e.setRenderTarget(o)}setSize(e,t){this.m_savedWidth=e,this.m_savedHeight=t,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(e*this.pixelRatio),Math.floor(t*this.pixelRatio))}}t.LowResRenderPass=o},818:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSAARenderPass=t.MSAASampling=void 0;const n=i(82),r=i(4250),s=i(2331);var o;!function(e){e[e.Level_0=0]="Level_0",e[e.Level_1=1]="Level_1",e[e.Level_2=2]="Level_2",e[e.Level_3=3]="Level_3",e[e.Level_4=4]="Level_4",e[e.Level_5=5]="Level_5"}(o=t.MSAASampling||(t.MSAASampling={}));class a extends s.Pass{constructor(){super(),this.samplingLevel=o.Level_1,this.m_renderTarget=null,this.m_localCamera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_quadScene=new n.Scene,this.m_quadUniforms=r.CopyShader.uniforms,this.m_quadMaterial=new r.MSAAMaterial(this.m_quadUniforms),this.m_quad=new n.Mesh(new n.PlaneBufferGeometry(2,2),this.m_quadMaterial),this.m_tmpColor=new n.Color,this.m_quad.frustumCulled=!1,this.m_quadScene.add(this.m_quad)}dispose(){null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)}render(e,t,i,r,s){if(!this.enabled)return;null===this.m_renderTarget&&(this.m_renderTarget=new n.WebGLRenderTarget(s.width,s.height,{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat}),this.m_renderTarget.texture.name="MSAARenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture;const o=a.OffsetVectors[this.samplingLevel],l=e.getClearColor(this.m_tmpColor),c=void 0!==l?l.getHex():0,h={enabled:null!==i.view&&i.view.enabled,fullWidth:s.width,fullHeight:s.height,x:0,y:0,width:s.width,height:s.height};h.enabled&&null!==i.view&&(h.fullWidth=i.view.fullWidth,h.fullHeight=i.view.fullHeight,h.x=i.view.offsetX,h.y=i.view.offsetY,h.width=i.view.width,h.height=i.view.height);const u=e.getRenderTarget();for(let n=0;n<o.length;n++){const s=o[n];i.setViewOffset(h.fullWidth,h.fullHeight,h.x+s[0]/16,h.y+s[1]/16,h.width,h.height);const a=(n+.5)/o.length-.5,u=1/o.length+a/32;this.m_quadUniforms.opacity.value=u,e.setRenderTarget(this.m_renderTarget),e.clear(),e.render(t,i),e.setRenderTarget(this.renderToScreen?null:r),0===n&&(e.setClearColor(0),e.clear()),e.render(this.m_quadScene,this.m_localCamera),0===n&&void 0!==l&&e.setClearColor(c)}e.setRenderTarget(u),null!==i.view&&(i.view.enabled=h.enabled,i.view.offsetX=h.x,i.view.offsetY=h.y)}setSize(e,t){this.m_renderTarget&&this.m_renderTarget.setSize(e,t)}}t.MSAARenderPass=a,a.OffsetVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]]},9886:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapRenderingManager=void 0;const n=i(82),r=i(4250),s=i(2453),o=i(818),a=i(8794),l=i(2331),c=i(6721),h=o.MSAASampling.Level_1,u=o.MSAASampling.Level_4;t.MapRenderingManager=class{constructor(e,t,i,a={msaaEnabled:!1}){this.bloom={enabled:!1,strength:1.5,radius:.4,threshold:.85},this.outline={enabled:!1,thickness:.005,color:"#000000",ghostExtrudedPolygons:!1,needsUpdate:!1},this.vignette={enabled:!1,offset:1,darkness:1},this.sepia={enabled:!1,amount:.5},this.m_width=1,this.m_height=1,this.m_renderPass=new l.RenderPass,this.m_target1=new n.WebGLRenderTarget(1,1),this.m_target2=new n.WebGLRenderTarget(1,1),this.m_sepiaPass=new l.ShaderPass(r.SepiaShader),this.m_vignettePass=new l.ShaderPass(r.VignetteShader),this.m_readBuffer=new n.WebGLRenderTarget(e,t),this.m_msaaPass=new o.MSAARenderPass,this.m_msaaPass.enabled=void 0!==a&&!0===a.msaaEnabled,this.m_dynamicMsaaSamplingLevel=void 0===a.dynamicMsaaSamplingLevel?h:a.dynamicMsaaSamplingLevel,this.m_staticMsaaSamplingLevel=void 0===a.staticMsaaSamplingLevel?u:a.staticMsaaSamplingLevel,this.m_lowResPass=new s.LowResRenderPass(i),this.m_lowResPass.enabled=void 0!==i}updateOutline(e){this.outline.color=e.color,this.outline.thickness=e.thickness,this.outline.ghostExtrudedPolygons=e.ghostExtrudedPolygons,this.outline.needsUpdate=!0}render(e,t,i,r){if(!r&&void 0!==this.m_lowResPass.pixelRatio)return this.m_lowResPass.renderToScreen=!0,void this.m_lowResPass.render(e,t,i,null,this.m_readBuffer);const s=this.bloom.enabled||this.outline.enabled||this.vignette.enabled||this.sepia.enabled;let o=null;if((this.bloom.enabled||this.vignette.enabled||this.sepia.enabled)&&(e.setRenderTarget(this.m_target1),e.clearDepth()),this.m_msaaPass.enabled?(this.m_msaaPass.samplingLevel=r?this.m_staticMsaaSamplingLevel:this.m_dynamicMsaaSamplingLevel,this.m_msaaPass.renderToScreen=!s,this.m_msaaPass.render(e,t,i,null,this.m_readBuffer)):this.bloom.enabled||this.vignette.enabled||this.sepia.enabled?(o=this.m_target1,this.m_renderPass.render(e,t,i,this.m_target1,null)):(!this.outline.enabled||this.outline.enabled&&!this.bloom.enabled)&&e.render(t,i),this.outline.enabled){void 0===this.m_outlineEffect&&(this.m_outlineEffect=new a.OutlineEffect(e)),this.outline.needsUpdate&&(this.m_outlineEffect.color=this.outline.color,this.m_outlineEffect.thickness=this.outline.thickness,this.m_outlineEffect.ghostExtrudedPolygons=this.outline.ghostExtrudedPolygons,this.outline.needsUpdate=!1);const n=this.bloom.enabled||this.vignette.enabled||this.sepia.enabled;n&&(o=this.m_target1),e.setRenderTarget(n?o:null),this.m_outlineEffect.render(t,i)}if(this.bloom.enabled){void 0===this.m_bloomPass&&(this.m_bloomPass=new c.BloomPass(new n.Vector2(this.m_width,this.m_height),this.bloom.strength,this.bloom.radius,this.bloom.threshold));const r=this.vignette.enabled||this.sepia.enabled;this.m_bloomPass.renderToScreen=!r,this.m_bloomPass.radius=this.bloom.radius,this.m_bloomPass.strength=this.bloom.strength,this.m_bloomPass.threshold=this.bloom.threshold,this.m_bloomPass.render(e,t,i,null,o)}else void 0!==this.m_bloomPass&&(this.m_bloomPass.dispose(),this.m_bloomPass=void 0);if(this.vignette.enabled){const n=o,r=this.sepia.enabled;this.m_vignettePass.uniforms.offset.value=this.vignette.offset,this.m_vignettePass.uniforms.darkness.value=this.vignette.darkness,this.m_vignettePass.renderToScreen=!r,r&&(o=o===this.m_target1?this.m_target2:this.m_target1),this.m_vignettePass.render(e,t,i,o,n)}this.sepia.enabled&&(this.m_sepiaPass.renderToScreen=!0,this.m_sepiaPass.uniforms.amount.value=this.sepia.amount,this.m_sepiaPass.render(e,t,i,null,o))}setSize(e,t){this.m_readBuffer.setSize(e,t),this.m_msaaPass.setSize(e,t),void 0!==this.m_bloomPass&&this.m_bloomPass.setSize(e,t),this.m_lowResPass.setSize(e,t),this.m_target1.setSize(e,t),this.m_target2.setSize(e,t),this.m_width=e,this.m_height=t}get lowResPixelRatio(){return this.m_lowResPass.pixelRatio}set lowResPixelRatio(e){this.m_lowResPass.pixelRatio=e,this.m_lowResPass.enabled=void 0!==e}set dynamicMsaaSamplingLevel(e){this.m_dynamicMsaaSamplingLevel=e}get dynamicMsaaSamplingLevel(){return this.m_dynamicMsaaSamplingLevel}set msaaEnabled(e){this.m_msaaPass.enabled=e}get msaaEnabled(){return this.m_msaaPass.enabled}set staticMsaaSamplingLevel(e){this.m_staticMsaaSamplingLevel=e}get staticMsaaSamplingLevel(){return this.m_staticMsaaSamplingLevel}}},8794:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutlineEffect=void 0;const n=i(82),r=i(4250),s=i(4342);t.OutlineEffect=class{constructor(e){this.m_renderer=e,this.enabled=!0,this.m_defaultThickness=.02,this.m_defaultColor=new n.Color(0,0,0),this.m_defaultAlpha=1,this.m_defaultKeepAlive=!1,this.m_ghostExtrudedPolygons=!1,this.m_cache={},this.m_removeThresholdCount=60,this.m_originalMaterials={},this.m_originalOnBeforeRenders={},this.m_shaderIDs={MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical"},this.m_uniformsChunk={outlineThickness:{value:this.m_defaultThickness},outlineColor:{value:this.m_defaultColor},outlineAlpha:{value:this.m_defaultAlpha}},this.autoClear=e.autoClear,this.domElement=e.domElement,this.shadowMap=e.shadowMap}set thickness(e){this.m_defaultThickness=e,this.m_uniformsChunk.outlineThickness.value=e,this.m_cache={}}set color(e){this.m_defaultColor.set(e),this.m_cache={}}set ghostExtrudedPolygons(e){this.m_ghostExtrudedPolygons=e}clear(e,t,i){this.m_renderer.clear(e,t,i)}getPixelRatio(){return this.m_renderer.getPixelRatio()}setPixelRatio(e){this.m_renderer.setPixelRatio(e)}getSize(e){return this.m_renderer.getSize(e)}setSize(e,t,i){this.m_renderer.setSize(e,t,i)}setViewport(e,t,i,n){this.m_renderer.setViewport(e,t,i,n)}setScissor(e,t,i,n){this.m_renderer.setScissor(e,t,i,n)}setScissorTest(e){this.m_renderer.setScissorTest(e)}setRenderTarget(e){this.m_renderer.setRenderTarget(e)}render(e,t){if(this.m_ghostExtrudedPolygons){if(!this.enabled)return void this.m_renderer.render(e,t);const i=this.m_renderer.autoClear;this.m_renderer.autoClear=this.autoClear,this.m_renderer.render(e,t),this.m_renderer.autoClear=i}this.renderOutline(e,t)}renderOutline(e,t){const i=this.m_renderer.autoClear,n=e.autoUpdate,r=e.background,s=this.m_renderer.shadowMap.enabled;e.autoUpdate=!1,e.background=null,this.m_renderer.autoClear=!1,this.m_renderer.shadowMap.enabled=!1,e.traverse(this.setOutlineMaterial.bind(this)),this.m_renderer.render(e,t),e.traverse(this.restoreOriginalMaterial.bind(this)),this.cleanupCache(),e.autoUpdate=n,e.background=r,this.m_renderer.autoClear=i,this.m_renderer.shadowMap.enabled=s}createInvisibleMaterial(){return new n.ShaderMaterial({name:"invisible",visible:!1})}createMaterial(e){if(e instanceof r.EdgeMaterial||!0===e.isDepthPrepassMaterial)return this.createInvisibleMaterial();const t=this.m_shaderIDs[e.type];let i,s=void 0!==e.shaderUniforms?e.shaderUniforms:e.uniforms;if(void 0!==t){const e=n.ShaderLib[t];s=e.uniforms,i=e.vertexShader}else if(!0===e.isRawShaderMaterial){if(i=e.vertexShader,!/attribute\s+vec3\s+position\s*;/.test(i)||!/attribute\s+vec3\s+normal\s*;/.test(i))return this.createInvisibleMaterial()}else{if(!0!==e.isShaderMaterial)return this.createInvisibleMaterial();i=e.vertexShader}const o=void 0!==e.shaderUniforms&&void 0!==e.shaderUniforms.extrusionRatio,a=r.FadingFeature.isDefined(e),l=Object.assign(Object.assign({},s),this.m_uniformsChunk),c=i.replace(/void\s+main\s*\(\s*\)/,"\n#ifdef USE_EXTRUSION\n  #ifndef HAS_EXTRUSION_PARS_VERTEX\n    #include <extrusion_pars_vertex>\n  #endif\n#endif\n\n#ifdef USE_FADING\n  #include <fading_pars_vertex>\n#endif\n\nuniform float outlineThickness;\n\nvec4 calculateOutline( vec4 pos, vec3 objectNormal, vec4 skinned ) {\n    float thickness = outlineThickness;\n    const float ratio = 1.0;\n    vec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + objectNormal, 1.0 );\n    vec4 norm = normalize( pos - pos2 );\n    return pos + norm * thickness * pos.w * ratio;\n}\nvoid main()").replace(/\}\s*$/,"\n#if ! defined( LAMBERT ) && ! defined( PHONG ) && ! defined( TOON ) && ! defined( STANDARD )\n    #ifndef USE_ENVMAP\n        vec3 objectNormal = normalize( normal );\n    #endif\n#endif\n\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n\n#ifdef DECLARE_TRANSFORMED\n    vec3 transformed = vec3( position );\n#endif\n\n#ifdef USE_EXTRUSION\n #ifndef HAS_EXTRUSION_VERTEX\n  #include <extrusion_vertex>\n #endif\n#endif\n\n#ifdef USE_FADING\n  #include <fading_vertex>\n#endif\n\n#ifdef USE_EXTRUSION\n  gl_Position = calculateOutline( projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 ),\n      objectNormal, vec4( transformed, 1.0 ) );\n#else\n  gl_Position = calculateOutline( gl_Position, objectNormal, vec4( transformed, 1.0 ) );\n#endif\n\n#include <fog_vertex>\n}").replace(/#include\s+<[\w_]*light[\w_]*>/g,""),h={};return/vec3\s+transformed\s*=/.test(i)||/#include\s+<begin_vertex>/.test(i)||(h.DECLARE_TRANSFORMED=!0),o&&(l.extrusionRatio={value:r.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN},h.USE_EXTRUSION=1),a&&(l.fadeNear={value:void 0!==s.fadeNear?s.fadeNear.value:r.FadingFeature.DEFAULT_FADE_NEAR},l.fadeFar={value:void 0!==s.fadeFar?s.fadeFar.value:r.FadingFeature.DEFAULT_FADE_FAR},h.USE_FADING=1),new n.ShaderMaterial({defines:h,uniforms:l,vertexShader:c,fragmentShader:"\n#include <common>\n#include <fog_pars_fragment>\n\n#ifdef USE_EXTRUSION\n  #include <extrusion_pars_fragment>\n#endif\n\n#ifdef USE_FADING\n  #include <fading_pars_fragment>\n#endif\n\nuniform vec3 outlineColor;\nuniform float outlineAlpha;\n\nvoid main() {\n\n    gl_FragColor = vec4( outlineColor, outlineAlpha );\n\n    #include <fog_fragment>\n\n    #ifdef USE_EXTRUSION\n      #include <extrusion_fragment>\n    #endif\n\n    #ifdef USE_FADING\n      #include <fading_fragment>\n    #endif\n}",side:n.BackSide,morphTargets:!1,morphNormals:!1,fog:!1,blending:n.CustomBlending,blendSrc:n.SrcAlphaFactor,blendDst:n.OneMinusSrcAlphaFactor,blendSrcAlpha:n.OneFactor,blendDstAlpha:n.OneMinusSrcAlphaFactor,transparent:!0,polygonOffset:!0,polygonOffsetFactor:10,polygonOffsetUnits:30})}getOutlineMaterialFromCache(e){let t=this.m_cache[e.uuid];return void 0===t&&(t={material:this.createMaterial(e),used:!0,keepAlive:this.m_defaultKeepAlive,count:0},this.m_cache[e.uuid]=t),t.used=!0,t.material}getOutlineMaterial(e){const t=this.getOutlineMaterialFromCache(e);return this.m_originalMaterials[t.uuid]=e,this.updateOutlineMaterial(t,e),t}setOutlineMaterial(e){if(void 0!==e.material){if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)e.material[t]=this.getOutlineMaterial(e.material[t]);else e.material=this.getOutlineMaterial(e.material);this.m_originalOnBeforeRenders[e.uuid]=e.onBeforeRender,e.onBeforeRender=(0,s.chainCallbacks)(e.onBeforeRender,this.onBeforeRender.bind(this))}}restoreOriginalMaterial(e){if(void 0!==e.material){if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)e.material[t]=this.m_originalMaterials[e.material[t].uuid];else e.material=this.m_originalMaterials[e.material.uuid];e.onBeforeRender=this.m_originalOnBeforeRenders[e.uuid]}}onBeforeRender(e,t,i,n,r,s){const o=this.m_originalMaterials[r.uuid];void 0!==o&&this.updateUniforms(r,o)}updateUniforms(e,t){var i;const n=t.userData.outlineParameters,s=e.uniforms;s.outlineAlpha.value=t.opacity;const o=void 0!==t.shaderUniforms?t.shaderUniforms:t.uniforms;if(void 0!==n&&(void 0!==n.thickness&&(s.outlineThickness.value=n.thickness),void 0!==n.color&&s.outlineColor.value.fromArray(n.color),void 0!==n.alpha&&(s.outlineAlpha.value=n.alpha)),void 0!==o&&void 0!==o.extrusionRatio){const i=t.shaderUniforms.extrusionRatio.value;e.extrusionRatio=i,e.uniforms.extrusionRatio.value=void 0!==i?i:r.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN}void 0!==(null===(i=e.defines)||void 0===i?void 0:i.USE_FADING)&&void 0!==o.fadeNear&&void 0!==o.fadeFar&&o.fadeFar.value>=0&&(s.fadeNear.value=o.fadeNear.value,s.fadeFar.value=o.fadeFar.value)}updateOutlineMaterial(e,t){if("invisible"===e.name)return;const i=t.userData.outlineParameters;e.skinning=t.skinning,e.morphTargets=t.morphTargets,e.morphNormals=t.morphNormals,e.fog=t.fog,void 0!==i?(e.visible=!1!==t.visible&&(void 0===i.visible||i.visible),void 0!==i.keepAlive&&(this.m_cache[t.uuid].keepAlive=i.keepAlive)):e.visible=t.visible,!0!==t.wireframe&&!1!==t.depthTest||(e.visible=!1)}cleanupCache(){let e;e=Object.keys(this.m_originalMaterials);for(let t=0,i=e.length;t<i;t++)this.m_originalMaterials[e[t]]=void 0;e=Object.keys(this.m_originalOnBeforeRenders);for(let t=0,i=e.length;t<i;t++)this.m_originalOnBeforeRenders[e[t]]=void 0;e=Object.keys(this.m_cache);for(const t of e)!1===this.m_cache[t].used?(this.m_cache[t].count++,!1===this.m_cache[t].keepAlive&&this.m_cache[t].count>this.m_removeThresholdCount&&delete this.m_cache[t]):(this.m_cache[t].used=!1,this.m_cache[t].count=0)}}},2331:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderPass=t.RenderPass=t.Pass=void 0;const n=i(82);class r{constructor(){this.enabled=!1,this.renderToScreen=!1}setSize(e,t){}render(e,t,i,n,r,s){}}t.Pass=r,t.RenderPass=class extends r{constructor(){super()}render(e,t,i,n,r){e.setRenderTarget(this.renderToScreen?null:n),e.render(t,i)}},t.ShaderPass=class extends r{constructor(e,t="tDiffuse"){super(),this.textureID=t,e instanceof n.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=n.UniformsUtils.clone(e.uniforms),this.material=new n.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new s(this.material)}render(e,t,i,n,r,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,e.setRenderTarget(this.renderToScreen?null:n),this.fsQuad.render(e)}};class s{constructor(e){this.m_camera=new n.OrthographicCamera(-1,1,1,-1,0,1);const t=new n.PlaneBufferGeometry(2,2);this.m_mesh=new n.Mesh(t,e)}get material(){return this.m_mesh.material}set material(e){this.m_mesh.material=e}render(e){e.render(this.m_mesh,this.m_camera)}}},6721:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BloomPass=void 0;const n=i(82),r=i(4250),s=i(2331),o=new n.Vector2(1,0),a=new n.Vector2(0,1);class l extends s.Pass{constructor(e,t,i,s){super(),this.resolution=new n.Vector2(256,256),this.m_renderTargetsHorizontal=[],this.m_renderTargetsVertical=[],this.m_nMips=5,this.m_separableBlurMaterials=[],this.m_camera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_scene=new n.Scene,this.m_basic=new n.MeshBasicMaterial,this.m_quad=new n.Mesh(new n.PlaneBufferGeometry(2,2)),this.m_bloomTintColors=[new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1)],this.strength=t,this.radius=i,this.threshold=s,this.resolution=e,this.m_quad.frustumCulled=!1,this.m_scene.add(this.m_quad);const o={minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat};let a=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);this.m_renderTargetBright=new n.WebGLRenderTarget(a,l,o),this.m_renderTargetBright.texture.name="UnrealBloomPass.bright",this.m_renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.m_nMips;e++){const t=new n.WebGLRenderTarget(a,l,o);t.texture.name="UnrealBloomPass.h"+e,t.texture.generateMipmaps=!1,this.m_renderTargetsHorizontal.push(t);const i=new n.WebGLRenderTarget(a,l,o);i.texture.name="UnrealBloomPass.v"+e,i.texture.generateMipmaps=!1,this.m_renderTargetsVertical.push(i),a=Math.round(a/2),l=Math.round(l/2)}this.m_highPassUniforms=n.UniformsUtils.clone(r.LuminosityHighPassShader.uniforms),this.m_highPassUniforms.luminosityThreshold.value=s,this.m_highPassUniforms.smoothWidth.value=.01,this.m_materialHighPassFilter=new n.ShaderMaterial({uniforms:this.m_highPassUniforms,vertexShader:r.LuminosityHighPassShader.vertexShader,fragmentShader:r.LuminosityHighPassShader.fragmentShader,defines:{}});const c=[3,5,7,9,11];a=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);for(let e=0;e<this.m_nMips;e++)this.m_separableBlurMaterials.push(this.getSeperableBlurMaterial(c[e])),this.m_separableBlurMaterials[e].uniforms.texSize.value=new n.Vector2(a,l),a=Math.round(a/2),l=Math.round(l/2);this.m_compositeMaterial=this.getCompositeMaterial(this.m_nMips),this.m_compositeMaterial.uniforms.blurTexture1.value=this.m_renderTargetsVertical[0].texture,this.m_compositeMaterial.uniforms.blurTexture2.value=this.m_renderTargetsVertical[1].texture,this.m_compositeMaterial.uniforms.blurTexture3.value=this.m_renderTargetsVertical[2].texture,this.m_compositeMaterial.uniforms.blurTexture4.value=this.m_renderTargetsVertical[3].texture,this.m_compositeMaterial.uniforms.blurTexture5.value=this.m_renderTargetsVertical[4].texture,this.m_compositeMaterial.uniforms.bloomStrength.value=t,this.m_compositeMaterial.uniforms.bloomRadius.value=.1,this.m_compositeMaterial.needsUpdate=!0,this.m_compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.m_compositeMaterial.uniforms.bloomTintColors.value=this.m_bloomTintColors,this.m_copyUniforms=n.UniformsUtils.clone(r.CopyShader.uniforms),this.m_copyUniforms.opacity.value=1,this.m_materialCopy=new n.ShaderMaterial({uniforms:this.m_copyUniforms,vertexShader:r.CopyShader.vertexShader,fragmentShader:r.CopyShader.fragmentShader,blending:n.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}dispose(){for(const e of this.m_renderTargetsHorizontal)e.dispose();for(const e of this.m_renderTargetsVertical)e.dispose();this.m_renderTargetBright.dispose()}setSize(e,t){let i=Math.round(e/2),r=Math.round(t/2);this.m_renderTargetBright.setSize(i,r);for(let e=0;e<this.m_nMips;e++)this.m_renderTargetsHorizontal[e].setSize(i,r),this.m_renderTargetsVertical[e].setSize(i,r),this.m_separableBlurMaterials[e].uniforms.texSize.value=new n.Vector2(i,r),i=Math.round(i/2),r=Math.round(r/2)}render(e,t,i,n,r){this.renderToScreen&&(this.m_quad.material=this.m_basic,this.m_basic.map=r.texture,e.setRenderTarget(null),e.clear(),e.render(this.m_scene,this.m_camera)),this.m_highPassUniforms.tDiffuse.value=r.texture,this.m_highPassUniforms.luminosityThreshold.value=this.threshold,this.m_quad.material=this.m_materialHighPassFilter,e.setRenderTarget(this.m_renderTargetBright),e.clear(),e.render(this.m_scene,this.m_camera);let s=this.m_renderTargetBright;for(let t=0;t<this.m_nMips;t++)this.m_quad.material=this.m_separableBlurMaterials[t],this.m_separableBlurMaterials[t].uniforms.colorTexture.value=s.texture,this.m_separableBlurMaterials[t].uniforms.direction.value=o,e.setRenderTarget(this.m_renderTargetsHorizontal[t]),e.clear(),e.render(this.m_scene,this.m_camera),this.m_separableBlurMaterials[t].uniforms.colorTexture.value=this.m_renderTargetsHorizontal[t].texture,this.m_separableBlurMaterials[t].uniforms.direction.value=a,e.setRenderTarget(this.m_renderTargetsVertical[t]),e.clear(),e.render(this.m_scene,this.m_camera),s=this.m_renderTargetsVertical[t];this.m_quad.material=this.m_compositeMaterial,this.m_compositeMaterial.uniforms.bloomStrength.value=this.strength,this.m_compositeMaterial.uniforms.bloomRadius.value=this.radius,this.m_compositeMaterial.uniforms.bloomTintColors.value=this.m_bloomTintColors,e.setRenderTarget(this.m_renderTargetsHorizontal[0]),e.clear(),e.render(this.m_scene,this.m_camera),this.m_quad.material=this.m_materialCopy,this.m_copyUniforms.tDiffuse.value=this.m_renderTargetsHorizontal[0].texture,this.renderToScreen?(e.setRenderTarget(null),e.render(this.m_scene,this.m_camera)):(e.setRenderTarget(r),e.render(this.m_scene,this.m_camera))}getSeperableBlurMaterial(e){return new n.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new n.Vector2(.5,.5)},direction:{value:new n.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n            void main() {\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            }",fragmentShader:"#include <common>\n            varying vec2 vUv;\n            uniform sampler2D colorTexture;\n            uniform vec2 texSize;\n            uniform vec2 direction;\n\n            float gaussianPdf(in float x, in float sigma) {\n                return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n            }\n            void main() {\n                vec2 invSize = 1.0 / texSize;\n                float fSigma = float(SIGMA);\n                float weightSum = gaussianPdf(0.0, fSigma);\n                vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n                for( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n                    float x = float(i);\n                    float w = gaussianPdf(x, fSigma);\n                    vec2 uvOffset = direction * invSize * x;\n                    vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n                    vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n                    diffuseSum += (sample1 + sample2) * w;\n                    weightSum += 2.0 * w;\n                }\n                gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n            }"})}getCompositeMaterial(e){return new n.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                }",fragmentShader:"varying vec2 vUv;\n                uniform sampler2D blurTexture1;\n                uniform sampler2D blurTexture2;\n                uniform sampler2D blurTexture3;\n                uniform sampler2D blurTexture4;\n                uniform sampler2D blurTexture5;\n                uniform sampler2D dirtTexture;\n                uniform float bloomStrength;\n                uniform float bloomRadius;\n                uniform float bloomFactors[NUM_MIPS];\n                uniform vec3 bloomTintColors[NUM_MIPS];\n\n                float lerpBloomFactor(const in float factor) {\n                    float mirrorFactor = 1.2 - factor;\n                    return mix(factor, mirrorFactor, bloomRadius);\n                }\n\n                void main() {\n                    gl_FragColor = bloomStrength * (\nlerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\nlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\nlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\nlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\nlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n                }"})}}t.BloomPass=l},5307:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSAASampling=t.MSAARenderPass=t.Pass=t.MapRenderingManager=void 0;var n=i(9886);Object.defineProperty(t,"MapRenderingManager",{enumerable:!0,get:function(){return n.MapRenderingManager}});var r=i(2331);Object.defineProperty(t,"Pass",{enumerable:!0,get:function(){return r.Pass}});var s=i(818);Object.defineProperty(t,"MSAARenderPass",{enumerable:!0,get:function(){return s.MSAARenderPass}}),Object.defineProperty(t,"MSAASampling",{enumerable:!0,get:function(){return s.MSAASampling}})},5808:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightCoverageProvider=void 0;const n=i(4342),r=i(1102);t.CopyrightCoverageProvider=class{constructor(){this.logger=n.LoggerManager.instance.create("CopyrightCoverageProvider")}getTree(){return void 0!==this.m_cachedTreePromise||(this.m_cachedTreePromise=this.getCopyrightCoverageData().then((e=>this.initRBush(e))).catch((e=>(this.logger.error(e),new r)))),this.m_cachedTreePromise}async getCopyrights(e,t){const i=[],r=(await this.getTree()).search({minX:e.west,minY:e.south,maxX:e.east,maxY:e.north});for(const e of r){const r=(0,n.getOptionValue)(e.minLevel,0),s=(0,n.getOptionValue)(e.maxLevel,1/0);t>=r&&t<=s&&void 0===i.find((t=>t.id===e.label))&&i.push({id:e.label})}return i}initRBush(e){const t=new r;if(!e)return this.logger.warn("No copyright coverage data provided"),t;for(const i of e){const{minLevel:e,maxLevel:n,label:r,alt:s}=i;if(i.boxes)for(const o of i.boxes){const[i,a,l,c]=o;t.insert({minX:a,minY:i,maxX:c,maxY:l,minLevel:e,maxLevel:n,label:r,alt:s})}else t.insert({minX:-180,minY:-90,maxX:180,maxY:180,minLevel:e,maxLevel:n,label:r,alt:s})}return t}}},4549:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightElementHandler=void 0;const n=i(4342),r=i(3977),s=i(8380);class o{static install(e,t){return new o(e,t)}constructor(e,t){if(this.m_defaults=new Map,this.m_mapViews=[],this.update=()=>{var e;const t=this.m_mapViews.map((e=>e.copyrightInfo)).reduce(s.CopyrightInfo.mergeArrays,null!==(e=this.staticInfo)&&void 0!==e?e:[]);if(0===t.length)return void(this.m_element.style.display="none");if(this.m_element.style.display="block",0!==this.m_defaults.size)for(const e of t){const t=this.m_defaults.get(e.id);void 0!==t&&(e.year=(0,n.getOptionValue)(e.year,t.year),e.label=(0,n.getOptionValue)(e.label,t.label),e.link=(0,n.getOptionValue)(e.link,t.link))}const i=s.CopyrightInfo.mergeArrays(t);this.m_element.innerHTML=s.CopyrightInfo.formatAsHtml(i)},"string"==typeof e){const t=document.getElementById(e);if(!t)throw new Error(`CopyrightElementHandler: unable to find DOM element #${e}`);this.m_element=t}else this.m_element=e;void 0!==t&&this.attach(t)}destroy(){for(const e of this.m_mapViews)e.removeEventListener(r.MapViewEventNames.CopyrightChanged,this.update)}attach(e){return this.m_mapViews.push(e),e.addEventListener(r.MapViewEventNames.CopyrightChanged,this.update),this.update(),this}detach(e){return e.removeEventListener(r.MapViewEventNames.CopyrightChanged,this.update),this.m_mapViews=this.m_mapViews.filter((t=>t!==e)),this.update(),this}setDefaults(e){if(this.m_defaults.clear(),void 0!==e)for(const t of e)this.m_defaults.set(t.id,t);return this}setStaticCopyightInfo(e){return this.staticInfo=e,this}}t.CopyrightElementHandler=o},8380:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightInfo=void 0;const n=i(4342);var r;(r=t.CopyrightInfo||(t.CopyrightInfo={})).mergeArrays=function(e,t){const i=[];for(const r of[e,t])if(void 0!==r)for(const e of r){const t=i.find((t=>t.id===e.id||void 0!==t.label&&t.label===e.label));void 0===t?i.push(Object.assign({},e)):(t.year=n.MathUtils.max2(e.year,t.year),t.label=(0,n.getOptionValue)(e.label,t.label),t.link=(0,n.getOptionValue)(e.link,t.link))}return i},r.formatAsHtml=function(e){if(0===e.length)return"";const t=e.filter((e=>""!==e.label));return 0===t.length?"":"© "+t.map((e=>{var t;const i=null!==(t=e.label)&&void 0!==t?t:e.id,n=void 0!==e.year?`${e.year} ${i}`:i,r=e.link;return r?`<a href="${r}" target="_blank" rel="noreferrer noopener">${n}</a>`:`${n}`})).join(", ")}},9348:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4757:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UrlCopyrightProvider=void 0;const n=i(3209),r=i(5808);class s extends r.CopyrightCoverageProvider{constructor(e,t,i,r=n.TransferManager.instance()){super(),this.m_fetchURL=e,this.m_baseScheme=t,this.m_requestHeaders=i,this.m_transferManager=r}setRequestHeaders(e){this.m_requestHeaders=e}getCopyrightCoverageData(e){return void 0!==this.m_cachedCopyrightResponse||(this.m_cachedCopyrightResponse=this.m_transferManager.downloadJson(this.m_fetchURL,{headers:this.m_requestHeaders,signal:e}).then((e=>e[this.m_baseScheme])).catch((e=>(this.logger.error(e),[])))),this.m_cachedCopyrightResponse}}t.UrlCopyrightProvider=s},1350:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fitLookAtBounds=t.getFitLookAtBoundsDistance=t.getFitBoundsParams=void 0;const n=i(82),r=i(2616),s=i(4442),o=i(541),a=new n.Vector3,l=new n.PerspectiveCamera;function c(e,t,i,s,a){let l,c;if(e instanceof r.GeoBox)c=null!=a?a:e.center,l=o.MapViewUtils.geoBoxToGeoPoints(e);else if(e instanceof r.GeoPolygon)c=e.getCentroid(),l=e.coordinates;else if((0,r.isGeoBoxExtentLike)(e)){c=null!=a?a:s;const t=r.GeoBox.fromCenterAndExtents(c,e);l=o.MapViewUtils.geoBoxToGeoPoints(t)}else{if(!Array.isArray(e))throw Error("#lookAt: Invalid 'bounds' value");l=e,c=a}e instanceof r.GeoBox||e instanceof r.GeoPolygon||!i||t.type!==r.ProjectionType.Planar||(l=o.MapViewUtils.wrapGeoPointsToScreen(l,c));const h=l.map((e=>t.projectPoint(r.GeoCoordinates.fromObject(e),new n.Vector3))),u=new n.Vector3;return void 0===c?((new n.Box3).setFromPoints(h).getCenter(u),t.scalePointToSurface(u),c=t.unprojectPoint(u)):t.projectPoint(c,u),{target:c,worldTarget:u,worldPoints:h}}function h(e,t){const{projection:i,viewportSize:n,cameraSettings:h,maxZoomLevel:u}=e,{yaw:d,tilt:m,padding:p}=t,{target:f,worldTarget:g,worldPoints:v}=c(t.bounds,i,e.tileWrapping,e.target,t.target);let y,_=t.distance;if(void 0===_){l.copy(e.camera),o.MapViewUtils.getCameraRotationAtTarget(i,f,d,m,l.quaternion),y=l.quaternion;const t=o.MapViewUtils.calculateDistanceFromZoomLevel(h,u);o.MapViewUtils.getCameraPositionFromTarget(f,t,d,m,i,l.position),l.updateMatrixWorld(!0),i.type===r.ProjectionType.Spherical&&o.MapViewUtils.wrapWorldPointsToView(v,l.position),_=function(e,t,i,n,r={top:0,right:0,bottom:0,left:0}){const o={top:2*r.top/n.height,right:2*r.right/n.width,bottom:2*r.bottom/n.height,left:2*r.left/n.width},l=a.copy(t).sub(i.position).length(),c=s.CameraUtils.getPrincipalPoint(i);let h=l;const u=(e,t,i,n)=>{const r=-1===Math.sign(e)?-1:1,s=r>0?n:i;return Math.abs(e)>1?Math.abs((e-t)/(r*(.99-s)-t)):1};for(const t of e){const e=-a.copy(t).applyMatrix4(i.matrixWorldInverse).z,n=a.applyMatrix4(i.projectionMatrix),r=Math.max(u(n.x,c.x,o.left,o.right),u(n.y,c.y,o.bottom,o.top));if(r>1){const t=l-e,i=Math.abs(e)*r+t;h=Math.max(h,i)}}return h}(v,g,l,n,p)}return{target:f,distance:_,quaternion:y}}t.getFitBoundsParams=c,t.getFitLookAtBoundsDistance=h,t.fitLookAtBounds=function(e,t){const{projection:i,camera:n}=e,{yaw:r,tilt:s}=t,{target:a,distance:l,quaternion:c}=h(e,t);c?n.quaternion.copy(c):o.MapViewUtils.getCameraRotationAtTarget(i,a,r,s,n.quaternion),o.MapViewUtils.getCameraPositionFromTarget(a,l,r,s,i,n.position),n.updateMatrixWorld(!0)}},8024:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addGroundPlane=void 0;const n=i(82),r=i(6525),s=i(6189),o=i(2616),a=i(1984),l=i(5863),c=i(8427),h=i(6473),u=i(21),d=i(4772),m=new n.Vector3;function p(e,t,i){const n=e.getAttribute("position"),r=n.array,s=new Float32Array(r.length);for(let e=0;e<n.array.length;e+=1)m.fromBufferAttribute(n,e),i.projection.reprojectPoint(t,m,m).sub(i.center),m.toArray(s,3*e);n.array=s,n.needsUpdate=!0}t.addGroundPlane=function(e,t,i=l.BackgroundDataSource.DEFAULT_COLOR,m=1,f=!1){const g=function(e,t,i,a){const{dataSource:l,projection:d}=e,m=l.getTilingScheme().projection,f=d.type===o.ProjectionType.Spherical,g=!f,v=e.mapView,y=v.shadowsEnabled,_={name:"fill",color:i,opacity:a},x=(0,c.createMaterial)(_,e.mapView,{fog:null!==v.scene.fog,shadowsEnabled:y}),w=null==x?void 0:x.material;w&&(w.depthWrite=f);const b=function(e,t,i,r){const{dataSource:s,projection:o}=e,a=s.getTilingScheme().projection,l=new n.Vector3,c=new n.BufferGeometry,h=(0,u.projectTilePlaneCorners)(e,a),d=[h.sw,h.se,h.nw,h.ne];if(t)for(const t of d)o.reprojectPoint(a,t,t).sub(e.center);const m=t?new Float32Array(12):new Float64Array(12),p=new n.BufferAttribute(m,3).copyVector3sArray(d);if(c.setAttribute("position",p),r){a.surfaceNormal(h.sw,l).negate();const e=new n.BufferAttribute(new Float32Array(12),3).copyVector3sArray(Array(4).fill(l));c.setAttribute("normal",e)}if(c.setIndex(new n.BufferAttribute(new Uint16Array([0,1,2,2,1,3]),1)),i){const e=new n.BufferAttribute(new Float32Array([0,0,1,0,0,1,1,1]),2);c.setAttribute("uv",e)}return c}(e,g,t,y);if(!f)return new n.Mesh(b,w);const T=[],M=new s.SphericalGeometrySubdivisionModifier(n.MathUtils.degToRad(10),m);if(!(!1!==e.mapView.enableMixedLod))return M.modify(b),p(b,m,e),new n.Mesh(b,w);for(let t=0;t<4;++t){const i=Math.pow(2,t),n=b.clone();i>1&&new r.EdgeLengthGeometrySubdivisionModifier(i,e.geoBox,r.SubdivisionMode.All,m).modify(n),M.modify(n),p(n,m,e),T.push(n)}return new h.LodMesh(T,w)}(e,f,i,m);return g.receiveShadow=e.mapView.shadowsEnabled,g.renderOrder=t,(0,d.registerTileObject)(e,g,{pickability:a.Pickability.transient}),e.objects.push(g),g}},544:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedBufferAttribute=void 0;const n=i(82),r=i(4342),s=i(8813);class o extends n.BufferAttribute{constructor(e,t,i,r){super(e.array,e.itemSize,e.normalized),this.originalAttribute=e,this.m_normals=t,this.m_uvs=i,this.m_textureWidth=0,this.m_textureHeight=0,this.m_cache=new s.VertexCache(o.MAX_CACHE_SIZE),this.m_lastPos=new n.Vector3,this.m_tmpNormal=new n.Vector3,this.resetTexture(r)}reset(e,t,i,n){this.array=e.array,this.itemSize=e.itemSize,this.count=this.array.length/this.itemSize,this.normalized=e.normalized,this.originalAttribute=e,this.m_normals=t,this.m_uvs=i,this.m_cache.clear(),this.m_lastBufferIndex=void 0,this.resetTexture(n)}getX(e){return this.getDisplacedCoordinate(e).x}getY(e){return this.getDisplacedCoordinate(e).y}getZ(e){return this.getDisplacedCoordinate(e).z}resetTexture(e){this.m_texture=new Float32Array(e.image.data.buffer),this.m_textureWidth=e.image.width,this.m_textureHeight=e.image.height}getDisplacedCoordinate(e){return e===this.m_lastBufferIndex||(this.m_lastBufferIndex=e,this.m_cache.get(e,this.m_lastPos)||(this.displacePosition(e),this.m_cache.set(e,this.m_lastPos))),this.m_lastPos}displacePosition(e){this.m_lastPos.fromBufferAttribute(this.originalAttribute,e);const t=this.m_normals;this.m_tmpNormal.fromBufferAttribute(t,e);const i=this.m_uvs,s=n.MathUtils.clamp(i.getX(e),0,1),o=n.MathUtils.clamp(i.getY(e),0,1),a=(0,r.sampleBilinear)(this.m_texture,this.m_textureWidth,this.m_textureHeight,s,o);this.m_lastPos.add(this.m_tmpNormal.multiplyScalar(a))}}t.DisplacedBufferAttribute=o,o.MAX_CACHE_SIZE=6},8246:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedBufferGeometry=t.displaceBox=void 0;const n=i(82),r=i(544),s=new n.Vector3,o=new n.Vector3,a=new n.Box3;function l(e,t,i){a.copy(e);const n=s.copy(i),r=o.copy(n);return e.translate(n.multiplyScalar(t.min)).union(a.translate(r.multiplyScalar(t.max))),e}t.displaceBox=l;class c extends n.BufferGeometry{constructor(e,t,i,s){super(),this.originalGeometry=e,this.displacementRange=i,this.m_originalBoundingBox=new n.Box3,this.m_displacedPositions=s||new r.DisplacedBufferAttribute(e.attributes.position,e.attributes.normal,e.attributes.uv,t),this.resetAttributes()}reset(e,t,i){this.originalGeometry=e;const n=e.attributes.position,r=e.attributes.normal,s=e.attributes.uv;this.m_displacedPositions.reset(n,r,s,t);const o=this.displacementRange.min!==i.min||this.displacementRange.max!==i.max;this.displacementRange=i,this.resetAttributes(),this.resetBoundingVolumes(o)}computeBoundingBox(){null===this.originalGeometry.boundingBox&&this.originalGeometry.computeBoundingBox();const e=this.m_originalBoundingBox.copy(this.originalGeometry.boundingBox);null===this.boundingBox?this.boundingBox=e.clone():this.boundingBox.copy(e),l(this.boundingBox,this.displacementRange,s.fromBufferAttribute(this.attributes.normal,0))}computeBoundingSphere(){null===this.boundingBox&&this.computeBoundingBox(),null===this.boundingSphere&&(this.boundingSphere=new n.Sphere),this.boundingBox.getBoundingSphere(this.boundingSphere)}needsBoundingBoxUpdate(e){return e||null!==this.boundingBox&&(!this.originalGeometry.boundingBox||!this.m_originalBoundingBox.equals(this.originalGeometry.boundingBox))}resetBoundingVolumes(e){this.needsBoundingBoxUpdate(e)&&(this.computeBoundingBox(),this.boundingSphere&&this.computeBoundingSphere())}resetAttributes(){this.index=this.originalGeometry.index,this.groups=this.originalGeometry.groups,this.drawRange=this.originalGeometry.drawRange,this.attributes=Object.assign({},this.originalGeometry.attributes),this.attributes.position=this.m_displacedPositions}}t.DisplacedBufferGeometry=c},946:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedMesh=void 0;const n=i(82),r=i(4250),s=i(4342),o=i(544),a=i(8246);class l extends n.Mesh{static getDisplacedPositionAttribute(e,t){return l.displacedPositions?l.displacedPositions.reset(e.attributes.position,e.attributes.normal,e.attributes.uv,t):l.displacedPositions=new o.DisplacedBufferAttribute(e.attributes.position,e.attributes.normal,e.attributes.uv,t),l.displacedPositions}constructor(e,t,i,n){super(e,t),this.m_getDisplacementRange=i,this.m_raycastStrategy=n}raycast(e,t){const i=this.firstMaterial;if(!function(e){const t=(0,r.hasDisplacementFeature)(e);return(0,s.assert)(t,"Material does not support displacement maps."),t}(i)||!function(e){if(!e)return!1;const t=e instanceof n.DataTexture;return(0,s.assert)(t,"Material does not support displacement maps."),t}(i.displacementMap))return void super.raycast(e,t);const o=i.displacementMap,c=Object.assign({},this.m_getDisplacementRange());(0,s.assert)(this.geometry instanceof n.BufferGeometry,"Unsupported geometry type.");const h=this.geometry;this.displacedGeometry?this.displacedGeometry.reset(h,o,c):this.displacedGeometry=new a.DisplacedBufferGeometry(h,o,c,l.getDisplacedPositionAttribute(h,o)),this.geometry=this.displacedGeometry,this.m_raycastStrategy?this.m_raycastStrategy(this,e,t):super.raycast(e,t),super.geometry=this.displacedGeometry.originalGeometry}get firstMaterial(){return Array.isArray(this.material)?this.material[0]:this.material}}t.DisplacedMesh=l},6473:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LodMesh=void 0;const n=i(82);class r extends n.Mesh{constructor(e,t){super(void 0,t),this.geometries=e}set geometries(e){this.m_geometries!==e&&this.disposeGeometries(),this.m_geometries=e,this.geometries&&this.m_geometries.length>0&&(this.geometry=this.m_geometries[0])}get geometries(){return this.m_geometries}setLevelOfDetail(e){this.m_geometries&&0!==this.m_geometries.length&&(e=n.MathUtils.clamp(e,0,this.m_geometries.length-1),this.geometry=this.m_geometries[e])}disposeGeometries(){if(this.m_geometries)for(const e of this.m_geometries)e.dispose();this.geometry.dispose()}}t.LodMesh=r},7987:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Object3DUtils=void 0;const n=i(82),r=i(4250),s=i(4342),o=i(1447),a=s.LoggerManager.instance.create("Object3DUtils");!function(e){function t(e){if(!e.image)return 0;const t=e.image;return 4*t.width*t.height}function i(e,i,n){if(!e)return;if(void 0!==e.uuid&&!0===n.get(e.uuid))return;n.set(e.uuid,!0);const r=t(e);i.heapSize+=r,i.gpuSize+=r}function s(e,t,s){if(void 0===e.uuid||!0!==s.get(e.uuid))if(s.set(e.uuid,!0),e instanceof n.RawShaderMaterial||e instanceof n.ShaderMaterial){const r=e;for(const e in r.uniforms)if(void 0!==r.uniforms[e]){const o=r.uniforms[e];o instanceof n.Texture&&i(o,t,s)}}else if(e instanceof n.MeshBasicMaterial||e instanceof r.MapMeshBasicMaterial){const n=e;i(n.map,t,s),i(n.aoMap,t,s),i(n.specularMap,t,s),i(n.alphaMap,t,s),i(n.envMap,t,s)}else if(e instanceof r.MapMeshStandardMaterial){const n=e;i(n.map,t,s),i(n.lightMap,t,s),i(n.aoMap,t,s),i(n.emissiveMap,t,s),i(n.bumpMap,t,s),i(n.normalMap,t,s),i(n.displacementMap,t,s),i(n.roughnessMap,t,s),i(n.metalnessMap,t,s),i(n.alphaMap,t,s),i(n.envMap,t,s)}else if(e instanceof r.MapMeshPhongMaterial){const n=e;i(n.map,t,s),i(n.lightMap,t,s),i(n.aoMap,t,s),i(n.emissiveMap,t,s),i(n.bumpMap,t,s),i(n.normalMap,t,s),i(n.displacementMap,t,s),i(n.specularMap,t,s),i(n.alphaMap,t,s),i(n.envMap,t,s)}else e instanceof n.LineBasicMaterial||e instanceof n.LineDashedMaterial||e instanceof n.PointsMaterial||a.warn("estimateMeshSize: unidentified material: ",e)}function l(e,t,i,r){if(void 0===e.uuid&&(e.uuid=n.MathUtils.generateUUID()),!0===r.get(e.uuid))return;r.set(e.uuid,!0);let s=0,o=4;void 0!==e.array.BYTES_PER_ELEMENT&&(o=e.array.BYTES_PER_ELEMENT),e instanceof n.InterleavedBufferAttribute||e instanceof n.BufferAttribute?s=o*e.count*e.itemSize:a.warn("estimateMeshSize: unidentified attribute: ",t),i.heapSize+=s+56,i.gpuSize+=s}function c(e,t,i){if(void 0!==e.uuid&&!0===i.get(e.uuid))return;if(i.set(e.uuid,!0),void 0===e)return;const n=e.attributes;if(void 0!==n){for(const e in n)void 0!==n[e]&&l(n[e],e,t,i);null!==e.index&&l(e.index,"index",t,i)}else a.warn("estimateGeometrySize: unidentified geometry: ",e)}e.getTextureSize=t,e.estimateSize=function e(t,i,r){const l=void 0!==i?i:{heapSize:0,gpuSize:0};if(void 0===r&&(r=new Map),function(e,t,i){if(e.isObject3D&&!(e instanceof n.Scene)&&(void 0===e.uuid||!0!==i.get(e.uuid)))if(i.set(e.uuid,!0),e.isMesh||e.isLine||e.isPoints){let n=1e3;const r=0,a=e;if(void 0!==a.material)if(Array.isArray(a.material)){const e=a.material;for(const n of e)s(n,t,i)}else s(a.material,t,i);if(void 0!==a.geometries)for(const e of a.geometries)c(e,t,i);else void 0!==a.geometry&&c(a.geometry,t,i);const l=void 0!==e.userData?e.userData.feature:void 0;void 0!==l&&(n+=(0,o.getFeatureDataSize)(l)),t.heapSize+=n,t.gpuSize+=r}else a.warn("estimateMeshSize: unidentified object",e)}(t,l,r),t.children.length>0)for(const i of t.children)e(i,l,r);return l}}(t.Object3DUtils||(t.Object3DUtils={}))},21:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.projectTilePlaneCorners=void 0;const n=i(82),r=i(2616);t.projectTilePlaneCorners=function(e,t){const{east:i,west:s,north:o,south:a}=e.geoBox;return{sw:t.projectPoint(new r.GeoCoordinates(a,s),new n.Vector3),se:t.projectPoint(new r.GeoCoordinates(a,i),new n.Vector3),nw:t.projectPoint(new r.GeoCoordinates(o,s),new n.Vector3),ne:t.projectPoint(new r.GeoCoordinates(o,i),new n.Vector3)}}},4772:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerTileObject=void 0;const n=i(4572);t.registerTileObject=function(e,t,i){n.MapObjectAdapter.create(t,Object.assign({dataSource:e.dataSource,level:e.tileKey.level},i)),e.resetVisibilityCounter()}},8673:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolidLineMesh=void 0;const n=i(82),r=i(2616),s=i(4250),o=i(4342),a=i(8246),l=new n.Sphere,c=new n.Matrix4,h=new n.Ray,u=new n.Line3,d=new n.Box3,m=new r.OrientedBox3,p=new n.Plane,f=new n.Vector3,g=new n.Vector3,v=new n.Vector3,y=new n.Vector3,_=6,x=2;function w(e,t,i){let r;e instanceof a.DisplacedBufferGeometry&&(r=e.displacementRange,e=e.originalGeometry);const s=e.attributes.position,o=e.index.array,l=new n.Sphere,c=d.makeEmpty(),h=f;for(let e=t;e<i;e+=_)c.expandByPoint(h.fromBufferAttribute(s,o[e])),c.expandByPoint(h.fromBufferAttribute(s,o[e+x]));if(r){const t=g;return t.fromBufferAttribute(e.attributes.normal,0),(0,a.displaceBox)(c,r,t).getBoundingSphere(l)}return c.getBoundingSphere(l)}function b(e,t,i,r,s,o,a,l){if(a.equals(e.origin)&&0===e.direction.dot(o.normal)){const s=function(e,t,i,n,r){var s;const o=m;return t.getCenter(o.position),t.delta(o.xAxis).normalize(),o.yAxis.copy(i),o.zAxis.copy(n),o.extents.set(t.distance()/2,r,r),o.contains(e.origin)?0:null!==(s=o.intersectsRay(e))&&void 0!==s?s:1/0}(e,t,i,o.normal,r),a=function(e,t,i){const r=new n.Sphere(t.start,i),s=r.containsPoint(e.origin)?0:e.intersectSphere(r,y)?y.sub(e.origin).length():1/0;r.center.copy(t.end);const o=r.containsPoint(e.origin)?0:e.intersectSphere(r,y)?y.sub(e.origin).length():1/0;return Math.min(s,o)}(e,t,r),c=Math.min(s,a);return c!==1/0&&(e.at(c,l),!0)}return!(a.distanceToSquared(t.closestPointToPoint(a,!0,y))>s||(l.copy(a),0))}function T(e,t,i,n,r,s,o,a,c,h){const d=f,m=p,y=g,w=u,T=e.geometry,M=T.attributes,S=M.position,E=M.biTangent,A=T.index.array;if(l.copy(c),l.applyMatrix4(e.matrixWorld),l.radius+=n,t.ray.intersectsSphere(l))for(let n=o;n<a;n+=_){const o=A[n],a=A[n+x];if(w.start.fromBufferAttribute(S,o),w.end.fromBufferAttribute(S,a),d.set(E.getX(o),E.getY(o),E.getZ(o)).normalize(),m.setFromCoplanarPoints(w.start,v.copy(w.start).add(d),w.end),0===m.normal.manhattanLength())continue;if(!i.intersectPlane(m,y))continue;const l=v;if(!b(i,w,d,r,s,m,y,l))continue;const c=l.applyMatrix4(e.matrixWorld),u=t.ray.origin.distanceTo(c);u<t.near||u>t.far||h.push({distance:u,point:c.clone(),index:n,object:e})}}const M=[0],S=.01;function E(e,t,i,r,a,l,c){var h;const u=e.userData.feature.boundingVolumes;(0,o.assert)(e.geometry instanceof n.BufferGeometry,"Unsupported geometry type.");const d=e.geometry;(0,o.assert)(function(e){return Array.isArray(e)?e.every((e=>e instanceof s.SolidLineMaterial)):e instanceof s.SolidLineMaterial}(t),"Unsupported material type");const m=t.lineWidth/2;(0,o.assert)(Math.abs(1-e.scale.x/e.scale.y)<S),(0,o.assert)(Math.abs(1-e.scale.x/e.scale.z)<S),(0,o.assert)(Math.abs(1-e.scale.y/e.scale.z)<S);const p=m/((e.scale.x+e.scale.y+e.scale.z)/3),f=p*p,g=null!==(h=e.userData.feature.starts)&&void 0!==h?h:M;let v=a,y=g[v];const _=g.length-1;for(;y<l;){const t=v,n=v<_?g[++v]:l;t>=u.length&&u.push(w(d,y,n)),T(e,i,r,m,p,f,y,n,u[t],c),y=n}return v}class A extends n.Mesh{static raycast(e,t,i){(0,o.assert)(e.geometry instanceof n.BufferGeometry,"Unsupported geometry type");const r=e.geometry;(0,o.assert)(null!==r.index,"Geometry does not have indices");const s=e.matrixWorld;c.copy(s).invert();const a=h.copy(t.ray).applyMatrix4(c);void 0===e.userData.feature&&(e.userData.feature={});const l=r.attributes.position,u=e.userData.feature.attributeInfo;(void 0===u||void 0===e.userData.feature.boundingVolumes||function(e,t){const i=!0===e.isBufferAttribute?e:e.data;return void 0===t||t.data!==i||e.isBufferAttribute&&t.version!==i.version}(l,u))&&(e.userData.feature.boundingVolumes=[],e.userData.feature.attributeInfo=function(e){const t=!0===e.isBufferAttribute?e:e.data;return{data:t,version:t.version}}(l));const d=r.index.array;if(Array.isArray(e.material)){let n=0;for(const s of r.groups)n=E(e,e.material[s.materialIndex],t,a,n,s.start+s.count,i)}else E(e,e.material,t,a,0,d.length,i)}constructor(e,t){super(e,t)}raycast(e,t){A.raycast(this,e,t)}}t.SolidLineMesh=A},5571:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileDataAccessor=void 0;const n=i(8152),r=i(4342),s=i(4269),o=r.LoggerManager.instance.create("TileDataAccessor");t.TileDataAccessor=class{constructor(e,t,i){this.tile=e,this.visitor=t;const n=!0===i.wantsAll;this.m_wantsPoints=n||!(!1===i.wantsPoints),this.m_wantsLines=n||!(!1===i.wantsLines),this.m_wantsAreas=n||!(!1===i.wantsAreas),this.m_wantsObject3D=n||!(!1===i.wantsObject3D)}visitAll(){const e=this.tile.objects;for(const t of e)this.visitObject(t)}visitObject(e){const t=void 0!==e.userData?e.userData.feature:void 0;if(void 0===t||void 0!==t.objInfos&&1===t.objInfos.length&&!this.visitor.wantsFeature((0,n.getFeatureId)(t.objInfos[0])))return;const i=t.geometryType;if(void 0===i)return void o.warn("#visitObject: visiting object failed, no geometryType",e);switch((0,r.assert)(void 0!==t.objInfos,"featureData.ids missing"),(0,r.assert)(void 0!==t.starts,"featureData.starts missing"),(0,r.assert)(Array.isArray(t.starts),"featureData.starts is not an array"),void 0!==t.objInfos&&void 0!==t.starts&&(0,r.assert)(t.objInfos.length===t.starts.length,"featureData.ids and featureData.starts have unequal length"),i){case n.GeometryType.Point:case n.GeometryType.Text:if(!this.m_wantsPoints)return;break;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:if(!this.m_wantsLines)return;break;case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:if(!this.m_wantsAreas)return;break;case n.GeometryType.Object3D:if(!this.m_wantsObject3D)return;break;default:o.warn("#visitObject: invalid geometryType")}if("Mesh"!==e.type)return void o.warn("#visitObject: visiting object failed, not of type 'Mesh'",e);const s=e;this.visitMesh(s,t)}getBufferGeometry(e){const t=e.geometry;if("BufferGeometry"!==t.type)return void o.warn("#visitObject: object does not have BufferGeometry");const i=t;if(i.getAttribute("position"))return i;o.warn("#visitLines: BufferGeometry has no position attribute")}getGeometryAccessor(e,t,i){switch(e){case n.GeometryType.Point:case n.GeometryType.Text:return;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:return new s.BufferedGeometryLineAccessor(t,e,i);case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:return;case n.GeometryType.Object3D:return new s.BufferedGeometryObject3dAccessor(t,e,i);default:o.warn("#getGeometryAccessor: invalid geometryType")}}getIndexedGeometryAccessor(e,t,i){switch(e){case n.GeometryType.Point:case n.GeometryType.Text:return;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:return new s.IndexedBufferedGeometryLineAccessor(t,e,i);case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:case n.GeometryType.Object3D:return;default:o.warn("#getIndexedGeometryAccessor: invalid geometryType")}}visitMesh(e,t){const{objInfos:i,starts:a}=t,l=t.geometryType;if(void 0===i||void 0===a||void 0===l)return;let c;for(let t=0;t<i.length;t++){const h=(0,n.getFeatureId)(i[t]);if(!this.visitor.wantsFeature(h))continue;const u=a[t];let d=-1;if(void 0===c){const t=this.getBufferGeometry(e);if(void 0===t)continue;if(c=null!==t.index?this.getIndexedGeometryAccessor(l,e,t):this.getGeometryAccessor(l,e,t),void 0===c){o.warn("#visitObject: no accessor geometryType",l);continue}}switch(d=t<a.length-1?a[t+1]:c.getCount(),c.setRange(u,d),l){case n.GeometryType.Point:case n.GeometryType.Text:this.visitor.visitPoint(h);break;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:(0,r.assert)((0,s.isLineAccessor)(c)),this.visitor.visitLine(h,c);break;case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:this.visitor.visitArea(h);break;case n.GeometryType.Object3D:(0,r.assert)((0,s.isObject3dAccessor)(c)),this.visitor.visitObject3D(h,c);break;default:o.warn("#visitObject: invalid geometryType")}}}}},4269:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedBufferedGeometryLineAccessor=t.IndexedBufferedGeometryAccessor=t.BufferedGeometryObject3dAccessor=t.BufferedGeometryLineAccessor=t.BufferedGeometryAccessor=t.BufferedGeometryAccessorBase=t.isObject3dAccessor=t.isLineAccessor=void 0;const n=i(8152),r=i(3211),s=i(4342),o=s.LoggerManager.instance.create("TileGeometry");t.isLineAccessor=function(e){return"function"==typeof e.isLineAccessor&&!0===e.isLineAccessor()},t.isObject3dAccessor=function(e){return"function"==typeof e.isObject3dAccessor&&!0===e.isObject3dAccessor()};class a{constructor(e,t,i){this.object=e,this.geometryType=t,this.bufferGeometry=i,this.start=-1,this.end=-1,this.startCapSize=0,this.endCapSize=0,(0,s.assert)(!!e),"BufferGeometry"!==i.type&&o.error("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),(0,s.assert)("BufferGeometry"===i.type,"IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),this.position=this.bufferGeometry.getAttribute("position"),this.itemSize=this.position.itemSize,this.position||o.warn("BufferedGeometryAccessor#constructor: BufferGeometry has no position attribute"),this.position.array.constructor!==Float32Array&&o.warn("BufferedGeometryAccessor#constructor: BufferGeometry.position: unsupported ArrayBuffer")}getCount(){return this.position.count}get renderOrder(){return this.object.renderOrder}setRange(e,t,i=0,n=0){(0,s.assert)(e>=0),(0,s.assert)(t>=0),(0,s.assert)(e<=t),this.start=e,this.end=t,this.startCapSize=i,this.endCapSize=n}get color(){const e=e=>{const t=e;if("MeshBasicMaterial"===t.type||"MeshStandardMaterial"===t.type)return t.color;if("RawShaderMaterial"===t.type){const t=e;if("SolidLineMaterial"===t.name)return t.uniforms.diffuseColor.value;o.warn("BufferedGeometryAccessor#color: unknown shader material name",t.name)}else o.warn("BufferedGeometryAccessor#color: unknown material type",t.type)};if(Array.isArray(this.object.material)){const t=new Array,i=this.object.material;for(const n of i)t.push(e(n));return t}return e(this.object.material)}}t.BufferedGeometryAccessorBase=a;class l extends a{constructor(e,t,i,n){super(e,t,i),this.object=e,this.geometryType=t,this.bufferGeometry=i,this.stride=n}clear(){(0,s.assert)(this.checkSetUp(),"BufferedGeometryAccessor not setup");const e=this.position.array,t=this.start*this.itemSize,i=this.end*this.itemSize;for(let n=t;n<i;n++)e[n]=0;this.position.needsUpdate=!0}getVertices(){(0,s.assert)(this.checkSetUp(),"BufferedGeometryAccessor not setup");const e=this.start,t=this.end;return this.position.array.subarray(e*this.itemSize,t*this.itemSize)}checkSetUp(){return void 0!==this.position&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.position.count&&this.start<=this.end}}t.BufferedGeometryAccessor=l,t.BufferedGeometryLineAccessor=class extends l{constructor(e,t,i){super(e,t,i,3),this.object=e,this.geometryType=t,this.bufferGeometry=i}isLineAccessor(){return!0}get width(){(0,s.assert)(this.checkSetUp(),"RoBufferedGeometryLineAccessor not setup")}},t.BufferedGeometryObject3dAccessor=class extends l{constructor(e,t,i){super(e,t,i,1),this.object=e,this.geometryType=t,this.bufferGeometry=i}isObject3dAccessor(){return!0}getVertices(){return super.getVertices()}};class c extends a{constructor(e,t,i,n,r){super(e,t,i),this.object=e,this.geometryType=t,this.bufferGeometry=i,this.indices=null!==this.bufferGeometry.index?this.bufferGeometry.index.array:void 0,this.indices?this.indices instanceof Uint32Array||(o.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry index has wrong type"),(0,s.assert)(this.indices instanceof Uint32Array)):(o.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has no index"),(0,s.assert)(!!this.indices))}getCount(){return this.indices.length}checkSetUp(){return!!this.indices&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.indices.length&&this.start<=this.end}}t.IndexedBufferedGeometryAccessor=c,t.IndexedBufferedGeometryLineAccessor=class extends c{constructor(e,t,i){super(e,t,i,3),this.object=e,this.geometryType=t,this.bufferGeometry=i}isLineAccessor(){return!0}get width(){if((0,s.assert)(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup"),this.geometryType===n.GeometryType.ExtrudedLine){const e=this.start+this.startCapSize,t=this.position.array;return(0,r.reconstructLineWidth)(t,e)}}clear(){(0,s.assert)(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");const e=this.start,t=this.end;for(let i=e;i<t;i++)this.indices[i]=0;null!==this.bufferGeometry.index&&(this.bufferGeometry.index.needsUpdate=!0)}getVertices(){(0,s.assert)(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");const e=this.itemSize,t=this.start,i=this.end,n=new Float32Array((i-t)*e),r=this.position.array;if(2===e)for(let s=t,o=0;s<i;s++,o+=e){const t=this.indices[s];n[o+0]=r[t*e+0],n[o+1]=r[t*e+1]}if(3===e)for(let s=t,o=0;s<i;s++,o+=e){const t=this.indices[s];n[o+0]=r[t*e+0],n[o+1]=r[t*e+1],n[o+2]=r[t*e+2]}else for(let s=t,o=0;s<i;s++,o++){const t=this.indices[s];for(let i=0;i<e;i++)n[o*e+i]=r[t*e+i]}return n}}},5912:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryCreator=void 0;const n=i(82),r=i(8152),s=i(2616),o=i(4250),a=i(1984),l=i(8023),c=i(4342),h=i(5863),u=i(8427),d=i(2476),m=i(5316),p=i(176),f=i(9701),g=i(8024),v=i(4772),y=c.LoggerManager.instance.create("TileGeometryCreator"),_=new n.Vector3,x=new n.Vector2;class w{constructor(){this.bufferAttributes=new Map,this.interleavedAttributes=new Map}}class b extends l.CallExpr{constructor(e){super("memo",[e]),this.m_cachedProperties=[],this.m_deps=Array.from(e.dependencies().properties),this.descriptor=this}call(e){let t=!1;return this.m_deps.forEach(((i,n)=>{const r=e.env.lookup(i);t||r===this.m_cachedProperties[n]||(t=!0),t&&(this.m_cachedProperties[n]=r)})),(t||void 0===this.m_cachedValue)&&(this.m_cachedValue=e.evaluate(this.args[0])),this.m_cachedValue}}class T{constructor(e,t,i){this.geometry=e,this.info=t,this.cache=i}getBufferAttribute(e){if(this.cache.bufferAttributes.has(e))return this.cache.bufferAttributes.get(e);const t=(0,u.getBufferAttribute)(e);return this.cache.bufferAttributes.set(e,t),t}getInterleavedBufferAttributes(e){const t=this.cache.interleavedAttributes.get(e);if(t)return t;const i=new((0,r.getArrayConstructor)(e.type))(e.buffer),s=new n.InterleavedBuffer(i,e.stride),o=e.attributes.map((e=>{const t=new n.InterleavedBufferAttribute(s,e.itemSize,e.offset,!1);return{name:e.name,attribute:t}}));return this.cache.interleavedAttributes.set(e,o),o}}function M(e,t){if(Array.isArray(e)){const i=e;t.push(...i)}else t.push(e)}class S{static get instance(){return this.m_instance||(this.m_instance=new S)}constructor(){}initDecodedTile(e){for(const t of e.geometries)for(const e of t.groups)e.createdOffsets=[]}createAllGeometries(e,t){const i=this.createObjects(e,t);if(this.addIconTexts(e,t),this.createIconTexts(e,t,(e=>(0,a.isIconTextTechnique)(e)||(0,a.isLineMarkerTechnique)(e)||(0,a.isTextTechnique)(e))),this.createLabelRejectionElements(e,t),e.dataSource.addGroundPlane&&e.projection.type===s.ProjectionType.Planar){const t=e.mapView.getDataSourceByName(h.BackgroundDataSource.NAME);(0,g.addGroundPlane)(e,-1,null==t?void 0:t.backgroundColor)}return i}createLabelRejectionElements(e,t){if(void 0!==t.pathGeometries)for(const i of t.pathGeometries)e.addBlockingElement(new f.PathBlockingElement(i.path))}processTechniques(e){const t=e.decodedTile;if(void 0===t)return;this.initDecodedTile(t);const i=e.dataSource.exprPool;t.techniques.forEach((e=>{for(const t in e){if(!e.hasOwnProperty(t))continue;const n=e[t];if((0,a.isJsonExpr)(n)&&"kind"!==t)try{let r=l.Expr.fromJSON(n);!0!==r.dependencies().volatile&&(r=new b(l.Expr.fromJSON(n))),e[t]=r.intern(i)}catch(e){y.error("Failed to compile expression:",e)}}}))}prepareTextPaths(e,t,i){const n=new Array,r=e.slice();for(;r.length>0;){const e=r.pop();if(void 0===e)break;const s=t.techniques[e.technique];(0,a.isTextTechnique)(s)&&(void 0===i||i(s))&&n.push(e)}return n}createIconTexts(e,t,i){var r;const s=e.mapView,o=e.computeWorldOffsetX(),l=Math.floor(s.zoomLevel),c=new a.MapEnv({$zoom:l},s.env),h=new m.IconTextBuilder(c,e.textStyleCache,e.dataSource.dataSourceOrder);if(void 0!==t.textPathGeometries){const r=this.prepareTextPaths(t.textPathGeometries,t,i);for(const s of r){const r=t.techniques[s.technique];if(!(0,a.isTextTechnique)(r)||void 0!==i&&!i(r))continue;const l=[];for(let e=0;e<s.path.length;e+=3)l.push(new n.Vector3(s.path[e]+o,s.path[e+1],s.path[e+2]));const c=h.withTechnique(r).build(s.text,l,e.offset,e.dataSource.name,e.dataSource.dataSourceOrder,s.objInfos,s.pathLengthSqr);e.addIconText(c)}}if(void 0!==t.textGeometries)for(const s of t.textGeometries){if(void 0===s.technique||void 0===s.stringCatalog)continue;const l=t.techniques[s.technique];if(!(0,a.isTextTechnique)(l)||void 0!==i&&!i(l))continue;const c=new n.BufferAttribute(new Float64Array(s.positions.buffer),s.positions.itemCount),u=c.count;if(!(u<1)){h.withTechnique(l);for(let t=0;t<u;++t){const i=c.getX(t)+o,a=c.getY(t),l=c.getZ(t),u=s.stringCatalog[s.texts[t]];if(void 0===u)continue;const d=null===(r=s.objInfos)||void 0===r?void 0:r[t],m=new n.Vector3(i,a,l),p=h.build(u,m,e.offset,e.dataSource.name,e.dataSource.dataSourceOrder,d);e.addIconText(p)}}}}createObjects(e,t,i){var h,m,f,g;const y=e.mapView,w=[],b=[],T=y.animatedExtrusionHandler,S=Math.floor(y.zoomLevel),E=new a.MapEnv({$zoom:S},y.env),A=e.objects,C=y.viewRanges,P=void 0!==y.elevationProvider,L=[];for(const S of this.getAttachments(t)){const R=S.geometry,D=S.info.groups,I=D.length;for(let O=0;O<I;){const F=D[O++],V=F.start,U=F.technique,B=t.techniques[U];if(void 0===F.createdOffsets&&(F.createdOffsets=[]),F.createdOffsets.includes(e.offset)||void 0!==i&&!i(B))continue;let N=F.count;for(F.createdOffsets.push(e.offset);O<I&&D[O].technique===U&&V+N===D[O].start;++O)N+=D[O].count,D[O].createdOffsets.push(e.offset);if(!(0,u.usesObject3D)(B))continue;const k=null!==(h=null==T?void 0:T.setAnimationProperties(B,E))&&void 0!==h&&h;let z=w[U];if(void 0===z){const e=(0,u.createMaterial)(B,y,{fog:null!==y.scene.fog,shadowsEnabled:y.shadowsEnabled});if(void 0===e)continue;z=e.material,L.push(e.texturesReady),k&&(0,o.hasExtrusionFeature)(z)&&M(z,b),w[U]=z}(0,a.isTerrainTechnique)(B)&&this.setupTerrainMaterial(B,z,e.mapView.clearColor);const G=new n.BufferGeometry;null===(m=R.vertexAttributes)||void 0===m||m.forEach((e=>{const t=S.getBufferAttribute(e);G.setAttribute(e.name,t)})),null===(f=R.interleavedVertexAttributes)||void 0===f||f.forEach((e=>{S.getInterleavedBufferAttributes(e).forEach((({name:e,attribute:t})=>G.setAttribute(e,t)))}));const j=null!==(g=S.info.index)&&void 0!==g?g:R.index;if(j&&G.setIndex(S.getBufferAttribute(j)),!G.getAttribute("normal")&&(0,a.needsVertexNormals)(B)&&G.computeVertexNormals(),G.addGroup(V,N),(0,a.isSolidLineTechnique)(B)){(0,c.assert)(!(0,o.isHighPrecisionLineMaterial)(z));const t=z;!0===B.clipping&&e.projection.type===s.ProjectionType.Planar&&(e.boundingBox.getSize(_),x.set(_.x,_.y),t.clipTileSize=x),G.getAttribute("color")&&(0,o.setShaderMaterialDefine)(t,"USE_COLOR",!0)}const H=l.Expr.isExpr(B.enabled)&&R.featureStarts&&R.featureStarts.length>0,W=(0,u.buildObject)(B,G,H?[z]:z,e,P);if(W.renderOrder=(0,r.getPropertyValue)(B.renderOrder,y.env),void 0!==S.info.uuid&&(W.uuid=S.info.uuid,W.userData.geometryId=S.info.uuid),((0,a.isCirclesTechnique)(B)||(0,a.isSquaresTechnique)(B))&&void 0!==B.enablePicking&&(W.enableRayTesting=B.enablePicking),(0,a.isLineTechnique)(B)||(0,a.isSegmentsTechnique)(B)){const e=this.getFadingParams(E,B);o.FadingFeature.addRenderHelper(W,C,e.fadeNear,e.fadeFar,!1)}if((0,a.isSolidLineTechnique)(B)){const e=this.getFadingParams(E,B);o.FadingFeature.addRenderHelper(W,C,e.fadeNear,e.fadeFar,!1)}if((0,a.isExtrudedLineTechnique)(B)&&void 0!==B.fadeFar){const e=this.getFadingParams(y.env,B);o.FadingFeature.addRenderHelper(W,C,e.fadeNear,e.fadeFar,!0)}if(this.addUserData(e,R,B,W),(0,a.isExtrudedPolygonTechnique)(B)?(W.castShadow=y.shadowsEnabled,W.receiveShadow=y.shadowsEnabled):((0,a.isStandardTechnique)(B)||(0,a.isFillTechnique)(B))&&(W.receiveShadow=y.shadowsEnabled),((0,a.isExtrudedPolygonTechnique)(B)||(0,a.isStandardTechnique)(B)||(0,a.isFillTechnique)(B))&&void 0!==B.fadeFar){const e=this.getFadingParams(E,B);o.FadingFeature.addRenderHelper(W,C,e.fadeNear,e.fadeFar,!0)}if((0,a.isExtrudedPolygonTechnique)(B)&&(0,d.isRenderDepthPrePassEnabled)(B,E)){const t=(0,d.createDepthPrePassMesh)(W);this.addUserData(e,R,B,t),(0,v.registerTileObject)(e,t,{technique:B,pickability:a.Pickability.transient}),A.push(t),k&&M(t.material,b),(0,d.setDepthPrePassStencil)(t,W)}const q=(0,a.transientToPickability)((0,r.getPropertyValue)(B.transient,y.env));if((0,v.registerTileObject)(e,W,{technique:B,pickability:q}),A.push(W),(0,a.isExtrudedPolygonTechnique)(B)&&void 0!==S.info.edgeIndex){const t=l.Expr.isExpr(B.enabled)&&R.edgeFeatureStarts&&R.edgeFeatureStarts.length>0,i=B,s=new n.BufferGeometry;s.setAttribute("position",G.getAttribute("position"));const c=G.getAttribute("color");void 0!==c&&s.setAttribute("color",c);const h=G.getAttribute("extrusionAxis");void 0!==h&&s.setAttribute("extrusionAxis",h);const u=G.getAttribute("normal");void 0!==u&&s.setAttribute("normal",u);const d=G.getAttribute("uv");void 0!==d&&s.setAttribute("uv",d),s.setIndex(S.getBufferAttribute(S.info.edgeIndex));const m=B,f=this.getPolygonFadingParams(E,m),g={color:f.color,colorMix:f.colorMix,fadeNear:f.lineFadeNear,fadeFar:f.lineFadeFar,extrusionRatio:k?0:void 0,vertexColors:!!G.getAttribute("color"),rendererCapabilities:y.renderer.capabilities},_=new o.EdgeMaterial(g),x=new n.LineSegments(s,t?[_]:_);this.addUserData(e,R,B,x),x.renderOrder=W.renderOrder+.1,o.FadingFeature.addRenderHelper(x,C,f.lineFadeNear,f.lineFadeFar,!1),k&&M(x.material,b),(0,v.registerTileObject)(e,x,{technique:B,pickability:a.Pickability.transient}),p.MapMaterialAdapter.create(_,{color:i.lineColor,objectColor:i.color,opacity:i.opacity,lineWidth:e=>{const t=(0,r.getPropertyValue)(i.lineWidth,e.env);return"number"==typeof t?n.MathUtils.clamp(t,0,1):0}}),A.push(x)}if((0,a.isExtrudedPolygonTechnique)(B)&&k&&(W.customDepthMaterial=new o.MapMeshDepthMaterial({depthPacking:n.RGBADepthPacking}),M(W.customDepthMaterial,b)),(0,a.isFillTechnique)(B)&&S.info.edgeIndex){const t=l.Expr.isExpr(B.enabled)&&R.edgeFeatureStarts&&R.edgeFeatureStarts.length>0,i=new n.BufferGeometry;i.setAttribute("position",G.getAttribute("position")),i.setIndex(S.getBufferAttribute(S.info.edgeIndex));const r=B,s=this.getPolygonFadingParams(y.env,r),a={color:s.color,colorMix:s.colorMix,fadeNear:s.lineFadeNear,fadeFar:s.lineFadeFar,vertexColors:!!G.getAttribute("color"),rendererCapabilities:y.renderer.capabilities},c=new o.EdgeMaterial(a),h=new n.LineSegments(i,t?[c]:c);h.renderOrder=W.renderOrder+.1,o.FadingFeature.addRenderHelper(h,C,s.lineFadeNear,s.lineFadeFar,!1),this.addUserData(e,R,B,h),(0,v.registerTileObject)(e,h,{technique:B,pickability:q}),p.MapMaterialAdapter.create(c,{color:r.lineColor,objectColor:r.color,opacity:r.opacity}),A.push(h)}}}return b.length>0&&y.animatedExtrusionHandler.add(e,b),Promise.all(L).then()}addIconTexts(e,t){void 0!==t.iconTextGeometries&&e.mapView.imageRepo.iconTextManager.addIconTexts(e,t)}*getAttachments(e){const t=new w;for(const i of e.geometries){const e={index:i.index,edgeIndex:i.edgeIndex,uuid:i.uuid,groups:i.groups};if(yield new T(i,e,t),i.attachments)for(const e of i.attachments)yield new T(i,e,t)}}setupTerrainMaterial(e,t,i){if(!e.map||!e.displacementMap){const e=t;return e.color.set(i),void(0,o.setDisplacementMapToMaterial)(null,e)}t.onBeforeCompile=e=>{e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>","#include <map_pars_fragment>\n    uniform sampler2D displacementMap;\n    uniform float displacementScale;\n    uniform float displacementBias;"),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#ifdef USE_MAP\n    float minElevation = ${s.EarthConstants.MIN_ELEVATION.toFixed(1)};\n    float maxElevation = ${s.EarthConstants.MAX_ELEVATION.toFixed(1)};\n    float elevationRange = maxElevation - minElevation;\n\n    float disp = texture2D( displacementMap, vUv ).x * displacementScale + displacementBias;\n    vec4 texelColor = texture2D( map, vec2((disp - minElevation) / elevationRange, 0.0) );\n    texelColor = mapTexelToLinear( texelColor );\n    diffuseColor *= texelColor;\n#endif`),e.vertexShader=e.vertexShader.replace("#include <displacementmap_vertex>","")},t.displacementMap.needsUpdate=!0}addUserData(e,t,i,r){if((0,a.isTerrainTechnique)(i)){(0,c.assert)(0===Object.keys(r.userData).length,"Unexpected user data in terrain object"),(0,c.assert)("object"==typeof t.objInfos[0],"Wrong attribute map type for terrain geometry");const i=t.objInfos[0],s={tileKey:e.tileKey,texture:new n.DataTexture(i.buffer,i.xCountVertices,i.yCountVertices,n.LuminanceFormat,n.FloatType),displacementMap:i,geoBox:e.geoBox};r.userData=s}else{const n="LineSegments"===r.type&&((0,a.isExtrudedPolygonTechnique)(i)||(0,a.isFillTechnique)(i)),s={geometryType:t.type,starts:n?t.edgeFeatureStarts:t.featureStarts,objInfos:t.objInfos};void 0===r.userData&&(r.userData={}),r.userData.feature=s,r.userData.technique=i,r.userData.tileKey=e.tileKey,r.userData.dataSource=e.dataSource.name}}getFadingParams(e,t){return{fadeNear:void 0!==t.fadeNear?(0,r.getPropertyValue)(t.fadeNear,e):o.FadingFeature.DEFAULT_FADE_NEAR,fadeFar:void 0!==t.fadeFar?(0,r.getPropertyValue)(t.fadeFar,e):o.FadingFeature.DEFAULT_FADE_FAR}}getPolygonFadingParams(e,t){let i,n=o.EdgeMaterial.DEFAULT_COLOR_MIX;if(void 0!==t.lineColor&&(i=(0,r.getPropertyValue)(t.lineColor,e),(0,a.isExtrudedPolygonTechnique)(t))){const e=t;n=void 0!==e.lineColorMix?e.lineColorMix:o.EdgeMaterial.DEFAULT_COLOR_MIX}const s=void 0!==t.fadeNear?(0,r.getPropertyValue)(t.fadeNear,e):o.FadingFeature.DEFAULT_FADE_NEAR,l=void 0!==t.fadeFar?(0,r.getPropertyValue)(t.fadeFar,e):o.FadingFeature.DEFAULT_FADE_FAR,c=void 0!==t.lineFadeNear?(0,r.getPropertyValue)(t.lineFadeNear,e):s,h=void 0!==t.lineFadeFar?(0,r.getPropertyValue)(t.lineFadeFar,e):l;return void 0===i&&(i=o.EdgeMaterial.DEFAULT_COLOR),{color:i,colorMix:n,fadeNear:s,fadeFar:l,lineFadeNear:c,lineFadeFar:h}}}t.TileGeometryCreator=S},1335:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryLoader=t.TileGeometryLoaderState=void 0;const n=i(4342),r=i(3977),s=i(8015),o=i(5912);function a(e){const t=s.PerformanceStatistics.instance;if(t.enabled){const i=e.dataSource.name,n=e.tileKey.level,r=e.tileKey.column,s=e.tileKey.row,o=e.disposed?"disposed":"invisible";t.currentFrame.addMessage(`Decoded tile: ${i} # lvl=${n} col=${r} row=${s} DISCARDED - ${o}`)}}var l;!function(e){e[e.Initialized=0]="Initialized",e[e.CreationQueued=1]="CreationQueued",e[e.CreatingGeometry=2]="CreatingGeometry",e[e.Finished=3]="Finished",e[e.Canceled=4]="Canceled",e[e.Disposed=5]="Disposed"}(l=t.TileGeometryLoaderState||(t.TileGeometryLoaderState={})),t.TileGeometryLoader=class{constructor(e,t){this.m_tile=e,this.m_taskQueue=t,this.m_priority=0,this.m_state=l.Initialized,this.m_finishedPromise=new Promise(((e,t)=>{this.m_resolveFinishedPromise=e,this.m_rejectFinishedPromise=t}))}set priority(e){this.m_priority=e}getPriority(){return this.m_priority}get tile(){return this.m_tile}get hasDecodedTile(){return void 0!==this.m_decodedTile}get isFinished(){return this.m_state===l.Finished}get isSettled(){return this.isFinished||this.isCanceled||this.isDisposed}waitFinished(){return this.m_finishedPromise}setDecodedTile(e){return this.m_decodedTile=e,this.m_decodedTile}update(){const e=this.tile;this.m_state!==l.Initialized&&this.m_state!==l.Canceled||void 0===e.decodedTile||(this.m_state===l.Initialized&&(o.TileGeometryCreator.instance.processTechniques(e),this.setDecodedTile(e.decodedTile)),this.queueGeometryCreation())}cancel(){var e;a(this.tile),this.m_state=l.Canceled,null===(e=this.m_rejectFinishedPromise)||void 0===e||e.call(this)}dispose(){var e;a(this.tile),this.clear(),this.m_state=l.Disposed,null===(e=this.m_rejectFinishedPromise)||void 0===e||e.call(this)}reset(){this.clear(),this.isSettled&&(this.m_finishedPromise=new Promise(((e,t)=>{this.m_resolveFinishedPromise=e,this.m_rejectFinishedPromise=t}))),this.m_state=l.Initialized}finish(){var e;this.m_decodedTile=void 0,this.m_state=l.Finished,null===(e=this.m_resolveFinishedPromise)||void 0===e||e.call(this)}clear(){this.m_decodedTile=void 0}queueGeometryCreation(){this.m_state!==l.CreationQueued&&(this.m_taskQueue.add({execute:this.createGeometry.bind(this),group:r.TileTaskGroups.CREATE,getPriority:this.getPriority.bind(this),isExpired:()=>this.m_state!==l.CreationQueued,estimatedProcessTime:()=>{var e,t;return(null!==(t=null===(e=this.tile.decodedTile)||void 0===e?void 0:e.decodeTime)&&void 0!==t?t:30)/6}}),this.m_state=l.CreationQueued)}async createGeometry(){if(this.m_state===l.CreatingGeometry)return;this.m_state=l.CreatingGeometry;const e=this.tile,t=this.m_decodedTile;if(void 0===t)return void this.finish();const i=s.PerformanceStatistics.instance;let r=0;i.enabled&&(r=n.PerformanceTimer.now());const a=o.TileGeometryCreator.instance;e.clear(),a.initDecodedTile(t),await a.createAllGeometries(e,t),i.enabled&&this.addStats(i,r),this.finish(),e.dataSource.requestUpdate()}addStats(e,t){const i=this.tile,r=this.m_decodedTile;if(void 0===r)return;const s=n.PerformanceTimer.now()-t,o=e.currentFrame;o.addValue("render.fullFrameTime",s),o.addValue("render.geometryCreationTime",s),o.addValue("geometry.geometryCreationTime",s),o.addValue("geometryCount.numGeometries",r.geometries.length),o.addValue("geometryCount.numTechniques",r.techniques.length),o.addValue("geometryCount.numIconTextGeometries",void 0!==r.iconTextGeometries?r.iconTextGeometries.length:0),o.addValue("geometryCount.numTextGeometries",void 0!==r.textGeometries?r.textGeometries.length:0),o.addValue("geometryCount.numTextPathGeometries",void 0!==r.textPathGeometries?r.textPathGeometries.length:0),o.addValue("geometryCount.numPathGeometries",void 0!==r.pathGeometries?r.pathGeometries.length:0),o.addMessage(`Decoded tile: ${i.dataSource.name} # lvl=${i.tileKey.level} col=${i.tileKey.column} row=${i.tileKey.row}`)}get isCanceled(){return this.m_state===l.Canceled}get isDisposed(){return this.m_state===l.Disposed}}},3801:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryManager=void 0,t.TileGeometryManager=class{get visibilityCounter(){return this.m_visibilityCounter}constructor(e){this.mapView=e,this.m_visibilityCounter=1}updateTiles(e){let t=0;for(const i of e){const e=t++;i.updateGeometry(e)&&this.m_tileUpdateCallback&&this.m_tileUpdateCallback(i)}}clear(){}setTileUpdateCallback(e){this.m_tileUpdateCallback=e}incrementVisibilityCounter(){return++this.m_visibilityCounter}}},8813:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VertexCache=void 0;const n=i(4342);var r;!function(e){e[e.VertexId=0]="VertexId",e[e.OlderIdx=1]="OlderIdx",e[e.NewerIdx=2]="NewerIdx",e[e.X=3]="X",e[e.Y=4]="Y",e[e.Z=5]="Z",e[e.Count=6]="Count"}(r||(r={}));const s=-1;t.VertexCache=class{constructor(e){this.maxVertexCount=e,this.m_cache=[],this.m_vertexCount=0,this.m_oldestIdx=0,this.m_newestIdx=0,this.m_cache.length=this.maxVertexCount*r.Count,this.clear()}clear(){this.m_cache.fill(s),this.m_vertexCount=0}get(e,t){const i=this.find(e);return void 0!==i&&(this.promoteEntry(i),this.getVertex(i,t),!0)}set(e,t){let i=s;this.m_vertexCount<this.maxVertexCount?(i=this.m_vertexCount*r.Count,this.m_vertexCount++):i=this.m_oldestIdx,1===this.m_vertexCount?this.m_oldestIdx=this.m_newestIdx=i:this.promoteEntry(i),this.setVertex(i,e,t)}find(e){const t=this.m_cache.length;for(let i=0;i<t;i+=r.Count)if(this.m_cache[i]===e)return i}promoteEntry(e){if(e===this.m_newestIdx)return;const t=this.getNewerIdx(e),i=this.getOlderIdx(e);t!==s&&((0,n.assert)(this.getOlderIdx(t)===e),this.setOlderIdx(t,i)),i!==s&&((0,n.assert)(this.getNewerIdx(i)===e),this.setNewerIdx(i,t)),e===this.m_oldestIdx&&(this.m_oldestIdx=t),this.setNewerIdx(e,s),this.setOlderIdx(e,this.m_newestIdx),(0,n.assert)(this.m_newestIdx!==s),(0,n.assert)(this.getNewerIdx(this.m_newestIdx)===s),this.setNewerIdx(this.m_newestIdx,e),this.m_newestIdx=e}getOlderIdx(e){return this.m_cache[e+r.OlderIdx]}setOlderIdx(e,t){this.m_cache[e+r.OlderIdx]=t}getNewerIdx(e){return this.m_cache[e+r.NewerIdx]}setNewerIdx(e,t){this.m_cache[e+r.NewerIdx]=t}getVertex(e,t){t.x=this.m_cache[e+r.X],t.y=this.m_cache[e+r.Y],t.z=this.m_cache[e+r.Z]}setVertex(e,t,i){this.m_cache[e]=t,this.m_cache[e+r.X]=i.x,this.m_cache[e+r.Y]=i.y,this.m_cache[e+r.Z]=i.z}}},9587:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.overlayOnElevation=t.overlayIconText=void 0;const n=i(4250),r=i(1984),s=i(4342);function o(e,t){if(!("material"in e))return;const i=n.setDisplacementMapToMaterial.bind(null,t),r=e.material;Array.isArray(r)?r.forEach(i):r&&i(r)}function a(e,t,i,n){const r=n.unprojectPoint(e);if(i.geoBox.contains(r))r.altitude=t.sampleHeight(r,i);else if(r.altitude=t.getHeight(r,i.tileKey.level),void 0===r.altitude)return!1;return n.projectPoint(r,e),!0}t.overlayIconText=function(e,t,i,n){(0,s.assert)(!e.elevated),i&&(e.elevated=e.path?function(e,t,i,n){for(const r of e)if(!a(r,t,i,n))return!1;return!0}(e.path,t,i,n):a(e.position,t,i,n))},t.overlayOnElevation=function(e){const t=e.mapView.elevationProvider;if(void 0===t||0===e.objects.length)return;const i=e.objects[0];if(!i.userData||!i.userData.technique||(0,r.isTerrainTechnique)(i.userData.technique))return;const n=t.getDisplacementMap(e.tileKey);if(void 0!==n)for(const t of e.objects)o(t,n.texture)}},2967:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconText=t.IconCompositionType=t.LoadingState=void 0;const n=i(5823),r=i(2002);var s,o;(o=t.LoadingState||(t.LoadingState={}))[o.Requested=0]="Requested",o[o.Loaded=1]="Loaded",o[o.Initialized=2]="Initialized",(s=t.IconCompositionType||(t.IconCompositionType={}))[s.OVERLAID=0]="OVERLAID",s[s.NEXT_TO_EACH_OTHER=1]="NEXT_TO_EACH_OTHER";class a{constructor(e,t,i,r,s=0,o=0,a=0,l=0,c,h,u,d,m,p,f,g){this.text=e,this.points=t,this.renderParams=i,this.layoutParams=r,this.priority=s,this.zOrder=o,this.xOffset=a,this.yOffset=l,this.featureId=c,this.style=h,this.fadeNear=u,this.fadeFar=d,this.tileOffset=m,this.offsetDirection=p,this.dataSourceName=f,this.dataSourceOrder=g,this.visible=!0,this.distanceScale=.5,this.renderOrder=0,this.elevated=!1,i instanceof n.TextRenderStyle&&(this.renderStyle=i),r instanceof n.TextLayoutStyle&&(this.layoutStyle=r),this.setType()}setType(){this.type=void 0===this.path?r.IconTextType.PointIconText:this.m_iconsInfo?r.IconTextType.LineMarker:r.IconTextType.PathLabel}get position(){return this.points instanceof Array?this.points[0]:this.points}get path(){return this.points instanceof Array?this.points:void 0}get textMayOverlap(){return!0===this.mayOverlap}set textMayOverlap(e){this.mayOverlap=e}get textReservesSpace(){return!1!==this.reserveSpace}set textReservesSpace(e){this.reserveSpace=e}get iconInfoList(){return this.m_iconsInfo}set iconInfoList(e){if(void 0!==e&&e.length>0){this.m_iconsInfo=e;const t=void 0!==this.renderOrder?this.renderOrder:0;e.forEach((e=>e.renderOrder=t))}else this.m_iconsInfo=void 0;this.setType()}get renderStyle(){return this.m_renderStyle}set renderStyle(e){this.m_renderStyle=e}get layoutStyle(){return this.m_layoutStyle}set layoutStyle(e){this.m_layoutStyle=e}hasFeatureId(){return!!this.featureId}dispose(){var e,t,i;null===(e=this.iconInfoList)||void 0===e||e.forEach((e=>{var t;return null===(t=e.buffer)||void 0===t?void 0:t.decreaseRefCount()})),null===(i=null===(t=this.textBackgroundInfo)||void 0===t?void 0:t.buffer)||void 0===i||i.decreaseRefCount()}}t.IconText=a,a.HIGHEST_PRIORITY=Number.MAX_SAFE_INTEGER,a.HIGHEST_Z_ORDER=Number.MAX_SAFE_INTEGER},5316:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextBuilder=void 0;const n=i(8152),r=i(5823),s=i(1984),o=i(4342),a=i(2967),l=i(304),c=i(3174),h=o.LoggerManager.instance.create("IconTextBuilder");class u{static composeRenderOrder(e,t){return e*u.RENDER_ORDER_UP_BOUND+t}constructor(e,t,i){if(this.m_env=e,this.m_styleCache=t,this.m_baseRenderOrder=i,this.m_distanceScale=l.DEFAULT_TEXT_DISTANCE_SCALE,this.m_renderOrder=i,Number.isInteger(i))this.renderOrderUpBound=u.RENDER_ORDER_UP_BOUND;else{const e=Math.abs(i);this.renderOrderUpBound=(e-Math.floor(e))*u.RENDER_ORDER_UP_BOUND}this.isValidRenderOrder(i)||h.warn(`Large base render order (${i}) might cause precision issues.`)}withTechnique(e){var t,i,r,a,c;this.m_technique=e,this.m_priority=null!==(t=(0,n.getPropertyValue)(e.priority,this.m_env))&&void 0!==t?t:0,this.m_fadeNear=null!==(i=(0,n.getPropertyValue)(e.fadeNear,this.m_env))&&void 0!==i?i:void 0,this.m_fadeFar=null!==(r=(0,n.getPropertyValue)(e.fadeFar,this.m_env))&&void 0!==r?r:void 0,this.m_distanceScale=null!==(a=e.distanceScale)&&void 0!==a?a:l.DEFAULT_TEXT_DISTANCE_SCALE,this.m_renderStyle=this.m_styleCache.getRenderStyle(e),this.m_layoutStype=this.m_styleCache.getLayoutStyle(e),this.m_xOffset=(0,n.getPropertyValue)(e.xOffset,this.m_env),this.m_yOffset=(0,n.getPropertyValue)(e.yOffset,this.m_env),this.m_zOrder=(0,n.getPropertyValue)(e.zOrder,this.m_env);const d=null!==(c=(0,n.getPropertyValue)(e.renderOrder,this.m_env))&&void 0!==c?c:0;if(!this.isValidRenderOrder(d)){const e=`Unsupported large render order (${d})`;h.error(e),(0,o.assert)(!1,e)}return this.m_renderOrder=u.composeRenderOrder(this.m_baseRenderOrder,d),(0,s.isTextTechnique)(e)?this.withTextTechnique(e):this.withIconTextTechnique(e),this}withIcon(e,t){return(0,o.assert)(void 0!==this.m_iconInfoBuilder),this.m_iconInfoBuilder.withIcon(e),this.m_shieldGroupIndex=t,this}withTextBackgroundImage(e){return this.m_textBackgroundImageTextureName=e,this}build(e,t,i,s,l,c,h,u){var d,m;const p=(0,n.getFeatureId)(c);(0,o.assert)(void 0!==this.m_technique),(0,o.assert)(void 0!==this.m_renderStyle),(0,o.assert)(void 0!==this.m_layoutStype);const f=this.m_technique,g=this.m_renderStyle,v=this.m_layoutStype,y=new a.IconText(r.ContextualArabicConverter.instance.convert(e),t,g,v,this.m_priority,this.m_zOrder,this.m_xOffset,this.m_yOffset,p,f.style,this.m_fadeNear,this.m_fadeFar,i,u,s,l);if(y.textMinZoomLevel=this.m_textMinZoomLevel,y.textMaxZoomLevel=this.m_textMaxZoomLevel,y.iconMinZoomLevel=this.m_iconMinZoomLevel,y.iconMaxZoomLevel=this.m_iconMaxZoomLevel,y.distanceScale=this.m_distanceScale,y.mayOverlap=this.m_mayOverlap,y.reserveSpace=this.m_reserveSpace,y.userData=c,y.technique=this.m_technique,y.textFadeTime=void 0!==f.textFadeTime?1e3*f.textFadeTime:void 0,y.pathLengthSqr=h,y.alwaysOnTop=this.m_alwaysOnTop,y.renderOrder=this.m_renderOrder,y.textIsOptional=this.m_textIsOptional,y.iconIsOptional=this.m_iconIsOptional,y.iconCompositionType=this.m_iconCompositionType,y.shieldGroupIndex=this.m_shieldGroupIndex,this.m_textBackgroundImageTextureName){const e=f;y.textBackgroundInfo={technique:e,imageTextureName:this.m_textBackgroundImageTextureName,iconText:y,reserveSpace:e.textReserveSpace,renderOrder:null!==(d=y.renderOrder)&&void 0!==d?d:0}}return y.iconInfoList=null===(m=this.m_iconInfoBuilder)||void 0===m?void 0:m.build(y),y}withTextTechnique(e){var t,i;this.m_mayOverlap=!0===e.mayOverlap,this.m_reserveSpace=!1!==e.reserveSpace,this.m_iconInfoBuilder=void 0,this.m_textBackgroundImageTextureName=void 0,this.m_iconIsOptional=void 0,this.m_iconCompositionType=void 0,this.m_shieldGroupIndex=void 0,this.m_textMinZoomLevel=null!==(t=(0,n.getPropertyValue)(e.minZoomLevel,this.m_env))&&void 0!==t?t:void 0,this.m_textMaxZoomLevel=null!==(i=(0,n.getPropertyValue)(e.maxZoomLevel,this.m_env))&&void 0!==i?i:void 0}withIconTextTechnique(e){var t,i,r,s,o,l,h,u;this.m_mayOverlap=!0===e.textMayOverlap,this.m_reserveSpace=!1!==e.textReserveSpace,this.m_alwaysOnTop=!0===e.alwaysOnTop,this.m_textIsOptional=!0===e.textIsOptional,this.m_iconIsOptional=!0===e.iconIsOptional,this.m_iconCompositionType="nextToEachOther"===e["icon-composition-type"]?a.IconCompositionType.NEXT_TO_EACH_OTHER:a.IconCompositionType.OVERLAID,this.m_textMinZoomLevel=null!==(i=(0,n.getPropertyValue)(null!==(t=e.textMinZoomLevel)&&void 0!==t?t:e.minZoomLevel,this.m_env))&&void 0!==i?i:void 0,this.m_textMaxZoomLevel=null!==(s=(0,n.getPropertyValue)(null!==(r=e.textMaxZoomLevel)&&void 0!==r?r:e.maxZoomLevel,this.m_env))&&void 0!==s?s:void 0,this.m_iconMinZoomLevel=null!==(l=(0,n.getPropertyValue)(null!==(o=e.iconMinZoomLevel)&&void 0!==o?o:e.minZoomLevel,this.m_env))&&void 0!==l?l:void 0,this.m_iconMaxZoomLevel=null!==(u=(0,n.getPropertyValue)(null!==(h=e.iconMaxZoomLevel)&&void 0!==h?h:e.maxZoomLevel,this.m_env))&&void 0!==u?u:void 0,this.m_iconInfoBuilder||(this.m_iconInfoBuilder=new c.IconInfoBuilder(this.m_env)),this.m_iconInfoBuilder.withTechnique(e)}isValidRenderOrder(e){return Math.abs(e)<this.renderOrderUpBound}}t.IconTextBuilder=u,u.RENDER_ORDER_UP_BOUND=1e7},9473:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextGroup=void 0;const n=i(4342);class r extends n.PriorityListGroup{static comparePlacementPriority(e,t){return t.priority-e.priority||t.zOrder-e.zOrder}}t.IconTextGroup=r},7013:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextGroupPriorityList=void 0;const n=i(4342);class r extends n.GroupedPriorityList{}t.IconTextGroupPriorityList=r},950:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextGroupState=void 0;const n=i(4342),r=i(3981),s=i(2002);t.IconTextGroupState=class{constructor(e,t,i){this.group=e,this.tileKey=t,this.m_visited=!1,(0,n.assert)(e.elements.length>0);const o=e.elements.length;this.m_iconTextStates=[],this.m_visited=!0;for(let t=0;t<o;++t){const n=e.elements[t];if(n.type===s.IconTextType.LineMarker&&void 0!==n.path){const e=n.path.length;for(let t=0;t<e;t++){const e=new r.IconTextState(n,t),s=i(e);e.update(s),this.m_iconTextStates.push(e)}}else{const e=new r.IconTextState(n),t=i(e);e.update(t),this.m_iconTextStates.push(e)}}}get visited(){return this.m_visited}set visited(e){this.m_visited=e}get priority(){return this.group.priority}get zOrder(){return this.group.zOrder}updateFading(e,t){for(const i of this.m_iconTextStates)void 0!==i&&i.updateFading(e,t)}traverseVisibleIconTexts(e){for(const t of this.m_iconTextStates)void 0!==t&&t.visible&&e(t)}updateIconTexts(e){for(const t of this.m_iconTextStates){const i=e(t);t.update(i)}}get size(){return this.m_iconTextStates.length}get iconTextStates(){return this.m_iconTextStates}}},5738:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextManager=void 0;const n=i(82),r=i(1984),s=i(4342),o=i(5316),a=s.LoggerManager.instance.create("IconTextManager");function l(e,t=0){if(e.imageTextures){const i=e.imageTextures[t];if(i>=0)return e.stringCatalog[i]}}function c(e,t=0){if(e.textBackgroundImageTextures){const i=e.textBackgroundImageTextures[t];if(i>=0)return e.stringCatalog[i]}}function h(e,t=0){return e.objInfos?e.objInfos[t]:void 0}function u(e,t,i=0){const r=(new n.Vector3).fromBufferAttribute(e,i);return r.x+=t,r}function d(e,t=0){var i;(0,s.assert)(e.texts.length>t);const n=e.texts[t];return(0,s.assert)(e.stringCatalog.length>n),null!==(i=e.stringCatalog[n])&&void 0!==i?i:""}t.IconTextManager=class{constructor(){this.m_imageTextures=new Map,this.m_roadShieldGroups=new Map}addIconTexts(e,t){const i=(0,s.assertExists)(t.iconTextGeometries),a=e.computeWorldOffsetX(),l=e.mapView,c=Math.floor(l.zoomLevel),h=new r.MapEnv({$zoom:c},l.env),u=new o.IconTextBuilder(h,e.textStyleCache,e.dataSource.dataSourceOrder);for(const o of i){(0,s.assert)(void 0!==o.technique);const i=(0,s.assertExists)(o.technique),l=t.techniques[i];if(!(0,r.isLineMarkerTechnique)(l)&&!(0,r.isIconTextTechnique)(l))continue;if(!1===l.showOnMap)continue;const c=new n.BufferAttribute(new Float64Array(o.positions.buffer),o.positions.itemCount);u.withTechnique(l),(0,r.isLineMarkerTechnique)(l)&&c.count>0?this.addLineMarker(u,e,o,c,a):(0,r.isIconTextTechnique)(l)&&this.addIconText(u,e,o,c,a)}}async addTextureAtlas(e,t,i){const n=await fetch(t,{signal:i});if(!n.ok)throw new Error(`addTextureAtlas: Cannot load textureAtlas: ${n.statusText}`);const r=await n.json();for(const t of Object.getOwnPropertyNames(r)){const i=r[t],n={name:t,image:e,xOffset:i.x,yOffset:i.y,width:i.width,height:i.height};this.addImageTexture(n)}}addImageTexture(e){void 0!==e.name?(void 0!==this.m_imageTextures.get(e.name)&&a.warn(`addImageTexture: Name already used: ${e.name} (overriding it)`),this.m_imageTextures.set(e.name,e)):a.error("addImageTexture: Name required",e)}getImageTexture(e){return this.m_imageTextures.get(e)}clear(){this.m_imageTextures.clear(),this.m_roadShieldGroups.clear()}addLineMarker(e,t,i,n,r){const s=d(i),o=l(i),a=o+"-"+s;let c=this.m_roadShieldGroups.get(a);void 0===c&&(c=this.m_roadShieldGroups.size,this.m_roadShieldGroups.set(a,c));const m=[];for(let e=0;e<n.count;++e)m.push(u(n,r,e));const p=e.withIcon(o,c).build(s,m,t.offset,t.dataSource.name,t.dataSource.dataSourceOrder,h(i));t.addIconText(p)}addIconText(e,t,i,n,r){var s,o;for(let a=0;a<n.count;++a){const m=null!==(o=null===(s=i.offsetDirections)||void 0===s?void 0:s[a])&&void 0!==o?o:0;e.withIcon(l(i,a)),e.withTextBackgroundImage(c(i,a));const p=e.build(d(i,a),u(n,r,a),t.offset,t.dataSource.name,t.dataSource.dataSourceOrder,h(i,a),void 0,m);t.addIconText(p)}}}},304:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextRenderer=t.DEFAULT_TEXT_DISTANCE_SCALE=t.DEFAULT_FONT_CATALOG_NAME=void 0;const n=i(82),r=i(5823),s=i(4342),o=i(507),a=i(9587),l=i(7362),c=i(2967),h=i(9473),u=i(8950),d=i(791),m=i(2002),p=i(5570),f=i(9913),g=(i(7234),i(4957)),v=i(9463),y=i(3800);var _;i(859),function(e){e[e.PersistentLabels=0]="PersistentLabels",e[e.NewLabels=1]="NewLabels"}(_||(_={})),t.DEFAULT_FONT_CATALOG_NAME="default",t.DEFAULT_TEXT_DISTANCE_SCALE=.5;const x=s.LoggerManager.instance.create("IconTextRenderer",{level:s.LogLevel.Log}),w=new n.Vector3,b=new n.Vector2,T=new n.Vector2,M=[],S={},E={},A={},C={vector2:[new n.Vector2]};function P(e,t,i,n,r){E.path=n,E.pathOverflow=r,E.layer=e.renderOrder,E.letterCaseArray=e.glyphCaseArray,E.pickingData=e.userData?e:void 0,t.addText(e.glyphs,i,E)}function L(e){return void 0!==e&&(s.PerformanceTimer.now()-e>10&&(x.debug("Placement time limit exceeded."),!0))}t.IconTextRenderer=class{constructor(e,t,i,r,s,o,a,c,h){this.m_viewState=e,this.m_screenProjector=t,this.m_imageRepo=i,this.m_textureCache=r,this.m_renderer=s,this.m_loadPromisesCount=0,this.m_textCanvases=new Map,this.m_fontCatalogUrls=new Map,this.m_tmpVector=new n.Vector2,this.m_tmpVector3=new n.Vector3,this.m_cameraLookAt=new n.Vector3,this.m_overloaded=!1,this.m_cacheInvalidated=!1,this.m_addNewLabels=!0,this.m_forceNewLabelsPass=!1,this.m_iconTextStateCache=new d.IconTextStateCache,this.m_camera=new n.OrthographicCamera(-1,1,1,-1),this.m_textStyleCache=new y.TextStyleCache,this.m_screenCollisions=new l.ScreenCollisions,this.m_isUpdatePending=!1,this.m_options=Object.assign({},o),(0,u.initializeDefaultOptions)(this.m_options),this.m_maxFarDistanceRatio=Math.max(this.m_options.maxDistanceRatioForText,this.m_options.maxDistanceRatioForIconText),h?this.m_screenCollisions=h:void 0!==this.m_options.collisionDebugCanvas&&null!==this.m_options.collisionDebugCanvas&&(this.m_screenCollisions=new l.ScreenCollisionsDebug(this.m_options.collisionDebugCanvas)),this.m_textCanvasFactory=null!=a?a:new v.TextCanvasFactory(this.m_renderer),this.m_textCanvasFactory.setGlyphCountLimits(this.m_options.minNumGlyphs,this.m_options.maxNumGlyphs),this.m_imageRenderer=null!=c?c:new p.ImageRenderer(this.m_renderer,this.m_imageRepo,this.m_textureCache),this.initializeCamera(),this.updateFontCatalogs()}set disableFading(e){this.m_options.disableFading=e}get disableFading(){return!0===this.m_options.disableFading}get styleCache(){return this.m_textStyleCache}get delayLabelsUntilMovementFinished(){return!0===this.m_options.delayLabelsUntilMovementFinished}set delayLabelsUntilMovementFinished(e){this.m_options.delayLabelsUntilMovementFinished=e}get showReplacementGlyphs(){return!0===this.m_options.showReplacementGlyphs}set showReplacementGlyphs(e){this.m_options.showReplacementGlyphs=e,this.m_textCanvases.forEach((t=>{t.fontCatalog.showReplacementGlyphs=e}))}restoreRenderers(e){this.m_renderer=e,this.m_imageRenderer=new p.ImageRenderer(this.m_renderer,this.m_imageRepo,this.m_textureCache)}async updateFontCatalogs(e,i){e=null!=e?e:[];const n=this.m_options.fontCatalog;if(n&&-1===e.findIndex((e=>e.name===t.DEFAULT_FONT_CATALOG_NAME))&&e.push({name:t.DEFAULT_FONT_CATALOG_NAME,url:n}),e.length>0){for(const[t]of this.m_textCanvases)e.findIndex((e=>e.name===t))<0&&(this.m_fontCatalogUrls.delete(t),this.m_textCanvases.delete(t));await Promise.all(e.map((e=>this.addTextCanvas(e,i))))}else this.m_textCanvases.clear(),this.m_fontCatalogUrls.clear();this.m_textStyleCache.updateTextCanvases(this.m_textCanvases)}async setTheme(e,t){return this.invalidateCache(),this.m_textStyleCache.updateTextStyles(e.textStyles,e.defaultTextStyle),await this.updateFontCatalogs(e.fontCatalogs,t)}renderText(e){let t;this.m_camera.far=e,this.updateGlyphDebugMesh(),this.m_imageRenderer.update();for(const e of this.m_imageRenderer.layers){for(const[,i]of this.m_textCanvases)i.render(this.m_camera,null==t?void 0:t.id,e.id,void 0,!1);this.m_imageRenderer.render(this.m_camera,e),t=e}for(const[,e]of this.m_textCanvases)e.render(this.m_camera,null==t?void 0:t.id,void 0,void 0,!1)}invalidateCache(){this.m_cacheInvalidated=!0}movementStarted(){this.delayLabelsUntilMovementFinished&&(this.m_addNewLabels=!1)}movementFinished(){this.invalidateCache(),this.delayLabelsUntilMovementFinished&&(this.m_addNewLabels=!0)}get overloaded(){return this.m_overloaded}placeText(e,t){const i=function(e){let t=!1;return e.forEach((({renderedTiles:e})=>{e.forEach((e=>{e.iconTextsChanged&&(e.iconTextsChanged=!1,t=!0)}))})),t}(e),n=this.hasOverlayText()||i||function(e){for(let t=0;t<e.length;t++)for(const[i,n]of e[t].renderedTiles)if(n.hasIconTexts())return!0;return!1}(e);if(this.m_isUpdatePending=!1,!n&&!this.m_cacheInvalidated&&!this.m_viewState.renderedTilesChanged)return;const r=this.m_cacheInvalidated||i||this.m_viewState.renderedTilesChanged,s=r&&this.m_addNewLabels;s&&(this.m_iconTextStateCache.clearVisited(),this.updateIconTexts(e));const o=this.m_iconTextStateCache.update(t,this.m_options.disableFading,s,this.m_viewState.zoomLevel);this.reset(),this.m_addNewLabels&&this.prepopulateScreenWithBlockingElements(e);const a=(r||o)&&this.m_addNewLabels;this.placeIconTexts(t,a),this.placeOverlayIconTexts()}addOverlayText(e){0!==e.length&&(this.m_overlayIconTexts=void 0===this.m_overlayIconTexts?e.slice():this.m_overlayIconTexts.concat(e))}clearOverlayText(){this.m_overlayIconTexts=[]}hasOverlayText(){return void 0!==this.m_overlayIconTexts&&this.m_overlayIconTexts.length>0}get overlayText(){return this.m_overlayIconTexts}pickIconTexts(e,t){const i=new Map;for(const[,t]of this.m_textCanvases)t.pickText(e,(e=>{i.set(e,!0)}));this.m_imageRenderer.pickIconTexts(e,(e=>{i.set(e,!1)})),i.forEach(((e,i)=>{t(i,e)}))}get loading(){return this.m_loadPromisesCount>0}get isUpdatePending(){return this.m_isUpdatePending}async waitLoaded(){if(void 0!==this.m_loadPromise)return await this.m_loadPromise}clearRenderStates(){this.m_iconTextStateCache.clear()}getMemoryUsage(){const e={heapSize:0,gpuSize:0};for(const[,t]of this.m_textCanvases)t.getMemoryUsage(e);return this.m_imageRenderer.getMemoryUsage(e),e}reset(){this.m_cameraLookAt.copy(this.m_viewState.lookAtVector),this.m_screenCollisions.reset();for(const[,e]of this.m_textCanvases)e.clear();this.m_imageRenderer.reset()}prepopulateScreenWithBlockingElements(e){const t=[];e.forEach((e=>{const i=new n.Vector3,r=new n.Vector3;for(const n of e.renderedTiles.values())for(const e of n.blockingElements)if(!(e.points.length<2)){this.m_screenProjector.project3(e.points[0],i);for(let n=1;n<e.points.length;n++){this.m_screenProjector.project3(e.points[n],r);const s=e.screenSpaceLines[n-1];s.start.copy(i),s.end.copy(r);const o={minX:Math.min(i.x,r.x),maxX:Math.max(i.x,r.x),minY:Math.min(i.y,r.y),maxY:Math.max(i.y,r.y),line:s};t.push(o),i.copy(r)}}})),this.m_screenCollisions.allocateIBoxes(t)}placeIconTextGroup(e,t,i,n){var o;(0,s.assert)(e.visited);const l=[],c=this.m_viewState.projection,h=this.m_viewState.elevationProvider,u=null==h?void 0:h.getDisplacementMap(e.tileKey);for(const s of e.iconTextStates){if(n===_.PersistentLabels);else if(void 0!==i&&t.numRenderedIconTexts>=i)return x.debug("Placement label limit exceeded."),!1;if(!s.initialized)continue;if(void 0===s.viewDistance||s.viewDistance<0)continue;const e=s.visible;if(n===_.PersistentLabels&&!e||n===_.NewLabels&&e)continue;const d=s.iconText,p=this.m_textStyleCache.getTextStyle(d.style),g=p.textCanvas;if(void 0!==h&&!d.elevated){if(!u){this.m_isUpdatePending=!0,this.m_forceNewLabelsPass=!0;continue}(0,a.overlayIconText)(d,h,u,c)}const v=d.type;if(v===m.IconTextType.PathLabel&&(0,f.isPathLabelTooSmall)(d,this.m_screenProjector,M)){d.dbgPathTooSmall,s.reset();continue}const y=!0;if(g){if(!this.initializeGlyphs(d,p,y))continue;const e=g.getLayer(null!==(o=d.renderOrder)&&void 0!==o?o:r.DEFAULT_TEXT_CANVAS_LAYER);if(void 0!==e&&e.storage.drawCount+d.glyphs.length>e.storage.capacity){x.warn("layer glyph storage capacity exceeded.");continue}g.textRenderStyle=d.renderStyle,g.textLayoutStyle=d.layoutStyle}switch(v){case m.IconTextType.PointIconText:this.addPointIconText(s,g,t);break;case m.IconTextType.LineMarker:this.addLineMarkerLabel(s,l,g,t);break;case m.IconTextType.PathLabel:g&&this.addPathLabel(s,M,g,t)}}return!0}addLoadPromise(e){0===this.m_loadPromisesCount&&(this.m_loadPromise=void 0),++this.m_loadPromisesCount,this.m_loadPromise=this.m_loadPromise?Promise.all([this.m_loadPromise,e]):e}initializeGlyphs(e,t,i){if(e.loadingState===c.LoadingState.Initialized)return void 0!==e.glyphs;(0,s.assert)(void 0!==t.textCanvas);const n=t.textCanvas;if(void 0===e.loadingState)if(e.loadingState=c.LoadingState.Requested,void 0===e.renderStyle&&(e.renderStyle=new r.TextRenderStyle(Object.assign(Object.assign({},t.renderParams),e.renderParams))),void 0===e.layoutStyle&&(e.layoutStyle=new r.TextLayoutStyle(Object.assign(Object.assign({},t.layoutParams),e.layoutParams))),""===e.text)e.loadingState=c.LoadingState.Loaded;else{const t=n.fontCatalog.loadCharset(e.text,e.renderStyle).then((()=>{e.loadingState=c.LoadingState.Loaded,this.m_isUpdatePending=!0,this.m_forceNewLabelsPass=this.m_forceNewLabelsPass||i})).catch((t=>{x.info(`Error loading charset for '${e.text}' with font ${n.fontCatalog.name}`,t)})).finally((()=>{--this.m_loadPromisesCount}));this.addLoadPromise(t)}return e.loadingState===c.LoadingState.Loaded&&(n.textRenderStyle=e.renderStyle,n.textLayoutStyle=e.layoutStyle,e.glyphCaseArray=[],e.textBounds=void 0,e.glyphs=n.fontCatalog.getGlyphs(e.text,n.textRenderStyle,e.glyphCaseArray),e.loadingState=c.LoadingState.Initialized),void 0!==e.glyphs}initializeCamera(){this.m_camera.position.z=1,this.m_camera.near=0}updateCamera(){const{width:e,height:t}=this.m_renderer.getSize(C.vector2[0]);this.m_camera.left=e/-2,this.m_camera.right=e/2,this.m_camera.bottom=t/-2,this.m_camera.top=t/2,this.m_camera.updateProjectionMatrix(),this.m_camera.updateMatrixWorld(!1),this.m_screenCollisions.update(e,t)}async addTextCanvas(e,t){if(this.m_fontCatalogUrls.get(e.name)===e.url)return await Promise.resolve();this.m_fontCatalogUrls.set(e.name,e.url);const i=r.FontCatalog.load(e.url,1024,t).then((t=>{const i=e.name;if(this.m_fontCatalogUrls.get(i)===e.url){t.showReplacementGlyphs=this.showReplacementGlyphs;const e=this.m_textCanvasFactory.createTextCanvas(t,i);this.m_textCanvases.set(i,e)}})).catch((i=>{if(this.m_fontCatalogUrls.delete(e.name),null==t?void 0:t.aborted)throw i;x.info("rendering without font catalog, only icons possible",i)})).finally((()=>{--this.m_loadPromisesCount}));return this.addLoadPromise(i),i}updateGlyphDebugMesh(){const e=o.debugContext.getValue("DEBUG_GLYPHS");void 0!==e&&(e&&void 0===this.m_debugGlyphTextureCacheMesh&&this.initializeGlyphDebugMesh(),(0,s.assert)(void 0!==this.m_debugGlyphTextureCacheMesh),(0,s.assert)(void 0!==this.m_debugGlyphTextureCacheWireMesh),this.m_debugGlyphTextureCacheMesh.visible=e,this.m_debugGlyphTextureCacheWireMesh.visible=e)}initializeGlyphDebugMesh(){if(0===this.m_textCanvases.size)return;const e=this.m_textCanvases.values().next().value,t=e.fontCatalog,i=new n.PlaneGeometry(t.textureSize.width/2.5,t.textureSize.height/2.5,t.textureSize.width/t.maxWidth,t.textureSize.height/t.maxHeight),s=new n.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!1,map:t.texture});this.m_debugGlyphTextureCacheMesh=new n.Mesh(i,s),this.m_debugGlyphTextureCacheMesh.renderOrder=1e4,this.m_debugGlyphTextureCacheMesh.visible=!1,this.m_debugGlyphTextureCacheMesh.name="glyphDebug";const o=new n.WireframeGeometry(i),a=new n.LineBasicMaterial({transparent:!0,color:10066329,depthWrite:!1,depthTest:!1});this.m_debugGlyphTextureCacheWireMesh=new n.LineSegments(o,a),this.m_debugGlyphTextureCacheWireMesh.renderOrder=9999,this.m_debugGlyphTextureCacheWireMesh.visible=!1,this.m_debugGlyphTextureCacheWireMesh.name="glyphDebug",e.getLayer(r.DEFAULT_TEXT_CANVAS_LAYER).storage.scene.add(this.m_debugGlyphTextureCacheMesh,this.m_debugGlyphTextureCacheWireMesh)}updateIconTexts(e){this.m_iconTextStateCache.clearTextCache(),this.m_cacheInvalidated=!1,this.checkIfOverloaded(e);const t=this.overloaded&&this.m_viewState.isDynamic?s.PerformanceTimer.now():void 0;e.forEach((e=>{this.updateIconTextsFromSource(e.dataSource,e.storageLevel,Array.from(e.renderedTiles.values()),t)}))}updateIconTextsFromSource(e,t,i,n){const r=i;r.sort(((e,t)=>e.tileKey.mortonCode()-t.tileKey.mortonCode()));const o=void 0!==n,a=this.gatherGroups(e,t,r,o);let l=0;const c=(0,f.getMaxViewDistance)(this.m_viewState,this.m_maxFarDistanceRatio);let u=a.length>0?a[0].group:void 0;for(const{tile:e,group:t}of a)if(this.prepareIconTextGroup(t,e.tileKey,c),o){if(0!==h.IconTextGroup.comparePlacementPriority(u,t)){if(s.PerformanceTimer.now()-n>5){x.debug("Update time limit exceeded.");break}u=t}if(l+=t.elements.length,l>=100){x.debug("Update label limit exceeded.");break}}}prepareIconTextGroup(e,t,i){if(0===e.elements.length)return;const[,n]=this.m_iconTextStateCache.getOrSet(e,t,(e=>{let{result:t,viewDistance:n}=(0,f.checkReadyForPlacement)(e.iconText,e.iconText.type===m.IconTextType.LineMarker?e.lineMarkerIndex:void 0,this.m_viewState,i);return t!==f.PrePlacementResult.Ok||this.m_iconTextStateCache.deduplicateIconText(this.m_viewState.zoomLevel,e)||(t=f.PrePlacementResult.Duplicate,n=void 0),n}))}gatherGroups(e,t,i,n){const r=[];return i.forEach((i=>{e.shouldRenderText(t,i.tileKey)&&i.iconTextGroups.forEachGroup((e=>{r.push({tile:i,group:e})}))})),n&&r.sort(((e,t)=>h.IconTextGroup.comparePlacementPriority(e.group,t.group))),r}placeIconTexts(e,t){const i={numRenderedIconTexts:0,fadeAnimationRunning:!1,time:e},n=this.overloaded&&this.m_viewState.isDynamic?s.PerformanceTimer.now():void 0;if(0===this.m_iconTextStateCache.size)return void x.debug("IconText cache empty.");const r=this.m_forceNewLabelsPass||t;this.m_forceNewLabelsPass&&(this.m_forceNewLabelsPass=!1);const o=this.m_options.maxNumVisibleLabels,a=this.m_iconTextStateCache.sortedGroupStates;let l=a[0].group,c=0;for(let e=0;e<a.length;++e){const t=a[e],s=t.group;if(r&&0!==h.IconTextGroup.comparePlacementPriority(l,s)){if(this.placeNewIconTexts(c,e,i),L(n))break;l=s,c=e}if(!this.placeIconTextGroup(t,i,o,_.PersistentLabels))break;if(L(n))break}r&&this.placeNewIconTexts(c,a.length,i),i.fadeAnimationRunning&&(this.m_isUpdatePending=!0)}placeNewIconTexts(e,t,i){const n=this.m_iconTextStateCache.sortedGroupStates;for(let r=e;r<t&&this.placeIconTextGroup(n[r],i,this.m_options.maxNumVisibleLabels,_.NewLabels);++r);}placeOverlayIconTexts(){var e;if(void 0===this.m_overlayIconTexts||0===this.m_overlayIconTexts.length)return;const t=this.m_tmpVector.set(this.m_screenProjector.width,this.m_screenProjector.height),i=-t.width/2,s=t.height/2;for(const o of this.m_overlayIconTexts){const a=this.m_textStyleCache.getTextStyle(o.style),l=a.textCanvas;if(void 0===l)continue;const h=!1;if(this.initializeGlyphs(o,a,h),o.loadingState!==c.LoadingState.Initialized)continue;const u=l.getLayer(null!==(e=o.renderOrder)&&void 0!==e?e:r.DEFAULT_TEXT_CANVAS_LAYER);if(void 0!==u&&u.storage.drawCount+o.glyphs.length>u.storage.capacity)continue;let d;if(l.textRenderStyle=o.renderStyle,l.textLayoutStyle=o.layoutStyle,o.type!==m.IconTextType.PathLabel)T.x=i+o.position.x*t.width,T.y=s-o.position.y*t.height,void 0!==o.xOffset&&(T.x+=o.xOffset),void 0!==o.yOffset&&(T.y-=o.yOffset),w.x=T.x,w.y=T.y,w.z=0,P(o,l,w);else{T.x=i,T.y=s,void 0!==o.xOffset&&(T.x+=o.xOffset),void 0!==o.yOffset&&(T.y-=o.yOffset);const e=[];for(const i of o.path){const r=T.x+i.x*t.width,s=T.y-i.y*t.height;e.push(new n.Vector2(r,s))}d=new g.SimplePath;for(let t=0;t<e.length-1;++t)d.add(new n.LineCurve(e[t],e[t+1]));P(o,l,w,d,!0)}}}getDistanceScalingFactor(e,t,i){let n=i/t;return n=1+(n-1)*e.distanceScale,n=Math.max(n,this.m_options.labelDistanceScaleMin),n=Math.min(n,this.m_options.labelDistanceScaleMax),n}getDistanceFadingFactor(e,t,i){let r=1;const s=t.viewDistance;if(void 0!==s&&void 0!==e.fadeFar&&e.fadeFar>0){const t=void 0===e.fadeNear?0:e.fadeNear,o=e.fadeFar;o>t&&(r=1-n.MathUtils.clamp((s/i-t)/(o-t),0,1))}return r}getIconScreenPositions(e,t,i){var r,s,o;const a=[];if(!e.iconInfoList)return a;if(e.iconCompositionType===c.IconCompositionType.NEXT_TO_EACH_OTHER){let l=0;for(let t=0;t<e.iconInfoList.length;t++)l+=null!==(r=e.iconInfoList[t].computedWidth)&&void 0!==r?r:0;l*=i;const c=new n.Vector2(t.x-l/2,t.y);for(let t=0;t<e.iconInfoList.length;t++){const n=e.iconInfoList[t-1],r=e.iconInfoList[t];let l=0;n&&(l=(null!==(s=n.computedWidth)&&void 0!==s?s:0)*i/2);const h=(null!==(o=r.computedWidth)&&void 0!==o?o:0)*i/2;c.x+=l+h,a.push(c.clone())}}else for(let i=0;i<e.iconInfoList.length;i++)a.push(t);return a}addIconText(e,t,i,n,r){const o=e.iconText,a=e.textRenderState,l=o.type===m.IconTextType.LineMarker,h=!0===o.textIsOptional,u=!0===o.iconIsOptional,d=e.iconRenderState;(0,s.assert)(void 0!==d),w.x=i.x,w.y=i.y,w.z=0;const p=(0,f.pointToPlaneDistance)(t,this.m_viewState.worldCenter,this.m_cameraLookAt);if(void 0!==o.fadeFar&&(o.fadeFar<=0||o.fadeFar*this.m_viewState.maxVisibilityDist<p))return!1;e.setViewDistance(p);const g=this.getDistanceScalingFactor(o,p,this.m_viewState.lookAtDistance),v=this.getDistanceFadingFactor(o,e,this.m_viewState.maxVisibilityDist);let y=void 0!==o.iconInfoList&&s.MathUtils.isWithinBounds(this.m_viewState.zoomLevel,o.iconMinZoomLevel,o.iconMaxZoomLevel)&&o.iconInfoList.every((e=>!1!==e.isValid));y&&(this.m_imageRenderer.prepareIcons(o,this.m_viewState.env)||(y=!1,this.m_forceNewLabelsPass=!0,this.m_isUpdatePending=!0));const _=this.getIconScreenPositions(o,i,g);let x;if(y){const e=o.iconInfoList;if(o.iconCompositionType===c.IconCompositionType.NEXT_TO_EACH_OTHER)for(let t=0;t<_.length&&(x=(0,f.placeIcon)(e[t],_[t],g,this.m_viewState.env,this.m_screenCollisions),x!==f.PlacementResult.Rejected);t++);else x=(0,f.placeIcon)(e[0],_[0],g,this.m_viewState.env,this.m_screenCollisions)}const T=!u&&x===f.PlacementResult.Rejected,M=!e.visible,E=!(!n||!a),C=E&&function(e,t,i){const n=e.textRenderState,r=e.iconText,o=r.iconInfoList;if((0,s.assert)(r.type!==m.IconTextType.PathLabel),void 0===n||""===r.text)return!1;if(o&&!s.MathUtils.isWithinBounds(t.zoomLevel,r.textMinZoomLevel,r.textMaxZoomLevel))return!1;const a=(0,f.getMaxViewDistance)(t,i.maxDistanceRatioForIconText);return!!(!0===r.ignoreDistance||void 0===e.viewDistance||e.viewDistance<a&&e.viewDistance>0)}(e,this.m_viewState,this.m_options)&&!(M&&T);let P;C&&(P=(0,f.placeText)(e,i,g,n,this.m_viewState.env,this.m_screenCollisions,w,!l));let L=!1;if(E&&T||P===f.PlacementResult.Rejected?(a.startFadeOut(r.time),L=a.isVisible()):P===f.PlacementResult.Ok?(L=!0,a.startFadeIn(r.time,this.m_options.disableFading)):a.reset(),L){r.fadeAnimationRunning=r.fadeAnimationRunning||a.isFading(),function(e,t,i,n,r){const s=e.iconText,o=e.textRenderState.opacity*n*s.renderStyle.opacity;if(0===o)return!1;S.letterCaseArray=s.glyphCaseArray,void 0===s.textBufferObject&&(s.textBufferObject=t.createTextBufferObject(s.glyphs,S));const a=s.renderStyle.backgroundOpacity>0&&t.textRenderStyle.fontSize.backgroundSize>0;A.layer=s.renderOrder,A.position=i,A.scale=r,A.opacity=o,A.backgroundOpacity=a?A.opacity*s.renderStyle.backgroundOpacity:0,A.pickingData=s.userData?s:void 0,t.addTextBufferObject(s.textBufferObject,A)}(e,n,w,v,g);const t=o.textBackgroundInfo;t&&this.m_imageRenderer.prepareTextBackground(o)&&o.textBounds&&(b.x=w.x,b.y=w.y,this.m_imageRenderer.addTextBackground(t,b,o.textBounds,e.renderDistance,g))}let R=!1;if(x===f.PlacementResult.Rejected||!h&&P===f.PlacementResult.Rejected?(d.startFadeOut(r.time),R=d.isVisible()):x===f.PlacementResult.Ok?(R=!0,d.startFadeIn(r.time,this.m_options.disableFading)):d.reset(),R&&(r.fadeAnimationRunning=r.fadeAnimationRunning||d.isFading(),o.iconInfoList))for(let t=0;t<o.iconInfoList.length;t++){const i=o.iconInfoList[t];this.m_imageRenderer.addIcon(i,_[t],this.m_screenCollisions,e.renderDistance,g,!1!==i.reserveSpace&&x===f.PlacementResult.Ok,d.opacity*v,this.m_viewState.env)}return!(!R&&!L||(r.numRenderedIconTexts++,0))}addPointIconText(e,t,i){const n=(0,f.getWorldPosition)(e.iconText,this.m_viewState.projection,this.m_viewState.env,this.m_tmpVector3);return!!this.labelPotentiallyVisible(n,T)&&this.addIconText(e,n,T,t,i)}addLineMarkerLabel(e,t,i,n){var r;const o=e.iconText;if(!(null===(r=this.m_imageRenderer)||void 0===r?void 0:r.prepareIcons(o,this.m_viewState.env)))return;let a;void 0!==o.shieldGroupIndex&&(a=t[o.shieldGroupIndex],void 0===a&&(a=[],t[o.shieldGroupIndex]=a));const l=o.technique,c=void 0!==l.minDistance?l.minDistance*l.minDistance:0;if(c>0&&void 0!==a){let t=0;const r=e.position;if(this.labelPotentiallyVisible(r,T)){let o=!1;for(let e=0;e<a.length&&(o=s.Math2D.distSquared(a[e],a[e+1],T.x,T.y)<c,!o);e+=2);o||this.addIconText(e,r,T,i,n)&&(a.push(T.x,T.y),t++)}0===t&&e.reset()}else{const t=e.position;this.labelPotentiallyVisible(t,T)&&this.addIconText(e,t,T,i,n)}}addPathLabel(e,t,i,r){const s=(0,f.getMaxViewDistance)(this.m_viewState,this.m_options.maxDistanceRatioForText),o=e.iconText;if(!(!0===o.ignoreDistance||void 0===e.viewDistance||e.viewDistance<s))return e.textRenderState.reset(),!1;if(void 0!==o.fadeFar&&(o.fadeFar<=0||o.fadeFar*this.m_viewState.maxVisibilityDist<e.renderDistance))return e.textRenderState.reset(),!1;let a=new n.Path;T.copy(t[0]);for(let e=0;e<t.length-1;++e)a.add(new g.SimpleLineCurve(t[e],t[e+1]));if(a.getPoint(.5).x-a.getPoint(.51).x>0){T.copy(t[t.length-1]),a=new n.Path;for(let e=t.length-1;e>0;--e)a.add(new g.SimpleLineCurve(t[e],t[e-1]))}e.setViewDistance((0,f.computeViewDistance)(o,void 0,this.m_viewState.worldCenter,this.m_cameraLookAt));const l=-e.renderDistance,c=this.getDistanceScalingFactor(o,l,this.m_viewState.lookAtDistance),h=i.textRenderStyle.fontSize.size;if(i.textRenderStyle.fontSize.size*=c,(0,f.placePathLabel)(e,a,T,i,this.m_screenCollisions)!==f.PlacementResult.Ok)return i.textRenderStyle.fontSize.size=h,e.textRenderState.reset(),!1;e.textRenderState.startFadeIn(r.time,this.m_options.disableFading);let u=o.renderStyle.opacity;if(e.textRenderState.isFading()&&(u*=e.textRenderState.opacity,r.fadeAnimationRunning=!0),0===e.textRenderState.opacity)return i.textRenderStyle.fontSize.size=h,!1;const d=i.textRenderStyle.opacity,m=i.textRenderStyle.backgroundOpacity,p=this.getDistanceFadingFactor(o,e,this.m_viewState.maxVisibilityDist);return i.textRenderStyle.opacity=u*p,i.textRenderStyle.backgroundOpacity=i.textRenderStyle.opacity*o.renderStyle.backgroundOpacity,w.z=e.renderDistance,P(o,i,w,a),r.numRenderedIconTexts++,i.textRenderStyle.fontSize.size=h,i.textRenderStyle.opacity=d,i.textRenderStyle.backgroundOpacity=m,!0}checkIfOverloaded(e){let t=0;e.forEach((e=>{for(const i of e.renderedTiles.values())t+=i.iconTextGroups.count()}));const i=t>2e4;return i&&!this.m_overloaded&&x.debug("Overloaded Mode enabled."),this.m_overloaded=i,this.m_overloaded}labelPotentiallyVisible(e,t){var i;const r=n.MathUtils.clamp(null!==(i=this.m_options.maxIconTextDistanceToBorder)&&void 0!==i?i:0,0,1);return void 0!==this.m_screenProjector.projectAreaToScreen(e,r,r,t)}}},8950:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initializeDefaultOptions=void 0,t.initializeDefaultOptions=function(e){void 0===e.minNumGlyphs&&(e.minNumGlyphs=1024),void 0===e.maxNumGlyphs&&(e.maxNumGlyphs=32768),void 0===e.labelDistanceScaleMin&&(e.labelDistanceScaleMin=.7),void 0===e.labelDistanceScaleMax&&(e.labelDistanceScaleMax=1.5),void 0===e.maxDistanceRatioForText&&(e.maxDistanceRatioForText=.99),void 0===e.maxDistanceRatioForIconText&&(e.maxDistanceRatioForIconText=.99),void 0===e.disableFading&&(e.disableFading=!1),void 0===e.delayLabelsUntilMovementFinished&&(e.delayLabelsUntilMovementFinished=!0),void 0===e.showReplacementGlyphs&&(e.showReplacementGlyphs=!1),void 0===e.maxIconTextDistanceToBorder&&(e.maxIconTextDistanceToBorder=.2)}},3981:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLineMarkerState=t.IconTextState=void 0;const n=i(5823),r=i(4342),s=i(2002),o=i(3569),a=i(6445);t.IconTextState=class{constructor(e,t){this.iconText=e,this.m_lineMarkerIndex=t}get initialized(){return void 0!==this.m_textRenderState||void 0!==this.m_iconRenderState}get visible(){if(void 0!==this.m_textRenderState&&this.m_textRenderState.isVisible())return!0;const e=this.iconRenderState;return!(void 0===e||!e.isVisible())}get textPlacement(){const e=this.iconText.layoutStyle,t=this.m_textLayoutState;return void 0!==t?t.textPlacement:{h:(0,n.hPlacementFromAlignment)(e.horizontalAlignment),v:(0,n.vPlacementFromAlignment)(e.verticalAlignment)}}set textPlacement(e){void 0===this.m_textLayoutState&&!0===this.isBaseTextPlacement(e)||(void 0===this.m_textLayoutState?this.m_textLayoutState=new a.LayoutState(e):this.m_textLayoutState.textPlacement=e)}isBaseTextPlacement(e){const t=this.iconText.layoutStyle;if(void 0!==t)return(0,n.hAlignFromPlacement)(e.h)===t.horizontalAlignment&&(0,n.vAlignFromPlacement)(e.v)===t.verticalAlignment}reset(){void 0!==this.m_textRenderState&&this.m_textRenderState.reset(),void 0!==this.m_textLayoutState&&(void 0!==this.iconText.layoutStyle?this.m_textLayoutState.reset(this.iconText.layoutStyle):this.m_textLayoutState=void 0),this.iconRenderState&&this.m_iconRenderState.reset(),this.m_viewDistance=void 0,this.iconText.textBufferObject=void 0,this.iconText.textBounds=void 0}replace(e){this.m_textRenderState=e.m_textRenderState,this.m_textLayoutState=e.m_textLayoutState,this.m_iconRenderState=e.m_iconRenderState,e.m_textRenderState=void 0,e.m_textLayoutState=void 0,e.m_iconRenderState=void 0,void 0===this.iconText.glyphs&&(this.iconText.glyphs=e.iconText.glyphs,this.iconText.glyphCaseArray=e.iconText.glyphCaseArray),this.iconText.textBounds=void 0,this.iconText.textBufferObject=void 0}get viewDistance(){return this.m_viewDistance}update(e){this.initialized||void 0===e||this.initializeRenderStates(),this.setViewDistance(e)}setViewDistance(e){this.m_viewDistance=e}get renderDistance(){return!0===this.iconText.alwaysOnTop?0:void 0!==this.m_viewDistance?-this.m_viewDistance:0}get textRenderState(){return this.m_textRenderState}get iconRenderState(){return this.m_iconRenderState}get lineMarkerIndex(){return this.m_lineMarkerIndex}get position(){return void 0!==this.iconText.path&&void 0!==this.m_lineMarkerIndex?this.iconText.path[this.m_lineMarkerIndex]:this.iconText.position}updateFading(e,t){void 0!==this.m_textRenderState&&this.m_textRenderState.updateFading(e,t),void 0!==this.iconRenderState&&this.iconRenderState.updateFading(e,t)}initializeRenderStates(){var e;(0,r.assert)(void 0===this.m_textRenderState),(0,r.assert)(void 0===this.m_textLayoutState),(0,r.assert)(void 0===this.m_iconRenderState);const{textFadeTime:t}=this.iconText;if(this.m_textRenderState=new o.RenderState(t),this.iconText.type===s.IconTextType.PointIconText||this.iconText.type===s.IconTextType.LineMarker){const i=null===(e=this.iconText.technique)||void 0===e?void 0:e.iconFadeTime;this.m_iconRenderState=new o.RenderState(void 0!==i?1e3*i:t)}}},t.isLineMarkerState=function(e){return void 0!==e.m_lineMarkerIndex}},791:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextStateCache=void 0;const n=i(4342),r=i(9473),s=i(950),o=i(3981),a=i(2002),l=n.LoggerManager.instance.create("IconTextStateCache",{level:n.LogLevel.Log}),c={entries:[],index:-1};function h(e){return e.hasFeatureId()?e.featureId:e.text}function u(e,t,i,n){return void 0!==e.pathLengthSqr&&void 0!==i.pathLengthSqr&&e.pathLengthSqr>i.pathLengthSqr}function d(e,t,i,n){return t<n}t.IconTextStateCache=class{constructor(){this.m_referenceMap=new Map,this.m_textMap=new Map}getOrSet(e,t,i){let n=this.get(e);return void 0!==n?(n.updateIconTexts(i),[n,!0]):(n=new s.IconTextGroupState(e,t,i),this.set(e,n),[n,!1])}get size(){return this.m_referenceMap.size}get cacheSize(){return this.m_textMap.size}get sortedGroupStates(){return void 0===this.m_sortedGroupStates&&(this.m_sortedGroupStates=Array.from(this.m_referenceMap.values()),this.m_sortedGroupStates.sort(((e,t)=>r.IconTextGroup.comparePlacementPriority(e.group,t.group)))),(0,n.assert)(this.m_referenceMap.size===this.m_sortedGroupStates.length),this.m_sortedGroupStates}update(e,t,i,n){const r=i?this.replaceIconText.bind(this,n):void 0;let s=!1;for(const[n,o]of this.m_referenceMap.entries())o.visited?o.updateFading(e,t):(i&&o.traverseVisibleIconTexts(r),this.m_referenceMap.delete(n),this.m_sortedGroupStates=void 0,s=!0);return s}clearVisited(){for(const e of this.m_referenceMap.values())e.visited=!1}clearTextCache(){this.m_textMap.clear()}clear(){this.m_referenceMap.clear(),this.m_sortedGroupStates=void 0,this.m_textMap.clear()}deduplicateIconText(e,t){const i=this.findDuplicate(t,e);if(void 0===i)return this.m_textMap.set(h(t.iconText),[t]),!0;if(-1===i.index)return i.entries.push(t),!0;const n=i.entries[i.index];return!(n.visible||!t.visible||(i.entries[i.index]=t,n.reset(),0))}replaceIconText(e,t){(0,n.assert)(t.visible);const i=this.findDuplicate(t,e);return void 0!==i&&-1!==i.index&&(i.entries[i.index].replace(t),!0)}get(e){const t=this.m_referenceMap.get(e);return void 0!==t&&(t.visited=!0),t}set(e,t){(0,n.assert)(e.elements.length>0),this.m_referenceMap.set(e,t),this.m_sortedGroupStates=void 0}findDuplicate(e,t){const i=e.iconText,r=this.m_textMap.get(h(i));if(void 0===r)return;c.entries=r;const s=i.hasFeatureId()?function(e,t){const i=e.iconText,r=t.findIndex((e=>e.iconText.tileOffset===i.tileOffset));if(-1===r)return-1;const s=t[r].iconText;if((0,n.assert)(i.featureId===s.featureId),s.text===i.text)return r;l.debug(`Text feature id ${i.featureId} collision between "${i.text} and              ${s.text}`)}(e,r):function(e,t,i){const n=e.iconText,r=function(e){return 100<<(Math.min(4,13-Math.min(13,Math.floor(e)))<<2)}(i),s=t.length,l=e.position,c=e.visible,h=(0,o.isLineMarkerState)(e);let m,p=-1,f=1/0;const g=n.type===a.IconTextType.PathLabel?u:d;for(let e=0;e<s;++e){const i=t[e],s=i.iconText,a=n.type!==s.type||h!==(0,o.isLineMarkerState)(i),u=c&&i.visible;if(a||u)continue;const d=l.distanceToSquared(s.position);d>r||(void 0===m||g(s,d,m,f))&&(p=e,m=s,f=d)}return p}(e,r,t);return void 0===s?(i.featureId=void 0,this.findDuplicate(e,t)):(c.index=s,c)}}},2002:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextType=void 0,(i=t.IconTextType||(t.IconTextType={}))[i.PointIconText=0]="PointIconText",i[i.PathLabel=1]="PathLabel",i[i.LineMarker=2]="LineMarker"},8488:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewState=void 0;const n=i(82);t.MapViewState=class{constructor(e,t){this.m_mapView=e,this.m_renderedTilesChangeCheck=t,this.m_lookAtVector=new n.Vector3}get worldCenter(){return this.m_mapView.worldCenter}get cameraIsMoving(){return this.m_mapView.cameraIsMoving}get maxVisibilityDist(){return this.m_mapView.viewRanges.maximum}get zoomLevel(){return this.m_mapView.zoomLevel}get env(){return this.m_mapView.env}get frameNumber(){return this.m_mapView.frameNumber}get lookAtVector(){return this.m_mapView.camera.getWorldDirection(this.m_lookAtVector)}get lookAtDistance(){return this.m_mapView.targetDistance}get isDynamic(){return this.m_mapView.isDynamicFrame}get renderedTilesChanged(){return this.m_renderedTilesChangeCheck()}get projection(){return this.m_mapView.projection}get elevationProvider(){return this.m_mapView.elevationProvider}}},9913:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWorldPosition=t.isPathLabelTooSmall=t.placePathLabel=t.placeText=t.placeIcon=t.PlacementResult=t.checkReadyForPlacement=t.PrePlacementResult=t.getMaxViewDistance=t.pointToPlaneDistance=t.computeViewDistance=void 0;const n=i(82),r=i(8152),s=i(2616),o=i(5823),a=i(1984),l=i(4342),c=i(7362),h=i(2967),u=i(2002),d=i(5154),m=i(5570),p=new n.Vector3(0,0,0),f=new n.Vector3(0,0,0),g=new n.Vector3(0,0,0);function v(e,t,i,n){let r;const s=e.path;if(s&&s.length>1)if(void 0!==t&&s&&s.length>t)r=y(s[t],i,n);else{const e=y(s[0],i,n),t=y(s[s.length-1],i,n);r=Math.min(e,t)}else r=y(e.position,i,n);return r}function y(e,t,i){return g.copy(e).sub(t).dot(i)}var _;t.computeViewDistance=v,t.pointToPlaneDistance=y,t.getMaxViewDistance=function(e,t){return e.maxVisibilityDist*t},function(e){e[e.Ok=0]="Ok",e[e.Invisible=1]="Invisible",e[e.TooFar=2]="TooFar",e[e.Duplicate=3]="Duplicate",e[e.Count=4]="Count"}(_=t.PrePlacementResult||(t.PrePlacementResult={}));const x=new n.Vector3;t.checkReadyForPlacement=function(e,t,i,n){let r;return e.visible&&e.visible&&i.zoomLevel!==e.textMaxZoomLevel&&l.MathUtils.isWithinBounds(i.zoomLevel,e.textMinZoomLevel,e.textMaxZoomLevel)?(r=void 0===n?v(e,t,i.worldCenter,i.lookAtVector):function(e,t,i,n,r,o){const a=v(e,t,i,n);return r!==s.ProjectionType.Spherical?a<=o?a:void 0:(p.copy(e.position).normalize(),f.copy(i).normalize(),p.dot(f)>.5877852522924731&&a<=o?a:void 0)}(e,t,i.worldCenter,i.lookAtVector,i.projection.type,n),void 0===r?{result:_.TooFar,viewDistance:r}:{result:_.Ok,viewDistance:r}):{result:_.Invisible,viewDistance:r}};const w=new n.Box2,b=new n.Box2,T=[],M={},S=[],E=new c.CollisionBox,A=new n.Vector2,C=new n.Vector2,P=new l.Math2D.Box,L=new n.Vector2,R=new n.Vector2;var D;function I(e,t,i,s,c,m,p,f,g){const v=e.iconText;(0,l.assert)(void 0!==v.glyphs),(0,l.assert)(void 0!==v.layoutStyle);const y=!v.textBounds||f,_=y?b:v.textBounds;if(y){O(c,i),M.outputCharacterBounds=void 0,M.path=void 0,M.pathOverflow=!1,M.letterCaseArray=v.glyphCaseArray,c.measureText(v.glyphs,_,M);const e=v.technique;if(e&&(0,a.isIconTextTechnique)(e)){const t=(0,r.getPropertyValue)(e["background-padding"],m);t&&(t.x&&(_.min.x-=t.x),t.y&&(_.max.y+=t.y),t.z&&(_.max.x+=t.z),t.w&&(_.min.y-=t.w))}}const x=function(e,t,i,s,a,c=new n.Vector2){switch((0,l.assert)(e.type===u.IconTextType.PointIconText||e.type===u.IconTextType.LineMarker),(0,l.assert)(void 0!==e.layoutStyle),c.x=e.xOffset,c.y=e.yOffset,i.h){case o.HorizontalPlacement.Left:c.x-=t.max.x;break;case o.HorizontalPlacement.Right:c.x-=t.min.x}switch(i.v){case o.VerticalPlacement.Top:c.y-=t.min.y;break;case o.VerticalPlacement.Center:c.y-=.5*(t.max.y+t.min.y);break;case o.VerticalPlacement.Bottom:c.y-=t.max.y}if(e.iconInfoList){let t=0,n=0;if(e.iconCompositionType===h.IconCompositionType.NEXT_TO_EACH_OTHER)for(let i=0;i<e.iconInfoList.length;i++){const r=e.iconInfoList[i];(0,d.imageIsRenderable)(r)&&((0,l.assert)(void 0!==r.computedWidth),(0,l.assert)(void 0!==r.computedHeight),t+=r.computedWidth,n=r.computedHeight)}else{const i=e.iconInfoList[0];(0,d.imageIsRenderable)(i)&&((0,l.assert)(void 0!==i.computedWidth),(0,l.assert)(void 0!==i.computedHeight),t=i.computedWidth,n=i.computedHeight)}c.x+=t*(.5+i.h),c.y+=n*(.5+i.v);const s=(0,o.hPlacementFromAlignment)(e.layoutStyle.horizontalAlignment),u=(0,o.vPlacementFromAlignment)(e.layoutStyle.verticalAlignment);if(s!==i.h||u!==i.v){const t=e.technique;let n=(0,r.getPropertyValue)(t.iconXOffset,a),l=(0,r.getPropertyValue)(t.iconYOffset,a);n="number"==typeof n?n:0,l="number"==typeof l?l:0;const h=s-i.h,d=u-i.v,m=n-e.xOffset,p=l-e.yOffset;s===o.HorizontalPlacement.Center||u===o.VerticalPlacement.Center?(c.x+=2*Math.abs(h)*m,c.y-=2*d*Math.abs(m),c.y+=2*Math.abs(d)*p,c.x-=2*h*Math.abs(p)):(c.x+=2*Math.min(Math.abs(h),.5)*m,c.y-=2*Math.sign(d)*Math.min(Math.abs(d),.5)*Math.abs(m),c.y+=2*Math.min(Math.abs(d),.5)*p,c.x-=2*Math.sign(h)*Math.min(Math.abs(h),.5)*Math.abs(p))}}return c.multiplyScalar(s),c}(v,_,i,s,m,C).add(t);return g.set(x.x,x.y,e.renderDistance),w.copy(_).translate(x),w.getCenter(L),w.getSize(R),R.multiplyScalar(s),P.set(L.x-R.x/2,L.y-R.y/2,R.x,R.y),p.isVisible(P)?(y&&(w.getSize(R),R.multiplyScalar(s),P.set(L.x-R.x/2,L.y-R.y/2,R.x,R.y)),!v.textMayOverlap&&p.isAllocated(P)?D.Rejected:(v.textReservesSpace&&p.allocate(P),y?(v.textBufferObject=void 0,v.textBounds=v.textBounds?v.textBounds.copy(_):_.clone()):O(c,i),e.textPlacement=i,D.Ok)):D.Invisible}function O(e,t){e.textLayoutStyle.horizontalAlignment=(0,o.hAlignFromPlacement)(t.h),e.textLayoutStyle.verticalAlignment=(0,o.vAlignFromPlacement)(t.v)}!function(e){e[e.Ok=0]="Ok",e[e.Rejected=1]="Rejected",e[e.Invisible=2]="Invisible"}(D=t.PlacementResult||(t.PlacementResult={})),t.placeIcon=function(e,t,i,n,r){return m.ImageRenderer.computeIconScreenBox(e,t,i,n,P,m.Margin.CHECK),r.isVisible(P)?!0!==e.mayOverlap&&r.isAllocated(P)?D.Rejected:D.Ok:D.Invisible},t.placeText=function(e,t,i,n,r,s,o,a=!1){(0,l.assert)(void 0!==e.iconText.layoutStyle);const c=e.iconText.layoutStyle;return(a=a&&void 0!==c.placements&&c.placements.length>1)?function(e,t,i,n,r,s,o){(0,l.assert)(void 0!==e.iconText.layoutStyle);const a=e.iconText,c=e.visible,h=e.textPlacement,u=a.layoutStyle.placements,d=u.length,m=u.findIndex((e=>e.h===h.h&&e.v===h.v));(0,l.assert)(m>=0);let p=!0;for(let a=m;a<d+m;++a){const l=a===m&&c,h=I(e,t,u[a%d],i,n,r,s,!l,x);if(h===D.Ok)return o.copy(x),D.Ok;l&&o.copy(x),p=p&&h===D.Invisible}return p?D.Invisible:D.Rejected}(e,t,i,n,r,s,o):function(e,t,i,n,r,s,o){(0,l.assert)(void 0!==e.iconText.layoutStyle);return I(e,t,e.textPlacement,i,n,r,s,!e.visible,o)}(e,t,i,n,r,s,o)},t.placePathLabel=function(e,t,i,n,r){if(M.path=t,M.outputCharacterBounds=T,M.letterCaseArray=e.iconText.glyphCaseArray,!n.measureText(e.iconText.glyphs,w,M))return D.Rejected;if(E.copy(w.translate(i)),!r.isVisible(E))return D.Invisible;let s,o=!1;e.iconText.textMayOverlap||(s=r.search(E),o=s.length>0),S.length=T.length;for(let e=0;e<T.length;++e){const t=T[e].translate(i);let n=S[e];if(void 0===n?(n=new c.CollisionBox(t),S[e]=n):n.copy(t),o&&r.intersectsDetails(n,s))return D.Rejected}if(e.iconText.textReservesSpace){const e=new c.DetailedCollisionBox(E,S.slice());S.length=0,r.allocate(e)}return D.Ok},t.isPathLabelTooSmall=function(e,t,i){(0,l.assert)(e.type===u.IconTextType.PathLabel),i.length=0;let n=!1;for(const r of e.points)void 0!==(n?t.project(r,A):t.projectToScreen(r,A))&&(n=!0,i.push(A.clone()));if(!n)return!0;const r=5*e.text.length;return w.setFromPoints(i),w.max.sub(w.min).lengthSq()<r*r&&(e.dbgPathTooSmall=!0,!0)};const F=new s.OrientedBox3;t.getWorldPosition=function(e,t,i,s){var o;const a=(0,r.getPropertyValue)(null===(o=e.technique)||void 0===o?void 0:o.worldOffset,i);if(null==s||s.copy(e.position),null!=a&&void 0!==e.offsetDirection){t.localTangentSpace(e.position,F);const i=F.yAxis,r=n.MathUtils.degToRad(e.offsetDirection);i.applyAxisAngle(F.zAxis.negate(),r),s.addScaledVector(F.yAxis,a)}return s}},7234:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlacementStats=void 0,t.PlacementStats=class{constructor(e){this.m_logger=e,this.totalGroups=0,this.resortedGroups=0,this.total=0,this.uninitialized=0,this.tooFar=0,this.numNotVisible=0,this.numPathTooSmall=0,this.numCannotAdd=0,this.numRenderedIcons=0,this.numRenderedTexts=0,this.numTextsInvisible=0,this.numRenderedIconTexts=0}clear(){this.totalGroups=0,this.resortedGroups=0,this.total=0,this.uninitialized=0,this.tooFar=0,this.numNotVisible=0,this.numPathTooSmall=0,this.numCannotAdd=0,this.numRenderedIcons=0,this.numRenderedTexts=0,this.numTextsInvisible=0,this.numRenderedIconTexts=0}log(){const e=this.uninitialized+this.numTextsInvisible+this.tooFar+this.numNotVisible+this.numCannotAdd;this.m_logger.debug("Total groups",this.totalGroups),this.m_logger.debug("Resorted groups",this.resortedGroups),this.m_logger.debug("Total labels",this.total),this.m_logger.debug("Rendered labels",this.numRenderedIconTexts),this.m_logger.debug("Rejected labels",e),this.m_logger.debug("Unitialized labels",this.uninitialized),this.m_logger.debug("Rendered icons",this.numRenderedIcons),this.m_logger.debug("Rendered texts",this.numRenderedTexts),this.m_logger.debug("Texts invisible",this.numTextsInvisible),this.m_logger.debug("Too far",this.tooFar),this.m_logger.debug("Not visible",this.numNotVisible),this.m_logger.debug("Path too small",this.numPathTooSmall),this.m_logger.debug("Rejected, max glyphs reached",this.numCannotAdd)}}},3569:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderState=t.DEFAULT_FADE_TIME=t.FadingState=void 0;const n=i(82),r=i(4342);var s;!function(e){e[e.Undefined=0]="Undefined",e[e.FadingIn=1]="FadingIn",e[e.FadedIn=2]="FadedIn",e[e.FadingOut=-1]="FadingOut",e[e.FadedOut=-2]="FadedOut"}(s=t.FadingState||(t.FadingState={})),t.DEFAULT_FADE_TIME=800,t.RenderState=class{constructor(e=t.DEFAULT_FADE_TIME){this.fadeTime=e,this.value=0,this.startTime=0,this.opacity=0,this.m_state=s.Undefined}reset(){this.m_state=s.Undefined,this.value=0,this.startTime=0,this.opacity=0}isUndefined(){return this.m_state===s.Undefined}isFading(){return this.m_state===s.FadingIn||this.m_state===s.FadingOut}isFadingIn(){return this.m_state===s.FadingIn}isFadingOut(){return this.m_state===s.FadingOut}isFadedIn(){return this.m_state===s.FadedIn}isFadedOut(){return this.m_state===s.FadedOut}isVisible(){return this.m_state!==s.FadedOut&&this.m_state!==s.Undefined&&this.opacity>0}startFadeIn(e,t){if(this.m_state!==s.FadingIn&&this.m_state!==s.FadedIn){if(!0===t)return this.value=1,this.opacity=1,this.m_state=s.FadedIn,void(this.startTime=e);this.m_state===s.FadingOut?(this.value=1-this.value,this.startTime=e-this.value*this.fadeTime):(this.startTime=e,this.value=0,this.opacity=0),this.m_state=s.FadingIn}}startFadeOut(e){this.m_state!==s.FadingOut&&this.m_state!==s.FadedOut&&this.m_state!==s.Undefined&&(this.m_state===s.FadingIn?(this.startTime=e-this.value*this.fadeTime,this.value=1-this.value):(this.startTime=e,this.value=0,this.opacity=1),this.m_state=s.FadingOut)}updateFading(e,t){if(this.m_state!==s.FadingIn&&this.m_state!==s.FadingOut)return;0===this.startTime&&(this.startTime=e);const i=e-this.startTime,o=this.m_state===s.FadingIn?0:1,a=this.m_state===s.FadingIn?1:0;t||i>=this.fadeTime?(this.value=1,this.opacity=a,this.m_state=this.m_state===s.FadingIn?s.FadedIn:s.FadedOut):(this.value=i/this.fadeTime,this.opacity=n.MathUtils.clamp(r.MathUtils.smootherStep(o,a,this.value),0,1),(0,r.assert)(this.isFading()))}}},859:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateStats=void 0;const n=i(9913);t.UpdateStats=class{constructor(e){this.m_logger=e,this.tiles=0,this.totalGroups=0,this.newGroups=0,this.totalLabels=0,this.results=new Array(n.PrePlacementResult.Count),this.results.fill(0)}clear(){this.tiles=0,this.totalGroups=0,this.newGroups=0,this.totalLabels=0,this.results.fill(0)}log(){this.m_logger.debug("Tiles",this.tiles),this.m_logger.debug("Total groups",this.totalGroups),this.m_logger.debug("New groups",this.newGroups),this.m_logger.debug("Total labels",this.totalLabels),this.m_logger.debug("Placed labels",this.results[n.PrePlacementResult.Ok]),this.m_logger.debug("Invisible",this.results[n.PrePlacementResult.Invisible]),this.m_logger.debug("Too far",this.results[n.PrePlacementResult.TooFar]),this.m_logger.debug("Duplicate",this.results[n.PrePlacementResult.Duplicate])}}},4298:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BoxBuffer=t.BoxBufferMesh=void 0;const n=i(82),r=i(4342),s=i(161);class o extends n.Mesh{constructor(e,t){super(e,t),this.type="BoxBufferMesh"}get isEmpty(){if(void 0===this.geometry)return!0;{const e=this.geometry;return null===e.index||0===e.index.count}}}t.BoxBufferMesh=o;class a{constructor(e,t=0,i=0,n=32768){this.m_material=e,this.m_renderOrder=t,this.m_maxElementCount=n,this.m_size=0,this.resizeBuffer(i),this.m_pickInfos=new Array}clone(){return new a(this.m_material,this.m_renderOrder)}dispose(){void 0!==this.m_geometry&&(this.m_geometry.dispose(),this.m_geometry=void 0),this.m_mesh=void 0}get size(){return this.m_size}reset(){void 0!==this.m_positionAttribute&&(this.m_positionAttribute.count=0,this.m_colorAttribute.count=0,this.m_uvAttribute.count=0,this.m_indexAttribute.count=0,this.m_pickInfos.length=0)}canAddElements(e=1){const t=this.m_indexAttribute;if(t.count+6*e>=t.array.length){if(t.array.length>=6*this.m_maxElementCount)return!1;const e=Math.min(this.m_maxElementCount,0===this.size?256:2*this.size);this.resize(e)}return!0}saveState(){return{positionAttributeCount:this.m_positionAttribute.count,colorAttributeCount:this.m_colorAttribute.count,uvAttributeCount:this.m_uvAttribute.count,indexAttributeCount:this.m_indexAttribute.count,pickInfoCount:this.m_pickInfos.length}}restoreState(e){this.m_positionAttribute.count=e.positionAttributeCount,this.m_colorAttribute.count=e.colorAttributeCount,this.m_uvAttribute.count=e.uvAttributeCount,this.m_indexAttribute.count=e.indexAttributeCount,this.m_pickInfos.length=e.pickInfoCount}addBox(e,t,i,n,r,s){if(!this.canAddElements())return!1;const{s0:o,t0:a,s1:l,t1:c}=t,{x:h,y:u,w:d,h:m}=e,p=Math.round(i.r*n*255),f=Math.round(i.g*n*255),g=Math.round(i.b*n*255),v=Math.round(255*n),y=this.m_positionAttribute,_=this.m_colorAttribute,x=this.m_uvAttribute,w=this.m_indexAttribute,b=y.count,T=w.count;return y.setXYZ(b,h,u,r),y.setXYZ(b+1,h+d,u,r),y.setXYZ(b+2,h,u+m,r),y.setXYZ(b+3,h+d,u+m,r),_.setXYZW(b,p,f,g,v),_.setXYZW(b+1,p,f,g,v),_.setXYZW(b+2,p,f,g,v),_.setXYZW(b+3,p,f,g,v),x.setXY(b,o,a),x.setXY(b+1,l,a),x.setXY(b+2,o,c),x.setXY(b+3,l,c),w.setX(T,b),w.setX(T+1,b+1),w.setX(T+2,b+2),w.setX(T+3,b+2),w.setX(T+4,b+1),w.setX(T+5,b+3),y.count+=4,_.count+=4,x.count+=4,w.count+=6,this.m_pickInfos.push(s),!0}updateBufferGeometry(){const e=this.m_positionAttribute,t=this.m_colorAttribute,i=this.m_uvAttribute,n=this.m_indexAttribute;e.count>0&&(e.needsUpdate=!0,e.updateRange.offset=0,e.updateRange.count=4*e.count),t.count>0&&(t.needsUpdate=!0,t.updateRange.offset=0,t.updateRange.count=4*t.count),i.count>0&&(i.needsUpdate=!0,i.updateRange.offset=0,i.updateRange.count=4*i.count),n.count>0&&(n.needsUpdate=!0,n.updateRange.offset=0,n.updateRange.count=n.count),void 0!==this.m_geometry&&(this.m_geometry.clearGroups(),this.m_geometry.addGroup(0,this.m_indexAttribute.count))}cleanUp(){0===this.m_indexAttribute.count&&this.size>0&&this.clearAttributes()}get isEmpty(){return this.m_mesh.isEmpty}get mesh(){return void 0===this.m_mesh&&this.resize(),this.m_mesh}pickBoxes(e,t,i){var n;const s=this.m_pickInfos.length,o=this.m_pickInfos,a=this.m_positionAttribute,l=e.x,c=e.y;for(let e=0;e<s;e++){const s=4*e,h=a.getX(s);if(l<h)continue;const u=a.getX(s+1);if(l>u)continue;const d=a.getY(s);if(c<d)continue;const m=a.getY(s+2);if(c>m)continue;const p=new r.Math2D.Box(h,d,u-h,m-d),f=o[e];if(void 0!==i&&void 0!==f&&void 0!==f.uvBoxForPicking&&this.isPixelTransparent(i,l,c,p,f.uvBoxForPicking))continue;const g=null===(n=o[e])||void 0===n?void 0:n.iconText;g&&t(g)}}resize(e,t){return void 0!==this.m_geometry&&this.m_geometry.dispose(),this.m_geometry=new n.BufferGeometry,void 0!==e&&(!0===t||e>this.size)&&this.resizeBuffer(e),this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setIndex(this.m_indexAttribute),this.m_geometry.addGroup(0,this.m_indexAttribute.count),void 0===this.m_mesh?(this.m_mesh=new o(this.m_geometry,this.m_material),this.m_mesh.renderOrder=this.m_renderOrder):this.m_mesh.geometry=this.m_geometry,this.m_mesh}updateMemoryUsage(e){const t=3*this.m_positionAttribute.count*4+4*this.m_colorAttribute.count+4*this.m_uvAttribute.count*4+4*this.m_indexAttribute.count;e.heapSize+=t,e.gpuSize+=t}isPixelTransparent(e,t,i,n,r){const{u:o,v:a}=(0,s.screenToUvCoordinates)(t,i,n,r),{width:l,height:c}=e instanceof SVGImageElement?e.getBBox():e,h=l*o,u=c*a,d=(0,s.getPixelFromImage)(h,u,e);return void 0!==d&&0===d[3]}clearAttributes(){this.m_positionAttribute=void 0,this.m_colorAttribute=void 0,this.m_uvAttribute=void 0,this.m_indexAttribute=void 0,this.resize(0,!0)}resizeBuffer(e){const t=new Float32Array(4*e*3);if(void 0!==this.m_positionAttribute&&this.m_positionAttribute.array.length>0){const e=this.m_positionAttribute.count;t.set(this.m_positionAttribute.array),this.m_positionAttribute.array=t,this.m_positionAttribute.count=e}else this.m_positionAttribute=new n.BufferAttribute(t,3),this.m_positionAttribute.count=0,this.m_positionAttribute.setUsage(n.DynamicDrawUsage);const i=new Uint8Array(4*e*4);if(void 0!==this.m_colorAttribute){const e=this.m_colorAttribute.count;i.set(this.m_colorAttribute.array),this.m_colorAttribute.array=i,this.m_colorAttribute.count=e}else this.m_colorAttribute=new n.BufferAttribute(i,4,!0),this.m_colorAttribute.count=0,this.m_colorAttribute.setUsage(n.DynamicDrawUsage);const r=new Float32Array(4*e*4);if(void 0!==this.m_uvAttribute){const e=this.m_uvAttribute.count;r.set(this.m_uvAttribute.array),this.m_uvAttribute.array=r,this.m_uvAttribute.count=e}else this.m_uvAttribute=new n.BufferAttribute(r,4),this.m_uvAttribute.count=0,this.m_uvAttribute.setUsage(n.DynamicDrawUsage);const s=6*e*1,o=s>65535?new Uint32Array(s):new Uint16Array(s);if(void 0!==this.m_indexAttribute){const e=this.m_indexAttribute.count;o.set(this.m_indexAttribute.array),this.m_indexAttribute.array=o,this.m_indexAttribute.count=e}else this.m_indexAttribute=new n.BufferAttribute(o,1),this.m_indexAttribute.count=0,this.m_indexAttribute.setUsage(n.DynamicDrawUsage);this.m_size=e}}t.BoxBuffer=a},3174:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconInfoBuilder=void 0;const n=i(8152),r=i(4342),s=i(207);t.IconInfoBuilder=class{constructor(e){this.m_env=e}withTechnique(e){return this.m_imageTextureName=void 0!==e.imageTexture?(0,n.getPropertyValue)(e.imageTexture,this.m_env):void 0,this.m_technique=e,this}withIcon(e){return void 0!==e&&(this.m_imageTextureName=e),this}build(e){var t,i,o;(0,r.assert)(void 0!==this.m_technique);const a=this.m_technique,l=this.m_env,c=null===(t=this.m_imageTextureName)||void 0===t?void 0:t.split(",");if(void 0===c)return;const h=null!==(i=a.iconMayOverlap)&&void 0!==i?i:a.textMayOverlap,u=null!==(o=a.iconReserveSpace)&&void 0!==o?o:a.textReserveSpace,d=(0,n.getPropertyValue)(a.iconColor,l),m=null!==d?s.ColorCache.instance.getColor(d):void 0,p=[];for(let t=0;t<c.length;t++){const i={technique:a,imageTextureName:c[t],iconText:e,mayOverlap:h,reserveSpace:u,iconBrightness:a.iconBrightness,iconColor:m};p.push(i)}return p.length>0?p:void 0}}},5154:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.imageIsRenderable=void 0,t.imageIsRenderable=function(e){return void 0!==e.buffer}},5570:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageRenderer=t.Margin=t.ImageBatchRegistry=t.ImageBuffer=void 0;const n=i(82),r=i(8152),s=i(4250),o=i(4342),a=i(7063),l=i(6802),c=i(4298),h=o.LoggerManager.instance.create("IconRenderer"),u=new n.Color(1,1,1),d=new n.Color;class m{constructor(e,t,i){this.buffer=e,this.layer=t,this.m_onDispose=i,this.m_refCount=0}increaseRefCount(){return++this.m_refCount,this}decreaseRefCount(){return(0,o.assert)(this.m_refCount>0),0==--this.m_refCount&&this.dispose(),this}dispose(){this.layer.scene.remove(this.buffer.mesh),this.buffer.dispose(),this.m_onDispose()}}t.ImageBuffer=m;class p{constructor(e,t,i,n){this.m_rendererCapabilities=e,this.imageItem=t,this.m_onDispose=i,(0,o.assert)(void 0!==this.imageItem.image);const r=(0,a.loadTexture)(this.imageItem.image,n,{magFilter:"linear",minFilter:p.trilinear?"linearMipMapLinear":"linear"});(0,o.assert)(void 0!==r),p.trilinear&&this.imageItem.mipMaps&&(r.mipmaps=this.imageItem.mipMaps,r.image=r.mipmaps[0]),r.flipY=!1,r.premultiplyAlpha=!0,this.m_material=new s.IconMaterial({rendererCapabilities:this.m_rendererCapabilities,map:r}),this.m_imageBuffers=new Map}getBuffer(e){let t=this.m_imageBuffers.get(e.id);if(t)return t.increaseRefCount();const i=new c.BoxBuffer(this.m_material,e.id),n=i.mesh;return n.frustumCulled=!1,e.scene.add(n),t=new m(i,e,(()=>{this.disposeBuffer(e.id)})),this.m_imageBuffers.set(e.id,t),t.increaseRefCount()}reset(){for(const e of this.m_imageBuffers.values())e.buffer.reset()}update(){for(const e of this.m_imageBuffers.values())e.buffer.updateBufferGeometry()}pickBoxes(e,t,i){for(const n of this.m_imageBuffers.values())n.buffer.pickBoxes(e,t,i)}updateMemoryUsage(e){if(void 0!==this.imageItem.image){const t=this.imageItem.image.width*this.imageItem.image.height*4;e.heapSize+=t,e.gpuSize+=t}for(const t of this.m_imageBuffers.values())t.buffer.updateMemoryUsage(e)}dispose(){this.m_imageBuffers.clear(),this.m_material.map.dispose(),this.m_material.dispose(),this.m_onDispose()}disposeBuffer(e){(0,o.assert)(this.m_imageBuffers.size>0),this.m_imageBuffers.delete(e),0===this.m_imageBuffers.size&&this.dispose()}}p.trilinear=!0;class f{constructor(e,t){this.m_rendererCapabilities=e,this.m_textureCache=t,this.m_batchMap=new Map}registerImage(e,t){var i;const{imageItem:n,imageTexture:r}=e;if(!n)return;(0,o.assert)(void 0!==e.imageTextureName);const s=null!==(i=null==r?void 0:r.image)&&void 0!==i?i:e.imageTextureName;let a=this.m_batchMap.get(s);return void 0===a&&(a=new p(this.m_rendererCapabilities,n,(()=>{this.deleteBatch(s)}),this.m_textureCache),this.m_batchMap.set(s,a)),a.getBuffer(t)}addIcon(e,t,i,n){if(!1===e.isValid||!e.buffer)return void h.warn("IconBatchRegistry: trying to add iconInfo without buffer prepared: ",e.imageTextureName);let r;(0,o.assert)(void 0!==e.uvBox),void 0!==e.iconBrightness?(r=d.setScalar(e.iconBrightness),void 0!==e.iconColor&&(r=d.multiply(e.iconColor))):r=void 0!==e.iconColor?e.iconColor:u,e.buffer.buffer.addBox(t,e.uvBox,r,n,i,e)}addTextBackground(e,t,i){if(!1===e.isValid||!e.buffer)return void h.warn("IconBatchRegistry: trying to add background image without buffer prepared: ",e.imageTextureName);(0,o.assert)(void 0!==e.uvBox);const n=u;e.buffer.buffer.addBox(t,e.uvBox,n,1,i,e)}reset(){for(const e of this.m_batchMap.values())e.reset()}update(){for(const e of this.m_batchMap.values())e.update()}pickImageTexts(e,t){for(const i of this.m_batchMap.values())i.pickBoxes(e,t,i.imageItem.image)}updateMemoryUsage(e){for(const t of this.m_batchMap.values())t.updateMemoryUsage(e)}deleteBatch(e){this.m_batchMap.delete(e)}}var g;t.ImageBatchRegistry=f,function(e){e[e.ALLOCATE=0]="ALLOCATE",e[e.CHECK=1]="CHECK",e[e.NONE=2]="NONE"}(g=t.Margin||(t.Margin={}));class v{static computeIconScreenBox(e,t,i,n,s=new o.Math2D.Box,a=g.NONE){var l,c,h;(0,o.assert)(void 0!==e.buffer);const u=e.technique;let d=0;a===g.CHECK?d=null!==(c=null!==(l=(0,r.getPropertyValue)(u["check-margin"],n))&&void 0!==l?l:(0,r.getPropertyValue)(u.margin,n))&&void 0!==c?c:0:a===g.ALLOCATE&&(d=null!==(h=(0,r.getPropertyValue)(u.margin,n))&&void 0!==h?h:0);const m=e.computedWidth*i+2*d,p=e.computedHeight*i+2*d,f=(0,r.getPropertyValue)(u.iconXOffset,n),v=(0,r.getPropertyValue)(u.iconYOffset,n),y=t.x+("number"==typeof f?f:0)*i,_=t.y+("number"==typeof v?v:0)*i;return s.x=y-m/2,s.y=_-p/2,s.w=m,s.h=p,s}constructor(e,t,i){this.m_renderer=e,this.m_imageRepo=t,this.m_textureCache=i,this.m_tempScreenBox=new o.Math2D.Box,this.m_layers=[],this.m_imageBatchRegistry=new f(this.renderer.capabilities,this.m_textureCache)}get renderer(){return this.m_renderer}prepareIcon(e,t){if(void 0!==e.buffer)return!0;const i=e.imageTextureName;if(void 0===i)return e.isValid=!1,!1;const n=this.m_imageRepo.findImage(i);if(n){const{imageItem:i,imageTexture:r}=n;if(i.loaded)return this.setupIconInfo(e,i,t,r),!0}return this.m_imageRepo.loadImage(i).then((t=>{e.isValid=!0})).catch((t=>{e.imageItem=null,e.isValid=!1})),!1}prepareIcons(e,t){let i=!1;const n=e.iconInfoList;return n&&e.visible&&(i=!0,n.forEach((e=>{i=this.prepareIcon(e,t)&&i}))),i}prepareTextBackground(e){var t;const i=e.textBackgroundInfo;if(!1===e.visible)return!1;if(void 0===(null==i?void 0:i.imageTextureName))return!0;if(void 0!==(null===(t=e.textBackgroundInfo)||void 0===t?void 0:t.buffer))return!0;if(e.textBounds){const t=null==i?void 0:i.imageTextureName,r=new n.Vector2;e.textBounds.getSize(r);const s=l.MipMapGenerator.getPaddedSize(r.x,r.y),o=this.m_imageRepo.findImage(t,s);if(o){const{imageItem:e,imageTexture:t}=o;if(e.loaded)return this.setupTextBackgroundInfo(i,e,r,s,t),!0}this.m_imageRepo.loadImage(t,s).then((e=>{i.isValid=!0})).catch((e=>{h.error(e),i.imageItem=null,i.isValid=!1}))}return!1}reset(){this.m_imageBatchRegistry.reset()}addIcon(e,t,i,n,r,s,a,l){(0,o.assert)(void 0!==e.buffer),s&&(v.computeIconScreenBox(e,t,r,l,this.m_tempScreenBox,g.ALLOCATE),i.allocate(this.m_tempScreenBox)),a>0&&(v.computeIconScreenBox(e,t,r,l,this.m_tempScreenBox,g.NONE),this.m_imageBatchRegistry.addIcon(e,this.m_tempScreenBox,n,a))}addTextBackground(e,t,i,n,r){(0,o.assert)(void 0!==e.buffer),(i=i.clone()).min.x*=r,i.min.y*=r,i.max.x*=r,i.max.y*=r,i.translate(t);const s=new o.Math2D.Box(i.min.x,i.min.y,i.max.x-i.min.x,i.max.y-i.min.y);this.m_imageBatchRegistry.addTextBackground(e,s,n)}update(){this.m_imageBatchRegistry.update()}get layers(){return this.m_layers}render(e,t){this.m_renderer.render(t.scene,e)}pickIconTexts(e,t){this.m_imageBatchRegistry.pickImageTexts(e,t)}getMemoryUsage(e){this.m_imageBatchRegistry.updateMemoryUsage(e)}addLayer(e){let t=this.m_layers.find((t=>t.id===e));return void 0===t&&(t={id:e,scene:new n.Scene},this.m_layers.push(t),this.m_layers.sort(((e,t)=>e.id-t.id))),t}setupTextBackgroundInfo(e,t,i,n,r){var s,a;if((0,o.assert)(void 0===e.uvBox),!t.image)return h.error("setupTextBackgroundInfo: No imageItem/imageData found"),void(e.isValid=!1);const l=t.image.width,c=t.image.height,u=p.trilinear&&t.mipMaps,d=l/(u?n.width:l),m=c/(u?n.height:c);e.computedWidth=null!==(s=null==i?void 0:i.x)&&void 0!==s?s:l,e.computedHeight=null!==(a=null==i?void 0:i.y)&&void 0!==a?a:c,e.uvBox={s0:0,t0:m,s1:d,t1:0},e.imageItem=t,e.imageTexture=r,e.buffer=this.m_imageBatchRegistry.registerImage(e,this.addLayer(e.renderOrder)),e.isValid=!0}setupIconInfo(e,t,i,n){if((0,o.assert)(void 0===e.uvBox),!t.image)return h.error("setupImageInfo: No imageItem/imageData found"),void(e.isValid=!1);const s=e.technique,a=t.image.width,c=t.image.height,u=l.MipMapGenerator.getPaddedSize(a,c),d=p.trilinear&&t.mipMaps,m=d?u.width:a,f=d?u.height:c,g=void 0!==(null==n?void 0:n.width)?n.width:a,v=void 0!==(null==n?void 0:n.height)?n.height:c,y=void 0!==(null==n?void 0:n.width)?n.width:a,_=void 0!==(null==n?void 0:n.height)?n.height:c,x=void 0!==(null==n?void 0:n.xOffset)?n.xOffset:0,w=void 0!==(null==n?void 0:n.yOffset)?n.yOffset:0,b=x/m,T=(x+y)/m,M=w/f,S=(w+_)/f;let E=void 0!==s.iconScale?s.iconScale:1,A=void 0!==s.iconScale?s.iconScale:1;const C=(0,r.getPropertyValue)(s.screenWidth,i);null!=C&&(A=E=C/g);const P=(0,r.getPropertyValue)(s.screenHeight,i);null!=P&&(A=P/v,void 0!==C&&(E=A)),e.computedWidth=g*E,e.computedHeight=v*A,e.uvBox={s0:b,t0:S,s1:T,t1:M},e.uvBoxForPicking={s0:x/a,t0:(w+_)/c,s1:(x+y)/a,t1:w/c},e.imageItem=t,e.imageTexture=n,e.buffer=this.m_imageBatchRegistry.registerImage(e,this.addLayer(e.renderOrder)),e.isValid=!0}}t.ImageRenderer=v},161:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.screenToUvCoordinates=t.getPixelFromImage=void 0;const n=i(4342);let r,s;t.getPixelFromImage=function(e,t,i){return i instanceof ImageData?function(e,t,i){const{width:r,height:s,data:o}=e,a=o.length/(s*r);if(!n.MathUtils.isWithinBounds(t,0,r)||!n.MathUtils.isWithinBounds(i,0,s))return;const l=(i*r+t)*a;return o.slice(l,l+a)}(i,e,t):function(e,t,i){const{width:o,height:a}=e instanceof SVGImageElement?e.getBBox():e;if(n.MathUtils.isWithinBounds(t,0,o)&&n.MathUtils.isWithinBounds(i,0,a)&&(r||(r=document.createElement("canvas"),s=r.getContext("2d",{willReadFrequently:!0})),s))return r.width=o,r.height=a,s.drawImage(e,0,0),s.getImageData(t,i,1,1).data}(i,e,t)},t.screenToUvCoordinates=function(e,t,i,r){const s=i.x,o=i.x+i.w,a=i.y,l=i.y+i.h;return{u:n.MathUtils.map(e,s,o,r.s0,r.s1),v:n.MathUtils.map(t,a,l,r.t0,r.t1)}}},6445:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutState=void 0;const n=i(5823);t.LayoutState=class{constructor(e){this.m_hAlign=n.DefaultTextStyle.DEFAULT_HORIZONTAL_ALIGNMENT,this.m_vAlign=n.DefaultTextStyle.DEFAULT_VERTICAL_ALIGNMENT,this.textPlacement=e}set textPlacement(e){this.m_hAlign=(0,n.hAlignFromPlacement)(e.h),this.m_vAlign=(0,n.vAlignFromPlacement)(e.v)}get textPlacement(){return{h:(0,n.hPlacementFromAlignment)(this.m_hAlign),v:(0,n.vPlacementFromAlignment)(this.m_vAlign)}}reset(e){this.m_hAlign=e.horizontalAlignment,this.m_vAlign=e.verticalAlignment}get horizontalAlignment(){return this.m_hAlign}get verticalAlignment(){return this.m_vAlign}}},4957:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimplePath=t.PathParam=t.SimpleLineCurve=void 0;const n=i(82);class r extends n.LineCurve{constructor(e,t){super(e,t)}getLengths(){return void 0===this.m_lengths&&(this.m_lengths=[0,this.v2.distanceTo(this.v1)]),this.m_lengths}}t.SimpleLineCurve=r;class s{constructor(e,t,i){this.path=e,this.index=t,this.t=i}get curve(){return this.path.curves[this.index]}get point(){return void 0===this.m_point&&(this.m_point=this.curve.getPoint(this.t)),this.m_point}}t.PathParam=s;class o extends n.Path{constructor(){super()}getLengths(){if(this.m_cache)return this.m_cache;let e=0;const t=new Array;return t.push(0),this.curves.forEach((i=>{const n=i;e+=n.v1.distanceTo(n.v2),t.push(e)})),this.m_cache=t,t}getParamAt(e){const t=e*this.getLength(),i=this.getCurveLengths();for(let e=0;e<i.length;++e){if(i[e]<t)continue;const n=i[e]-t,r=this.curves[e].getLength();return new s(this,e,0===r?0:1-n/r)}return null}}t.SimplePath=o},9463:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextCanvasFactory=void 0;const n=i(5823),r=i(4342);t.TextCanvasFactory=class{constructor(e){this.m_renderer=e,this.m_minGlyphCount=0,this.m_maxGlyphCount=0}setGlyphCountLimits(e,t){this.m_minGlyphCount=e,this.m_maxGlyphCount=t}createTextCanvas(e,t){return(0,r.assert)(this.m_maxGlyphCount>0),new n.TextCanvas({renderer:this.m_renderer,fontCatalog:e,minGlyphCount:this.m_minGlyphCount,maxGlyphCount:this.m_maxGlyphCount,name:t})}}},3800:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextStyleCache=void 0;const n=i(8152),r=i(5823),s=i(1984),o=i(1667),a=i(4342),l=i(207),c=i(8427),h=i(304),u=a.LoggerManager.instance.create("TextStyleCache"),d=new r.TextRenderStyle({fontSize:{unit:r.FontUnit.Pixel,size:32,backgroundSize:8},color:l.ColorCache.instance.getColor("#6d7477"),opacity:1,backgroundColor:l.ColorCache.instance.getColor("#f7fbfd"),backgroundOpacity:.5}),m=new r.TextLayoutStyle({verticalAlignment:r.VerticalAlignment.Center,horizontalAlignment:r.HorizontalAlignment.Center,placements:[]}),p="default";function f(e,t,i){const n=i?function(e){const t=[];return(e?e.toUpperCase().replace(" ","").split(","):[]).forEach((e=>{const i=function(e){if(e.length<1||e.length>2)return;const t={h:r.HorizontalPlacement.Center,v:r.VerticalPlacement.Center};let i=e.charAt(0),n=!0;switch(i){case s.PlacementToken.Top:case s.PlacementToken.North:t.v=r.VerticalPlacement.Top;break;case s.PlacementToken.Bottom:case s.PlacementToken.South:t.v=r.VerticalPlacement.Bottom;break;default:if(n=!1,2===e.length)return}if(n&&1===e.length)return t;switch(i=1===e.length?e.charAt(0):e.charAt(1),i){case s.PlacementToken.Right:case s.PlacementToken.East:t.h=r.HorizontalPlacement.Right;break;case s.PlacementToken.Left:case s.PlacementToken.West:t.h=r.HorizontalPlacement.Left;break;default:return}return t}(e);void 0!==i&&t.push(i)})),t}(i):void 0;return(0,r.resolvePlacementAndAlignment)(function(e){return"Left"===e||"Center"===e||"Right"===e?r.HorizontalAlignment[e]:m.horizontalAlignment}(e),function(e){return"Above"===e||"Center"===e||"Below"===e?r.VerticalAlignment[e]:m.verticalAlignment}(t),n)}t.TextStyleCache=class{constructor(){this.m_textStyles=new Map,this.m_defaultStyle={name:p,fontCatalog:void 0,renderParams:d.params,layoutParams:m.params},this.updateDefaultTextStyle()}updateTextStyles(e,t){this.m_textStyles.clear(),null==e||e.forEach((e=>{this.m_textStyles.set(e.name,this.createTextStyle(e,e.name))})),this.updateDefaultTextStyle(t,e)}updateTextCanvases(e){this.initializeTextCanvas(this.m_defaultStyle,e);for(const[,t]of this.m_textStyles)this.initializeTextCanvas(t,e)}getTextStyle(e){let t;return void 0===e?t=this.m_defaultStyle:(t=this.m_textStyles.get(e),void 0===t&&(t=this.m_defaultStyle)),t}createRenderStyle(e,t){const i=e.mapView,h=i.zoomLevel,u=Math.floor(h),d=new s.MapEnv({$zoom:u},i.env),m=this.m_defaultStyle.renderParams,p=(0,a.getOptionValue)(m.opacity,1);let f,g=(0,n.getPropertyValue)((0,a.getOptionValue)(t.opacity,p),d);if(void 0!==t.color){let e=(0,c.evaluateColorProperty)(t.color,d);void 0!==e&&(o.ColorUtils.hasAlphaInHex(e)&&(g*=o.ColorUtils.getAlphaFromHex(e),e=o.ColorUtils.removeAlphaFromHex(e)),f=l.ColorCache.instance.getColor(e))}const v=(0,a.getOptionValue)(m.fontSize.backgroundSize,0),y=(0,n.getPropertyValue)((0,a.getOptionValue)(t.backgroundSize,v),d),_=void 0!==t.backgroundColor&&void 0!==t.backgroundSize&&y>0,x=(0,a.getOptionValue)(m.backgroundOpacity,0);let w,b=(0,n.getPropertyValue)((0,a.getOptionValue)(t.backgroundOpacity,_?1:x),d);if(void 0!==t.backgroundColor){let e=(0,c.evaluateColorProperty)(t.backgroundColor,d);void 0!==e&&(o.ColorUtils.hasAlphaInHex(e)&&(b*=o.ColorUtils.getAlphaFromHex(e),e=o.ColorUtils.removeAlphaFromHex(e)),w=l.ColorCache.instance.getColor(e))}const T={fontName:(0,a.getOptionValue)(t.fontName,m.fontName),fontSize:{unit:r.FontUnit.Pixel,size:(0,n.getPropertyValue)((0,a.getOptionValue)(t.size,m.fontSize.size),d),backgroundSize:y},fontStyle:"Regular"===t.fontStyle||"Bold"===t.fontStyle||"Italic"===t.fontStyle||"BoldItalic"===t.fontStyle?r.FontStyle[t.fontStyle]:m.fontStyle,fontVariant:"Regular"===t.fontVariant||"AllCaps"===t.fontVariant||"SmallCaps"===t.fontVariant?r.FontVariant[t.fontVariant]:m.fontVariant,rotation:(0,a.getOptionValue)(t.rotation,m.rotation),color:(0,a.getOptionValue)(f,(0,a.getOptionValue)(m.color,r.DefaultTextStyle.DEFAULT_COLOR)),backgroundColor:(0,a.getOptionValue)(w,(0,a.getOptionValue)(m.backgroundColor,r.DefaultTextStyle.DEFAULT_BACKGROUND_COLOR)),opacity:g,backgroundOpacity:b},M=this.getTextStyle(t.style).renderParams;return new r.TextRenderStyle(Object.assign(Object.assign({},M),T))}createLayoutStyle(e,t){var i,o,a,l,c,h;const u=e.mapView,d=Math.floor(e.mapView.zoomLevel),m=new s.MapEnv({$zoom:d},u.env),p=this.m_defaultStyle.layoutParams,g=(0,n.getPropertyValue)(t.hAlignment,m),v=(0,n.getPropertyValue)(t.vAlignment,m),y=(0,s.isIconTextTechnique)(t)?(0,n.getPropertyValue)(t.placements,m):null,{horizontalAlignment:_,verticalAlignment:x,placements:w}=f(g,v,y),b=(0,n.getPropertyValue)(t.wrappingMode,m),T="None"===b||"Character"===b||"Word"===b?r.WrappingMode[b]:p.wrappingMode,M={tracking:null!==(i=(0,n.getPropertyValue)(t.tracking,m))&&void 0!==i?i:p.tracking,leading:null!==(o=(0,n.getPropertyValue)(t.leading,m))&&void 0!==o?o:p.leading,maxLines:null!==(a=(0,n.getPropertyValue)(t.maxLines,m))&&void 0!==a?a:p.maxLines,lineWidth:null!==(l=(0,n.getPropertyValue)(t.lineWidth,m))&&void 0!==l?l:p.lineWidth,canvasRotation:null!==(c=(0,n.getPropertyValue)(t.canvasRotation,m))&&void 0!==c?c:p.canvasRotation,lineRotation:null!==(h=(0,n.getPropertyValue)(t.lineRotation,m))&&void 0!==h?h:p.lineRotation,wrappingMode:T,horizontalAlignment:_,verticalAlignment:x,placements:w},S=this.getTextStyle(t.style);return new r.TextLayoutStyle(Object.assign(Object.assign({},S),M))}updateDefaultTextStyle(e,t){var i,n;this.m_defaultStyle.fontCatalog=void 0;const r=null!==(n=null!==(i=null==t?void 0:t.find((e=>e.name===p)))&&void 0!==i?i:e)&&void 0!==n?n:null==t?void 0:t[0];r&&(this.m_defaultStyle=this.createTextStyle(r,p)),this.m_defaultStyle.textCanvas=void 0}initializeTextCanvas(e,t){var i,n,r;e.textCanvas||(e.textCanvas=null!==(i=e.fontCatalog&&t.has(e.fontCatalog)?t.get(e.fontCatalog):t.get(h.DEFAULT_FONT_CATALOG_NAME))&&void 0!==i?i:t.values().next().value,void 0!==e.fontCatalog&&e.fontCatalog!==(null===(n=e.textCanvas)||void 0===n?void 0:n.name)&&u.warn(`Font catalog '${e.fontCatalog}' set in text style '${e.name}' not found.`+(e.textCanvas?` Using default font catalog ${null===(r=e.textCanvas)||void 0===r?void 0:r.name}`:"")))}createTextStyle(e,t){var i;const{horizontalAlignment:n,verticalAlignment:s,placements:o}=f(e.hAlignment,e.vAlignment,e.placements);return{name:t,fontCatalog:(0,a.getOptionValue)(e.fontCatalogName,this.m_defaultStyle.fontCatalog),renderParams:{fontName:e.fontName,fontSize:{unit:r.FontUnit.Pixel,size:32,backgroundSize:null!==(i=e.backgroundSize)&&void 0!==i?i:8},fontStyle:"Regular"===e.fontStyle||"Bold"===e.fontStyle||"Italic"===e.fontStyle||"BoldItalic"===e.fontStyle?r.FontStyle[e.fontStyle]:void 0,fontVariant:"Regular"===e.fontVariant||"AllCaps"===e.fontVariant||"SmallCaps"===e.fontVariant?r.FontVariant[e.fontVariant]:void 0,rotation:e.rotation,color:void 0!==e.color?l.ColorCache.instance.getColor(e.color):void 0,backgroundColor:void 0!==e.backgroundColor?l.ColorCache.instance.getColor(e.backgroundColor):void 0,opacity:e.opacity,backgroundOpacity:e.backgroundOpacity},layoutParams:{tracking:e.tracking,leading:e.leading,maxLines:e.maxLines,lineWidth:e.lineWidth,canvasRotation:e.canvasRotation,lineRotation:e.lineRotation,wrappingMode:"None"===e.wrappingMode||"Character"===e.wrappingMode||"Word"===e.wrappingMode?r.WrappingMode[e.wrappingMode]:r.WrappingMode.Word,verticalAlignment:s,horizontalAlignment:n,placements:o}}}}},3922:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileTextStyleCache=void 0,t.TileTextStyleCache=class{constructor(e){this.textRenderStyles=[],this.textLayoutStyles=[],this.tile=e}clear(){this.textRenderStyles.length=0,this.textLayoutStyles.length=0}getRenderStyle(e){let t=this.textRenderStyles[e._index];return void 0===t&&(t=this.textRenderStyles[e._index]=this.tile.mapView.iconTextRenderer.styleCache.createRenderStyle(this.tile,e)),t}getLayoutStyle(e){let t=this.textLayoutStyles[e._index];return void 0===t&&(t=this.textLayoutStyles[e._index]=this.tile.mapView.iconTextRenderer.styleCache.createLayoutStyle(this.tile,e)),t}}},5159:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageCache=void 0;const n=i(9237),r=i(9360);class s{constructor(){this.m_images=new Map}static get instance(){return void 0===s.m_instance&&(s.m_instance=new s),s.m_instance}static dispose(){s.m_instance=void 0}registerImage(e,t){let i=this.findImageCacheItem(t.url);return i?(void 0===e||i.owners.includes(e)||i.owners.push(e),i.imageLikeItem):(i={imageLikeItem:t,owners:[e]},this.m_images.set(t.url,i),i.imageLikeItem)}registerImageByUrl(e,t,i,s=!1){const o=s?new r.SVGMarkupItem(t):new n.ImageItem(t,i);return this.registerImage(e,o)}removeImage(e,t){const i=this.m_images.get(t);return void 0!==i&&(this.unlinkCacheItem(i,e),!0)}findImage(e){const t=this.m_images.get(e);if(void 0!==t)return t.imageLikeItem}clear(e){this.m_images.forEach((t=>{this.unlinkCacheItem(t,e)}))}get size(){return this.m_images.size}findImageCacheItem(e){return this.m_images.get(e)}cancelLoading(e){e.loading&&(e.cancelled=!0)}unlinkCacheItem(e,t){const i=e.owners.indexOf(t);i>=0&&e.owners.splice(i,1),0===e.owners.length&&(this.m_images.delete(e.imageLikeItem.url),this.cancelLoading(e.imageLikeItem))}}t.ImageCache=s},9237:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageItem=void 0;const n=i(82),r=i(4342),s=i(6802),o=r.LoggerManager.instance.create("loadImage"),a=new s.MipMapGenerator;t.ImageItem=class{constructor(e,t){this.url=e,this.image=t}get loaded(){return void 0!==this.image&&void 0!==this.mipMaps}get loading(){return void 0!==this.loadingPromise}loadImage(){if(this.loaded)return Promise.resolve(this);if(this.loading)return this.loadingPromise;if(this.image){const e=this.image;return e instanceof HTMLImageElement&&!e.complete?(this.loadingPromise=new Promise(((t,i)=>{e.addEventListener("load",this.finalizeImage.bind(this,e,t)),e.addEventListener("error",i)})),this.loadingPromise):(this.finalizeImage(this.image),Promise.resolve(this))}return this.loadingPromise=new Promise(((e,t)=>{o.debug(`Loading image: ${this.url}`),!0===this.cancelled?(o.debug(`Cancelled loading image: ${this.url}`),e(this)):(new n.ImageLoader).load(this.url,(t=>{if(!0===this.cancelled)return o.debug(`Cancelled loading image: ${this.url}`),void e(this);this.finalizeImage(t,e)}),void 0,(e=>{o.error(`... loading image failed: ${this.url} : ${e}`),this.loadingPromise=void 0,t(`... loading image failed: ${this.url} : ${e}`)}))})),this.loadingPromise}finalizeImage(e,t){this.image=e,this.mipMaps=a.generateTextureAtlasMipMap(this),this.loadingPromise=void 0,t&&t(this)}}},9297:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageRepo=void 0;const n=i(5738),r=i(5159),s=i(9237),o=i(9360);t.ImageRepo=class{constructor(){this.m_iconTextManager=new n.IconTextManager}get iconTextManager(){return this.m_iconTextManager}get imageCache(){return r.ImageCache.instance}findImage(e,t){const i=this.m_iconTextManager.getImageTexture(e),n=i?i.image:e;let r;return t&&(r=this.imageCache.findImage(o.SVGMarkupItem.getImageItemUrl(n,t))),r||(r=this.imageCache.findImage(n)),r instanceof s.ImageItem?{imageItem:r,imageTexture:i}:void 0}async loadImage(e,t){const i=this.m_iconTextManager.getImageTexture(e),n=i?i.image:e;let r;if(t){const e=o.SVGMarkupItem.getImageItemUrl(n,t),i=this.imageCache.findImage(e);if(i)r=i;else{const i=this.imageCache.findImage(n);if(i instanceof s.ImageItem)r=i;else if(i instanceof o.SVGMarkupItem){await i.loadImage();const n=this.imageCache.findImage(e);n?r=n:(r=i.createImageItem(t),r&&this.imageCache.registerImage(this,r))}}}else{const e=this.imageCache.findImage(n);e instanceof s.ImageItem&&(r=e)}if(r)return await r.loadImage(),{imageItem:r,imageTexture:i};throw new Error(`${e} image not found`)}clear(){this.imageCache.clear(this)}}},7063:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadTexture=void 0;const n=i(82),r=i(1984),s=i(4342),o=i(5640),a=i(2119),l=s.LoggerManager.instance.create("LoadTexture");function c(e,t,i,r){const s=new a.TextureHandle;return(new n.ImageLoader).load(e,(e=>{s.image=e,t(s)}),void 0,i),r&&s.addEventListener("dispose",(()=>{URL.revokeObjectURL(e)})),s}function h(e){return"nodeName"in e&&"IMG"===e.nodeName}t.loadTexture=function(e,t,i,s,u,d){const m=t.get(e);if(m)return m.addReference(),null==u||u(m),m;const p=function(e,t,i){if("string"==typeof e)return c(e,t,i,!1);if((0,r.isTextureBuffer)(e))return"image/raw"===e.type?function(e,t,i){const r=e.dataTextureProperties;if(r){const i=r.type?(0,o.toTextureDataType)(r.type):void 0,s=function(e,t){if(void 0===t)return new Uint8Array(e);switch(t){case n.UnsignedByteType:return new Uint8Array(e);case n.ByteType:return new Int8Array(e);case n.ShortType:return new Int16Array(e);case n.UnsignedShortType:return new Uint16Array(e);case n.IntType:return new Int32Array(e);case n.UnsignedIntType:return new Uint32Array(e);case n.FloatType:return new Float32Array(e);case n.HalfFloatType:return new Uint16Array(e)}throw new Error("Unsupported texture data type")}(e.buffer,i),l=r.format?(0,o.toPixelFormat)(r.format):void 0,c=a.TextureHandle.fromBufferSource(s,r.width,r.height,l,i);return t(c),c}i("no data texture properties provided.")}(e,t,i):c(URL.createObjectURL(new Blob([e.buffer],{type:e.type})),t,i,!0);if(h(e)||"nodeName"in(s=e)&&"CANVAS"===s.nodeName){const i=a.TextureHandle.fromHtmlImage(e);if(h(e)&&!e.complete){const n=()=>{t(i),e.removeEventListener("load",n)};e.addEventListener("load",n)}else t(i);return i}if(function(e){return"data"in e&&"width"in e&&"height"in e}(e)){const i=new a.TextureHandle(e);return t(i),i}var s;i("Wrong input type")}(e,(e=>{s?(e.onUpdate=()=>{e.onUpdate=null,null==u||u(e)},s.initTexture(e)):null==u||u(e)}),(e=>{l.error("Failed to load texture: ",e),null==d||d(e)}));return p&&(function(e,t){e.needsUpdate=!0,t&&(void 0!==t.wrapS&&(e.wrapS=(0,o.toWrappingMode)(t.wrapS)),void 0!==t.wrapT&&(e.wrapT=(0,o.toWrappingMode)(t.wrapT)),void 0!==t.magFilter&&(e.magFilter=(0,o.toTextureFilter)(t.magFilter)),void 0!==t.minFilter&&(e.minFilter=(0,o.toTextureFilter)(t.minFilter)),void 0!==t.flipY&&(e.flipY=t.flipY),void 0!==t.repeatU&&(e.repeat.x=t.repeatU),void 0!==t.repeatV&&(e.repeat.y=t.repeatV))}(p,i),t.set(e,p)),p}},6802:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MipMapGenerator=void 0;const n=i(82),r="undefined"==typeof window;function s(){const e=document.createElement("canvas"),t=e.getContext("2d",{willReadFrequently:!0});if(!t)throw new Error("Error getting canvas context.");return[e,t]}class o{static getPaddedSize(e,t){return new n.Vector2(n.MathUtils.ceilPowerOfTwo(e),n.MathUtils.ceilPowerOfTwo(t))}constructor(){r||([this.m_paddingCanvas,this.m_paddingContext]=s(),[this.m_resizeCanvas,this.m_resizeContext]=s())}generateTextureAtlasMipMap(e){if(r)throw new Error("MipMapGenerator only works in browser.");if(void 0===e.image)throw new Error("Can not generate mip maps. Image data not loaded!");const t=e.image,i=[];let{width:n,height:s}=o.getPaddedSize(t.width,t.height);for(this.copyImageWithPadding(t,n,s),i.push(this.m_paddingContext.getImageData(0,0,n,s)),n*=.5,s*=.5;n>=1||s>=1;){const e=i[i.length-1];i.push(this.resizeImage(e,Math.max(n,1),Math.max(s,1))),n*=.5,s*=.5}return i}copyImageWithPadding(e,t,i){return this.m_paddingCanvas.width=t,this.m_paddingCanvas.height=i,this.m_paddingContext.clearRect(0,0,t,i),e instanceof ImageData?this.m_paddingContext.putImageData(e,0,0):this.m_paddingContext.drawImage(e,0,0),e.width!==t&&this.m_paddingContext.drawImage(this.m_paddingCanvas,e.width-1,0,1,e.height,e.width,0,t-e.width,e.height),e.height!==i&&this.m_paddingContext.drawImage(this.m_paddingCanvas,0,e.height-1,t,1,0,e.height,t,i-e.height),this.m_paddingCanvas}resizeImage(e,t,i){const n=this.copyImageWithPadding(e,e.width,e.height);return this.m_resizeCanvas.width=t,this.m_resizeCanvas.height=i,this.m_resizeContext.clearRect(0,0,t,i),this.m_resizeContext.drawImage(n,0,0,t,i),this.m_resizeContext.getImageData(0,0,t,i)}}t.MipMapGenerator=o},9360:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SVGMarkupItem=void 0;const n=i(9237);class r{constructor(e){this.url=e,this.m_parser=new DOMParser,this.loaded=!1}get loading(){return void 0!==this.loadingPromise&&!1===this.loaded}get svg(){return this.m_svg}loadImage(){return this.loadingPromise||(this.loadingPromise=fetch(this.url).then((e=>e.text())).then((e=>(this.m_svg=e,this.loaded=!0,this)))),this.loadingPromise}createImageItem(e){if(void 0===this.svg)return;const t=this.m_parser.parseFromString(this.svg,"image/svg+xml").children[0];t.setAttribute("width",`${e.width}`),t.setAttribute("height",`${e.height}`),t.setAttribute("preserveAspectRatio","none");const i=(new XMLSerializer).serializeToString(t),s=new Image;return s.src="data:image/svg+xml;base64,"+btoa(i),new n.ImageItem(r.getImageItemUrl(this.url,e),s)}static getImageItemUrl(e,t){return`${e}-${t.width}-${t.height}`}}t.SVGMarkupItem=r},5996:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureCache=void 0;const n=i(8263),r=i(7987);class s extends n.LRUCache{constructor(){super(2e6,r.Object3DUtils.getTextureSize),this.canEvict=(e,t)=>t.referenceCount<=1,this.evictionCallback=(e,t)=>{t.removeReference()}}set(e,t){super.set(e,t),t.addReference()}}t.TextureCache=s},2119:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureHandle=void 0;const n=i(82);class r extends n.Texture{static fromBufferSource(e,t,i,s,o){const a=new r(null,void 0,void 0,void 0,n.NearestFilter,n.NearestFilter,s,o);return a.isDataTexture=!0,a.image={data:e,width:t,height:i},a.generateMipmaps=!1,a.flipY=!1,a.unpackAlignment=1,a.needsUpdate=!0,a}static fromHtmlImage(e){const t=new r(e);return t.isCanvasTexture=!0,t}constructor(e,t,i,n,r,s,o,a,l,c){super(e,t,i,n,r,s,o,a,l,c),this.m_refCount=1}addReference(){this.m_refCount++}removeReference(){this.m_refCount>0&&(this.m_refCount--,0===this.m_refCount&&super.dispose())}get referenceCount(){return this.m_refCount}dispose(){this.removeReference()}}t.TextureHandle=r},3638:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isWorkerBootstrapResponse=t.isWorkerBootstrapRequest=void 0,t.isWorkerBootstrapRequest=function(e){return e&&"worker-bootstrap-request"===e.type&&Array.isArray(e.dependencies)},t.isWorkerBootstrapResponse=function(e){return e&&"worker-bootstrap-response"===e.type&&Array.isArray(e.resolvedDependencies)}},1973:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerLoader=void 0;const n=i(4342),r=i(3638),s=n.LoggerManager.instance.create("WorkerLoader");class o{static startWorker(e,t=1e4){return e.startsWith("blob:")?this.startWorkerImmediately(e,t):this.directlyFallbackToBlobBasedLoading?this.startWorkerBlob(e,t):this.startWorkerImmediately(e,t).catch((i=>{if("undefined"!=typeof window){const r=window.location.href,a=new URL(e,r).href;if((0,n.getUrlOrigin)(a)===(0,n.getUrlOrigin)(r))throw i;return s.log("#startWorker: cross-origin worker construction failed, trying load with blob"),this.directlyFallbackToBlobBasedLoading=!0,o.startWorkerBlob(e,t)}throw i}))}static startWorkerImmediately(e,t){try{const i=new Worker(e);return this.waitWorkerInitialized(i,t)}catch(e){return Promise.reject(e)}}static startWorkerBlob(e,t){return this.fetchScriptSourceToBlobUrl(e).then((e=>this.startWorkerImmediately(e,t)))}static fetchScriptSourceToBlobUrl(e){let t=this.sourceLoaderCache.get(e);return void 0!==t||(t=fetch(e).then((e=>e.text())).catch((e=>{throw new Error(`WorkerLoader#fetchScriptSourceToBlob: failed to load worker script: ${e}`)})).then((t=>{this.sourceLoaderCache.delete(e);const i=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(i)})),this.sourceLoaderCache.set(e,t)),t}static waitWorkerInitialized(e,t){return new Promise(((i,n)=>{const s=t=>{const s=t.data;if((0,r.isWorkerBootstrapRequest)(s)){const t=s.dependencies,i=[];for(const e of t){const t=this.dependencyUrlMapping[e];if(!t)return a(),void n(new Error(`#waitWorkerInitialized: Unable to resolve '${e}' as needed by worker script.`));i.push(t)}const r={type:"worker-bootstrap-response",resolvedDependencies:i};e.postMessage(r)}else a(),i(e),setTimeout((()=>{e.dispatchEvent(t)}),0)},o=e=>{a();let t="Error during worker initialization";e.message&&(t+=`: ${e.message}`),"string"==typeof e.filename&&"number"==typeof e.lineno&&(t+=` in ${e.filename}:${e.lineno}`),n(new Error(t))},a=()=>{clearTimeout(l),e.removeEventListener("message",s),e.removeEventListener("error",o)};e.addEventListener("error",o),e.addEventListener("message",s);const l=setTimeout((()=>{a(),n(new Error("Timeout exceeded when waiting for first message from worker."))}),t)}))}}t.WorkerLoader=o,o.directlyFallbackToBlobBasedLoading=!1,o.sourceLoaderCache=new Map,o.dependencyUrlMapping={}},4250:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(8583),t),r(i(8014),t),r(i(8955),t),r(i(8177),t),r(i(8878),t),r(i(5997),t),r(i(674),t),r(i(4744),t),r(i(4258),t),r(i(398),t),r(i(4919),t),r(i(5551),t),r(i(4821),t),r(i(4877),t),r(i(8484),t),r(i(460),t),r(i(4121),t),r(i(1549),t),r(i(2462),t),r(i(182),t),r(i(872),t),r(i(9489),t),r(i(4067),t),r(i(71),t),r(i(3224),t),r(i(2141),t),r(i(3298),t),r(i(9528),t),r(i(8578),t)},460:function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.CirclePointsMaterial=void 0;const r=i(82),s=i(2141),o=i(8578);class a extends s.RawShaderMaterial{constructor(e){const t=new r.Color;let i,s,l,c;if(e){const{size:o,color:h,opacity:u}=e,d=n(e,["size","color","opacity"]);i=o,s=h,l=u,d.name="CirclePointsMaterial",d.vertexShader="\nuniform float size;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nattribute vec3 position;\n\nvoid main() {\n    vec3 transformed = vec3(position);\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\n\n    gl_Position = projectionMatrix * mvPosition;\n    gl_PointSize = size;\n}\n",d.fragmentShader="\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuseColor;\nuniform float opacity;\n\nvoid main() {\n    float alpha = opacity;\n\n    float radius = 0.5;\n    vec2 coords = gl_PointCoord.xy - vec2(0.5);\n    float len = length(coords);\n    float falloff = fwidth(len);\n    float threshold = 1.0 - smoothstep(radius - falloff, radius, len);\n    alpha *= threshold;\n\n    gl_FragColor = vec4(diffuseColor, alpha);\n}",d.uniforms=r.UniformsUtils.merge([{size:new r.Uniform(a.DEFAULT_CIRCLE_SIZE),diffuseColor:new r.Uniform(t),opacity:new r.Uniform(1)},r.UniformsLib.fog]),d.depthTest=!1,d.extensions=Object.assign(Object.assign({},d.extensions),{derivatives:!0}),c=d}super(c),(0,o.enforceBlending)(this),this.type="CirclePointsMaterial",this.setOpacity(1),void 0!==i&&(this.size=i),void 0!==s&&(this.color=s),void 0!==l&&this.setOpacity(l)}get size(){return this.uniforms.size.value}set size(e){this.uniforms.size.value=e}get color(){return this.uniforms.diffuseColor.value}set color(e){this.uniforms.diffuseColor.value.copy(e)}}t.CirclePointsMaterial=a,a.DEFAULT_CIRCLE_SIZE=1},4121:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyMaterial=t.CopyShader=void 0;const n=i(82);t.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform float opacity;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        gl_FragColor = opacity * texel;\n    }"};class r extends n.ShaderMaterial{constructor(e){super({name:"CopyMaterial",uniforms:e,vertexShader:t.CopyShader.vertexShader,fragmentShader:t.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!1,blending:n.NoBlending,depthTest:!1,depthWrite:!1})}}t.CopyMaterial=r},1549:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeMaterial=void 0;const n=i(82),r=i(8014),s=i(8955),o=i(8177),a=i(2141),l=i(8578);class c extends a.RawShaderMaterial{constructor(e){var t;let i;if(e){const r={},a=void 0!==e.extrusionRatio&&e.extrusionRatio>=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN&&e.extrusionRatio<s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX;e.displacementMap&&(0,l.setShaderDefine)(r,"USE_DISPLACEMENTMAP",!0),a&&(0,l.setShaderDefine)(r,"USE_EXTRUSION",!0),!0===e.vertexColors&&(0,l.setShaderDefine)(r,"USE_COLOR",!0),i={name:"EdgeMaterial",vertexShader:"\n#define EDGE_DEPTH_OFFSET 0.0001\n\n#ifdef USE_COLOR\nattribute vec4 color;\n#else\nuniform vec3 color;\n#endif\n\n// SHADER_NAME may be defined by THREE.JS own shaders in which case these attributes & uniforms are\n// already defined\n#ifndef SHADER_NAME\nattribute vec3 position;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 normalMatrix;\n#endif\n\nuniform vec3 edgeColor;\nuniform float edgeColorMix;\n\n#ifdef USE_DISPLACEMENTMAP\nattribute vec3 normal;\nattribute vec2 uv;\nuniform sampler2D displacementMap;\n#endif\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_vertex>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\nvoid main() {\n\n    vColor = mix(edgeColor.rgb, color.rgb, edgeColorMix);\n\n    vec3 transformed = vec3( position );\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_vertex>\n    #endif\n\n    #ifdef USE_DISPLACEMENTMAP\n    transformed += normalize( normal ) * texture2D( displacementMap, uv ).x;\n    #endif\n\n    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n    gl_Position = projectionMatrix * mvPosition;\n    // After projection gl_Position contains clip space coordinates of each vertex\n    // before perspective division (1 / w), thus only vertexes with -w < z < w should\n    // be displayed and offset. We offset only those edges which z coordinate in NDC\n    // space is between: -inf < z < 1\n    float depthOffset = step(-1.0, -gl_Position.z / gl_Position.w) * EDGE_DEPTH_OFFSET;\n    gl_Position.z -= depthOffset;\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_fragment>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\nvoid main() {\n    float alphaValue = 1.0;\n    gl_FragColor = vec4(vColor, alphaValue);\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_fragment>\n    #endif\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}",uniforms:{color:new n.Uniform(new n.Color(c.DEFAULT_COLOR)),edgeColor:new n.Uniform(new n.Color(c.DEFAULT_COLOR)),edgeColorMix:new n.Uniform(c.DEFAULT_COLOR_MIX),fadeNear:new n.Uniform(o.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new n.Uniform(o.FadingFeature.DEFAULT_FADE_FAR),extrusionRatio:new n.Uniform(s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX),displacementMap:new n.Uniform(null!==(t=e.displacementMap)&&void 0!==t?t:new n.Texture)},depthWrite:!1,defines:r,rendererCapabilities:e.rendererCapabilities}}super(i),(0,l.enforceBlending)(this),o.FadingFeature.patchGlobalShaderChunks(),r.ExtrusionFeature.patchGlobalShaderChunks(),void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.colorMix&&(this.colorMix=e.colorMix),void 0!==e.fadeNear&&(this.fadeNear=e.fadeNear),void 0!==e.fadeFar&&(this.fadeFar=e.fadeFar),void 0!==e.displacementMap&&(this.displacementMap=e.displacementMap),void 0!==e.extrusionRatio&&(this.extrusionRatio=e.extrusionRatio))}get objectColor(){return this.uniforms.color.value}set objectColor(e){this.uniforms.color.value.copy(e)}get color(){return this.uniforms.edgeColor.value}set color(e){this.uniforms.edgeColor.value.copy(e)}get lineWidth(){return this.linewidth}set lineWidth(e){this.linewidth=e,this.linewidth<=0?this.visible=!1:this.visible=!0}get colorMix(){return this.uniforms.edgeColorMix.value}set colorMix(e){this.uniforms.edgeColorMix.value!==e&&(this.uniforms.edgeColorMix.value=e)}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){this.uniforms.fadeFar.value!==e&&(this.uniforms.fadeFar.value=e,(0,l.setShaderMaterialDefine)(this,"USE_FADING",e>0))}get extrusionRatio(){return this.uniforms.extrusionRatio.value}set extrusionRatio(e){if(this.uniforms.extrusionRatio.value===e)return;this.uniforms.extrusionRatio.value=e;const t=e>=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN;(0,l.setShaderMaterialDefine)(this,"USE_EXTRUSION",t)}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){if(this.uniforms.displacementMap.value===e)return;this.uniforms.displacementMap.value=e;const t=null!==e;t&&(this.uniforms.displacementMap.value.needsUpdate=!0),(0,l.setShaderMaterialDefine)(this,"USE_DISPLACEMENTMAP",t)}}t.EdgeMaterial=c,c.DEFAULT_COLOR=0,c.DEFAULT_COLOR_MIX=0},2462:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroundAtmosphereMaterial=t.GroundAtmosphereShader=void 0;const n=i(82),r=i(2141),s=i(1870),o=i(8578);t.GroundAtmosphereShader={uniforms:{u_eyePositionWorld:new n.Uniform(new n.Vector3),u_lightDirectionWorld:new n.Uniform(new n.Vector3(0,1,0)),u_modelViewProjection:new n.Uniform(new n.Matrix4),u_atmosphereEnv:new n.Uniform(new n.Vector3(6384515.136999999,6537590.425,0)),u_hsvCorrection:new n.Uniform(new n.Vector3(0,0,0)),topColor:new n.Uniform(new n.Color(30719)),bottomColor:new n.Uniform(new n.Color(16777215)),offset:new n.Uniform(33),exponent:new n.Uniform(.6),fogColor:new n.Uniform(new n.Color(30719)),fogNear:new n.Uniform(new n.Color(30719)),fogFar:new n.Uniform(new n.Color(16777215))},vertexShader:`\n\n    #define IMPROVE_INTERSECT_PRECISION 1\n    #define IMPROVE_DOT_PRECISION 1\n\n    precision highp float;\n    precision highp int;\n\n    attribute vec4 position;\n\n    // Base mandatory uniforms\n    uniform mat4 u_modelViewProjection;\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_hsvCorrection;\n\n    const float Pi = 3.141592653589793;\n    const float Kr = 0.0025;\n    const float Km = 0.0015;\n    const float Kr4PI = Kr * 4.0 * Pi;\n    const float Km4PI = Km * 4.0 * Pi;\n    const float ESun = 25.0; // should be 15.0\n    const float KmESun = Km * ESun;\n    const float KrESun = Kr * ESun;\n    const vec3 InvWavelength = vec3(\n        1.0 / pow(0.650, 4.0), // Red\n        1.0 / pow(0.570, 4.0), // Green\n        1.0 / pow(0.475, 4.0)); // Blue\n\n    const int nSamples = 2;\n    const float fSamples = 2.0;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n    varying vec3 v_vertToOrigin;\n\n    ${s.default.atmosphere_vertex_utils}\n\n    //\n    // Computes rayleight and mia atmosphere factors for ground.\n    //\n    // Code based on GPU Gems article.\n    //\n    // Author: Sean O'Neil\n    //\n    // Copyright (c) 2004 Sean O'Neil\n    //\n    // https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering\n    //\n    // Further modifications by HERE.\n    //\n    AtmosphereColor computeGroundAtmosphere(vec3 v3Pos, vec3 vLightDir)\n    {\n        // Retrieve environment variables\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        // All that may be moved to const or define(s) at further optimizations:\n        float fScale = 1.0 / (fOuterRadius - fInnerRadius);\n        float fScaleOverScaleDepth = fScale / RayleighScaleDepth;\n        float fCameraHeight2 = fCameraHeight * fCameraHeight;\n        float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\n        // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n        vec3 v3Ray = v3Pos - u_eyePositionWorld;\n        float fFar = length(v3Ray);\n        v3Ray /= fFar;\n\n#if !defined(IMPROVE_DOT_PRECISION)\n        vec3 v3Dir = normalize(v3Pos);\n#endif\n\n#ifdef CAMERA_IN_SPACE\n\n        // Calculate first point of camera ray and sphere intersection.\n        float fNear = getNearSphereIntersect(u_eyePositionWorld, v3Ray, fCameraHeight2, fOuterRadius2);\n        // Make far relative to first atmosphere intersection, setting it to\n        // the length of ray passed through atmosphere\n        fFar -= fNear;\n\n        // Compute the ray's starting position within the atmosphere, then\n        // calculate its scattering offset\n        vec3 v3Start = u_eyePositionWorld + v3Ray * fNear;\n        float fDepth = exp((fInnerRadius - fOuterRadius) / RayleighScaleDepth);\n\n#else // CAMERA_IN_ATMOSPHERE\n\n        // The ray starts already in atmosphere\n        vec3 v3Start = u_eyePositionWorld;\n        // Virtually fNear is just at eye position, so ray passing through atmosphere does not shorten\n        // fFar -= 0.0;\n        float fDepth = exp((fInnerRadius - fCameraHeight) / RayleighScaleDepth);\n#endif\n\n#if defined(IMPROVE_DOT_PRECISION)\n        float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\n#else\n        float fCameraAngle = dot(-v3Ray, v3Dir);\n#endif\n        float fCameraScale = scale(fCameraAngle);\n\n#ifdef DYNAMIC_LIGHT\n        // When we want the atmosphere to be uniform over the globe so it is set to 1.0.\n        #if defined(IMPROVE_DOT_PRECISION)\n            // The light angle for given light source may be calculated as:\n            // angle = dot(vLightDir, v3Dir) / length(v3Dir);\n            // where v3Dir holds normalized vertex position, but for precision issues we v3Pos (un-normalized)\n            float fLightAngle = dot(vLightDir, v3Pos) / length(v3Pos);\n        #else\n            float fLightAngle = dot(vLightDir, v3Dir);\n        #endif\n#else\n        float fLightAngle = 1.0;\n#endif\n        float fLightScale = scale(fLightAngle);\n\n        float fCameraOffset = fDepth * fCameraScale;\n        float fTemp = (fLightScale + fCameraScale);\n\n        // Initialize the scattering loop variables\n        float fSampleLength = fFar / fSamples;\n        float fScaledLength = fSampleLength * fScale;\n        vec3 v3SampleRay = v3Ray * fSampleLength;\n        vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n        // Now loop through the sample rays\n        vec3 v3BaseColor = vec3(0.0);\n        vec3 v3Attenuate = vec3(0.0);\n        for(int i = 0; i < nSamples; i++)\n        {\n            float fHeight = length(v3SamplePoint);\n            float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n            float fScatter = fDepth * fTemp - fCameraOffset;\n            // Compute color factors\n            v3Attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n            v3BaseColor += v3Attenuate * (fDepth * fScaledLength);\n            // Move to the next point\n            v3SamplePoint += v3SampleRay;\n        }\n\n        AtmosphereColor color;\n        color.mie = v3BaseColor * (InvWavelength * KrESun + KmESun);\n        // Calculate the attenuation factor for the ground\n        color.rayleigh = v3Attenuate;\n\n        return color;\n    }\n\n    void main(void)\n    {\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        AtmosphereColor atmColor = computeGroundAtmosphere(position.xyz, vLightDir);\n        v_mieColor = atmColor.mie;\n        v_rayleighColor = atmColor.rayleigh;\n        v_vertToCamera = u_eyePositionWorld - position.xyz;\n        v_vertToOrigin = normalize(position.xyz);\n\n        gl_Position = u_modelViewProjection * position;\n    }\n    `,fragmentShader:`\n\n    // Exposure correction gives more subtle gradients on the ground.\n    #define CORRECT_EXPOSURE 1\n    #define FADE_DEPTH 1\n    #define NIGHT_LOCAL 1\n\n    precision highp float;\n    precision highp int;\n\n    #ifdef CORRECT_COLOR\n    uniform vec3 u_hsvCorrection; // Hue, saturation, brightness\n    #endif\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    const float g = -0.95;\n    const float g2 = g * g;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n    varying vec3 v_vertToOrigin;\n\n    ${s.default.atmosphere_fragment_utils}\n\n    void main(void)\n    {\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        // GPU gems mix of ground solution, with custom alpha settings\n        vec3 cRgb = v_mieColor + 0.25 * v_rayleighColor;\n\n        // Not needed for HDR frame buffer\n    #if !defined(HDR_FRAME_BUFFER) && defined(CORRECT_EXPOSURE)\n        // Interesting results with exposure factor: 2.0, 3.5, 4.0\n        cRgb = correctExposure(cRgb, 3.0);\n    #endif\n\n    #ifdef CORRECT_COLOR\n        cRgb = correctColor(cRgb, u_hsvCorrection);\n    #endif\n\n        // Base atmosphere opacity\n        float fAtmosphereAlpha = 1.0;\n\n        // Factor based on the distance of camera atmosphere and ground, results are:\n        // 0.0 = camera on the ground surface,\n        // 1.0 = at the outer edge of the atmosphere.\n        float fDepthFactor = clamp((fCameraHeight - fInnerRadius) /\n            (fOuterRadius - fInnerRadius), 0.0, 1.0);\n    #ifdef FADE_DEPTH\n        // Fade alpha based on the distance of camera between atmosphere layers\n        #ifdef FADE_DEPTH_LINEAR\n            fAtmosphereAlpha *= fDepthFactor;\n        #else\n            fAtmosphereAlpha *= pow(fDepthFactor, 1.5);\n        #endif\n    #endif\n\n#if defined(FADE_NIGHT) || defined(DARKEN_NIGHT)\n    #ifdef DYNAMIC_LIGHT\n        // Adjust factor based on time of day, results are:\n        // 0.0 = night,\n        // 1.0 = day.\n        #ifdef NIGHT_GLOBAL\n            // Global night fade based on camera and light orientation\n            float fNightFactor = clamp(dot(normalize(u_eyePositionWorld), vLightDir), 0.0, 1.0);\n            fNightFactor = pow(fNightFactor, 0.5);\n        #else // NIGHT_LOCAL\n            float fNightFactor =\n                clamp(dot(v_vertToOrigin, vLightDir) / length(v_vertToOrigin), 0.0, 1.0);\n            fNightFactor = pow(fNightFactor, 0.8);\n        #endif\n    #else\n        float fNightFactor = 1.0;\n    #endif\n#endif\n\n    #ifdef FADE_NIGHT\n        // Adjust alpha for night side of the globe\n        fAtmosphereAlpha *= fNightFactor;\n    #endif\n\n    #ifdef DARKEN_NIGHT\n        // Change the brightness depending on night / day side.\n        // NOTE: Darkening should be rather applied in HSV space, without loss on saturation,\n        // but it is much more GPU consuming.\n        const float minBrightness = 0.5;\n        float fDarkenFactor = clamp(fNightFactor, minBrightness, 1.0);\n        cRgb *= fDarkenFactor;\n    #endif\n\n    #ifdef EXPOSURE_DEPTH\n        // Control exposure depending from ground distance\n        float exposureBoost = 3.0 - fDepthFactor;\n        cRgb = correctExposure(cRgb, exposureBoost);\n    #endif\n\n        // Experimental fading out of focus point - similar to fresnel effect in top view.\n        // This fade is handy to better expose cartographic/map features in screen center.\n        float fFocusFactor = 1.0 - clamp(dot(normalize(v_vertToCamera), v_vertToOrigin), 0.0, 1.0) + 0.1;\n        fFocusFactor = pow(fFocusFactor, 2.5);\n        fAtmosphereAlpha *= fFocusFactor;\n\n        // Integrate all features\n        gl_FragColor = vec4(cRgb, fAtmosphereAlpha);\n    }\n    `};class a extends r.RawShaderMaterial{constructor(e){let i;e&&(i={name:"GroundAtmosphereMaterial",vertexShader:t.GroundAtmosphereShader.vertexShader,fragmentShader:t.GroundAtmosphereShader.fragmentShader,uniforms:t.GroundAtmosphereShader.uniforms,transparent:!0,depthTest:!1,depthWrite:!1,side:n.FrontSide,blending:n.NormalBlending,fog:!1,rendererCapabilities:e.rendererCapabilities}),super(i)}setDynamicLighting(e){(0,o.setShaderMaterialDefine)(this,"DYNAMIC_LIGHT",e)}set outerRadius(e){this.uniforms.u_atmosphereEnv.value.y=e}get outerRadius(){return this.uniforms.u_atmosphereEnv.value.y}set innerRadius(e){this.uniforms.u_atmosphereEnv.value.x=e}get innerRadius(){return this.uniforms.u_atmosphereEnv.value.x}updateUniforms(e,t,i,n){const r=this.getCameraInfo(t,i);if(void 0===e||!e.isMaterial)throw Error("Wrong object used, only Material objects are supported");if(!(e.uniforms&&e.uniforms.u_atmosphereEnv&&e.uniforms.u_hsvCorrection&&e.uniforms.u_eyePositionWorld&&e.uniforms.u_modelViewProjection&&e.uniforms.u_lightDirectionWorld))throw Error("Atmosphere material has missing uniforms");{const t=r.eyePos,i=r.modelViewProjection,s=r.eyeHeight;e.uniforms.u_eyePositionWorld.value.copy(t),e.uniforms.u_modelViewProjection.value.copy(i),e.uniforms.u_atmosphereEnv.value.z=s,e.uniforms.u_lightDirectionWorld.value=n.clone();const a=s>this.outerRadius,l=(0,o.setShaderDefine)(e.defines,"CAMERA_IN_SPACE",a),c=(0,o.setShaderDefine)(e.defines,"CAMERA_IN_ATMOSPHERE",!a);e.needsUpdate=e.needsUpdate||l||c}}getCameraInfo(e,t,i=!1){if(i){const i=(new n.Matrix4).identity(),r=(new n.Matrix4).copy(e.matrixWorld).invert().transpose(),s=t.projectionMatrix,o=new n.Matrix4;o.multiplyMatrices(r,i),o.multiplyMatrices(s,o);const a=new n.Vector3;e.getWorldPosition(a);const l=new n.Vector3;return t.getWorldPosition(l),{modelViewProjection:o,eyePos:a,eyeHeight:l.distanceTo(a)}}{const i=e.matrixWorld,r=t.matrixWorldInverse,s=t.projectionMatrix,o=new n.Matrix4;o.multiplyMatrices(r,i),o.multiplyMatrices(s,o);const a=new n.Vector3;t.getWorldPosition(a);const l=new n.Vector3;e.getWorldPosition(l);const c=l.distanceTo(a);return a.sub(l),{modelViewProjection:o,eyePos:a,eyeHeight:c}}}}t.GroundAtmosphereMaterial=a},182:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isHighPrecisionLineMaterial=t.HighPrecisionLineMaterial=void 0;const n=i(82),r=i(2141),s=i(7133);class o extends r.RawShaderMaterial{constructor(e){Object.assign(n.ShaderChunk,s.default);const t=e?{name:"HighPrecisionLineMaterial",vertexShader:"\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 position;        // high part\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuseColor;\nuniform float opacity;\n\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\nvoid main() {\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuseColor * vColor, opacity );\n    #else\n    gl_FragColor = vec4( diffuseColor, opacity );\n    #endif\n}",uniforms:{diffuseColor:new n.Uniform(new n.Color(o.DEFAULT_COLOR)),opacity:new n.Uniform(o.DEFAULT_OPACITY),u_mvp:new n.Uniform(new n.Matrix4),u_eyepos:new n.Uniform(new n.Vector3),u_eyepos_lowpart:new n.Uniform(new n.Vector3)},rendererCapabilities:e.rendererCapabilities}:void 0;t&&Object.assign(t,e),super(t),this.type="HighPrecisionLineMaterial",this.isHighPrecisionLineMaterial=!0,e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.opacity&&(this.opacity=e.opacity)),this.updateTransparencyFeature()}get color(){return this.uniforms.diffuseColor.value}set color(e){this.uniforms.diffuseColor.value.copy(e)}updateTransparencyFeature(){this.transparent=this.opacity<1}}t.HighPrecisionLineMaterial=o,o.DEFAULT_COLOR=80,o.DEFAULT_OPACITY=1,t.isHighPrecisionLineMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionLineMaterial}},872:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isHighPrecisionPointMaterial=t.HighPrecisionPointMaterial=void 0;const n=i(82),r=i(7133);class s extends n.PointsMaterial{constructor(e){Object.assign(n.ShaderChunk,r.default),super(e),this.type="HighPrecisionPointMaterial",this.vertexShader="\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\nuniform float size;\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n\n    // ignore sizeAttenuation for now!\n    gl_PointSize = size;\n}",this.fragmentShader=n.ShaderChunk.points_frag,this.fog=!1,this.uniforms={diffuseColor:new n.Uniform(new n.Color(s.DEFAULT_COLOR)),opacity:new n.Uniform(s.DEFAULT_OPACITY),size:new n.Uniform(s.DEFAULT_SIZE),scale:new n.Uniform(s.DEFAULT_SCALE),map:new n.Uniform(new n.Texture),uvTransform:new n.Uniform(new n.Matrix3),u_mvp:new n.Uniform(new n.Matrix4),u_eyepos:new n.Uniform(new n.Vector3),u_eyepos_lowpart:new n.Uniform(new n.Vector3)},this.isHighPrecisionPointMaterial=!0,void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.opacity&&(this.opacity=e.opacity),void 0!==e.size&&(this.size=e.size),void 0!==e.scale&&(this.scale=e.scale),void 0!==e.uvTransform&&(this.uvTransform=e.uvTransform),void 0!==e.map&&(this.map=e.map))}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}get uvTransform(){return this.uniforms.uvTransform.value}set uvTransform(e){this.uniforms.uvTransform.value=e}}t.HighPrecisionPointMaterial=s,s.DEFAULT_COLOR=80,s.DEFAULT_OPACITY=1,s.DEFAULT_SIZE=1,s.DEFAULT_SCALE=1,t.isHighPrecisionPointMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionPointMaterial}},9489:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconMaterial=void 0;const n=i(82),r=i(2141);class s extends r.RawShaderMaterial{constructor(e){super(e?{name:"IconMaterial",vertexShader:"\nattribute vec4 position;\nattribute vec4 color;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    vColor = color;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D map;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec4 color = texture2D(map, vUv.xy);\n    color *= vColor;\n    if (color.a < 0.05) {\n        discard;\n    }\n    gl_FragColor = color;\n}",uniforms:{map:new n.Uniform(e.map)},depthTest:!1,depthWrite:!1,transparent:!0,vertexColors:!0,premultipliedAlpha:!0,rendererCapabilities:e.rendererCapabilities}:void 0)}get map(){return this.uniforms.map.value}}t.IconMaterial=s},3224:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSAAMaterial=void 0;const n=i(82),r=i(4121);class s extends n.ShaderMaterial{constructor(e){super({uniforms:e,vertexShader:r.CopyShader.vertexShader,fragmentShader:r.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:n.AdditiveBlending,depthTest:!1,depthWrite:!1})}}t.MSAAMaterial=s},4821:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMeshBasicMaterial=void 0;const n=i(82),r=i(4342),s=i(4744),o=i(8014),a=i(8955),l=i(8177),c=i(4258),h=i(8878),u=i(5997),d=i(674);class m extends n.MeshBasicMaterial{constructor(e){super(e),l.FadingFeature.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),o.ExtrusionFeature.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),this.addDisplacementProperties(),this.applyDisplacementParameters(e),s.ColorCorrectionFeature.patchGlobalShaderChunks(),this.addColorCorrectionProperties(),this.applyColorCorrectionParameters(e)}clone(){return(new m).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this.copyDisplacementParameters(e),this.copyColorCorrectionParameters(e),this}get fadeNear(){return l.FadingFeature.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return l.FadingFeature.DEFAULT_FADE_FAR}set fadeFar(e){}set brightness(e){}get brightness(){return s.ColorCorrectionFeature.DEFAULT_BRIGHTNESS}set gamma(e){}get gamma(){return s.ColorCorrectionFeature.DEFAULT_GAMMA}get extrusionRatio(){return a.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}get displacementMap(){return null}set displacementMap(e){}setDisplacementMap(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}addDisplacementProperties(){}copyColorCorrectionParameters(e){}applyDisplacementParameters(e){}copyDisplacementParameters(e){}addColorCorrectionProperties(){}applyColorCorrectionParameters(e){}}t.MapMeshBasicMaterial=m,(0,r.applyMixinsWithoutProperties)(m,[d.FadingFeatureMixin]),(0,r.applyMixinsWithoutProperties)(m,[u.ExtrusionFeatureMixin]),(0,r.applyMixinsWithoutProperties)(m,[h.DisplacementFeatureMixin]),(0,r.applyMixinsWithoutProperties)(m,[c.ColorCorrectionFeatureMixin])},8484:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMeshDepthMaterial=void 0;const n=i(82),r=i(4342),s=i(8014),o=i(8955),a=i(5997);class l extends n.MeshDepthMaterial{constructor(e){super(e),s.ExtrusionFeature.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!1}))}get extrusionRatio(){return o.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshDepthMaterial=l,(0,r.applyMixinsWithoutProperties)(l,[a.ExtrusionFeatureMixin])},4877:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMeshPhongMaterial=void 0;const n=i(82),r=i(4342),s=i(8014),o=i(8955),a=i(8177),l=i(71),c=i(5997),h=i(674),u=i(5089);class d extends n.MeshPhongMaterial{constructor(e){var t;super(e),a.FadingFeature.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),s.ExtrusionFeature.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),this.m_colorIntensity=null!==(t=null==e?void 0:e.colorIntensity)&&void 0!==t?t:1,this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{(0,l.linkMixinWithShader)(this,e),e.fragmentShader=e.fragmentShader.replace("#include <lights_phong_pars_fragment>",`#include <lights_phong_pars_fragment>\n                ${u.blinnPhongNoSpecular}\n                `)})),(0,l.linkMixinWithMaterial)(this,this),(0,r.assert)(void 0!==this.shaderDefines),(0,r.assert)(void 0!==this.shaderUniforms),this.shaderUniforms.colorIntensity=new n.Uniform(this.colorIntensity)}clone(){return(new d).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this.colorIntensity=e.colorIntensity,this}get colorIntensity(){return this.m_colorIntensity}set colorIntensity(e){this.m_colorIntensity=e,this.shaderUniforms.colorIntensity.value=e}get fadeNear(){return a.FadingFeature.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return a.FadingFeature.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return o.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshPhongMaterial=d,(0,r.applyMixinsWithoutProperties)(d,[h.FadingFeatureMixin]),(0,r.applyMixinsWithoutProperties)(d,[c.ExtrusionFeatureMixin])},4067:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMeshStandardMaterial=void 0;const n=i(82),r=i(4342),s=i(8014),o=i(8955),a=i(8177),l=i(5997),c=i(674),h=i(759);class u extends n.MeshStandardMaterial{constructor(e){super(e),a.FadingFeature.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),s.ExtrusionFeature.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),!0===(null==e?void 0:e.removeDiffuseLight)&&(this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{e.fragmentShader=n.ShaderChunk.meshphysical_frag.replace("#include <lights_physical_pars_fragment>",h.simpleLightingShadowChunk)})))}clone(){return(new u).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this}get fadeNear(){return a.FadingFeature.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return a.FadingFeature.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return o.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}get removeDiffuseLight(){return!1}set removeDiffuseLight(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshStandardMaterial=u,(0,r.applyMixinsWithoutProperties)(u,[c.FadingFeatureMixin]),(0,r.applyMixinsWithoutProperties)(u,[l.ExtrusionFeatureMixin])},71:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.linkMixinWithShader=t.linkMixinWithMaterial=t.cameraToWorldDistance=void 0,t.cameraToWorldDistance=function(e,t){return e*t.maximum},t.linkMixinWithMaterial=function(e,t){void 0===t.defines&&(t.defines={}),e.shaderDefines=t.defines,void 0===e.shaderUniforms&&(e.shaderUniforms={})},t.linkMixinWithShader=function(e,t){Object.assign(t.uniforms,e.shaderUniforms),e.shaderUniforms=t.uniforms}},2141:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RawShaderMaterial=void 0;const n=i(82),r=i(4342),s=i(8578);class o extends n.RawShaderMaterial{constructor(e){const t=!0===(null==e?void 0:e.rendererCapabilities.isWebGL2),i=e?Object.assign(Object.assign({},e),{glslVersion:t?n.GLSL3:n.GLSL1,vertexShader:t&&e.vertexShader?(0,r.convertVertexShaderToWebGL2)(e.vertexShader):e.vertexShader,fragmentShader:t&&e.fragmentShader?(0,r.convertFragmentShaderToWebGL2)(e.fragmentShader):e.fragmentShader}):void 0;i&&delete i.rendererCapabilities,super(i),this.invalidateFog(),this.setOpacity(null==i?void 0:i.opacity)}invalidateFog(){void 0!==this.defines&&this.fog!==(0,s.getShaderMaterialDefine)(this,"USE_FOG")&&(0,s.setShaderMaterialDefine)(this,"USE_FOG",this.fog)}setOpacity(e){var t;void 0!==e&&(this.opacity=e,(null===(t=this.uniforms)||void 0===t?void 0:t.opacity)&&(this.uniforms.opacity.value=e))}}t.RawShaderMaterial=o},3298:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyAtmosphereMaterial=t.SkyAtmosphereShader=void 0;const n=i(82),r=i(2141),s=i(1870),o=i(8578);t.SkyAtmosphereShader={uniforms:{u_eyePositionWorld:new n.Uniform(new n.Vector3),u_lightDirectionWorld:new n.Uniform(new n.Vector3(0,1,0)),u_modelViewProjection:new n.Uniform(new n.Matrix4),u_atmosphereEnv:new n.Uniform(new n.Vector3(6378137,6537590.425,0)),u_hsvCorrection:new n.Uniform(new n.Vector3(0,0,0)),topColor:new n.Uniform(new n.Color(30719)),bottomColor:new n.Uniform(new n.Color(16777215)),offset:new n.Uniform(33),exponent:new n.Uniform(.6),fogColor:new n.Uniform(new n.Color(30719)),fogNear:new n.Uniform(new n.Color(30719)),fogFar:new n.Uniform(new n.Color(16777215))},vertexShader:`\n    precision highp float;\n    precision highp int;\n\n    attribute vec4 position;\n\n    uniform mat4 u_modelViewProjection;\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_hsvCorrection;\n\n    const float Pi = 3.141592653589793;\n    const float Kr = 0.0025;\n    const float Kr4PI = Kr * 4.0 * Pi;\n    const float Km = 0.0015;\n    const float Km4PI = Km * 4.0 * Pi;\n    const float ESun = 15.0; // should be 15.0\n    const float KmESun = Km * ESun;\n    const float KrESun = Kr * ESun;\n    const vec3 InvWavelength = vec3(\n        5.60204474633241,  // Red = 1.0 / Math.pow(0.650, 4.0)\n        9.473284437923038, // Green = 1.0 / Math.pow(0.570, 4.0)\n        19.643802610477206); // Blue = 1.0 / Math.pow(0.475, 4.0)\n\n    const int nSamples = 2;\n    const float fSamples = 2.0;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n\n    ${s.default.atmosphere_vertex_utils}\n\n    //\n    // Computes rayleight and mia atmosphere factors for sky.\n    //\n    // Code based on GPU Gems article.\n    //\n    // Author: Sean O'Neil\n    //\n    // Copyright (c) 2004 Sean O'Neil\n    //\n    // https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering\n    //\n    // Further modifications by HERE\n    //\n    AtmosphereColor computeSkyAtmosphere(vec3 v3Pos, vec3 vLightDir)\n    {\n        // Unpack attributes\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        // All that may be const or define(s) at further optimization:\n        float fScale = 1.0 / (fOuterRadius - fInnerRadius);\n        float fScaleOverScaleDepth = (fScale / RayleighScaleDepth);\n        float fCameraHeight2 = fCameraHeight * fCameraHeight;\n        float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\n        // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n        vec3 v3Ray = v3Pos - u_eyePositionWorld;\n        float fFar = length(v3Ray);\n        v3Ray /= fFar;\n\n    #ifdef CAMERA_IN_SPACE\n\n        // Calculate the closest intersection of the ray with the outer\n        // atmosphere, this is the first point of the ray passing through the atmosphere dome.\n        float fNear = getNearSphereIntersect(u_eyePositionWorld, v3Ray, fCameraHeight2, fOuterRadius2);\n        // Make far relative to first atmosphere intersection\n        fFar -= fNear;\n\n        // Compute the ray's starting position within the atmosphere, then\n        // calculate its scattering offset\n        vec3 v3Start = u_eyePositionWorld + v3Ray * fNear;\n\n        float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\n        float fStartDepth = exp(-1.0 / RayleighScaleDepth );\n        float fStartOffset = fStartDepth * scale(fStartAngle);\n\n    #else // CAMERA_IN_ATMOSPHERE\n\n        // The ray starts already in atmosphere\n        vec3 v3Start = u_eyePositionWorld;\n        float height = length(v3Start);\n        float depth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\n        float fStartAngle = dot(v3Ray, v3Start) / height;\n        float fStartOffset = depth * scale(fStartAngle);\n\n    #endif\n\n        // Initialize the scattering loop variables\n        float fSampleLength = fFar / fSamples;\n        float fScaledLength = fSampleLength * fScale;\n        vec3 v3SampleRay = v3Ray * fSampleLength;\n        vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n        // Now loop through the sample rays\n        vec3 v3BaseColor = vec3(0.0);\n        vec3 v3Attenuate = vec3(0.0);\n        for(int i=0; i < nSamples; i++)\n        {\n            float height = length(v3SamplePoint);\n            float depth = exp(fScaleOverScaleDepth * (fInnerRadius - height));\n            float fLightAngle = dot(vLightDir, v3SamplePoint) / height;\n            float fCameraAngle = dot(v3Ray, v3SamplePoint) / height;\n            float fScatter = (fStartOffset + depth * (scale(fLightAngle) - scale(fCameraAngle)));\n            v3Attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n            v3BaseColor += v3Attenuate * (depth * fScaledLength);\n            v3SamplePoint += v3SampleRay;\n        }\n\n        // Scale the Mie and Rayleigh colors and set up output of the function\n        AtmosphereColor color;\n        color.mie = v3BaseColor * KmESun;\n        color.rayleigh = v3BaseColor * (InvWavelength * KrESun);\n        return color;\n    }\n\n    void main(void)\n    {\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        AtmosphereColor atmColor = computeSkyAtmosphere(position.xyz, vLightDir);\n        v_mieColor = atmColor.mie;\n        v_rayleighColor = atmColor.rayleigh;\n        v_vertToCamera = u_eyePositionWorld - position.xyz;\n\n        gl_Position = u_modelViewProjection * position;\n    }\n    `,fragmentShader:`\n    // Because of harsh light distribution the exposure correction is always enabled for the sky.\n    #define CORRECT_EXPOSURE 1\n\n    precision highp float;\n    precision highp int;\n\n    #ifdef CORRECT_COLOR\n    uniform vec3 u_hsvCorrection; // Hue, saturation, brightness\n    #endif\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    const float g = -0.95;\n    const float g2 = g * g;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n\n    ${s.default.atmosphere_fragment_utils}\n\n    void main(void)\n    {\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n            // Alter alpha based on time of day (0.0 = night , 1.0 = day)\n            float fNightAlpha = clamp(dot(normalize(u_eyePositionWorld), vLightDir), 0.0, 1.0);\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n            float fNightAlpha = 1.0;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        // NOTE:\n        // For better precision normalization may be added on fragment (for mobile devices)\n        // while in vertex shader may be left un-normalized\n        // dot(vLightDir, normalize(v_vertToCamera)) / length(v_vertToCamera);\n        float fCosAngle = dot(vLightDir, v_vertToCamera) / length(v_vertToCamera);\n        float fRayleighPhase = 0.75 * (1.0 + fCosAngle * fCosAngle);\n        float fMiePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCosAngle * fCosAngle) / pow(1.0 + g2 - 2.0 * g * fCosAngle, 1.5);\n\n        vec3 cRgb = fRayleighPhase * v_rayleighColor + fMiePhase * v_mieColor;\n\n        // Sky produces very harsh lighting effect so exposure correction is always enabled.\n    #if !defined(HDR_FRAME_BUFFER) && defined(CORRECT_EXPOSURE)\n        // Exposure factor may be exposed to uniform variable.\n        cRgb = correctExposure(cRgb, 2.0);\n    #endif\n\n    #ifdef CORRECT_COLOR\n        cRgb = correctColor(cRgb, u_hsvCorrection);\n    #endif\n\n        // Alter alpha based on how close the viewer is to the ground (1.0 = on ground, 0.0 = at edge of atmosphere)\n        float fAtmosphereAlpha = clamp((fOuterRadius - fCameraHeight) /\n            (fOuterRadius - fInnerRadius), 0.0, 1.0);\n        fAtmosphereAlpha *= pow(fNightAlpha, 0.5);\n\n        gl_FragColor = vec4(cRgb, mix(cRgb.b, 1.0, fAtmosphereAlpha));\n    }\n    `};class a extends r.RawShaderMaterial{constructor(e){let i;e&&(i={name:"SkyAtmosphereMaterial",vertexShader:t.SkyAtmosphereShader.vertexShader,fragmentShader:t.SkyAtmosphereShader.fragmentShader,uniforms:t.SkyAtmosphereShader.uniforms,transparent:!0,depthTest:!0,depthWrite:!1,side:n.BackSide,blending:n.NormalBlending,fog:!1,rendererCapabilities:e.rendererCapabilities}),super(i)}setDynamicLighting(e){(0,o.setShaderMaterialDefine)(this,"DYNAMIC_LIGHT",e)}set outerRadius(e){this.uniforms.u_atmosphereEnv.value.y=e}get outerRadius(){return this.uniforms.u_atmosphereEnv.value.y}set innerRadius(e){this.uniforms.u_atmosphereEnv.value.x=e}get innerRadius(){return this.uniforms.u_atmosphereEnv.value.x}updateUniforms(e,t,i,n){const r=this.getCameraInfo(t,i);if(void 0===e||!e.isMaterial)throw Error("Wrong object used, only Material objects are supported");if(!(e.uniforms&&e.uniforms.u_atmosphereEnv&&e.uniforms.u_hsvCorrection&&e.uniforms.u_eyePositionWorld&&e.uniforms.u_modelViewProjection&&e.uniforms.u_lightDirectionWorld))throw Error("Atmosphere material has missing uniforms");{const t=r.eyePos,i=r.modelViewProjection,s=r.eyeHeight;e.uniforms.u_eyePositionWorld.value.copy(t),e.uniforms.u_modelViewProjection.value.copy(i),e.uniforms.u_atmosphereEnv.value.z=s,e.uniforms.u_lightDirectionWorld.value=n.clone();const a=s>this.outerRadius,l=(0,o.setShaderDefine)(e.defines,"CAMERA_IN_SPACE",a),c=(0,o.setShaderDefine)(e.defines,"CAMERA_IN_ATMOSPHERE",!a);e.needsUpdate=e.needsUpdate||l||c}}getCameraInfo(e,t,i=!1){if(i){const i=(new n.Matrix4).identity(),r=(new n.Matrix4).copy(e.matrixWorld).invert().transpose(),s=t.projectionMatrix,o=new n.Matrix4;o.multiplyMatrices(r,i),o.multiplyMatrices(s,o);const a=new n.Vector3;e.getWorldPosition(a);const l=new n.Vector3;return t.getWorldPosition(l),{modelViewProjection:o,eyePos:a,eyeHeight:l.distanceTo(a)}}{const i=e.matrixWorld,r=t.matrixWorldInverse,s=t.projectionMatrix,o=new n.Matrix4;o.multiplyMatrices(r,i),o.multiplyMatrices(s,o);const a=new n.Vector3;t.getWorldPosition(a);const l=new n.Vector3;e.getWorldPosition(l);const c=l.distanceTo(a);return a.sub(l),{modelViewProjection:o,eyePos:a,eyeHeight:c}}}}t.SkyAtmosphereMaterial=a},9528:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolidLineMaterial=t.LineDashesModes=t.LineCapsModes=void 0;const n=i(82),r=i(1667),s=i(7610),o=i(8177),a=i(2141),l=i(8578);var c;!function(e){e[e.CAPS_NONE=0]="CAPS_NONE",e[e.CAPS_SQUARE=1]="CAPS_SQUARE",e[e.CAPS_ROUND=2]="CAPS_ROUND",e[e.CAPS_TRIANGLE_IN=3]="CAPS_TRIANGLE_IN",e[e.CAPS_TRIANGLE_OUT=4]="CAPS_TRIANGLE_OUT"}(c=t.LineCapsModes||(t.LineCapsModes={}));const h={None:c.CAPS_NONE,Square:c.CAPS_SQUARE,Round:c.CAPS_ROUND,TriangleIn:c.CAPS_TRIANGLE_IN,TriangleOut:c.CAPS_TRIANGLE_OUT},u=Object.keys(h).reduce(((e,t)=>{const i=t;return e[h[i]]=i,e}),{});var d;!function(e){e[e.DASHES_SQUARE=0]="DASHES_SQUARE",e[e.DASHES_ROUND=1]="DASHES_ROUND",e[e.DASHES_DIAMOND=2]="DASHES_DIAMOND"}(d=t.LineDashesModes||(t.LineDashesModes={}));const m={Square:d.DASHES_SQUARE,Round:d.DASHES_ROUND,Diamond:d.DASHES_DIAMOND},p=Object.keys(m).reduce(((e,t)=>{const i=t;return e[m[i]]=i,e}),{}),f=`\nprecision highp float;\nprecision highp int;\n\nuniform vec4 diffuseColor;\nuniform float opacity;\nuniform float extrusionWidth;\nuniform vec2 tileSize;\nuniform vec2 drawRange;\n\n#ifdef USE_DASH_IMAGE\n    uniform sampler2D dashImage;\n#endif\n\n#ifdef USE_DASHED_LINE\n    uniform float dashSize;\n    uniform float gapSize;\n    uniform vec4 dashColor;\n\n    #define DASHES_SQUARE ${d.DASHES_SQUARE}\n    #define DASHES_ROUND ${d.DASHES_ROUND}\n    #define DASHES_DIAMOND ${d.DASHES_DIAMOND}\n#endif\n\n#ifdef USE_TILE_CLIP\n    varying vec3 vPosition;\n#endif\n\nvarying vec3 vRange;\nvarying vec4 vCoords;\nvarying vec2 vAAGradient;\nvarying vec3 vExtrusionNormal;\n\n#ifdef USE_COLOR\n    varying vec3 vColor;\n#endif\n\n#define CAPS_NONE ${c.CAPS_NONE}\n#define CAPS_SQUARE ${c.CAPS_SQUARE}\n#define CAPS_ROUND ${c.CAPS_ROUND}\n#define CAPS_TRIANGLE_IN ${c.CAPS_TRIANGLE_IN}\n#define CAPS_TRIANGLE_OUT ${c.CAPS_TRIANGLE_OUT}\n\nfloat roundEdgesAndAddCaps(in vec4 coords, in vec3 range) {\n    // Compute the line's width to length ratio.\n    float widthRatio = range.y / range.x;\n\n    // Compute the inner segment distance (same for all cap mode).\n    float dist = abs(coords.y);\n    float segmentBeginMask = clamp(ceil(coords.z - coords.x), 0.0, 1.0);\n    float segmentEndMask = clamp(ceil(coords.x - coords.w), 0.0, 1.0);\n    dist = max(dist, segmentBeginMask * length(vec2((coords.x - coords.z) / widthRatio, coords.y)));\n    dist = max(dist, segmentEndMask * length(vec2((coords.x - coords.w) / widthRatio, coords.y)));\n\n    #if CAPS_MODE != CAPS_ROUND\n    // Compute the caps mask.\n    float capRangeMask = clamp(1.0 - ceil(range.z - drawRange.y), 0.0, 1.0);\n    float beginCapMask = clamp(ceil(drawRange.x - coords.x), 0.0, 1.0);\n    float endCapMask = clamp(ceil(coords.x - drawRange.y), 0.0, 1.0);\n    float capMask = capRangeMask * max(beginCapMask, endCapMask);\n\n    // Compute the outer segment distance (specific for each cap mode).\n    float capDist = max(coords.x - drawRange.y, drawRange.x - coords.x) / widthRatio;\n    #if CAPS_MODE == CAPS_NONE\n    dist = mix(dist, max(abs(coords.y), (capDist + 0.1) / 0.1), capMask);\n    #elif CAPS_MODE == CAPS_SQUARE\n    dist = mix(dist, max(abs(coords.y), capDist), capMask);\n    #elif CAPS_MODE == CAPS_TRIANGLE_OUT\n    dist = mix(dist, abs(coords.y) + capDist, capMask);\n    #elif CAPS_MODE == CAPS_TRIANGLE_IN\n    dist = mix(dist, max(abs(coords.y), (capDist - abs(coords.y)) + capDist), capMask);\n    #endif\n    #endif // CAPS_MODE != CAPS_ROUND\n\n    return dist;\n}\n\n#ifdef USE_TILE_CLIP\n    void tileClip(vec2 tilePos, vec2 tileSize) {\n        if (tileSize.x > 0.0 && (tilePos.x < -tileSize.x / 2.0 || tilePos.x > tileSize.x / 2.0))\n            discard;\n        if (tileSize.y > 0.0 && (tilePos.y < -tileSize.y / 2.0 || tilePos.y > tileSize.y / 2.0))\n            discard;\n    }\n#endif\n\n#ifdef USE_FADING\n    #include <fading_pars_fragment>\n#endif\n\n#include <fog_pars_fragment>\n\n#ifdef USE_DASHED_LINE\nvec4 computeDashedLineColor(float distToCenter) {\n    vec4 outputColor;\n\n    // Compute the distance to the dash origin (0.0: dashOrigin, 1.0: dashEnd, (d+g)/d: gapEnd).\n    float d = dashSize / vRange.x;\n    float g = gapSize / vRange.x;\n    float dashOrigDist = mod(vCoords.x, d + g) / d;\n    // The resulting function is discontinuous at the start of a dash (dashOrigDist = 0), which causes a spike in the result\n    // of fwidth and artifacts in the interpolation. Transform it so that it reaches its maximum at the middle of a gap and\n    // goes down to 1.0 at the gap end.\n    float gapCenter = 1.0 + 0.5 * g / d;\n    dashOrigDist = gapCenter - abs(dashOrigDist - gapCenter);\n\n    // Compute distance to dash edge (0.5: dashCenter, 0.0: dashEdge).\n    float dashEdgeDist = 0.5 - abs(dashOrigDist - 0.5);\n\n    #if DASHES_MODE == DASHES_ROUND\n        dashEdgeDist = 0.5 - distance(vec2(distToCenter * 0.5, dashEdgeDist), vec2(0.0, 0.5));\n    #elif DASHES_MODE == DASHES_DIAMOND\n        dashEdgeDist -= distToCenter * 0.5;\n    #endif\n\n    // Blend dash and gap colors using hermitian interpolation (smoothstep) on the interval\n    // [-dashWidth, dashWidth], with 'dashWidth' being the sum of the slope of dashEdgeDist on x and y (fwidth).\n    // That means 'dashWidth' is the dashEdgeDist function delta across 1 pixel, and hence the interpolation interval\n    // is 2 pixels wide and centered on 0 (dash start).\n    float dashWidth = fwidth(dashEdgeDist);\n    float dashBlendFactor = smoothstep(-dashWidth, dashWidth, dashEdgeDist);\n\n    #ifdef USE_DASH_IMAGE\n        // Dash texture is mapped to the full dash size. Use dashOrigDist as u coordinate (parallel to line segment).\n        // For v coordinate (perpendicular to line), transform vCoords.y (0.0 at line center, +/-1 at edges) to make them 0\n        // at one edge, 1 at the other and 0.5 at the line center.\n        vec2 texCoords = vec2(dashOrigDist, 0.5 + vCoords.y / 2.0);\n        float textureAlpha = texture2D(dashImage, texCoords).a;\n\n        // For a dash image, dash color's alpha is used as interpolation factor. For a transparent dash color, the dash\n        // becomes invisible, and the base (diffuse) color is drawn instead.\n        outputColor = mix(diffuseColor, vec4(dashColor.rgb,1.0), textureAlpha * dashColor.a * dashBlendFactor);\n    #else\n        // When a dash texture is not used, dash color's alpha is blended as the other channels with the base color. The base color\n        // won't be visible through transparent dashes. Instead, the resulting color depends on the material's blending configuration.\n        // (typically, materials drawn underneath will be visible).\n\n        // First alpha is interpolated.\n        outputColor.a = mix(diffuseColor.a, dashColor.a, dashBlendFactor);\n\n        // Then color channels are premultiplied with the alpha channels, interpolated and finally divided by the interpolated alpha.\n        // This keeps colors with low opacity from bleeding into the other color as the opacity increases.\n        outputColor.rgb = mix(diffuseColor.rgb * diffuseColor.a, dashColor.rgb * dashColor.a, dashBlendFactor) / outputColor.a;\n    #endif\n\n    return outputColor;\n}\n#endif\n\nvoid main() {\n    float alpha = opacity * diffuseColor.a;\n    vec4 outputDiffuse = diffuseColor;\n\n    #ifdef USE_TILE_CLIP\n        tileClip(vPosition.xy, tileSize);\n    #endif\n\n    // Calculate distance to center (0.0: lineCenter, 1.0: lineEdge).\n    float distToCenter = roundEdgesAndAddCaps(vCoords, vRange);\n\n    float s = 0.0;\n    if (vAAGradient.x < vAAGradient.y) {\n        s = smoothstep(vAAGradient.x, vAAGradient.y, distToCenter);\n    }\n\n    // Drop the fully transparent pixel. It prevents writing to the stencil buffer.\n    // Without this discard we will see line cap overlaps on semi-transparent roads.\n    if (s == 1.0) {\n        discard;\n    }\n\n    // Alpha channel in diffuseColor is applied later once it's interpolated with dash color's alpha.\n    alpha = opacity * (1.0 - s);\n\n    #ifdef USE_DASHED_LINE\n        outputDiffuse = computeDashedLineColor(distToCenter);\n    #endif\n\n    #ifdef USE_COLOR\n        outputDiffuse.rgb *= vColor;\n    #endif\n\n    gl_FragColor = vec4( outputDiffuse.rgb, outputDiffuse.a * alpha );\n\n    #include <fog_fragment>\n\n    #ifdef USE_FADING\n        #include <fading_fragment>\n    #endif\n}`;class g extends a.RawShaderMaterial{constructor(e){var t,i,a,h;o.FadingFeature.patchGlobalShaderChunks();const u={CAPS_MODE:c.CAPS_ROUND,DASHES_MODE:d.DASHES_SQUARE};let m,p,v=!0,y=1;e&&(v=!0===e.fog,v&&(0,l.setShaderDefine)(u,"USE_FOG",!0),y=void 0!==e.opacity?e.opacity:y,m=e.displacementMap,void 0!==m&&(0,l.setShaderDefine)(u,"USE_DISPLACEMENTMAP",!0),e["dash-image"]&&(0,l.setShaderDefine)(u,"USE_DASH_IMAGE",!0),p={name:"SolidLineMaterial",vertexShader:'\n#define SEGMENT_OFFSET 0.1\n// The minimum pixel distance prevents huge overscale values. This avoids very blurry lines in\n// extreme perspectives when multiplied with other variables and interpolated across a long line\n// segment that intersects the near plane. Clamping to this minimum distance also allows to always\n// apply the overscale and thus avoid sudden line width "jumps". See HARP-13527 for details.\n#define MIN_DISTANCE 0.1\n\n// over-extrusion width on each side (twice in total).\n#define OVER_EXTRUSION_WIDTH_PIXELS 1.0\n\nattribute vec3 extrusionCoord;\nattribute vec3 position;\nattribute vec4 biTangent;\nattribute vec3 tangent;\nattribute vec2 uv;\nattribute vec3 normal;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float extrusionWidth;\nuniform float offset;\nuniform vec2 drawRange;\nuniform vec2 canvasSize;\n\n#ifdef USE_DISPLACEMENTMAP\n    uniform sampler2D displacementMap;\n#endif\n\n#ifdef USE_TILE_CLIP\n    varying vec3 vPosition;\n#endif\n\nvarying vec3 vRange;\nvarying vec4 vCoords;\nvarying vec2 vAAGradient;\n\n#ifdef USE_COLOR\n    attribute vec3 color;\n    varying vec3 vColor;\n#endif\n\n#ifdef USE_FADING\n    #include <fading_pars_vertex>\n#endif\n\n#include <fog_pars_vertex>\n\nvec3 computeExtrusionDirWorld(in float extrusionWidth, in vec2 extrusionSign, in vec4 bitangent, in vec3 tangent) {\n    // Angle between this segment and the previous one.\n    float angle = bitangent.w;\n    vec3 bitangentComponent = extrusionSign.y * extrusionWidth * bitangent.xyz / cos(angle / 2.0);\n    // Extrusion component on the tangent direction to cover line caps.\n    vec3 tangentComponent = extrusionSign.x * extrusionWidth * tangent;\n\n    // Add tangent component only if angle with previous segment is 0, which happens with vertices at line ends (where caps are needed)\n    // or in straight segments (where caps won\'t be visible).\n    return bitangentComponent + (1.0 - abs(sign(angle))) * tangentComponent;\n}\n\nvec2 computeExtrudedPosLocal(in float linePosition, in float extrusionWidth, in vec2 extrusionSign, in float tanHalfAngle) {\n    // For straight segments and line ends (angle and tanHalfAngle are 0), extrude position forwards (extrusionSign.x positive, for\n    // end caps) or backwards (extrusionSign.x negative, for start caps) by the extrusion width.\n    // For segments at an angle, position must be extruded further by a factor of extrusionSign.y*tanHalfAngle.\n    return vec2(linePosition + extrusionSign.x * extrusionWidth * (1.0 + abs(sign(tanHalfAngle)) * (extrusionSign.y * tanHalfAngle - 1.0)),\n                extrusionSign.y * extrusionWidth);\n}\n\nvec3 transformToScreen(vec3 worldPosition) {\n    vec4 clip = projectionMatrix * modelViewMatrix * vec4(worldPosition,1.0);\n    vec3 ndc = clip.xyz / clip.w;\n    vec3 screen = ndc * 0.5 + 0.5;\n    screen.xy *= canvasSize;\n    return screen;\n}\n\nvoid main() {\n    // Calculate the segment.\n    vec2 segment = abs(extrusionCoord.xy) - SEGMENT_OFFSET;\n    float segmentPos = sign(extrusionCoord.x) / 2.0 + 0.5;\n\n    // Calculate the vertex position inside the line (segment).\n    float linePos = mix(segment.x, segment.y, segmentPos);\n    vec2 extrusionSign = sign(extrusionCoord.xy);\n    // Precompute to avoid computing multiple times\n    float tanHalfAngle = tan(biTangent.w / 2.0);\n    float extrusionFactor = extrusionSign.y * tanHalfAngle;\n\n    vec3 extrusionDirWorld = computeExtrusionDirWorld(extrusionWidth, extrusionSign, biTangent, tangent);\n\n    vec3 extrudedPosWorld = position + extrusionDirWorld;\n    vec3 centerPosScreen = transformToScreen(position);\n    vec3 extrudedPosScreen = transformToScreen(extrudedPosWorld);\n    float distanceScreen = max(MIN_DISTANCE, distance(extrudedPosScreen.xy, centerPosScreen.xy));\n\n    float overscale = (distanceScreen + OVER_EXTRUSION_WIDTH_PIXELS) / distanceScreen;\n    extrusionDirWorld *= overscale;\n    extrudedPosWorld = position + extrusionDirWorld;\n\n\n    float totalExtrusionWidth = extrusionWidth*overscale;\n    float aaGradientHalfWidth = totalExtrusionWidth - extrusionWidth;\n    vAAGradient.x = max(0.0, (extrusionWidth - aaGradientHalfWidth)/ totalExtrusionWidth);\n    vAAGradient.y = 1.0;\n    vec2 extrudedPosLocal = computeExtrudedPosLocal(linePos, totalExtrusionWidth, extrusionSign, tanHalfAngle);\n\n    // Store the normalized extrusion coordinates in vCoords (with their ranges in vRange).\n    vRange = vec3(extrusionCoord.z, totalExtrusionWidth, extrusionFactor);\n    vCoords = vec4(extrudedPosLocal / vRange.xy, segment / vRange.x);\n\n    // Adjust the segment to fit the drawRange.\n    float capDist = totalExtrusionWidth / extrusionCoord.z;\n    if ((vCoords.w + capDist) < drawRange.x || (vCoords.z - capDist) > drawRange.y) {\n        vCoords.zw += 1.0;\n    }\n    if (vCoords.z < drawRange.x) {\n        vCoords.zw += vec2(drawRange.x - vCoords.z, 0.0);\n    }\n    if (vCoords.w > drawRange.y) {\n        vCoords.zw -= vec2(0.0, vCoords.w - drawRange.y);\n    }\n\n    // Transform position.\n    #ifdef USE_DISPLACEMENTMAP\n        extrudedPosWorld += normalize( normal ) * texture2D( displacementMap, uv ).x;\n    #endif\n\n    // Shift the line based on the offset, where the bitangent is the cross product of the average\n    // of the two direction vectors (the previous and next segment directions) and the normal of\n    // the line (facing into the sky). The w component is the angle between the two segments.\n    // Note, we need to take the angle into consideration, so we use trigonometry to calculate how\n    // much we need to extend the offset. Note, orthough this looks complicated we are doing this\n    // in the vertex shader, so it should not cause a performance issue.\n    extrudedPosWorld += biTangent.xyz * offset * sqrt(1.0 + pow(abs(tanHalfAngle), 2.0));\n\n    vec4 mvPosition = modelViewMatrix * vec4(extrudedPosWorld, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Pass extruded position to fragment shader.\n    #ifdef USE_TILE_CLIP\n        vPosition = extrudedPosWorld;\n    #endif\n\n    #ifdef USE_COLOR\n        // Pass vertex color to fragment shader.\n        vColor = color;\n    #endif\n\n    #ifdef USE_FADING\n        #include <fading_vertex>\n    #endif\n\n    #include <fog_vertex>\n}',fragmentShader:f,uniforms:n.UniformsUtils.merge([{diffuseColor:new n.Uniform(g.DEFAULT_COLOR.clone()),dashColor:new n.Uniform(g.DEFAULT_DASH_COLOR.clone()),extrusionWidth:new n.Uniform(g.DEFAULT_WIDTH),offset:new n.Uniform(g.DEFAULT_OFFSET),opacity:new n.Uniform(g.DEFAULT_OPACITY),tileSize:new n.Uniform(new n.Vector2),fadeNear:new n.Uniform(o.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new n.Uniform(o.FadingFeature.DEFAULT_FADE_FAR),displacementMap:new n.Uniform(void 0!==m?m:new n.Texture),drawRange:new n.Uniform(new n.Vector2(g.DEFAULT_DRAW_RANGE_START,g.DEFAULT_DRAW_RANGE_END)),dashSize:new n.Uniform(g.DEFAULT_DASH_SIZE),gapSize:new n.Uniform(g.DEFAULT_GAP_SIZE),dashImage:new n.Uniform(null!==(t=e["dash-image"])&&void 0!==t?t:new n.Texture),canvasSize:new n.Uniform(new n.Vector2)},n.UniformsLib.fog]),defines:u,fog:v,opacity:y,rendererCapabilities:e.rendererCapabilities}),super(p),this.m_color=(new s.RGBA).fromVector(g.DEFAULT_COLOR),this.m_dashColor=(new s.RGBA).fromVector(g.DEFAULT_DASH_COLOR),this.fog=v,this.setOpacity(y),this.stencilFunc=n.NotEqualStencilFunc,this.stencilZPass=n.ReplaceStencilOp,this.stencilRef=1,this.stencilWrite=!1,(0,l.enforceBlending)(this),this.extensions.derivatives=!0,e&&(void 0!==e.color&&(this.color="number"==typeof e.color?r.ColorUtils.getRgbaFromHex(e.color):null!==(i=s.RGBA.parse(e.color))&&void 0!==i?i:this.m_color),void 0!==e.lineWidth&&(this.lineWidth=e.lineWidth),void 0!==e.opacity&&this.setOpacity(e.opacity),void 0!==e.depthTest&&(this.depthTest=e.depthTest),void 0!==e.depthWrite&&(this.depthWrite=e.depthWrite),void 0!==e.fadeNear&&(this.fadeNear=e.fadeNear),void 0!==e.fadeFar&&(this.fadeFar=e.fadeFar),void 0!==e.displacementMap&&(this.displacementMap=e.displacementMap),void 0!==e.caps&&(this.caps=e.caps),void 0!==e.drawRangeStart&&(this.drawRangeStart=e.drawRangeStart),void 0!==e.drawRangeEnd&&(this.drawRangeEnd=e.drawRangeEnd),void 0!==e.dashes&&(this.dashes=e.dashes),void 0!==e.dashColor&&(this.dashColor="number"==typeof e.dashColor?r.ColorUtils.getRgbaFromHex(e.dashColor):null!==(a=s.RGBA.parse(e.dashColor))&&void 0!==a?a:this.m_dashColor),void 0!==e.dashSize&&(this.dashSize=e.dashSize),void 0!==e.gapSize&&(this.gapSize=e.gapSize),void 0!==e.fog&&(this.fog=e.fog,this.invalidateFog()),this.offset=null!==(h=e.offset)&&void 0!==h?h:0)}set offset(e){this.uniforms.offset.value=e}get offset(){return this.uniforms.offset.value}setOpacity(e){super.setOpacity(e),void 0!==e&&this.updateStencil()}get color(){return this.m_color}set color(e){this.m_color.copy(e).toVector(this.uniforms.diffuseColor.value),this.updateStencil()}get dashColor(){return this.m_dashColor}set dashColor(e){this.m_dashColor.copy(e).toVector(this.uniforms.dashColor.value)}get lineWidth(){return 2*this.uniforms.extrusionWidth.value}set lineWidth(e){this.uniforms.extrusionWidth.value=e/2}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get"dash-image"(){return this.uniforms.dashImage.value}set"dash-image"(e){this.uniforms.dashImage.value=e,(0,l.setShaderMaterialDefine)(this,"USE_DASH_IMAGE",!0)}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){var t,i;this.uniforms.gapSize.value=e,(0,l.setShaderMaterialDefine)(this,"USE_DASHED_LINE",e>0),0===(null===(i=null===(t=this.uniforms)||void 0===t?void 0:t.gapSize)||void 0===i?void 0:i.value)&&this.updateStencil()}get caps(){let e="Round";const t=(0,l.getShaderMaterialDefine)(this,"CAPS_MODE");return"number"==typeof t&&u.hasOwnProperty(t)&&(e=u[t]),e}set caps(e){h.hasOwnProperty(e)&&(0,l.setShaderMaterialDefine)(this,"CAPS_MODE",h[e])}get dashes(){let e="Square";const t=(0,l.getShaderMaterialDefine)(this,"DASHES_MODE");return"number"==typeof t&&p.hasOwnProperty(t)&&(e=p[t]),e}set dashes(e){m.hasOwnProperty(e)&&(0,l.setShaderMaterialDefine)(this,"DASHES_MODE",m[e])}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){this.uniforms.fadeFar.value=e,(0,l.setShaderMaterialDefine)(this,"USE_FADING",e>0)}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){if(this.uniforms.displacementMap.value===e)return;this.uniforms.displacementMap.value=e;const t=null!==e;t&&(this.uniforms.displacementMap.value.needsUpdate=!0),(0,l.setShaderMaterialDefine)(this,"USE_DISPLACEMENTMAP",t)}get drawRangeStart(){return this.uniforms.drawRange.value.x}set drawRangeStart(e){this.uniforms.drawRange.value.x=e}get drawRangeEnd(){return this.uniforms.drawRange.value.y}set drawRangeEnd(e){this.uniforms.drawRange.value.y=e}set clipTileSize(e){this.uniforms.tileSize.value.copy(e);const t=e.x>0&&e.y>0;(0,l.setShaderMaterialDefine)(this,"USE_TILE_CLIP",t)}get clipTileSize(){return this.uniforms.tileSize.value}set canvasSize(e){this.uniforms.canvasSize.value.copy(e)}get canvasSize(){return this.uniforms.canvasSize.value}copy(e){return super.copy(e),this.invalidateFog(),this.setOpacity(e.opacity),this}updateStencil(){var e,t;this.stencilWrite=this.opacity*(null!==(t=null===(e=this.color)||void 0===e?void 0:e.a)&&void 0!==t?t:1)<.98}}t.SolidLineMaterial=g,g.DEFAULT_COLOR=new n.Vector4(1,0,0,1),g.DEFAULT_DASH_COLOR=new n.Vector4(1,0,0,0),g.DEFAULT_WIDTH=1,g.DEFAULT_OPACITY=1,g.DEFAULT_DRAW_RANGE_START=0,g.DEFAULT_DRAW_RANGE_END=1,g.DEFAULT_DASH_SIZE=1,g.DEFAULT_GAP_SIZE=1,g.DEFAULT_OFFSET=0},8578:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getShaderDefine=t.setShaderDefine=t.getShaderMaterialDefine=t.setShaderMaterialDefine=t.disableBlending=t.enableBlending=t.enforceBlending=t.insertShaderInclude=t.DEFINE_BOOL_FALSE=t.DEFINE_BOOL_TRUE=void 0;const n=i(82),r=i(4342);function s(e){!0!==e.transparent&&!0!==e.forcedBlending&&(e.blending=n.CustomBlending,!0===e.premultipliedAlpha?(e.blendSrc=n.OneFactor,e.blendDst=n.OneMinusSrcAlphaFactor,e.blendSrcAlpha=n.OneFactor,e.blendDstAlpha=n.OneMinusSrcAlphaFactor):(e.blendSrc=n.SrcAlphaFactor,e.blendDst=n.OneMinusSrcAlphaFactor,e.blendSrcAlpha=n.OneFactor,e.blendDstAlpha=n.OneMinusSrcAlphaFactor))}function o(e,t,i=!1){return void 0===e.defines?i:l(e.defines,t)}function a(e,i,n){let r=!1;return"number"==typeof n?(r=e[i]!==n,e[i]=n):!0===n?(r=e[i]!==t.DEFINE_BOOL_TRUE,e[i]=t.DEFINE_BOOL_TRUE):!1===n&&void 0!==e[i]&&(delete e[i],r=!0),r}function l(e,i){const n=e[i];return n!==t.DEFINE_BOOL_FALSE&&(n===t.DEFINE_BOOL_TRUE||n)}t.DEFINE_BOOL_TRUE="",t.DEFINE_BOOL_FALSE=void 0,t.insertShaderInclude=function(e,t,i,n){const r=!0===n?"\t":"";return e.replace(`#include <${t}>`,`#include <${t}>\n${r}#include <${i}>`)},t.enforceBlending=function(e){e.transparent||(s(e),e.forcedBlending=!0)},t.enableBlending=s,t.disableBlending=function(e){!0!==e.transparent&&!0!==e.forcedBlending&&(e.blending=n.NormalBlending)},t.setShaderMaterialDefine=function(e,t,i){(0,r.assert)(void 0!==e.defines,"Do not use this function in ShaderMaterial derived c-tor.");const n=i!==o(e,t);return!!n&&(a(e.defines,t,i),e.needsUpdate=n,!0)},t.getShaderMaterialDefine=o,t.setShaderDefine=a,t.getShaderDefine=l},5562:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.needsCanvasSize=void 0,t.needsCanvasSize=function(e){return"canvasSize"in e}},4744:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasColorCorrectionFeature=t.ColorCorrectionFeature=void 0;const n=i(4342),r=i(71),s=i(4030),o=i(8578),a=i(82);!function(e){function t(e){return void 0!==e.gamma||void 0!==e.brightness}e.DEFAULT_GAMMA=1,e.DEFAULT_BRIGHTNESS=1,e.isEnabled=t,e.patchGlobalShaderChunks=function(){void 0===a.ShaderChunk.color_correction_parts_fragment&&Object.assign(a.ShaderChunk,s.default)},e.updateColorCorrectionFeature=function(i){(0,n.assert)(void 0!==i.shaderDefines),(0,n.assert)(void 0!==i.shaderUniforms);const r=t(i),s=(0,o.setShaderDefine)(i.shaderDefines,"USE_COLOR_CORRECTION",r);i.needsUpdate=s,(0,n.assert)(void 0!==i.shaderUniforms.u_gamma),(0,n.assert)(void 0!==i.shaderUniforms.u_brightness),r?(i.shaderUniforms.u_gamma.value=i.gamma>0?i.gamma:0,i.shaderUniforms.u_brightness.value=a.MathUtils.clamp(i.brightness,0,1)):s&&(i.shaderUniforms.u_gamma.value=e.DEFAULT_GAMMA,i.shaderUniforms.u_brightness.value=e.DEFAULT_BRIGHTNESS)},e.onBeforeCompile=function(e,i){t(e)&&((0,n.assert)(void 0!==e.shaderUniforms),(0,r.linkMixinWithShader)(e,i),i.fragmentShader=(0,o.insertShaderInclude)(i.fragmentShader,"common","color_correction_parts_fragment"),i.fragmentShader=(0,o.insertShaderInclude)(i.fragmentShader,"color_fragment","color_correction_fragment",!0))}}(t.ColorCorrectionFeature||(t.ColorCorrectionFeature={})),t.hasColorCorrectionFeature=function(e){return"brightness"in e&&"gamma"in e}},8583:(e,t)=>{"use strict";function i(e){return"displacementMap"in e}Object.defineProperty(t,"__esModule",{value:!0}),t.setDisplacementMapToMaterial=t.hasDisplacementFeature=void 0,t.hasDisplacementFeature=i,t.setDisplacementMapToMaterial=function(e,t){i(t)&&t.displacementMap!==e&&(t.displacementMap=e,t.needsUpdate=!0,null!==t.displacementMap&&(t.displacementMap.needsUpdate=!0))}},8014:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtrusionFeature=t.hasExtrusionFeature=void 0;const n=i(82),r=i(4342),s=i(71),o=i(4305),a=i(8578),l=i(8955);t.hasExtrusionFeature=function(e){return"extrusionRatio"in e},function(e){function t(e){return void 0!==e.extrusionRatio&&e.extrusionRatio>=l.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN}e.isEnabled=t,e.patchGlobalShaderChunks=function(){void 0===n.ShaderChunk.extrusion_pars_vertex&&Object.assign(n.ShaderChunk,o.default)},e.updateExtrusionFeature=function(e){(0,r.assert)(void 0!==e.shaderDefines),(0,r.assert)(void 0!==e.shaderUniforms);const i=t(e),n=(0,a.setShaderDefine)(e.shaderDefines,"EXTRUSION_MATERIAL",i);e.needsUpdate=n,i?e.shaderUniforms.extrusionRatio.value=e.extrusionRatio:n&&(e.shaderUniforms.extrusionRatio.value=l.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX)},e.onBeforeCompile=function(e,i){t(e)&&((0,r.assert)(void 0!==e.shaderUniforms),(0,s.linkMixinWithShader)(e,i),i.vertexShader=(0,a.insertShaderInclude)(i.vertexShader,"common","extrusion_pars_vertex"),i.vertexShader=(0,a.insertShaderInclude)(i.vertexShader,"begin_vertex","extrusion_vertex",!0),i.fragmentShader=(0,a.insertShaderInclude)(i.fragmentShader,"fog_pars_fragment","extrusion_pars_fragment"),i.fragmentShader=i.fragmentShader.replace("#include <normal_fragment_begin>","#include <extrusion_normal_fragment_begin>"),i.fragmentShader=(0,a.insertShaderInclude)(i.fragmentShader,"fog_fragment","extrusion_fragment",!0))}}(t.ExtrusionFeature||(t.ExtrusionFeature={}))},8955:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ExtrusionFeatureDefs=void 0,(i=t.ExtrusionFeatureDefs||(t.ExtrusionFeatureDefs={})).DEFAULT_RATIO_MIN=0,i.DEFAULT_RATIO_MAX=1,i.MIN_BUILDING_HEIGHT=.1},8177:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FadingFeature=void 0;const n=i(82),r=i(4342),s=i(71),o=i(3739),a=i(8578);!function(e){function t(e){return void 0!==e.fadeNear&&void 0!==e.fadeFar&&e.fadeFar>0}e.DEFAULT_FADE_NEAR=-1,e.DEFAULT_FADE_FAR=-1,e.isEnabled=t,e.isDefined=function(e){return void 0!==e.fadeNear&&void 0!==e.fadeFar},e.patchGlobalShaderChunks=function(){void 0===n.ShaderChunk.fading_pars_vertex&&Object.assign(n.ShaderChunk,o.default)},e.updateFadingFeature=function(i){(0,r.assert)(void 0!==i.shaderDefines),(0,r.assert)(void 0!==i.shaderUniforms);const n=t(i),s=(0,a.setShaderDefine)(i.shaderDefines,"FADING_MATERIAL",n);i.needsUpdate=s,(0,r.assert)(void 0!==i.shaderUniforms.fadeNear&&void 0!==i.shaderUniforms.fadeFar),n?(i.shaderUniforms.fadeNear.value=i.fadeNear,i.shaderUniforms.fadeFar.value=i.fadeFar,s&&(0,a.enableBlending)(i)):s&&(i.shaderUniforms.fadeNear.value=e.DEFAULT_FADE_NEAR,i.shaderUniforms.fadeFar.value=e.DEFAULT_FADE_FAR,(0,a.disableBlending)(i))},e.onBeforeCompile=function(e,i){t(e)&&((0,r.assert)(void 0!==e.shaderUniforms),(0,s.linkMixinWithShader)(e,i),i.vertexShader=(0,a.insertShaderInclude)(i.vertexShader,"fog_pars_vertex","fading_pars_vertex"),i.vertexShader=(0,a.insertShaderInclude)(i.vertexShader,"fog_vertex","fading_vertex",!0),i.fragmentShader=(0,a.insertShaderInclude)(i.fragmentShader,"fog_pars_fragment","fading_pars_fragment"),i.fragmentShader=(0,a.insertShaderInclude)(i.fragmentShader,"fog_fragment","fading_fragment",!0))},e.addRenderHelper=function(t,i,n,o,a,l){t.onBeforeRender=(0,r.chainCallbacks)(t.onBeforeRender,((t,r,a,c,h,u)=>{const d=h;d.fadeNear=void 0===n||n===e.DEFAULT_FADE_NEAR?e.DEFAULT_FADE_NEAR:(0,s.cameraToWorldDistance)(n,i),d.fadeFar=void 0===o||o===e.DEFAULT_FADE_FAR?e.DEFAULT_FADE_FAR:(0,s.cameraToWorldDistance)(o,i),void 0!==l&&l(t,h)}))}}(t.FadingFeature||(t.FadingFeature={}))},4258:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorCorrectionFeatureMixin=void 0;const n=i(4342),r=i(9276),s=i(71),o=i(82),a=i(4744);t.ColorCorrectionFeatureMixin=class{constructor(){this.m_brightness=a.ColorCorrectionFeature.DEFAULT_BRIGHTNESS,this.m_gamma=a.ColorCorrectionFeature.DEFAULT_GAMMA}getBrightness(){return this.m_brightness}setBrightness(e){e!==this.m_brightness&&(this.m_brightness=e,a.ColorCorrectionFeature.updateColorCorrectionFeature(this))}getGamma(){return this.m_gamma}setGamma(e){e!==this.m_gamma&&(this.m_gamma=e,a.ColorCorrectionFeature.updateColorCorrectionFeature(this))}addColorCorrectionProperties(){Object.defineProperty(this,"brightness",{get:()=>this.getBrightness(),set:e=>{this.setBrightness(e)}}),Object.defineProperty(this,"gamma",{get:()=>this.getGamma(),set:e=>{this.setGamma(e)}})}applyColorCorrectionParameters(e){(0,s.linkMixinWithMaterial)(this,this),(0,n.assert)(void 0!==this.shaderDefines),(0,n.assert)(void 0!==this.shaderUniforms),this.shaderUniforms.u_gamma=new o.Uniform(a.ColorCorrectionFeature.DEFAULT_GAMMA),this.shaderUniforms.u_brightness=new o.Uniform(a.ColorCorrectionFeature.DEFAULT_BRIGHTNESS),void 0!==e&&(void 0!==e.brightness&&this.setBrightness(e.brightness),void 0!==e.gamma&&this.setGamma(e.gamma)),this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{a.ColorCorrectionFeature.onBeforeCompile(this,e)})),this.needsUpdate=a.ColorCorrectionFeature.isEnabled(this)}copyColorCorrectionParameters(e){return this.setBrightness(void 0===e.brightness?a.ColorCorrectionFeature.DEFAULT_BRIGHTNESS:e.brightness),this.setGamma(void 0===e.gamma?a.ColorCorrectionFeature.DEFAULT_GAMMA:e.gamma),this}}},8878:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacementFeatureMixin=void 0;const n=i(82),r=i(4342),s=i(71),o=i(8578),a=new n.Texture;var l;!function(e){function t(e){return null!==e.displacementMap}e.isEnabled=t,e.updateDisplacementFeature=function(e){(0,r.assert)(void 0!==e.shaderDefines),(0,r.assert)(void 0!==e.shaderUniforms);const i=t(e),n=(0,o.setShaderDefine)(e.shaderDefines,"USE_DISPLACEMENTMAP",i);if(e.needsUpdate=n,i){const t=e.displacementMap;t.needsUpdate=!0,e.shaderUniforms.displacementMap.value=t}else n&&(e.shaderUniforms.displacementMap.value=a)},e.onBeforeCompile=function(e,i){t(e)&&((0,r.assert)(void 0!==e.shaderUniforms),(0,s.linkMixinWithShader)(e,i),i.vertexShader=i.vertexShader.replace("#include <skinbase_vertex>","#include <skinbase_vertex>\n#ifndef USE_ENVMAP\n    vec3 objectNormal = vec3( normal );\n#endif"),i.vertexShader=(0,o.insertShaderInclude)(i.vertexShader,"uv2_pars_vertex","displacementmap_pars_vertex"),i.vertexShader=(0,o.insertShaderInclude)(i.vertexShader,"skinning_vertex","displacementmap_vertex",!0))}}(l||(l={})),t.DisplacementFeatureMixin=class{constructor(){this.m_displacementMap=null}get displacementMap(){return this.m_displacementMap}set displacementMap(e){this.setDisplacementMap(e)}getDisplacementMap(){return this.m_displacementMap}setDisplacementMap(e){e!==this.m_displacementMap&&(this.m_displacementMap=e,l.updateDisplacementFeature(this))}addDisplacementProperties(){Object.defineProperty(this,"displacementMap",{get:()=>this.getDisplacementMap(),set:e=>{this.setDisplacementMap(e)}})}applyDisplacementParameters(e){(0,s.linkMixinWithMaterial)(this,this),(0,r.assert)(void 0!==this.shaderDefines),(0,r.assert)(void 0!==this.shaderUniforms);const t=this.shaderUniforms;t.displacementMap=new n.Uniform(a),t.displacementScale=new n.Uniform(1),t.displacementBias=new n.Uniform(0),void 0!==e&&void 0!==e.displacementMap&&this.setDisplacementMap(e.displacementMap),this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{l.onBeforeCompile(this,e)})),this.needsUpdate=l.isEnabled(this)}copyDisplacementParameters(e){return this.setDisplacementMap(e.displacementMap),this}}},5997:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtrusionFeatureMixin=void 0;const n=i(82),r=i(4342),s=i(8014),o=i(8955),a=i(71);t.ExtrusionFeatureMixin=class{constructor(){this.m_extrusion=o.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}getExtrusionRatio(){return this.m_extrusion}setExtrusionRatio(e){e!==this.m_extrusion&&(this.m_extrusion=e,s.ExtrusionFeature.updateExtrusionFeature(this))}addExtrusionProperties(){Object.defineProperty(this,"extrusionRatio",{get:()=>this.getExtrusionRatio(),set:e=>{this.setExtrusionRatio(e)}})}applyExtrusionParameters(e){(0,a.linkMixinWithMaterial)(this,this),(0,r.assert)(void 0!==this.shaderDefines),(0,r.assert)(void 0!==this.shaderUniforms),e&&!0===e.zFightingWorkaround&&(this.shaderDefines.ZFIGHTING_WORKAROUND=""),this.shaderUniforms.extrusionRatio=new n.Uniform(o.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX),void 0!==e&&void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{s.ExtrusionFeature.onBeforeCompile(this,e)})),this.needsUpdate=s.ExtrusionFeature.isEnabled(this)}copyExtrusionParameters(e){return void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this}}},674:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FadingFeatureMixin=void 0;const n=i(82),r=i(4342),s=i(8177),o=i(71);t.FadingFeatureMixin=class{constructor(){this.m_fadeNear=s.FadingFeature.DEFAULT_FADE_NEAR,this.m_fadeFar=s.FadingFeature.DEFAULT_FADE_FAR}getFadeNear(){return this.m_fadeNear}setFadeNear(e){e!==this.m_fadeNear&&(this.m_fadeNear=e,s.FadingFeature.updateFadingFeature(this))}getFadeFar(){return this.m_fadeFar}setFadeFar(e){e!==this.m_fadeFar&&(this.m_fadeFar=e,s.FadingFeature.updateFadingFeature(this))}addFadingProperties(){Object.defineProperty(this,"fadeNear",{get:()=>this.getFadeNear(),set:e=>{this.setFadeNear(e)}}),Object.defineProperty(this,"fadeFar",{get:()=>this.getFadeFar(),set:e=>{this.setFadeFar(e)}})}applyFadingParameters(e){(0,o.linkMixinWithMaterial)(this,this),(0,r.assert)(void 0!==this.shaderDefines),(0,r.assert)(void 0!==this.shaderUniforms),this.shaderUniforms.fadeNear=new n.Uniform(s.FadingFeature.DEFAULT_FADE_NEAR),this.shaderUniforms.fadeFar=new n.Uniform(s.FadingFeature.DEFAULT_FADE_FAR),void 0!==e&&(void 0!==e.fadeNear&&this.setFadeNear(e.fadeNear),void 0!==e.fadeFar&&this.setFadeFar(e.fadeFar)),this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{s.FadingFeature.onBeforeCompile(this,e)})),this.needsUpdate=s.FadingFeature.isEnabled(this)}copyFadingParameters(e){return this.setFadeNear(void 0===e.fadeNear?s.FadingFeature.DEFAULT_FADE_NEAR:e.fadeNear),this.setFadeFar(void 0===e.fadeFar?s.FadingFeature.DEFAULT_FADE_FAR:e.fadeFar),this}}},1870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={atmosphere_vertex_utils:"\n\n    const float RayleighScaleDepth = 0.25;\n\n    struct AtmosphereColor\n    {\n        vec3 mie;\n        vec3 rayleigh;\n    };\n\n    float scale(float cosAngle)\n    {\n        float x = 1.0 - cosAngle;\n        return RayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n    }\n\n    float getNearSphereIntersect(vec3 v3Pos, vec3 v3Ray, float fCameraHeight2, float fOuterRadius2) {\n        // Solve simple square equation for the x0 (first point of intersection).\n#if defined(IMPROVE_INTERSECT_PRECISION)\n        // To improve precision instead of simple projection: b = 2.0 * dot(vPos, v3Ray),\n        // we change the equation that gives better results especially around the poles.\n        float fB = 2.0 * length(v3Pos) * dot(normalize(v3Pos), v3Ray);\n#else\n        float fB = 2.0 * dot(v3Pos, v3Ray);\n#endif\n        float fC = fCameraHeight2 - fOuterRadius2;\n        // det = b^2 - 4*a*c, where a = 1\n        float fDet = max(0.0, fB * fB - 4.0 * fC);\n        // Intersection points distances are defined as follows:\n        // x0 = (-b - sqrt(det)) / 2*a ^ x1 = (-b + sqrt(det)) / 2*a\n        // we search for x0:\n        return 0.5 * (-fB - sqrt(fDet));\n    }\n\n    float getFarSphereIntersect(vec3 v3Pos, vec3 v3Ray, float fCameraHeight2, float fOuterRadius2) {\n        // Solve simple square equation for the x1 (second point of intersection).\n#if defined(IMPROVE_INTERSECT_PRECISION)\n        float fB = 2.0 * length(v3Pos) * dot(normalize(v3Pos), v3Ray);\n#else\n        float fB = 2.0 * dot(v3Pos, v3Ray);\n#endif\n        float fC = fCameraHeight2 - fOuterRadius2;\n        // det = b^2 - 4*a*c, where a = 1\n        float fDet = max(0.0, fB * fB - 4.0 * fC);\n        // Compute second intersection distance:\n        // x1 = (-b + sqrt(det)) / 2*a\n        return 0.5 * (-fB + sqrt(fDet));\n    }\n    ",atmosphere_fragment_utils:"\n\n    // Branch free RGB to HSV conversion.\n    // Based on article:\n    // http://lolengine.net/blog/2013/01/13/fast-rgb-to-hsv\n    // and optimized OpenGL SL algorithm\n    // http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-glsl\n    vec3 rgb2Hsv(vec3 c)\n    {\n        const vec4 RGB_HSV_CONV = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        // Ternary operator may be used explicitly if compiler can use fast conditional move.\n        // vec4 p = c.g < c.b ? vec4(c.bg, RGB_HSV_CONV.wz) : vec4(c.gb, RGB_HSV_CONV.xy);\n        vec4 p = mix(vec4(c.bg, RGB_HSV_CONV.wz), vec4(c.gb, RGB_HSV_CONV.xy), step(c.b, c.g));\n        // vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n        vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n    }\n\n    // Branch free HSV to RGB conversion\n    vec3 hsv2Rgb(vec3 c)\n    {\n        const vec4 HSV_RGB_CONV = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + HSV_RGB_CONV.xyz) * 6.0 - HSV_RGB_CONV.www);\n        return c.z * mix(HSV_RGB_CONV.xxx, clamp(p - HSV_RGB_CONV.xxx, 0.0, 1.0), c.y);\n    }\n\n    vec3 correctExposure(vec3 rgb, float exposure)\n    {\n        const vec3 fullColor = vec3(1.0);\n        return fullColor - exp(-exposure * rgb);\n    }\n\n    vec3 correctColor(vec3 rgb, vec3 hsvShift)\n    {\n        const float e = 0.0000001;\n        // Convert rgb color to hsv\n        vec3 hsv = rgb2Hsv(rgb);\n        // Shift hue value with angle wrapping\n        hsv.x = mod(hsv.x + hsvShift.x, 1.0);\n        // Shift and clamp saturation\n        hsv.y = clamp(hsv.y + hsvShift.y, 0.0, 1.0);\n        // Change value if it is significant (greater then epsilon)\n        hsv.z = hsv.z > e ? clamp(hsv.z + hsvShift.z, 0.0, 1.0) : 0.0;\n        // Convert shifted hsv back to rgb\n        return hsv2Rgb(hsv);\n    }\n    "}},5089:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blinnPhongNoSpecular=void 0,t.blinnPhongNoSpecular="\nuniform float colorIntensity;\nvoid RE_Direct_BlinnPhong_NoSpecular( const in IncidentLight directLight,\n    const in GeometricContext geometry,\n    const in BlinnPhongMaterial material,\n    inout ReflectedLight reflectedLight ) {\n\n    float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n    vec3 irradiance = dotNL * directLight.color;\n\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\n\n        irradiance *= PI; // punctual light\n\n    #endif\n\n    reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor * colorIntensity);\n}\n#undef RE_Direct\n#define RE_Direct RE_Direct_BlinnPhong_NoSpecular\n"},4030:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={color_correction_parts_fragment:"\n        #ifdef USE_COLOR_CORRECTION\n            uniform float u_gamma;\n            uniform float u_brightness;\n        #endif\n    ",color_correction_fragment:"\n        #ifdef USE_COLOR_CORRECTION\n            diffuseColor = vec4( pow( diffuseColor.rgb, vec3( u_gamma ) ) * u_brightness, diffuseColor.a);\n        #endif\n    "}},4305:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(8955),r=n.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT*n.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT;t.default={extrusion_pars_vertex:"\n// Add define so we can check for it in the outline effect (see Outline.ts).\n#define HAS_EXTRUSION_PARS_VERTEX\n// Extrusion axis (xyz: vector, w: factor).\nattribute vec4 extrusionAxis;\nuniform float extrusionRatio;\n#ifdef FLAT_SHADED\nvarying vec4 vExtrusionAxis;\n#endif\n#ifdef ZFIGHTING_WORKAROUND\nvarying float vExtrusionRatio;\n#endif\n",extrusion_vertex:`\n#define HAS_EXTRUSION_VERTEX\n#ifdef ZFIGHTING_WORKAROUND\n// Cancel extrusionRatio (meaning, force to 1) if extrusionAxisLen < MIN_BUILDING_HEIGHT.\nconst float MIN_BUILDING_HEIGHT_SQUARED = ${r};\nfloat extrusionAxisLenSquared = dot(extrusionAxis.xyz, extrusionAxis.xyz);\nvExtrusionRatio = (extrusionAxisLenSquared < MIN_BUILDING_HEIGHT_SQUARED) ? 1.0 : extrusionRatio;\n#else\nfloat vExtrusionRatio = extrusionRatio;\n#endif\ntransformed = transformed + extrusionAxis.xyz * (vExtrusionRatio - 1.0);\n#ifdef FLAT_SHADED\nvExtrusionAxis = vec4(normalMatrix * extrusionAxis.xyz, extrusionAxis.w);\n#endif\n`,extrusion_normal_fragment_begin:"\n#ifdef FLAT_SHADED\n    // Flattened this divergent path to prevent undefined behaviour in the following derivatives\n    // functions. For more info:\n    // http://www.aclockworkberry.com/shader-derivative-functions/#Derivatives_and_branches\n\n    // Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n    vec3 fdx = vec3(dFdx(vViewPosition.x), dFdx(vViewPosition.y), dFdx(vViewPosition.z));\n    vec3 fdy = vec3(dFdy(vViewPosition.x), dFdy(vViewPosition.y), dFdy(vViewPosition.z));\n    vec3 normal = cross( fdx, fdy );\n    if (vExtrusionAxis.w > 0.999999) {\n        normal = vExtrusionAxis.xyz;\n    }\n    normal = normalize(normal);\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\tbitangent = bitangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t#endif\n\t#endif\n#endif\n// non perturbed normal for clearcoat among others\nvec3 geometryNormal = normal;\n",extrusion_pars_fragment:"\n#ifdef ZFIGHTING_WORKAROUND\nvarying float vExtrusionRatio;\n#else\nuniform float extrusionRatio;\n#endif\nvarying vec4 vExtrusionAxis;\n",extrusion_fragment:"\n#ifndef ZFIGHTING_WORKAROUND\nfloat vExtrusionRatio = extrusionRatio;\n#endif\ngl_FragColor.a *= smoothstep( 0.0, 0.25, vExtrusionRatio );\n"}},3739:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={fading_pars_vertex:"\nvarying float fadingDepth;\n",fading_vertex:"\nfadingDepth = -mvPosition.z;\n",fading_pars_fragment:"\nvarying float fadingDepth;\nuniform float fadeNear;\nuniform float fadeFar;\n",fading_fragment:'\n\n// lerp with "hard" edges\n//float fadingFactor = 1.0 - clamp((fadingDepth - fadeNear) / (fadeFar - fadeNear), 0.0, 1.0);\n\n// smooth transitions\nfloat fadingFactor = smoothstep( fadeNear, fadeFar, fadingDepth );\n\ngl_FragColor.a *= 1.0 - fadingFactor;\n\n// debugging color:\n// gl_FragColor = vec4(1., fadingFactor, fadingFactor, 1.0);\n'}},7133:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={high_precision_vert_func:"\nvec3 subtractDblEyePos( const in vec3 pos ) {\n    vec3 t1 = positionLow - u_eyepos_lowpart;\n    vec3 e = t1 - positionLow;\n    vec3 t2 = ((-u_eyepos_lowpart - e) + (positionLow - (t1 - e))) + pos - u_eyepos;\n    vec3 high_delta = t1 + t2;\n    vec3 low_delta = t2 - (high_delta - t1);\n    return (high_delta + low_delta);\n}\n"}},759:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.simpleLightingShadowChunk=void 0,t.simpleLightingShadowChunk="\n    struct PhysicalMaterial {\n        vec3\tdiffuseColor;\n        float\tspecularRoughness;\n        vec3\tspecularColor;\n    };\n\n    #define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n    void RE_Direct_Physical( const in IncidentLight directLight,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight ) {\n        // directLight.color is the light color * shadow, internally three.js uses a step function, so\n        // this value is either the light color or black. in order to lighten up the shadows, we\n        // take add 50% of the color to grey (to give us either pure white or grey) and multiply this to\n        // the material's diffuse color.\n        #if defined(USE_SHADOWMAP)\n            reflectedLight.directDiffuse = (0.5 * directLight.color +\n                vec3(0.5,0.5,0.5)) * material.diffuseColor;\n        #else\n            reflectedLight.directDiffuse = material.diffuseColor;\n        #endif\n    }\n\n    void RE_IndirectDiffuse_Physical( const in vec3 irradiance,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight ) {\n            // Disable influence of indirect light (it is handled in the RE_Direct_Physical function)\n    }\n\n    void RE_IndirectSpecular_Physical( const in vec3 radiance,\n        const in vec3 irradiance,\n        const in vec3 clearcoatRadiance,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight) {\n            // Disable specular reflection of light.\n    }\n\n    #define RE_Direct               RE_Direct_Physical\n    #define RE_IndirectDiffuse      RE_IndirectDiffuse_Physical\n    #define RE_IndirectSpecular     RE_IndirectSpecular_Physical\n"},398:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LuminosityHighPassShader=void 0;const n=i(82);t.LuminosityHighPassShader={uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new n.Color(0)},defaultOpacity:{value:0}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform vec3 defaultColor;\n    uniform float defaultOpacity;\n    uniform float luminosityThreshold;\n    uniform float smoothWidth;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        vec3 luma = vec3( 0.299, 0.587, 0.114 );\n        float v = dot( texel.xyz, luma );\n        vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n        float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n        gl_FragColor = mix( outputColor, texel, alpha );\n    }"}},4919:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SepiaShader=void 0,t.SepiaShader={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform float amount;\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n        void main() {\n            vec4 color = texture2D( tDiffuse, vUv );\n            vec3 c = color.rgb;\n            color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\n            color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\n            color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\n            gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n        }"}},5551:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VignetteShader=void 0,t.VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform float offset;\n        uniform float darkness;\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n        void main() {\n            vec4 texel = texture2D( tDiffuse, vUv );\n            vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n            gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n        }"}},5823:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(6201),t),r(i(9785),t),r(i(1662),t),r(i(9843),t),r(i(3401),t),r(i(889),t),r(i(3461),t),r(i(1741),t),r(i(8533),t)},3401:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextCanvas=t.DEFAULT_TEXT_CANVAS_LAYER=void 0;const n=i(82),r=i(9843),s=i(16),o=i(1662),a=i(5402),l=i(2516),c=i(3461),h=new n.Vector3,u={array:[new n.Box2],offset:0};let d=new Float32Array;t.DEFAULT_TEXT_CANVAS_LAYER=0;class m{constructor(e){this.m_renderer=e.renderer,this.m_fontCatalog=e.fontCatalog,this.minGlyphCount=e.minGlyphCount,this.maxGlyphCount=e.maxGlyphCount,this.name=e.name,void 0===e.material?(this.m_ownsMaterial=!0,this.m_material=(0,c.createSdfTextMaterial)({fontCatalog:e.fontCatalog,rendererCapabilities:this.m_renderer.capabilities})):(this.m_ownsMaterial=!1,this.m_material=e.material),void 0===e.backgroundMaterial?(this.m_ownsBgMaterial=!0,this.m_bgMaterial=(0,c.createSdfTextMaterial)({fontCatalog:e.fontCatalog,isBackground:!0,rendererCapabilities:this.m_renderer.capabilities})):(this.m_ownsBgMaterial=!1,this.m_bgMaterial=e.backgroundMaterial),this.m_defaultLayer={id:t.DEFAULT_TEXT_CANVAS_LAYER,storage:new s.TextGeometry(new n.Scene,this.m_material,this.m_bgMaterial,this.minGlyphCount,this.maxGlyphCount)},this.m_layers=[this.m_defaultLayer],this.m_currentTextRenderStyle=(new o.TextRenderStyle).copy(m.defaultTextRenderStyle),this.m_currentTextLayoutStyle=(new o.TextLayoutStyle).copy(m.defaultTextLayoutStyle),this.m_lineTypesetter=new a.LineTypesetter,this.m_pathTypesetter=new l.PathTypesetter}get fontCatalog(){return this.m_fontCatalog}set fontCatalog(e){this.m_fontCatalog=e;const t=this.m_material;t.uniforms.sdfTexture.value=this.m_fontCatalog.texture,t.uniforms.sdfParams.value=new n.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),t.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0;const i=this.m_bgMaterial;i.uniforms.sdfTexture.value=this.m_fontCatalog.texture,i.uniforms.sdfParams.value=new n.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),i.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0}get material(){return this.m_material}set material(e){this.m_ownsMaterial&&(this.m_material.dispose(),this.m_ownsMaterial=!1),this.m_material=e;for(const e of this.m_layers)e.storage.mesh.material=this.m_material}get backgroundMaterial(){return this.m_bgMaterial}set backgroundMaterial(e){this.m_ownsBgMaterial&&(this.m_bgMaterial.dispose(),this.m_ownsBgMaterial=!1),this.m_bgMaterial=e;for(const e of this.m_layers)e.storage.backgroundMesh.material=this.m_bgMaterial}get textRenderStyle(){return this.m_currentTextRenderStyle}set textRenderStyle(e){this.m_currentTextRenderStyle.copy(e)}get textLayoutStyle(){return this.m_currentTextLayoutStyle}set textLayoutStyle(e){this.m_currentTextLayoutStyle.copy(e)}clear(){for(const e of this.m_layers)e.storage.clear();this.m_currentTextRenderStyle.copy(m.defaultTextRenderStyle),this.m_currentTextLayoutStyle.copy(m.defaultTextLayoutStyle)}render(e,t,i,n,r){this.m_fontCatalog.update(this.m_renderer);let s=null;void 0!==n&&(s=this.m_renderer.getRenderTarget(),this.m_renderer.setRenderTarget(n)),!0===r&&this.m_renderer.clear(!0);for(let n=0;n<this.m_layers.length;n++){const r=this.m_layers[n];if(r.id>=(null!=t?t:0)){if(!(void 0===i||r.id<i))break;r.storage.update(),this.m_renderer.render(r.storage.scene,e)}}void 0!==n&&this.m_renderer.setRenderTarget(s)}addLayer(e){let t=this.getLayer(e);return void 0===t&&(t={id:e,storage:new s.TextGeometry(new n.Scene,this.m_material,this.m_bgMaterial,this.minGlyphCount,this.maxGlyphCount)},this.m_layers.push(t),this.m_layers.sort(((e,t)=>e.id-t.id))),t}getLayer(e){return this.m_layers.find((t=>t.id===e))}getAllLayers(){return this.m_layers}measureText(e,t,i){let n,r,s,o;if(h.set(0,0,0),void 0!==i){if(n=i.path,r=i.pathOverflow,o=i.outputCharacterBounds,void 0!==i.path){const e=i.path.getPoint(0);if(null===e)return!1;h.set(e.x,e.y,0)}i.letterCaseArray&&(s=i.letterCaseArray)}return this.placeText({input:e,layer:this.m_defaultLayer,textPath:n,textPathOverflow:r,bounds:t,individualBounds:o,letterCaseArray:s})}addText(e,t,i){let n,r,s;h.copy(t);let o=this.m_defaultLayer;if(void 0!==i){if(n=i.path,r=i.pathOverflow,void 0!==i.layer){let e=this.getLayer(i.layer);void 0===e&&(e=this.addLayer(i.layer)),o=e}void 0!==i.path&&h.set(0,0,h.z),i.letterCaseArray&&(s=i.letterCaseArray)}const a=o.storage.drawCount,l=this.placeText({input:e,textPath:n,textPathOverflow:r,layer:o,letterCaseArray:s});return l&&void 0!==i?(!0===i.updatePosition&&t.copy(h),void 0!==i.pickingData&&o.storage.addPickingData(a,o.storage.drawCount,i.pickingData)):l||(o.storage.m_drawCount=a),l}createTextBufferObject(e,t){let i,s;h.set(0,0,0);const a=this.m_currentTextRenderStyle.fontVariant===o.FontVariant.SmallCaps;if("string"!=typeof e)i=e,void 0!==t&&t.letterCaseArray&&(s=t.letterCaseArray);else if(s=[],i=this.m_fontCatalog.getGlyphs(e,this.m_currentTextRenderStyle,a?s:void 0),void 0===i)return;let l,c,u,m,p,f;return void 0!==t&&(l=t.path,c=t.pathOverflow,!0===t.outputBounds&&(u=new n.Box2),!0===t.outputCharacterBounds&&(m=[]),!0===t.storeStyles&&(p=this.m_currentTextRenderStyle.clone(),f=this.m_currentTextLayoutStyle.clone())),this.placeText({input:e,layer:this.m_defaultLayer,computeTextBuffer:!0,textPath:l,textPathOverflow:c,bounds:u,individualBounds:m,letterCaseArray:s}),new r.TextBufferObject(i,new Float32Array(d),u,m,p,f)}addTextBufferObject(e,t){var i;let n,r,s,o,a,l,c,h=this.m_defaultLayer;if(void 0!==t){if(void 0!==t.layer){let e=this.getLayer(t.layer);void 0===e&&(e=this.addLayer(t.layer)),h=e}n=null===(i=t.position)||void 0===i?void 0:i.clone(),r=t.scale,s=t.rotation,o=t.color,a=t.opacity,l=t.backgroundColor,c=t.backgroundOpacity}const u=h.storage.drawCount,d=h.storage.addTextBufferObject(e,n,r,s,o,a,l,c);return d&&void 0!==t?void 0!==t.pickingData&&h.storage.addPickingData(u,h.storage.drawCount,t.pickingData):d||(h.storage.m_drawCount=u),d}pickText(e,t){for(const i of this.m_layers)i.storage.pick(e,t)}getMemoryUsage(e){this.m_fontCatalog.updateMemoryUsage(e);for(const t of this.m_layers)t.storage.updateMemoryUsage(e)}placeText(e){if(0===e.input.length||0===this.m_currentTextLayoutStyle.maxLines)return void 0!==e.bounds&&(e.bounds.min.set(0,0),e.bounds.max.set(0,0)),void 0!==e.individualBounds&&(e.individualBounds.length=0),!0;let t,i;const n=this.m_currentTextRenderStyle.fontVariant===o.FontVariant.SmallCaps;if("string"!=typeof e.input)t=e.input,e.letterCaseArray&&(i=e.letterCaseArray);else if(i=[],t=this.m_fontCatalog.getGlyphs(e.input,this.m_currentTextRenderStyle,n?i:void 0),void 0===t)return!1;let r;void 0!==e.individualBounds&&(u.array=e.individualBounds,u.offset=0,r=u),void 0!==e.bounds&&(e.bounds.min.set(1/0,1/0),e.bounds.max.set(-1/0,-1/0)),!0===e.computeTextBuffer&&(d=new Float32Array(t.length*s.QUAD_VERTEX_MEMORY_FOOTPRINT));const a=void 0!==e.textPath,l={glyphs:t,fontCatalog:this.m_fontCatalog,textRenderStyle:this.m_currentTextRenderStyle,textLayoutStyle:this.m_currentTextLayoutStyle,position:h,geometry:e.layer.storage,smallCapsArray:n?i:void 0,globalBounds:e.bounds,individualBounds:r,vertexBuffer:!0===e.computeTextBuffer?d:void 0};let c=!0;return a?(Object.assign(l,{path:e.textPath,pathOverflow:!0===e.textPathOverflow}),c=this.m_pathTypesetter.arrangeGlyphs(l)):c=this.m_lineTypesetter.arrangeGlyphs(l),void 0!==r&&(r.array.length=r.offset),c}}t.TextCanvas=m,m.defaultTextRenderStyle=new o.TextRenderStyle,m.defaultTextLayoutStyle=new o.TextLayoutStyle},6201:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FontCatalog=void 0;const n=i(82),r=i(8533),s=i(9785),o=i(2090),a=i(1662),l="_BoldAssets/",c="_ItalicAssets/";class h{static async load(e,t,i){const r=new URL(e,window.location.href),o=await h.loadJSON(r.href,i),a=new URL(`${o.name}_Assets/Extra/`,r),l=await h.loadJSON(a.href+"Specials.json",i),c=await h.loadTexture(a.href+"Specials.png",i);c.wrapS=n.ClampToEdgeWrapping,c.wrapT=n.ClampToEdgeWrapping,c.minFilter=n.NearestFilter,c.needsUpdate=!0;const u=o.fonts.find((e=>"Extra"===e.name)),d=new s.GlyphData(65533,"Specials",l.chars[0].width,l.chars[0].height,l.chars[0].xadvance,l.chars[0].xoffset,l.chars[0].yoffset,0,0,1,1,c,u,!0);return new h(r.href,o.name,o.type,o.size,o.maxWidth,o.maxHeight,o.distanceRange,o.fonts,o.supportedBlocks,t,d)}static async loadTexture(e,t){let i;return await new Promise(((r,s)=>{i=()=>{s(t.reason)},null==t||t.addEventListener("abort",i),(new n.TextureLoader).load(e,r)})).finally((()=>{null==t||t.removeEventListener("abort",i)}))}static async loadJSON(e,t){const i=await fetch(e,{signal:t});if(!i.ok)throw new Error(`${e} Status Text:  ${i.statusText}`);const n=await i.text();return JSON.parse(n)}constructor(e,t,i,n,r,s,a,l,c,h,u){this.url=e,this.name=t,this.type=i,this.size=n,this.maxWidth=r,this.maxHeight=s,this.distanceRange=a,this.fonts=l,this.unicodeBlocks=c,this.maxCodePointCount=h,this.m_replacementGlyph=u,this.showReplacementGlyphs=!1,this.m_baseUrl=e.substring(0,e.lastIndexOf("/")),this.m_glyphTextureCache=new o.GlyphTextureCache(h,this.maxWidth+1,this.maxHeight+1),this.m_loadingJson=new Map,this.m_loadingPages=new Map,this.m_loadingGlyphs=new Map,this.m_loadedJson=new Map,this.m_loadedPages=new Map,this.m_loadedGlyphs=new Map}dispose(){this.fonts.length=0,this.unicodeBlocks.length=0,this.m_glyphTextureCache.dispose(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()}clear(){this.m_glyphTextureCache.clear(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()}update(e){this.m_glyphTextureCache.update(e)}get texture(){return this.m_glyphTextureCache.texture}get textureSize(){return this.m_glyphTextureCache.textureSize}get isLoading(){return this.m_loadingJson.size>0||this.m_loadingPages.size>0||this.m_loadingGlyphs.size>0}async loadBlock(e,t,i,n){const r=this.getAssetsPath(i,t),s=`${r}/${e.name.replace(/ /g,"_")}.json`;let o=this.m_loadedJson.get(s);if(void 0===o){let e=this.m_loadingJson.get(s);if(void 0===e)try{e=h.loadJSON(s),this.m_loadingJson.set(s,e),o=await e,this.m_loadingJson.delete(s),this.m_loadedJson.set(s,o)}catch(e){console.error(e),this.m_loadingJson.delete(s)}else o=await e}const a=[];if(!0===n)for(const e of o.pages)a.push(this.loadPage(`${r}/${e}`));return await Promise.all(a),o}removeBlock(e,t,i){const n=this.getAssetsPath(i,t),r=`${n}/${e.name.replace(/ /g,"_")}.json`,s=this.m_loadedJson.get(r);if(void 0!==s){for(const e of s.pages){const t=`${n}/${e}`;this.m_loadingPages.delete(t),this.m_loadedPages.delete(t)}this.m_loadingJson.delete(r),this.m_loadedJson.delete(r)}}async loadCharset(e,t){const i=t.fontName,n=t.fontStyle,r=(t.fontVariant===a.FontVariant.AllCaps||t.fontVariant===a.FontVariant.SmallCaps?e.toUpperCase():e).replace(/[\s\S](?=([\s\S]+))/g,((e,t)=>t.indexOf(e)+1?"":e)),s=[];for(const e of r){const t=e.codePointAt(0),r=this.getFont(t,i),o=`${r.name}_${n}`,a=`${o}_${t}`;let l=this.m_loadedGlyphs.get(o);void 0===l&&(l=new Map,this.m_loadedGlyphs.set(o,l));const c=l.get(t);if(void 0===c){let i=this.m_loadingGlyphs.get(a);if(void 0===i){if(!r.charset.includes(String.fromCodePoint(t))){const i=this.createReplacementGlyph(t,e,r);l.set(t,i),this.m_glyphTextureCache.add(a,i);continue}let s;for(const e of this.unicodeBlocks)if(t>=e.min&&t<=e.max){s=e;break}i=this.loadAssets(t,n,s,r),this.m_loadingGlyphs.set(a,i),i.then((e=>{this.m_loadingGlyphs.delete(a),l.set(t,e),this.m_glyphTextureCache.add(a,e)}))}s.push(i)}else this.m_glyphTextureCache.has(a)||(s.push(Promise.resolve(c)),this.m_glyphTextureCache.add(a,c))}return Promise.all(s)}getGlyph(e,t,i){const n=this.m_loadedGlyphs.get(`${t.name}_${i}`);if(void 0!==n)return n.get(e)}getGlyphs(e,t,i){const n=[],r=t.fontName,s=t.fontStyle,o=t.fontVariant,l=o===a.FontVariant.AllCaps||o===a.FontVariant.SmallCaps;for(const t of e){const e=l?t.toUpperCase():t;for(const o of e){const e=o.codePointAt(0),a=this.getFont(e,r),l=this.getGlyph(e,a,s);if(void 0===l||l.isReplacement&&!this.showReplacementGlyphs)return;n.push(l),void 0!==i&&i.push(o!==t)}}return n}getFont(e,t){let i=this.fonts[0].name;for(const n of this.unicodeBlocks)if(e>=n.min&&e<=n.max){i=void 0!==t&&void 0!==n.fonts.find((e=>e===t))?t:n.fonts[0];break}return this.fonts.find((e=>e.name===i))}updateMemoryUsage(e){let t=0;for(const e of this.unicodeBlocks)t+=2*(e.max-e.min);let i=this.m_glyphTextureCache.textureSize.x*this.m_glyphTextureCache.textureSize.y*4;for(const e in this.m_loadedPages.entries)if(void 0!==this.m_loadedPages.get(e)){const t=this.m_loadedPages.get(e);void 0!==t&&(i+=t.image.width*t.image.height*4)}e.heapSize+=t+i,e.gpuSize+=i}createReplacementGlyph(e,t,i){const n=this.m_replacementGlyph.clone();return n.codePoint=e,n.character=t,n.font=i,n.isReplacement=r.UnicodeUtils.isPrintable(e),n}async loadAssets(e,t,i,n){const r=await this.loadBlock(i,n,t);if(void 0===r)return this.m_replacementGlyph;const o=r.chars.find((t=>t.id===e)),a=`${this.getAssetsPath(t,n)}/${r.pages[o.page]}`,l=await this.loadPage(a);return new s.GlyphData(o.id,i.name,o.width,o.height,o.xadvance,o.xoffset,o.yoffset,o.x/l.image.width,1-(o.y+o.height)/l.image.height,(o.x+o.width)/l.image.width,1-o.y/l.image.height,l,n)}async loadPage(e){let t=this.m_loadedPages.get(e);if(void 0===t){let i=this.m_loadingPages.get(e);void 0===i?(i=h.loadTexture(e),this.m_loadingPages.set(e,i),t=await i,t.wrapS=n.ClampToEdgeWrapping,t.wrapT=n.ClampToEdgeWrapping,t.minFilter=n.NearestFilter,t.needsUpdate=!0,this.m_loadingPages.delete(e)&&this.m_loadedPages.set(e,t),this.m_loadingPages.delete(e)):t=await i}return t}getAssetsPath(e,t){let i="_Assets/";switch(e){case a.FontStyle.Bold:void 0!==t.bold&&(i=l);break;case a.FontStyle.Italic:void 0!==t.italic&&(i=c);break;case a.FontStyle.BoldItalic:void 0!==t.boldItalic?i="_BoldItalicAssets/":void 0!==t.italic?i=c:void 0!==t.bold&&(i=l)}return`${this.m_baseUrl}/${this.name}${i}${t.name}`}}t.FontCatalog=h},9785:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphData=void 0;const n=i(82),r=i(8533);class s{constructor(e,t,i,s,o,a,l,c,h,u,d,m,p,f=!1){this.codePoint=e,this.block=t,this.width=i,this.height=s,this.advanceX=o,this.offsetX=a,this.offsetY=l,this.texture=m,this.font=p,this.isReplacement=f,this.positions=[],this.sourceTextureCoordinates=[],this.dynamicTextureCoordinates=[],this.copyIndex=0,this.isInCache=!1,this.character=String.fromCodePoint(e),this.direction=r.UnicodeUtils.getDirection(e,t);const g=this.offsetX,v=g+this.width,y=p.metrics.lineHeight-this.offsetY,_=y-this.height;this.positions.push(new n.Vector3(g,_,1),new n.Vector3(v,_,1),new n.Vector3(g,y,1),new n.Vector3(v,y,1)),this.sourceTextureCoordinates.push(new n.Vector2(c,h),new n.Vector2(u,h),new n.Vector2(c,d),new n.Vector2(u,d)),this.dynamicTextureCoordinates.push(new n.Vector2(0,0),new n.Vector2(1,0),new n.Vector2(0,1),new n.Vector2(1,1))}clone(){return new s(this.codePoint,this.block,this.width,this.height,this.advanceX,this.offsetX,this.offsetY,this.sourceTextureCoordinates[0].x,this.sourceTextureCoordinates[0].y,this.sourceTextureCoordinates[3].x,this.sourceTextureCoordinates[3].y,this.texture,this.font,this.isReplacement)}}t.GlyphData=s},2090:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphTextureCache=void 0;const n=i(82),r=i(8263),s=i(9785),o=i(4420),a=4096;t.GlyphTextureCache=class{constructor(e,t,i){this.capacity=e,this.entryWidth=t,this.entryHeight=i;const s=Math.floor(Math.sqrt(e));this.m_cacheHeight=s*s<e?s+1:s,this.m_cacheWidth=s*this.m_cacheHeight<e?s+1:s,this.m_textureSize=new n.Vector2(this.m_cacheWidth*t,this.m_cacheHeight*i),(this.m_textureSize.y>a||this.m_textureSize.x>a)&&console.warn("GlyphTextureCache texture size ("+this.m_textureSize.x+", "+this.m_textureSize.y+") exceeds WebGL's widely supported MAX_TEXTURE_SIZE ("+a+").\nThis could result in rendering errors on some devices.\nPlease consider reducing its capacity or input assets size."),this.m_entryCache=new r.LRUCache(e),this.initCacheEntries(),this.m_scene=new n.Scene,this.m_camera=new n.OrthographicCamera(0,this.m_textureSize.x,this.m_textureSize.y,0),this.m_camera.position.z=1,this.m_camera.updateMatrixWorld(!1),this.m_rt=new n.WebGLRenderTarget(this.m_textureSize.x,this.m_textureSize.y,{wrapS:n.ClampToEdgeWrapping,wrapT:n.ClampToEdgeWrapping,depthBuffer:!1,stencilBuffer:!1}),this.m_copyTextureSet=new Set,this.m_copyTransform=new n.Matrix3,this.m_copyPositions=[],this.m_copyPositions.push(new n.Vector2,new n.Vector2,new n.Vector2,new n.Vector2),this.m_copyVertexBuffer=new n.InterleavedBuffer(new Float32Array(20*e),5),this.m_copyVertexBuffer.setUsage(n.DynamicDrawUsage),this.m_copyPositionAttribute=new n.InterleavedBufferAttribute(this.m_copyVertexBuffer,3,0),this.m_copyUVAttribute=new n.InterleavedBufferAttribute(this.m_copyVertexBuffer,2,3),this.m_copyGeometry=new n.BufferGeometry,this.m_copyGeometry.setAttribute("position",this.m_copyPositionAttribute),this.m_copyGeometry.setAttribute("uv",this.m_copyUVAttribute);const o=new n.BufferAttribute(new Uint32Array(6*e),1);o.setUsage(n.DynamicDrawUsage),this.m_copyGeometry.setIndex(o),this.m_copyMesh=new n.Mesh(this.m_copyGeometry),this.m_copyMesh.frustumCulled=!1,this.m_copyGeometryDrawCount=0,this.m_clearPositionAttribute=new n.BufferAttribute(new Float32Array(8*e),2),this.m_clearPositionAttribute.setUsage(n.DynamicDrawUsage),this.m_clearGeometry=new n.BufferGeometry,this.m_clearGeometry.setAttribute("position",this.m_clearPositionAttribute);const l=new n.BufferAttribute(new Uint32Array(6*e),1);l.setUsage(n.DynamicDrawUsage),this.m_clearGeometry.setIndex(l),this.m_clearMesh=new n.Mesh(this.m_clearGeometry),this.m_clearMesh.frustumCulled=!1,this.m_clearGeometryDrawCount=0,this.m_scene.add(this.m_clearMesh,this.m_copyMesh)}dispose(){var e,t;this.m_entryCache.clear(),this.m_scene.remove(this.m_clearMesh,this.m_copyMesh),this.m_rt.dispose(),null===(e=this.m_clearMaterial)||void 0===e||e.dispose(),null===(t=this.m_copyMaterial)||void 0===t||t.dispose(),this.m_copyTextureSet.clear(),this.m_clearGeometry.dispose(),this.m_copyGeometry.dispose()}get texture(){return this.m_rt.texture}get textureSize(){return this.m_textureSize}add(e,t){if(void 0!==this.m_entryCache.get(e))return;const i=this.m_entryCache.oldest;if(null===i)throw new Error("GlyphTextureCache is uninitialized!");this.clearCacheEntry(i.value),this.copyGlyphToCache(e,t,i.value.location)}has(e){return this.m_entryCache.has(e)}get(e){return this.m_entryCache.get(e)}clear(){this.m_copyGeometryDrawCount=0,this.m_clearGeometryDrawCount=0,this.m_entryCache.clear(),this.m_copyTextureSet.clear(),this.initCacheEntries()}update(e){let t=null;const i=this.m_clearGeometryDrawCount>0,n=this.m_copyGeometryDrawCount>0;if((i||n)&&(t=e.getRenderTarget(),e.setRenderTarget(this.m_rt)),i){if(this.m_clearMaterial||(this.m_clearMaterial=new o.GlyphClearMaterial({rendererCapabilities:e.capabilities}),this.m_clearMesh.material=this.m_clearMaterial),null===this.m_clearGeometry.index)throw new Error("GlyphTextureCache clear geometry index is uninitialized!");this.m_clearPositionAttribute.needsUpdate=!0,this.m_clearPositionAttribute.updateRange.offset=0,this.m_clearPositionAttribute.updateRange.count=8*this.m_clearGeometryDrawCount,this.m_clearGeometry.index.needsUpdate=!0,this.m_clearGeometry.index.updateRange.offset=0,this.m_clearGeometry.index.updateRange.count=6*this.m_clearGeometryDrawCount,this.m_clearGeometry.setDrawRange(0,6*this.m_clearGeometryDrawCount),this.m_clearMesh.visible=!0,this.m_copyMesh.visible=!1,e.render(this.m_scene,this.m_camera),this.m_clearGeometryDrawCount=0,this.m_clearMesh.visible=!1}if(n){if(this.m_copyMaterial||(this.m_copyMaterial=new o.GlyphCopyMaterial({rendererCapabilities:e.capabilities}),this.m_copyMesh.material=this.m_copyMaterial),null===this.m_copyGeometry.index)throw new Error("GlyphTextureCache copy geometry index is uninitialized!");this.m_copyVertexBuffer.needsUpdate=!0,this.m_copyVertexBuffer.updateRange.offset=0,this.m_copyVertexBuffer.updateRange.count=20*this.m_copyGeometryDrawCount,this.m_copyGeometry.index.needsUpdate=!0,this.m_copyGeometry.index.updateRange.offset=0,this.m_copyGeometry.index.updateRange.count=6*this.m_copyGeometryDrawCount,this.m_copyGeometry.setDrawRange(0,6*this.m_copyGeometryDrawCount),this.m_copyMesh.visible=!0;const t=Array.from(this.m_copyTextureSet),i=Math.ceil(this.m_copyTextureSet.size/8);for(let n=0;n<i;n++){const i=8*n;this.m_copyMaterial.uniforms.pageOffset.value=i;for(let e=0;e<8;e++){const n=i+e;n<this.m_copyTextureSet.size&&(this.m_copyMaterial.uniforms["page"+e].value=t[n])}e.render(this.m_scene,this.m_camera)}this.m_copyTextureSet.clear(),this.m_copyGeometryDrawCount=0}(i||n)&&e.setRenderTarget(t)}initCacheEntries(){const e=new s.GlyphData(0,"",0,0,0,0,0,0,0,0,0,n.Texture.DEFAULT_IMAGE,{name:"",metrics:{size:0,distanceRange:0,base:0,lineHeight:0,lineGap:0,capHeight:0,xHeight:0},charset:""});for(let t=0;t<this.m_cacheHeight;t++)for(let i=0;i<this.m_cacheWidth;i++){const r={glyphData:e,location:new n.Vector2(i,t)};this.m_entryCache.set(`Dummy_${t*this.m_cacheHeight+i}`,r)}}copyGlyphToCache(e,t,i){this.m_copyTextureSet.add(t.texture);let n=0;for(const e of this.m_copyTextureSet.values()){if(e===t.texture)break;n++}t.copyIndex=n,this.m_copyTransform.set(1,0,i.x*this.entryWidth-t.offsetX,0,1,i.y*this.entryHeight-t.positions[0].y,0,0,0);for(let e=0;e<4;++e)this.m_copyPositions[e].set(t.positions[e].x,t.positions[e].y),this.m_copyPositions[e].applyMatrix3(this.m_copyTransform);if(this.m_copyGeometryDrawCount>=this.capacity)return;const r=4*this.m_copyGeometryDrawCount,s=6*this.m_copyGeometryDrawCount;for(let e=0;e<4;++e)this.m_copyPositionAttribute.setXYZ(r+e,this.m_copyPositions[e].x,this.m_copyPositions[e].y,t.copyIndex),this.m_copyUVAttribute.setXY(r+e,t.sourceTextureCoordinates[e].x,t.sourceTextureCoordinates[e].y);if(null===this.m_copyGeometry.index)throw new Error("GlyphTextureCache copy geometry index is uninitialized!");this.m_copyGeometry.index.setX(s,r),this.m_copyGeometry.index.setX(s+1,r+1),this.m_copyGeometry.index.setX(s+2,r+2),this.m_copyGeometry.index.setX(s+3,r+2),this.m_copyGeometry.index.setX(s+4,r+1),this.m_copyGeometry.index.setX(s+5,r+3),++this.m_copyGeometryDrawCount;const o=this.m_copyPositions[0].x/this.m_textureSize.x,a=this.m_copyPositions[0].y/this.m_textureSize.y,l=this.m_copyPositions[3].x/this.m_textureSize.x,c=this.m_copyPositions[3].y/this.m_textureSize.y;t.dynamicTextureCoordinates[0].set(o,a),t.dynamicTextureCoordinates[1].set(l,a),t.dynamicTextureCoordinates[2].set(o,c),t.dynamicTextureCoordinates[3].set(l,c),t.isInCache=!0,this.m_entryCache.set(e,{glyphData:t,location:i})}clearCacheEntry(e){if(e.glyphData.isInCache=!1,this.m_copyPositions[0].set(e.location.x*this.entryWidth,e.location.y*this.entryHeight),this.m_copyPositions[1].set((e.location.x+1)*this.entryWidth,e.location.y*this.entryHeight),this.m_copyPositions[2].set(e.location.x*this.entryWidth,(e.location.y+1)*this.entryHeight),this.m_copyPositions[3].set((e.location.x+1)*this.entryWidth,(e.location.y+1)*this.entryHeight),this.m_clearGeometryDrawCount>=this.capacity)return;const t=4*this.m_clearGeometryDrawCount,i=6*this.m_clearGeometryDrawCount;for(let e=0;e<4;++e)this.m_clearPositionAttribute.setXY(t+e,this.m_copyPositions[e].x,this.m_copyPositions[e].y);if(null===this.m_clearGeometry.index)throw new Error("GlyphTextureCache clear geometry index is uninitialized!");this.m_clearGeometry.index.setX(i,t),this.m_clearGeometry.index.setX(i+1,t+1),this.m_clearGeometry.index.setX(i+2,t+2),this.m_clearGeometry.index.setX(i+3,t+2),this.m_clearGeometry.index.setX(i+4,t+1),this.m_clearGeometry.index.setX(i+5,t+3),++this.m_clearGeometryDrawCount}}},9843:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextBufferObject=void 0,t.TextBufferObject=class{constructor(e,t,i,n,r,s){this.glyphs=e,this.buffer=t,this.bounds=i,this.characterBounds=n,this.textRenderStyle=r,this.textLayoutStyle=s}}},16:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextGeometry=t.QUAD_INDEX_MEMORY_FOOTPRINT=t.QUAD_VERTEX_MEMORY_FOOTPRINT=t.INDICES_PER_QUAD=t.VERTICES_PER_QUAD=t.INDEX_BUFFER_STRIDE=t.VERTEX_BUFFER_STRIDE=t.MAX_CAPACITY=void 0;const n=i(82);t.MAX_CAPACITY=65536,t.VERTEX_BUFFER_STRIDE=16,t.INDEX_BUFFER_STRIDE=1,t.VERTICES_PER_QUAD=4,t.INDICES_PER_QUAD=6,t.QUAD_VERTEX_MEMORY_FOOTPRINT=t.VERTICES_PER_QUAD*t.VERTEX_BUFFER_STRIDE,t.QUAD_INDEX_MEMORY_FOOTPRINT=t.INDICES_PER_QUAD*t.INDEX_BUFFER_STRIDE,t.TextGeometry=class{get drawCount(){return this.m_drawCount}get mesh(){return this.m_mesh}get backgroundMesh(){return this.m_bgMesh}constructor(e,i,r,s,o){this.scene=e,this.m_pickingDataArray=[],this.capacity=Math.min(o,t.MAX_CAPACITY),this.m_currentCapacity=Math.min(s,o),this.m_drawCount=0,this.m_updateOffset=0,this.m_vertexBuffer=new n.InterleavedBuffer(new Float32Array(this.m_currentCapacity*t.QUAD_VERTEX_MEMORY_FOOTPRINT),t.VERTEX_BUFFER_STRIDE),this.m_vertexBuffer.setUsage(n.DynamicDrawUsage),this.m_positionAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,0),this.m_uvAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,4),this.m_colorAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,8),this.m_bgColorAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,12),this.m_indexBuffer=new n.BufferAttribute(new Uint32Array(this.m_currentCapacity*t.QUAD_INDEX_MEMORY_FOOTPRINT),t.INDEX_BUFFER_STRIDE),this.m_indexBuffer.setUsage(n.DynamicDrawUsage),this.m_geometry=new n.BufferGeometry,this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("bgColor",this.m_bgColorAttribute),this.m_geometry.setIndex(this.m_indexBuffer),this.m_mesh=new n.Mesh(this.m_geometry,i),this.m_bgMesh=new n.Mesh(this.m_geometry,r),this.m_mesh.renderOrder=Number.MAX_SAFE_INTEGER,this.m_bgMesh.renderOrder=Number.MAX_SAFE_INTEGER-1,this.m_mesh.frustumCulled=!1,this.m_bgMesh.frustumCulled=!1,this.scene.add(this.m_bgMesh,this.m_mesh)}dispose(){this.scene.remove(this.m_bgMesh,this.m_mesh),this.m_geometry.dispose()}clear(){this.m_drawCount=0,this.m_updateOffset=0,this.m_pickingDataArray.length=0}update(){this.drawCount>this.m_updateOffset&&(this.m_vertexBuffer.needsUpdate=!0,this.m_vertexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_vertexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_indexBuffer.needsUpdate=!0,this.m_indexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_INDEX_MEMORY_FOOTPRINT,this.m_indexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_INDEX_MEMORY_FOOTPRINT),this.m_updateOffset=this.m_drawCount,this.m_geometry.setDrawRange(0,this.m_drawCount*t.INDICES_PER_QUAD)}add(e,i,n,r,s,o){if(this.m_drawCount>=this.capacity)return!1;if(this.m_drawCount>=this.m_currentCapacity){const e=Math.min(2*this.m_currentCapacity,this.capacity);this.resizeBuffers(e)}const a=this.m_drawCount*t.VERTICES_PER_QUAD,l=this.m_drawCount*t.INDICES_PER_QUAD;for(let l=0;l<t.VERTICES_PER_QUAD;++l){this.m_positionAttribute.setXYZW(a+l,i[l].x,i[l].y,i[l].z,(s?-1:1)*o.rotation);const t=s?(l+1)%2+2*Math.floor(l/2):l;this.m_uvAttribute.setXYZW(a+l,e.dynamicTextureCoordinates[t].x,e.dynamicTextureCoordinates[t].y,n,r),this.m_colorAttribute.setXYZW(a+l,o.color.r,o.color.g,o.color.b,o.opacity),this.m_bgColorAttribute.setXYZW(a+l,o.backgroundColor.r,o.backgroundColor.g,o.backgroundColor.b,o.backgroundOpacity)}return this.m_indexBuffer.setX(l,a),this.m_indexBuffer.setX(l+1,a+1),this.m_indexBuffer.setX(l+2,a+2),this.m_indexBuffer.setX(l+3,a+2),this.m_indexBuffer.setX(l+4,a+1),this.m_indexBuffer.setX(l+5,a+3),++this.m_drawCount,!0}addToBuffer(e,i,n,r,s,o,a,l){for(let c=0;c<t.VERTICES_PER_QUAD;++c){const h=i+t.VERTEX_BUFFER_STRIDE*c;e[h]=r[c].x,e[h+1]=r[c].y,e[h+2]=r[c].z,e[h+3]=(a?-1:1)*l.rotation;const u=a?(c+1)%2+2*Math.floor(c/2):c;e[h+4]=n.dynamicTextureCoordinates[u].x,e[h+5]=n.dynamicTextureCoordinates[u].y,e[h+6]=s,e[h+7]=o,e[h+8]=l.color.r,e[h+9]=l.color.g,e[h+10]=l.color.b,e[h+11]=l.opacity,e[h+12]=l.backgroundColor.r,e[h+13]=l.backgroundColor.g,e[h+14]=l.backgroundColor.b,e[h+15]=l.backgroundOpacity}}addTextBufferObject(e,i,n,r,s,o,a,l){if(this.m_drawCount+e.glyphs.length>=this.capacity)return!1;if(this.m_drawCount+e.glyphs.length>=this.m_currentCapacity){const e=Math.min(2*this.m_currentCapacity,this.capacity);this.resizeBuffers(e)}const c=null!=n?n:1,h=null!=r?r:0,u=Math.cos(h),d=Math.sin(h),m=void 0!==i?i.x:0,p=void 0!==i?i.y:0,f=e.buffer,g=f[3]<0?-1:1,v=void 0!==s?s.r:f[8],y=void 0!==s?s.g:f[9],_=void 0!==s?s.b:f[10],x=void 0!==o?o:f[11],w=void 0!==a?a.r:f[12],b=void 0!==a?a.g:f[13],T=void 0!==a?a.b:f[14],M=void 0!==l?l:f[15],S=this.m_drawCount*t.VERTICES_PER_QUAD;for(let i=0;i<e.glyphs.length;++i){const n=i*t.QUAD_VERTEX_MEMORY_FOOTPRINT,r=e.glyphs[i];if(!r.isInCache)return!1;const s=f[n+4]>f[n+t.VERTEX_BUFFER_STRIDE+4],o=f[n+6],a=f[n+7];for(let e=0;e<t.VERTICES_PER_QUAD;++e){const l=f[n+e*t.VERTEX_BUFFER_STRIDE],E=f[n+e*t.VERTEX_BUFFER_STRIDE+1];this.m_positionAttribute.setXYZW(S+i*t.VERTICES_PER_QUAD+e,l*c*u+E*c*-d+m,l*c*d+E*c*u+p,f[n+e*t.VERTEX_BUFFER_STRIDE+2]+0,f[n+e*t.VERTEX_BUFFER_STRIDE+3]+g*h);const A=s?(e+1)%2+2*Math.floor(e/2):e;this.m_uvAttribute.setXYZW(S+i*t.VERTICES_PER_QUAD+e,r.dynamicTextureCoordinates[A].x,r.dynamicTextureCoordinates[A].y,o,(a-o)/c+o),this.m_colorAttribute.setXYZW(S+i*t.VERTICES_PER_QUAD+e,v,y,_,x),this.m_bgColorAttribute.setXYZW(S+i*t.VERTICES_PER_QUAD+e,w,b,T,M)}this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD,(this.m_drawCount+i)*t.VERTICES_PER_QUAD),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+1,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+2,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+3,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+4,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+5,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+3)}return this.m_drawCount+=e.glyphs.length,!0}addPickingData(e,t,i){return!(this.m_pickingDataArray.length>=this.m_currentCapacity||(this.m_pickingDataArray.push({start:Math.min(e,this.capacity),end:Math.min(t,this.capacity),data:i}),0))}pick(e,i){for(const n of this.m_pickingDataArray){if(void 0===n)return;for(let r=n.start;r<n.end;++r){const s=r*t.VERTICES_PER_QUAD,o=Math.min(this.m_positionAttribute.getX(s+2),this.m_positionAttribute.getX(s+1));if(e.x<o)continue;const a=Math.max(this.m_positionAttribute.getX(s+2),this.m_positionAttribute.getX(s+1));if(e.x>a)continue;const l=Math.min(this.m_positionAttribute.getY(s+2),this.m_positionAttribute.getY(s+1));if(e.y<l)continue;const c=Math.max(this.m_positionAttribute.getY(s+2),this.m_positionAttribute.getY(s+1));if(!(e.y>c)){i(n.data);break}}}}updateMemoryUsage(e){const t=4*this.m_vertexBuffer.count+4*this.m_indexBuffer.count;e.heapSize+=t,e.gpuSize+=t}resizeBuffers(e){this.m_currentCapacity=e;const i=new Float32Array(e*t.QUAD_VERTEX_MEMORY_FOOTPRINT);i.set(this.m_vertexBuffer.array),this.m_vertexBuffer=new n.InterleavedBuffer(i,t.VERTEX_BUFFER_STRIDE),this.m_vertexBuffer.setUsage(n.DynamicDrawUsage),this.m_positionAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,0),this.m_uvAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,4),this.m_colorAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,8),this.m_bgColorAttribute=new n.InterleavedBufferAttribute(this.m_vertexBuffer,4,12);const r=new Uint32Array(e*t.QUAD_INDEX_MEMORY_FOOTPRINT);r.set(this.m_indexBuffer.array),this.m_indexBuffer=new n.BufferAttribute(r,t.INDEX_BUFFER_STRIDE),this.m_indexBuffer.setUsage(n.DynamicDrawUsage),this.m_geometry.dispose(),this.m_geometry=new n.BufferGeometry,this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("bgColor",this.m_bgColorAttribute),this.m_geometry.setIndex(this.m_indexBuffer),this.m_pickingDataArray.length=this.m_currentCapacity,this.scene.remove(this.m_bgMesh,this.m_mesh),this.m_mesh=new n.Mesh(this.m_geometry,this.m_mesh.material),this.m_bgMesh=new n.Mesh(this.m_geometry,this.m_bgMesh.material),this.m_mesh.renderOrder=Number.MAX_SAFE_INTEGER,this.m_bgMesh.renderOrder=Number.MAX_SAFE_INTEGER-1,this.m_mesh.frustumCulled=!1,this.m_bgMesh.frustumCulled=!1,this.scene.add(this.m_bgMesh,this.m_mesh)}}},4420:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdfTextMaterial=t.GlyphCopyMaterial=t.GlyphClearMaterial=void 0;const n=i(82),r=i(4342);Object.assign(n.ShaderChunk,{sdf_attributes:"\n        attribute vec4 position;\n        attribute vec4 uv;\n        attribute vec4 color;\n        attribute vec4 bgColor;\n        ",sdf_varying:"\n        varying vec4 vColor;\n        varying float vWeight;\n        varying vec2 vUv;\n        varying float vRotation;\n        ",sdf_varying_computation:"\n        #if BG_TEXT\n        vColor = bgColor;\n        vWeight = uv.w;\n        #else\n        vColor = color;\n        vWeight = uv.z;\n        #endif\n        vUv = vec2(uv.xy);\n        vRotation = position.w;\n        ",sdf_frag_uniforms:"\n        uniform sampler2D sdfTexture;\n        uniform vec4 sdfParams;\n        ",sdf_sampling_functions:"\n        float median(float r, float g, float b) {\n            return max(min(r, g), min(max(r, g), b));\n        }\n\n        float getDistance(vec2 uvOffset) {\n            vec3 texSample = texture2D(sdfTexture, vUv.xy + uvOffset).rgb;\n            #if MSDF\n            return median(texSample.r, texSample.g, texSample.b);\n            #else\n            return texSample.r;\n            #endif\n        }\n\n        float getOpacity(vec2 uvOffset, float weight) {\n            vec2 uv = vUv + uvOffset;\n            vec2 rotatedUVs = abs(vec2(\n                cos(vRotation) * uv.x - sin(vRotation) * uv.y,\n                sin(vRotation) * uv.x + cos(vRotation) * uv.y));\n\n            float dx = dFdx(rotatedUVs.x) * sdfParams.x;\n            float dy = dFdy(rotatedUVs.y) * sdfParams.y;\n            float toPixels = sdfParams.w * inversesqrt( dx * dx + dy * dy );\n\n            float dist = getDistance(uvOffset) + min(weight, 0.5 - 1.0 / sdfParams.w) - 0.5;\n            return clamp(dist * toPixels + 0.5, 0.0, 1.0);\n        }\n        "});class s extends n.RawShaderMaterial{constructor(e){const t=!0===(null==e?void 0:e.rendererCapabilities.isWebGL2),i=e?Object.assign(Object.assign({},e),{glslVersion:t?n.GLSL3:n.GLSL1,vertexShader:t&&e.vertexShader?(0,r.convertVertexShaderToWebGL2)(e.vertexShader):e.vertexShader,fragmentShader:t&&e.fragmentShader?(0,r.convertFragmentShaderToWebGL2)(e.fragmentShader):e.fragmentShader}):void 0;i&&delete i.rendererCapabilities,super(i)}}t.GlyphClearMaterial=class extends s{constructor(e){super(e?{name:"GlyphClearMaterial",vertexShader:"\n    attribute vec2 position;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }",fragmentShader:"\n    precision highp float;\n    precision highp int;\n\n    void main() {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }",uniforms:{},depthTest:!1,depthWrite:!1,rendererCapabilities:e.rendererCapabilities}:void 0)}},t.GlyphCopyMaterial=class extends s{constructor(e){super(e?{name:"GlyphCopyMaterial",vertexShader:"\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    varying vec3 vUv;\n\n    void main() {\n        vUv = vec3(uv.xy, position.z);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }",fragmentShader:"\n    precision highp float;\n    precision highp int;\n\n    uniform float pageOffset;\n    uniform sampler2D page0;\n    uniform sampler2D page1;\n    uniform sampler2D page2;\n    uniform sampler2D page3;\n    uniform sampler2D page4;\n    uniform sampler2D page5;\n    uniform sampler2D page6;\n    uniform sampler2D page7;\n\n    varying vec3 vUv;\n\n    void main() {\n        vec4 texSample = vec4(0.0);\n        if (vUv.z < pageOffset || vUv.z > (pageOffset + 7.0)) discard;\n        else if (vUv.z < pageOffset + 1.0) texSample = texture2D(page0, vUv.xy);\n        else if (vUv.z < pageOffset + 2.0) texSample = texture2D(page1, vUv.xy);\n        else if (vUv.z < pageOffset + 3.0) texSample = texture2D(page2, vUv.xy);\n        else if (vUv.z < pageOffset + 4.0) texSample = texture2D(page3, vUv.xy);\n        else if (vUv.z < pageOffset + 5.0) texSample = texture2D(page4, vUv.xy);\n        else if (vUv.z < pageOffset + 6.0) texSample = texture2D(page5, vUv.xy);\n        else if (vUv.z < pageOffset + 7.0) texSample = texture2D(page6, vUv.xy);\n        else texSample = texture2D(page7, vUv.xy);\n\n        gl_FragColor = texSample;\n    }",uniforms:{pageOffset:new n.Uniform(0),page0:new n.Uniform(n.Texture.DEFAULT_IMAGE),page1:new n.Uniform(n.Texture.DEFAULT_IMAGE),page2:new n.Uniform(n.Texture.DEFAULT_IMAGE),page3:new n.Uniform(n.Texture.DEFAULT_IMAGE),page4:new n.Uniform(n.Texture.DEFAULT_IMAGE),page5:new n.Uniform(n.Texture.DEFAULT_IMAGE),page6:new n.Uniform(n.Texture.DEFAULT_IMAGE),page7:new n.Uniform(n.Texture.DEFAULT_IMAGE)},depthTest:!1,depthWrite:!1,rendererCapabilities:e.rendererCapabilities}:void 0)}},t.SdfTextMaterial=class extends s{constructor(e){super(e?{name:"SdfTextMaterial",vertexShader:void 0!==e.vertexSource?e.vertexSource:"\n    #include <sdf_attributes>\n    #include <sdf_varying>\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        #include <sdf_varying_computation>\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n    }",fragmentShader:void 0!==e.fragmentSource?e.fragmentSource:"\n    precision highp float;\n    precision highp int;\n\n    #include <sdf_varying>\n    #include <sdf_frag_uniforms>\n    #include <sdf_sampling_functions>\n\n    void main() {\n        vec4 color = vColor;\n        color.a *= getOpacity(vec2(0.0), vWeight);\n        if (color.a < 0.05) {\n            discard;\n        }\n        gl_FragColor = color;\n    }",uniforms:{sdfTexture:new n.Uniform(e.texture),sdfParams:new n.Uniform(new n.Vector4(e.textureSize.x,e.textureSize.y,e.size,e.distanceRange))},defines:{MSDF:e.isMsdf?1:0,BG_TEXT:e.isBackground?1:0},depthTest:!0,depthWrite:!1,side:n.DoubleSide,transparent:!0,rendererCapabilities:e.rendererCapabilities}:void 0),this.extensions.derivatives=!0}}},1662:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolvePlacementAndAlignment=t.TextLayoutStyle=t.TextRenderStyle=t.DefaultTextStyle=t.vPlacementFromAlignment=t.hPlacementFromAlignment=t.vAlignFromPlacement=t.hAlignFromPlacement=t.WrappingMode=t.HorizontalPlacement=t.VerticalPlacement=t.HorizontalAlignment=t.VerticalAlignment=t.FontVariant=t.FontStyle=t.FontUnit=void 0;const n=i(82);var r,s,o,a,l,c,h,u,d;!function(e){e[e.Em=0]="Em",e[e.Pixel=1]="Pixel",e[e.Point=2]="Point",e[e.Percent=3]="Percent"}(r=t.FontUnit||(t.FontUnit={})),function(e){e[e.Regular=0]="Regular",e[e.Bold=1]="Bold",e[e.Italic=2]="Italic",e[e.BoldItalic=3]="BoldItalic"}(s=t.FontStyle||(t.FontStyle={})),function(e){e[e.Regular=0]="Regular",e[e.AllCaps=1]="AllCaps",e[e.SmallCaps=2]="SmallCaps"}(o=t.FontVariant||(t.FontVariant={})),function(e){e[e.Above=0]="Above",e[e.Center=-.5]="Center",e[e.Below=-1]="Below"}(a=t.VerticalAlignment||(t.VerticalAlignment={})),function(e){e[e.Left=0]="Left",e[e.Center=-.5]="Center",e[e.Right=-1]="Right"}(l=t.HorizontalAlignment||(t.HorizontalAlignment={})),(d=t.VerticalPlacement||(t.VerticalPlacement={}))[d.Top=0]="Top",d[d.Center=-.5]="Center",d[d.Bottom=-1]="Bottom",(u=t.HorizontalPlacement||(t.HorizontalPlacement={}))[u.Left=-1]="Left",u[u.Center=-.5]="Center",u[u.Right=0]="Right",function(e){e[e.None=0]="None",e[e.Character=1]="Character",e[e.Word=2]="Word"}(c=t.WrappingMode||(t.WrappingMode={})),t.hAlignFromPlacement=function(e){return e},t.vAlignFromPlacement=function(e){return e},t.hPlacementFromAlignment=function(e){return e},t.vPlacementFromAlignment=function(e){return e},function(e){e.DEFAULT_FONT_NAME="",e.DEFAULT_FONT_SIZE={unit:Object.freeze(r.Pixel),size:Object.freeze(16),backgroundSize:Object.freeze(0)},e.DEFAULT_FONT_STYLE=s.Regular,e.DEFAULT_FONT_VARIANT=o.Regular,e.DEFAULT_ROTATION=0,e.DEFAULT_COLOR=new n.Color(0),e.DEFAULT_OPACITY=1,e.DEFAULT_BACKGROUND_COLOR=new n.Color(0),e.DEFAULT_BACKGROUND_OPACITY=0,e.DEFAULT_TRACKING=0,e.DEFAULT_LEADING=0,e.DEFAULT_MAX_LINES=1/0,e.DEFAULT_LINE_WIDTH=1/0,e.DEFAULT_CANVAS_ROTATION=0,e.DEFAULT_LINE_ROTATION=0,e.DEFAULT_WRAPPING_MODE=c.Word,e.DEFAULT_VERTICAL_ALIGNMENT=a.Above,e.DEFAULT_HORIZONTAL_ALIGNMENT=l.Left,e.DEFAULT_PLACEMENTS=[]}(h=t.DefaultTextStyle||(t.DefaultTextStyle={}));class m{constructor(e={}){this.m_params={fontName:void 0!==e.fontName?e.fontName:h.DEFAULT_FONT_NAME,fontSize:void 0!==e.fontSize?Object.assign({},e.fontSize):{unit:h.DEFAULT_FONT_SIZE.unit,size:h.DEFAULT_FONT_SIZE.size,backgroundSize:h.DEFAULT_FONT_SIZE.backgroundSize},fontStyle:void 0!==e.fontStyle?e.fontStyle:h.DEFAULT_FONT_STYLE,fontVariant:void 0!==e.fontVariant?e.fontVariant:h.DEFAULT_FONT_VARIANT,rotation:void 0!==e.rotation?e.rotation:h.DEFAULT_ROTATION,color:void 0!==e.color?e.color.clone():h.DEFAULT_COLOR.clone(),opacity:void 0!==e.opacity?e.opacity:h.DEFAULT_OPACITY,backgroundColor:void 0!==e.backgroundColor?e.backgroundColor.clone():h.DEFAULT_BACKGROUND_COLOR.clone(),backgroundOpacity:void 0!==e.backgroundOpacity?e.backgroundOpacity:h.DEFAULT_BACKGROUND_OPACITY,backgroundImage:e.backgroundImage}}get params(){return this.m_params}set params(e){this.m_params=Object.assign(Object.assign({},this.m_params),e)}get fontName(){return this.m_params.fontName}set fontName(e){this.m_params.fontName=e}get fontSize(){return this.m_params.fontSize}set fontSize(e){this.m_params.fontSize=Object.assign({},e)}get fontStyle(){return this.m_params.fontStyle}set fontStyle(e){this.m_params.fontStyle=e}get fontVariant(){return this.m_params.fontVariant}set fontVariant(e){this.m_params.fontVariant=e}get rotation(){return this.m_params.rotation}set rotation(e){this.m_params.rotation=e}get color(){return this.m_params.color}set color(e){this.m_params.color.copy(e)}get backgroundColor(){return this.m_params.backgroundColor}set backgroundColor(e){this.m_params.backgroundColor.copy(e)}get opacity(){return this.m_params.opacity}set opacity(e){this.m_params.opacity=e}get backgroundOpacity(){return this.m_params.backgroundOpacity}set backgroundOpacity(e){this.m_params.backgroundOpacity=e}get backgroundImage(){return this.m_params.backgroundImage}set backgroundImage(e){this.m_params.backgroundImage=e}clone(e={}){return new m(Object.assign(Object.assign({},this.m_params),e))}copy(e){return this.m_params.fontName=e.fontName,this.m_params.fontSize=Object.assign({},e.fontSize),this.m_params.fontStyle=e.fontStyle,this.m_params.fontVariant=e.fontVariant,this.m_params.rotation=e.rotation,this.m_params.color.copy(e.color),this.m_params.backgroundColor.copy(e.backgroundColor),this.m_params.opacity=e.opacity,this.m_params.backgroundOpacity=e.backgroundOpacity,this.m_params.backgroundImage=e.backgroundImage,this}}t.TextRenderStyle=m;class p{constructor(e={}){const{horizontalAlignment:t,verticalAlignment:i,placements:n}=f(e.horizontalAlignment,e.verticalAlignment,e.placements);this.m_params={tracking:void 0!==e.tracking?e.tracking:h.DEFAULT_TRACKING,leading:void 0!==e.leading?e.leading:h.DEFAULT_LEADING,maxLines:void 0!==e.maxLines?e.maxLines:h.DEFAULT_MAX_LINES,lineWidth:void 0!==e.lineWidth?e.lineWidth:h.DEFAULT_LINE_WIDTH,canvasRotation:void 0!==e.canvasRotation?e.canvasRotation:h.DEFAULT_CANVAS_ROTATION,lineRotation:void 0!==e.lineRotation?e.lineRotation:h.DEFAULT_LINE_ROTATION,wrappingMode:void 0!==e.wrappingMode?e.wrappingMode:h.DEFAULT_WRAPPING_MODE,verticalAlignment:i,horizontalAlignment:t,placements:n}}get params(){return this.m_params}set params(e){this.m_params=Object.assign(Object.assign({},this.m_params),e)}get tracking(){return this.m_params.tracking}set tracking(e){this.m_params.tracking=e}get leading(){return this.m_params.leading}set leading(e){this.m_params.leading=e}get maxLines(){return this.m_params.maxLines}set maxLines(e){this.m_params.maxLines=e}get lineWidth(){return this.m_params.lineWidth}set lineWidth(e){this.m_params.lineWidth=e}get canvasRotation(){return this.m_params.canvasRotation}set canvasRotation(e){this.m_params.canvasRotation=e}get lineRotation(){return this.m_params.lineRotation}set lineRotation(e){this.m_params.lineRotation=e}get wrappingMode(){return this.m_params.wrappingMode}set wrappingMode(e){this.m_params.wrappingMode=e}get verticalAlignment(){return this.m_params.verticalAlignment}set verticalAlignment(e){this.m_params.verticalAlignment=e}get horizontalAlignment(){return this.m_params.horizontalAlignment}set horizontalAlignment(e){this.m_params.horizontalAlignment=e}get placements(){return this.m_params.placements}set placements(e){const{horizontalAlignment:t,verticalAlignment:i,placements:n}=f(this.horizontalAlignment,this.verticalAlignment,e);this.m_params.horizontalAlignment=t,this.m_params.verticalAlignment=i,this.m_params.placements=n}clone(e={}){return new p(Object.assign(Object.assign({},this.m_params),e))}copy(e){return this.params=Object.assign({},e.params),this}}function f(e,t,i){var n;const r=null!==(n=null==i?void 0:i.map((e=>Object.assign({},e))))&&void 0!==n?n:h.DEFAULT_PLACEMENTS.map((e=>Object.assign({},e)));return{horizontalAlignment:r.length>0?r[0].h:null!=e?e:h.DEFAULT_HORIZONTAL_ALIGNMENT,verticalAlignment:r.length>0?r[0].v:null!=t?t:h.DEFAULT_VERTICAL_ALIGNMENT,placements:r}}t.TextLayoutStyle=p,t.resolvePlacementAndAlignment=f},5402:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineTypesetter=void 0;const n=i(82),r=i(16),s=i(1662),o=i(1741),a=i(8533);t.LineTypesetter=class{constructor(){this.m_tempTransform=new n.Matrix3,this.m_tempCorners=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3],this.m_tempLineDirection=a.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=a.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1}arrangeGlyphs(e){this.m_currentParams=e,this.m_tempLineDirection=o.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=o.TypesettingUtils.fontSizeAlignmentFactor*o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_currentParams.position.y+=this.m_currentParams.textLayoutStyle.verticalAlignment*this.m_currentParams.glyphs[0].font.metrics.capHeight*this.m_tempScale;const t=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer,i=this.m_currentParams.position.x,n=this.m_currentParams.glyphs[0].font.metrics.lineHeight+this.m_currentParams.textLayoutStyle.leading;let r=0,l=0,c=0,h=0,u=0,d=0,m=0,p=0,f=!1;for(let e=0;e<this.m_currentParams.glyphs.length&&!(p>this.m_currentParams.textLayoutStyle.maxLines-1);++e){const g=this.m_currentParams.glyphs[e];if(!g.isInCache&&!t)return!1;const v=a.UnicodeUtils.isNewLine(g.codePoint),y=a.UnicodeUtils.isWhiteSpace(g.codePoint);if(f||g.direction!==-this.m_tempLineDirection||(f=!0),a.UnicodeUtils.isPrintable(g.codePoint)&&(u+=(g.advanceX+this.m_currentParams.textLayoutStyle.tracking)*this.m_tempScale*(this.m_tempSmallCaps?o.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,e,this.m_currentParams.textRenderStyle.fontVariant):1)),e===r&&(h=u,d=u,m=u),v||this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Character&&u>this.m_currentParams.textLayoutStyle.lineWidth||this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Word&&u>this.m_currentParams.textLayoutStyle.lineWidth&&m!==h){if(this.m_currentParams.textLayoutStyle.wrappingMode!==s.WrappingMode.None){let t=l,i=d;this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Word&&m!==h&&(t=c,i=m),u=i,e=Math.min(v?r===e?t:e:t,this.m_currentParams.glyphs.length-1)}const t=this.m_tempLineDirection===a.UnicodeUtils.Direction.RTL&&f?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.x=this.m_currentParams.position.x+u*t,!this.placeLine(r,e,this.m_tempLineDirection,f))return!1;for(this.m_currentParams.position.y-=n*this.m_tempScale,this.m_currentParams.position.x=i;e!==r&&e+1<this.m_currentParams.glyphs.length&&a.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[e+1].codePoint);)++e;if(r=e+1,r===this.m_currentParams.glyphs.length)break;v&&(this.m_tempLineDirection=o.TypesettingUtils.getDirection(this.m_currentParams.glyphs,r),this.m_tempRunDirection=this.m_tempLineDirection),h=0,u=0,l=r,d=0,c=r,m=0,f=!1,p++}else this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.None||y||(l=e,d=u,this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Word&&e+1<this.m_currentParams.glyphs.length&&(a.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[e+1].codePoint)||a.UnicodeUtils.isNewLine(this.m_currentParams.glyphs[e+1].codePoint))&&(c=e,m=u))}if(p<=this.m_currentParams.textLayoutStyle.maxLines-1&&r<=this.m_currentParams.glyphs.length-1){const e=this.m_tempLineDirection===a.UnicodeUtils.Direction.RTL&&f?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.setX(this.m_currentParams.position.x+u*e),!this.placeLine(r,this.m_currentParams.glyphs.length-1,this.m_tempLineDirection,f))return!1}if(e.globalBounds&&e.globalBounds.max.x-e.globalBounds.min.x>0&&e.globalBounds.max.y-e.globalBounds.min.y>0){const t=e.globalBounds,i=(.5*this.m_currentParams.fontCatalog.distanceRange-this.m_tempPixelBgSize)*this.m_tempScale;t.min.set(t.min.x+i,t.min.y+i),t.max.set(t.max.x-i,t.max.y-i)}return!0}placeLine(e,t,i,n){if(!n)return this.placeRun(e,t,i);const r=this.m_currentParams.glyphs,s=this.m_currentParams.smallCapsArray,l=this.m_currentParams.textRenderStyle,c=this.m_currentParams.textLayoutStyle,h=this.m_currentParams.position,u=i===a.UnicodeUtils.Direction.RTL,d=h.x;let m=0,p=e;for(let n=e;n<=t;++n){const e=r[n];if(e.direction===-this.m_tempRunDirection){if(u&&(h.x=d+m),!this.placeRun(p,n-1,this.m_tempRunDirection))return!1;u||(h.x=d+m),p=n,this.m_tempRunDirection*=-1}else if(e.direction===a.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-i){let e=n;for(;e+1<r.length&&1!==Math.abs(r[e].direction);)++e;if(r[e].direction!==this.m_tempRunDirection){if(u&&(h.x=d+m),!this.placeRun(p,n-1,this.m_tempRunDirection))return!1;u||(h.x=d+m),p=n,this.m_tempRunDirection*=-1}}m+=(e.advanceX+c.tracking)*this.m_tempScale*(this.m_tempSmallCaps?o.TypesettingUtils.getSmallCapsScale(r,s,n,l.fontVariant):1)*i}if(p<=t){if(u&&(h.x=d+m),!this.placeRun(p,t,this.m_tempRunDirection))return!1;u||(h.x=d+m)}return!0}placeRun(e,t,i){const n=this.m_currentParams.glyphs,l=this.m_currentParams.smallCapsArray,c=this.m_currentParams.fontCatalog,h=this.m_currentParams.textRenderStyle,u=this.m_currentParams.textLayoutStyle,d=this.m_currentParams.position,m=this.m_currentParams.geometry,p=this.m_currentParams.globalBounds,f=this.m_currentParams.individualBounds,g=this.m_currentParams.vertexBuffer,v=i===a.UnicodeUtils.Direction.LTR?e:t,y=i===a.UnicodeUtils.Direction.LTR?t:e;for(let _=v;i===a.UnicodeUtils.Direction.RTL?_>=y:_<=y;_+=i){const v=n[_];if(!a.UnicodeUtils.isPrintable(v.codePoint))continue;if(e!==t&&0!==_&&i===a.UnicodeUtils.Direction.RTL&&v.direction===a.UnicodeUtils.Direction.Weak){let t=_,i=n[t-1];for(;t!==e&&(i.direction===a.UnicodeUtils.Direction.Weak||i.direction===a.UnicodeUtils.Direction.Neutral&&!a.UnicodeUtils.isWhiteSpace(i.codePoint));)--t,i=n[t-1];this.placeRun(Math.max(t,e),_,a.UnicodeUtils.Direction.LTR),_=t;continue}const y=v.font,x=y.metrics,w=h.fontStyle,b=w===s.FontStyle.Bold&&void 0===y.bold||w===s.FontStyle.BoldItalic&&void 0===y.bold&&void 0===y.boldItalic,T=w===s.FontStyle.Italic&&void 0===y.italic||w===s.FontStyle.BoldItalic&&void 0===y.italic&&void 0===y.boldItalic,M=!!this.m_tempSmallCaps&&l[_]&&h.fontVariant===s.FontVariant.SmallCaps,S=M?x.xHeight/x.capHeight:1,E=this.m_tempScale*S,A=((b?.02:0)+(M?.01:0))*(c.size/c.distanceRange),C=o.TypesettingUtils.alignBackgroundWidth(this.m_tempPixelSize,.5*this.m_tempPixelBgSize/(c.distanceRange*Math.max(E,1))),P=a.UnicodeUtils.isRtlMirrored(v.codePoint)&&i===a.UnicodeUtils.Direction.RTL,L=x.lineHeight-x.base-.5*x.distanceRange;o.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,d,E,u.canvasRotation,h.rotation);for(let e=0;e<4;++e){const t=v.positions[e],i=T&&e>1?o.TypesettingUtils.OBLIQUE_OFFSET*x.size:0;this.m_tempCorners[e].set(t.x+i,t.y-L,t.z),this.m_tempCorners[e].applyMatrix3(this.m_tempTransform)}if(void 0===p&&void 0===g){if(!m.add(v,this.m_tempCorners,A,A+C,P,h))return!1}else void 0!==p&&o.TypesettingUtils.updateBounds(this.m_tempCorners,p,f),void 0!==g&&m.addToBuffer(g,_*r.QUAD_VERTEX_MEMORY_FOOTPRINT,v,this.m_tempCorners,A,A+C,P,h);d.set(d.x+(v.advanceX+u.tracking)*E*Math.cos(u.lineRotation),d.y+(v.advanceX+u.tracking)*E*Math.sin(u.lineRotation),d.z)}return!0}}},2516:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PathTypesetter=void 0;const n=i(82),r=i(16),s=i(1662),o=i(1741),a=i(8533);t.PathTypesetter=class{constructor(){this.m_tempTransform=new n.Matrix3,this.m_tempCorners=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3],this.m_tempLineDirection=a.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=a.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1,this.m_tempPathPosition=new n.Vector3,this.m_tempPathLength=0,this.m_tempPathOffset=0}arrangeGlyphs(e){this.m_currentParams=e,this.m_tempLineDirection=o.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=o.TypesettingUtils.fontSizeAlignmentFactor*o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_tempPathLength=this.m_currentParams.path.getLength(),this.m_tempPathOffset=0;const t=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer;let i=!1,n=0;for(let e=0;e<this.m_currentParams.glyphs.length;++e){const r=this.m_currentParams.glyphs[e];if(!r.isInCache&&!t)return!1;a.UnicodeUtils.isPrintable(r.codePoint)&&(i||r.direction!==-this.m_tempLineDirection||(i=!0),n+=(r.advanceX+this.m_currentParams.textLayoutStyle.tracking)*this.m_tempScale*(this.m_tempSmallCaps?o.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,e,this.m_currentParams.textRenderStyle.fontVariant):1))}return this.m_tempPathOffset=Math.min(Math.max(-this.m_currentParams.textLayoutStyle.horizontalAlignment+this.m_currentParams.textLayoutStyle.horizontalAlignment*n/this.m_tempPathLength,0),1),this.placeLine(this.m_tempLineDirection,i)}placeLine(e,t){if(!t)return this.placeRun(0,this.m_currentParams.glyphs.length-1,e);const i=this.m_currentParams.glyphs;let n=0;for(let t=n;t<i.length;++t){const r=i[t];if(r.direction===-this.m_tempRunDirection){if(!this.placeRun(n,t-1,this.m_tempRunDirection))return!1;n=t,this.m_tempRunDirection*=-1}else if(r.direction===a.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-e){let e=t;for(;e+1<i.length&&1!==Math.abs(i[e].direction);)++e;if(i[e].direction!==this.m_tempRunDirection){if(!this.placeRun(n,t-1,this.m_tempRunDirection))return!1;n=t,this.m_tempRunDirection*=-1}}}return!(n<i.length&&!this.placeRun(n,i.length-1,this.m_tempRunDirection))}placeRun(e,t,i){const l=this.m_currentParams.glyphs,c=this.m_currentParams.smallCapsArray,h=this.m_currentParams.fontCatalog,u=this.m_currentParams.textRenderStyle,d=this.m_currentParams.textLayoutStyle,m=this.m_currentParams.position,p=this.m_currentParams.geometry,f=this.m_currentParams.globalBounds,g=this.m_currentParams.individualBounds,v=this.m_currentParams.vertexBuffer,y=this.m_currentParams.path,_=u.rotation,x=d.verticalAlignment*l[0].font.metrics.capHeight*this.m_tempScale,w=i===a.UnicodeUtils.Direction.LTR?e:t,b=i===a.UnicodeUtils.Direction.LTR?t:e;for(let T=w;i===a.UnicodeUtils.Direction.RTL?T>=b:T<=b;T+=i){const w=l[T];if(!a.UnicodeUtils.isPrintable(w.codePoint))continue;if(e!==t&&0!==T&&i===a.UnicodeUtils.Direction.RTL&&w.direction===a.UnicodeUtils.Direction.Weak){let t=T,i=l[t-1];for(;t!==e&&(i.direction===a.UnicodeUtils.Direction.Weak||i.direction===a.UnicodeUtils.Direction.Neutral&&!a.UnicodeUtils.isWhiteSpace(i.codePoint));)--t,i=l[t-1];this.placeRun(Math.max(t,e),T,a.UnicodeUtils.Direction.LTR),T=t;continue}const b=w.font,M=b.metrics,S=u.fontStyle,E=S===s.FontStyle.Bold&&void 0===b.bold||S===s.FontStyle.BoldItalic&&void 0===b.bold&&void 0===b.boldItalic,A=S===s.FontStyle.Italic&&void 0===b.italic||S===s.FontStyle.BoldItalic&&void 0===b.italic&&void 0===b.boldItalic,C=!!this.m_tempSmallCaps&&c[T]&&u.fontVariant===s.FontVariant.SmallCaps,P=C?M.xHeight/M.capHeight:1,L=this.m_tempScale*P,R=((E?.02:0)+(C?.01:0))*(h.size/h.distanceRange),D=o.TypesettingUtils.alignBackgroundWidth(this.m_tempPixelSize,.5*this.m_tempPixelBgSize/(h.distanceRange*Math.max(L,1))),I=a.UnicodeUtils.isRtlMirrored(w.codePoint)&&i===a.UnicodeUtils.Direction.RTL,O=M.lineHeight-M.base-.5*M.distanceRange,F=y.getPoint(this.m_tempPathOffset);if(null===F)return this.m_currentParams.pathOverflow;const V=y.getTangent(this.m_tempPathOffset),U=new n.Vector2(-V.y,V.x).multiplyScalar(x),B=Math.atan2(V.y,V.x);this.m_tempPathPosition.set(U.x+F.x,U.y+F.y,m.z),u.rotation=_+B,o.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,this.m_tempPathPosition,L,0,u.rotation);for(let e=0;e<4;++e){const t=w.positions[e],i=A&&e>1?o.TypesettingUtils.OBLIQUE_OFFSET*M.size:0;this.m_tempCorners[e].set(t.x+i,t.y-O,t.z),this.m_tempCorners[e].applyMatrix3(this.m_tempTransform),this.m_tempCorners[e].x-=m.x,this.m_tempCorners[e].y-=m.y}if(void 0===f&&void 0===v){if(!p.add(w,this.m_tempCorners,R,R+D,I,u))return!1}else void 0!==f&&o.TypesettingUtils.updateBounds(this.m_tempCorners,f,g),void 0!==v&&p.addToBuffer(v,T*r.QUAD_VERTEX_MEMORY_FOOTPRINT,w,this.m_tempCorners,R,R+D,I,u);u.rotation=_,this.m_tempPathOffset+=(w.advanceX+d.tracking)*L/this.m_tempPathLength}return!0}}},889:(e,t)=>{"use strict";var i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.ContextualArabicConverter=void 0,function(e){e[e.Initial=0]="Initial",e[e.Medial=1]="Medial",e[e.Final=2]="Final"}(i||(i={})),function(e){e[e.Isolated=0]="Isolated",e[e.Connected=1]="Connected"}(n||(n={}));class r{static get instance(){return void 0===this.m_instance&&(this.m_instance=new r),this.m_instance}constructor(){this.m_singleCharactersMap=new Map,this.m_combinedCharactersMap=new Map,this.m_singleCharactersMap.set(1569,[void 0,void 0,void 0]),this.m_singleCharactersMap.set(1570,[void 0,void 0,65154]),this.m_singleCharactersMap.set(1571,[void 0,void 0,65156]),this.m_singleCharactersMap.set(1572,[void 0,void 0,65158]),this.m_singleCharactersMap.set(1573,[void 0,void 0,65160]),this.m_singleCharactersMap.set(1574,[65163,65164,65162]),this.m_singleCharactersMap.set(1575,[void 0,void 0,65166]),this.m_singleCharactersMap.set(1576,[65169,65170,65168]),this.m_singleCharactersMap.set(1577,[void 0,void 0,65172]),this.m_singleCharactersMap.set(1578,[65175,65176,65174]),this.m_singleCharactersMap.set(1579,[65179,65180,65178]),this.m_singleCharactersMap.set(1580,[65183,65184,65182]),this.m_singleCharactersMap.set(1581,[65187,65188,65186]),this.m_singleCharactersMap.set(1582,[65191,65192,65190]),this.m_singleCharactersMap.set(1583,[void 0,void 0,65194]),this.m_singleCharactersMap.set(1584,[void 0,void 0,65196]),this.m_singleCharactersMap.set(1585,[void 0,void 0,65198]),this.m_singleCharactersMap.set(1586,[void 0,void 0,65200]),this.m_singleCharactersMap.set(1587,[65203,65204,65202]),this.m_singleCharactersMap.set(1588,[65207,65208,65206]),this.m_singleCharactersMap.set(1589,[65211,65212,65210]),this.m_singleCharactersMap.set(1590,[65215,65216,65214]),this.m_singleCharactersMap.set(1591,[65219,65220,65218]),this.m_singleCharactersMap.set(1592,[65223,65224,65222]),this.m_singleCharactersMap.set(1593,[65227,65228,65226]),this.m_singleCharactersMap.set(1594,[65231,65232,65230]),this.m_singleCharactersMap.set(1600,[1600,1600,1600]),this.m_singleCharactersMap.set(1601,[65235,65236,65234]),this.m_singleCharactersMap.set(1602,[65239,65240,65238]),this.m_singleCharactersMap.set(1603,[65243,65244,65242]),this.m_singleCharactersMap.set(1604,[65247,65248,65246]),this.m_singleCharactersMap.set(1605,[65251,65252,65250]),this.m_singleCharactersMap.set(1606,[65255,65256,65254]),this.m_singleCharactersMap.set(1607,[65259,65260,65258]),this.m_singleCharactersMap.set(1608,[void 0,void 0,65262]),this.m_singleCharactersMap.set(1609,[void 0,void 0,65264]),this.m_singleCharactersMap.set(1610,[65267,65268,65266]),this.m_singleCharactersMap.set(1662,[64344,64345,64343]),this.m_singleCharactersMap.set(1740,[64510,64511,64509]),this.m_singleCharactersMap.set(1670,[64380,64381,64379]),this.m_singleCharactersMap.set(1705,[64400,64401,64399]),this.m_singleCharactersMap.set(1711,[64404,64405,64403]),this.m_singleCharactersMap.set(1688,[void 0,void 0,64395]),this.m_combinedCharactersMap.set(1604,new Map),this.m_combinedCharactersMap.get(1604).set(1570,[65269,65270]),this.m_combinedCharactersMap.get(1604).set(1571,[65271,65272]),this.m_combinedCharactersMap.get(1604).set(1573,[65273,65274]),this.m_combinedCharactersMap.get(1604).set(1575,[65275,65276]),this.m_neutralCharacters=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}convert(e){let t="";for(let r=0;r<e.length;++r){const s=e.charCodeAt(r);if(this.isArabicCharacter(s)){let o=r-1;for(;o>=0&&this.isNeutral(e.charCodeAt(o));--o);let a=o>=0?e.charCodeAt(o):void 0;if(void 0!==a){const e=this.getCharacterMap(a);(void 0===e||void 0===e[i.Initial]&&void 0===e[i.Medial])&&(a=void 0)}let l=r+1;for(;l<e.length&&this.isNeutral(e.charCodeAt(l));++l);let c=l<e.length?e.charCodeAt(l):void 0;if(void 0!==c){const e=this.getCharacterMap(c);(void 0===e||void 0===e[i.Medial]&&void 0===e[i.Final])&&(c=void 0)}if(1604===s&&void 0!==c&&(1570===c||1571===c||1573===c||1575===c)){const e=this.getCombinedCharacterMap(s,c);t+=void 0!==a?String.fromCharCode(e[n.Connected]):String.fromCharCode(e[n.Isolated]),++r;continue}const h=this.getCharacterMap(s);void 0!==a&&void 0!==c&&void 0!==h[i.Medial]?t+=String.fromCharCode(h[i.Medial]):void 0!==a&&void 0!==h[i.Final]?t+=String.fromCharCode(h[i.Final]):void 0!==c&&void 0!==h[i.Initial]?t+=String.fromCharCode(h[i.Initial]):t+=String.fromCharCode(s)}else t+=String.fromCharCode(s)}return t}isArabicCharacter(e){return this.m_singleCharactersMap.has(e)}getCharacterMap(e){return this.m_singleCharactersMap.get(e)}getCombinedCharacterMap(e,t){const i=this.m_combinedCharactersMap.get(e);if(void 0!==i)return i.get(t)}isNeutral(e){for(const t of this.m_neutralCharacters)if(t===e)return!0;return!1}}t.ContextualArabicConverter=r},3461:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSdfTextMaterial=void 0;const n=i(4420);t.createSdfTextMaterial=function(e){return new n.SdfTextMaterial({texture:e.fontCatalog.texture,textureSize:e.fontCatalog.textureSize,size:e.fontCatalog.size,distanceRange:e.fontCatalog.distanceRange,isMsdf:"msdf"===e.fontCatalog.type,isBackground:!0===e.isBackground,vertexSource:e.vertexSource,fragmentSource:e.fragmentSource,rendererCapabilities:e.rendererCapabilities})}},1741:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypesettingUtils=void 0;const n=i(82),r=i(1662),s=i(8533);var o;(o=t.TypesettingUtils||(t.TypesettingUtils={})).EM_TO_PX=16,o.PT_TO_PX=1.25,o.OBLIQUE_ANGLE=.174533,o.OBLIQUE_OFFSET=Math.tan(o.OBLIQUE_ANGLE),o.getPixelSize=function(e,t,i){let n=e;switch(t){case r.FontUnit.Em:n*=o.EM_TO_PX;break;case r.FontUnit.Point:n*=o.PT_TO_PX;break;case r.FontUnit.Percent:n*=.01*i}return n},o.getSmallCapsScale=function(e,t,i,n){return t[i]&&n===r.FontVariant.SmallCaps?e[i].font.metrics.xHeight/e[i].font.metrics.capHeight:1},o.getDirection=function(e,t){let i=s.UnicodeUtils.Direction.LTR,n=t;for(;e[n].direction!==s.UnicodeUtils.Direction.LTR&&e[n].direction!==s.UnicodeUtils.Direction.RTL&&n<e.length-1;)++n;return 1===Math.abs(e[n].direction)&&(i=e[n].direction),i},o.computeGlyphTransform=function(e,t,i,n,r){const s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r);e.set(i*a,i*-l,s*t.x-o*t.y,i*l,i*a,o*t.x+s*t.y,0,0,1)},o.updateBounds=function(e,t,i){const r=Math.min(e[0].x,e[1].x,e[2].x,e[3].x),s=Math.max(e[0].x,e[1].x,e[2].x,e[3].x),o=Math.min(e[0].y,e[1].y,e[2].y,e[3].y),a=Math.max(e[0].y,e[1].y,e[2].y,e[3].y);void 0!==i&&(void 0!==i.array[i.offset]?(i.array[i.offset].min.set(r,o),i.array[i.offset].max.set(s,a)):i.array.push(new n.Box2(new n.Vector2(r,o),new n.Vector2(s,a))),++i.offset),t.min.set(Math.min(t.min.x,r),Math.min(t.min.y,o)),t.max.set(Math.max(t.max.x,s),Math.max(t.max.y,a))},o.fontSizeAlignmentFactor=.964,o.alignBackgroundWidth=function(e,t){return 11.5*t/Math.sqrt(e)}},8533:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeUtils=void 0,function(e){let t;e.whiteSpaceRanges=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]],e.isWhiteSpace=function(t){for(const i of e.whiteSpaceRanges)if(t>=i[0]&&t<=i[1])return!0;return!1},e.newLineRanges=[[10,13],[133,133],[8232,8233]],e.isNewLine=function(t){for(const i of e.newLineRanges)if(t>=i[0]&&t<=i[1])return!0;return!1},e.nonPrintableRanges=[[0,31],[127,159]],e.isPrintable=function(t){for(const i of e.nonPrintableRanges)if(t>=i[0]&&t<=i[1])return!1;return!0},function(e){e[e.Neutral=0]="Neutral",e[e.Weak=.5]="Weak",e[e.LTR=1]="LTR",e[e.RTL=-1]="RTL"}(t=e.Direction||(e.Direction={})),e.rtlBlocks=["Hebrew","Alphabetic Presentation Forms","Arabic","Arabic Supplement","Arabic Extended-A","Arabic Presentation Forms-A","Arabic Presentation Forms-B","Arabic Mathematical Alphabetic Symbols","Indic Siyaq Numbers","Rumi Numeral Symbols","Syriac","Syriac Supplement","Samaritan","Mandaic","Thaana","Mende Kikakui","NKo","Adlam","Hanifi Rohingya"],e.neutralBidirectionalRanges=[[32,47],[58,64],[91,96],[123,126]],e.weakBidirectionalRanges=[[48,57],[1632,1641],[1776,1785]],e.getDirection=function(i,n){for(const n of e.weakBidirectionalRanges)if(i>=n[0]&&i<=n[1])return t.Weak;for(const n of e.neutralBidirectionalRanges)if(i>=n[0]&&i<=n[1])return t.Neutral;return void 0!==e.rtlBlocks.find((e=>e===n))?t.RTL:t.LTR},e.rtlMirroredCodePoints=[40,41,60,62,91,93,123,125],e.isRtlMirrored=function(t){return void 0!==e.rtlMirroredCodePoints.find((e=>e===t))}}(t.UnicodeUtils||(t.UnicodeUtils={}))},1984:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(7259),t),r(i(8284),t),r(i(1017),t),r(i(1370),t),r(i(1216),t),r(i(5771),t),r(i(8131),t),r(i(6304),t)},1667:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorUtils=void 0;const n=i(82),r=i(797),s=i(7610),o=255,a=new n.Color;var l;(l=t.ColorUtils||(t.ColorUtils={})).getHexFromRgba=function(e,t,i,n){return(0,r.assert)(n>=0&&n<=1),o-Math.floor(n*o)<<24^e*o<<16^t*o<<8^i*o<<0},l.getHexFromRgb=function(e,t,i){return(0,r.assert)(e>=0&&e<=1),(0,r.assert)(t>=0&&t<=1),(0,r.assert)(i>=0&&i<=1),e*o<<16^t*o<<8^i*o<<0},l.getHexFromHsl=function(e,t,i){return(0,r.assert)(e>=0&&e<=1),(0,r.assert)(t>=0&&t<=1),(0,r.assert)(i>=0&&i<=1),a.setHSL(e,t,i).getHex()},l.getRgbaFromHex=function(e,t=new s.RGBA){return(0,r.assert)(0==(0&e),"Wrong hex format"),t.r=(e>>16&o)/o,t.g=(e>>8&o)/o,t.b=(e>>0&o)/o,t.a=(o-(e>>24&o))/o,t},l.hasAlphaInHex=function(e){return(0,r.assert)(0==(0&e),"Wrong hex format"),e>>24!=0},l.getAlphaFromHex=function(e){return(0,r.assert)(0==(0&e),"Wrong hex format"),(o-(e>>24)&o)/o},l.removeAlphaFromHex=function(e){return(0,r.assert)(0==(0&e),"Wrong hex format"),16777215&e}},7259:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapEnv=t.Env=void 0;class i{static isEnv(e){return e instanceof i}lookup(e){}unmap(){return{}}}t.Env=i,t.MapEnv=class extends i{constructor(e,t){super(),this.entries=e,this.parent=t}lookup(e){if(this.entries.hasOwnProperty(e)){const t=this.entries[e];if(void 0!==t)return t}return this.parent?this.parent.lookup(e):void 0}unmap(){const e=this.parent?this.parent.unmap():{};for(const t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e}}},8284:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateJsonExpr=void 0;const n=i(7259),r=i(8023);t.evaluateJsonExpr=function(e,t,i){return r.Expr.fromJSON(e,i).evaluate(new n.MapEnv(t),r.ExprScope.Value)}},8023:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.InterpolateExpr=t.StepExpr=t.CaseExpr=t.MatchExpr=t.LookupExpr=t.CallExpr=t.HasAttributeExpr=t.ObjectLiteralExpr=t.StringLiteralExpr=t.NumberLiteralExpr=t.BooleanLiteralExpr=t.NullLiteralExpr=t.LiteralExpr=t.VarExpr=t.Expr=t.ExprScope=t.ExprDependencies=void 0;const s=i(82),o=i(2302),a=i(908),l=i(8845),c=i(8628),h=i(1017),u=i(1324),d=i(7610),m=i(5771);r(i(7259),t);const p=new o.ExprEvaluator,f=new a.ExprInstantiator;class g{constructor(){this.properties=new Set}}t.ExprDependencies=g;class v{static of(e){const t=new g;return e.accept(this.instance,t),t}visitNullLiteralExpr(e,t){}visitBooleanLiteralExpr(e,t){}visitNumberLiteralExpr(e,t){}visitStringLiteralExpr(e,t){}visitObjectLiteralExpr(e,t){}visitVarExpr(e,t){t.properties.add(e.name)}visitHasAttributeExpr(e,t){t.properties.add(e.name)}visitCallExpr(e,t){switch(e.args.forEach((e=>e.accept(this,t))),e.op){case"dynamic-properties":t.volatile=!0;break;case"feature-state":t.featureState=!0,t.properties.add("$state"),t.properties.add("$id");break;case"id":t.properties.add("$id");break;case"zoom":case"world-ppi-scale":case"world-discrete-ppi-scale":t.properties.add("$zoom");break;case"pixel-world-scale":t.properties.add("$pixelToMeters");break;case"geometry-type":t.properties.add("$geometryType")}}visitLookupExpr(e,t){return this.visitCallExpr(e,t)}visitMatchExpr(e,t){e.value.accept(this,t),e.branches.forEach((([e,i])=>i.accept(this,t))),e.fallback.accept(this,t)}visitCaseExpr(e,t){e.branches.forEach((([e,i])=>{e.accept(this,t),i.accept(this,t)})),e.fallback.accept(this,t)}visitStepExpr(e,t){e.input.accept(this,t),e.defaultValue.accept(this,t),e.stops.forEach((([e,i])=>i.accept(this,t)))}visitInterpolateExpr(e,t){e.input.accept(this,t),e.stops.forEach((([e,i])=>i.accept(this,t)))}}var y;v.instance=new v,function(e){e[e.Value=0]="Value",e[e.Condition=1]="Condition",e[e.Dynamic=2]="Dynamic"}(y=t.ExprScope||(t.ExprScope={}));class _{static isExpr(e){return e instanceof _}static parse(e){return new l.ExprParser(e).parse()}static fromJSON(e,t,i,n){return F(e,void 0!==t?{definitions:t,lockedNames:new Set,cache:null!=i?i:new Map,referencedDefinitions:null!=n?n:new Set}:void 0)}evaluate(e,t=y.Value,i){return this.accept(p,new o.ExprEvaluatorContext(p,e,t,i))}instantiate(e){return this.accept(f,e)}dependencies(){return this.m_dependencies||(this.m_dependencies=v.of(this)),this.m_dependencies}intern(e){return e.add(this)}toJSON(){return(new O).serialize(this)}isDynamic(){return void 0===this.m_isDynamic&&(this.m_isDynamic=this.exprIsDynamic()),this.m_isDynamic}}t.Expr=_;class x extends _{constructor(e){super(),this.name=e}accept(e,t){return e.visitVarExpr(this,t)}exprIsDynamic(){return!1}}t.VarExpr=x;class w extends _{static fromValue(e){switch(typeof e){case"boolean":return new T(e);case"number":return new M(e);case"string":return new S(e);case"object":return null===e?b.instance:new E(e);default:throw new Error(`failed to create a literal from '${e}'`)}}exprIsDynamic(){return!1}}t.LiteralExpr=w;class b extends w{constructor(){super(),this.value=null}accept(e,t){return e.visitNullLiteralExpr(this,t)}exprIsDynamic(){return!1}}t.NullLiteralExpr=b,b.instance=new b;class T extends w{constructor(e){super(),this.value=e}accept(e,t){return e.visitBooleanLiteralExpr(this,t)}}t.BooleanLiteralExpr=T;class M extends w{constructor(e){super(),this.value=e}accept(e,t){return e.visitNumberLiteralExpr(this,t)}}t.NumberLiteralExpr=M;class S extends w{constructor(e){super(),this.value=e}get promotedValue(){var e,t,i;return void 0===this.m_promotedValue&&(this.m_promotedValue=null!==(t=null!==(e=d.RGBA.parse(this.value))&&void 0!==e?e:u.Pixels.parse(this.value))&&void 0!==t?t:null),null!==(i=this.m_promotedValue)&&void 0!==i?i:void 0}accept(e,t){return e.visitStringLiteralExpr(this,t)}}t.StringLiteralExpr=S;class E extends w{constructor(e){super(),this.value=e}get isArrayLiteral(){return Array.isArray(this.value)}accept(e,t){return e.visitObjectLiteralExpr(this,t)}}t.ObjectLiteralExpr=E;class A extends _{constructor(e){super(),this.name=e}accept(e,t){return e.visitHasAttributeExpr(this,t)}exprIsDynamic(){return!1}}t.HasAttributeExpr=A;class C extends _{constructor(e,t){super(),this.op=e,this.args=t}get children(){return this.args}accept(e,t){return e.visitCallExpr(this,t)}exprIsDynamic(){var e;const t=null!==(e=this.descriptor)&&void 0!==e?e:o.ExprEvaluator.getOperator(this.op);return!!(t&&t.isDynamicOperator&&t.isDynamicOperator(this))||this.args.some((e=>e.isDynamic()))}}t.CallExpr=C;class P extends C{static parseArray(e,t){const i=e[1];if(void 0===i)throw new Error("missing lookup table in 'lookup' expression");const n=F(i,t);if(!(Array.isArray(i)&&n instanceof E))throw new Error("Invalid lookup table expression for operator 'lookup'. It must be a literal or a ref to one.");const r=n.value;if(!(Array.isArray(r)||r instanceof Map))throw new Error(`Invalid lookup table type (${typeof r}) for operator 'lookup'`);const s=e.slice(2).map((e=>F(e,t)));return s.unshift(n),new P(s)}constructor(e){super("lookup",e),this.args=e}accept(e,t){return e.visitLookupExpr(this,t)}}t.LookupExpr=P;class L extends _{static isValidMatchLabel(e){switch(typeof e){case"number":case"string":return!0;case"object":if(!Array.isArray(e)||0===e.length)return!1;const t=typeof e[0];return("number"===t||"string"===t)&&e.every((e=>typeof e===t));default:return!1}}constructor(e,t,i){super(),this.value=e,this.branches=t,this.fallback=i}accept(e,t){return e.visitMatchExpr(this,t)}exprIsDynamic(){return this.value.isDynamic()||this.branches.some((([e,t])=>t.isDynamic()))||this.fallback.isDynamic()}}t.MatchExpr=L;class R extends _{constructor(e,t){super(),this.branches=e,this.fallback=t}accept(e,t){return e.visitCaseExpr(this,t)}exprIsDynamic(){return this.branches.some((([e,t])=>e.isDynamic()||t.isDynamic()))||this.fallback.isDynamic()}}t.CaseExpr=R;class D extends _{constructor(e,t,i){super(),this.input=e,this.defaultValue=t,this.stops=i}accept(e,t){return e.visitStepExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.defaultValue.isDynamic()||this.stops.some((([e,t])=>t.isDynamic()))}}t.StepExpr=D;class I extends _{constructor(e,t,i){super(),this.mode=e,this.input=t,this.stops=i}accept(e,t){return e.visitInterpolateExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.stops.some((([e,t])=>t.isDynamic()))}}t.InterpolateExpr=I;class O{serialize(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value instanceof s.Vector2?["make-vector",e.value.x,e.value.y]:e.value instanceof s.Vector3?["make-vector",e.value.x,e.value.y,e.value.z]:e.value instanceof s.Vector4?["make-vector",e.value.x,e.value.y,e.value.z,e.value.w]:["literal",e.value]}visitVarExpr(e,t){return["get",e.name]}visitHasAttributeExpr(e,t){return["has",e.name]}visitCallExpr(e,t){return[e.op,...e.args.map((e=>this.serialize(e)))]}visitLookupExpr(e,t){return this.visitCallExpr(e,t)}visitMatchExpr(e,t){const i=[];for(const[t,n]of e.branches)i.push(t,this.serialize(n));return["match",this.serialize(e.value),...i,this.serialize(e.fallback)]}visitCaseExpr(e,t){const i=[];for(const[t,n]of e.branches)i.push(this.serialize(t),this.serialize(n));return["case",...i,this.serialize(e.fallback)]}visitStepExpr(e,t){const i=["step"];return i.push(this.serialize(e.input)),i.push(this.serialize(e.defaultValue)),e.stops.forEach((([e,t])=>{i.push(e),i.push(this.serialize(t))})),i}visitInterpolateExpr(e,t){const i=["interpolate",e.mode];return i.push(this.serialize(e.input)),e.stops.forEach((([e,t])=>{i.push(e),i.push(this.serialize(t))})),i}}function F(e,t){if(Array.isArray(e))return V(e,t);if(null===e)return b.instance;if("boolean"==typeof e)return new T(e);if("number"==typeof e)return new M(e);if("string"==typeof e)return new S(e);throw new Error(`failed to create expression from: ${JSON.stringify(e)}`)}function V(e,t){const i=e[0];if("string"!=typeof i)throw new Error("expected a builtin function name");switch(i){case"!has":case"!in":return new C("!",[V([i.slice(1),...e.slice(1)])]);case"ref":return function(e,t){if("string"!=typeof e[1])throw new Error("expected the name of an attribute");if(void 0===t)throw new Error("ref used with no definitions");const i=e[1];if(t.lockedNames.has(i))throw new Error(`circular referene to '${i}'`);if(!(i in t.definitions))throw new Error(`definition '${i}' not found`);t.referencedDefinitions.add(i);const n=t.cache.get(i);if(void 0!==n)return n;let r,s=t.definitions[i];const o=(0,m.getDefinitionValue)(s);if((0,c.isInterpolatedPropertyDefinition)(o))return _.fromJSON((0,c.interpolatedPropertyDefinitionToJsonExpr)(s));if(!(0,h.isJsonExpr)(o))return _.fromJSON(o);if(s=o,!(0,h.isJsonExpr)(s))throw new Error(`unsupported definition ${i}`);t.lockedNames.add(i);try{r=F(s,t)}finally{t.lockedNames.delete(i)}return t.cache.set(i,r),r}(e,t);case"get":return function(e,t){if(void 0!==e[2])return U("get",e,t);const i=e[1];if("string"!=typeof i)throw new Error("expected the name of an attribute");return new x(i)}(e,t);case"has":return function(e,t){if(void 0!==e[2])return U("has",e,t);const i=e[1];if("string"!=typeof i)throw new Error("expected the name of an attribute");return new A(i)}(e,t);case"literal":return function(e){const t=e[1];if(null===t||"object"!=typeof t)throw new Error("expected an object or array literal");return new E(t)}(e);case"match":return function(e,t){if(e.length<4)throw new Error("not enough arguments");if(!(e.length%2))throw new Error("fallback is missing in 'match' expression");const i=F(e[1],t),n=[];for(let i=2;i<e.length-1;i+=2){const r=e[i];if(!L.isValidMatchLabel(r))throw new Error(`'${JSON.stringify(r)}' is not a valid label for 'match'`);const s=F(e[i+1],t);n.push([r,s])}const r=F(e[e.length-1],t);return new L(i,n,r)}(e,t);case"case":return function(e,t){if(e.length<3)throw new Error("not enough arguments");if(e.length%2)throw new Error("fallback is missing in 'case' expression");const i=[];for(let n=1;n<e.length-1;n+=2){const r=F(e[n],t),s=F(e[n+1],t);i.push([r,s])}const n=F(e[e.length-1],t);return new R(i,n)}(e,t);case"interpolate":return function(e,t){const i=e[1];if(!function(e){if(!Array.isArray(e))return!1;switch(e[0]){case"discrete":case"linear":case"cubic":case"exponential":return!0;default:return!1}}(i))throw new Error("expected an interpolation type");if("exponential"===i[0]&&"number"!=typeof i[1])throw new Error("expected the base of the exponential interpolation");const n=void 0!==e[2]?F(e[2],t):void 0;if(!_.isExpr(n))throw new Error("expected the input of the interpolation");if(3===e.length||!(e.length%2))throw new Error("invalid number of samples");const r=[];for(let i=3;i<e.length-1;i+=2){const n=e[i],s=F(e[i+1],t);r.push([n,s])}return new I(i,n,r)}(e,t);case"step":return function(e,t){if(e.length<2)throw new Error("expected the input of the 'step' operator");if(e.length<3||!(e.length%2))throw new Error("not enough arguments");const i=F(e[1],t),n=F(e[2],t),r=[];for(let i=3;i<e.length;i+=2){const n=e[i],s=F(e[i+1],t);r.push([n,s])}return new D(i,n,r)}(e,t);case"lookup":return P.parseArray(e,t);default:return U(i,e,t)}}function U(e,t,i){return new C(e,t.slice(1).map((e=>F(e,i))))}},2302:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprEvaluator=t.ExprEvaluatorContext=void 0;const n=i(82),r=i(8023),s=i(6073),o=i(7290),a=i(4672),l=i(8998),c=i(1954),h=i(2181),u=i(202),d=i(4054),m=i(9764),p=i(7029),f=i(3501),g=i(5113),v=i(545),y=i(1324),_=i(7610),x=new Map;function w(e,t){var i,n,s;if(t instanceof r.StringLiteralExpr)return null!==(i=t.promotedValue)&&void 0!==i?i:t.value;const o=e.evaluate(t);return"string"==typeof o&&null!==(s=null!==(n=_.RGBA.parse(o))&&void 0!==n?n:y.Pixels.parse(o))&&void 0!==s?s:o}t.ExprEvaluatorContext=class{constructor(e,t,i,n){this.evaluator=e,this.env=t,this.scope=i,this.cache=n}evaluate(e){var t,i;if(void 0===e)throw new Error("Failed to evaluate expression");const n=null===(t=this.cache)||void 0===t?void 0:t.get(e);if(void 0!==n)return n;const r=e.accept(this.evaluator,this);return null===(i=this.cache)||void 0===i||i.set(e,r),r}wrapValue(e){return r.Expr.isExpr(e)?e:r.LiteralExpr.fromValue(e)}};class b{static defineOperator(e,t){x.set(e,t)}static defineOperators(e){Object.getOwnPropertyNames(e).forEach((t=>{this.defineOperator(t,e[t])}))}static getOperator(e){return x.get(e)}visitVarExpr(e,t){const i=t.env.lookup(e.name);return void 0!==i?i:null}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value}visitHasAttributeExpr(e,t){return void 0!==t.env.lookup(e.name)}visitMatchExpr(e,t){const i=t.evaluate(e.value);for(const[n,r]of e.branches){if(Array.isArray(n)&&n.includes(i))return t.evaluate(r);if(n===i)return t.evaluate(r)}return t.evaluate(e.fallback)}visitCaseExpr(e,t){if(t.scope===r.ExprScope.Value){const i=e.branches.findIndex((([e,t])=>e.isDynamic()));if(-1!==i){let n;for(let s=0;s<e.branches.length;++s){const[o,a]=e.branches[s],l=t.evaluate(o),c=t.evaluate(a);if(s<i&&Boolean(l))return c;if((r.Expr.isExpr(l)||Boolean(l))&&(void 0===n&&(n=[]),null==n||n.push([t.wrapValue(l),t.wrapValue(c)]),!r.Expr.isExpr(l)&&Boolean(l)))return new r.CaseExpr(n,r.LiteralExpr.fromValue(null))}const s=t.evaluate(e.fallback);return void 0===n?s:new r.CaseExpr(n,t.wrapValue(s))}}for(const[i,n]of e.branches)if(t.evaluate(i))return t.evaluate(n);return t.evaluate(e.fallback)}visitCallExpr(e,t){var i;const n=null!==(i=e.descriptor)&&void 0!==i?i:x.get(e.op);if(n){let i;if(e.descriptor=n,t.scope===r.ExprScope.Value&&e.isDynamic()){if(e.descriptor.partialEvaluate)return e.descriptor.partialEvaluate(t,e);const n=e.args.map((e=>t.wrapValue(t.evaluate(e))));if(n.every(((t,i)=>t===e.args[i])))return e;i=new r.CallExpr(e.op,n)}else i=n.call(t,e);return i}throw new Error(`undefined operator '${e.op}'`)}visitLookupExpr(e,t){return this.visitCallExpr(e,t)}visitStepExpr(e,t){if(t.scope===r.ExprScope.Value){const i=t.evaluate(e.input),n=t.evaluate(e.defaultValue);return new r.StepExpr(t.wrapValue(i),t.wrapValue(n),e.stops.map((([e,i])=>{const n=t.evaluate(i);return[e,t.wrapValue(n)]})))}{const i=t.evaluate(e.input);if("number"!=typeof i)throw new Error(`input '${i}' must be a number`);if(i<e.stops[0][0])return t.evaluate(e.defaultValue);let n=e.stops.findIndex((e=>e[0]>i));return-1===n&&(n=e.stops.length),t.evaluate(e.stops[n-1][1])}}visitInterpolateExpr(e,t){if(t.scope===r.ExprScope.Value){const i=t.evaluate(e.input);return new r.InterpolateExpr(e.mode,t.wrapValue(i),e.stops.map((([e,i])=>{const n=t.evaluate(i);return[e,t.wrapValue(n)]})))}{const i=t.evaluate(e.input);if("number"!=typeof i)throw new Error("input must be a number");if("cubic"===e.mode[0])return function(e,t,i){if(i<t.stops[0][0])return w(e,t.stops[0][1]);if(i>=t.stops[t.stops.length-1][0])return w(e,t.stops[t.stops.length-1][1]);const r=t.stops.findIndex((e=>e[0]>i)),s=Math.max(0,r-1),o=0===s?r:s-1,a=r<t.stops.length-1?r+1:r-1,l=t.stops[o][0],c=t.stops[s][0],h=t.stops[r][0],u=.5*(h-c),d=u/(c-l),m=u/(t.stops[a][0]-h),p=(i-c)/(h-c),f=p*p,g=f*p,v=-d*g+2*d*f-d*p,x=(1+d)*g+(-1.5-2*d)*f+(-.5+d)*p+1,b=(-1-m)*g+(1.5+m)*f+.5*p,T=m*g-m*f,M=w(e,t.stops[o][1]),S=w(e,t.stops[s][1]),E=w(e,t.stops[r][1]),A=w(e,t.stops[a][1]);if("number"==typeof M&&"number"==typeof S&&"number"==typeof E&&"number"==typeof A)return v*M+x*S+b*E+T*A;if(M instanceof _.RGBA&&S instanceof _.RGBA&&E instanceof _.RGBA&&A instanceof _.RGBA)return new _.RGBA(n.MathUtils.clamp(v*M.r+x*S.r+b*E.r+T*A.r,0,1),n.MathUtils.clamp(v*M.g+x*S.g+b*E.g+T*A.g,0,1),n.MathUtils.clamp(v*M.b+x*S.b+b*E.b+T*A.b,0,1),n.MathUtils.clamp(v*M.a+x*S.a+b*E.a+T*A.a,0,1));if(M instanceof y.Pixels&&S instanceof y.Pixels&&E instanceof y.Pixels&&A instanceof y.Pixels)return new y.Pixels(v*M.value+x*S.value+b*E.value+T*A.value);if(M instanceof n.Color&&S instanceof n.Color&&E instanceof n.Color&&A instanceof n.Color)return new n.Color(v*M.r+x*S.r+b*E.r+T*A.r,v*M.g+x*S.g+b*E.g+T*A.g,v*M.b+x*S.b+b*E.b+T*A.b);if(M instanceof n.Vector2&&S instanceof n.Vector2&&E instanceof n.Vector2&&A instanceof n.Vector2)return new n.Vector2(v*M.x+x*S.x+b*E.x+T*A.x,v*M.y+x*S.y+b*E.y+T*A.y);if(M instanceof n.Vector3&&S instanceof n.Vector3&&E instanceof n.Vector3&&A instanceof n.Vector3)return new n.Vector3(v*M.x+x*S.x+b*E.x+T*A.x,v*M.y+x*S.y+b*E.y+T*A.y,v*M.z+x*S.z+b*E.z+T*A.z);if(M instanceof n.Vector4&&S instanceof n.Vector4&&E instanceof n.Vector4&&A instanceof n.Vector4)return new n.Vector4(v*M.x+x*S.x+b*E.x+T*A.x,v*M.y+x*S.y+b*E.y+T*A.y,v*M.z+x*S.z+b*E.z+T*A.z,v*M.w+x*S.w+b*E.w+T*A.w);if(Array.isArray(M)&&Array.isArray(S)&&Array.isArray(E)&&Array.isArray(A)){const e=M.length,t=[];for(let i=0;i<e;++i)t[i]=v*M[i]+x*S[i]+b*E[i]+T*A[i];return t}throw new Error("failed to interpolate values")}(t,e,i);const r=e.stops.findIndex((e=>e[0]>i));if(-1===r)return t.evaluate(e.stops[e.stops.length-1][1]);if(0===r)return t.evaluate(e.stops[0][1]);const[s,o]=e.stops[r],[a,l]=e.stops[r-1],c=w(t,l);let h=0;switch(e.mode[0]){case"discrete":return c;case"linear":h=(i-a)/(s-a);break;case"exponential":{const t=e.mode[1];h=1===t?(i-a)/(s-a):(Math.pow(t,i-a)-1)/(Math.pow(t,s-a)-1);break}default:throw new Error(`interpolation mode ${JSON.stringify(e.mode)} is not supported`)}const u=w(t,o);if("number"==typeof c&&"number"==typeof u)return n.MathUtils.lerp(c,u,h);if(c instanceof _.RGBA&&u instanceof _.RGBA)return c.clone().lerp(u,h);if(c instanceof y.Pixels&&u instanceof y.Pixels)return new y.Pixels(n.MathUtils.lerp(c.value,u.value,h));if(c instanceof n.Color&&u instanceof n.Color)return c.clone().lerp(u,h);if(c instanceof n.Vector2&&u instanceof n.Vector2)return c.clone().lerp(u,h);if(c instanceof n.Vector3&&u instanceof n.Vector3)return c.clone().lerp(u,h);if(c instanceof n.Vector4&&u instanceof n.Vector4)return c.clone().lerp(u,h);if(Array.isArray(c)&&Array.isArray(u)&&c.length===u.length)return c.map(((e,t)=>n.MathUtils.lerp(e,u[t],h)));throw new Error(`todo: mix(${JSON.stringify(c)}, ${JSON.stringify(u)}, ${h})`)}}}t.ExprEvaluator=b,b.defineOperators(o.CastOperators),b.defineOperators(l.ComparisonOperators),b.defineOperators(d.MathOperators),b.defineOperators(f.StringOperators),b.defineOperators(a.ColorOperators),b.defineOperators(g.TypeOperators),b.defineOperators(m.MiscOperators),b.defineOperators(h.FlowOperators),b.defineOperators(s.ArrayOperators),b.defineOperators(p.ObjectOperators),b.defineOperators(c.FeatureOperators),b.defineOperators(u.MapOperators),b.defineOperators(v.VectorOperators)},908:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprInstantiator=void 0;const n=i(7259),r=i(8023),s=new n.Env;t.ExprInstantiator=class{visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const i=t.env.lookup(e.name);return r.LiteralExpr.fromValue(void 0!==i?i:null)}visitHasAttributeExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const i=void 0!==t.env.lookup(e.name);return r.LiteralExpr.fromValue(i)}visitCallExprImpl(e,t,i){const n=e.args.map((e=>e.accept(this,t)));return n.some(((t,i)=>t!==e.args[i]))?i(e.op,n):e}visitCallExpr(e,t){return this.visitCallExprImpl(e,t,((e,t)=>new r.CallExpr(e,t)))}visitLookupExpr(e,t){return this.visitCallExprImpl(e,t,((e,t)=>new r.LookupExpr(t)))}visitMatchExpr(e,t){const i=e.value.accept(this,t);if(i instanceof r.LiteralExpr){const n=i.value;for(const[i,r]of e.branches){if(Array.isArray(i)&&i.includes(n))return r.accept(this,t);if(i===n)return r.accept(this,t)}return e.fallback.accept(this,t)}let n=e.value!==i;const s=e.branches.map((([e,i])=>{const r=i.accept(this,t);return r!==i&&(n=!0),[e,r]})),o=e.fallback.accept(this,t);return o!==e.fallback&&(n=!0),n?new r.MatchExpr(i,s,o):e}visitCaseExpr(e,t){const i=[];let n=!1;for(const[o,a]of e.branches){const e=o.accept(this,t),l=e.dependencies();if(o.isDynamic()||0!==l.properties.size)e!==o&&(n=!0),i.push([e,a]);else if(Boolean(e.evaluate(s,r.ExprScope.Condition)))return a.accept(this,t)}if(0===i.length)return e.fallback.accept(this,t);i.length!==e.branches.length&&(n=!0),i.forEach((e=>{const i=e[1].accept(this,t);i!==e[1]&&(n=!0),e[1]=i}));const o=e.fallback.accept(this,t);return o!==e.fallback&&(n=!0),n?new r.CaseExpr(i,o):e}visitStepExpr(e,t){const i=e.input.accept(this,t),n=e.defaultValue.accept(this,t),s=e.stops.map((([e,i])=>[e,i.accept(this,t)]));return new r.StepExpr(i,n,s)}visitInterpolateExpr(e,t){const i=e.input.accept(this,t),n=e.stops.map((([e,i])=>[e,i.accept(this,t)]));return new r.InterpolateExpr(e.mode,i,n)}}},8845:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprParser=void 0;const n=i(8023);var r,s;function o(e){switch(e){case r.Tab:case r.Lf:case r.Cr:case r.Space:return!0;default:return!1}}function a(e){return e>=r._0&&e<=r._9}function l(e){return e>=r.a&&e<=r.z||e>=r.A&&e<=r.Z}function c(e){return function(e){return l(e)||a(e)}(e)||e===r._||e===r.Dollar||e===r.Dot||e===r.LBracket||e===r.RBracket}function h(e){switch(e){case s.Eof:return"eof";case s.Error:return"error";case s.Identifier:return"identifier";case s.Number:return"number";case s.String:return"string";case s.Comma:return",";case s.LParen:return"(";case s.RParen:return")";case s.LBracket:return"[";case s.RBracket:return"]";case s.Exclaim:return"!";case s.TildeEqual:return"~=";case s.CaretEqual:return"^=";case s.DollarEqual:return"$=";case s.EqualEqual:return"==";case s.ExclaimEqual:return"!=";case s.Less:return"<";case s.Greater:return">";case s.LessEqual:return"<=";case s.GreaterEqual:return">=";case s.BarBar:return"||";case s.AmpAmp:return"&&";default:throw new Error(`invalid token ${e}`)}}!function(e){e[e.Tab=9]="Tab",e[e.Lf=10]="Lf",e[e.Cr=13]="Cr",e[e.Space=32]="Space",e[e.LParen=40]="LParen",e[e.RParen=41]="RParen",e[e.Comma=44]="Comma",e[e.Dot=46]="Dot",e[e.LBracket=91]="LBracket",e[e.Backslash=92]="Backslash",e[e.RBracket=93]="RBracket",e[e._0=48]="_0",e[e._9=57]="_9",e[e._=95]="_",e[e.A=64]="A",e[e.Z=90]="Z",e[e.a=97]="a",e[e.z=122]="z",e[e.DoubleQuote=34]="DoubleQuote",e[e.SingleQuote=39]="SingleQuote",e[e.Exclaim=33]="Exclaim",e[e.Equal=61]="Equal",e[e.Caret=94]="Caret",e[e.Tilde=126]="Tilde",e[e.Dollar=36]="Dollar",e[e.Less=60]="Less",e[e.Greater=62]="Greater",e[e.Bar=124]="Bar",e[e.Amp=38]="Amp"}(r||(r={})),function(e){e[e.Eof=0]="Eof",e[e.Error=1]="Error",e[e.Identifier=2]="Identifier",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Comma=5]="Comma",e[e.LParen=6]="LParen",e[e.RParen=7]="RParen",e[e.LBracket=8]="LBracket",e[e.RBracket=9]="RBracket",e[e.Exclaim=10]="Exclaim",e[e.TildeEqual=11]="TildeEqual",e[e.CaretEqual=12]="CaretEqual",e[e.DollarEqual=13]="DollarEqual",e[e.EqualEqual=14]="EqualEqual",e[e.ExclaimEqual=15]="ExclaimEqual",e[e.Less=16]="Less",e[e.Greater=17]="Greater",e[e.LessEqual=18]="LessEqual",e[e.GreaterEqual=19]="GreaterEqual",e[e.BarBar=20]="BarBar",e[e.AmpAmp=21]="AmpAmp"}(s||(s={}));class u{constructor(e){this.code=e,this.m_token=s.Error,this.m_index=0,this.m_char=r.Lf}token(){return this.m_token}text(){var e;return null!==(e=this.m_text)&&void 0!==e?e:""}next(){if(this.m_token=this.yylex(),this.m_token===s.Error)throw new Error(`unexpected character ${this.m_char}`);return this.m_token}yyinp(){var e;this.m_char=null!==(e=this.code.codePointAt(this.m_index++))&&void 0!==e?e:0}yylex(){for(this.m_text=void 0;o(this.m_char);)this.yyinp();if(0===this.m_char)return s.Eof;const e=this.m_char;switch(this.yyinp(),e){case r.LParen:return s.LParen;case r.RParen:return s.RParen;case r.LBracket:return s.LBracket;case r.RBracket:return s.RBracket;case r.Comma:return s.Comma;case r.SingleQuote:case r.DoubleQuote:{const t=this.m_index-1;for(;this.m_char&&this.m_char!==e;)this.yyinp();if(this.m_char!==e)throw new Error("Unfinished string literal");return this.yyinp(),this.m_text=this.code.substring(t,this.m_index-2),s.String}case r.Exclaim:return this.m_char===r.Equal?(this.yyinp(),s.ExclaimEqual):s.Exclaim;case r.Caret:return this.m_char===r.Equal?(this.yyinp(),s.CaretEqual):s.Error;case r.Tilde:return this.m_char===r.Equal?(this.yyinp(),s.TildeEqual):s.Error;case r.Equal:return this.m_char===r.Equal?(this.yyinp(),s.EqualEqual):s.Error;case r.Less:return this.m_char===r.Equal?(this.yyinp(),s.LessEqual):s.Less;case r.Greater:return this.m_char===r.Equal?(this.yyinp(),s.GreaterEqual):s.Greater;case r.Bar:return this.m_char===r.Bar?(this.yyinp(),s.BarBar):s.Error;case r.Amp:return this.m_char===r.Amp?(this.yyinp(),s.AmpAmp):s.Error;default:{const t=this.m_index-2;if(l(e)||e===r._||e===r.Dollar&&c(this.m_char)){for(;c(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),s.Identifier}if(a(e)){for(;a(this.m_char);)this.yyinp();if(this.m_char===r.Dot)for(this.yyinp();a(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),s.Number}if(e===r.Dollar)return this.m_char===r.Equal?(this.yyinp(),s.DollarEqual):s.Error}}return s.Error}}function d(e){switch(e){case s.TildeEqual:return"~=";case s.CaretEqual:return"^=";case s.DollarEqual:return"$=";case s.EqualEqual:return"==";case s.ExclaimEqual:return"!=";default:return}}function m(e){switch(e){case s.Less:return"<";case s.Greater:return">";case s.LessEqual:return"<=";case s.GreaterEqual:return">=";default:return}}t.ExprParser=class{constructor(e){this.lex=new u(e),this.lex.next()}parse(){return this.parseLogicalOr()}yyexpect(e){if(this.lex.token()!==e)throw new Error(`Syntax error: Expected token '${h(e)}' but found '${h(this.lex.token())}'`);this.lex.next()}parsePrimary(){switch(this.lex.token()){case s.Identifier:{const e=this.lex.text();switch(e){case"has":this.lex.next(),this.yyexpect(s.LParen);const t=this.lex.text();return this.yyexpect(s.Identifier),this.yyexpect(s.RParen),new n.HasAttributeExpr(t);case"length":this.lex.next(),this.yyexpect(s.LParen);const i=this.parseLogicalOr();return this.yyexpect(s.RParen),new n.CallExpr("length",[i]);default:const r=new n.VarExpr(e);return this.lex.next(),r}}case s.LParen:{this.lex.next();const e=this.parseLogicalOr();return this.yyexpect(s.RParen),e}default:return this.parseLiteral()}}parseLiteral(){switch(this.lex.token()){case s.Number:{const e=new n.NumberLiteralExpr(parseFloat(this.lex.text()));return this.lex.next(),e}case s.String:{const e=new n.StringLiteralExpr(this.lex.text());return this.lex.next(),e}default:throw new Error("Syntax error")}}parseUnary(){return this.lex.token()===s.Exclaim?(this.lex.next(),new n.CallExpr("!",[this.parseUnary()])):this.parsePrimary()}parseRelational(){let e=this.parseUnary();for(;;)if(this.lex.token()===s.Identifier&&"in"===this.lex.text()){this.lex.next(),this.yyexpect(s.LBracket);const t=[this.parseLiteral()];for(;this.lex.token()===s.Comma;)this.lex.next(),t.push(this.parseLiteral());this.yyexpect(s.RBracket),e=new n.CallExpr("in",[e,n.LiteralExpr.fromValue(t.map((({value:e})=>e)))])}else{const t=m(this.lex.token());if(void 0===t)break;this.lex.next();const i=this.parseUnary();e=new n.CallExpr(t,[e,i])}return e}parseEquality(){let e=this.parseRelational();for(;;){let t=d(this.lex.token());if(void 0===t)break;"~="===t&&(t="in"),this.lex.next();const i=this.parseRelational();e=new n.CallExpr(t,[e,i])}return e}parseLogicalAnd(){const e=this.parseEquality();if(this.lex.token()!==s.AmpAmp)return e;const t=[e];do{this.lex.next(),t.push(this.parseEquality())}while(this.lex.token()===s.AmpAmp);return new n.CallExpr("all",t)}parseLogicalOr(){const e=this.parseLogicalAnd();if(this.lex.token()!==s.BarBar)return e;const t=[e];do{this.lex.next(),t.push(this.parseLogicalAnd())}while(this.lex.token()===s.BarBar);return new n.CallExpr("any",t)}}},8797:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprPool=void 0;const n=i(8023);t.ExprPool=class{constructor(){this.m_booleanLiterals=new Map,this.m_numberLiterals=new Map,this.m_stringLiterals=new Map,this.m_objectLiterals=new Map,this.m_arrayLiterals=[],this.m_varExprs=new Map,this.m_hasAttributeExprs=new Map,this.m_matchExprs=[],this.m_caseExprs=[],this.m_interpolateExprs=[],this.m_stepExprs=[],this.m_callExprs=new Map}add(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return n.NullLiteralExpr.instance}visitBooleanLiteralExpr(e,t){return this.m_booleanLiterals.get(e.value)||(this.m_booleanLiterals.set(e.value,e),e)}visitNumberLiteralExpr(e,t){return this.m_numberLiterals.get(e.value)||(this.m_numberLiterals.set(e.value,e),e)}visitStringLiteralExpr(e,t){return this.m_stringLiterals.get(e.value)||(this.m_stringLiterals.set(e.value,e),e)}visitObjectLiteralExpr(e,t){const i=this.m_objectLiterals.get(e.value);if(i)return i;if(Array.isArray(e.value)){const t=e.value,i=this.m_arrayLiterals.find((e=>{const i=e.value;return i.length===t.length&&t.every(((e,t)=>e===i[t]))}));if(void 0!==i)return i;this.m_arrayLiterals.push(e)}return this.m_objectLiterals.set(e.value,e),e}visitVarExpr(e,t){return this.m_varExprs.get(e.name)||(this.m_varExprs.set(e.name,e),e)}visitHasAttributeExpr(e,t){return this.m_hasAttributeExprs.get(e.name)||(this.m_hasAttributeExprs.set(e.name,e),e)}visitMatchExpr(e,t){const i=e.value.accept(this,t),r=e.branches.map((([e,i])=>[e,i.accept(this,t)])),s=e.fallback.accept(this,t);for(const e of this.m_matchExprs){if(e.value!==i)continue;if(e.fallback!==s)continue;if(e.branches.length!==r.length)continue;let t=!0;for(let i=0;i<r.length;i++)if(r[i][0]!==e.branches[i][0]||r[i][1]!==e.branches[i][1]){t=!1;break}if(t)return e}const o=new n.MatchExpr(i,r,s);return this.m_matchExprs.push(o),o}visitCaseExpr(e,t){const i=e.branches.map((([e,i])=>[e.accept(this,t),i.accept(this,t)])),r=e.fallback.accept(this,t);for(const e of this.m_caseExprs){if(e.fallback!==r)continue;if(e.branches.length!==i.length)continue;let t=!0;for(let n=0;n<i.length;n++)if(i[n][0]!==e.branches[n][0]||i[n][1]!==e.branches[n][1]){t=!1;break}if(t)return e}const s=new n.CaseExpr(i,r);return this.m_caseExprs.push(s),s}visitCallExprImpl(e,t,i){const n=e.args.map((e=>e.accept(this,t)));this.m_callExprs.has(e.op)||this.m_callExprs.set(e.op,[]);const r=this.m_callExprs.get(e.op);for(const e of r){if(e.args.length!==n.length)continue;let t=0;for(;t<e.args.length&&e.args[t]===n[t];++t);if(t===e.args.length)return e}const s=i(e.op,n);return s.descriptor=e.descriptor,r.push(s),s}visitCallExpr(e,t){return this.visitCallExprImpl(e,t,((e,t)=>new n.CallExpr(e,t)))}visitLookupExpr(e,t){return this.visitCallExprImpl(e,t,((e,t)=>new n.LookupExpr(t)))}visitStepExpr(e,t){if(this.m_stepExprs.includes(e))return e;const i=e.input.accept(this,t),r=e.defaultValue.accept(this,t),s=e.stops.map((e=>{const i=e[0],n=e[1].accept(this,t);return n===e[1]?e:[i,n]}));for(const e of this.m_stepExprs)if(e.input===i&&e.defaultValue===r&&s.length===e.stops.length&&s.every((([t,i],n)=>t===e.stops[n][0]&&i===e.stops[n][1])))return e;const o=new n.StepExpr(i,r,s);return this.m_stepExprs.push(o),o}visitInterpolateExpr(e,t){if(this.m_interpolateExprs.includes(e))return e;const i=e.input.accept(this,t),r=e.stops.map((e=>{const i=e[0],n=e[1].accept(this,t);return n===e[1]?e:[i,n]}));for(const t of this.m_interpolateExprs)if(t.input===i&&t.mode[0]===e.mode[0]&&t.mode[1]===e.mode[1]&&r.length===t.stops.length&&r.every((([e,i],n)=>e===t.stops[n][0]&&i===t.stops[n][1])))return t;const s=new n.InterpolateExpr(e.mode,i,r);return this.m_interpolateExprs.push(s),s}}},8628:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.interpolatedPropertyDefinitionToJsonExpr=t.isInterpolatedPropertyDefinition=t.InterpolationMode=void 0,(i=t.InterpolationMode||(t.InterpolationMode={}))[i.Discrete=0]="Discrete",i[i.Linear=1]="Linear",i[i.Cubic=2]="Cubic",i[i.Exponential=3]="Exponential",t.isInterpolatedPropertyDefinition=function(e){return!!(e&&void 0===e.interpolationMode&&Array.isArray(e.values)&&e.values.length>0&&void 0!==e.values[0]&&Array.isArray(e.zoomLevels)&&e.zoomLevels.length>0&&void 0!==e.zoomLevels[0]&&e.values.length===e.zoomLevels.length)},t.interpolatedPropertyDefinitionToJsonExpr=function(e){if(void 0===e.interpolation||"Discrete"===e.interpolation){const t=["step",["zoom"],e.values[0]];for(let i=1;i<e.zoomLevels.length;++i)t.push(e.zoomLevels[i],e.values[i]);return t}const t=["interpolate"];switch(e.interpolation){case"Linear":t.push(["linear"]);break;case"Cubic":t.push(["cubic"]);break;case"Exponential":t.push(["exponential",void 0!==e.exponent?e.exponent:2]);break;default:throw new Error(`interpolation mode '${e.interpolation}' is not supported`)}t.push(["zoom"]);for(let i=0;i<e.zoomLevels.length;++i)t.push(e.zoomLevels[i],e.values[i]);return t}},1017:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isJsonExpr=void 0,t.isJsonExpr=function(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]}},1324:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pixels=void 0;const i=/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))px$/;class n{static parse(e){const t=i.exec(e);if(null!==t)return new n(Number(t[1]))}constructor(e){this.value=e}toJSON(){return`${this.value}px`}}t.Pixels=n},7610:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RGBA=void 0;const n=i(82),r=i(1667),s=i(6331);class o{static parse(e){const t=(0,s.parseStringEncodedColor)(e);if(void 0!==t)return r.ColorUtils.getRgbaFromHex(t)}constructor(e=1,t=1,i=1,n=1){this.r=e,this.g=t,this.b=i,this.a=n}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}clone(){return new o(this.r,this.g,this.b,this.a)}fromVector(e){return this.r=e.x,this.g=e.y,this.b=e.z,this.a=e.w,this}toVector(e){return e||(e=new n.Vector4),e.set(this.r,this.g,this.b,this.a),e}fromHex(e){return r.ColorUtils.getRgbaFromHex(e,this),this}getHex(){return r.ColorUtils.getHexFromRgba(this.r,this.g,this.b,this.a)}lerp(e,t){return this.r=n.MathUtils.lerp(this.r,e.r,t),this.g=n.MathUtils.lerp(this.g,e.g,t),this.b=n.MathUtils.lerp(this.b,e.b,t),this.a=n.MathUtils.lerp(this.a,e.a,t),this}toJSON(){return`rgba(${255*this.r<<0}, ${255*this.g<<0}, ${255*this.b<<0}, ${this.a})`}}t.RGBA=o},6331:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseStringEncodedColor=t.parseStringEncodedNumeral=t.StringEncodedNumeralFormatMaxSize=t.StringEncodedNumeralFormats=t.StringEncodedColorFormats=t.StringEncodedMetricFormats=t.StringEncodedNumeralType=void 0;const n=i(6925),r=i(797),s=i(1667);var o;!function(e){e[e.Meters=0]="Meters",e[e.Pixels=1]="Pixels",e[e.Hex=2]="Hex"}(o=t.StringEncodedNumeralType||(t.StringEncodedNumeralType={}));const a={type:o.Meters,size:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))m$/,decoder:(e,t)=>{const i=a.regExp.exec(e);return!!i&&void 0!==(t[0]=Number(i[1]))}},l={type:o.Pixels,size:1,mask:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))px$/,decoder:(e,t)=>{const i=l.regExp.exec(e);return null!==i&&(t[0]=Number(i[1]),!0)}},c={type:o.Hex,size:4,regExp:/^\#((?:[0-9A-Fa-f][0-9A-Fa-f]){4}|[0-9A-Fa-f]{4})$/,decoder:(e,t)=>{const i=c.regExp.exec(e);if(null===i)return!1;const n=i[1],s=n.length;return(0,r.assert)(4===s||8===s,"Matched incorrect hex color format"),4===s?(t[0]=parseInt(n.charAt(0)+n.charAt(0),16)/255,t[1]=parseInt(n.charAt(1)+n.charAt(1),16)/255,t[2]=parseInt(n.charAt(2)+n.charAt(2),16)/255,t[3]=4===s?parseInt(n.charAt(3)+n.charAt(3),16)/255:1):8===s&&(t[0]=parseInt(n.charAt(0)+n.charAt(1),16)/255,t[1]=parseInt(n.charAt(2)+n.charAt(3),16)/255,t[2]=parseInt(n.charAt(4)+n.charAt(5),16)/255,t[3]=8===s?parseInt(n.charAt(6)+n.charAt(7),16)/255:1),!0}};t.StringEncodedMetricFormats=[a,l];const h=t.StringEncodedMetricFormats.reduce(((e,t)=>Math.max(e,t.size)),0);t.StringEncodedColorFormats=[c];const u=t.StringEncodedColorFormats.reduce(((e,t)=>Math.max(e,t.size)),0);t.StringEncodedNumeralFormats=[...t.StringEncodedMetricFormats,...t.StringEncodedColorFormats],t.StringEncodedNumeralFormatMaxSize=Math.max(u,h);const d=new Array(t.StringEncodedNumeralFormatMaxSize);function m(e,t,i=1){const r=t.find((t=>!!t.decoder(e,d)));if(void 0===r){const t=(0,n.parseCSSColor)(e);return Array.isArray(t)&&!t.some((e=>isNaN(e)))?s.ColorUtils.getHexFromRgba(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}switch(null==r?void 0:r.type){case o.Pixels:return d[0]*i;case o.Hex:return s.ColorUtils.getHexFromRgba(d[0],d[1],d[2],d[3]);default:return d[0]}}t.parseStringEncodedNumeral=function(e,i=1){return m(e,t.StringEncodedNumeralFormats,i)},t.parseStringEncodedColor=function(e){return m(e,t.StringEncodedColorFormats)}},1370:(e,t)=>{"use strict";var i,n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.isTextureBuffer=t.PlacementToken=t.transientToPickability=t.Pickability=t.TextureCoordinateType=void 0,(r=t.TextureCoordinateType||(t.TextureCoordinateType={})).TileSpace="tile-space",r.EquirectangularSpace="equirectangular-space",r.FeatureSpace="feature-space",function(e){e.onlyVisible="only-visible",e.transient="transient",e.all="all"}(i=t.Pickability||(t.Pickability={})),t.transientToPickability=function(e){let t=i.onlyVisible;return null!=e&&(t="string"==typeof e?e:!0===e?i.transient:i.onlyVisible),t},(n=t.PlacementToken||(t.PlacementToken={})).TopLeft="TL",n.Top="T",n.TopRight="TR",n.Right="R",n.BottomRight="BR",n.Bottom="B",n.BottomLeft="BL",n.Left="L",n.Center="C",n.NorthWest="NW",n.North="N",n.NorthEast="NE",n.East="E",n.SouthEast="SE",n.South="S",n.SouthWest="SW",n.West="W",t.isTextureBuffer=function(e){return e&&e.buffer&&"string"==typeof e.type}},1216:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setTechniqueRenderOrderOrPriority=t.addBuffersToTransferList=t.textureCoordinateType=t.supportsTextures=t.needsVertexNormals=t.isLabelRejectionLineTechnique=t.isTextTechnique=t.isTerrainTechnique=t.isStandardTechnique=t.isExtrudedPolygonTechnique=t.isFillTechnique=t.isStandardExtrudedLineTechnique=t.isBasicExtrudedLineTechnique=t.isExtrudedLineTechnique=t.isSegmentsTechnique=t.isSpecialDashesLineTechnique=t.isRasterTechnique=t.isSolidLineTechnique=t.isLineTechnique=t.isLineMarkerTechnique=t.isIconTextTechnique=t.isSquaresTechnique=t.isCirclesTechnique=t.TRANSPARENCY_PROPERTY_KEYS=t.TEXTURE_PROPERTY_KEYS=void 0;const n=i(1370);function r(e){return"labeled-icon"===e.name}function s(e){return"line-marker"===e.name}function o(e){return"solid-line"===e.name||"dashed-line"===e.name}function a(e){return"extruded-line"===e.name}function l(e){return a(e)&&"standard"===e.shading}function c(e){return"fill"===e.name}function h(e){return"extruded-polygon"===e.name}function u(e){return"standard"===e.name}function d(e){return"terrain"===e.name}function m(e){return"text"===e.name}function p(e){return c(e)||u(e)||h(e)||d(e)||o(e)}t.TEXTURE_PROPERTY_KEYS=["map","normalMap","displacementMap","roughnessMap","emissiveMap","alphaMap","metalnessMap","bumpMap","dash-image"],t.TRANSPARENCY_PROPERTY_KEYS=["opacity","transparent"],t.isCirclesTechnique=function(e){return"circles"===e.name},t.isSquaresTechnique=function(e){return"squares"===e.name},t.isIconTextTechnique=r,t.isLineMarkerTechnique=s,t.isLineTechnique=function(e){return"line"===e.name},t.isSolidLineTechnique=o,t.isRasterTechnique=function(e){return"raster"===e.name},t.isSpecialDashesLineTechnique=function(e){return("solid-line"===e.name||"dashed-line"===e.name)&&void 0!==e.dashes&&"Square"!==e.dashes},t.isSegmentsTechnique=function(e){return"segments"===e.name},t.isExtrudedLineTechnique=a,t.isBasicExtrudedLineTechnique=function(e){return a(e)&&"basic"===e.shading},t.isStandardExtrudedLineTechnique=l,t.isFillTechnique=c,t.isExtrudedPolygonTechnique=h,t.isStandardTechnique=u,t.isTerrainTechnique=d,t.isTextTechnique=m,t.isLabelRejectionLineTechnique=function(e){return"label-rejection-line"===e.name},t.needsVertexNormals=function(e){return h(e)||c(e)||u(e)||d(e)||l(e)},t.supportsTextures=p,t.textureCoordinateType=function(e){return p(e)?e.textureCoordinateType:void 0},t.addBuffersToTransferList=function(e,i){if(u(e)||h(e)||d(e))for(const r of t.TEXTURE_PROPERTY_KEYS){const t=e[r];(0,n.isTextureBuffer)(t)&&t.buffer instanceof ArrayBuffer&&i.push(t.buffer)}},t.setTechniqueRenderOrderOrPriority=function(e,t,i){if(m(e)||r(e)||s(e)){if(i&&"string"==typeof e._category){const t=i.indexOf(e._category);-1!==t&&(e.priority=i.length-t)}}else if(t&&void 0!==e._styleSet){const i=i=>{const n=null==t?void 0:t.findIndex((t=>t.group===e._styleSet&&t.category===i));return void 0!==n&&-1!==n?10*(n+1):void 0};if("string"==typeof e._category){const t=i(e._category);void 0!==t&&(e.renderOrder=t)}}}},5771:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isConditionalExtendsEntry=t.isDirectionalLight=t.isAmbientLight=t.getStyles=t.isStylesDictionary=t.isJsonExprReference=t.getDefinitionValue=t.isVerboseDefinition=void 0;const n=i(1017);function r(e){return void 0!==(null==e?void 0:e.value)}function s(e){return void 0!==e&&!Array.isArray(e)}t.isVerboseDefinition=r,t.getDefinitionValue=function(e){return r(e)?e.value:e},t.isJsonExprReference=function(e){return Array.isArray(e)&&2===e.length&&"ref"===e[0]&&"string"==typeof e[1]},t.isStylesDictionary=s,t.getStyles=function(e){return void 0===e?[]:s(e)?function(e){const t=[];for(const i in e)e[i].forEach((e=>{void 0===e.styleSet&&(e.styleSet=i),t.push(e)}));return t}(e):e},t.isAmbientLight=function(e){return"ambient"===e.type},t.isDirectionalLight=function(e){return"directional"===e.type},t.isConditionalExtendsEntry=function(e){return void 0!==e&&(0,n.isJsonExpr)(e.when)&&/^(object|string)$/.test(typeof e.value)}},8131:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeVisitor=void 0;const n=i(1017),r=i(5771);t.ThemeVisitor=class{constructor(e){this.theme=e}visitStyles(e){const t=t=>!(0,n.isJsonExpr)(t)&&!!e(t);if(void 0!==this.theme.styles)for(const e of(0,r.getStyles)(this.theme.styles))if(t(e))return!0;return!1}}},797:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assert=void 0,t.assert=function(e,t){}},6304:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPropertyValue=void 0;const n=i(8023),r=i(1324),s=i(7610),o=i(6331);t.getPropertyValue=function(e,t,i){var a,l,c;if(n.Expr.isExpr(e)){let o=e.evaluate(t,n.ExprScope.Dynamic,i);return"string"==typeof o&&(o=null!==(l=null!==(a=s.RGBA.parse(o))&&void 0!==a?a:r.Pixels.parse(o))&&void 0!==l?l:o),o instanceof s.RGBA?o.getHex():o instanceof r.Pixels?o.value*(null!==(c=Number(t.lookup("$pixelToMeters")))&&void 0!==c?c:1):o}if(null==e)return null;if("string"!=typeof e)return e;{const i=t.lookup("$pixelToMeters")||1,n=(0,o.parseStringEncodedNumeral)(e,i);return void 0!==n?n:e}}},6073:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArrayOperators=void 0;const n=i(8023),r=["boolean","number","string"];function s(e,t){if(!(e instanceof n.StringLiteralExpr&&r.includes(e.value)))throw new Error(`expected "boolean", "number" or "string" instead of '${JSON.stringify(e)}'`);const i=e.value;t.forEach(((e,t)=>{if(typeof e!==i)throw new Error(`expected array element at index ${t} to have type '${i}'`)}))}function o(e,t){const i=e.evaluate(t);if(!Array.isArray(i))throw new Error(`'${i}' is not an array`);return i}const a={array:{call:(e,t)=>{switch(t.args.length){case 0:throw new Error("not enough arguments");case 1:return o(e,t.args[0]);case 2:{const i=o(e,t.args[1]);return s(t.args[0],i),i}case 3:{const i=o(e,t.args[2]);return function(e,t){if(!(e instanceof n.NumberLiteralExpr))throw new Error("missing expected number of elements");const i=e.value;if(t.length!==i)throw new Error(`the array must have ${i} element(s)`)}(t.args[1],i),s(t.args[0],i),i}default:throw new Error("too many arguments")}}},"make-array":{call:(e,t)=>{if(0===t.args.length)throw new Error("not enough arguments");return[...t.args.map((t=>e.evaluate(t)))]}},at:{call:(e,t)=>{const i=t.args,n=e.evaluate(i[0]);if("number"!=typeof n)throw new Error("expected the index of the element to retrieve");const r=e.evaluate(i[1]);if(!Array.isArray(r))throw new Error("expected an array");return n>=0&&n<r.length?r[n]:null}},slice:{call:(e,t)=>{if(t.args.length<2)throw new Error("not enough arguments");const i=e.evaluate(t.args[0]);if("string"!=typeof i&&!Array.isArray(i))throw new Error("input must be a string or an array");const n=e.evaluate(t.args[1]);if("number"!=typeof n)throw new Error("expected an index");let r;if(t.args.length>2&&(r=e.evaluate(t.args[2]),"number"!=typeof r))throw new Error("expected an index");return i.slice(n,r)}}};t.ArrayOperators=a},7290:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CastOperators=void 0;const i={"to-boolean":{call:(e,t)=>Boolean(e.evaluate(t.args[0]))},"to-string":{call:(e,t)=>String(e.evaluate(t.args[0]))},"to-number":{call:(e,t)=>{for(const i of t.args){const t=Number(e.evaluate(i));if(!isNaN(t))return t}throw new Error("cannot convert the value to a number")}}};t.CastOperators=i},4672:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorOperators=void 0;const n=i(82),r=i(1667),s=i(6331),o={alpha:{call:(e,t)=>{let i=e.evaluate(t.args[0]);return"string"==typeof i&&(i=(0,s.parseStringEncodedColor)(i)),"number"==typeof i?r.ColorUtils.getAlphaFromHex(i):1}},rgba:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]),a=e.evaluate(t.args[3]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&"number"==typeof a&&i>=0&&s>=0&&o>=0&&a>=0&&a<=1)return function(e,t,i,s){return r.ColorUtils.getHexFromRgba(n.MathUtils.clamp(e,0,255)/255,n.MathUtils.clamp(t,0,255)/255,n.MathUtils.clamp(i,0,255)/255,n.MathUtils.clamp(s,0,1))}(i,s,o,a);throw new Error(`unknown color 'rgba(${i},${s},${o},${a})'`)}},rgb:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&i>=0&&s>=0&&o>=0)return function(e,t,i){return r.ColorUtils.getHexFromRgb(n.MathUtils.clamp(e,0,255)/255,n.MathUtils.clamp(t,0,255)/255,n.MathUtils.clamp(i,0,255)/255)}(i,s,o);throw new Error(`unknown color 'rgb(${i},${s},${o})'`)}},hsl:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&i>=0&&s>=0&&o>=0)return function(e,t,i){return r.ColorUtils.getHexFromHsl(n.MathUtils.euclideanModulo(e,360)/360,n.MathUtils.clamp(t,0,100)/100,n.MathUtils.clamp(i,0,100)/100)}(i,s,o);throw new Error(`unknown color 'hsl(${i},${s}%,${o}%)'`)}}};t.ColorOperators=o},8998:(e,t)=>{"use strict";function i(e,t,i=!1){const n=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if(!("number"==typeof n&&"number"==typeof r||"string"==typeof n&&"string"==typeof r)&&i)throw new Error(`invalid operands '${n}' and '${r}' for operator '${t.op}'`);switch(t.op){case"<":return n<r;case">":return n>r;case"<=":return n<=r;case">=":return n>=r;default:throw new Error(`invalid comparison operator '${t.op}'`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.ComparisonOperators=void 0;const n={"!":{call:(e,t)=>!e.evaluate(t.args[0])},"==":{call:(e,t)=>e.evaluate(t.args[0])===e.evaluate(t.args[1])},"!=":{call:(e,t)=>e.evaluate(t.args[0])!==e.evaluate(t.args[1])},"<":{call:(e,t)=>i(e,t)},">":{call:(e,t)=>i(e,t)},"<=":{call:(e,t)=>i(e,t)},">=":{call:(e,t)=>i(e,t)}};t.ComparisonOperators=n},1954:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureOperators=void 0;const n=i(7259),r=i(8023),s={"geometry-type":{call:(e,t)=>{switch(e.env.lookup("$geometryType")){case"point":return"Point";case"line":return"LineString";case"polygon":return"Polygon";default:return null}}},"feature-state":{isDynamicOperator:()=>!0,call:(e,t)=>{var i,s;if(e.scope!==r.ExprScope.Dynamic)throw new Error("feature-state cannot be used in this context");const o=e.evaluate(t.args[0]);if("string"!=typeof o)throw new Error("expected the name of the property of the feature state");const a=e.env.lookup("$state");return n.Env.isEnv(a)?null!==(i=a.lookup(o))&&void 0!==i?i:null:a instanceof Map&&null!==(s=a.get(o))&&void 0!==s?s:null}},id:{call:(e,t)=>{var i;return null!==(i=e.env.lookup("$id"))&&void 0!==i?i:null}}};t.FeatureOperators=s},2181:(e,t)=>{"use strict";function i(e,t,i){switch(t){case"boolean":case"number":case"string":for(const n of i){const i=e.evaluate(n);if(typeof i===t)return i}throw new Error(`expected a '${t}'`);default:throw new Error(`invalid type '${t}'`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.FlowOperators=void 0;const n={all:{call:(e,t)=>{for(const i of t.args)if(!e.evaluate(i))return!1;return!0}},any:{call:(e,t)=>{for(const i of t.args)if(e.evaluate(i))return!0;return!1}},none:{call:(e,t)=>{for(const i of t.args)if(e.evaluate(i))return!1;return!0}},boolean:{call:(e,t)=>i(e,"boolean",t.args)},number:{call:(e,t)=>i(e,"number",t.args)},string:{call:(e,t)=>i(e,"string",t.args)}};t.FlowOperators=n},202:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapOperators=void 0;const n=i(8023),r={"ppi-scale":{call:(e,t)=>e.evaluate(t.args[0])*(t.args[1]?e.evaluate(t.args[1]):1)},"world-ppi-scale":{isDynamicOperator:()=>!0,call:(e,t)=>{const i=e.evaluate(t.args[0]),n=t.args[1]?e.evaluate(t.args[1]):1,r=e.env.lookup("$zoom");return i*(Math.pow(2,17)/Math.pow(2,r))*n}},"world-discrete-ppi-scale":{isDynamicOperator:()=>!0,call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.env.lookup("$zoom");return i*(40075016.68557849/(256*Math.pow(2,Math.floor(n))))}},"pixel-world-scale":{isDynamicOperator:()=>!0,call:(e,t)=>e.evaluate(t.args[0])*(e.env.lookup("$pixelToMeters")||1)},ppi:{call:e=>{const t=e.env.lookup("$ppi");return"number"==typeof t?t:72}},zoom:{isDynamicOperator:()=>!0,call:(e,t)=>{var i;return e.scope===n.ExprScope.Value?t:null!==(i=e.env.lookup("$zoom"))&&void 0!==i?i:null}}};t.MapOperators=r},4054:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathOperators=void 0;const n=i(82),r={"^":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof n)throw new Error(`invalid operands '${typeof i}' and '${typeof n}' for operator '^'`);return Math.pow(i,n)}},"-":{call:(e,t)=>{if(1===t.args.length){const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`ìnvalid operand '${typeof i} for operator '-'`);return-i}const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof n)throw new Error(`invalid operands '${typeof i}' and '${typeof n}' for operator '-'`);return i-n}},"/":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof n)throw new Error(`invalid operands '${typeof i}' and '${typeof n}' for operator '/'`);return i/n}},"%":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof n)throw new Error(`invalid operands '${typeof i}' and '${typeof n}' for operator '%'`);return i%n}},"+":{call:(e,t)=>t.args.reduce(((t,i)=>Number(t)+Number(e.evaluate(i))),0)},"*":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]),s="number"==typeof i,o="number"==typeof r;let a;if(s&&o)a=i*r;else if(o&&(i instanceof n.Vector2||i instanceof n.Vector3||i instanceof n.Vector4))a=i.clone().multiplyScalar(r);else{if(!s||!(r instanceof n.Vector2||r instanceof n.Vector3||r instanceof n.Vector4))throw new Error(`invalid operands '${typeof i}' and '${typeof r}' for operator '*'`);a=r.clone().multiplyScalar(i)}return a}},abs:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'abs'`);return Math.abs(i)}},acos:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'acos'`);return Math.acos(i)}},asin:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'asin'`);return Math.asin(i)}},atan:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'atan'`);return Math.atan(i)}},ceil:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ceil'`);return Math.ceil(i)}},cos:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'cos'`);return Math.cos(i)}},e:{call:()=>Math.E},floor:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'floor'`);return Math.floor(i)}},ln:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ln'`);return Math.log(i)}},ln2:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ln2'`);return Math.log2(i)}},log10:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'log10'`);return Math.log10(i)}},max:{call:(e,t)=>Math.max(...t.args.map((t=>Number(e.evaluate(t)))))},min:{call:(e,t)=>Math.min(...t.args.map((t=>Number(e.evaluate(t)))))},clamp:{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if("number"!=typeof i||"number"!=typeof r||"number"!=typeof s)throw new Error(`invalid operands '${i}', ${r}, ${s} for operator 'clamp'`);return n.MathUtils.clamp(i,r,s)}},pi:{call:()=>Math.PI},round:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'round'`);return Math.round(i)}},sin:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'sin'`);return Math.sin(i)}},sqrt:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'sqrt'`);return Math.sqrt(i)}},tan:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'tan'`);return Math.tan(i)}}};t.MathOperators=r},9764:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MiscOperators=void 0;const n=i(797),r=i(8023);function s(e){return e.join("&")}function o(e,t){return e+"="+JSON.stringify(t)}function a(e,t=0){if(t>=e.length)return[];const i=a(e,t+1),n=i.length;for(let r=0;r<n;r+=1)i.push([...i[r],e[t]]);return i.push([e[t]]),i}function l(e,t){const i=e.args.slice(1),n=[];for(let e=0;e<i.length;e+=2){const r=t.evaluate(i[e+1]);if(null===r)continue;const s=t.evaluate(i[e]);n.push(o(s,r))}return n.sort().reverse(),function(e){e.sort(((e,t)=>t.length-e.length));const t=e.map((e=>s(e)));return t.push(""),t}(a(n))}const c={length:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if(Array.isArray(i)||"string"==typeof i)return i.length;throw new Error(`invalid operand '${i}' for operator 'length'`)}},coalesce:{call:(e,t)=>{for(const i of t.args){const t=e.evaluate(i);if(null!==t)return t}return null}},lookup:{call:(e,t)=>{(0,n.assert)(t.args.length>0,"missing lookup table");const i=l(t,e);let a=e.evaluate(t.args[0]);if((0,n.assert)(Array.isArray(a)||a instanceof Map,"wrong lookup table type"),Array.isArray(a)){a=function(e){const t=new Map;for(const i of e){if("object"!=typeof i)throw new Error(`Invalid lookup table entry type (${typeof i})`);if(!i.keys)throw new Error("Lookup table entry has no 'keys' property.");if(!i.attributes)throw new Error("Lookup table entry has no 'attributes' property.");const e=s(Object.getOwnPropertyNames(i.keys).sort().map((e=>o(e,i.keys[e]))));t.set(e,i.attributes)}return t}(a);const e=new r.ObjectLiteralExpr(a);t.args[0]=e}return function(e,t){for(const i of e){const e=t.get(i);if(e)return e}return null}(i,a)}},trace:{call:(e,t)=>{const i=[];for(const n of t.args)i.push(e.evaluate(n));return console.error("trace: ",...i),i[0]}}};t.MiscOperators=c},7029:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectOperators=void 0;const n=i(7259),r=i(8023),s=Object.prototype.hasOwnProperty;var o;function a(e,t,i){var r;const a=e.evaluate(t[0]);if("string"!=typeof a)throw new Error("expected the name of an attribute");const l=e.evaluate(t[1]);if(l&&"object"==typeof l){if(n.Env.isEnv(l)){const e=null!==(r=l.lookup(a))&&void 0!==r?r:null;return i===o.get?e:null!==e}if(s.call(l,a))return i!==o.get||l[a]}return i===o.get&&null}!function(e){e[e.get=0]="get",e[e.has=1]="has"}(o||(o={}));const l={in:{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return("string"==typeof i&&"string"==typeof n||!!Array.isArray(n))&&n.includes(i)}},get:{call:(e,t)=>a(e,t.args,o.get)},has:{call:(e,t)=>a(e,t.args,o.has)},"dynamic-properties":{isDynamicOperator:()=>!0,call:(e,t)=>e.scope===r.ExprScope.Dynamic?e.env:t}};t.ObjectOperators=l},3501:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StringOperators=void 0;const i={concat:{call:(e,t)=>"".concat(...t.args.map((t=>String(e.evaluate(t)))))},downcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleLowerCase()},upcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleUpperCase()},"regex-replace":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]),r=e.evaluate(t.args[2]);return"string"==typeof i&&"string"==typeof n&&"string"==typeof r?i.replace(new RegExp(n,"g"),r):i}},"~=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof n&&i.includes(n)}},"^=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof n&&i.startsWith(n)}},"$=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof n&&i.endsWith(n)}},split:{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("string"==typeof i&&"string"==typeof n)return i.split(n);throw new Error(`expected '${i}' and '${n}' to be a string`)}}};t.StringOperators=i},5113:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeOperators=void 0,t.TypeOperators={typeof:{call:(e,t)=>typeof e.evaluate(t.args[0])}}},545:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorOperators=void 0;const n=i(82),r=i(8023);function s(e,t,i){let r;switch(i){case"vector2":r=n.Vector2;break;case"vector3":r=n.Vector3;break;case"vector4":r=n.Vector4}for(const i of t.args){const t=e.evaluate(i);if(t instanceof r)return t}throw new Error(`expected a "${i}"`)}function o(e,t,i){let r,s;switch(i){case"vector2":r=n.Vector2,s=2;break;case"vector3":r=n.Vector3,s=3;break;case"vector4":r=n.Vector4,s=4}for(const i of t.args){const t=e.evaluate(i);if(t instanceof r)return t;if(Array.isArray(t)&&t.length===s&&t.every((e=>"number"==typeof e)))return(new r).fromArray(t)}throw new Error(`expected a "${i}"`)}const a={"make-vector":{call:(e,t)=>{if(void 0!==t._value)return t._value;if(t.args.length<2)throw new Error("not enough arguments");if(t.args.length>4)throw new Error("too many arguments");const i=t.args.map((t=>e.evaluate(t)));let s;switch(i.forEach(((e,t)=>{if("number"!=typeof e)throw new Error(`expected vector component at index ${t} to have type "number"`)})),i.length){case 2:s=(new n.Vector2).fromArray(i);break;case 3:s=(new n.Vector3).fromArray(i);break;case 4:s=(new n.Vector4).fromArray(i);break;default:throw new Error("too many arguments")}return t.args.every((e=>e instanceof r.NumberLiteralExpr))&&(t._value=s),s}},vector2:{call:(e,t)=>s(e,t,"vector2")},vector3:{call:(e,t)=>s(e,t,"vector3")},vector4:{call:(e,t)=>s(e,t,"vector4")},"to-vector2":{call:(e,t)=>o(e,t,"vector2")},"to-vector3":{call:(e,t)=>o(e,t,"vector3")},"to-vector4":{call:(e,t)=>o(e,t,"vector4")}};t.VectorOperators=a},3209:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(9047),t)},6766:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeferredPromise=void 0,t.DeferredPromise=class{constructor(e){this.executor=e,this.promise=new Promise(((e,t)=>{this.resolveFunc=e,this.rejectFunc=t}))}exec(){this.executor().then((e=>this.resolveFunc(e))).catch((e=>this.rejectFunc(e)))}}},9047:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransferManager=void 0;const n=i(6766);class r{static instance(){return r.defaultInstance}static async fetchRepeatedly(e,t,i,n,s){try{if(!(t<i))throw new Error("Max number of retries reached");{const r=await e(n,s);if(200===r.status||204===r.status)return r;if(r.status>=400&&r.status<500){t=i;const e=await r.text();throw new Error(e)}}}catch(e){if(e.hasOwnProperty("isCancelled")||"AbortError"===e.name||t>=i)throw e}return await r.waitFor(r.retryTimeout*t).then((()=>r.fetchRepeatedly(e,t+1,i,n,s)))}static waitFor(e){return new Promise((t=>setTimeout(t,e)))}constructor(e=fetch,t=5){this.fetchFunction=e,this.maxRetries=t,this.activeDownloadCount=0,this.downloadQueue=new Array,this.activeDownloads=new Map}downloadJson(e,t){return this.downloadAs((e=>e.json()),e,t)}downloadArrayBuffer(e,t){return this.download(e,t).then((e=>e.arrayBuffer()))}download(e,t){if(this.activeDownloadCount>=r.maxParallelDownloads){const i=new n.DeferredPromise((()=>this.doDownload(e,t)));return this.downloadQueue.push(i),i.promise}return this.doDownload(e,t)}async doDownload(e,t){try{++this.activeDownloadCount;const i=await r.fetchRepeatedly(this.fetchFunction,0,this.maxRetries,e,t);return this.onDownloadDone(),i}catch(e){throw this.onDownloadDone(),e}}onDownloadDone(){--this.activeDownloadCount,this.execDeferredDownload()}execDeferredDownload(){const e=this.downloadQueue.pop();void 0!==e&&e.exec()}downloadAs(e,t,i){const n=t,r=this.activeDownloads.get(n);if(void 0!==r)return Promise.resolve(r);const s=this.download(t,i).then((t=>{if(this.activeDownloads.delete(n),t.ok)return e(t);throw new Error(JSON.stringify(t))})).catch((e=>{throw this.activeDownloads.delete(n),e}));return this.activeDownloads.set(n,s),s}}t.TransferManager=r,r.retryTimeout=500,r.maxParallelDownloads=16,r.defaultInstance=new r},6463:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(4992),t),r(i(5337),t),r(i(197),t),r(i(9172),t),r(i(5200),t),r(i(8154),t),r(i(9246),t),r(i(5681),t),r(i(7314),t),r(i(4954),t),r(i(173),t),r(i(34),t),r(i(7250),t),r(i(5177),t),r(i(4713),t),r(i(9276),t),r(i(5704),t),r(i(7427),t),r(i(9206),t)},4342:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(6463),t),r(i(5323),t)},7427:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5681:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7314:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContextLogger=void 0,t.ContextLogger=class{constructor(e,t){this.m_logger=e,this.headerMessage=t,this.context=[],this.m_headerLogged=!1,this.warn=this.createLogMethod("warn"),this.info=this.createLogMethod("info"),this.error=this.createLogMethod("error")}pushAttr(e){this.context.push(`${this.context.length>0?".":""}${e}`)}pushIndex(e){this.context.push(`[${e}]`)}pop(){this.context.pop()}createLogMethod(e){return(t,...i)=>{this.m_headerLogged||(this.m_logger.info(this.headerMessage),this.m_headerLogged=!0),this.m_logger[e](`${this.context.join("")}: ${t}`,...i)}}}},4992:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DOMUtils=void 0,function(e){function t(e){return e.substring(0,2)}e.getBrowserLanguages=function(){if(void 0!==navigator.languages&&navigator.languages.length>0){const e=[];for(const i of navigator.languages)e.push(t(i));return e}if(void 0!==navigator.language)return[t(navigator.language)]}}(t.DOMUtils||(t.DOMUtils={}))},9276:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chainCallbacks=void 0,t.chainCallbacks=function(e,t){return function(...i){return e&&e.apply(this,i),t.apply(this,i)}}},9206:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertFragmentShaderToWebGL2=t.convertVertexShaderToWebGL2=void 0,t.convertVertexShaderToWebGL2=function(e){return["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+e},t.convertFragmentShaderToWebGL2=function(e){return["#define varying in","out highp vec4 pc_fragColor;","#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+e}},5337:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupedPriorityList=t.PriorityListGroup=void 0;class i{constructor(e,t,i=new Array){this.priority=e,this.zOrder=t,this.elements=i}}t.PriorityListGroup=i,t.GroupedPriorityList=class{constructor(){this.groups=new Map}getGroupKey(e){return`${e.priority}_${e.zOrder}`}add(e){this.getGroup(e).elements.push(e)}clear(){this.groups.clear()}forEachElement(e){this.forEachGroup((t=>{t.elements.forEach(e)}))}forEachGroup(e){for(const[,t]of this.groups)e(t)}count(){let e=0;for(const[,t]of this.groups)e+=t.elements.length;return e}findGroup(e){return this.groups.get(e)}getGroup(e){const t=this.getGroupKey(e);let n=this.findGroup(t);return void 0===n&&(n=new i(e.priority,e.zOrder),this.groups.set(t,n)),n}}},4015:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleChannel=void 0,t.ConsoleChannel=class{error(e,...t){console.error(e,...t)}debug(e,...t){console.debug(e,...t)}info(e,...t){console.info(e,...t)}log(e,...t){console.log(e,...t)}trace(e,...t){console.trace(e,...t)}warn(e,...t){console.warn(e,...t)}}},3140:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6781:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerOptions=t.LogLevel=void 0,(i=t.LogLevel||(t.LogLevel={}))[i.Trace=0]="Trace",i[i.Debug=1]="Debug",i[i.Log=2]="Log",i[i.Info=3]="Info",i[i.Warn=4]="Warn",i[i.Error=5]="Error",i[i.None=6]="None",t.LoggerOptions=class{}},8648:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const n=i(6781);t.Logger=class{constructor(e,t,i){this.name=e,this.m_channel=t,this.enabled=!0,this.level=n.LogLevel.Trace,void 0!==i&&this.update(i)}error(e,...t){this.enabled&&this.level<=n.LogLevel.Error&&this.m_channel.error(this.prefix,e,...t)}debug(e,...t){this.enabled&&this.level<=n.LogLevel.Debug&&this.m_channel.debug(this.prefix,e,...t)}info(e,...t){this.enabled&&this.level<=n.LogLevel.Info&&this.m_channel.info(this.prefix,e,...t)}log(e,...t){this.enabled&&this.level<=n.LogLevel.Log&&this.m_channel.log(this.prefix,e,...t)}trace(e,...t){this.enabled&&this.level<=n.LogLevel.Trace&&this.m_channel.trace(this.prefix,e,...t)}warn(e,...t){this.enabled&&this.level<=n.LogLevel.Warn&&this.m_channel.warn(this.prefix,e,...t)}update(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level}get prefix(){return this.name+":"}}},6562:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerManager=void 0;const n=i(2531);t.LoggerManager=class{static get instance(){return this.m_instance||(this.m_instance=new n.LoggerManagerImpl)}}},2531:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerManagerImpl=void 0;const n=i(4015),r=i(8648),s=i(7698);t.LoggerManagerImpl=class{constructor(){this.m_loggers=[],this.channel="undefined"==typeof self||void 0!==self.document?new n.ConsoleChannel:new s.WorkerChannel}getLoggerNames(){return this.m_loggers.map((e=>e.name))}getLogger(e){return this.m_loggers.find((t=>t.name===e))}create(e,t={}){void 0!==this.m_levelSetForAll&&(void 0===t.level||t.level<this.m_levelSetForAll)&&(t.level=this.m_levelSetForAll);const i=new r.Logger(e,this.channel,t);return this.m_loggers.push(i),i}dispose(e){const t=this.m_loggers.indexOf(e);if(t<0)throw new Error(`Cannot unregister "${e}" : no such logger registered.`);this.m_loggers.splice(t,1)}updateAll(e){for(const t of this.m_loggers)t.update(e)}update(e,t){for(const i of this.m_loggers)i.name===e&&i.update(t)}enableAll(e){for(const t of this.m_loggers)t.enabled=e}enable(e,t){this.update(e,{enabled:t})}setLogLevelForAll(e){this.m_levelSetForAll=e;for(const t of this.m_loggers)t.level=e}setLogLevel(e,t){this.update(e,{level:t})}setChannel(e){this.channel=e}}},3069:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MultiChannel=void 0,t.MultiChannel=class{constructor(...e){this.channels=[],this.channels=e}error(e,...t){for(const i of this.channels)i.error(e,...t)}debug(e,...t){for(const i of this.channels)i.debug(e,...t)}info(e,...t){for(const i of this.channels)i.info(e,...t)}log(e,...t){for(const i of this.channels)i.log(e,...t)}trace(e,...t){for(const i of this.channels)i.trace(e,...t)}warn(e,...t){for(const i of this.channels)i.warn(e,...t)}}},7698:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerChannel=t.WORKERCHANNEL_MSG_TYPE=void 0;const n=i(6781);t.WORKERCHANNEL_MSG_TYPE="worker-channel-message",t.WorkerChannel=class{error(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Error};self.postMessage(r)}debug(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Debug};self.postMessage(r)}info(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Info};self.postMessage(r)}log(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Log};self.postMessage(r)}trace(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Trace};self.postMessage(r)}warn(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Warn};self.postMessage(r)}}},197:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(4015),t),r(i(3140),t),r(i(6781),t),r(i(8648),t),r(i(6562),t),r(i(3069),t),r(i(7698),t)},9172:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Math2D=void 0,function(e){function t(e,t,i,n){return(e-i)*(e-i)+(t-n)*(t-n)}e.Box=class{constructor(e=0,t=0,i=0,n=0){this.x=e,this.y=t,this.w=i,this.h=n}set(e,t,i,n){this.x=e,this.y=t,this.w=i,this.h=n}copy(e){this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h}contains(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t}containsBox(e){const t=e.x+e.w,i=e.y+e.h;return this.contains(e.x,e.y)&&this.contains(t,e.y)&&this.contains(e.x,i)&&this.contains(t,i)}intersects(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y}},e.distSquared=t,e.computeSquaredLineLength=function(e){let t=0;const i=e.length-4;for(let n=0;n<i;n+=3){const i=e[n+3]-e[n],r=e[n+4]-e[n+1];t+=i*i+r*r}return t},e.distToSegmentSquared=function(e,i,n,r,s,o){const a=t(n,r,s,o);if(0===a)return t(e,i,n,r);let l=((e-n)*(s-n)+(i-r)*(o-r))/a;return l=Math.max(0,Math.min(1,l)),t(e,i,n+l*(s-n),r+l*(o-r))},e.intersectLineAndCircle=function(e,t,i,n,r,s=0,o=0){const a=i-e,l=n-t,c=a*a+l*l,h=e*n-i*t-l*s+a*o,u=r*r*c-h*h;if(u<-1e-10)return;const d=h*l,m=-h*a;if(u<1e-10)return{x1:s+d/c,y1:o+m/c};const p=Math.sqrt(u),f=(l<0?-1:1)*a*p,g=Math.abs(l)*p;return{x1:s+(d+f)/c,y1:o+(m+g)/c,x2:s+(d-f)/c,y2:o+(m-g)/c}},e.intersectLines=function(e,t,i,n,r,s,o,a,l={x:0,y:0}){const c=(e-i)*(s-a)-(t-n)*(r-o);if(0===c)return;const h=((e*n-t*i)*(r-o)-(e-i)*(r*a-s*o))/c,u=((e*n-t*i)*(s-a)-(t-n)*(r*a-s*o))/c;return l.x=h,l.y=u,l}}(t.Math2D||(t.Math2D={}))},5200:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathUtils=void 0,function(e){function t(e,t,i){return e<t?t:e>i?i:e}e.clamp=t,e.smoothStep=function(e,i,n){return(n=t((n-e)/(i-e),0,1))*n*(3-2*n)},e.smootherStep=function(e,i,n){return(n=t((n-e)/(i-e),0,1))*n*n*(n*(6*n-15)+10)},e.map=function(e,t,i,n,r){return(e-t)*(r-n)/(i-t)+n},e.min2=function(e,t){let i;return void 0!==e&&(i=e),void 0!==t&&(i=void 0===i?t:Math.min(i,t)),i},e.max2=function(e,t){let i;return void 0!==e&&(i=e),void 0!==t&&(i=void 0===i?t:Math.max(i,t)),i},e.isWithinBounds=function(e,t,i){return!(void 0!==t&&e<t||void 0!==i&&e>i)},e.easeInOutCubic=function(e,t,i){return e+(t-e)*(i<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1)}}(t.MathUtils||(t.MathUtils={}))},8154:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixinsWithoutProperties=t.applyMixins=void 0,t.applyMixins=function(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((i=>{e.prototype[i]=t.prototype[i]}))}))},t.applyMixinsWithoutProperties=function(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((i=>{const n=Object.getOwnPropertyDescriptor(t.prototype,i);void 0!==n&&void 0===n.get&&"constructor"!==i&&(e.prototype[i]=t.prototype[i])}))}))}},173:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pick=t.cloneDeep=void 0,t.cloneDeep=function(e){const t=new Map,i=function e(i){if(null===i)return null;if("object"==typeof i){const n=t.get(i);if(void 0!==n)return n;if(Array.isArray(i)){const n=[];t.set(i,n),n.length=i.length;for(let t=0;t<n.length;++t)n[t]=e(i[t]);return n}if(i instanceof Date){const e=new Date(i.getTime());return t.set(i,e),e}if(i instanceof RegExp){const e=new RegExp(i.source,i.flags);return t.set(i,e),e}if(i.constructor!==Object)throw new Error("cloneDeep doesn't support objects with custom prototypes");{const n={};t.set(i,n);for(const t in i)i.hasOwnProperty(t)&&(n[t]=e(i[t]));return n}}return i}(e);return t.clear(),i},t.pick=function(e,t){const i={};for(const n of t)e.hasOwnProperty(n)&&(i[n]=e[n]);return i}},34:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOptionValue=void 0,t.getOptionValue=function(...e){for(const t of e)if(null!=t)return t}},4954:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceTimer=void 0;class i{static now(){return i.nowFunc()}static getNowFunc(){return"undefined"!=typeof performance&&void 0!==performance.now?()=>performance.now():()=>(new Date).getTime()}}t.PerformanceTimer=i,i.instance=new i,i.nowFunc=i.getNowFunc()},5704:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sampleBilinear=void 0,t.sampleBilinear=function(e,t,i,n,r){const s=t-1,o=i-1,a=n*s,l=Math.floor(a),c=r*o,h=Math.floor(c),u=h*t+l,d=l<s?u+1:u,m=h<o?u+t:u,p=l<s?m+1:m,f=e[u],g=e[d],v=e[m],y=e[p],_=Number.isInteger(a)?0:a-l,x=1-_,w=Number.isInteger(c)?0:c-h,b=1-w;return f*x*b+g*_*b+v*x*w+y*_*w}},7250:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TaskQueue=void 0,t.TaskQueue=class{constructor(e){var t;this.m_options=e,this.m_taskLists=new Map,null===(t=this.m_options.groups)||void 0===t||t.forEach((e=>{this.m_taskLists.set(e,[])})),this.m_options.prioSortFn&&(this.sort=this.m_options.prioSortFn)}update(e){if(void 0===e)this.m_taskLists.forEach((e=>{this.updateTaskList(e)}));else{const t=this.getTaskList(e);t&&this.updateTaskList(t)}}add(e){var t;if(this.m_taskLists.has(e.group)){const i=this.m_taskLists.get(e.group);if(!(null==i?void 0:i.includes(e)))return null===(t=this.m_taskLists.get(e.group))||void 0===t||t.push(e),!0}return!1}remove(e){var t,i;if(this.m_taskLists.has(e.group)){const n=null===(t=this.m_taskLists.get(e.group))||void 0===t?void 0:t.indexOf(e);if(-1!==n)return null===(i=this.m_taskLists.get(e.group))||void 0===i||i.splice(n,1),!0}return!1}numItemsLeft(e){var t,i;let n=0;return void 0===e?this.m_taskLists.forEach((e=>{n+=e.length})):n+=null!==(i=null===(t=this.getTaskList(e))||void 0===t?void 0:t.length)&&void 0!==i?i:0,n}processNext(e,t,i=1){if(!this.getTaskList(e)||this.numItemsLeft(e)<=0)return!1;for(let n=0;n<i&&this.numItemsLeft(e)>0;n++){const i=this.pull(e,!0);void 0!==i&&(!t||(null==t?void 0:t(i))?i.execute():this.add(i))}return!0}clear(){this.m_taskLists.clear()}pull(e,t=!1){var i,n;let r;return this.getTaskList(e)&&(r=null===(i=this.getTaskList(e))||void 0===i?void 0:i.pop(),t&&r&&(null===(n=r.isExpired)||void 0===n?void 0:n.call(r)))?this.pull(e,t):r}sort(e,t){return t.getPriority()-e.getPriority()}getTaskList(e){return this.m_taskLists.get(e)}updateTaskList(e){var t;for(let i=0;i<e.length;i++){const n=e[i];(null===(t=null==n?void 0:n.isExpired)||void 0===t?void 0:t.call(n))&&(e.splice(i,1),i--)}e.sort(this.sort)}}},5177:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5323:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAppBaseUrl=void 0;const n=i(4713);t.getAppBaseUrl=function(){return"undefined"==typeof window?`file://${process.cwd()}/`:(0,n.baseUrl)(window.location.href)}},4713:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUrlHostAndProtocol=t.getUrlOrigin=t.baseUrl=t.resolveReferenceUri=void 0,t.resolveReferenceUri=function(e,t){return i.test(t)?t:t.startsWith("/")?r(e)+t:(t.startsWith("./")&&(t=t.substr(2)),n(e)+t)};const i=new RegExp("^(((?:[a-z]+:)?//)|(file:/)|(data:))","i");function n(e){if(void 0===e)return"./";let t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),t=e.indexOf("?"),-1!==t&&(e=e.slice(0,t)),t=e.lastIndexOf("/"),-1===t?"./":e.substring(0,t+1)}function r(e){if(void 0===e)return"";const t=s(e);return"file:"===t.protocol?"file://":t.host&&t.protocol?t.protocol+"//"+t.host:t.host?"//"+t.host:t.protocol?t.protocol+"//":""}function s(e){const t=new RegExp(/^(?:([a-z]+:))?\/\/([^\/]*)/,"i"),i=e.match(t);if(!i)throw new Error(`getUrlHostAndProtocol: unable to parse URL '${e}'`);return{protocol:i[1],host:i[2]}}t.baseUrl=n,t.getUrlOrigin=r,t.getUrlHostAndProtocol=s},9246:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assertExists=t.assert=void 0,t.assert=function(e,t){},t.assertExists=function(e,t){return e}},2972:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(7458),t),r(i(3436),t),r(i(9959),t),r(i(6822),t),r(i(3123),t),r(i(5591),t)},9287:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeLineAnchorPoints=t.MAX_SEARCH_DEPTH=void 0;const n=i(82),r=new n.Vector3,s=new n.Vector3;t.MAX_SEARCH_DEPTH=3,t.computeLineAnchorPoints=function(e,i){if(e.count<2)return(new Float64Array).buffer;const n=function(e){const t=[];let i=0;for(let n=0;n<e.count-1;++n)i+=r.fromBufferAttribute(e,n).distanceTo(s.fromBufferAttribute(e,n+1)),t.push(i);return t}(e);if(n[n.length-1]<=Number.EPSILON)return(new Float64Array).buffer;const o=function(e,i,n){const o=[],a=e[e.length-1],l=Math.min(t.MAX_SEARCH_DEPTH+1,Math.floor(Math.log2(a/i))),c=l>0?Math.pow(2,l):0,h=c+1,u=a/c;let d=0;for(let t=0;t<h;t++){const i=1===h?a/2:t*u;let l=e.length-1;for(;l!==d;){const t=Math.floor((l+d)/2);i>=e[t]?d=t+1:l=t}const c=e[d],m=1-(c-i)/(c-(0===d?0:e[d-1])),p=r.fromBufferAttribute(n,d).lerp(s.fromBufferAttribute(n,d+1),m);o.push(...p.toArray())}return o}(n,i,e);return new Float64Array(o).buffer}},9252:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DecodeInfo=void 0;const n=i(82),r=i(2616);t.DecodeInfo=class{constructor(e,t,i=0){this.targetProjection=e,this.tileKey=t,this.storageLevelOffset=i,this.projectedBoundingBox=new r.OrientedBox3,this.tileBounds=new n.Box3,this.tileSize=new n.Vector3,this.center=new n.Vector3,this.geoBox=this.tilingScheme.getGeoBox(t),this.targetProjection.projectBox(this.geoBox,this.projectedBoundingBox),this.projectedBoundingBox.getCenter(this.center),this.tilingScheme.getWorldBox(t,this.tileBounds),this.tileBounds.getSize(this.tileSize),this.tileSizeOnScreen=256*Math.pow(2,-this.storageLevelOffset),this.columnCount=r.webMercatorTilingScheme.subdivisionScheme.getLevelDimensionX(this.tileKey.level),this.rowCount=r.webMercatorTilingScheme.subdivisionScheme.getLevelDimensionY(this.tileKey.level)}get tilingScheme(){return r.webMercatorTilingScheme}get sourceProjection(){return this.tilingScheme.projection}}},5591:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonDataProvider=void 0;const n=i(8152),r=i(2344),s=i(8449),o=i(4342),a=i(9959),l=o.LoggerManager.instance.create("GeoJsonDataProvider"),c="invalidated";let h=!1;class u extends s.DataProvider{constructor(e,t,i){var n;super(),this.name=e,this.input=t,this.m_registered=!1,this.m_tiler=null!==(n=null==i?void 0:i.tiler)&&void 0!==n?n:r.ConcurrentTilerFacade.getTiler(a.GEOJSON_TILER_SERVICE_TYPE,null==i?void 0:i.workerTilerUrl,null==i?void 0:i.workerConnectionTimeout)}async connect(){try{await this.m_tiler.connect()}catch(e){throw n.WorkerServiceProtocol.isUnknownServiceError(e)&&!h&&(l.info("Unable to start GeoJson tiler service in worker. Use  'OmvTilerService.start();' in decoder script."),h=!0),e}await this.m_tiler.registerIndex(this.name,this.input),this.m_registered=!0}updateInput(e){this.input=e,this.m_tiler.updateIndex(this.name,this.input),this.dispatchEvent({type:c})}ready(){return this.m_registered}async getTile(e){return await this.m_tiler.getTile(this.name,e)}onDidInvalidate(e){return this.addEventListener(c,e),()=>this.removeEventListener(c,e)}dispose(){this.m_tiler.dispose()}}t.GeoJsonDataProvider=u},7458:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComposedDataFilter=void 0,t.ComposedDataFilter=class{constructor(e){this.filters=e}wantsLayer(e,t){return this.filters.reduce(((i,n)=>i&&n.wantsLayer(e,t)),!0)}wantsPointFeature(e,t,i){return this.filters.reduce(((n,r)=>n&&r.wantsPointFeature(e,t,i)),!0)}wantsLineFeature(e,t,i){return this.filters.reduce(((n,r)=>n&&r.wantsLineFeature(e,t,i)),!0)}wantsPolygonFeature(e,t,i){return this.filters.reduce(((n,r)=>n&&r.wantsPolygonFeature(e,t,i)),!0)}}},6822:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvDebugLabelsTile=void 0;const n=i(82),r=i(8152),s=i(2344),o=i(507),a=i(5912),l=i(2002),c=i(5823),h=i(1984),u=new n.LineBasicMaterial({color:0,linewidth:1,depthTest:!1,depthFunc:n.NeverDepth}),d=new n.MeshBasicMaterial({color:16711680,depthTest:!1,depthFunc:n.NeverDepth});new n.MeshBasicMaterial({color:16711680,depthTest:!1,depthFunc:n.NeverDepth}).wireframe=!0,new n.MeshBasicMaterial({color:8421631,depthTest:!1,depthFunc:n.NeverDepth}).wireframe=!0;const m=new n.MeshBasicMaterial({color:0,depthTest:!1,depthFunc:n.NeverDepth}),p=new n.MeshBasicMaterial({color:255,depthTest:!1,depthFunc:n.NeverDepth,opacity:.75,transparent:!0}),f=new n.MeshBasicMaterial({color:10514432,depthTest:!1,depthFunc:n.NeverDepth,opacity:.75,transparent:!0}),g=new c.TextRenderStyle,v=new c.TextLayoutStyle;g.fontSize={unit:c.FontUnit.Point,size:9,backgroundSize:0},g.opacity=.75,g.backgroundOpacity=.75,g.color=new n.Color(.8,.2,.2);const y=Number.MAX_SAFE_INTEGER;class _{constructor(){this.geometry=new n.BufferGeometry,this.indices=new Array,this.positions=new Array}}function x(e,t,i,n,r){r.positions.push(e,t-n,i),r.positions.push(e+n,t,i),r.positions.push(e,t+n,i),r.positions.push(e-n,t,i);const s=r.positions.length/3;r.indices.push(s-4),r.indices.push(s-3),r.indices.push(s-2),r.indices.push(s-4),r.indices.push(s-2),r.indices.push(s-1)}function w(e,t,i=0,r){if(t.indices.length>0){t.geometry.addGroup(0,t.indices.length,0),t.geometry.setAttribute("position",new n.BufferAttribute(new Float32Array(t.positions),3)),t.geometry.setIndex(new n.BufferAttribute(new Uint32Array(t.indices),1));const s=r(t.geometry);s.renderOrder=y-i,e.push(s)}}class b extends s.Tile{constructor(e,t){super(e,t)}loadingFinished(){var e,t,i,y;const b=o.debugContext.getValue("DEBUG_TEXT_PATHS"),T=o.debugContext.getValue("DEBUG_TEXT_PATHS_FULL"),M=o.debugContext.getValue("DEBUG_TEXT_POIS_FULL"),S=o.debugContext.getValue("DEBUG_TEXT_LINE_MARKER");if(!(b||T||S)||void 0===this.decodedTile)return;const E=a.TileGeometryCreator.instance,A=this.decodedTile,C=new Map,P=o.debugContext.getValue("DEBUG_TEXT_PATHS.FILTER.TEXT"),L=o.debugContext.getValue("DEBUG_TEXT_PATHS.FILTER.INDEX"),R=this.mapView.env;void 0!==A.textPathGeometries&&(this.preparedTextPaths=E.prepareTextPaths(A.textPathGeometries,A));const D=this.center.x,I=this.center.y,O=this.center.z,F=this.mapView.pixelToWorld,V=this.computeWorldOffsetX();let U=0;if(this.iconTextGroups.count()>0){const e=new _,t=new _,i=[];this.iconTextGroups.forEachElement((r=>{if(r.type!==l.IconTextType.LineMarker&&r.type!==l.IconTextType.PointIconText)return;const o=r.type===l.IconTextType.LineMarker?t:e,a=5*F,h=(e,t,l)=>{if(x(e,t,l,a,o),M||S){const o=.5*a,h=`${r.text} [${U}]`,u=new s.IconText(c.ContextualArabicConverter.instance.convert(h),new n.Vector3(e+V+D+o,t+I+o,l+O),g,v,s.IconText.HIGHEST_PRIORITY,s.IconText.HIGHEST_Z_ORDER,0,0);u.textMinZoomLevel=0,u.mayOverlap=!0,u.reserveSpace=!1,u.alwaysOnTop=!0,u.ignoreDistance=!0,u.priority=s.IconText.HIGHEST_PRIORITY,u._isDebug=!0,i.push(u)}U++};if(void 0!==r.path&&Array.isArray(r.path))for(let e=0;e<r.path.length;e++){const t=r.path[e];h(t.x-D,t.y-I,10+t.z+5*e-O)}else M&&h(r.position.x-D,r.position.y-I,5-O)}));for(const e of i)this.addIconText(e);w(this.objects,e,0,(e=>new n.Mesh(e,p))),w(this.objects,t,0,(e=>new n.Mesh(e,f)))}if(void 0!==this.preparedTextPaths){const o=new _,a=new _,l=new _;let p=0;for(const u of this.preparedTextPaths){const d=A.techniques[u.technique];if(!(0,h.isTextTechnique)(d)||void 0!==u._isDebug)continue;void 0!==d.color&&C.set(u.technique,new n.Color((0,r.getPropertyValue)(d.color,R))),p=o.positions.length/3;const m=u.text,f=this.preparedTextPaths.indexOf(u);if((!P||m&&m.includes(P))&&(void 0===L||L===f)){for(let h=0;h<u.path.length;h+=3){const p=h/3,f=u.path[h]-D,_=u.path[h+1]-I,w=10+u.path[h+2]+h/3-O;b&&o.positions.push(f,_,w);const M=0===h&&b;if((T||M)&&(x(f,_,w,F*(M?6:4),M?a:l),T)){const o=null!==(e=d.xOffset)&&void 0!==e?e:0,a=null!==(t=d.yOffset)&&void 0!==t?t:0,l=d.minZoomLevel,h=p%5==0?m+":"+p:Number(p).toString(),u=new s.IconText(c.ContextualArabicConverter.instance.convert(h),new n.Vector3(f+V+D,_+I,w+O),g,v,(0,r.getPropertyValue)(null!==(i=d.priority)&&void 0!==i?i:0,R),(0,r.getPropertyValue)(null!==(y=d.zOrder)&&void 0!==y?y:0,R),o,a);u.textMinZoomLevel=(0,r.getPropertyValue)(l,R),u.mayOverlap=!0,u.reserveSpace=!1,u.alwaysOnTop=!0,u.ignoreDistance=!0,u.priority=s.IconText.HIGHEST_PRIORITY,u.zOrder=s.IconText.HIGHEST_Z_ORDER,this.addIconText(u)}}const h=u.path.length/3;for(let e=0;e<h;++e)e>0&&o.indices.push(p+e),e+1<h&&o.indices.push(p+e)}}w(this.objects,o,-2,(e=>new n.LineSegments(e,u))),w(this.objects,a,0,(e=>new n.Mesh(e,d))),w(this.objects,l,-1,(e=>new n.Mesh(e,m)))}}}t.OmvDebugLabelsTile=b},9959:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.GEOJSON_TILER_SERVICE_TYPE=t.VECTOR_TILE_DECODER_SERVICE_TYPE=t.OmvGeometryType=void 0,(i=t.OmvGeometryType||(t.OmvGeometryType={}))[i.UNKNOWN=0]="UNKNOWN",i[i.POINT=1]="POINT",i[i.LINESTRING=2]="LINESTRING",i[i.POLYGON=3]="POLYGON",t.VECTOR_TILE_DECODER_SERVICE_TYPE="vector-tile-decoder",t.GEOJSON_TILER_SERVICE_TYPE="geojson-tiler"},7305:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvPoliticalViewFeatureModifier=void 0,t.OmvPoliticalViewFeatureModifier=class{constructor(e){this.m_countryCode=e}doProcessPointFeature(e,t,i){return this.processFeature(e,t)}doProcessLineFeature(e,t,i){return this.processFeature(e,t)}doProcessPolygonFeature(e,t,i){return!0}rewriteEnvironment(e,t){this.isPoliticalViewLayer(e)&&this.updateEnvironment(t,this.m_countryCode,"kind")}updateEnvironment(e,t,i){const n=this.getAlternativePov(e,t,i);void 0!==n&&(e.entries[i]=n)}getAlternativePov(e,t,i){const n=t,r=e.lookup(`${i}:${n}`);return"string"==typeof r&&r.length>0?r:void 0}isPoliticalViewLayer(e){return"boundaries"===e||"places"===e}processFeature(e,t){let i=!1;if(this.isPoliticalViewLayer(e)){const n=Object.keys(t.unmap()).filter((e=>e.includes("kind:"))).length>0,r=!!t.lookup(`kind:${this.m_countryCode}`),s=!!t.lookup("kind"),o=Boolean(this.m_countryCode);i=!o&&!s&&n||o&&(!s&&n&&!r||s&&r),!i&&o&&r&&this.rewriteEnvironment(e,t)}return!i}}},3123:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvRestClient=t.AuthenticationTypeAccessToken=t.AuthenticationTypeTomTomV1=t.AuthenticationTypeBearer=t.AuthenticationMethod=t.APIFormat=void 0;const n=i(8449),r=i(3209),s=i(4342).LoggerManager.instance.create("OmvRestClient");var o,a;!function(e){e[e.HereV1=0]="HereV1",e[e.MapboxV4=1]="MapboxV4",e[e.XYZMVT=2]="XYZMVT",e[e.XYZJson=3]="XYZJson",e[e.XYZOMV=4]="XYZOMV",e[e.TomtomV1=5]="TomtomV1",e[e.XYZSpace=6]="XYZSpace"}(o=t.APIFormat||(t.APIFormat={})),function(e){e[e.QueryString=0]="QueryString",e[e.AuthorizationHeader=1]="AuthorizationHeader"}(a=t.AuthenticationMethod||(t.AuthenticationMethod={})),t.AuthenticationTypeBearer={method:a.AuthorizationHeader,name:"Bearer"},t.AuthenticationTypeTomTomV1={method:a.QueryString,name:"key"},t.AuthenticationTypeAccessToken={method:a.QueryString,name:"access_token"};class l extends n.DataProvider{constructor(e){super(),this.params=e,this.downloadManager=void 0===e.downloadManager?r.TransferManager.instance():e.downloadManager,this.urlParams=void 0===e.urlParams?{}:e.urlParams}async connect(){}ready(){return!0}async getTile(e,t){const i={signal:t};let n=this.dataUrl(e);const r=await this.getActualAuthenticationCode();return n=this.applyAuthCode(n,i,r),n=this.addQueryParams(n,this.urlParams),this.params.apiFormat===o.XYZJson?await this.downloadManager.downloadJson(n,i):await this.downloadManager.downloadArrayBuffer(n,i)}dispose(){}async getActualAuthenticationCode(){return"string"==typeof this.params.authenticationCode?this.params.authenticationCode:void 0!==this.params.authenticationCode?await this.params.authenticationCode():void 0!==this.params.getBearerToken?await this.params.getBearerToken():void 0}getDefaultAuthMethod(){if(void 0!==this.params.getBearerToken)return t.AuthenticationTypeBearer;switch(this.params.apiFormat){case o.HereV1:return t.AuthenticationTypeBearer;case o.MapboxV4:case o.XYZOMV:case o.XYZMVT:case o.XYZSpace:case o.XYZJson:return t.AuthenticationTypeAccessToken;case o.TomtomV1:return t.AuthenticationTypeTomTomV1;default:return void s.warn(`#getDefaultAuthMethod: Not supported API format: ${this.params.apiFormat}`)}}applyAuthCode(e,t,i){var n,r,s;if(void 0===i)return e;const o=null!==(n=this.params.authenticationMethod)&&void 0!==n?n:this.getDefaultAuthMethod();if(void 0===o)return e;if(o.method===a.AuthorizationHeader){void 0===t.headers&&(t.headers=new Headers);const e=null!==(r=o.name)&&void 0!==r?r:"Bearer";t.headers.append("Authorization",`${e} ${i}`)}else if(o.method===a.QueryString){const t={};t[null!==(s=o.name)&&void 0!==s?s:"access_token"]=i,e=this.addQueryParams(e,t)}return e}dataUrl(e){if(void 0!==this.params.url)return this.params.url.replace("{x}",String(e.column)).replace("{y}",String(e.row)).replace("{z}",String(e.level));let t=[`/${e.level}`,e.column,e.row].join(this.params.apiFormat===o.XYZSpace||this.params.apiFormat===o.XYZJson?"_":"/");switch(this.params.apiFormat){case o.HereV1:case o.XYZOMV:t+="/omv";break;case o.MapboxV4:case o.XYZMVT:t+=".mvt";break;case o.XYZJson:break;case o.XYZSpace:t+=".mvt";break;case o.TomtomV1:t+=".pbf";break;default:s.warn(`Not supported API format: ${this.params.apiFormat}`)}return this.params.baseUrl+t}addQueryParams(e,t){let i="",n=e.includes("?")?"&":"?";for(const e in t)t.hasOwnProperty(e)&&(i+=`${n}${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`,"?"===n&&(n="&"));return e+i}}t.OmvRestClient=l},6441:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webMercatorTile2TargetTile=t.webMercatorTile2TargetWorld=t.world2tile=t.tile2world=t.createWorldTileTransformationCookie=t.tile2lat=t.lat2tile=t.isArrayBufferLike=void 0;const n=i(82),r=i(2616);function s(e,t){return Math.round((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}function o(e,t){const{north:i,west:n}=t.geoBox,r=Math.log2(e),o=Math.pow(2,t.tileKey.level+r);return{extents:e,scale:o,top:s(i,t.tileKey.level+r),left:Math.round((n+180)/360*o)}}function a(e,t,i,n=!1,s){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=o(e,t));const{top:a,left:l,scale:c}=t.worldTileProjectionCookie,h=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return s.x=(l+i.x)/c*h,s.y=(a+(n?-i.y:i.y))/c*h,s.z=(0,r.isVector3Like)(i)?i.z:0,s}function l(e,t,i,s,o,l=!1){a(e,t,i,l,s),t.targetProjection.reprojectPoint(r.webMercatorProjection,s,s),i instanceof n.Vector3&&o&&(s.z*=t.targetProjection.getScaleFactor(s))}t.isArrayBufferLike=function(e){return"undefined"!=typeof SharedArrayBuffer?e instanceof ArrayBuffer||e instanceof SharedArrayBuffer:e instanceof ArrayBuffer},t.lat2tile=s,t.tile2lat=function(e,t){const i=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))},t.createWorldTileTransformationCookie=o,t.tile2world=a,t.world2tile=function(e,t,i,n=!1,s){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=o(e,t));const{top:a,left:l,scale:c}=t.worldTileProjectionCookie,h=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return s.x=Math.round(i.x/h*c-l),s.y=Math.round((n?-1:1)*(i.y/h*c-a)),(0,r.isVector3Like)(s)&&(s.z=i.z),s},t.webMercatorTile2TargetWorld=l,t.webMercatorTile2TargetTile=function(e,t,i,n,r,s=!1){l(e,t,i,n,r,s),n.sub(t.center)}},627:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ring=void 0;const n=i(82);t.Ring=class{constructor(e,t,i=4096,r=!1){if(this.points=e,this.textureCoords=t,this.extents=i,this.hasClipInfo=r,void 0!==t&&t.length!==e.length)throw new Error("the array of texture coordinates must have the same number of elements of the array of points");this.vertexStride=2,void 0!==t&&(this.vertexStride=this.vertexStride+2),this.area=n.ShapeUtils.area(this.points),this.winding=this.area<0}toArray(e=[],t=0){var i;return this.points.forEach(((i,n)=>i.toArray(e,t+this.vertexStride*n))),null===(i=this.textureCoords)||void 0===i||i.forEach(((i,n)=>i.toArray(e,t+this.vertexStride*n+2))),e}isProperEdge(e){const t=this.extents,i=(e+1)%this.points.length,n=this.points[e],r=this.points[i];if(this.hasClipInfo){if(n.x!==r.x&&n.y!==r.y)return!0;if(n.x%this.extents!=0&&n.y%this.extents!=0)return!0;if(r.x%this.extents!=0&&r.y%this.extents!=0)return!0;const e=!0===n.isClipped,t=!0===r.isClipped;return!e&&!t}return!(n.x<=0&&r.x<=0||n.x>=t&&r.x>=t||n.y<=0&&r.y<=0||n.y>=t&&r.y>=t)}}},1140:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorTileDataEmitter=void 0;const n=i(1874),r=i(82),s=i(8152),o=i(3561),a=i(2982),l=i(6525),c=i(6189),h=i(2616),u=i(4388),d=i(3711),m=i(4250),p=i(1984),f=i(4342),g=i(9287),v=i(6441),y=i(627),_=f.LoggerManager.instance.create("OmvDecodedTileEmitter"),x=new r.Vector3,w=new r.Vector3,b=new r.Vector3,T=new r.Vector3,M=new r.Vector2,S=new r.Vector2,E=new r.Vector3,A=new r.Vector3,C=new r.Vector3,P=new r.Vector2,L=new r.Vector2,R=new r.Vector2,D=new r.Vector3,I=new r.Vector3,O=new r.Vector3,F=new r.Vector3,V=new r.Vector3,U=new r.Line3,B=Math.PI/8;function N(e,t,i="index"){const n=t>65535?"uint32":"uint16";return{itemCount:1,name:i,buffer:("uint32"===n?new Uint32Array(e):new Uint16Array(e)).buffer,type:n}}class k{constructor(e){this.type=e,this.positions=[],this.normals=[],this.textureCoordinates=[],this.colors=[],this.extrusionAxis=[],this.indices=[],this.edgeIndices=[],this.groups=[],this.texts=[],this.pathLengths=[],this.stringCatalog=[],this.imageTextures=[],this.textBackgroundImageTextures=[],this.featureStarts=[],this.edgeFeatureStarts=[],this.objInfos=[],this.offsetDirections=[]}addText(e){let t=this.stringCatalog.indexOf(e);return t<0&&(t=this.stringCatalog.length,this.stringCatalog.push(e)),t}}var z;!function(e){e[e.Simple=0]="Simple",e[e.Complex=1]="Complex"}(z||(z={}));const G=new r.Color;t.VectorTileDataEmitter=class{constructor(e,t,i={}){var n,r,s;this.m_decodeInfo=e,this.m_styleSetEvaluator=t,this.m_options=i,this.m_meshBuffers=new Map,this.m_geometries=[],this.m_textGeometries=[],this.m_textPathGeometries=[],this.m_pathGeometries=[],this.m_iconTextGeometries=[],this.m_simpleLines=[],this.m_solidLines=[],this.m_sources=[],this.m_maxGeometryHeight=0,this.m_minGeometryHeight=0,this.m_options.gatherFeatureAttributes=null!==(n=i.gatherFeatureAttributes)&&void 0!==n&&n,this.m_options.skipShortLabels=null===(r=i.skipShortLabels)||void 0===r||r,this.m_options.enableElevationOverlay=null!==(s=i.enableElevationOverlay)&&void 0!==s&&s}get projection(){return this.m_decodeInfo.targetProjection}get center(){return this.m_decodeInfo.center}processPointFeature(e,t,i,n,r){var a;const l=n.env;this.processFeatureCommon(l);const{tileKey:c,columnCount:u,rowCount:d}=this.m_decodeInfo,m=c.column+1<u?t-1:t,f=c.row+1<d?t-1:t,g=i.filter((e=>e.x>=0&&e.x<=m&&e.y>=0&&e.y<=f));if(0!==g.length)for(const e of r){if(void 0===e)continue;const i=e._index,r=this.findOrCreateMeshBuffers(i,s.GeometryType.Point);if(void 0===r)continue;const{positions:c,texts:u,imageTextures:d,textBackgroundImageTextures:m,objInfos:f,offsetDirections:y}=r,_=(0,p.isTextTechnique)(e)||(0,p.isIconTextTechnique)(e);let x,w;const b=(0,p.isIconTextTechnique)(e);if(b){const t=e;x=(0,o.evaluateTechniqueAttr)(n,t.imageTexture),void 0!==t["background-image"]&&(w=(0,o.evaluateTechniqueAttr)(n,t["background-image"]))}const T=(0,s.scaleHeight)(n,e,this.m_decodeInfo.tileKey.level),M=(0,s.getFeatureId)(l.entries);for(const i of g){if(_){const t=e,i=(0,s.getFeatureText)(n,t,this.m_options.languages);void 0!==i&&i.length>0?u.push(r.addText(i)):u.push(-1)}_?(0,v.webMercatorTile2TargetWorld)(t,this.m_decodeInfo,i,E,T):(0,v.webMercatorTile2TargetTile)(t,this.m_decodeInfo,i,E,T);const o=this.projection.type===h.ProjectionType.Planar?E.z:i.z;o>this.m_maxGeometryHeight?this.m_maxGeometryHeight=o:o<this.m_minGeometryHeight&&(this.m_minGeometryHeight=o),c.push(E.x,E.y,E.z),f.push(this.m_options.gatherFeatureAttributes?l.entries:M),y.push(null!==(a=l.lookup("offset_direction"))&&void 0!==a?a:0),b&&(void 0===x?d.push(-1):d.push(r.addText(x)),void 0===w?m.push(-1):m.push(r.addText(w)))}}}processLineFeature(e,t,i,n,a){var l;const c=n.env;this.processFeatureCommon(c);const h=[],u=[],m=[],y=[],x=this.m_decodeInfo.projectedBoundingBox;let w;const b=2*x.extents.x,T=2*x.extents.y,M=Math.max(b,T);let S,P;const L=void 0!==i[0].untiledPositions,R=!1;let D=!1,I=!1;for(const e of a)if(void 0!==e){if(S){const t=this.getTextureCoordinateType(e);(0,f.assert)(void 0===t||P===t)}else S=this.getComputeTexCoordsFunc(e),P=this.getTextureCoordinateType(e);D=D||(0,p.isSpecialDashesLineTechnique)(e),I=I||!D}for(const e of i){const i=[];let n=0;if(L&&(this.m_decodeInfo.targetProjection.projectPoint(e.untiledPositions[0],A),e.untiledPositions.forEach((e=>{this.m_decodeInfo.targetProjection.projectPoint(e,E),n+=E.distanceTo(A),A.copy(E),this.m_decodeInfo.targetProjection.projectPoint(e.normalized(),E),i.push(E.x,E.y,E.z,n)}))),D){w=[];let r=0;const s=e.positions.length;if(s>1){let o=0;for(let a=0;a<s-1;a++){const s=[],l=[],c=[],h=[],d=e.positions[a],p=e.positions[a+1];if((0,v.webMercatorTile2TargetWorld)(t,this.m_decodeInfo,d,E,R),l.push(E.x,E.y,E.z),(0,v.webMercatorTile2TargetWorld)(t,this.m_decodeInfo,p,C,R),l.push(C.x,C.y,C.z),S&&(S(d,t).toArray(c,c.length),S(p,t).toArray(c,c.length)),L){let e=this.findRelativePositionInLine(E,i)/n;h.push(e),e=this.findRelativePositionInLine(C,i)/n,h.push(e)}else{h.push(o);const e=E.distanceTo(C);r+=e,o+=e,h.push(o)}E.sub(this.m_decodeInfo.center),s.push(E.x,E.y,E.z),C.sub(this.m_decodeInfo.center),s.push(C.x,C.y,C.z),w.push(s),u.push(l),m.push(c),y.push(h)}}if(!L&&r>0)for(const e of y)e.forEach(((t,i)=>{e[i]=t/r}))}if(I){const r=[],s=[],o=[],a=[];e.positions.forEach((e=>{if((0,v.webMercatorTile2TargetWorld)(t,this.m_decodeInfo,e,E,R),s.push(E.x,E.y,E.z),S&&S(e,t).toArray(o,o.length),L){const e=this.findRelativePositionInLine(E,i)/n;a.push(e)}E.sub(this.m_decodeInfo.center),r.push(E.x,E.y,E.z)})),h.push(r),u.push(s),m.push(o),y.push(a)}}const O=this.m_decodeInfo.tileKey.level>=11;for(const e of a){if(void 0===e)continue;const t=e._index,i=e.name;if((0,p.isLineTechnique)(e)||(0,p.isSolidLineTechnique)(e)){const i=(0,p.isLineTechnique)(e)?this.m_simpleLines:this.m_solidLines,r=(0,p.isLineTechnique)(e)?z.Simple:z.Complex;D&&((0,f.assert)(void 0!==w,"OmvDecodedTileEmitter#processLineFeature: Internal error - No localLineSegments"),this.applyLineTechnique(i,e,t,r,c.entries,w,n,this.getTextureCoordinateType(e)?m:void 0,y)),h.length>0&&this.applyLineTechnique(i,e,t,r,c.entries,h,n,this.getTextureCoordinateType(e)?m:void 0,L?y:void 0)}else if((0,p.isTextTechnique)(e)||(0,p.isIconTextTechnique)(e)||(0,p.isLineMarkerTechnique)(e)){const i=e,a=(0,s.getFeatureText)(n,i,this.m_options.languages);if(void 0===a||0===a.length)continue;if((0,p.isTextTechnique)(e)){let e=[];if(this.m_options.skipShortLabels){const t=M/this.m_decodeInfo.tileSizeOnScreen,i=5*a.length*t*.5,n=i*i;e=this.splitJaggyLines(u,n,B)}else e=u;if(0===e.length)continue;for(const i of e){const e=f.Math2D.computeSquaredLineLength(i);this.m_textPathGeometries.push({technique:t,path:i,pathLengthSqr:e,text:String(a),objInfos:this.m_options.gatherFeatureAttributes?c.entries:(0,s.getFeatureId)(c.entries)})}}else{const i=e,h=(0,o.evaluateTechniqueAttr)(n,i.imageTexture),d=Math.max(Number.EPSILON,null!==(l=(0,o.evaluateTechniqueAttr)(n,i["anchor-point-density"]))&&void 0!==l?l:20),m=this.m_decodeInfo.projectedBoundingBox.extents,p=2*Math.min(m.x,m.y)/d,f=new r.BufferAttribute(new Float64Array,3);for(const e of u)f.array=e,f.count=e.length/f.itemSize,this.m_iconTextGeometries.push({technique:t,positions:{name:"position",type:"float",buffer:(0,g.computeLineAnchorPoints)(f,p),itemCount:f.itemSize},texts:[0],stringCatalog:[a,h],imageTextures:[1],objInfos:this.m_options.gatherFeatureAttributes?[c.entries]:[(0,s.getFeatureId)(c.entries)]})}}else if((0,p.isLabelRejectionLineTechnique)(e))for(const e of u){const t=[];for(let i=0;i<e.length;i+=3)t.push((new r.Vector3).fromArray(e,i));this.m_pathGeometries.push({path:t})}else if((0,p.isExtrudedLineTechnique)(e)){const i=this.findOrCreateMeshBuffers(t,s.GeometryType.ExtrudedLine);if(void 0===i)continue;const{positions:r,indices:a,groups:l,featureStarts:u,objInfos:m}=i,p=a.length,f=(0,o.evaluateTechniqueAttr)(n,e.lineWidth);if(void 0===f)continue;const g=(0,o.evaluateTechniqueAttr)(n,e.caps,"Circle"),v=O&&"Circle"===g;h.forEach((e=>{(0,d.triangulateLine)(e,f,r,a,v),u.push(p),m.push(this.m_options.gatherFeatureAttributes?c.entries:(0,s.getFeatureId)(c.entries))}));const y=a.length-p;l.push({start:p,count:y,technique:t})}else _.warn(`OmvDecodedTileEmitter#processLineFeature: Invalid line technique\n                     ${i} for layer: ${c.entries.$layer} `)}}processPolygonFeature(e,t,i,n,s){const o=n.env;this.processFeatureCommon(o);const l=!1;s.forEach((e=>{if(void 0===e)return;const s=e._index;if(void 0===s)throw new Error("OmvDecodedTileEmitter#processPolygonFeature: Internal error - No technique index");let c;const u=o.lookup("bbox");if(Array.isArray(u)){const[e,t,i,n]=u,s=new h.GeoBox(new h.GeoCoordinates(t,e),new h.GeoCoordinates(n,i));c=new r.Box3,h.webMercatorProjection.projectBox(s,c)}const d=[],m=(0,p.isExtrudedPolygonTechnique)(e),f=(0,p.isFillTechnique)(e),g=(0,p.isStandardTechnique)(e),_=m||f||g,x=this.getComputeTexCoordsFunc(e,c),w=_&&!m;for(const e of i){const i=[];for(let n=0;n<e.rings.length;n++){const s=0===n;let o=e.rings[n];w&&o.some((e=>e.x<0||e.x>t||e.y<0||e.y>t))&&(o=(0,a.clipPolygon)(o,t));const l=r.ShapeUtils.area(o);if(s&&0===l)break;if(0!==l){let e;void 0!==x&&(e=o.map((e=>x(e,t)))),i.push(new y.Ring(o,e,t,w))}}i.length>0&&d.push(i)}const b=(0,p.isSolidLineTechnique)(e)||(0,p.isLineTechnique)(e);if(_)this.applyPolygonTechnique(d,e,s,n,t);else if(b){const i="line"===e.name?this.m_simpleLines:this.m_solidLines,r="line"===e.name?z.Simple:z.Complex,a=(0,p.isSpecialDashesLineTechnique)(e);d.forEach((c=>{const h=[],u=a?[]:void 0;c.forEach((e=>{const i=e.points.length;let n=[],r=0,s=0,o=a?[]:void 0;for(let c=0;c<i;++c){a&&n.length>0&&(n=[],o=[]);const d=(c+1)%i,m=e.points[c],p=e.points[d],f=e.isProperEdge(c);if(f||0===n.length){if(f&&0===n.length&&((0,v.webMercatorTile2TargetTile)(t,this.m_decodeInfo,M.copy(m),E,l),n.push(E.x,E.y,E.z),a)){(0,v.webMercatorTile2TargetTile)(t,this.m_decodeInfo,M.copy(p),C,l),n.push(C.x,C.y,C.z),o.push(s);const e=E.distanceTo(C);r+=e,s+=e,o.push(s)}}else h.push(n),n=[];f&&!a&&((0,v.webMercatorTile2TargetTile)(t,this.m_decodeInfo,M.copy(p),E,l),n.push(E.x,E.y,E.z)),a&&n.length>0&&r>0&&(o.forEach(((e,t)=>{o[t]=e/r})),h.push(n),u.push(o))}!a&&n.length>0&&h.push(n)})),0!==h.length&&this.applyLineTechnique(i,e,s,r,o.entries,h,n,void 0,u)}))}}))}getDecodedTile(){this.createGeometries(),this.processSimpleLines(this.m_simpleLines),this.processLines(this.m_solidLines);const e={techniques:this.m_styleSetEvaluator.decodedTechniques,geometries:this.m_geometries,decodeTime:void 0};return this.m_textGeometries.length>0&&(e.textGeometries=this.m_textGeometries),this.m_iconTextGeometries.length>0&&(e.iconTextGeometries=this.m_iconTextGeometries),this.m_textPathGeometries.length>0&&(e.textPathGeometries=this.m_textPathGeometries),this.m_pathGeometries.length>0&&(e.pathGeometries=this.m_pathGeometries),0!==this.m_sources.length&&(e.copyrightHolderIds=this.m_sources),e.maxGeometryHeight=this.m_maxGeometryHeight,e.minGeometryHeight=this.m_minGeometryHeight,e}splitJaggyLines(e,t,i){const n=[],r=(e,t,i)=>{let n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;for(let a=t;a<i;a+=3){const t=e[a],i=e[a+1];t<n&&(n=t),t>r&&(r=t),i<s&&(s=i),i>o&&(o=i)}return(r-n)*(r-n)+(o-s)*(o-s)},s=e.slice();for(;s.length>0;){const e=s.pop();if(void 0===e||e.length<6)continue;let o=-1;for(let t=0;t<e.length-3;t+=3){P.set(e[t],e[t+1]),L.set(e[t+3],e[t+4]);const n=L.sub(P).normalize();if(t>0){const e=Math.atan2(R.x*n.y-n.x*R.y,n.dot(R));if(Math.abs(e)>i){o=t;break}}R.set(n.x,n.y)}if(o>0){const i=r(e,0,o+3),a=r(e,o,e.length);i>t&&n.push(e.slice(0,o+3)),a>t&&s.push(e.slice(o))}else r(e,0,e.length)>t&&n.push(e)}return n}getTextureCoordinateType(e){return((0,p.isFillTechnique)(e)||(0,p.isSolidLineTechnique)(e)||(0,p.isExtrudedPolygonTechnique)(e))&&this.m_options.enableElevationOverlay?p.TextureCoordinateType.TileSpace:(0,p.textureCoordinateType)(e)}getComputeTexCoordsFunc(e,t){switch(this.getTextureCoordinateType(e)){case p.TextureCoordinateType.TileSpace:return(e,t)=>{const i=e.clone().divideScalar(t);return i.y=1-i.y,i};case p.TextureCoordinateType.EquirectangularSpace:return(e,t)=>{const i=(0,v.tile2world)(t,this.m_decodeInfo,e,!1,A),n=h.normalizedEquirectangularProjection.reprojectPoint(h.webMercatorProjection,i);return new r.Vector2(n.x,n.y)};case p.TextureCoordinateType.FeatureSpace:if(!t)return;return(e,i)=>{const n=(0,v.tile2world)(i,this.m_decodeInfo,e,!1,A),s=new r.Vector2(n.x,n.y);return t&&(s.x-=t.min.x,s.y-=t.min.y,s.x/=t.max.x-t.min.x,s.y/=t.max.y-t.min.y),s.y=1-s.y,s};default:return}}applyLineTechnique(e,t,i,n=z.Complex,r,o,a,l,c){let h;const d=e.find((e=>e.technique===i)),m=void 0!==l;if(void 0===d){h=new u.LineGroup(m,void 0,n===z.Simple);const t={type:n===z.Complex?s.GeometryType.SolidLine:s.GeometryType.Line,technique:i,lines:h};this.m_options.gatherFeatureAttributes&&(t.objInfos=[r],t.featureStarts=[0]),e.push(t)}else h=d.lines,this.m_options.gatherFeatureAttributes&&d.objInfos&&d.featureStarts&&(d.objInfos.push(r),d.featureStarts.push(h.indices.length));let p=0;o.forEach((e=>{h.add(this.m_decodeInfo.center,e,this.projection,c?c[p]:void 0,l?l[p]:void 0),p++}))}applyPolygonTechnique(e,t,i,a,u){var d,g;if(0===e.length)return;const y=(0,p.isExtrudedPolygonTechnique)(t),C=y?s.GeometryType.ExtrudedPolygon:s.GeometryType.Polygon,P=this.findOrCreateMeshBuffers(i,C);if(void 0===P)return;const L=t,R=t,D=!0===L.boundaryWalls,I=(0,p.isFillTechnique)(t),O=this.getTextureCoordinateType(t);let F=(0,o.evaluateTechniqueAttr)(a,L.height),V=(0,o.evaluateTechniqueAttr)(a,L.floorHeight);if(void 0===F){const e=a.env.lookup("height"),t=(0,o.evaluateTechniqueAttr)(a,L.defaultHeight);F=void 0!==e?e:void 0!==t?t:0}if(void 0===V){const e=a.env.lookup("min_height");V=void 0===e||I?0:e}F=Math.max(V+m.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT,F);const U=this.m_decodeInfo.tileKey.level,B=y&&(0,s.scaleHeight)(a,L,U);this.m_decodeInfo.tileBounds.getCenter(x);const{positions:k,normals:z,textureCoordinates:j,colors:H,extrusionAxis:W,indices:q,edgeIndices:X,groups:Z}=P,Y=this.m_decodeInfo.targetProjection.type===h.ProjectionType.Spherical,K=y?null!==(d=L.lineWidth)&&void 0!==d?d:0:I&&null!==(g=R.lineWidth)&&void 0!==g?g:0,$="number"!=typeof K||K>0;let J;if((0,p.isExtrudedPolygonTechnique)(t)&&(0,f.getOptionValue)(t.vertexColors,!1)){let e=(0,o.evaluateTechniqueAttr)(a,t.color);if(void 0===e){const t=a.env.lookup("color");this.isColorStringValid(t)&&(e=String(t))}void 0===e&&(e=(0,o.evaluateTechniqueAttr)(a,t.defaultColor,0)),void 0===e&&(e=0),G.set(e),J=G}for(const t of e){const e=q.length,s=X.length,o=[],d=k.length/3,m=t[0],p=m.vertexStride,f=p+2;for(let e=0;e<m.points.length;++e){const t=m.points[e];o.push(t.x,-t.y),void 0!==m.textureCoords&&o.push(m.textureCoords[e].x,m.textureCoords[e].y);const i=(e+1)%m.points.length,n=m.isProperEdge(e);o.push(n?i:-1,D||n?i:-1)}const g=[];let x=1;for(;x<t.length;){const e=o.length/f;g.push(e);const i=t[x++];for(let t=0;t<i.points.length;++t){const n=(t+1)%i.points.length,r=i.points[t];o.push(r.x,-r.y),void 0!==i.textureCoords&&o.push(i.textureCoords[t].x,i.textureCoords[t].y);const s=i.isProperEdge(t);o.push(s?e+n:-1,D||s?e+n:-1)}}try{const e=(0,n.default)(o,g,f),t=o.length/f;if(Y){const t=new r.BufferGeometry,i=[],n=[],s=[],a=[];for(let e=0;e<o.length;e+=f){const t=(0,v.tile2world)(u,this.m_decodeInfo,M.set(o[e],o[e+1]),!0,A);i.push(t.x,t.y,0),void 0!==O&&n.push(o[e+2],o[e+3]),s.push(o[e+p]),a.push(o[e+p+1])}const d=new r.BufferAttribute(new Float32Array(i),3);let m;t.setAttribute("position",d),void 0!==O&&(m=new r.BufferAttribute(new Float32Array(n),2),t.setAttribute("uv",m));const g=new r.BufferAttribute(new Float32Array(s),1);t.setAttribute("edge",g);const y=new r.BufferAttribute(new Float32Array(a),1);t.setAttribute("wall",g);const _=N(e,d.count-1),x="uint32"===_.type?new r.Uint32BufferAttribute(_.buffer,1):new r.Uint16BufferAttribute(_.buffer,1);t.setIndex(x);const w=this.m_decodeInfo.tileKey.level;if(w>=3&&w<9){const e=Math.pow(2,9-w),{geoBox:i}=this.m_decodeInfo;new l.EdgeLengthGeometrySubdivisionModifier(e,i,l.SubdivisionMode.NoDiagonals,h.webMercatorProjection).modify(t)}new c.SphericalGeometrySubdivisionModifier(r.MathUtils.degToRad(10),h.webMercatorProjection).modify(t),o.length=0,e.length=0;for(let e=0;e<d.array.length;e+=3){const t=(0,v.world2tile)(u,this.m_decodeInfo,E.set(d.array[e],d.array[e+1],0),!0,S);o.push(t.x,t.y),void 0!==O&&(o.push(m.array[e/3*2]),o.push(m.array[e/3*2+1])),o.push(g.array[e/3]),o.push(y.array[e/3])}const b=t.getIndex();null!==b&&e.push(...b.array)}w.set(0,0,1);for(let e=0;e<o.length;e+=f){(0,v.webMercatorTile2TargetWorld)(u,this.m_decodeInfo,M.set(o[e],o[e+1]),E,!1,!0);const t=B?this.m_decodeInfo.targetProjection.getScaleFactor(E):1;this.m_maxGeometryHeight=Math.max(this.m_maxGeometryHeight,t*F),this.m_minGeometryHeight=Math.min(this.m_minGeometryHeight,t*F),Y&&w.set(E.x,E.y,E.z).normalize(),E.sub(this.center),b.copy(w).multiplyScalar(V*t),k.push(E.x+b.x,E.y+b.y,E.z+b.z),void 0!==O&&j.push(o[e+2],o[e+3]),this.m_options.enableElevationOverlay&&z.push(...w.toArray()),y&&(T.copy(w).multiplyScalar(F*t),k.push(E.x+T.x,E.y+T.y,E.z+T.z),W.push(0,0,0,0,T.x-b.x,T.y-b.y,T.z-b.z,1),void 0!==O&&j.push(o[e+2],o[e+3]),this.m_options.enableElevationOverlay&&z.push(...w.toArray()),void 0!==J&&H.push(J.r,J.g,J.b,J.r,J.g,J.b))}for(let t=0;t<e.length;t+=3)if(y){const i=d+2*e[t+0]+1,n=d+2*e[t+1]+1,r=d+2*e[t+2]+1;q.push(i,n,r)}else{const i=d+e[t+0],n=d+e[t+1],r=d+e[t+2];q.push(i,n,r)}$&&this.addEdges(d,t,f,p,k,o,X,y,L.footprint,L.maxSlope),y&&this.addWalls(d,t,f,p,o,q)}catch(e){_.error("cannot triangulate geometry",e)}this.m_options.gatherFeatureAttributes&&(P.objInfos.push(a.env.entries),P.featureStarts.push(e),P.edgeFeatureStarts.push(s));const C=q.length-e;C>0&&Z.push({start:e,count:C,technique:i})}}createGeometries(){this.m_meshBuffers.forEach(((e,t)=>{if(0===e.positions.length)return;if(!this.m_styleSetEvaluator.techniques||this.m_styleSetEvaluator.techniques.length<=t)throw new Error("Invalid technique index");const i=this.m_styleSetEvaluator.techniques[t];if(void 0===i)return;if(e.texts.length>0){const n={positions:{name:"position",type:"float",buffer:new Float64Array(e.positions).buffer,itemCount:3},texts:e.texts,technique:t,stringCatalog:e.stringCatalog,objInfos:e.objInfos};if((0,p.isTextTechnique)(i))this.m_textGeometries.push(n);else{(0,f.assert)((0,p.isIconTextTechnique)(i));const t=n;t.imageTextures=e.imageTextures,t.textBackgroundImageTextures=e.textBackgroundImageTextures,t.offsetDirections=e.offsetDirections,this.m_iconTextGeometries.push(t)}return}const n=new Float32Array(e.positions);0===e.groups.length&&e.groups.push({start:0,count:n.length/3,technique:t});const r=[{name:"position",buffer:n.buffer,itemCount:3,type:"float"}],s={type:e.type,vertexAttributes:r,groups:e.groups};if(e.normals.length>0){const t=new Float32Array(e.normals);(0,f.assert)(t.length===n.length,"length of normals buffer is different than the length of the position buffer"),r.push({name:"normal",buffer:t.buffer,itemCount:3,type:"float"})}if(e.colors.length>0){const t=new Float32Array(e.colors);(0,f.assert)(t.length===n.length,"length of colors buffer is different than the length of the position buffer"),r.push({name:"color",buffer:t.buffer,itemCount:3,type:"float"})}const o=e.positions.length/3;if(e.textureCoordinates.length>0){const t=e.textureCoordinates.length/2;(0,f.assert)(t===o,"length of textureCoordinates buffer is different than the length of theposition buffer");const i=new Float32Array(e.textureCoordinates);r.push({name:"uv",buffer:i.buffer,itemCount:2,type:"float"})}if(e.extrusionAxis.length>0){const t=new Float32Array(e.extrusionAxis);(0,f.assert)(t.length/4==n.length/3,"length of extrusionAxis buffer is different than the length of the position buffer"),r.push({name:"extrusionAxis",buffer:t.buffer,itemCount:4,type:"float"})}e.indices.length>0&&(s.index=N(e.indices,o-1)),e.edgeIndices.length>0&&(s.edgeIndex=N(e.edgeIndices,o-1,"edgeIndex")),s.featureStarts=e.featureStarts,s.edgeFeatureStarts=e.edgeFeatureStarts,s.objInfos=e.objInfos,this.m_geometries.push(s)}))}processLines(e){e.forEach((e=>{const{vertices:t,indices:i}=e.lines,n=e.technique,r=new Float32Array(t).buffer,o=N(i,t.length/e.lines.stride-1),a={type:"float",stride:e.lines.stride,buffer:r,attributes:e.lines.vertexAttributes},l={type:s.GeometryType.SolidLine,index:o,interleavedVertexAttributes:[a],groups:[{start:0,count:i.length,technique:n}],vertexAttributes:[],featureStarts:e.featureStarts,objInfos:e.objInfos};this.m_geometries.push(l)}))}processSimpleLines(e){e.forEach((e=>{const{vertices:t,indices:i}=e.lines,n=e.technique,r={buffer:new Float32Array(t).buffer,itemCount:3,type:"float",name:"position"},o={type:s.GeometryType.Line,index:N(i,t.length/r.itemCount-1),vertexAttributes:[r],groups:[{start:0,count:i.length,technique:n}],featureStarts:e.featureStarts,objInfos:e.objInfos};this.m_geometries.push(o)}))}findOrCreateMeshBuffers(e,t){let i=this.m_meshBuffers.get(e);return void 0!==i?i.type!==t?void _.error(`MeshBuffer has been created with wrong type "${s.GeometryType[t]}"\n                instead of "${s.GeometryType[i.type]}"`):i:(i=new k(t),this.m_meshBuffers.set(e,i),i)}processFeatureCommon(e){const t=e.lookup("source");"string"==typeof t&&""!==t&&(this.m_sources.includes(t)||this.m_sources.push(t))}isColorStringValid(e){return"string"==typeof e&&e.length>0}addEdges(e,t,i,n,s,o,a,l,c,h){const u=new r.Vector3,d=new r.Vector3;let m,p,f=0,g=0;for(;f<t;){for(;f!==m;){void 0===m&&(m=f),f<t&&(g=Math.max(g,f));const r=o[f*i+n];if(r<0)break;if(l)if(!0===c&&a.push(e+2*f,e+2*r),a.push(e+2*f+1,e+2*r+1),void 0!==h){if(void 0!==p){const t=3*(e+2*p),i=3*(e+2*f),n=3*(e+2*r);u.set(s[i]-s[t],s[i+1]-s[t+1],s[i+2]-s[t+2]).normalize(),d.set(s[n]-s[i],s[n+1]-s[i+1],s[n+2]-s[i+2]).normalize(),u.dot(d)<=h&&a.push(e+2*f,e+2*f+1)}}else a.push(e+2*f,e+2*f+1);else a.push(e+f,e+r);p=f,f=r}f=g+1,m=void 0,p=void 0}}addWalls(e,t,i,n,r,s){let o,a=0,l=0;for(;a<t;){for(;a!==o;){void 0===o&&(o=a),a<t&&(l=Math.max(l,a));const c=r[a*i+n+1];if(c<0)break;s.push(e+2*a,e+2*a+1,e+2*c+1,e+2*c+1,e+2*c,e+2*a),a=c}a=l+1,o=void 0}}findRelativePositionInLine(e,t){let i=1/0,n=0;for(let r=0;r<t.length;r+=4){U.set(D.set(t[r],t[r+1],t[r+2]),I.set(t[r+4],t[r+5],t[r+6])),U.closestPointToPoint(e,!0,O);const s=O.distanceTo(e);s<i&&(F.copy(O),V.copy(D),i=s,n=t[r+3])}return n+F.distanceTo(V)}}},3436:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorTileDataSource=void 0;const n=i(8152),r=i(2616),s=i(2344),o=i(8449),a=i(4342),l=i(9959),c=i(3123),h=a.LoggerManager.instance.create("VectorTileDataSource");function u(e){var t;if(e.dataProvider)return e.dataProvider;if(null!==(t=e.baseUrl)&&void 0!==t?t:e.url)return new c.OmvRestClient(e);throw new Error("OmvDataSource: missing url, baseUrl or dataProvider params")}let d=!1;const m="https://vector.hereapi.com/v2/vectortiles/base/mc",p={baseUrl:m,apiFormat:c.APIFormat.XYZOMV,styleSetNames:["tilezen"],authenticationMethod:{method:c.AuthenticationMethod.QueryString,name:"apikey"},copyrightInfo:[{id:"here.com",year:(new Date).getFullYear(),label:"HERE",link:"https://legal.here.com/terms"}]},f=new Map([[m,p]]);class g extends o.TileDataSource{constructor(e){var t,i,n,h,d,p,g;super(null!==(t=e.tileFactory)&&void 0!==t?t:new o.TileFactory(s.Tile),Object.assign({styleSetNames:null!==(i=e.styleSetNames)&&void 0!==i?i:["omv"],concurrentDecoderServiceName:null!==(n=e.concurrentDecoderServiceName)&&void 0!==n?n:l.VECTOR_TILE_DECODER_SERVICE_TYPE,minDataLevel:null!==(h=e.minDataLevel)&&void 0!==h?h:1,maxDataLevel:null!==(d=e.maxDataLevel)&&void 0!==d?d:17,storageLevelOffset:null!==(p=e.storageLevelOffset)&&void 0!==p?p:-1},function(e){var t;if(void 0===e.dataProvider&&void 0===e.url){const i=null!==(t=e.baseUrl)&&void 0!==t?t:m,n=Object.assign(Object.assign({},f.get(i)),e);return Object.assign(Object.assign({},n),{tilingScheme:r.webMercatorTilingScheme,dataProvider:new c.OmvRestClient(n)})}return Object.assign(Object.assign({},e),{tilingScheme:r.webMercatorTilingScheme,dataProvider:u(e)})}(e))),this.m_params=e,this.cacheable=!0,this.addGroundPlane=void 0===e.addGroundPlane||!0===e.addGroundPlane;let v=e.roundUpCoordinatesIfNeeded;void 0===v&&(null==e?void 0:e.baseUrl)===m&&(v=!0),this.m_decoderOptions={showMissingTechniques:!0===this.m_params.showMissingTechniques,gatherFeatureAttributes:!0===this.m_params.gatherFeatureAttributes,politicalView:this.m_params.politicalView,skipShortLabels:this.m_params.skipShortLabels,storageLevelOffset:null!==(g=e.storageLevelOffset)&&void 0!==g?g:-1,enableElevationOverlay:!0===this.m_params.enableElevationOverlay,roundUpCoordinatesIfNeeded:v},this.maxGeometryHeight=(0,a.getOptionValue)(e.maxGeometryHeight,r.EarthConstants.MAX_BUILDING_HEIGHT),this.minGeometryHeight=(0,a.getOptionValue)(e.minGeometryHeight,0)}async connect(){try{await super.connect()}catch(e){throw e.message&&n.WorkerServiceProtocol.isUnknownServiceError(e)&&!d&&(h.info("Unable to create decoder service in worker. Use  'OmvTileDecoderService.start();' in decoder script."),d=!0),"string"==typeof e?new Error(e):e}this.configureDecoder(void 0,this.m_decoderOptions)}shouldPreloadTiles(){return!0}setPoliticalView(e){e=null==e?void 0:e.toLowerCase(),this.m_decoderOptions.politicalView!==e&&(this.m_decoderOptions.politicalView=e,this.configureDecoder(void 0,{politicalView:void 0!==e?e:""}))}get storageLevelOffset(){return super.storageLevelOffset}set storageLevelOffset(e){super.storageLevelOffset=e,this.m_decoderOptions.storageLevelOffset=this.storageLevelOffset,this.configureDecoder(void 0,{storageLevelOffset:this.storageLevelOffset})}setEnableElevationOverlay(e){this.m_decoderOptions.enableElevationOverlay!==e&&(this.m_decoderOptions.enableElevationOverlay=e,this.configureDecoder(void 0,{enableElevationOverlay:e}))}configureDecoder(e,t){this.clearCache(),this.decoder.configure(e,t),this.isDetached()||this.mapView.markTilesDirty(this)}}t.VectorTileDataSource=g},1503:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorTileDecoderService=t.VectorTileDecoder=t.VectorTileDataProcessor=void 0;const n=i(7769),r=i(2626),s=i(4342),o=i(5156),a=i(2926),l=i(4585),c=i(9252),h=i(9959),u=i(1140),d=s.LoggerManager.instance.create("VectorTileDecoder",{enabled:!1});class m{constructor(e,t,i,n,r={}){var s,o;this.m_tileKey=e,this.m_projection=t,this.m_styleSetEvaluator=i,this.m_dataAdapter=n,this.m_options=r,r.storageLevelOffset=null!==(s=r.storageLevelOffset)&&void 0!==s?s:0,r.showMissingTechniques=null!==(o=r.showMissingTechniques)&&void 0!==o&&o}getDecodedTile(e){this.m_styleSetEvaluator.resetTechniques();const t=new c.DecodeInfo(this.m_projection,this.m_tileKey,this.m_options.storageLevelOffset);return this.m_decodedTileEmitter=new u.VectorTileDataEmitter(t,this.m_styleSetEvaluator,this.m_options),this.m_dataAdapter.process(e,t,this),this.m_decodedTileEmitter.getDecodedTile()}processPointFeature(e,t,i,n,r){(0,s.assert)(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,i,"point",n,r,this.m_decodedTileEmitter.processPointFeature)}processLineFeature(e,t,i,n,r){(0,s.assert)(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,i,"line",n,r,this.m_decodedTileEmitter.processLineFeature)}processPolygonFeature(e,t,i,n,r){(0,s.assert)(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,i,"polygon",n,r,this.m_decodedTileEmitter.processPolygonFeature)}processFeature(e,t,i,n,r,s,o){const a=this.createMapEnv(r,s,e,n),l=this.m_styleSetEvaluator.getMatchingTechniques(a,e,n);if(0===l.length)return void(this.m_options.showMissingTechniques&&d.log("VectorTileDataProcessor#processFeature: no techniques for object:",JSON.stringify(a.unmap())));const c={env:a,cachedExprResults:new Map};this.m_decodedTileEmitter&&o.apply(this.m_decodedTileEmitter,[e,t,i,c,l])}createMapEnv(e,t,i,r){const s=this.m_tileKey.level;return new n.MapEnv(Object.assign({$layer:i,$id:null!=t?t:null,$level:s,$zoom:Math.max(0,s-this.m_options.storageLevelOffset),$geometryType:r},e))}}t.VectorTileDataProcessor=m;class p extends r.ThemedTileDecoder{constructor(e){super(),this.m_dataAdapter=e,this.m_options={map:{},changed:!1},this.m_defaultDataAdapters=[],this.m_defaultDataAdapters.push(new l.OmvDataAdapter,new a.GeoJsonVtDataAdapter,new o.GeoJsonDataAdapter)}connect(){return Promise.resolve()}decodeThemedTile(e,t,i,n){const r=s.PerformanceTimer.now();if(!this.m_dataAdapter&&(this.m_dataAdapter=this.findDefaultDataAdapter(e),!this.m_dataAdapter))return Promise.reject(new Error("Unsupported data format."));const o=this.m_dataAdapter;if((0,s.assert)(o.canProcess(e)),this.m_options.changed){if(o instanceof l.OmvDataAdapter){const e=this.m_options.map;o.configure(e)}this.m_options.changed=!1}const a=new m(t,n,i,o,this.m_options.map).getDecodedTile(e);return a.decodeTime=s.PerformanceTimer.now()-r,Promise.resolve(a)}configure(e,t){super.configure(e,t),this.m_options.map=Object.assign(Object.assign(Object.assign({},this.m_options.map),e),t),this.m_options.changed=!0}findDefaultDataAdapter(e){for(const t of this.m_defaultDataAdapters)if(t.canProcess(e))return t}}t.VectorTileDecoder=p,t.VectorTileDecoderService=class{static start(){r.WorkerServiceManager.getInstance().register({serviceType:h.VECTOR_TILE_DECODER_SERVICE_TYPE,factory:e=>r.TileDecoderService.start(e,new p)})}}},2926:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonVtDataAdapter=void 0;const n=i(82),r=i(2616),s=i(6441),o=4096;var a;!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(a||(a={}));const l=new n.Vector3;t.GeoJsonVtDataAdapter=class{canProcess(e){if((0,s.isArrayBufferLike)(e))return!1;const t=e;return void 0!==t.features&&void 0!==t.source&&void 0!==t.x&&void 0!==t.y&&void 0!==t.z}process(e,t,i){for(const c of e.features)switch(c.type){case a.Point:for(const t of c.geometry){const r=t[0],s=t[1],a=new n.Vector3(r,s,0);i.processPointFeature(e.layer,o,[a],c.tags,c.id)}break;case a.LineString:{const a=c.geometry;let h;const u=[];a.forEach((e=>{const t=null==h?void 0:h.positions[h.positions.length-1],[i,r]=e[0];if((null==t?void 0:t.x)===i&&(null==t?void 0:t.y)===r)for(let t=1;t<e.length;++t){const[i,r]=e[t];null==h||h.positions.push(new n.Vector2(i,r))}else{const t=e.map((([e,t])=>new n.Vector2(e,t)));u.push({positions:t}),h=u[u.length-1]}})),u.forEach((e=>{e.untiledPositions=e.positions.map((e=>((0,s.tile2world)(o,t,e,!1,l),r.webMercatorProjection.unprojectPoint(l))))})),i.processLineFeature(e.layer,o,u,c.tags,c.id);break}case a.Polygon:{const t=[];let r;for(const e of c.geometry){const i=[];for(const[t,r]of e){const e=new n.Vector2(t,r);i.push(e)}n.ShapeUtils.area(i)>0&&(r={rings:[]},t.push(r)),null==r||r.rings.push(i)}i.processPolygonFeature(e.layer,o,t,c.tags,c.id);break}case a.Unknown:}}}},5156:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonDataAdapter=void 0;const n=i(82),r=i(6112),s=i(2616),o=i(6441),a=4096,l=new n.Vector3;function c(e,t,i){return s.webMercatorProjection.projectPoint(s.GeoCoordinates.fromGeoPoint(e),l),(0,o.world2tile)(a,t,l,!1,i)}function h(e,t){return{untiledPositions:e.map((e=>s.GeoCoordinates.fromGeoPoint(e))),positions:e.map((e=>c(e,t,new n.Vector2)))}}function u(e,t){return"LineString"===e.type?[h(e.coordinates,t)]:e.coordinates.map((e=>h(e,t)))}function d(e,t){return{rings:e.map(((e,i)=>{const r=0===i,{positions:s}=h(e,t),o=n.ShapeUtils.area(s)>0;return(r&&!o||!r&&o)&&s.reverse(),s}))}}function m(e,t){return"Polygon"===e.type?[d(e.coordinates,t)]:e.coordinates.map((e=>d(e,t)))}function p(e,t){return"Point"===e.type?[c(e.coordinates,t,new n.Vector3)]:e.coordinates.map((e=>c(e,t,new n.Vector3)))}t.GeoJsonDataAdapter=class{canProcess(e){return e&&"FeatureCollection"===e.type&&Array.isArray(e.features)}process(e,t,i,n="geojson"){if(Array.isArray(e.features)&&0!==e.features.length)for(const s of e.features)switch(s.geometry.type){case"LineString":case"MultiLineString":{let e=u(s.geometry,t);const o=[],l=100;e.forEach((e=>{(0,r.clipLineString)(e.positions,-l,-l,a+l,a+l).forEach((e=>{o.push({positions:e})}))})),e=o,e.length>0&&i.processLineFeature(n,a,o,s.properties,s.id);break}case"Polygon":case"MultiPolygon":{const e=m(s.geometry,t);i.processPolygonFeature(n,a,e,s.properties,s.id);break}case"Point":case"MultiPoint":{const e=p(s.geometry,t);i.processPointFeature(n,a,e,s.properties,s.id);break}}}}},9607:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryCommands=t.FeatureAttributes=t.visitOmvLayer=t.visitOmv=t.isClosePathCommand=t.isLineToCommand=t.isMoveToCommand=t.CommandKind=void 0;const n=i(82),r=i(3577);var s;function o(e,t){if((!t.visitLayer||t.visitLayer(e))&&e.features)for(const i of e.features)switch(i.type){case r.com.mapbox.pb.Tile.GeomType.UNKNOWN:break;case r.com.mapbox.pb.Tile.GeomType.POINT:t.visitPointFeature&&t.visitPointFeature(i);break;case r.com.mapbox.pb.Tile.GeomType.LINESTRING:t.visitLineFeature&&t.visitLineFeature(i);break;case r.com.mapbox.pb.Tile.GeomType.POLYGON:t.visitPolygonFeature&&t.visitPolygonFeature(i)}t.endVisitLayer&&t.endVisitLayer(e)}!function(e){e[e.MoveTo=1]="MoveTo",e[e.LineTo=2]="LineTo",e[e.ClosePath=7]="ClosePath"}(s=t.CommandKind||(t.CommandKind={})),t.isMoveToCommand=function(e){return e.kind===s.MoveTo},t.isLineToCommand=function(e){return e.kind===s.LineTo},t.isClosePathCommand=function(e){return e.kind===s.ClosePath},t.visitOmv=function(e,t){if(e.layers)for(const i of e.layers)t.visitLayer&&!t.visitLayer(i)||o(i,t),t.endVisitLayer&&t.endVisitLayer(i)},t.visitOmvLayer=o,t.FeatureAttributes=class{accept(e,t,i){const{keys:n,values:r}=e,s=t.tags;if(s&&n&&r)for(let e=0;e<s.length;e+=2){const t=n[s[e]],o=r[s[e+1]];if(!i.visitAttribute(t,o))break}}},t.GeometryCommands=class{accept(e,t){if(!e)return;const i=e.length;let r=0,o=0;const a=[],l=[],c=[];for(let h=0;h<i;){const i=7&e[h],u=e[h]>>3;if(++h,i===s.MoveTo||i===s.LineTo)for(let s=0;s<u;++s){const s=e[h++],u=e[h++];r+=s>>1^-(1&s),o+=u>>1^-(1&u),"Polygon"===t.type&&(a.push(r),l.push(o));const d=new n.Vector2(r,o);c.push({kind:i,position:d})}else{for(const e of c)t.visitCommand(e);t.visitCommand({kind:i}),a.length=0,l.length=0,c.length=0}}if(c.length>0)for(const e of c)t.visitCommand(e)}}},4585:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvDataAdapter=t.asGeometryType=void 0;const n=i(5133),r=i(82),s=i(7769),o=i(4342),a=i(9959),l=i(7305),c=i(6441),h=i(9607),u=i(3577),d=["stringValue","floatValue","doubleValue","intValue","uintValue","sintValue","boolValue"],m=o.LoggerManager.instance.create("OmvDataAdapter",{enabled:!1}),p=n.fromNumber(Number.MAX_SAFE_INTEGER,!0),f=n.fromNumber(Number.MIN_SAFE_INTEGER,!1);function g(e,t,i){if(void 0!==t.id&&null!==t.id)return t.id;if(e.hasOwnProperty("id")){const t=e.id;if("number"==typeof t)return t;if(t)return void 0!==i&&t.greaterThan(Number.MAX_SAFE_INTEGER)&&i.error("Invalid ID: Larger than largest available Number in feature: ",e),t.toNumber()}}function v(e){if(void 0===e)return a.OmvGeometryType.UNKNOWN;switch(e.type){case u.com.mapbox.pb.Tile.GeomType.UNKNOWN:return a.OmvGeometryType.UNKNOWN;case u.com.mapbox.pb.Tile.GeomType.POINT:return a.OmvGeometryType.POINT;case u.com.mapbox.pb.Tile.GeomType.LINESTRING:return a.OmvGeometryType.LINESTRING;case u.com.mapbox.pb.Tile.GeomType.POLYGON:return a.OmvGeometryType.POLYGON;default:return a.OmvGeometryType.UNKNOWN}}function y(e,t){e.forEach((e=>{e.x===t-1&&(e.x=t)}))}t.asGeometryType=v,t.OmvDataAdapter=class{constructor(){this.m_geometryCommands=new h.GeometryCommands,this.m_roundUpCoordinatesIfNeeded=!1}configure(e){var t;const i=e.politicalView;this.m_dataFilter=void 0,this.m_featureModifiers=[new l.OmvPoliticalViewFeatureModifier(null!=i?i:"")],this.m_roundUpCoordinatesIfNeeded=null!==(t=e.roundUpCoordinatesIfNeeded)&&void 0!==t&&t}canProcess(e){return(0,c.isArrayBufferLike)(e)}process(e,t,i){const{tileKey:n}=t,r=new Uint8Array(e),s=u.com.mapbox.pb.Tile.decode(r);this.m_tileKey=n,this.m_processor=i,(0,h.visitOmv)(s,this)}visitLayer(e){this.m_layer=e;const t=this.m_tileKey.level,i=e.name;return!(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsLayer(i,t))}visitPointFeature(e){var t;if(void 0===e.geometry)return;const i=this.filterAndModifyFeature(e,"doProcessPointFeature","wantsPointFeature");if(!i)return;const n=this.m_layer.name,s=null!==(t=this.m_layer.extent)&&void 0!==t?t:4096,o=[];this.m_geometryCommands.accept(e.geometry,{type:"Point",visitCommand:e=>{(0,h.isMoveToCommand)(e)&&o.push(new r.Vector3(e.position.x,e.position.y,0))}}),0!==o.length&&this.m_processor.processPointFeature(n,s,o,i,g(e,i,m))}visitLineFeature(e){var t;if(void 0===e.geometry)return;const i=this.filterAndModifyFeature(e,"doProcessLineFeature","wantsLineFeature");if(!i)return;const n=this.m_layer.name,r=null!==(t=this.m_layer.extent)&&void 0!==t?t:4096,s=[];let o;this.m_geometryCommands.accept(e.geometry,{type:"Line",visitCommand:e=>{(0,h.isMoveToCommand)(e)?(o=[e.position],s.push({positions:o})):(0,h.isLineToCommand)(e)&&o.push(e.position)}}),0!==s.length&&(this.mustRoundUpCoordinates&&function(e,t){e.forEach((e=>y(e.positions,t)))}(s,r),this.m_processor.processLineFeature(n,r,s,i,g(e,i,m)))}visitPolygonFeature(e){var t;if(void 0===e.geometry)return;const i=this.filterAndModifyFeature(e,"doProcessPolygonFeature","wantsPolygonFeature");if(!i)return;const n=this.m_layer.name,s=null!==(t=this.m_layer.extent)&&void 0!==t?t:4096,o=[];let a,l,c;this.m_geometryCommands.accept(e.geometry,{type:"Polygon",visitCommand:e=>{if((0,h.isMoveToCommand)(e))l=[e.position];else if((0,h.isLineToCommand)(e))l.push(e.position);else if((0,h.isClosePathCommand)(e)&&void 0!==l&&l.length>0){const e=Math.sign(r.ShapeUtils.area(l));void 0===c&&(c=e),e===c&&(a={rings:[]},o.push(a)),l.push(l[0].clone()),null==a||a.rings.push(l)}}}),0!==o.length&&(this.mustRoundUpCoordinates&&function(e,t){e.forEach((e=>e.rings.forEach((e=>y(e,t)))))}(o,s),function(e){const t=e[0];if(void 0!==t&&0!==t.rings.length&&!(r.ShapeUtils.area(t.rings[0])>0))for(const t of e)for(const e of t.rings)e.reverse()}(o),this.m_processor.processPolygonFeature(n,s,o,i,g(e,i,m)))}filterAndModifyFeature(e,t,i){const r=this.m_tileKey.level,o=this.m_layer.name,a=v(e);if(this.m_dataFilter&&!1===this.m_dataFilter[i](o,a,r))return;const l=function(e,t){const i=new h.FeatureAttributes,r={};return i.accept(e,t,{visitAttribute:(e,t)=>(r[e]=function(e){const t=Object.prototype.hasOwnProperty;for(const i of d)if(t.call(e,i)){const t=e[i];if(void 0===t)throw new Error("unpexted undefined value");return n.isLong(t)?t.comp(p)>0||t.comp(f)<0?t.toString():t.toNumber():t}throw new Error("not happening")}(t),!0)}),r}(this.m_layer,e),c=new s.MapEnv(l);return this.m_featureModifiers&&this.m_featureModifiers.find((e=>!e[t](o,c,this.m_tileKey.level)))?void 0:l}get mustRoundUpCoordinates(){return this.m_roundUpCoordinatesIfNeeded&&this.m_tileKey.level<5&&this.m_tileKey.column===this.m_tileKey.columnCount()-1}}},9330:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTileDataSource=void 0;const n=i(5185),r=i(2616),s=i(2344),o=i(1984),a=i(4342),l=i(1527);class c extends s.DataSource{constructor(e){var t,i,n,r,s,o;super(e),this.m_options=e,this.m_opacity=1,this.m_renderOrder=0,this.m_transparent=!1,this.dataProvider=this.m_options.dataProvider,this.cacheable=!0,this.m_opacity=null!==(i=null===(t=this.m_options.renderingOptions)||void 0===t?void 0:t.opacity)&&void 0!==i?i:1,this.m_transparent=!0===(null===(n=this.m_options.renderingOptions)||void 0===n?void 0:n.transparent)||this.m_opacity<1,this.m_renderOrder=null!==(s=null===(r=this.m_options.renderingOptions)||void 0===r?void 0:r.renderOrder)&&void 0!==s?s:0,this.m_resolution=(0,a.getOptionValue)(e.resolution,c.resolutionValue.resolution512),this.styleSetNames=null!==(o=e.styleSetNames)&&void 0!==o?o:["raster"]}set opacity(e){var t;this.m_opacity=e,this.m_opacity<1?this.m_transparent=!0:!0!==(null===(t=this.m_options.renderingOptions)||void 0===t?void 0:t.transparent)&&(this.m_transparent=!1)}get opacity(){return this.m_opacity}get resolution(){return this.m_resolution}get renderOrder(){return this.m_renderOrder}get transparent(){return this.m_transparent}get technique(){return this.m_technique}shouldPreloadTiles(){return!0}getTilingScheme(){return r.webMercatorTilingScheme}getTile(e){const t=new s.Tile(this,e);return t.tileLoader=new l.WebTileLoader(this,t,this.dataProvider),t}isFullyCovering(){return!this.m_transparent}async setTheme(e,t){e=await s.ThemeLoader.load(e,{baseUrl:t});const i=(0,o.getStyles)(e.styles).filter((e=>{var t;return!e.styleSet||(null===(t=this.styleSetNames)||void 0===t?void 0:t.includes(e.styleSet))}));if(i.length>0){this.m_styleSetEvaluator=new n.StyleSetEvaluator({styleSet:i,definitions:e.definitions,priorities:e.priorities,labelPriorities:e.labelPriorities});const t=this.m_styleSetEvaluator.getMatchingTechniques(this.mapView.env);if(0===t.length)return;const r=t[t.length-1];(0,o.isRasterTechnique)(r)&&(this.m_technique=r)}}}t.WebTileDataSource=c,function(e){let t,i;!function(e){e[e.ppi72=72]="ppi72",e[e.ppi250=250]="ppi250",e[e.ppi320=320]="ppi320",e[e.ppi500=500]="ppi500"}(t=e.ppiValue||(e.ppiValue={})),function(e){e[e.resolution256=256]="resolution256",e[e.resolution512=512]="resolution512"}(i=e.resolutionValue||(e.resolutionValue={}))}(c=t.WebTileDataSource||(t.WebTileDataSource={}))},1527:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTileLoader=void 0;const n=i(82),r=i(8152),s=i(2344),o=i(8024),a=i(176),l=i(4250);class c extends s.BaseTileLoader{constructor(e,t,i){super(e,t.tileKey),this.dataSource=e,this.tile=t,this.dataProvider=i}loadImpl(e,t,i){this.dataProvider.getTexture(this.tile,e).then((e=>{if(void 0===e||void 0===e[0])return this.tile.forceHasGeometry(!0),void t(s.TileLoaderState.Ready);const[i,c]=e;void 0!==c&&(this.tile.copyrightInfo=c),i.minFilter=n.LinearFilter,i.magFilter=n.LinearFilter,i.generateMipmaps=!1,this.tile.clear();const h=(0,o.addGroundPlane)(this.tile,this.dataSource.renderOrder,16777215,this.dataSource.opacity,!0).material;(0,l.hasColorCorrectionFeature)(h)&&a.MapMaterialAdapter.create(h,{brightness:()=>{var e,t;const i=null!==(t=(0,r.getPropertyValue)(null===(e=this.dataSource.technique)||void 0===e?void 0:e.brightness,this.dataSource.mapView.env))&&void 0!==t?t:l.ColorCorrectionFeature.DEFAULT_BRIGHTNESS;return parseFloat(i).toFixed(3)},gamma:()=>{var e,t;const i=null!==(t=(0,r.getPropertyValue)(null===(e=this.dataSource.technique)||void 0===e?void 0:e.gamma,this.dataSource.mapView.env))&&void 0!==t?t:l.ColorCorrectionFeature.DEFAULT_GAMMA;return parseFloat(i).toFixed(3)}}),i.encoding=n.LinearEncoding,h.map=i,this.dataSource.transparent&&(0,l.enableBlending)(h),h.depthTest=!1,this.tile.invalidateResourceInfo(),this.dataSource.requestUpdate(),t(s.TileLoaderState.Ready)}),i).catch(i)}}t.WebTileLoader=c},9636:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Style=void 0;const n=i(6586);class r extends H.map.render.Style{constructor(e){super(e),this.m_abortController=new AbortController,"string"!=typeof e?this.setConfig(Object.assign({},e)):this.m_url=new URL(e,location.href).href,this.m_baseUrl="string"==typeof this.m_url?this.m_url:location.href,this.setState(H.map.render.Style.State.INIT)}getUrl(){return this.m_url}getBaseUrl(){return this.m_baseUrl}load(){this.loadAsync(!1,!1)}cancelLoad(){this.getState()===H.map.render.Style.State.LOADING&&(this.m_abortController.abort("Style load cancelled"),this.setState(H.map.render.Style.State.INIT))}async loadAsync(e,t){if(!t||this.getState()!==H.map.render.Style.State.READY){if(this.getState()===H.map.render.Style.State.LOADING)return await this.m_loadPromise.then((()=>{})).catch((()=>{}));if(void 0!==this.m_url){const t=H.getStylePath()+"/harp/";this.setState(H.map.render.Style.State.LOADING),this.m_abortController=new AbortController;const i=this.m_abortController.signal;try{this.m_loadPromise=n.load(this.m_url,{baseUrl:t,signal:i});const r=await this.m_loadPromise;this.setConfig(r),this.setState(H.map.render.Style.State.READY),e||this.dispatchChangeEvent()}catch(e){(null==i?void 0:i.aborted)||(this.setState(H.map.render.Style.State.ERROR),this.dispatchError(e))}}else this.setState(H.map.render.Style.State.READY),e||this.dispatchChangeEvent()}}setEnabledFeatures(e){const t=this.m_enabledFeatures;this.m_enabledFeatures=e,this.dispatchChangeEvent({enabledFeatures:this.m_enabledFeatures},{enabledFeatures:t})}getEnabledFeatures(){return this.m_enabledFeatures}disposeInternal(){super.disposeInternal(),this.cancelLoad()}dispatchChangeEvent(e,t){this.dispatchEvent(new H.util.ChangeEvent("change",e,t))}}t.Style=r},159:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageLoader=void 0,t.ImageLoader=class{constructor(e){this.mapView=e,this.m_textureReferenceCounts=new Map,this.m_tilesWithRefs=new Set}setImageReferences(e,t=[]){this.m_textureReferenceCounts.forEach(((i,n)=>{t.includes(n)||i.delete(e)&&0===i.size&&(this.mapView.imageRepo.imageCache.removeImage(this,n),this.m_textureReferenceCounts.delete(n))})),t.forEach((t=>{const i=this.m_textureReferenceCounts.get(t);void 0!==i?i.add(e):this.m_textureReferenceCounts.set(t,new Set([e]))})),t.length?this.m_tilesWithRefs.add(e):this.m_tilesWithRefs.delete(e)}releaseImageReferences(e){this.m_tilesWithRefs.has(e)&&this.setImageReferences(e)}dispose(){this.m_textureReferenceCounts.forEach(((e,t)=>{this.mapView.imageRepo.imageCache.removeImage(this,t)})),this.m_textureReferenceCounts.clear()}load(e,t){void 0===this.mapView.imageRepo.imageCache.findImage(e)&&this.mapView.imageRepo.imageCache.registerImageByUrl(this,e,t)}}},7564:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayeredGeoJsonDataAdapter=void 0;const n=i(5156);t.LayeredGeoJsonDataAdapter=class{constructor(){this.m_geoJsonDataAdapter=new n.GeoJsonDataAdapter}canProcess(e){return!0}process(e,t,i){"FeatureCollection"===e.data.type&&(e.data={geojson:e.data});const n=e.data;for(const e in n){const r=n[e];this.m_geoJsonDataAdapter.canProcess(r)&&this.m_geoJsonDataAdapter.process(r,t,i,e)}}}},1881:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalObjectDataAdapter=t.DEFAULT_EXTENTS=void 0;const n=i(2616),r=i(4342),s=i(7316),o=i(82),a=i(6441),l=i(5432),c=i(6112),h=r.LoggerManager.instance.create("harp::LocalObjectDataAdapter");t.DEFAULT_EXTENTS=4096;const u=100;t.LocalObjectDataAdapter=class{canProcess(e){return"object"==typeof e&&"markers"in e&&"spatials"in e&&"overlays"in e}process(e,t,i){this.processMarkers(e.markers,t,i),this.processSpatials(e.spatials,t,i),this.processOverlays(e.overlays,t,i)}processMarkers(e,i,n){e.forEach(((e,r)=>{var o;const a=(0,s.getMarkerProperties)(e);if(null!==a){a.zOrder=null!==(o=e.getZIndex())&&void 0!==o?o:r;const s=e.getGeometry();let l,c=a.id;s instanceof H.geo.Point?l=[f(s,i)]:(c=void 0,l=s.getGeometries().map((e=>f(e,i)))),n.processPointFeature("markers",t.DEFAULT_EXTENTS,l,a,c)}}))}processSpatials(e,i,o){const a="spatials";e.forEach(((e,l)=>{var c;const h={id:e.getId(),minZoom:e.getMin(!0),maxZoom:e.getMax(!0)+1,zOrder:l,volatile:e.getVolatility()},u=null!==(c=e.getStyle().lineWidth)&&void 0!==c?c:0;Object.assign(h,(0,s.getSpatialProperties)(e));const d=e.getId();if(e instanceof H.map.Polygon){const s=e.getElevation(),l=e.getExtrusion();if(h.min_height=s,h.height=s+l,h.height>0){h.lineWidth=r.MathUtils.clamp(u,0,1);const t=i.targetProjection;if(t.type===n.ProjectionType.Planar&&(h.constantHeight=h.height>2e3,!0===h.constantHeight)){const{lat:i,lng:n}=e.getBoundingBox().getCenter(),r=t.projectPoint({latitude:i,longitude:n}),s=t.getScaleFactor(r);h.min_height*=s,h.height*=s}}const c=function(e,t){if(e instanceof H.geo.MultiPolygon){const i=[],n=e.getGeometries();for(const e of n){const n=_(e,t);i.push(...n)}return i}return _(e,t)}(e.getGeometry(),i);o.processPolygonFeature(a,t.DEFAULT_EXTENTS,c,h,d)}else{const n=function(e,t){if(e instanceof H.geo.MultiLineString){const i=[];for(const n of e.getGeometries())i.push(...y(n,t));return i}return y(e,t)}(e.getGeometry(),i);n.length>0&&o.processLineFeature(a,t.DEFAULT_EXTENTS,n,h,d)}}))}processOverlays(e,i,n){e.forEach(((e,r)=>{const s=e.getGeometry().getBoundingBox(),o={id:e.getId(),minZoom:e.getMin(!0),maxZoom:e.getMax(!0)+1,zOrder:r,opacity:e.getOpacity(),min_height:0,height:0,volatile:e.getVolatility(),bbox:[s.getLeft(),s.getBottom(),s.getRight(),s.getTop()]},a=e.getBitmap();if(null===a)return;if(a instanceof HTMLImageElement)o.map=a.src;else{const e=a.getContext("2d");if(null===e)return void h.error("Cannot get context from canvas");o.map={buffer:e.getImageData(0,0,a.width,a.height).data.buffer,type:"image/raw",dataTextureProperties:{width:a.width,height:a.height}}}const l=_(H.geo.Polygon.fromRect(e.getGeometry()),i);n.processPolygonFeature("overlays",t.DEFAULT_EXTENTS,l,o,e.getId())}))}};const d=new o.Vector3,m=new n.GeoCoordinates(0,0);function p(e,i,r=new o.Vector3){return(0,a.world2tile)(t.DEFAULT_EXTENTS,i,n.webMercatorProjection.projectPoint(e,d),!1,r)}function f(e,t,i=new o.Vector3){return m.latitude=e.lat,m.longitude=e.lng,m.altitude=e.alt,p(m,t,i)}function g(e,t){const i=e.getLatLngAltArray(),n=[];for(let e=0;e<i.length;e+=3)m.latitude=i[e],m.longitude=i[e+1],m.altitude=i[e+2],n.push(p(m,t,new o.Vector2));return n}function v(e,t,i=!1){return e.map((e=>(m.longitude=e[0],m.latitude=e[1],m.altitude=e[2],p(m,t,new o.Vector2))))}function y(e,i){let n;if((0,l.isCrossingAntimeridian)(e)){const t=[];(0,l.wrapGeoLineString)(e,t),n=t.map((e=>v(e,i)))}else n=[g(e,i)];const r=[];for(const e of n){const i=(0,c.clipLineString)(e,-100,-100,t.DEFAULT_EXTENTS+u,t.DEFAULT_EXTENTS+u);for(const e of i)r.push({positions:H.math.simplifyDP(e,5)})}return r}function _(e,t){if((0,l.isCrossingAntimeridian)(e)){const i=[];return(0,l.wrapGeoPolygon)(e,i),i.map((e=>({rings:e.map((e=>v(e,t)))})))}{const i=e.getExterior(),n=e.getInteriors(),r=[],s=g(i,t);let a=o.ShapeUtils.area(s)>0;a||s.reverse(),r.push(s);for(const e of n){const i=g(e,t);a=o.ShapeUtils.area(i)>0,a&&i.reverse(),r.push(i)}return[{rings:r}]}}},9049:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalObjectDataProvider=void 0;const n=i(82),r=i(2730),s=i(1881),o=i(3261),a=new n.Box3,l=1/s.DEFAULT_EXTENTS;function c(e,t){return H.map.Object.compareZInfo(e.getZInfo(),t.getZInfo(),!1)}class h extends o.ObjectDataProvider{constructor(e){super(e),this.provider=e}async getTile(e,t){const i=this.m_tilingScheme.getGeoBox(e),n=(0,r.getClampedGeoRect)(i,e),s=(0,r.getClampedGeoRect)(u(this.m_tilingScheme,this.m_tilingScheme.getWorldBox(e,a),.1),e),o=(0,r.getClampedGeoRect)(u(this.m_tilingScheme,this.m_tilingScheme.getWorldBox(e,a),l),e);return{markers:this.provider.providesMarkers()?this.fetchMarkers(e,o):[],spatials:this.provider.providesSpatials()?this.fetchSpatials(e,s):[],overlays:this.provider.providesOverlays()?this.fetchOverlays(n):[]}}fetchMarkers(e,t){const i=[],n=[],r=this.getMarkerImageLoader(),s=this.provider.requestMarkers(t,void 0,!0,!1);for(const e of s){const t=e.getIcon();if(t.getState()===H.map.Icon.State.READY){const s=`H-icon-${t.uid}`;n.push(s),r.load(s,t.getBitmap()),i.push(e)}}return r.setImageReferences(e,n),i.sort(c),i}fetchSpatials(e,t){const i=this.provider.requestSpatials(t,void 0,!0,!1),n=[],r=this.getSpatialImageLoader();for(const e of i){const t=e.getStyle().lineDashImage;if(void 0!==t){const i=`H-lineDashImage-${e.getId()}`;n.push(i),r.load(i,t)}}return r.setImageReferences(e,n),i.sort(c)}fetchOverlays(e){return this.provider.requestOverlays(e,void 0,!0,!1).sort(c)}}function u(e,t,i){const r=new n.Vector3,s=t.getSize(r).multiplyScalar(i);return s.z=0,t.expandByVector(s),e.projection.unprojectBox(t)}t.LocalObjectDataProvider=h},2497:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalObjectDataSource=void 0;const n=i(82),r=i(9049),s=i(1930),o=i(9310),a=i(1881),l=i(1503),c=i(2730),h=i(8124),u=i(4262),d=new n.Box3;class m extends o.ObjectDataSource{constructor(e,t){super(Object.assign(Object.assign({},e),{dataProvider:new r.LocalObjectDataProvider(t),tileFactory:new s.TileFactory(o.ObjectTile),addGroundPlane:!1,gatherFeatureAttributes:!0,decoder:new l.VectorTileDecoder(new a.LocalObjectDataAdapter)}),t),this.provider=t,this.m_invalidateAllTiles=!1,this.m_synced_at=H.map.provider.Invalidations.MARK_INITIAL,this.m_affectedBoundingBox=new n.Box3,this.m_affectedBoundingBoxNextWorld=new n.Box3,this.m_objects=new Map}getMapObjectById(e){return this.m_objects.get(e)}attach(e){super.attach(e),this.provider instanceof H.map.provider.LocalObjectProvider&&this.provider.getRootGroup().getObjects(!0).forEach((e=>{this.m_objects.set(e.getId(),e)}))}detach(e){this.m_objects.forEach(((e,t)=>{e.getVolatility()&&(e instanceof H.map.Overlay?this.mapView.removeDynamicProperty(p(e)):e instanceof H.map.GeoShape&&this.removeStyleDynamicProps(e.getId()))})),super.detach(e)}setStyleDynamicProps(e,t){f.forEach((i=>this.mapView.setDynamicProperty(g(i,t),e[i])))}removeStyleDynamicProps(e){f.forEach((t=>this.mapView.removeDynamicProperty(g(t,e))))}dispose(){this.m_objects.clear(),super.dispose()}invalidateTiles(){const e=this.m_affectedBoundingBox.isEmpty();this.m_invalidateAllTiles||e?this.mapView.markTilesDirty(this):e||this.mapView.markTilesDirty(this,(e=>this.isTileAffected(e))),this.m_affectedBoundingBox.makeEmpty(),this.m_affectedBoundingBoxNextWorld.makeEmpty(),this.m_invalidateAllTiles=!1}isTileAffected(e){return this.getTilingScheme().getWorldBox(e.tileKey,d),d.intersectsBox(this.m_affectedBoundingBox)||!this.m_affectedBoundingBoxNextWorld.isEmpty()&&d.intersectsBox(this.m_affectedBoundingBoxNextWorld)}onProviderUpdate(e){if(this.isDetached())return;if(e.target===this.provider)return this.m_invalidateAllTiles=!0,void this.invalidateTiles();const t=e.target,i=this.m_synced_at,r=e.currentTarget.getInvalidations(t.type);if(this.m_synced_at=r.getMark(),t instanceof H.map.Marker&&t.getIcon().getState()===H.map.Icon.State.READY||t instanceof H.map.GeoShape||t instanceof H.map.Overlay){if(r.isRemove(i)?(this.m_objects.delete(t.getId()),t.getVolatility()&&(t instanceof H.map.Overlay?this.mapView.removeDynamicProperty(p(t)):t instanceof H.map.GeoShape&&this.removeStyleDynamicProps(t.getId()))):this.m_objects.set(t.getId(),t),r.isSpatial(i))return this.m_invalidateAllTiles=!0,void this.invalidateTiles();if(t instanceof H.map.GeoShape&&!t.getVolatility()&&r.isVolatility(i)&&(0,u.default)((()=>this.removeStyleDynamicProps(t.getId())),this.invalidationDebounceTime,this.invalidationMaxTime),t.getVolatility()&&(r.isAdd(i)||r.isVisual(i)||r.isVolatility(i)))if(t instanceof H.map.Overlay){const e=p(t),i=t.getBitmap(),n=this.mapView.env.lookup(e);if(null!==i&&n!==i&&(this.mapView.setDynamicProperty(e,i),void 0!==n))return}else if(t instanceof H.map.GeoShape){const e=t.getStyle(),n=t.getId();if(this.setStyleDynamicProps(e,n),r.isVisual(i))return}if(!this.m_invalidateAllTiles){const e=t instanceof H.map.Marker||t instanceof H.map.Overlay?t.getGeometry().getBoundingBox():t.getBoundingBox(),i=(0,c.hGeoRectToHarpGeoBox)(e);this.getTilingScheme().projection.projectBox(i,d),this.m_affectedBoundingBox=this.m_affectedBoundingBox.union(d);const r=this.projection.unitScale;(this.m_affectedBoundingBox.max.x>r||this.m_affectedBoundingBox.min.x<0)&&(this.m_affectedBoundingBoxNextWorld=new n.Box3(this.m_affectedBoundingBox.min.clone().add(new n.Vector3(-r,0,0)),this.m_affectedBoundingBox.max.clone().add(new n.Vector3(-r,0,0))))}this.invalidateTilesWithDelay()}}}function p(e){return`${h.ObjectStyleBuilder.DYNAMIC_OVERLAY_PROP_PREFIX}${e.getId()}`}t.LocalObjectDataSource=m;const f=["fillColor","strokeColor","lineWidth"];function g(e,t){return`${e}:${t}`}},3261:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectDataProvider=void 0;const n=i(8635);class r extends n.DataProvider{constructor(e){super(),this.provider=e}setTilingScheme(e){this.m_tilingScheme=e}setProjectionSource(e){this.m_projectionSource=e}getProjectionSource(){return this.m_projectionSource}setMarkerImageLoader(e){this.m_markerImageLoader=e}getMarkerImageLoader(){return this.m_markerImageLoader}setSpatialImageLoader(e){this.m_spatiaImageLoader=e}getSpatialImageLoader(){return this.m_spatiaImageLoader}async connect(){}dispose(){var e,t;null===(e=this.m_markerImageLoader)||void 0===e||e.dispose(),null===(t=this.m_spatiaImageLoader)||void 0===t||t.dispose()}ready(){return void 0!==this.m_markerImageLoader&&void 0!==this.m_spatiaImageLoader}}t.ObjectDataProvider=r},9310:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectTile=t.ObjectDataSource=void 0;const n=i(159),r=i(1447),s=i(1930),o=i(3436),a=i(4262);class l extends o.VectorTileDataSource{constructor(e,t){super(Object.assign(Object.assign({},e),{tileFactory:new s.TileFactory(c),addGroundPlane:!1,styleSetNames:[`H-${t.uid}`],gatherFeatureAttributes:!0})),this.provider=t,this.m_tileInvalidationPending=!1,this.invalidationDebounceTime=100,this.invalidationMaxTime=200,this.isDisposed=!1,t.addEventListener("update",this.onProviderUpdate,!1,this),this.debounceTileInvalidation=(0,a.default)((()=>{this.m_tileInvalidationPending=!1,this.isDisposed||this.invalidateTiles()}),this.invalidationDebounceTime,this.invalidationMaxTime)}attach(e){super.attach(e);const t=this.dataProvider();t.setMarkerImageLoader(new n.ImageLoader(e)),t.setSpatialImageLoader(new n.ImageLoader(e)),t.setTilingScheme(this.getTilingScheme()),t.setProjectionSource(this)}dispose(){this.provider.removeEventListener("update",this.onProviderUpdate,!1,this),super.dispose(),this.isDisposed=!0}get tileInvalidationPending(){return this.m_tileInvalidationPending}invalidateTilesWithDelay(){this.m_tileInvalidationPending=!0,this.debounceTileInvalidation()}}t.ObjectDataSource=l;class c extends r.Tile{dispose(){super.dispose(),this.dataSource.dataProvider().getMarkerImageLoader().releaseImageReferences(this.tileKey)}get allGeometryLoaded(){return super.allGeometryLoaded&&!this.dataSource.tileInvalidationPending}}t.ObjectTile=c},8124:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectStyleBuilder=void 0;const n=i(1984);class r{constructor(e){this.styleSetName=e,this.m_withVolatile=!1,this.m_withMarker=!1,this.m_withLine=!1,this.m_shouldClipLines=!1,this.m_withOverlay=!1,this.m_withPolygon=!1,this.m_withPolygonOutline=!0,this.m_withExtrudedPolygon=!1,this.m_withPolygonAlwaysPickable=!1}withVolatile(){return this.m_withVolatile=!0,this}withMarker(){return this.m_withMarker=!0,this}withLine(e=!1){return this.m_withLine=!0,this.m_shouldClipLines=e,this}withOverlay(){return this.m_withOverlay=!0,this}withPolygon(e=!1,t=!1,i=!1){return this.m_withPolygon=!0,this.m_withPolygonOutline=e,this.m_withExtrudedPolygon=t,this.m_withPolygonAlwaysPickable=i,this}build(){const e=[],t={styleSet:this.styleSetName,minZoomLevel:["case",!0,["get","minZoom"],["zoom"]],maxZoomLevel:["get","maxZoom"]};if(this.m_withMarker){const i=Object.assign(Object.assign({},t),{when:["==",["geometry-type"],"Point"],technique:"labeled-icon",priority:1e3,imageTexture:["get","imageTexture"],iconFadeTime:0,iconReserveSpace:!1,iconMayOverlap:!0,textIsOptional:!0,textReserveSpace:!1,screenWidth:["get","screenWidth"],screenHeight:["get","screenHeight"],iconXOffset:["get","iconXOffset"],iconYOffset:["get","iconYOffset"],renderOrder:["get","zOrder"]});e.push(i)}if(this.m_withLine){const i=Object.assign(Object.assign({},t),{when:["all",["==",["geometry-type"],"LineString"],["!has","dashSize"],["!",["get","volatile"]]],renderOrder:["get","zOrder"],technique:"solid-line",caps:["get","lineCap"],color:["get","strokeColor"],lineWidth:["get","lineWidth"],clipping:this.m_shouldClipLines}),n=Object.assign(Object.assign({},i),{when:["all",["==",["geometry-type"],"LineString"],["has","dashes"]],technique:"dashed-line",color:"#0000",dashColor:["get","strokeColor"],clipping:this.m_shouldClipLines,dashes:["get","dashes"],dashSize:["get","dashSize"],gapSize:["get","gapSize"],"dash-image":["get","dashImage"]});if(e.push(i,n),this.m_withVolatile){const t=Object.assign(Object.assign({},i),{when:["all",["==",["geometry-type"],"LineString"],["!has","dashSize"],["get","volatile"]],color:["get",["concat","strokeColor:",["get","id"]],["dynamic-properties"]],lineWidth:["concat",["get",["concat","lineWidth:",["get","id"]],["dynamic-properties"]],"px"]});e.push(t)}}const i=["==",["get","height"],0];if(this.m_withOverlay){const s=Object.assign(Object.assign({},t),{when:["all",["==",["geometry-type"],"Polygon"],i,["has","map"],["!",["get","volatile"]]],renderOrder:["+",["get","zOrder"]],technique:"fill",map:["get","map"],mapProperties:{flipY:!0,minFilter:"linear"},textureCoordinateType:n.TextureCoordinateType.FeatureSpace,color:16777215,opacity:["get","opacity"],transparent:!0});if(e.push(s),this.m_withVolatile){const t=Object.assign(Object.assign({},s),{when:["all",["==",["geometry-type"],"Polygon"],i,["has","map"],["get","volatile"]],map:["get",["concat",r.DYNAMIC_OVERLAY_PROP_PREFIX,["get","id"]],["dynamic-properties"]]});e.push(t)}}if(this.m_withPolygon){const r=Object.assign(Object.assign({},t),{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["!",["get","volatile"]]],renderOrder:["+",["get","zOrder"]],technique:"fill",color:["get","fillColor"],lineWidth:0});if(this.m_withPolygonAlwaysPickable&&(r.transient=n.Pickability.all),e.push(r),this.m_withPolygonOutline){const r=Object.assign(Object.assign({},t),{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["!has","dashes"],["!",["get","volatile"]]],renderOrder:["+",["get","zOrder"],.5],technique:"solid-line",color:["get","strokeColor"],lineWidth:["get","lineWidth"]}),s=Object.assign(Object.assign({},r),{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["has","dashes"]],technique:"dashed-line",clipping:!0,dashes:["get","dashes"],dashSize:["get","dashSize"],gapSize:["get","gapSize"]});if(this.m_withPolygonAlwaysPickable&&(r.transient=n.Pickability.all,s.transient=n.Pickability.all),e.push(r,s),this.m_withVolatile){const t=Object.assign(Object.assign({},r),{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["!has","dashes"],["get","volatile"]],color:["get",["concat","strokeColor:",["get","id"]],["dynamic-properties"]],lineWidth:["concat",["get",["concat","lineWidth:",["get","id"]],["dynamic-properties"]],"px"]});e.push(t)}}if(this.m_withExtrudedPolygon){const i=Object.assign(Object.assign({},t),{when:["all",["==",["geometry-type"],"Polygon"],[">",["get","height"],0]],renderOrder:["get","zOrder"],technique:"extruded-polygon",color:["get","fillColor"],lineColor:["get","strokeColor"],lineWidth:["get","lineWidth"],constantHeight:["get","constantHeight"]});this.m_withPolygonAlwaysPickable&&(i.transient=n.Pickability.all),e.push(i)}if(this.m_withVolatile){const t=Object.assign(Object.assign({},r),{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["get","volatile"]],color:["get",["concat","fillColor:",["get","id"]],["dynamic-properties"]]});e.push(t)}}return{styles:e}}}t.ObjectStyleBuilder=r,r.DYNAMIC_OVERLAY_PROP_PREFIX="overlay-image"},6724:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectTileDataProvider=void 0;const n=i(3261),r=i(7316);class s extends n.ObjectDataProvider{constructor(e){super(e),this.provider=e,void 0!==H.service&&e instanceof H.service.extension.TileProvider&&e.setTileCanvasRendering(!1)}async getTile(e,t){if(void 0!==t&&t.addEventListener("abort",(()=>{this.provider.cancelTile(e.column,e.row,e.level)})),this.provider.providesMarkers()){const t=this.getMarkerImageLoader();return await new Promise(((i,n)=>{this.provider.requestTileAsPromise(e.column,e.row,e.level).then((n=>{const s=[],o=n.data,a=[];o.forEach((i=>{const n=(0,r.getMarkerProperties)(i);if(null!==n){const r=i.getIcon();if(r.getState()===H.map.Icon.State.READY){const e=n.imageTexture;s.push(e),t.load(e,r.getBitmap())}n.tileKey=e,a.push({type:"Feature",properties:n,geometry:i.getGeometry().toGeoJSON()})}})),t.setImageReferences(e,s),i({type:"FeatureCollection",features:a})}),n)}))}return this.provider.requestTileAsPromise(e.column,e.row,e.level)}}t.ObjectTileDataProvider=s},2464:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectTileDataSource=void 0;const n=i(9310),r=i(6724),s=i(1930),o=i(1447),a=i(1503),l=i(7564),c=i(7665);class h extends n.ObjectDataSource{constructor(e,t){super(u(Object.assign(Object.assign({},e),{addGroundPlane:!1,gatherFeatureAttributes:!0,dataProvider:new r.ObjectTileDataProvider(t)}),t),t),this.provider=t}ready(){return super.ready()&&this.provider.getStyleInternal().getState()===H.map.render.Style.State.READY}invalidateTiles(){this.mapView.markTilesDirty(this,(({tileKey:e})=>{const t=this.provider.requestTile(e.column,e.row,e.level,!0);return void 0!==t&&!t.valid}))}onProviderUpdate(e){var t;if(this.isDetached())return;if(e.target===this.provider)return void this.mapView.markTilesDirty(this);const i=e.target;(i instanceof H.map.Marker&&(null===(t=i.getIcon())||void 0===t?void 0:t.getState())===H.map.Icon.State.READY||i instanceof H.map.Spatial)&&this.invalidateTilesWithDelay()}}t.ObjectTileDataSource=h;const u=(e,t)=>{if(t.providesMarkers())e.tileFactory=new s.TileFactory(n.ObjectTile),e.decoder=new a.VectorTileDecoder;else if(t.providesSpatials())e.tileFactory=new s.TileFactory(o.Tile),e.decoder=new a.VectorTileDecoder(new c.SpatialObjectDataAdapter);else{if(!t.providesGeoJSON())throw Error('At least one of these provider\'s methods should return "true":\n      providesMarkers(), providesSpatials(), providesGeoJSON()');e.tileFactory=new s.TileFactory(n.ObjectTile),e.decoder=new a.VectorTileDecoder(new l.LayeredGeoJsonDataAdapter)}return e}},2420:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isProviderAdapter=void 0,t.isProviderAdapter=function(e){return null!=e&&e.provider instanceof H.map.provider.Provider}},7665:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpatialObjectDataAdapter=void 0;const n=i(82),r=i(7316);t.SpatialObjectDataAdapter=class{canProcess(e){return!0}process(e,t,i){var n;const l="extensionSpatial",c=e.getObjects(),h=null!==(n=e.getTileSize())&&void 0!==n?n:s;c.forEach((t=>{const n=t.getGeometriesForTile(e);if(void 0!==n&&n.length>0){const e=t.getId();let s;const c=(0,r.getSpatialProperties)(t),u=t.isClosed();if(u?(s=function(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i],r=n.paths,s=r.length,o=n.interiorsIndex,l=n.outlinesIndex;let c,h=Math.min(o,l,s);const u=[];for(let e=0;e<h;e++)c=[r[e].map(a)],u.push({rings:c});if(1===h){h=Math.min(l,s);for(let e=o;e<h;e++)c.push(r[e].map(a))}t.push(u)}return t}(n),c.height=0):s=o(n,!1),s.length>0)if(u){const t=Object.assign(Object.assign({},c),{lineWidth:0});s.forEach((n=>{i.processPolygonFeature(l,h,n,t,e)}))}else i.processLineFeature(l,h,s,c,e);s=o(n,!0),s.length>0&&i.processLineFeature(l,h,s,c,e)}}))}};const s=256;function o(e,t){const i=[];for(let n=0;n<e.length;n++){const r=e[n],s=t?r.outlinesIndex:0,o=t?r.paths.length:Math.min(r.interiorsIndex,r.outlinesIndex,r.paths.length);for(let e=s;e<o;e++)i.push({positions:r.paths[e].map(a)})}return i}function a(e){return new n.Vector2(e.x,e.y)}},3709:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorTileDataProvider=void 0;const n=i(8635);class r extends n.DataProvider{constructor(e){super(),this.provider=e}async getTile(e,t){return void 0!==t&&t.addEventListener("abort",(()=>{this.provider.cancelTile(e.column,e.row,e.level)})),await new Promise(((t,i)=>{this.provider.requestTileAsPromise(e.column,e.row,e.level).then((({data:e})=>{e instanceof ArrayBuffer&&t(e.slice(0,e.byteLength))}),i)}))}ready(){return!0}async connect(){return await Promise.resolve()}dispose(){}}t.VectorTileDataProvider=r},9470:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTileDataProvider=void 0;const n=i(82),r=[];t.WebTileDataProvider=class{constructor(e){this.provider=e}async getTexture(e,t){return void 0!==t&&t.addEventListener("abort",(()=>{this.provider.cancelTile(e.tileKey.column,e.tileKey.row,e.tileKey.level)})),await new Promise(((t,i)=>{this.provider.requestTileAsPromise(e.tileKey.column,e.tileKey.row,e.tileKey.level).then((({data:e})=>{null===e&&t(void 0);const i=new n.Texture(e);i.needsUpdate=!0,t([i,r])}),i)}))}}},5432:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCrossingAntimeridian=t.wrapGeoLineString=t.wrapGeoPolygon=void 0;const n=i(8965),r=i(3997),s=i(4860);function o(e){const t=[],i=e.getLatLngAltArray();let n=0,r=0;for(let e=0,o=i.length;e<o;e+=3){const o=i[e];let a=i[e+1];const l=i[e+2];if(e>=3){a+=n;const e=Math.abs(a-r)>180?a>r?-360:360:0;r=a+=e,n+=e}else r=a;t.push(new s.GeoCoordinates(o,a,l))}return t}function a(e){const{left:t,middle:i,right:n}=e;return{left:null==t?void 0:t.map(l),middle:null==i?void 0:i.map(l),right:null==n?void 0:n.map(l)}}function l(e){return e.toGeoPoint()}t.wrapGeoPolygon=function(e,t){const i=o(e.getExterior()),r=a((0,n.wrapPolygon)(i)),s=e.getInteriors().map((e=>a((0,n.wrapPolygon)(o(e)))));for(const e in r){if(void 0===r[e])continue;const i=[];s.forEach((t=>{void 0!==t[e]&&i.push(t[e])})),t.push([r[e],...i])}},t.wrapGeoLineString=function(e,t){const{left:i,middle:n,right:s}=(0,r.wrapLineString)(o(e));for(const e of[i,n,s])void 0!==e&&e.forEach((e=>{t.push(e.map((e=>e.toGeoPoint())))}))},t.isCrossingAntimeridian=function(e){return e instanceof H.geo.LineString?e.getDBCs()>0:e.getExterior().getDBCs()>0}},7316:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMarkerProperties=t.getSpatialProperties=void 0,t.getSpatialProperties=e=>{const t=e.getStyle(),r=t.lineWidth,s={lineWidth:`${t.lineWidth}px`,lineJoin:"Round",strokeColor:n(t.strokeColor)};return e.isClosed()?s.fillColor=n(t.fillColor):s.lineCap=i[t.lineCap],t.lineDash.length>1&&(s.dashSize=t.lineDash[0]*r+"px",s.gapSize=t.lineDash[1]*r+"px",s.dashes="Square",void 0!==t.lineDashImage&&(s.dashImage=`H-lineDashImage-${e.getId()}`)),s},t.getMarkerProperties=e=>{const t=e.getIcon();let i=null;if(t.getState()===H.map.Icon.State.READY){const{w:n,h:r}=t.getSize(),s=`H-icon-${t.uid}`,o=t.getAnchor();let a=0,l=0;void 0!==o&&(a=o.x,l=o.y),i={id:e.getId(),imageTexture:s,minZoom:e.getMin(!0),maxZoom:e.getMax(!0)+1,screenWidth:n,screenHeight:r,iconXOffset:n/2-a,iconYOffset:-(r/2-l)}}return i};const i={butt:"None",square:"Square",round:"Round","arrow-head":"TriangleOut","arrow-tail":"TriangleIn"},n=e=>{const t="none"===e;return t&&console.warn('Unsupported color value "none" converted to "rgba(0,0,0,0)"'),t?"rgba(0,0,0,0)":e}},8218:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lights=void 0,t.lights=[{name:"ambientLight",color:"#ffffff",intensity:.8,type:"ambient"},{direction:{x:-.3535533524,y:.3535534098,z:.8660254115},name:"light1",color:"#ffffff",intensity:.4,type:"directional"},{direction:{x:-.2548870499,y:-.9512512293,z:.1736481802},name:"light2",color:"#ffffff",intensity:.3,type:"directional"},{direction:{x:.6830126975,y:.1830126865,z:.7071067893},name:"light3",color:"#ffffff",intensity:.25,type:"directional"}]},6667:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultTheme=t.DARK_THEME=t.DEFAULT_THEME=void 0;const n=i(8218),r=i(173),s={color:"#FFFFFF",startRatio:.7};t.DEFAULT_THEME={clearColor:"#FFFFFF",fog:s,sky:{type:"gradient",topColor:"#347BC0",bottomColor:"#EDF2F9",groundColor:"#FFFFFF"},lights:n.lights},t.DARK_THEME={clearColor:"#010608",fog:s,sky:{type:"gradient",topColor:"#010608",bottomColor:"#EDF2F9",groundColor:"#010608"},lights:n.lights},t.getDefaultTheme=(e=!1)=>(0,r.cloneDeep)(e?t.DARK_THEME:t.DEFAULT_THEME)},483:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Layers=void 0;const n=i(2972),r=i(9330),s=i(2497),o=i(9310),a=i(8124),l=i(2464),c=i(3709),h=i(9470),u=i(9636),d=i(5694),m=i(6667),p=i(8449),f=H.getStylePath()+"/harp/";function g(e){let t;return void 0!==H.service&&(e instanceof H.service.trafficVectorTile.Provider?t=["traffic_flow","incident_icons","traffic_incidents"]:e instanceof H.service.omv.Provider&&(t=["tilezen_points","tilezen_lines","tilezen_polygons","tilezen_polygons_outlines","tilezen_volumes","tilezen_building_footprints","tilezen_building_footprints_outlines","tilezen_building_addresses","tilezen_road_shield_labels","tilezen_hillshade","tilezen_contour"])),t}function v(e){return`H-${e.uid}`}t.Layers=class{constructor(e,t,i,n){this.mapView=e,this.dataModel=t,this.lookAtManipulator=i,this.surfaceFactory=n,this.m_dataSources=new Map,this.m_renderers=[],this.m_isSetLayerOngoing=!1,this.m_disposed=!1,this.m_abortController=new AbortController,this.m_themeManager=new y(t,this.m_dataSources),t.addEventListener("add",this.onAdd,!1,this),t.addEventListener("remove",this.onRemove,!1,this),t.addEventListener("set",this.onSet,!1,this),t.addEventListener("configchange",this.onConfigChange,!1,this),t.addEventListener("update",this.onUpdate,!1,this),this.resetDataSourceOrder=this.resetDataSourceOrder.bind(this);const r=[];t.asArray().forEach(((e,t)=>{r.push(this.add(e,t))})),Promise.all(r).then(this.resetDataSourceOrder)}forEachRenderer(e){this.m_renderers.forEach(((t,i)=>e(t,i)))}dispose(){this.m_disposed=!0,this.dataModel.getLength()>0&&this.updateMinMaxListeners(this.dataModel.get(0),!1),this.dataModel.asArray().forEach(((e,t)=>{this.remove(e,t)})),this.m_renderers.forEach((e=>e.dispose())),this.m_dataSources.clear(),this.dataModel.removeEventListener("add",this.onAdd,!1,this),this.dataModel.removeEventListener("remove",this.onRemove,!1,this),this.dataModel.removeEventListener("set",this.onSet,!1,this),this.dataModel.removeEventListener("configchange",this.setTheme,!1,this),this.dataModel.removeEventListener("update",this.onUpdate,!1,this)}resetDataSourceOrder(){this.dataModel.asArray().forEach(((e,t)=>{const i=this.m_dataSources.get(e.getProvider());void 0!==i&&(i.dataSourceOrder=t)})),this.mapView.update()}sortSurfaces(){this.m_renderers.forEach((e=>{const t=e.getLayer();e.getSurface().setZIndex(this.dataModel.indexOf(t))}))}createDataSource(e,t){var i;const o=e.getProvider(),d={name:t,minDisplayLevel:e.min,maxDisplayLevel:e.max,minDataLevel:o.min,maxDataLevel:o.max};let m;if(o instanceof H.map.provider.RemoteTileProvider){const s=o.getStyleInternal();if(!(s instanceof u.Style))throw new H.lang.IllegalOperationError(this.add,`Wrong style format for layer ${t}.`);if(this.m_disposed&&console.warn(new H.lang.IllegalOperationError(this.add,`Cannot add layer ${t}. The rendering engine has been disposed.`)),o.providesOMV()){let t;void 0!==H.service&&o instanceof H.service.omv.Provider&&(t=o.getPoliticalView(),o.addEventListener("politicalviewchange",this.onPoliticalViewChange,void 0,this)),m=new n.VectorTileDataSource(Object.assign(Object.assign({},d),{addGroundPlane:e===this.dataModel.get(0),styleSetNames:null!==(i=g(o))&&void 0!==i?i:[v(o)],dataProvider:new c.VectorTileDataProvider(o),storageLevelOffset:-1,gatherFeatureAttributes:!0,politicalView:void 0!==t?t.toLowerCase():void 0,languages:void 0!==H.service&&o instanceof H.service.omv.Provider?o.getLanguages():void 0}))}else if(o.providesRasters())m=new r.WebTileDataSource(Object.assign(Object.assign({},d),{styleSetNames:[v(o)],dataProvider:new h.WebTileDataProvider(o),storageLevelOffset:-1,renderingOptions:{opacity:o.getOpacityInternal(),transparent:!0}}));else if(o.providesSpatials()||o.providesMarkers()||o.providesGeoJSON()){m=new l.ObjectTileDataSource(d,o);let e=s.getConfig();if(void 0===e.styles){const t=new a.ObjectStyleBuilder(m.styleSetNames[0]);o.providesMarkers()?t.withMarker():o.providesSpatials()&&(t.withLine(!0),t.withPolygon()),e=t.build();const i=new u.Style(e);i.setState(H.map.render.Style.State.READY),o.setStyleInternal(i,!0)}}}else if(o instanceof H.map.provider.ObjectProvider){o.setEngineType(H.Map.EngineType.HARP),m=new s.LocalObjectDataSource(d,o);const e=new a.ObjectStyleBuilder(m.styleSetNames[0]).withMarker().withLine(!1).withPolygon(!0,!0).withOverlay().withVolatile().build(),t=new u.Style(e);t.setState(H.map.render.Style.State.READY),o.setStyleInternal(t,!0)}return m}async add(e,t){const i=e.getProvider();0===t&&(this.updateMinMaxListeners(e,!0),this.adjustZoomConstraints());const n=`H-${null==i?void 0:i.uid}`;let r=!1;if(function(e){return void 0!==e.requestDomMarkers}(e)){const t=new H.map.render.dom.MarkerRenderer(e);t.setSurface(this.surfaceFactory.createDOMSurface()),this.m_renderers.push(t);const i=this.dataModel.asArray();this.m_renderers.sort(((e,t)=>i.indexOf(e.getLayer())-i.indexOf(t.getLayer()))),r=!0,this.sortSurfaces()}const s=this.createDataSource(e,n);void 0!==s?(this.m_dataSources.set(i,s),this.mapView.addDataSource(s),await this.setTheme()):r||console.warn(new H.lang.IllegalOperationError(this.add,`Layer ${n} is not supported.`))}remove(e,t){for(let t=0;t<this.m_renderers.length;t++)if(this.m_renderers[t].getLayer()===e){this.m_renderers[t].dispose(),this.m_renderers.splice(t,1);break}const i=e.getProvider(),n=this.m_dataSources.get(i);if(void 0!==n){this.mapView.removeDataSource(n),n.dispose(),this.m_dataSources.delete(i);const e=i.getStyleInternal();e instanceof u.Style&&e.cancelLoad(),this.setTheme()}0===t&&this.updateMinMaxListeners(e,!1),0===this.dataModel.getLength()&&this.adjustZoomConstraints(),void 0!==H.service&&i instanceof H.service.omv.Provider&&i.removeEventListener("politicalviewchange",this.onPoliticalViewChange,void 0,this)}get isSetLayerOngoing(){return this.m_isSetLayerOngoing}async onSet(e){if(e.removed instanceof H.map.layer.Layer){this.m_isSetLayerOngoing=!0;try{this.remove(e.removed,e.idx)}catch(e){throw this.m_isSetLayerOngoing=!1,e}}e.added instanceof H.map.layer.Layer&&await this.add(e.added,e.idx),this.m_isSetLayerOngoing=!1,this.resetDataSourceOrder()}onUpdate(e){const t=e.target.getProvider();if(this.m_dataSources.has(t)){const e=this.m_dataSources.get(t);e instanceof o.ObjectDataSource||(this.mapView.markTilesDirty(e),e instanceof r.WebTileDataSource&&t.providesRasters()&&(e.opacity=t.getOpacityInternal())),this.mapView.update()}}onAdd(e){this.add(e.added,e.idx).then(this.resetDataSourceOrder)}onRemove(e){this.remove(e.removed,e.idx),this.resetDataSourceOrder()}onPoliticalViewChange(e){void 0!==H.service&&e.target instanceof H.service.omv.Provider&&this.m_dataSources.get(e.target).setPoliticalView(e.newValue.toLowerCase())}adjustZoomConstraints(){const e=this.dataModel.asArray(),{min:t,max:i}=d.default.lookAt.zoom;e.length>0?this.lookAtManipulator.setZoomConstraints(Math.max(t,e[0].min),Math.min(i,e[0].max)):this.lookAtManipulator.setZoomConstraints(t,i);const n=this.mapView.zoomLevel,r=this.lookAtManipulator.clampZoom(n);r!==n&&(this.mapView.zoomLevel=r)}updateMinMaxListeners(e,t){t?(e.addEventListener("minchange",this.adjustZoomConstraints,!1,this),e.addEventListener("maxchange",this.adjustZoomConstraints,!1,this)):(e.removeEventListener("minchange",this.adjustZoomConstraints,!1,this),e.removeEventListener("maxchange",this.adjustZoomConstraints,!1,this))}onConfigChange(e){var t;if(null===(t=e.newValue)||void 0===t?void 0:t.hasOwnProperty("enabledFeatures")){const t=this.m_dataSources.get(e.target.getProvider());t instanceof p.TileDataSource&&(t.enabledFeatures=e.newValue.enabledFeatures)}else this.setTheme()}async setTheme(){this.m_abortController.abort("Abort theme loading due to a data model change."),this.m_abortController=new AbortController;const e=this.m_abortController.signal;try{const t=await this.m_themeManager.merge();e.throwIfAborted(),await this.mapView.setTheme(t,f)}catch(e){}}};class y{constructor(e,t){this.dataModel=e,this.dataSources=t,this.dark=void 0,this.m_uniqueStyles=new Map}async loadLayerTheme(e){var t;const i=e.getProvider(),n=null==i?void 0:i.getStyleInternal(),r=n.getState();if(!(n instanceof u.Style)||r===H.map.render.Style.State.ERROR)return;const s=this.dataSources.get(i);s instanceof p.TileDataSource&&(s.enabledFeatures=n.getEnabledFeatures());const o=null!==(t=n.getUrl())&&void 0!==t?t:JSON.stringify(n.getConfig()),a=this.m_uniqueStyles.get(o);if(void 0===a){this.m_uniqueStyles.set(o,n);const e=void 0===g(i);return await n.loadAsync(!1,!0).then((()=>e?function(e,t){var i;const n=null!==(i=e.getConfig())&&void 0!==i?i:void 0;return void 0!==n&&e.getState()===H.map.render.Style.State.READY&&(Array.isArray(n.styles)&&n.styles.forEach((e=>{e.styleSet=t})),e.setConfig(n)),n}(n,v(i)):n.getConfig()))}r===H.map.render.Style.State.INIT&&a.loadAsync(!0,!0).then((()=>{n.setConfig(a.getConfig()),n.setState(a.getState())}))}async merge(){this.m_uniqueStyles.clear();const e=this.dataModel.asArray();if(0===e.length)return this.dark=void 0,{};this.dark=e[0].dark;const t=e.map((async e=>await this.loadLayerTheme(e))),i=(await Promise.all(t)).filter((e=>void 0!==e));return{extends:[(0,m.getDefaultTheme)(this.dark),...i]}}}},9561:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LookAtManipulator=t.adjustHeading=void 0;const n=i(7220),r=i(2616),s=i(2344),o=i(5694),a=i(82),l=i(2730),c=i(4609);function h(e){return(180+e)%360}t.adjustHeading=h;class u{constructor(e,t){this.m_mapView=e,this.m_viewPort=t,this.camera=this.m_mapView.camera.clone()}update(){const{width:e,height:t,padding:i}=this.m_viewPort,n=this.m_mapView.camera,r=Math.max(1,e-i.left-i.right),o=Math.max(1,t-i.top-i.bottom);this.camera.copy(n),this.camera.aspect=r/o,s.CameraUtils.setPrincipalPoint(this.camera,{x:0,y:0});const l=(0,c.calculateNormalizedDeviceCoordinates)(i.left,i.top,e,t),h=new a.Vector3(l.x,l.y,-1).applyMatrix4(n.projectionMatrixInverse),u=2*Math.atan2(h.y,n.near);s.CameraUtils.setVerticalFov(this.camera,u,o),this.camera.updateProjectionMatrix()}get projection(){return this.m_mapView.projection}get tileWrappingEnabled(){return this.m_mapView.tileWrappingEnabled}}t.LookAtManipulator=class{constructor(e,t){this.mapView=e,this.m_viewPort=t,this.m_localTangentSpace={position:new a.Vector3,xAxis:new a.Vector3,yAxis:new a.Vector3,zAxis:new a.Vector3},this.m_boundsGenerator=new n.BoundsGenerator(this.mapView),this.m_paddedBoundsGenerator=this.m_boundsGenerator,this.setZoomConstraints(o.default.lookAt.zoom.min,o.default.lookAt.zoom.max),t.addEventListener("update",this.onViewPortUpdate,void 0,this),this.onViewPortUpdate()}getLookAtData(e=!1,t=!1){return(e||void 0===this.m_viewBounds)&&this.updateViewBounds(),{position:this.mapView.target.toLatLng(),zoom:this.mapView.zoomLevel,heading:h(this.mapView.heading),tilt:this.mapView.tilt,bounds:t?this.m_paddedViewBounds:this.m_viewBounds,incline:0}}setZoomConstraints(e,t){this.m_layerMinZoom=e,this.m_layerMaxZoom=t,this.mapView.minZoomLevel=e,this.mapView.maxZoomLevel=t,this.invalidateViewBounds()}clampValues(e){const{heading:t,tilt:i}=o.default.lookAt;if(void 0!==e.zoom&&(e.zoom=this.clampZoom(e.zoom)),void 0!==e.tilt&&(e.tilt=a.MathUtils.clamp(e.tilt,i.min,i.max)),void 0!==e.heading){const i=(e.heading%360+360)%360;e.heading=a.MathUtils.clamp(i,t.min,t.max)}}clampZoom(e){const{zoom:t}=o.default.lookAt;return a.MathUtils.clamp(e,Math.max(t.min,this.m_layerMinZoom),Math.min(t.max,this.m_layerMaxZoom))}lookAt(e){this.mapView.lookAt(Object.assign(Object.assign({},e),{padding:this.m_viewPort.padding})),this.invalidateViewBounds()}applyLookAtDelta(e,t,i,n,r){const l=this.mapView;if(n||r){const e=a.MathUtils.degToRad(o.default.lookAt.tilt.max);s.MapViewUtils.orbitAroundScreenPoint(this.mapView,{deltaTilt:a.MathUtils.degToRad(n),maxTiltAngle:e}),s.MapViewUtils.orbitAroundScreenPoint(this.mapView,{deltaAzimuth:a.MathUtils.degToRad(r),maxTiltAngle:e,center:t})}0!==i&&this.zoomAt(l.zoomLevel+i,t),this.moveLookAtByOffset(e.x,e.y),this.invalidateViewBounds()}moveLookAtByOffset(e,t){if(0===e&&0===t)return;const i=this.mapView.camera,n=this.mapView.projection,o=a.MathUtils.degToRad(this.mapView.heading),l=this.mapView.pixelToWorld,c=Math.cos(-o),h=Math.sin(-o),u=(e*c+t*h)*l,d=(t*c-e*h)*l;if(n.type===r.ProjectionType.Planar)i.position.x+=u,i.position.y-=d,this.clampCameraPosition();else{const e=s.MapViewUtils.getWorldTargetFromCamera(i,n);if(null===e)return;n.localTangentSpace(e,this.m_localTangentSpace);const t=this.m_localTangentSpace.xAxis,r=this.m_localTangentSpace.yAxis,o=e.clone();t.multiplyScalar(u),o.sub(t),r.multiplyScalar(d),o.add(r),s.MapViewUtils.panCameraAroundGlobe(this.mapView,e,o)}this.invalidateViewBounds()}setAngles(e,t){const i=o.default.lookAt.tilt;e=a.MathUtils.clamp(e,i.min,i.max);const{target:n,distance:r}=s.MapViewUtils.getTargetAndDistance(this.mapView.projection,this.mapView.camera,this.mapView.elevationProvider),l=this.mapView.projection.unprojectPoint(n);s.MapViewUtils.getCameraRotationAtTarget(this.mapView.projection,l,-t,e,this.mapView.camera.quaternion),s.MapViewUtils.getCameraPositionFromTarget(this.mapView.target,r,-t,e,this.mapView.projection,this.mapView.camera.position),this.invalidateViewBounds()}zoomAt(e,t){const i=this.clampZoom(e);this.mapView.zoomLevel!==i&&(s.MapViewUtils.zoomOnTargetPosition(this.mapView,t.x,t.y,i),this.invalidateViewBounds())}clampCameraPosition(){if(this.mapView.projection.type===r.ProjectionType.Spherical)return;const{target:e}=s.MapViewUtils.getTargetAndDistance(this.mapView.projection,this.mapView.camera,this.mapView.elevationProvider),t=this.mapView.projection.unprojectPoint(e),i=this.mapView.projection.projectPoint(t),n=i.x-e.x,o=i.y-e.y;this.mapView.camera.position.x+=n,this.mapView.camera.position.y+=o,this.invalidateViewBounds()}invalidateViewBounds(){this.m_viewBounds=void 0,this.m_paddedViewBounds=void 0}updateViewBounds(){var e;null===(e=this.m_paddedView)||void 0===e||e.update(),this.m_viewBounds=(0,l.harpToHGeoPolygon)(this.m_boundsGenerator.generate()),this.m_paddedViewBounds=this.m_paddedBoundsGenerator===this.m_boundsGenerator?this.m_viewBounds:(0,l.harpToHGeoPolygon)(this.m_paddedBoundsGenerator.generate())}onViewPortUpdate(){const e=this.m_viewPort.padding;if(e.top||e.left||e.bottom||e.right){const e=this.m_viewPort.center,t=this.mapView.getNormalizedScreenCoordinates(e.x,e.y);s.CameraUtils.setPrincipalPoint(this.mapView.camera,t),this.m_paddedBoundsGenerator===this.m_boundsGenerator&&(this.m_paddedView=new u(this.mapView,this.m_viewPort),this.m_paddedBoundsGenerator=new n.BoundsGenerator(this.m_paddedView))}else this.m_paddedBoundsGenerator!==this.m_boundsGenerator&&(s.CameraUtils.setPrincipalPoint(this.mapView.camera,{x:0,y:0}),this.m_paddedBoundsGenerator=this.m_boundsGenerator,this.m_paddedView=void 0);this.invalidateViewBounds()}}},8935:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderEngine=t.RenderEngineState=void 0;const n=i(82),r=i(8806),s=i(9026),o=i(2616),a=i(3977),l=i(2730),c=i(9070),h=i(2505),u=i(483),d=i(6562),m=i(9561),p=i(541),f=i(4954),g=i(248),v=i(1135),y=i(5694),_=i(6667),x=i(5925),w=i(2344),b=d.LoggerManager.instance.create("harp::RenderEngine");var T;!function(e){e[e.Suspended=0]="Suspended",e[e.Busy=1]="Busy",e[e.Shutdown=2]="Shutdown"}(T=t.RenderEngineState||(t.RenderEngineState={}));class M extends H.util.EventTarget{constructor(e,t,i,n){super(),this.m_syncedSize=null,this.m_lookAtAnimation=void 0,this.m_animation=void 0,this.m_animationDuration=.3,this.m_lastCallTime=0,this.m_state=T.Suspended,this.m_rendered=!1,this.m_suspendTimeout=5e3,this.m_renderCallbacks=void 0,this.m_kinetics=void 0,this.m_control=new r.ControlUtils,this.type=H.Map.EngineType.HARP,this.m_viewModel=t,this.m_viewPort=e,this.m_dataModel=i,t.startControl=this.startControl.bind(this),t.control=this.control.bind(this),t.endControl=this.endControl.bind(this),e.startInteraction=this.startInteraction.bind(this),e.interaction=this.interaction.bind(this),e.endInteraction=this.endInteraction.bind(this),this.m_surface=new v.default(e.element,e.width,e.height,n.pixelRatio),this.m_layersContainer=e.element.ownerDocument.createElement("div"),this.m_layersContainer.style.position="absolute",this.m_layersContainer.style.width=this.m_layersContainer.style.height="100%",this.m_layersContainer.style.zIndex="1",e.element.appendChild(this.m_layersContainer);const s=new Blob([H.__harp_worker_decoders__],{type:"application/javascript"}),l=URL.createObjectURL(s);this.mapView=new a.MapView({decoderUrl:l,synchronousRendering:!0,canvas:this.m_surface.getElement(),pixelRatio:n.pixelRatio,enableMixedLod:!0,lodMinTilePixelSize:512,enableNativeWebglAntialias:!0,projection:n.projectionType===o.ProjectionType.Spherical?o.sphereProjection:o.mercatorProjection,theme:(0,_.getDefaultTheme)(!1),enablePickTechnique:!0,maxVisibleDataSourceTiles:200}),this.m_handleRequestAnimationFrame=this.renderLoop.bind(this),t.addEventListener("update",this.onViewUpdate,void 0,this),e.addEventListener("update",this.onResize,void 0,this),this.m_lookAtManipulator=new m.LookAtManipulator(this.mapView,this.m_viewPort),this.mapView.addEventListener(a.MapViewEventNames.FrameComplete,(()=>{this.m_layers.isSetLayerOngoing||(this.m_rendered=!0)})),this.mapView.addEventListener(a.MapViewEventNames.Update,(()=>{this.m_rendered=!1,this.relaunch()})),this.mapView.addEventListener(a.MapViewEventNames.ContextLost,(()=>{this.m_state=T.Suspended,cancelAnimationFrame(this.m_animationFrameHandle)})),this.m_layers=new u.Layers(this.mapView,i,this.m_lookAtManipulator,{createDOMSurface:()=>new H.map.render.dom.Surface(this.m_layersContainer,e.width,e.height,n.pixelRatio)}),this.m_control.addEventListener(r.AnimationUpdateEvent,(e=>{var t;null===(t=this.m_animation)||void 0===t||t.stop(!0),e.changeRate.hasValue()&&(this.m_animation=new c.Animation(this.mapView,1/0,this.applyControl.bind(this)),this.m_animation.start())})),this.m_interaction=new H.map.render.InteractionUtils,this.relaunch();const h=new x.MapViewPickHandlerAdapter(this.mapView.pickHandler,this.geoToScreen.bind(this));this.m_pickingHandler=new g.PickingHandlerComposite((()=>{const e=[];return this.m_layers.forEachRenderer((t=>{t instanceof H.map.render.dom.MarkerRenderer&&e.push({getObjectsAt:(e,i,r)=>t.getObjectsAt(e*n.pixelRatio,i*n.pixelRatio,r)})})),e.push(h),e})),b.log("Ready")}setOnRenderCallbacks(e,t){this.m_renderCallbacks={start:e,end:t}}adjustZoomConstraints(){this.m_layers.adjustZoomConstraints()}onViewUpdate(e){const t=this.lookAtParamsFromLookAtData(e.newValue,e.modifiers);if(this.stopAnimations(),e.animate){let i=1;"number"==typeof e.animate&&(i=1/e.animate),this.setLookAtWithAnimation(t,i),this.relaunch()}else this.m_lookAtManipulator.lookAt(t)}setLookAtWithAnimation(e,t,i){const r=h.CameraAnimationBuilder.createFlyToOptions(this.mapView,Object.assign(Object.assign({},e),{padding:this.m_viewPort.padding}),((e,i)=>{const n={heading:e.heading,tilt:e.tilt,zoom:p.MapViewUtils.calculateZoomLevelFromDistance(this.mapView,e.distance)},r={heading:i.heading,tilt:i.tilt,zoom:p.MapViewUtils.calculateZoomLevelFromDistance(this.mapView,i.distance)};return this.getFlyToDuration(n,r)*t})).controlPoints;this.m_lookAtAnimation=new s.CameraKeyTrackAnimation(this.mapView,{controlPoints:r,interpolation:n.InterpolateLinear}),this.m_lookAtAnimation.start(0,i)}onResize(){const{width:e,height:t}=this.m_viewPort;if(e>0&&t>0){this.m_surface.setSize(e,t),this.mapView.resize(e,t);const i=this.lookAtParamsFromLookAtData(this.m_viewModel.getLookAtData());this.m_lookAtManipulator.lookAt(i),this.m_syncedSize={w:e,h:t},this.m_layers.forEachRenderer((i=>{i.getSurface().setSize(e,t)})),this.relaunch()}}lookAtParamsFromLookAtData(e,t=-1>>>0){const i={};return this.m_lookAtManipulator.clampValues(e),t&H.map.ChangeEvent.Type.POSITION&&(i.target=e.position),t&H.map.ChangeEvent.Type.ZOOM&&(i.zoomLevel=e.zoom),t&H.map.ChangeEvent.Type.HEADING&&(i.heading=(0,m.adjustHeading)(e.heading)),t&H.map.ChangeEvent.Type.TILT&&(i.tilt=e.tilt),t&H.map.ChangeEvent.Type.BOUNDS&&(t&H.map.ChangeEvent.Type.ZOOM&&t&H.map.ChangeEvent.Type.POSITION||(i.bounds=e.bounds instanceof H.geo.Polygon?(0,l.hToHarpGeoPolygon)(e.bounds):(0,l.getHarpBoundingBox)(e.bounds))),i}synchronizeViewPort(){null!==this.m_syncedSize&&(this.m_viewPort.synchronize(this.m_syncedSize),this.m_syncedSize=null)}synchronizeLookAt(){var e;this.m_viewModel.synchronize(this.m_lookAtManipulator.getLookAtData(null===(e=this.m_lookAtAnimation)||void 0===e?void 0:e.isRunning(),!0))}adjustLongitudeToVisibleWorld(e){const t=this.mapView.target.longitude;if(Math.abs(t-e)<o.MAX_LONGITUDE)return e;const i=Math.sign(t),n=Math.trunc(t/(2*o.MAX_LONGITUDE)+i/2);return e+2*o.MAX_LONGITUDE*n}inViewport(e){return e.x>=0&&e.y>=0&&e.x<=this.m_viewPort.width&&e.y<=this.m_viewPort.height}setProjection(e){this.mapView.projection.type!==e&&(this.mapView.projection=e===o.ProjectionType.Spherical?o.sphereProjection:o.mercatorProjection)}getProjection(){return this.mapView.projection.type}get animationDuration(){return this.m_animationDuration}set animationDuration(e){e===+e&&e>0&&(this.m_animationDuration=e)}resetAnimationDefaults(){this.m_animationDuration=.3}dispose(){this.m_state=T.Shutdown,cancelAnimationFrame(this.m_animationFrameHandle),this.mapView.dispose(),this.stopAnimations(),this.m_viewModel.removeEventListener("update",this.onViewUpdate,void 0,this),this.m_viewPort.removeEventListener("update",this.onResize,void 0,this),this.m_viewModel.startControl=H.map.ViewModel.prototype.startControl,this.m_viewModel.control=H.map.ViewModel.prototype.control,this.m_viewModel.endControl=H.map.ViewModel.prototype.endControl,this.m_viewPort.startInteraction=H.map.ViewPort.prototype.startInteraction,this.m_viewPort.interaction=H.map.ViewPort.prototype.interaction,this.m_viewPort.endInteraction=H.map.ViewPort.prototype.endInteraction,this.m_layers.dispose(),this.m_viewPort.element.removeChild(this.m_layersContainer)}updateTimeStamp(){this.m_lastCallTime=f.PerformanceTimer.now()}relaunch(){this.updateTimeStamp(),this.m_state===T.Suspended&&this.startRenderLoop()}get continueRenderLoop(){return this.mapView.isDynamicFrame||f.PerformanceTimer.now()-this.m_lastCallTime<this.m_suspendTimeout&&!this.m_rendered}startRenderLoop(){this.continueRenderLoop?(this.m_state=T.Busy,this.m_animationFrameHandle=requestAnimationFrame(this.m_handleRequestAnimationFrame)):(this.m_state=T.Suspended,this.m_animationFrameHandle=void 0,this.m_rendered&&(this.m_rendered=!1,setTimeout((()=>{this.mapView.isDynamicFrame?this.relaunch():this.dispatchRenderEvent()}))))}renderLoop(e){void 0!==this.m_renderCallbacks&&this.m_renderCallbacks.start(),this.mapView.renderSync(e),this.m_suspendTimeout=5e3,this.renderLayers()||(this.m_rendered=!1),this.synchronizeLookAt(),this.synchronizeViewPort(),void 0!==this.m_renderCallbacks&&this.m_renderCallbacks.end(),this.startRenderLoop()}renderLayers(){var e;let t=this.m_lookAtManipulator.getLookAtData(null===(e=this.m_lookAtAnimation)||void 0===e?void 0:e.isRunning()).bounds.getBoundingBox();this.mapView.projection.type===o.ProjectionType.Planar&&t.getHeight()>=2*o.MercatorConstants.MAXIMUM_LATITUDE&&(t=new H.geo.Rect(90,t.getLeft(),-90,t.getRight()));const i=this.mapView.zoomLevel;this.m_dataModel.asArray().forEach((e=>{var n;null===(n=e.getProvider())||void 0===n||n.preprocessData(t,i)}));const n=this.m_viewPort.center,r=new H.math.Point(0,0);let s=!0;return this.m_layers.forEachRenderer((e=>{const o=e.render(t,n,void 0,i,!1,r,(e=>this.geoToScreen(e)));o===H.map.render.RenderState.ACTIVE&&(this.m_suspendTimeout=1/0),o===H.map.render.RenderState.PENDING&&(s=!1)})),s}getState(){return this.m_state}stopAnimations(){var e,t;null===(e=this.m_lookAtAnimation)||void 0===e||e.stop(),this.m_control.isRunning()&&this.endControl(!0),this.m_interaction.isRunning()&&this.endInteraction(!0),null===(t=this.m_animation)||void 0===t||t.stop(!0)}applyControl(e,t,i,n){const r=this.m_control.getChangeRate(),s=r.moveZ*i,o=r.rotateX*i,a=r.rotateY*i,l={x:r.moveX*i,y:r.moveY*i};this.m_lookAtManipulator.applyLookAtDelta(l,this.getControlTargetNDC(),s,o,a)}dispatchRenderEvent(e){this.dispatchEvent(new H.util.Event("render",null!=e?e:this))}getFlyToDuration(e,t){const i=Math.max(8*this.getCapabilityRatio(e,t,"zoom"),this.getCapabilityRatio(e,t,"heading"),this.getCapabilityRatio(e,t,"tilt")/2);return n.MathUtils.clamp(3e3*i,300,4e3)/1e3}getCapabilityRatio(e,t,i){const n=this.getCapabilities().lookAt[i],r=n.max-n.min,s="zoom"===i?t[i]-e[i]:((e,t)=>{const i=t-e;return i>-180&&i<=180?i:i>180?i-360:i+360})(e[i],t[i]);return Math.abs(s)/r||0}screenToGeo(e,t){const{latitude:i,longitude:n,altitude:r}=this.mapView.getGeoCoordinatesAt(e,t,!0);return new H.geo.Point(i,n,r)}geoToScreen(e){let t;if(this.getProjection()===o.ProjectionType.Planar){const{lat:i,lng:n,alt:r}=e,s=this.adjustLongitudeToVisibleWorld(n),o=this.mapView.getScreenPosition([s,i,r]);t=o,this.inViewport(o)||(t=this.mapView.getScreenPosition([s+360,i,r]),this.inViewport(t)||(t=this.mapView.getScreenPosition([s-360,i,r])),this.inViewport(t)||(t=o))}else t=this.mapView.getScreenPosition(e);return void 0!==t?{x:Math.round(t.x),y:Math.round(t.y)}:null}screenToLookAtData(e,t){const i=this.m_viewModel.getLookAtData();return i.position=this.screenToGeo(e,t),i}getObjectsAt(e,t,i,n,r=!1){this.m_pickingHandler.getObjectsAt(e,t,i,r).then(n)}async capture(e,t,i,n){return await new Promise(((r,s)=>{const o=()=>{this.mapView.removeEventListener(a.MapViewEventNames.FrameComplete,o);const s=this.m_viewPort.element.ownerDocument.createElement("img");s.onload=()=>{const o=this.m_viewPort.element.ownerDocument.createElement("canvas"),a=this.mapView.pixelRatio,l=o.width=(i-e)*a,c=o.height=(n-t)*a;o.getContext("2d").drawImage(s,e,t,l,c,0,0,l,c),r(o)},s.src=this.mapView.canvas.toDataURL()};this.mapView.addEventListener(a.MapViewEventNames.FrameComplete,o),this.mapView.update()}))}setPointer(e,t){}zoomAt(e,t,i){const n=this.mapView.getNormalizedScreenCoordinates(t,i);this.m_lookAtManipulator.zoomAt(e,n),this.relaunch()}startControl(e,t,i){this.stopAnimations(),this.m_kinetics=e,this.m_control.start(t,i)}control(e,t,i,n,r,s){for(let e,t=0;t<arguments.length;t++)if(e=arguments[t],Number.isNaN(e))throw new Error(`Invalid argument ${e}`);this.m_control.isRunning()&&this.m_control.set(e,t,i,n,r,s)}endControl(e,t){var i,n;if(!this.m_control.isRunning())return;const r=t instanceof Function,s=this.getControlTargetNDC();if(null===(i=this.m_animation)||void 0===i||i.stop(),void 0===this.m_kinetics||e||r){if(r){const e=this.m_lookAtManipulator.getLookAtData();t(e);const i=this.mapView.zoomLevel,n=this.m_lookAtManipulator.clampZoom(e.zoom)-i;n&&(this.m_animation=new c.Animation(this.mapView,Math.abs(n/this.m_control.getChangeRate().moveZ)*Math.PI,(e=>{const t=(r=e,--r*r*r+1);var r;this.m_lookAtManipulator.zoomAt(i+n*t,s)})).start())}}else{const e=null!==(n=this.m_kinetics.power)&&void 0!==n?n:1,t=this.m_control.getChangeRate(),i=this.m_kinetics.duration>0?this.m_kinetics.duration:1,{zoom:r,tilt:o,heading:a}=this.m_lookAtManipulator.getLookAtData();let l=0,h=0;this.m_animation=new c.Animation(this.mapView,i,(n=>{const c=this.m_kinetics.ease(n)*i*e,u=t.moveX*c,d=t.moveY*c,p=t.moveZ*c,f=t.rotateX*c,g=t.rotateY*c;this.m_lookAtManipulator.setAngles(o+f,(0,m.adjustHeading)(a+g)),this.m_lookAtManipulator.zoomAt(r+p,s),this.m_lookAtManipulator.moveLookAtByOffset(u-l,d-h),l=u,h=d})).start()}this.m_control.reset()}startInteraction(e,t){const i=!!(void 0!==t||e&(H.map.render.RenderEngine.InteractionModifiers.HEADING|H.map.render.RenderEngine.InteractionModifiers.TILT));this.stopAnimations(),this.m_kinetics=t,this.m_interaction.start(e,i)}interaction(e,t,i,n,r){if(!this.m_interaction.isRunning())return;const s=this.m_interaction,o=s.store(e,t,i,n,r);if(!this.m_interaction.isGestureDetected())return;let a=!1;const l=this.m_interaction.getMoveVector(),c=o&&s.getBifocalCenter(),h=H.map.render.RenderEngine.InteractionModifiers;let u={x:0,y:0},d=w.CameraUtils.getPrincipalPoint(this.mapView.camera),m=0,p=0,f=0;s.isModifierEnabled(h.TILT)&&(p=l.y/this.m_viewPort.height*2*-180,a=!0),s.isModifierEnabled(h.HEADING)&&(o?(f=this.m_interaction.getBifocalRotation(),d=this.mapView.getNormalizedScreenCoordinates(c.x,c.y),a=!0):l.x&&(f=l.x/this.m_viewPort.width*360,a=!0));const g=this.m_interaction.getBifocalScaling();o&&1!==g&&s.isModifierEnabled(h.ZOOM)&&(m=Math.log(Math.pow(2,this.mapView.zoomLevel)*g)/Math.LN2-this.mapView.zoomLevel,d=this.mapView.getNormalizedScreenCoordinates(c.x,c.y),a=!0),s.isModifierEnabled(h.COORD)&&l.x*l.x+l.y*l.y>0&&(u={x:-l.x,y:-l.y},a=!0),a&&(this.m_lookAtManipulator.applyLookAtDelta(u,d,m,p,f),this.relaunch())}endInteraction(e){var t;if(this.m_interaction.isRunning()&&!e&&void 0!==this.m_kinetics){const e=(null!==(t=this.m_kinetics.power)&&void 0!==t?t:1)*this.m_interaction.getSpeed();if(e>0){const t=this.m_kinetics.duration>0?this.m_kinetics.duration:1,i=this.m_interaction.getDirection(),n=this.m_kinetics.ease;this.m_animation=new c.Animation(this.mapView,t,(t=>{const r=e-e*n(t);this.m_lookAtManipulator.moveLookAtByOffset(-i.x*r,-i.y*r)})).start()}}this.m_kinetics=void 0,this.m_interaction.clear()}getCapabilities(){return y.default}getControlTargetNDC(){var e,t;return void 0!==(null===(e=this.m_control)||void 0===e?void 0:e.atX)&&void 0!==(null===(t=this.m_control)||void 0===t?void 0:t.atY)?this.mapView.getNormalizedScreenCoordinates(this.m_control.atX,this.m_control.atY):w.CameraUtils.getPrincipalPoint(this.mapView.camera)}}t.RenderEngine=M},1135:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,i,n){this.m_canvas=this.createElement(e.ownerDocument),e.appendChild(this.m_canvas),this.m_pixelRatio=n,this.setSize(t,i)}createElement(e){const t=e.createElement("canvas");return t.style.position="absolute",t.style.top=t.style.left="0",t}setSize(e,t){const i=this.m_pixelRatio;this.m_canvas.width=Math.max(e*i,1),this.m_canvas.height=Math.max(t*i,1),this.m_canvas.style.width=`${e}px`,this.m_canvas.style.height=`${t}px`}getElement(){return this.m_canvas}}},5694:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:70},incline:{min:0,max:0},heading:{min:0,max:360}},interaction:{ZOOM:H.map.render.RenderEngine.InteractionModifiers.ZOOM,COORD:H.map.render.RenderEngine.InteractionModifiers.COORD},capture:!0};t.default=i},6597:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i,n){const r=i.getIcon(),s=r.getHitArea();if(null===s)return!0;const o=r.getAnchor();e+=o.x,t+=o.y;const a=i.getGeometry();let l=!1;if(a instanceof H.geo.MultiPoint){const i=a.getGeometries();let r=i.length;for(;r--&&!l;){const o=n(i[r]);l=s.hitTest(e-o.x,t-o.y,0)!==H.math.CoverType.NONE}}else{const i=n(a);l=s.hitTest(e-i.x,t-i.y,0)!==H.math.CoverType.NONE}return l}},5925:function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewPickHandlerAdapter=t.getPickData=void 0;const r=i(2497),s=i(6597),o=i(2420),a=i(4342),l=i(8263),c=i(8449);var h=H.map.provider.PickingMode;function u(e,t){var i;const r=e.userData,{$id:s,$layer:o,$zoom:a,$level:l,$geometryType:c}=r,h=n(r,["$id","$layer","$zoom","$level","$geometryType"]),u={};u.properties=h;const d=h.kind;u.id=e.featureId>0?e.featureId:h.id,u.layers=[`${t}_${o}:${d}`],u.source_layer=o,u.source_name=t,u.geometry_type=c,u.technique=e.technique;const m=null!==(i=e.tileKey)&&void 0!==i?i:e.userData.tileKey;if(null!=m){const{row:e,column:t,level:i}=m;u.tile={coords:{x:t,y:e,z:i,key:`${t}/${e}/${i}`}}}return u}function d(e,t,i){const n=new H.map.Feature(u(e,t));return n.setParentEventTarget(i),n}t.getPickData=u,t.MapViewPickHandlerAdapter=class{constructor(e,t){this.pickHandler=e,this.geoToScreen=t,this.m_featureCache=new l.LRUCache(100)}async getObjectsAt(e,t,i,n){const l={maxResultCount:i?1:void 0,allowDuplicates:n},m=this.pickHandler.intersectMapObjects(e,t,l),p=[];for(const l of m){if(void 0===l.userData)continue;const m=this.pickHandler.mapView.getDataSourceByName(l.dataSourceName);if(!(m instanceof c.TileDataSource)){(0,a.assert)(!1,"Pick supported only for TileDataSource instances");continue}const f=m.dataProvider();if(!(0,o.isProviderAdapter)(f))continue;const g=f.provider;switch(g.getPickingMode()){case h.SOURCE:{if(!(m instanceof r.LocalObjectDataSource)){(0,a.assert)(!1,"Cannot use 'SOURCE' pick mode for source without 'getMapObjectById'");continue}const i=m.getMapObjectById(l.userData.id);!p.includes(i)&&(i instanceof H.map.GeoShape||i instanceof H.map.Overlay||i instanceof H.map.Marker&&(0,s.default)(e,t,i,this.geoToScreen))&&p.push(i);break}case h.FEATURE:{let e;if(void 0!==l.tileKey){const{column:t,row:i,level:n}=l.tileKey;e={x:t,y:i,z:n}}g.getFeatureProxy(l.userData,e,(function(e){void 0!==e&&(e.setRootParentEventTarget(g),p.push(e))}))||p.push(n?d(l,m.name,g):this.getFeature(l,m.name,g));break}case h.PROVIDER:if(!(g instanceof H.map.provider.RemoteTileProvider)){(0,a.assert)(!1,"'PROVIDER' picking mode support only for RemoteTileProvider");continue}await g.requestObjectAsPromise(u(l,m.name),!1).then((i=>{i instanceof H.map.Marker&&!(0,s.default)(e,t,i,this.geoToScreen)||p.push(i)}))}if(i&&p.length>0)break}return p}getFeature(e,t,i){let n=this.m_featureCache.get(e.userData),r=null==n?void 0:n.find((t=>t.getData().technique===e.technique));return void 0===r&&(r=d(e,t,i),void 0===n&&(n=[]),n.push(r),this.m_featureCache.set(e.userData,n)),r}}},248:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickingHandlerComposite=void 0,t.PickingHandlerComposite=class{constructor(e){this.getPickingHandlers=e}async getObjectsAt(e,t,i,n){let r=[];const s=this.getPickingHandlers();for(const o of s){const s=await o.getObjectsAt(e,t,i,n);if(i&&s.length>0)return[s[0]];r=r.concat(s)}return r}}},2730:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getClampedGeoRect=t.harpToHGeoPolygon=t.harpGeoBoxToHGeoRect=t.hGeoRectToHarpGeoBox=t.getHarpBoundingBox=t.hToHarpGeoPolygon=void 0;const n=i(6482),r=i(4860),s=i(3068),o=i(82);function a(e){return new s.GeoBox(new r.GeoCoordinates(e.getBottom(),e.getLeft()),new r.GeoCoordinates(e.getTop(),e.getRight()))}function l(e){const t=[];e.push(e[0]);const i=e.length;for(let n=0;n<i-1;n++){const i=e[n],s=e[n+1];if(t.push(i),Math.abs(s.longitude-i.longitude)>=180){const e=(i.latitude+s.latitude)/2,n=(i.longitude+s.longitude)/2,o=(i.altitude+s.altitude)/2;t.push(new r.GeoCoordinates(e,n,o||void 0))}}return t.length!==e.length-1?l(t):t}t.hToHarpGeoPolygon=function(e){const t=[];if(e.getExterior().eachLatLngAlt(((e,i,n)=>{t.push(new r.GeoCoordinates(e,i,n))})),t.length>2)return new n.GeoPolygon(t,!0)},t.getHarpBoundingBox=function(e){return a(e.getBoundingBox())},t.hGeoRectToHarpGeoBox=a,t.harpGeoBoxToHGeoRect=function(e){return H.geo.Rect.fromPoints({lat:e.north,lng:e.west},{lat:e.south,lng:e.east})},t.harpToHGeoPolygon=function(e){if(void 0===e)return;const t=[];return l(e.coordinates).map((e=>{t.push(e.latitude,e.longitude,e.altitude)})),new H.geo.Polygon(new H.geo.LineString(t))},t.getClampedGeoRect=function(e,t){const i=function(e){const t=Math.pow(2,e.level)-1;return{row:e.row===t,column:e.column===t}}(t);return new H.geo.Rect(0===t.row?90:o.MathUtils.clamp(e.north,-90,90),o.MathUtils.clamp(e.west,-180,180),i.row?-90:o.MathUtils.clamp(e.south,-90,90),i.column?180:o.MathUtils.clamp(e.east,-180,180))}},9070:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Animation=void 0;const n=i(3977),r=i(4954);t.Animation=class{constructor(e,t,i){this.mapView=e,this.duration=t,this.updateCallback=i,this.running=!1,this.m_lastFrameTime=0,this.m_startTime=0,this.m_animateCb=e=>{this.animate(e.time<this.m_startTime?r.PerformanceTimer.now():e.time)}}start(e,t){if(!this.running)return this.running=!0,this.onFinished=t,this.mapView.addEventListener(n.MapViewEventNames.Render,this.m_animateCb),this.mapView.beginAnimation(),this.m_startTime=null!=e?e:r.PerformanceTimer.now(),this.m_lastFrameTime=this.m_startTime,this}stop(e=!1){this.running&&(this.running=!1,this.mapView.endAnimation(),this.mapView.removeEventListener(n.MapViewEventNames.Render,this.m_animateCb),void 0===this.onFinished||e||this.onFinished())}animate(e){const t=e-this.m_startTime,i=e-this.m_lastFrameTime;let n=t/this.duration;(0===this.duration||n>1)&&(n=1),this.m_lastFrameTime=e,this.update(n,t,i,e),n>=1&&this.stop()}update(e,t,i,n){void 0!==this.updateCallback&&this.updateCallback(e,t,i,n)}}},8806:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChangeRate=t.ControlUtils=t.AnimationUpdateEvent=void 0,t.AnimationUpdateEvent="animation-update";class i extends H.util.EventTarget{constructor(){super(),this.atX=void 0,this.atY=void 0,this.m_isRunning=!1,this.reset()}start(e,t){this.m_isRunning&&this.reset(),e===+e&&t===+t&&(this.atX=e,this.atY=t),this.m_isRunning=!0}reset(){this.m_isRunning=!1,this.atX=this.atY=void 0,this.m_changeRate=new r(0,0,0,0,0,0)}set(e,t,i,s,o,a){if(e/=1e3,t/=1e3,i/=1e3,s/=1e3,o/=1e3,a/=1e3,this.isRunning()){const l=new r(e,t,i,s,o,a);this.m_changeRate.equals(l)||(this.m_changeRate=l,this.dispatchEvent(new n(this.getChangeRate())))}}isRunning(){return this.m_isRunning}getChangeRate(){return this.m_changeRate}}t.ControlUtils=i;class n extends H.util.Event{constructor(e){super(t.AnimationUpdateEvent),this.changeRate=e,this.changeRate=e}}class r{constructor(e,t,i,n,r,s){this.moveX=e,this.moveY=t,this.moveZ=i,this.rotateX=n,this.rotateY=r,this.rotateZ=s,this.moveX=e,this.moveY=t,this.moveZ=i,this.rotateX=n,this.rotateY=r,this.rotateZ=s}equals(e){return this.moveX===e.moveX&&this.moveY===e.moveY&&this.moveZ===e.moveZ&&this.rotateX===e.rotateX&&this.rotateY===e.rotateY&&this.rotateZ===e.rotateZ}hasValue(){return 0!==this.moveX||0!==this.moveY||0!==this.moveZ||0!==this.rotateX||0!==this.rotateY||0!==this.rotateZ}}t.ChangeRate=r},4262:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i=0){let n,r;return function(){const s=this,o=arguments;function a(){r=0,e.apply(s,o)}clearTimeout(n),r>0&&i&&Date.now()-r>=i?a():(void 0===r&&(r=Date.now()),n=setTimeout((()=>a()),t))}}}},__webpack_module_cache__={};function __nested_webpack_require_3322126__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__nested_webpack_require_3322126__),i.exports}__nested_webpack_require_3322126__.d=(e,t)=>{for(var i in t)__nested_webpack_require_3322126__.o(t,i)&&!__nested_webpack_require_3322126__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__nested_webpack_require_3322126__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__nested_webpack_require_3322126__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__nested_webpack_require_3322126__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{"use strict";const e=__nested_webpack_require_3322126__(8935),t=__nested_webpack_require_3322126__(9636),i=__nested_webpack_require_3322126__(5234);self.H.map.render.harp={RenderEngine:e.RenderEngine,ProjectionType:i.ProjectionType,Style:t.Style}})()})();}).call(self);
/* harmony default export */ __webpack_exports__.Z = (H);

/***/ })

}]);